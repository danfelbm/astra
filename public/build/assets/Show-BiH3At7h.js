import{d as K,r as $,p as Q,s as H,c as j,i as b,e as a,f as e,q as W,w as l,g as n,t as c,b as g,j as p,v as I,h as u,m,F as O,k as X}from"./app-Gt4dtul1.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DpSBWYj6.js";import{c as Z,_ as T}from"./createLucideIcon-B1-tYSoR.js";import{_ as V,a as A,b as D,c as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-BZDUZOVp.js";import{_ as tt}from"./CardDescription.vue_vue_type_script_setup_true_lang-CVJWxk38.js";import{_ as C}from"./index-BAjrwUXc.js";import{_ as B}from"./Label.vue_vue_type_script_setup_true_lang-BNH5n8R4.js";import{_ as et,a as at,b as _,c as x}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CsK7SWVK.js";import{_ as it}from"./AccordionContent.vue_vue_type_script_setup_true_lang-D5G_x-lC.js";import{_ as ot}from"./EvidenciasTable.vue_vue_type_script_setup_true_lang-ChpZZeG8.js";import{O as lt}from"./ObligacionTree-vW1EAt14.js";import{_ as st,a as nt}from"./ActivityLog.vue_vue_type_script_setup_true_lang-RI1ROyOh.js";import{u as rt}from"./usePermissions-DrmqbMuV.js";import{A as dt}from"./arrow-left-B451CDUD.js";import{P as ct}from"./pencil-CHaejwTt.js";import{I as ut}from"./info-jR9CDfLx.js";import{I as mt}from"./image-dNOW3ltc.js";import{A as ft}from"./activity-Dp1Ivssh.js";import{P as vt}from"./paperclip-Bnv0blrr.js";import{f as F,e as L}from"./es-BDPlFIsO.js";import{p as N}from"./parseISO-DFjB8F03.js";import"./useFlashMessages-DqJblFBs.js";import"./index-BdJPjDvu.js";import"./floating-ui.vue-rCFcwPea.js";import"./x-79vAokX_.js";import"./Input.vue_vue_type_script_setup_true_lang-uZG4676m.js";import"./index-DSbyGM_L.js";import"./index-DJGydE9_.js";import"./shield-DsTg-o9d.js";import"./user-D2cyoabm.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-nLv8uXAx.js";import"./chevron-right-DcoFFIyk.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BOOP2mEn.js";import"./VisuallyHidden-CIdEb1oK.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-CmxEXceS.js";import"./check-VU-rtaY0.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Ul_qsbs-.js";import"./index-D7-jqHqV.js";import"./circle-alert-DlKxCUEJ.js";import"./map-pin-H-2PLz-I.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CQsR80VU.js";import"./chevrons-up-down-CltXpWMn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DB5JYnxQ.js";import"./tag-D2yEGtuD.js";import"./users-BmtVy_yp.js";import"./target-Bn4s37Qx.js";import"./vote-_KPoE3Ja.js";import"./folder-open-CRJL5QDE.js";import"./send-CMUdtcM8.js";import"./file-text-Blg9EDso.js";import"./briefcase-BAX_XsLC.js";import"./calendar-B5ZCcyEd.js";import"./megaphone-4tzKKMyh.js";import"./user-check-CLv-6Vid.js";import"./clipboard-list-BS0rd6eK.js";import"./mail-nWQvd0_O.js";import"./message-square-CuPllCTx.js";import"./external-link-DP89L60A.js";import"./panel-left-Z2DG2GzJ.js";import"./index-BIlE3S0S.js";import"./RovingFocusItem-GN-su7ze.js";import"./utils-DrD6Cfu2.js";import"./useArrowNavigation-B5rxJs06.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-LGl3krjw.js";import"./eye-DYUE5Qq1.js";import"./download-DghICAvd.js";import"./Separator.vue_vue_type_script_setup_true_lang-DtFtAzOo.js";import"./circle-BRDhsh0r.js";import"./layers-6QWSESVx.js";import"./plus-B0CXuW9Y.js";import"./trash-2-D7Het362.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./loader-circle-aq53I4gw.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CFcYoZwL.js";import"./filter-Cw55zPHD.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Z("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),gt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ht={class:"flex items-center justify-between"},bt={class:"text-3xl font-bold"},yt={class:"text-muted-foreground mt-2"},_t={class:"flex gap-2"},xt={class:"mt-1"},wt={class:"pt-4 border-t"},kt={class:"font-medium mt-1"},$t={class:"text-sm text-gray-600 mt-1"},jt={class:"pt-4 border-t space-y-3"},It={class:"mt-1"},Vt={class:"text-xs text-gray-500"},At={key:0},Dt={class:"mt-1"},Mt={class:"text-xs text-gray-500"},Ct={key:1},Et={class:"mt-1"},Pt={class:"text-xs text-gray-500"},St={class:"space-y-2"},Ht=["href"],oa=K({__name:"Show",props:{obligacion:{},contrato:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canCreateChild:{type:Boolean},actividades:{},usuariosActividades:{}},setup(i){const y=i,{hasPermission:U}=rt(),z=["general","hijos","evidencias","actividad"],w=$((()=>{const t=new URLSearchParams(window.location.search).get("tab");return t&&z.includes(t)?t:"general"})());Q(w,o=>{const t=`/admin/obligaciones/${y.obligacion.id}?tab=${o}`;H.get(t,{},{preserveState:!0,preserveScroll:!0,replace:!0,only:[]})});const d=$({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null,entregable_id:null}),f=$({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),q=[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"},{title:y.obligacion.titulo}],h=j(()=>y.obligacion.evidencias||[]),G=j(()=>{let o=h.value;return d.value.tipo&&(o=o.filter(t=>t.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(t=>t.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(t=>{var r;return((r=t.usuario)==null?void 0:r.id)===d.value.usuario_id})),d.value.entregable_id&&(o=o.filter(t=>{var r;return(r=t.entregables)==null?void 0:r.some(s=>s.id===d.value.entregable_id)})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(t=>{const r=new Date(t.created_at);if(d.value.fecha_inicio){const s=new Date(d.value.fecha_inicio);if(r<s)return!1}if(d.value.fecha_fin){const s=new Date(d.value.fecha_fin);if(s.setHours(23,59,59,999),r>s)return!1}return!0})),o}),R=j(()=>{let o=y.actividades||[];return f.value.usuario_id&&(o=o.filter(t=>{var r;return((r=t.causer)==null?void 0:r.id)===f.value.usuario_id})),f.value.tipo_accion&&(o=o.filter(t=>t.event===f.value.tipo_accion)),(f.value.fecha_inicio||f.value.fecha_fin)&&(o=o.filter(t=>{const r=new Date(t.created_at);if(f.value.fecha_inicio){const s=new Date(f.value.fecha_inicio);if(r<s)return!1}if(f.value.fecha_fin){const s=new Date(f.value.fecha_fin);if(s.setHours(23,59,59,999),r>s)return!1}return!0})),o}),k=o=>{if(!o)return"Sin fecha";try{return F(N(o),"dd MMM yyyy HH:mm",{locale:L})}catch{return o}},J=o=>{if(!o)return"-";try{return F(N(o),"d 'de' MMMM 'de' yyyy",{locale:L})}catch{return o}};return(o,t)=>(m(),b(O,null,[a(e(W),{title:`Obligación - ${i.obligacion.titulo}`},null,8,["title"]),a(Y,{breadcrumbs:q},{default:l(()=>[n("div",gt,[n("div",ht,[n("div",null,[n("h1",bt,c(i.obligacion.titulo),1),n("p",yt," Contrato: "+c(i.contrato.nombre),1)]),n("div",_t,[a(e(I),{href:`/admin/contratos/${i.contrato.id}`},{default:l(()=>[a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(dt),{class:"h-4 w-4 mr-2"}),t[4]||(t[4]=u(" Ver Contrato ",-1))]),_:1})]),_:1},8,["href"]),i.canEdit?(m(),g(e(I),{key:0,href:o.route("admin.obligaciones.edit",i.obligacion.id)},{default:l(()=>[a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(ct),{class:"h-4 w-4 mr-2"}),t[5]||(t[5]=u(" Editar ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])]),a(e(et),{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=r=>w.value=r),class:"flex-1"},{default:l(()=>{var r;return[a(e(at),null,{default:l(()=>{var s;return[a(e(_),{value:"general"},{default:l(()=>[a(e(ut),{class:"h-4 w-4 mr-2"}),t[6]||(t[6]=u(" General ",-1))]),_:1}),(s=i.obligacion.hijos)!=null&&s.length?(m(),g(e(_),{key:0,value:"hijos"},{default:l(()=>{var v;return[a(e(pt),{class:"h-4 w-4 mr-2"}),t[7]||(t[7]=u(" Obligaciones Hijas ",-1)),(v=i.obligacion.hijos)!=null&&v.length?(m(),g(e(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[u(c(i.obligacion.hijos.length),1)]),_:1})):p("",!0)]}),_:1})):p("",!0),a(e(_),{value:"evidencias"},{default:l(()=>[a(e(mt),{class:"h-4 w-4 mr-2"}),t[8]||(t[8]=u(" Evidencias ",-1)),h.value.length>0?(m(),g(e(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[u(c(h.value.length),1)]),_:1})):p("",!0)]),_:1}),a(e(_),{value:"actividad"},{default:l(()=>[a(e(ft),{class:"h-4 w-4 mr-2"}),t[9]||(t[9]=u(" Actividad ",-1)),i.actividades&&i.actividades.length>0?(m(),g(e(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[u(c(i.actividades.length),1)]),_:1})):p("",!0)]),_:1})]}),_:1}),a(e(x),{value:"general",class:"space-y-4 mt-6"},{default:l(()=>{var s;return[a(e(V),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[10]||(t[10]=[u("Información General",-1)])]),_:1})]),_:1}),a(e(M),{class:"space-y-4"},{default:l(()=>{var v,E,P,S;return[n("div",null,[a(e(B),null,{default:l(()=>[...t[11]||(t[11]=[u("Descripción",-1)])]),_:1}),n("p",xt,c(i.obligacion.descripcion||"Sin descripción"),1)]),n("div",wt,[a(e(B),null,{default:l(()=>[...t[12]||(t[12]=[u("Contrato",-1)])]),_:1}),a(e(I),{href:o.route("admin.contratos.show",i.contrato.id),class:"hover:underline"},{default:l(()=>[n("h3",kt,c(i.contrato.nombre),1)]),_:1},8,["href"]),n("p",$t,c((v=i.contrato.proyecto)==null?void 0:v.nombre),1)]),n("div",jt,[n("div",null,[t[13]||(t[13]=n("span",{class:"text-sm text-gray-600"},"Creado por:",-1)),n("p",It,c(((E=i.obligacion.creador)==null?void 0:E.name)||"Sistema"),1),n("p",Vt,c(k(i.obligacion.created_at)),1)]),i.obligacion.updated_at?(m(),b("div",At,[t[14]||(t[14]=n("span",{class:"text-sm text-gray-600"},"Última actualización:",-1)),n("p",Dt,c(((P=i.obligacion.actualizador)==null?void 0:P.name)||"Sistema"),1),n("p",Mt,c(k(i.obligacion.updated_at)),1)])):p("",!0),i.obligacion.cumplido_at?(m(),b("div",Ct,[t[15]||(t[15]=n("span",{class:"text-sm text-gray-600"},"Cumplido por:",-1)),n("p",Et,c(((S=i.obligacion.cumplido_por_usuario)==null?void 0:S.name)||"Sistema"),1),n("p",Pt,c(k(i.obligacion.cumplido_at)),1)])):p("",!0)])]}),_:1})]),_:1}),(s=i.obligacion.archivos_adjuntos)!=null&&s.length?(m(),g(e(V),{key:0},{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[16]||(t[16]=[u("Archivos Adjuntos",-1)])]),_:1})]),_:1}),a(e(M),null,{default:l(()=>[n("div",St,[(m(!0),b(O,null,X(i.obligacion.archivos_adjuntos,v=>(m(),b("div",{key:v.ruta,class:"flex items-center gap-2"},[a(e(vt),{class:"h-4 w-4"}),n("a",{href:`/storage/${v.ruta}`,target:"_blank",class:"hover:underline text-sm"},c(v.nombre_original),9,Ht)]))),128))])]),_:1})]),_:1})):p("",!0)]}),_:1}),(r=i.obligacion.hijos)!=null&&r.length?(m(),g(e(x),{key:0,value:"hijos",class:"space-y-4 mt-6"},{default:l(()=>[a(e(V),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[17]||(t[17]=[u("Obligaciones Hijas",-1)])]),_:1}),a(e(tt),null,{default:l(()=>[...t[18]||(t[18]=[u(" Sub-obligaciones derivadas de esta obligación principal ",-1)])]),_:1})]),_:1}),a(e(M),null,{default:l(()=>[a(lt,{obligaciones:i.obligacion.hijos,contratoId:i.obligacion.contrato_id,editable:e(U)("obligaciones.edit"),onEdit:t[0]||(t[0]=s=>e(H).visit(o.route("admin.obligaciones.edit",s.id)))},null,8,["obligaciones","contratoId","editable"])]),_:1})]),_:1})]),_:1})):p("",!0),a(e(x),{value:"evidencias",class:"space-y-4 mt-6"},{default:l(()=>{var s;return[h.value.length>0?(m(),g(it,{key:0,modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=v=>d.value=v),contratos:[i.contrato],evidencias:h.value},null,8,["modelValue","contratos","evidencias"])):p("",!0),a(ot,{mode:"simple",modo:"admin",evidencias:G.value,contrato:i.contrato,"proyecto-id":(s=i.contrato.proyecto)==null?void 0:s.id,"puede-gestionar-estado":!0,"format-date":J,"card-title":"Evidencias Asociadas","card-description":"Evidencias cargadas para esta obligación"},null,8,["evidencias","contrato","proyecto-id"])]}),_:1}),a(e(x),{value:"actividad",class:"space-y-4 mt-6"},{default:l(()=>[i.actividades&&i.actividades.length>0?(m(),g(st,{key:0,modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=s=>f.value=s),usuarios:i.usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):p("",!0),a(nt,{activities:R.value,title:"Historial de Actividad",description:"Registro de cambios y actividades relacionadas con esta obligación","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]}),_:1},8,["modelValue"])])]),_:1})],64))}});export{oa as default};
