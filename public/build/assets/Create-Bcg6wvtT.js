import{d as pe,u as _e,r as h,c as x,b,w as t,g as l,e as o,t as u,f as e,h as n,l as ge,j as p,i as f,n as j,m as d,F as B,k as E,s as be}from"./app-DN6QmyVA.js";import{_ as ve}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CHoqJ1Vs.js";import{_ as y,a as V,b as $,c as k}from"./CardTitle.vue_vue_type_script_setup_true_lang-CF8Wn-Rb.js";import{_ as N}from"./CardDescription.vue_vue_type_script_setup_true_lang-tXUYC_qK.js";import{_ as C}from"./createLucideIcon-bHN-Vr8r.js";import{_ as T}from"./Input.vue_vue_type_script_setup_true_lang-Cls_3VRI.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-BwFmXIqv.js";import{_ as H}from"./Textarea.vue_vue_type_script_setup_true_lang-BTJJeohk.js";import{_ as O,a as X,b as J,c as K,d as Q}from"./SelectValue.vue_vue_type_script_setup_true_lang-B2Cx1TMz.js";import{_ as W}from"./index-C3ml343d.js";import{_ as Y,a as Z,b as ee}from"./index-D9EymtZh.js";import{_ as he,a as xe}from"./index-Bq7UKJDk.js";import{_ as ae}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-C6muLiVe.js";import{_ as ye}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-D1dn0vsm.js";import{E as Ve}from"./EtiquetaSelector-HmSe3L6J.js";import{u as $e}from"./useToast-7Gep6fSh.js";import{F as ke}from"./flag-Ctbjvaam.js";import{X as oe}from"./x-Cm0qExSY.js";import{U as se}from"./user-plus-D3pgjhI2.js";import{T as Ce}from"./tag--jnVc7eU.js";import{C as we}from"./circle-alert-Bu4ClAN_.js";import{A as Ne}from"./arrow-left-Dh2XOgPa.js";import{S as Se}from"./save-Bq3NuywH.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useFlashMessages-CBs6aChg.js";import"./index-NrU4D0lu.js";import"./floating-ui.vue-CTSZ85Lh.js";import"./shield-B2_nKIiu.js";import"./user-CwFkxtf0.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BYp6j_hm.js";import"./chevron-right-T26P7ixS.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BwTHlVZ5.js";import"./VisuallyHidden--r213FwR.js";import"./index-Cs5j4r3l.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-D65AShpu.js";import"./index-DgF4TGuY.js";import"./map-pin-DfCpEIxd.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Me-jLM3d.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-EfS_-3Lb.js";import"./chevrons-up-down-4OFPGav-.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Def9XNBM.js";import"./users-WMBZV_7W.js";import"./target-D0C8ALTL.js";import"./vote-CpB7URoM.js";import"./folder-open-xJpIHsw6.js";import"./send-DySB3ayg.js";import"./file-text-D4mPBax1.js";import"./briefcase-Ckb63ktQ.js";import"./calendar-DyqJwdM-.js";import"./megaphone-BBE9Y1S6.js";import"./user-check-BPod1YIP.js";import"./clipboard-list-CM2vRH0S.js";import"./mail-DJEwOtRX.js";import"./message-square-D7fp1M5W.js";import"./external-link-BG9mUbSP.js";import"./panel-left-D0FOsElT.js";import"./check-DKiVvNo7.js";import"./index-RgZvykRC.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BU0iMVSL.js";import"./search-uzAJstI-.js";import"./loader-circle-DX1o9uNi.js";import"./chevron-left-C0_-SqQm.js";import"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-BKFxK4Wv.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-CL_iEmST.js";import"./RovingFocusItem-D2Fxh2O3.js";import"./utils-npjear8W.js";import"./VisuallyHiddenInput-Cp9pc_Sr.js";import"./circle-CQasbBNC.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BI2CoM04.js";import"./TabsTrigger.vue_vue_type_script_setup_true_lang-DyKnPcpR.js";import"./index-CgtQ6GgD.js";import"./useKbd-kRIii9yh.js";import"./useEtiquetaHierarchy-CLW9ZAb5.js";import"./list-DkgXlsrx.js";import"./tree-pine-n2-5g5S4.js";import"./plus-CO9XhxJV.js";import"./zap-Bj1xhCi3.js";import"./layers-Biz3YJFW.js";import"./trending-up-BTITi1K5.js";import"./award-DPdr8Yfp.js";import"./hash-DTuJ3ydR.js";const Be={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ee={class:"text-muted-foreground mt-2"},Ae={class:"grid gap-4 md:grid-cols-3"},De={class:"font-medium"},ze={class:"font-medium"},qe={key:0,class:"text-sm text-red-600 mt-1"},Re={key:0,class:"text-sm text-red-600 mt-1"},je={class:"grid gap-4 md:grid-cols-2"},Te={class:"flex items-center gap-2"},Fe={class:"grid gap-4 md:grid-cols-2"},Ie={key:0,class:"text-sm text-red-600 mt-1"},Pe={key:0,class:"text-sm text-red-600 mt-1"},Le={class:"space-y-2"},Me={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},Ge={class:"flex items-center gap-2"},He={class:"font-medium"},Oe={class:"text-sm text-muted-foreground"},Xe={key:0,class:"text-sm text-red-600 mt-1"},Je={class:"flex items-center justify-between mb-2"},Ke={key:0,class:"space-y-2 mt-3"},Qe={class:"flex items-center gap-2"},We={class:"font-medium"},Ye={class:"text-sm text-muted-foreground"},Ze={key:1,class:"text-sm text-muted-foreground mt-3"};const ea={class:"list-disc pl-4"},aa={class:"flex justify-end gap-2"},oa=pe({__name:"Create",props:{proyecto:{},hito:{},usuarios:{},camposPersonalizados:{},categorias:{},estados:{},prioridades:{},siguienteOrden:{}},setup(m){const c=m,{toast:te}=$e(),s=_e({nombre:"",descripcion:"",fecha_inicio:"",fecha_fin:"",estado:"pendiente",prioridad:"media",responsable_id:null,usuarios_asignados:[],campos_personalizados:{},etiquetas:[],orden:c.siguienteOrden||1,notas:""});h(!1);const S=h(null),F=h("colaborador"),A=h(!1),D=h(!1),{route:I}=window,re=x(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:c.proyecto.nombre,href:`/admin/proyectos/${c.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${c.proyecto.id}/hitos`},{title:c.hito.nombre,href:`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}`},{title:"Entregables",href:`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`},{title:"Nuevo Entregable"}]),_=h(null),g=h(new Map);c.usuarios.forEach(i=>g.value.set(i.id,i));const le=x(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"colaborador",label:"Colaborador"},{value:"revisor",label:"Revisor"}],value:"colaborador",required:!0}]),ie=x(()=>{const i=s.usuarios_asignados.map(a=>a.user_id);return s.responsable_id&&i.push(s.responsable_id),i}),ne=i=>{if(i.userIds.length>0){const a=i.userIds[0];s.responsable_id=a,g.value.has(a)?_.value=g.value.get(a)||null:(_.value={id:a,name:`Usuario seleccionado (ID: ${a})`,email:"Se actualizará al guardar"},g.value.set(a,_.value))}},de=i=>{i.userIds.forEach(a=>{s.usuarios_asignados.some(U=>U.user_id===a)||(s.usuarios_asignados.push({user_id:a,rol:i.extraData.rol||"colaborador"}),g.value.has(a)||g.value.set(a,{id:a,name:`Usuario #${a}`,email:"Pendiente de actualizar"}))})},ue=()=>{const i={...s.data(),usuarios:s.usuarios_asignados};delete i.usuarios_asignados,s.transform(()=>i).post(`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`,{preserveScroll:!0})},ce=()=>{be.get(`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`)},sa=()=>{if(!S.value)return;if(s.usuarios_asignados.some(a=>a.user_id===S.value)){te.warning("Este usuario ya está asignado");return}s.usuarios_asignados.push({user_id:S.value,rol:F.value}),S.value=null,F.value="colaborador"},me=i=>{const a=s.usuarios_asignados.findIndex(r=>r.user_id===i);a>-1&&s.usuarios_asignados.splice(a,1)},w=i=>g.value.has(i)?g.value.get(i):c.usuarios.find(a=>a.id===i),ta=x(()=>{const i=s.usuarios_asignados.map(a=>a.user_id);return s.responsable_id&&i.push(s.responsable_id),c.usuarios.filter(a=>!i.includes(a.id))}),z=x(()=>{const i=[];return s.nombre||i.push("El nombre es requerido"),s.nombre.length>255&&i.push("El nombre no puede exceder 255 caracteres"),s.fecha_inicio&&s.fecha_fin&&new Date(s.fecha_inicio)>new Date(s.fecha_fin)&&i.push("La fecha de inicio no puede ser posterior a la fecha de fin"),s.responsable_id||i.push("Debe asignar un responsable"),i}),fe=x(()=>z.value.length===0&&!s.processing);return(i,a)=>(d(),b(ve,{breadcrumbs:re.value},{default:t(()=>[l("div",Be,[l("div",null,[a[16]||(a[16]=l("h2",{class:"text-3xl font-bold tracking-tight"},"Nuevo Entregable",-1)),l("p",Ee,' Agregar un nuevo entregable al hito "'+u(m.hito.nombre)+'" ',1)]),o(e(y),null,{default:t(()=>[o(e(V),null,{default:t(()=>[o(e($),{class:"text-base"},{default:t(()=>[...a[17]||(a[17]=[n("Información del Hito",-1)])]),_:1})]),_:1}),o(e(k),null,{default:t(()=>[l("div",Ae,[l("div",null,[a[18]||(a[18]=l("p",{class:"text-sm text-muted-foreground"},"Hito",-1)),l("p",De,u(m.hito.nombre),1)]),l("div",null,[a[19]||(a[19]=l("p",{class:"text-sm text-muted-foreground"},"Estado",-1)),o(e(W),null,{default:t(()=>[n(u(m.hito.estado_label||m.hito.estado),1)]),_:1})]),l("div",null,[a[20]||(a[20]=l("p",{class:"text-sm text-muted-foreground"},"Progreso",-1)),l("p",ze,u(m.hito.porcentaje_completado||0)+"%",1)])])]),_:1})]),_:1}),l("form",{onSubmit:ge(ue,["prevent"]),class:"space-y-6"},[o(e(y),null,{default:t(()=>[o(e(V),null,{default:t(()=>[o(e($),null,{default:t(()=>[...a[21]||(a[21]=[n("Información Básica",-1)])]),_:1}),o(e(N),null,{default:t(()=>[...a[22]||(a[22]=[n(" Datos principales del entregable ",-1)])]),_:1})]),_:1}),o(e(k),{class:"space-y-4"},{default:t(()=>[l("div",null,[o(e(v),{for:"nombre",class:"required"},{default:t(()=>[...a[23]||(a[23]=[n(" Nombre del entregable ",-1)])]),_:1}),o(e(T),{id:"nombre",modelValue:e(s).nombre,"onUpdate:modelValue":a[0]||(a[0]=r=>e(s).nombre=r),placeholder:"Ej: Documento de diseño técnico",class:j({"border-red-500":e(s).errors.nombre})},null,8,["modelValue","class"]),e(s).errors.nombre?(d(),f("p",qe,u(e(s).errors.nombre),1)):p("",!0)]),l("div",null,[o(e(v),{for:"descripcion"},{default:t(()=>[...a[24]||(a[24]=[n(" Descripción ",-1)])]),_:1}),o(e(H),{id:"descripcion",modelValue:e(s).descripcion,"onUpdate:modelValue":a[1]||(a[1]=r=>e(s).descripcion=r),placeholder:"Describe el entregable y sus objetivos...",rows:"4",class:j({"border-red-500":e(s).errors.descripcion})},null,8,["modelValue","class"]),e(s).errors.descripcion?(d(),f("p",Re,u(e(s).errors.descripcion),1)):p("",!0)]),l("div",je,[l("div",null,[o(e(v),{for:"estado"},{default:t(()=>[...a[25]||(a[25]=[n(" Estado inicial ",-1)])]),_:1}),o(e(O),{modelValue:e(s).estado,"onUpdate:modelValue":a[2]||(a[2]=r=>e(s).estado=r)},{default:t(()=>[o(e(X),null,{default:t(()=>[o(e(J),{placeholder:"Seleccionar estado"})]),_:1}),o(e(K),null,{default:t(()=>[(d(!0),f(B,null,E(m.estados,r=>(d(),b(e(Q),{key:r.value,value:r.value},{default:t(()=>[n(u(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),l("div",null,[o(e(v),{for:"prioridad"},{default:t(()=>[...a[26]||(a[26]=[n(" Prioridad ",-1)])]),_:1}),o(e(O),{modelValue:e(s).prioridad,"onUpdate:modelValue":a[3]||(a[3]=r=>e(s).prioridad=r)},{default:t(()=>[o(e(X),null,{default:t(()=>[o(e(J),{placeholder:"Seleccionar prioridad"})]),_:1}),o(e(K),null,{default:t(()=>[(d(!0),f(B,null,E(m.prioridades,r=>(d(),b(e(Q),{key:r.value,value:r.value},{default:t(()=>[l("div",Te,[o(e(ke),{class:j(["h-4 w-4",{"text-blue-500":r.value==="baja","text-yellow-500":r.value==="media","text-red-500":r.value==="alta"}])},null,8,["class"]),n(" "+u(r.label),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),o(e(y),null,{default:t(()=>[o(e(V),null,{default:t(()=>[o(e($),null,{default:t(()=>[...a[27]||(a[27]=[n("Fechas",-1)])]),_:1}),o(e(N),null,{default:t(()=>[...a[28]||(a[28]=[n(" Define el período de ejecución del entregable ",-1)])]),_:1})]),_:1}),o(e(k),{class:"space-y-4"},{default:t(()=>[l("div",Fe,[l("div",null,[o(e(v),{for:"fecha_inicio"},{default:t(()=>[...a[29]||(a[29]=[n(" Fecha de inicio ",-1)])]),_:1}),o(e(T),{id:"fecha_inicio",modelValue:e(s).fecha_inicio,"onUpdate:modelValue":a[4]||(a[4]=r=>e(s).fecha_inicio=r),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_inicio?(d(),f("p",Ie,u(e(s).errors.fecha_inicio),1)):p("",!0)]),l("div",null,[o(e(v),{for:"fecha_fin"},{default:t(()=>[...a[30]||(a[30]=[n(" Fecha de fin ",-1)])]),_:1}),o(e(T),{id:"fecha_fin",modelValue:e(s).fecha_fin,"onUpdate:modelValue":a[5]||(a[5]=r=>e(s).fecha_fin=r),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_fin?(d(),f("p",Pe,u(e(s).errors.fecha_fin),1)):p("",!0)])])]),_:1})]),_:1}),o(e(y),null,{default:t(()=>[o(e(V),null,{default:t(()=>[o(e($),null,{default:t(()=>[...a[31]||(a[31]=[n("Asignación",-1)])]),_:1}),o(e(N),null,{default:t(()=>[...a[32]||(a[32]=[n(" Asigna un responsable y colaboradores al entregable ",-1)])]),_:1})]),_:1}),o(e(k),{class:"space-y-4"},{default:t(()=>[l("div",null,[o(e(v),{for:"responsable",class:"required"},{default:t(()=>[...a[33]||(a[33]=[n(" Responsable principal ",-1)])]),_:1}),l("div",Le,[_.value?(d(),f("div",Me,[l("div",Ge,[o(e(Y),{class:"h-8 w-8"},{default:t(()=>[_.value.avatar?(d(),b(e(Z),{key:0,src:_.value.avatar},null,8,["src"])):p("",!0),o(e(ee),null,{default:t(()=>[n(u(_.value.name.substring(0,2).toUpperCase()),1)]),_:1})]),_:1}),l("div",null,[l("p",He,u(_.value.name),1),l("p",Oe,u(_.value.email),1)])]),o(e(C),{type:"button",variant:"ghost",size:"sm",onClick:a[6]||(a[6]=r=>e(s).responsable_id=null)},{default:t(()=>[o(e(oe),{class:"h-4 w-4"})]),_:1})])):p("",!0),o(e(C),{type:"button",variant:"outline",onClick:a[7]||(a[7]=r=>A.value=!0),class:"w-full"},{default:t(()=>[o(e(se),{class:"h-4 w-4 mr-2"}),n(" "+u(_.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(s).errors.responsable_id?(d(),f("p",Xe,u(e(s).errors.responsable_id),1)):p("",!0)]),l("div",null,[l("div",Je,[o(e(v),null,{default:t(()=>[...a[34]||(a[34]=[n(" Colaboradores adicionales ",-1)])]),_:1}),o(e(C),{type:"button",variant:"outline",size:"sm",onClick:a[8]||(a[8]=r=>D.value=!0)},{default:t(()=>[o(e(se),{class:"mr-2 h-4 w-4"}),a[35]||(a[35]=n(" Agregar colaboradores ",-1))]),_:1})]),e(s).usuarios_asignados.length>0?(d(),f("div",Ke,[(d(!0),f(B,null,E(e(s).usuarios_asignados,r=>{var U,q;return d(),f("div",{key:r.user_id,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},[l("div",Qe,[o(e(Y),{class:"h-8 w-8"},{default:t(()=>{var R,P;return[(R=w(r.user_id))!=null&&R.avatar?(d(),b(e(Z),{key:0,src:(P=w(r.user_id))==null?void 0:P.avatar},null,8,["src"])):p("",!0),o(e(ee),null,{default:t(()=>{var L,M,G;return[n(u(((G=(M=(L=w(r.user_id))==null?void 0:L.name)==null?void 0:M.substring(0,2))==null?void 0:G.toUpperCase())||"US"),1)]}),_:2},1024)]}),_:2},1024),l("div",null,[l("p",We,u(((U=w(r.user_id))==null?void 0:U.name)||`Usuario #${r.user_id}`),1),l("p",Ye,u(((q=w(r.user_id))==null?void 0:q.email)||""),1)]),o(e(W),{variant:"outline"},{default:t(()=>[n(u(r.rol),1)]),_:2},1024)]),o(e(C),{type:"button",variant:"ghost",size:"sm",onClick:R=>me(r.user_id)},{default:t(()=>[o(e(oe),{class:"h-4 w-4"})]),_:1},8,["onClick"])])}),128))])):(d(),f("div",Ze," No hay colaboradores asignados ")),p("",!0)])]),_:1})]),_:1}),o(e(y),null,{default:t(()=>[o(e(V),null,{default:t(()=>[o(e($),null,{default:t(()=>[...a[41]||(a[41]=[n("Notas adicionales",-1)])]),_:1}),o(e(N),null,{default:t(()=>[...a[42]||(a[42]=[n(" Información adicional o consideraciones especiales ",-1)])]),_:1})]),_:1}),o(e(k),null,{default:t(()=>[o(e(H),{modelValue:e(s).notas,"onUpdate:modelValue":a[11]||(a[11]=r=>e(s).notas=r),placeholder:"Notas adicionales sobre el entregable...",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),m.camposPersonalizados&&m.camposPersonalizados.length>0?(d(),b(ye,{key:0,campos:m.camposPersonalizados,valores:e(s).campos_personalizados,errors:e(s).errors,onUpdate:a[12]||(a[12]=r=>e(s).campos_personalizados=r)},null,8,["campos","valores","errors"])):p("",!0),m.categorias&&m.categorias.length>0?(d(),b(e(y),{key:1},{default:t(()=>[o(e(V),null,{default:t(()=>[o(e($),{class:"flex items-center gap-2"},{default:t(()=>[o(e(Ce),{class:"h-5 w-5"}),a[43]||(a[43]=n(" Etiquetas ",-1))]),_:1}),o(e(N),null,{default:t(()=>[...a[44]||(a[44]=[n(" Asigna etiquetas para categorizar y organizar este entregable ",-1)])]),_:1})]),_:1}),o(e(k),null,{default:t(()=>[o(Ve,{modelValue:e(s).etiquetas,"onUpdate:modelValue":a[13]||(a[13]=r=>e(s).etiquetas=r),categorias:m.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas para el entregable...",description:"Puedes asignar hasta 10 etiquetas"},null,8,["modelValue","categorias"])]),_:1})]),_:1})):p("",!0),z.value.length>0?(d(),b(e(he),{key:2,variant:"destructive"},{default:t(()=>[o(e(we),{class:"h-4 w-4"}),o(e(xe),null,{default:t(()=>[l("ul",ea,[(d(!0),f(B,null,E(z.value,r=>(d(),f("li",{key:r},u(r),1))),128))])]),_:1})]),_:1})):p("",!0),l("div",aa,[o(e(C),{type:"button",variant:"outline",onClick:ce},{default:t(()=>[o(e(Ne),{class:"mr-2 h-4 w-4"}),a[45]||(a[45]=n(" Cancelar ",-1))]),_:1}),o(e(C),{type:"submit",disabled:!fe.value},{default:t(()=>[o(e(Se),{class:"mr-2 h-4 w-4"}),n(" "+u(e(s).processing?"Creando...":"Crear Entregable"),1)]),_:1},8,["disabled"])])],32)]),o(ae,{modelValue:A.value,"onUpdate:modelValue":a[14]||(a[14]=r=>A.value=r),title:"Seleccionar Responsable Principal",description:"Selecciona el usuario que será el responsable principal del entregable","search-endpoint":e(I)("admin.proyectos.search-users"),"excluded-ids":e(s).responsable_id?[e(s).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:ne},null,8,["modelValue","search-endpoint","excluded-ids"]),o(ae,{modelValue:D.value,"onUpdate:modelValue":a[15]||(a[15]=r=>D.value=r),title:"Agregar Colaboradores",description:"Selecciona los usuarios que colaborarán en este entregable","search-endpoint":e(I)("admin.proyectos.search-users"),"excluded-ids":ie.value,"extra-fields":le.value,"submit-button-text":"Agregar Colaboradores","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:de},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"])]),_:1},8,["breadcrumbs"]))}}),Do=Ue(oa,[["__scopeId","data-v-69900688"]]);export{Do as default};
