import{d as L,c as S,i as g,b as p,j as y,e as t,f as a,w as e,F as b,k as v,h as o,t as n,g as r,m as u,v as w,l as q,n as V,s as z}from"./app-_gYD6cjj.js";import{_ as A,a as G,b as M,c as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-quT184_r.js";import{_ as O}from"./CardDescription.vue_vue_type_script_setup_true_lang-BWX0gdwC.js";import{_ as x}from"./index-CLTC7jgA.js";import{_ as h}from"./createLucideIcon-COT61OVh.js";import{_ as T,a as j,b as $,c as f,d as B,e as m}from"./TableHeader.vue_vue_type_script_setup_true_lang-D0WVlfis.js";import{a as P,b as R,c as H,d as J}from"./AccordionContent.vue_vue_type_script_setup_true_lang-DxH2igTu.js";import{_ as K,a as Q,b as W,c as X,d as E}from"./SelectValue.vue_vue_type_script_setup_true_lang-BprGPrBF.js";import{t as Y}from"./index-DFKIlxwT.js";import{I as Z}from"./image-bItFXG-Y.js";import{F as aa}from"./file-text-CBxvBWUq.js";import{E as ta}from"./external-link-TlQJ5gH-.js";import{E as F}from"./eye-CORofjR2.js";import{D as N}from"./download-gP7YYWUG.js";const ea={key:0},sa={class:"flex items-center justify-between w-full pr-4"},la={class:"flex items-center gap-3"},oa={class:"text-left"},da={class:"font-semibold"},ra={class:"text-sm text-gray-500"},na={class:"flex items-center gap-3"},ia={class:"text-sm text-gray-600"},ua={class:"text-sm"},fa={class:"flex items-center justify-end gap-2"},ma=["href"],ca={key:1},_a={class:"text-sm text-gray-600"},ga={key:0,class:"flex flex-wrap gap-1"},pa={key:1,class:"text-sm text-gray-500"},xa={class:"text-sm"},ya={class:"flex items-center justify-end gap-2"},ba=["href"],va={class:"text-center"},ha={class:"mt-2 text-sm text-gray-600"},$a={class:"text-xs text-gray-500 mt-1"},Ua=L({__name:"EvidenciasTable",props:{mode:{},evidencias:{},evidenciasAgrupadas:{},contrato:{},formatDate:{},cardTitle:{default:"Evidencias Asociadas"},cardDescription:{default:"Evidencias cargadas para esta obligación"},modo:{default:"admin"},puedeGestionarEstado:{type:Boolean,default:!1},proyectoId:{}},setup(i){const c=i,D=_=>({"bg-yellow-100 text-yellow-800":_==="pendiente","bg-green-100 text-green-800":_==="aprobada","bg-red-100 text-red-800":_==="rechazada"}),k=S(()=>c.mode==="grouped"?c.evidenciasAgrupadas&&c.evidenciasAgrupadas.length>0:c.evidencias&&c.evidencias.length>0),U=(_,s)=>{if(s===_.estado||!c.proyectoId)return;const l=c.modo==="admin"?`/admin/proyectos/${c.proyectoId}/evidencias/${_.id}/cambiar-estado`:`/miembro/mis-proyectos/${c.proyectoId}/evidencias/${_.id}/cambiar-estado`;z.post(l,{estado:s,observaciones:null},{preserveScroll:!0,onSuccess:()=>{z.reload()},onError:d=>{Y.error("Error al cambiar el estado"),console.error(d)}})};return(_,s)=>i.mode==="grouped"&&k.value?(u(),g("div",ea,[t(a(P),{type:"multiple",class:"space-y-4",collapsible:""},{default:e(()=>[(u(!0),g(b,null,v(i.evidenciasAgrupadas,l=>(u(),p(a(R),{key:l.contrato.id,value:`contrato-${l.contrato.id}`,class:"border rounded-lg bg-card"},{default:e(()=>[t(a(H),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:e(()=>[r("div",sa,[r("div",la,[t(a(aa),{class:"h-5 w-5 text-gray-500"}),r("div",oa,[r("div",da,n(l.contrato.nombre),1),r("div",ra," Contrato #"+n(l.contrato.id),1)])]),r("div",na,[t(a(x),{variant:"secondary"},{default:e(()=>[o(n(l.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),t(a(w),{href:`/admin/contratos/${l.contrato.id}`,onClick:s[0]||(s[0]=q(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:e(()=>[s[1]||(s[1]=o(" Ver contrato ",-1)),t(a(ta),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),t(a(J),{class:"px-4 pb-4"},{default:e(()=>[t(a(T),null,{default:e(()=>[t(a(j),null,{default:e(()=>[t(a($),null,{default:e(()=>[t(a(f),null,{default:e(()=>[...s[2]||(s[2]=[o("Tipo",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[3]||(s[3]=[o("Obligación",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[4]||(s[4]=[o("Descripción",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[5]||(s[5]=[o("Usuario",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[6]||(s[6]=[o("Estado",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[7]||(s[7]=[o("Fecha",-1)])]),_:1}),t(a(f),{class:"text-right"},{default:e(()=>[...s[8]||(s[8]=[o("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(a(B),null,{default:e(()=>[(u(!0),g(b,null,v(l.evidencias,d=>(u(),p(a($),{key:d.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:e(()=>[t(a(m),null,{default:e(()=>[t(a(x),{variant:"outline"},{default:e(()=>[o(n(d.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(a(m),null,{default:e(()=>[o(n(d.obligacion_titulo),1)]),_:2},1024),t(a(m),null,{default:e(()=>[r("span",ia,n(d.descripcion||"-"),1)]),_:2},1024),t(a(m),null,{default:e(()=>{var I;return[r("span",ua,n(((I=d.usuario)==null?void 0:I.name)||"-"),1)]}),_:2},1024),t(a(m),null,{default:e(()=>[t(a(x),{class:V(D(d.estado))},{default:e(()=>[o(n(d.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(a(m),null,{default:e(()=>[o(n(i.formatDate(d.created_at)),1)]),_:2},1024),t(a(m),{class:"text-right"},{default:e(()=>[r("div",fa,[t(a(h),{variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:e(()=>[t(a(w),{href:`/admin/contratos/${l.contrato.id}/evidencias/${d.id}`},{default:e(()=>[t(a(F),{class:"h-4 w-4"}),s[9]||(s[9]=r("span",{class:"ml-1"},"Ver",-1))]),_:1},8,["href"])]),_:2},1024),d.archivo_url?(u(),p(a(h),{key:0,variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:e(()=>[r("a",{href:d.archivo_url,target:"_blank"},[t(a(N),{class:"h-4 w-4"}),s[10]||(s[10]=r("span",{class:"ml-1"},"Descargar",-1))],8,ma)]),_:2},1024)):y("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):i.mode==="simple"&&k.value?(u(),g("div",ca,[t(a(A),null,{default:e(()=>[t(a(G),null,{default:e(()=>[t(a(M),null,{default:e(()=>[o(n(i.cardTitle),1)]),_:1}),t(a(O),null,{default:e(()=>[o(n(i.cardDescription),1)]),_:1})]),_:1}),t(a(C),null,{default:e(()=>[t(a(T),null,{default:e(()=>[t(a(j),null,{default:e(()=>[t(a($),null,{default:e(()=>[t(a(f),null,{default:e(()=>[...s[11]||(s[11]=[o("Tipo",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[12]||(s[12]=[o("Descripción",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[13]||(s[13]=[o("Entregable",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[14]||(s[14]=[o("Usuario",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[15]||(s[15]=[o("Estado",-1)])]),_:1}),t(a(f),null,{default:e(()=>[...s[16]||(s[16]=[o("Fecha",-1)])]),_:1}),t(a(f),{class:"text-right"},{default:e(()=>[...s[17]||(s[17]=[o("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(a(B),null,{default:e(()=>[(u(!0),g(b,null,v(i.evidencias,l=>(u(),p(a($),{key:l.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:e(()=>[t(a(m),null,{default:e(()=>[t(a(x),{variant:"outline"},{default:e(()=>[o(n(l.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(a(m),null,{default:e(()=>[r("span",_a,n(l.descripcion||"-"),1)]),_:2},1024),t(a(m),null,{default:e(()=>[l.entregables&&l.entregables.length>0?(u(),g("div",ga,[(u(!0),g(b,null,v(l.entregables,d=>(u(),p(a(x),{key:d.id,variant:"secondary",class:"text-xs"},{default:e(()=>[o(n(d.nombre),1)]),_:2},1024))),128))])):(u(),g("span",pa,"-"))]),_:2},1024),t(a(m),null,{default:e(()=>{var d;return[r("span",xa,n(((d=l.usuario)==null?void 0:d.name)||"-"),1)]}),_:2},1024),t(a(m),null,{default:e(()=>[t(a(x),{class:V(D(l.estado))},{default:e(()=>[o(n(l.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(a(m),null,{default:e(()=>[o(n(i.formatDate(l.created_at)),1)]),_:2},1024),t(a(m),{class:"text-right"},{default:e(()=>[r("div",ya,[t(a(h),{variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:e(()=>{var d;return[t(a(w),{href:`/admin/contratos/${(d=i.contrato)==null?void 0:d.id}/evidencias/${l.id}`},{default:e(()=>[t(a(F),{class:"h-4 w-4"}),s[18]||(s[18]=r("span",{class:"ml-1"},"Ver",-1))]),_:1},8,["href"])]}),_:2},1024),l.archivo_url?(u(),p(a(h),{key:0,variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:e(()=>[r("a",{href:l.archivo_url,target:"_blank"},[t(a(N),{class:"h-4 w-4"}),s[19]||(s[19]=r("span",{class:"ml-1"},"Descargar",-1))],8,ba)]),_:2},1024)):y("",!0),i.modo==="admin"&&i.proyectoId||i.modo==="user"&&i.puedeGestionarEstado&&i.proyectoId?(u(),p(a(K),{key:1,"model-value":l.estado,"onUpdate:modelValue":d=>U(l,d)},{default:e(()=>[t(a(Q),{class:"h-8 w-32"},{default:e(()=>[t(a(W))]),_:1}),t(a(X),null,{default:e(()=>[t(a(E),{value:"pendiente"},{default:e(()=>[...s[20]||(s[20]=[r("span",{class:"text-yellow-600"},"Pendiente",-1)])]),_:1}),t(a(E),{value:"aprobada"},{default:e(()=>[...s[21]||(s[21]=[r("span",{class:"text-green-600"},"Aprobada",-1)])]),_:1}),t(a(E),{value:"rechazada"},{default:e(()=>[...s[22]||(s[22]=[r("span",{class:"text-red-600"},"Rechazada",-1)])]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):y("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})])):k.value?y("",!0):(u(),p(a(A),{key:2},{default:e(()=>[t(a(C),{class:"py-8"},{default:e(()=>[r("div",va,[t(a(Z),{class:"mx-auto h-12 w-12 text-gray-400"}),r("p",ha,n(i.mode==="grouped"?"No hay evidencias que coincidan con los filtros":"No hay evidencias asociadas"),1),r("p",$a,n(i.mode==="grouped"?"Intenta ajustar los criterios de búsqueda":"Las evidencias se cargan desde los contratos"),1)])]),_:1})]),_:1}))}});export{Ua as _};
