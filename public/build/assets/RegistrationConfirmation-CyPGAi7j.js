import{d as ce,k as c,c as fe,a as k,o as u,b as s,u as a,m as me,e as t,f as n,j as C,i as p,g as i,h as ve,t as y,F as L,r as J,q as R}from"./app-uqgoC9P3.js";import{_ as pe}from"./GuestLayout.vue_vue_type_script_setup_true_lang-Db3fTQ2m.js";import{_ as W,a as F,b as M,c as q}from"./CardTitle.vue_vue_type_script_setup_true_lang-DYxclH40.js";import{_ as K}from"./CardDescription.vue_vue_type_script_setup_true_lang-DtaWd4Ev.js";import{_ as E}from"./createLucideIcon-DYYZ8d8j.js";import{_ as ge}from"./Input.vue_vue_type_script_setup_true_lang-BUQ8h4mk.js";import{_ as H}from"./Label.vue_vue_type_script_setup_true_lang-C0Y6AGVd.js";import{_ as z,a as B}from"./index-C7SbJWMd.js";import{_ as Q,a as X,b as Y}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-BDTorNGy.js";import{t as g}from"./index-JMjM76-u.js";import{S as _e}from"./search-Mxulzn3L.js";import{C as Z}from"./circle-alert-D1W5s3bu.js";import{L as ee}from"./loader-circle-DT3sWtG_.js";import{U as ye}from"./user-check-BUld1wmi.js";import"./index-CIjidGQc.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BjaJLPMP.js";import"./index-3PJFboPx.js";import"./VisuallyHidden-D4UYEJiU.js";import"./VisuallyHiddenInput-DaG3v3Va.js";const we={class:"max-w-2xl mx-auto"},be={class:"bg-muted p-4 rounded-lg space-y-2"},xe={class:"flex flex-col gap-2 mt-3"},ke={key:0,class:"flex items-center gap-2"},Ce={class:"text-sm"},he={key:1,class:"flex items-center gap-2"},$e={class:"text-sm"},Ve={class:"flex gap-3"},Se={key:0,class:"space-y-2"},Ae={class:"flex gap-2 items-center"},Ee={key:1,class:"space-y-2"},Ue={class:"flex gap-2 items-center"},Te={key:3,class:"pt-4 border-t"},De={class:"space-y-3"},Ze=ce({__name:"RegistrationConfirmation",setup(Ne){const V=c(!1),S=c(""),m=c(null),x=c(null),d=c(""),h=c("search"),f=c({email:"",whatsapp:""}),A=c(!1),I=c(!1),U=c(0),P=c(null),T=c(!1),j=c(!1),w=c({email:!1,whatsapp:!1}),ae=async()=>{var r,e,l;if(!S.value){g.error("Por favor ingresa un número de documento");return}V.value=!0,d.value="",m.value=null;try{const o=await R.post("/confirmar-registro/buscar",{documento_identidad:S.value});o.data.success&&(m.value=o.data.user,x.value=o.data.verification_id,h.value="found",g.success("Usuario encontrado correctamente"))}catch(o){((r=o.response)==null?void 0:r.status)===404?d.value="No se encontró ningún usuario registrado con ese documento.":d.value=((l=(e=o.response)==null?void 0:e.data)==null?void 0:l.message)||"Error al buscar el usuario",g.error(d.value)}finally{V.value=!1}},se=async()=>{var r,e,l;if(x.value){T.value=!0;try{const o=await R.post("/confirmar-registro/enviar-verificacion",{verification_id:x.value});o.data.success&&(j.value=!0,w.value=o.data.channels,h.value="verifying",te(),g.success("Códigos de verificación enviados"),w.value.email&&w.value.whatsapp?g.info("Revisa tu email y WhatsApp"):w.value.email?g.info("Revisa tu email"):w.value.whatsapp&&g.info("Revisa tu WhatsApp"))}catch(o){((r=o.response)==null?void 0:r.status)===429?d.value="Has excedido el límite de intentos. Por favor, espera 1 hora.":d.value=((l=(e=o.response)==null?void 0:e.data)==null?void 0:l.message)||"Error al enviar códigos",g.error(d.value)}finally{T.value=!1}}},te=()=>{U.value=10,P.value=setInterval(()=>{U.value--,U.value<=0&&(clearInterval(P.value),le())},1e3)},le=async()=>{if(x.value)try{(await R.post("/confirmar-registro/check-timeout",{verification_id:x.value})).data.can_proceed&&(I.value=!0)}catch(r){console.error("Error checking timeout:",r)}},D=async r=>{var o,_,b,$;const e=r==="email"?f.value.email:f.value.whatsapp,l=Array.isArray(e)?e.join(""):String(e);if(!l||l.length!==6){g.error("Por favor ingresa un código de 6 dígitos");return}A.value=!0;try{const v=await R.post("/confirmar-registro/verificar-codigo",{verification_id:x.value,code:l,channel:r});v.data.success&&(g.success("Código verificado correctamente"),v.data.fully_verified||v.data.can_proceed?O():r==="email"?w.value.email=!1:w.value.whatsapp=!1)}catch(v){(_=(o=v.response)==null?void 0:o.data)!=null&&_.expired?(d.value="Los códigos han expirado. Por favor, solicita nuevos códigos.",h.value="found",j.value=!1):d.value=(($=(b=v.response)==null?void 0:b.data)==null?void 0:$.message)||"Código incorrecto",g.error(d.value)}finally{A.value=!1}},O=()=>{window.location.href=`/confirmar-registro/actualizar-datos?verification_id=${x.value}`},re=()=>{S.value="",m.value=null,x.value=null,h.value="search",j.value=!1,I.value=!1,d.value="",f.value={email:"",whatsapp:""},clearInterval(P.value)},G=fe(()=>U.value>0?`Si no recibes los códigos, podrás actualizar tus datos en ${U.value} segundos`:""),oe=r=>r?r.split(" ").map(l=>{if(l.length<=2)return l;const o=l.substring(0,2),_="*".repeat(l.length-2);return o+_}).join(" "):"",ie=r=>{if(!r)return"";const[e,l]=r.split("@");if(!e||!l)return r;const[o,_]=l.split(".");if(!o||!_)return r;let b="";if(e.length<=3)b=e;else{const v=e.substring(0,2),N=e.substring(e.length-1),de="*".repeat(e.length-3);b=v+de+N}const $=o[0]+"*".repeat(o.length-1);return`${b}@${$}.${_}`},ne=r=>{if(!r)return"";if(r.length<=6)return r;const e=r.substring(0,5),l=r.substring(r.length-1),o="*".repeat(r.length-6);return e+o+l},ue=r=>{if(!r)return"";const e=new Date(r),l={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return e.toLocaleDateString("es-ES",l)};return(r,e)=>(u(),k(L,null,[s(a(me),{title:"Confirmar Registro"}),s(pe,{title:"Confirmación de Registro",description:"Verifica si estás registrado en el sistema y actualiza tus datos de contacto"},{default:t(()=>[n("div",we,[h.value==="search"?(u(),C(a(W),{key:0,class:"shadow-lg"},{default:t(()=>[s(a(F),null,{default:t(()=>[s(a(M),{class:"flex items-center gap-2"},{default:t(()=>[s(a(_e),{class:"w-5 h-5"}),e[7]||(e[7]=i(" Buscar Registro ",-1))]),_:1}),s(a(K),null,{default:t(()=>[...e[8]||(e[8]=[i(" Ingresa tu número de documento para verificar si estás registrado ",-1)])]),_:1})]),_:1}),s(a(q),null,{default:t(()=>[n("form",{onSubmit:ve(ae,["prevent"]),class:"space-y-4"},[n("div",null,[s(a(H),{for:"documento"},{default:t(()=>[...e[9]||(e[9]=[i("Número de Documento",-1)])]),_:1}),s(a(ge),{id:"documento",modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=l=>S.value=l),type:"text",placeholder:"Ej: 1234567890",disabled:V.value,class:"mt-1",autofocus:""},null,8,["modelValue","disabled"])]),d.value?(u(),C(a(z),{key:0,variant:"destructive"},{default:t(()=>[s(a(Z),{class:"h-4 w-4"}),s(a(B),null,{default:t(()=>[i(y(d.value),1)]),_:1})]),_:1})):p("",!0),s(a(E),{type:"submit",disabled:V.value||!S.value,class:"w-full"},{default:t(()=>[V.value?(u(),C(a(ee),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):p("",!0),i(" "+y(V.value?"Buscando...":"Buscar"),1)]),_:1},8,["disabled"])],32)]),_:1})]),_:1})):h.value==="found"?(u(),C(a(W),{key:1,class:"shadow-lg"},{default:t(()=>[s(a(F),null,{default:t(()=>[s(a(M),{class:"flex items-center gap-2"},{default:t(()=>[s(a(ye),{class:"w-5 h-5 text-green-600"}),e[10]||(e[10]=i(" Usuario Encontrado ",-1))]),_:1})]),_:1}),s(a(q),{class:"space-y-4"},{default:t(()=>{var l,o,_,b,$,v,N;return[n("div",be,[n("p",null,[e[11]||(e[11]=n("strong",null,"Nombre:",-1)),i(" "+y(oe(((l=m.value)==null?void 0:l.name)||"")),1)]),n("p",null,[e[12]||(e[12]=n("strong",null,"Documento:",-1)),i(" "+y((o=m.value)==null?void 0:o.documento_identidad),1)]),n("p",null,[e[13]||(e[13]=n("strong",null,"Registrado en:",-1)),i(" "+y(ue(((_=m.value)==null?void 0:_.created_at)||"")),1)]),n("div",xe,[(b=m.value)!=null&&b.has_email&&(($=m.value)!=null&&$.email)?(u(),k("div",ke,[e[15]||(e[15]=n("span",{class:"text-sm text-green-600"},"✓",-1)),n("span",Ce,[e[14]||(e[14]=n("strong",null,"Email:",-1)),i(" "+y(ie(m.value.email)),1)])])):p("",!0),(v=m.value)!=null&&v.has_phone&&((N=m.value)!=null&&N.telefono)?(u(),k("div",he,[e[17]||(e[17]=n("span",{class:"text-sm text-green-600"},"✓",-1)),n("span",$e,[e[16]||(e[16]=n("strong",null,"Teléfono:",-1)),i(" "+y(ne(m.value.telefono)),1)])])):p("",!0)])]),s(a(z),null,{default:t(()=>[s(a(B),{class:"text-foreground"},{default:t(()=>[...e[18]||(e[18]=[i(" ¿Tus datos son correctos? Puedes validarlos a continuación y actualizarlos si deseas. Te enviaremos códigos de verificación a tu email y/o teléfono registrados (via WhatsApp). ",-1)])]),_:1})]),_:1}),n("div",Ve,[s(a(E),{onClick:se,disabled:T.value,class:"flex-1"},{default:t(()=>[T.value?(u(),C(a(ee),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):p("",!0),i(" "+y(T.value?"Enviando...":"Validar Datos"),1)]),_:1},8,["disabled"]),s(a(E),{onClick:re,variant:"outline"},{default:t(()=>[...e[19]||(e[19]=[i(" Buscar otro ",-1)])]),_:1})])]}),_:1})]),_:1})):h.value==="verifying"?(u(),C(a(W),{key:2,class:"shadow-lg"},{default:t(()=>[s(a(F),null,{default:t(()=>[s(a(M),null,{default:t(()=>[...e[20]||(e[20]=[i("Verificación de Códigos",-1)])]),_:1}),s(a(K),null,{default:t(()=>[...e[21]||(e[21]=[i(" Ingresa los códigos que recibiste ",-1)])]),_:1})]),_:1}),s(a(q),{class:"space-y-4"},{default:t(()=>[w.value.email?(u(),k("div",Se,[s(a(H),null,{default:t(()=>[...e[22]||(e[22]=[i("Código de Email",-1)])]),_:1}),n("div",Ae,[s(a(Q),{modelValue:f.value.email,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value.email=l),disabled:A.value,placeholder:"○",onComplete:e[2]||(e[2]=()=>D("email"))},{default:t(()=>[s(a(X),null,{default:t(()=>[(u(),k(L,null,J(6,(l,o)=>s(a(Y),{key:o,index:o},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue","disabled"]),s(a(E),{onClick:e[3]||(e[3]=l=>D("email")),disabled:A.value||(Array.isArray(f.value.email)?f.value.email.join("").length!==6:f.value.email.length!==6),size:"sm"},{default:t(()=>[...e[23]||(e[23]=[i(" Verificar ",-1)])]),_:1},8,["disabled"])])])):p("",!0),w.value.whatsapp?(u(),k("div",Ee,[s(a(H),null,{default:t(()=>[...e[24]||(e[24]=[i("Código de WhatsApp",-1)])]),_:1}),n("div",Ue,[s(a(Q),{modelValue:f.value.whatsapp,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value.whatsapp=l),disabled:A.value,placeholder:"○",onComplete:e[5]||(e[5]=()=>D("whatsapp"))},{default:t(()=>[s(a(X),null,{default:t(()=>[(u(),k(L,null,J(6,(l,o)=>s(a(Y),{key:o,index:o},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue","disabled"]),s(a(E),{onClick:e[6]||(e[6]=l=>D("whatsapp")),disabled:A.value||(Array.isArray(f.value.whatsapp)?f.value.whatsapp.join("").length!==6:f.value.whatsapp.length!==6),size:"sm"},{default:t(()=>[...e[25]||(e[25]=[i(" Verificar ",-1)])]),_:1},8,["disabled"])])])):p("",!0),G.value?(u(),C(a(z),{key:2,class:"border-green-200 bg-green-50"},{default:t(()=>[s(a(B),{class:"text-green-700"},{default:t(()=>[i(y(G.value),1)]),_:1})]),_:1})):p("",!0),I.value?(u(),k("div",Te,[n("div",De,[e[27]||(e[27]=n("p",{class:"text-sm text-muted-foreground"}," Si no recibiste los códigos, puedes esperar un poco o bien puedes actualizar tus datos: ",-1)),s(a(E),{onClick:O,variant:"outline",class:"w-full"},{default:t(()=>[...e[26]||(e[26]=[i(" ¿Deseas actualizar datos? ",-1)])]),_:1})])])):p("",!0),d.value?(u(),C(a(z),{key:4,variant:"destructive"},{default:t(()=>[s(a(Z),{class:"h-4 w-4"}),s(a(B),null,{default:t(()=>[i(y(d.value),1)]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})):p("",!0)])]),_:1})],64))}});export{Ze as default};
