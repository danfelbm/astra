import{d as ze,u as qe,r as q,c as U,i as f,b as v,j as b,e as s,g as n,f as e,w as l,h as d,t as u,n as R,F as A,k as D,l as Ae,s as De,m as c}from"./app-LzJk4v1F.js";import{a as h,b as y,c as E,_ as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-BKQbIxIv.js";import{_ as $}from"./CardDescription.vue_vue_type_script_setup_true_lang-DXuzCBwa.js";import{_ as C}from"./createLucideIcon-BKFZEAMr.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-CxbJt8QJ.js";import{_ as x}from"./Label.vue_vue_type_script_setup_true_lang-CXwvin-h.js";import{_ as te}from"./Textarea.vue_vue_type_script_setup_true_lang-D1WrVS2P.js";import{_ as re,a as ne,b as ie,c as de,d as ue}from"./SelectValue.vue_vue_type_script_setup_true_lang-CPzRqdqp.js";import{_ as ce}from"./index-BTqd9uu5.js";import{_ as me,a as fe,b as pe}from"./index-CoVIatvh.js";import{_ as be,a as _e}from"./index-D3HZ9SK5.js";import{_ as ge}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-C0q9qpd1.js";import{_ as Pe}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-C3k6_nWL.js";import{E as je}from"./EtiquetaSelector-6oNPhbJN.js";import{u as Fe}from"./useToast-CnKdh9IN.js";import{C as Ne}from"./circle-check-big-DtgxHwju.js";import{X as ve}from"./x-CoSVx2Oi.js";import{U as xe}from"./user-plus-pxkVxjBR.js";import{T as Re}from"./tag-BEjWcfQL.js";import{C as Be}from"./circle-alert-D0T-vetO.js";import{A as Ie}from"./arrow-left-Cu0SjnUT.js";import{S as Te}from"./save-DbHtPpj3.js";import{F as Le}from"./flag-ltebVAD8.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const He={class:"space-y-6"},Oe={class:"grid gap-4 md:grid-cols-3"},Xe={class:"font-medium"},Ge={class:"font-medium"},Je={key:0,class:"text-sm text-red-600 mt-1"},Ke={key:0,class:"text-sm text-red-600 mt-1"},Qe={class:"grid gap-4 md:grid-cols-2"},We={class:"flex items-center gap-2"},Ye={class:"grid gap-4 md:grid-cols-2"},Ze={key:0,class:"text-sm text-red-600 mt-1"},ea={key:0,class:"text-sm text-red-600 mt-1"},aa={class:"space-y-2"},sa={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},la={class:"flex items-center gap-2"},oa={class:"font-medium"},ta={class:"text-sm text-muted-foreground"},ra={key:0,class:"text-sm text-red-600 mt-1"},na={class:"flex items-center justify-between mb-2"},ia={key:0,class:"space-y-2 mt-3"},da={class:"flex items-center gap-2"},ua={class:"font-medium"},ca={class:"text-sm text-muted-foreground"},ma={key:1,class:"text-sm text-muted-foreground mt-3"},fa={class:"list-disc pl-4"},pa={class:"flex justify-end gap-2"},ba=ze({__name:"EntregableForm",props:{mode:{},proyecto:{},hito:{},entregable:{},usuarios:{},usuariosAsignados:{default:()=>[]},camposPersonalizados:{},valoresCamposPersonalizados:{default:()=>({})},categorias:{},estados:{},prioridades:{},siguienteOrden:{default:1},submitUrl:{},cancelUrl:{},searchUsersEndpoint:{}},emits:["success","error"],setup(m,{emit:he}){var T,L,M,H,O,X,G,J,K,Q,W,Y,Z,ee;const i=m,w=he,{toast:S}=Fe(),o=qe({nombre:((T=i.entregable)==null?void 0:T.nombre)||"",descripcion:((L=i.entregable)==null?void 0:L.descripcion)||"",fecha_inicio:((M=i.entregable)==null?void 0:M.fecha_inicio)||"",fecha_fin:((H=i.entregable)==null?void 0:H.fecha_fin)||"",estado:((O=i.entregable)==null?void 0:O.estado)||"pendiente",prioridad:((X=i.entregable)==null?void 0:X.prioridad)||"media",responsable_id:((G=i.entregable)==null?void 0:G.responsable_id)||null,usuarios_asignados:i.usuariosAsignados||[],campos_personalizados:i.valoresCamposPersonalizados||{},etiquetas:((K=(J=i.entregable)==null?void 0:J.etiquetas)==null?void 0:K.map(r=>r.id))??[],orden:((Q=i.entregable)==null?void 0:Q.orden)||i.siguienteOrden||1,notas:""}),P=q(!1),j=q(!1),p=q(null),_=q(new Map);if(i.usuarios.forEach(r=>_.value.set(r.id,r)),(W=i.entregable)!=null&&W.responsable_id){const r=i.usuarios.find(a=>{var t;return a.id===((t=i.entregable)==null?void 0:t.responsable_id)});if(r)p.value=r;else{const a=i.entregable;p.value={id:i.entregable.responsable_id,name:((Y=a.responsable)==null?void 0:Y.name)||`Usuario #${i.entregable.responsable_id}`,email:((Z=a.responsable)==null?void 0:Z.email)||""},_.value.set(i.entregable.responsable_id,p.value)}}(ee=i.usuariosAsignados)==null||ee.forEach(r=>{var a,t,g;_.value.has(r.user_id)||_.value.set(r.user_id,{id:((a=r.user)==null?void 0:a.id)||r.user_id,name:((t=r.user)==null?void 0:t.name)||`Usuario #${r.user_id}`,email:((g=r.user)==null?void 0:g.email)||""})});const ye=U(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"colaborador",label:"Colaborador"},{value:"revisor",label:"Revisor"}],value:"colaborador",required:!0}]),Ee=U(()=>{const r=o.usuarios_asignados.map(a=>a.user_id);return o.responsable_id&&r.push(o.responsable_id),r}),Ve=r=>{if(r.userIds.length>0){const a=r.userIds[0];o.responsable_id=a,_.value.has(a)?p.value=_.value.get(a)||null:(p.value={id:a,name:`Usuario seleccionado (ID: ${a})`,email:"Se actualizará al guardar"},_.value.set(a,p.value))}},Ce=r=>{r.userIds.forEach(a=>{o.usuarios_asignados.some(g=>g.user_id===a)||(o.usuarios_asignados.push({user_id:a,rol:r.extraData.rol||"colaborador"}),_.value.has(a)||_.value.set(a,{id:a,name:`Usuario #${a}`,email:"Pendiente de actualizar"}))})},ke=()=>{o.responsable_id=null,p.value=null},Ue=r=>{const a=o.usuarios_asignados.findIndex(t=>t.user_id===r);a>-1&&o.usuarios_asignados.splice(a,1)},k=r=>_.value.has(r)?_.value.get(r):i.usuarios.find(a=>a.id===r),$e=()=>{const r={...o.data(),usuarios:o.usuarios_asignados};delete r.usuarios_asignados,i.mode==="create"?o.transform(()=>r).post(i.submitUrl,{preserveScroll:!0,onSuccess:()=>{S.success("Entregable creado exitosamente"),w("success","Entregable creado exitosamente")},onError:()=>{S.error("Error al crear el entregable"),w("error","Error al crear el entregable")}}):o.transform(()=>r).put(i.submitUrl,{preserveScroll:!0,onSuccess:()=>{S.success("Entregable actualizado exitosamente"),w("success","Entregable actualizado exitosamente")},onError:()=>{S.error("Error al actualizar el entregable"),w("error","Error al actualizar el entregable")}})},we=()=>{De.get(i.cancelUrl)},F=U(()=>{const r=[];return o.nombre||r.push("El nombre es requerido"),o.nombre.length>255&&r.push("El nombre no puede exceder 255 caracteres"),o.fecha_inicio&&o.fecha_fin&&new Date(o.fecha_inicio)>new Date(o.fecha_fin)&&r.push("La fecha de inicio no puede ser posterior a la fecha de fin"),o.responsable_id||r.push("Debe asignar un responsable"),r}),Se=U(()=>F.value.length===0&&!o.processing),I=U(()=>{var r,a,t;if(i.mode==="edit"&&((r=i.entregable)==null?void 0:r.estado)==="completado"&&((a=i.entregable)!=null&&a.completado_at)){const g=new Date(i.entregable.completado_at).toLocaleDateString("es-ES"),z=((t=i.entregable.completado_por)==null?void 0:t.name)||"Usuario desconocido";return`Completado el ${g} por ${z}`}return null});return(r,a)=>(c(),f("div",He,[I.value?(c(),v(e(be),{key:0,class:"bg-green-50 dark:bg-green-900/20 border-green-200"},{default:l(()=>[s(e(Ne),{class:"h-4 w-4 text-green-600"}),s(e(_e),{class:"text-green-800 dark:text-green-200"},{default:l(()=>[d(u(I.value),1)]),_:1})]),_:1})):b("",!0),s(e(V),null,{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(y),{class:"text-base"},{default:l(()=>[...a[13]||(a[13]=[d("Información del Hito",-1)])]),_:1})]),_:1}),s(e(E),null,{default:l(()=>[n("div",Oe,[n("div",null,[a[14]||(a[14]=n("p",{class:"text-sm text-muted-foreground"},"Hito",-1)),n("p",Xe,u(m.hito.nombre),1)]),n("div",null,[a[15]||(a[15]=n("p",{class:"text-sm text-muted-foreground"},"Estado",-1)),s(e(ce),null,{default:l(()=>[d(u(m.hito.estado_label||m.hito.estado),1)]),_:1})]),n("div",null,[a[16]||(a[16]=n("p",{class:"text-sm text-muted-foreground"},"Progreso",-1)),n("p",Ge,u(m.hito.porcentaje_completado||0)+"%",1)])])]),_:1})]),_:1}),n("form",{onSubmit:Ae($e,["prevent"]),class:"space-y-4"},[s(e(V),null,{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(y),null,{default:l(()=>[...a[17]||(a[17]=[d("Información Básica",-1)])]),_:1}),s(e($),null,{default:l(()=>[...a[18]||(a[18]=[d("Datos principales del entregable",-1)])]),_:1})]),_:1}),s(e(E),{class:"space-y-4"},{default:l(()=>[n("div",null,[s(e(x),{for:"nombre",class:"required"},{default:l(()=>[...a[19]||(a[19]=[d("Nombre del entregable",-1)])]),_:1}),s(e(B),{id:"nombre",modelValue:e(o).nombre,"onUpdate:modelValue":a[0]||(a[0]=t=>e(o).nombre=t),placeholder:"Ej: Documento de diseño técnico",class:R({"border-red-500":e(o).errors.nombre})},null,8,["modelValue","class"]),e(o).errors.nombre?(c(),f("p",Je,u(e(o).errors.nombre),1)):b("",!0)]),n("div",null,[s(e(x),{for:"descripcion"},{default:l(()=>[...a[20]||(a[20]=[d("Descripción",-1)])]),_:1}),s(e(te),{id:"descripcion",modelValue:e(o).descripcion,"onUpdate:modelValue":a[1]||(a[1]=t=>e(o).descripcion=t),placeholder:"Describe el entregable y sus objetivos...",rows:"4",class:R({"border-red-500":e(o).errors.descripcion})},null,8,["modelValue","class"]),e(o).errors.descripcion?(c(),f("p",Ke,u(e(o).errors.descripcion),1)):b("",!0)]),n("div",Qe,[n("div",null,[s(e(x),{for:"estado"},{default:l(()=>[d(u(m.mode==="create"?"Estado inicial":"Estado"),1)]),_:1}),s(e(re),{modelValue:e(o).estado,"onUpdate:modelValue":a[2]||(a[2]=t=>e(o).estado=t)},{default:l(()=>[s(e(ne),null,{default:l(()=>[s(e(ie),{placeholder:"Seleccionar estado"})]),_:1}),s(e(de),null,{default:l(()=>[(c(!0),f(A,null,D(m.estados,t=>(c(),v(e(ue),{key:t.value,value:t.value},{default:l(()=>[d(u(t.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),n("div",null,[s(e(x),{for:"prioridad"},{default:l(()=>[...a[21]||(a[21]=[d("Prioridad",-1)])]),_:1}),s(e(re),{modelValue:e(o).prioridad,"onUpdate:modelValue":a[3]||(a[3]=t=>e(o).prioridad=t)},{default:l(()=>[s(e(ne),null,{default:l(()=>[s(e(ie),{placeholder:"Seleccionar prioridad"})]),_:1}),s(e(de),null,{default:l(()=>[(c(!0),f(A,null,D(m.prioridades,t=>(c(),v(e(ue),{key:t.value,value:t.value},{default:l(()=>[n("div",We,[s(e(Le),{class:R(["h-4 w-4",{"text-blue-500":t.value==="baja","text-yellow-500":t.value==="media","text-red-500":t.value==="alta"}])},null,8,["class"]),d(" "+u(t.label),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),s(e(V),null,{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(y),null,{default:l(()=>[...a[22]||(a[22]=[d("Fechas",-1)])]),_:1}),s(e($),null,{default:l(()=>[...a[23]||(a[23]=[d("Define el período de ejecución del entregable",-1)])]),_:1})]),_:1}),s(e(E),null,{default:l(()=>[n("div",Ye,[n("div",null,[s(e(x),{for:"fecha_inicio"},{default:l(()=>[...a[24]||(a[24]=[d("Fecha de inicio",-1)])]),_:1}),s(e(B),{id:"fecha_inicio",modelValue:e(o).fecha_inicio,"onUpdate:modelValue":a[4]||(a[4]=t=>e(o).fecha_inicio=t),type:"date",disabled:e(o).processing},null,8,["modelValue","disabled"]),e(o).errors.fecha_inicio?(c(),f("p",Ze,u(e(o).errors.fecha_inicio),1)):b("",!0)]),n("div",null,[s(e(x),{for:"fecha_fin"},{default:l(()=>[...a[25]||(a[25]=[d("Fecha de fin",-1)])]),_:1}),s(e(B),{id:"fecha_fin",modelValue:e(o).fecha_fin,"onUpdate:modelValue":a[5]||(a[5]=t=>e(o).fecha_fin=t),type:"date",disabled:e(o).processing},null,8,["modelValue","disabled"]),e(o).errors.fecha_fin?(c(),f("p",ea,u(e(o).errors.fecha_fin),1)):b("",!0)])])]),_:1})]),_:1}),s(e(V),null,{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(y),null,{default:l(()=>[...a[26]||(a[26]=[d("Asignación",-1)])]),_:1}),s(e($),null,{default:l(()=>[...a[27]||(a[27]=[d("Asigna un responsable y colaboradores al entregable",-1)])]),_:1})]),_:1}),s(e(E),{class:"space-y-4"},{default:l(()=>[n("div",null,[s(e(x),{for:"responsable",class:"required"},{default:l(()=>[...a[28]||(a[28]=[d("Responsable principal",-1)])]),_:1}),n("div",aa,[p.value?(c(),f("div",sa,[n("div",la,[s(e(me),{class:"h-8 w-8"},{default:l(()=>[p.value.avatar?(c(),v(e(fe),{key:0,src:p.value.avatar},null,8,["src"])):b("",!0),s(e(pe),null,{default:l(()=>[d(u(p.value.name.substring(0,2).toUpperCase()),1)]),_:1})]),_:1}),n("div",null,[n("p",oa,u(p.value.name),1),n("p",ta,u(p.value.email),1)])]),s(e(C),{type:"button",variant:"ghost",size:"sm",onClick:ke},{default:l(()=>[s(e(ve),{class:"h-4 w-4"})]),_:1})])):b("",!0),s(e(C),{type:"button",variant:"outline",onClick:a[6]||(a[6]=t=>P.value=!0),class:"w-full"},{default:l(()=>[s(e(xe),{class:"h-4 w-4 mr-2"}),d(" "+u(p.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(o).errors.responsable_id?(c(),f("p",ra,u(e(o).errors.responsable_id),1)):b("",!0)]),n("div",null,[n("div",na,[s(e(x),null,{default:l(()=>[...a[29]||(a[29]=[d("Colaboradores adicionales",-1)])]),_:1}),s(e(C),{type:"button",variant:"outline",size:"sm",onClick:a[7]||(a[7]=t=>j.value=!0)},{default:l(()=>[s(e(xe),{class:"mr-2 h-4 w-4"}),a[30]||(a[30]=d(" Agregar colaboradores ",-1))]),_:1})]),e(o).usuarios_asignados.length>0?(c(),f("div",ia,[(c(!0),f(A,null,D(e(o).usuarios_asignados,t=>{var g,z;return c(),f("div",{key:t.user_id,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},[n("div",da,[s(e(me),{class:"h-8 w-8"},{default:l(()=>{var N,ae;return[(N=k(t.user_id))!=null&&N.avatar?(c(),v(e(fe),{key:0,src:(ae=k(t.user_id))==null?void 0:ae.avatar},null,8,["src"])):b("",!0),s(e(pe),null,{default:l(()=>{var se,le,oe;return[d(u(((oe=(le=(se=k(t.user_id))==null?void 0:se.name)==null?void 0:le.substring(0,2))==null?void 0:oe.toUpperCase())||"US"),1)]}),_:2},1024)]}),_:2},1024),n("div",null,[n("p",ua,u(((g=k(t.user_id))==null?void 0:g.name)||`Usuario #${t.user_id}`),1),n("p",ca,u(((z=k(t.user_id))==null?void 0:z.email)||""),1)]),s(e(ce),{variant:"outline"},{default:l(()=>[d(u(t.rol),1)]),_:2},1024)]),s(e(C),{type:"button",variant:"ghost",size:"sm",onClick:N=>Ue(t.user_id)},{default:l(()=>[s(e(ve),{class:"h-4 w-4"})]),_:1},8,["onClick"])])}),128))])):(c(),f("div",ma,"No hay colaboradores asignados"))])]),_:1})]),_:1}),s(e(V),null,{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(y),null,{default:l(()=>[d(u(m.mode==="create"?"Notas adicionales":"Notas de actualización"),1)]),_:1}),s(e($),null,{default:l(()=>[d(u(m.mode==="create"?"Información adicional o consideraciones especiales":"Describe los cambios realizados (opcional)"),1)]),_:1})]),_:1}),s(e(E),null,{default:l(()=>[s(e(te),{modelValue:e(o).notas,"onUpdate:modelValue":a[8]||(a[8]=t=>e(o).notas=t),placeholder:m.mode==="create"?"Notas adicionales sobre el entregable...":"Notas sobre los cambios realizados...",rows:"4"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),m.camposPersonalizados&&m.camposPersonalizados.length>0?(c(),v(Pe,{key:0,campos:m.camposPersonalizados,valores:e(o).campos_personalizados,errors:e(o).errors,onUpdate:a[9]||(a[9]=t=>e(o).campos_personalizados=t)},null,8,["campos","valores","errors"])):b("",!0),m.categorias&&m.categorias.length>0?(c(),v(e(V),{key:1},{default:l(()=>[s(e(h),null,{default:l(()=>[s(e(y),{class:"flex items-center gap-2"},{default:l(()=>[s(e(Re),{class:"h-5 w-5"}),a[31]||(a[31]=d(" Etiquetas ",-1))]),_:1}),s(e($),null,{default:l(()=>[...a[32]||(a[32]=[d("Asigna etiquetas para categorizar y organizar este entregable",-1)])]),_:1})]),_:1}),s(e(E),null,{default:l(()=>[s(je,{modelValue:e(o).etiquetas,"onUpdate:modelValue":a[10]||(a[10]=t=>e(o).etiquetas=t),categorias:m.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas para el entregable...",description:"Puedes asignar hasta 10 etiquetas"},null,8,["modelValue","categorias"])]),_:1})]),_:1})):b("",!0),F.value.length>0?(c(),v(e(be),{key:2,variant:"destructive"},{default:l(()=>[s(e(Be),{class:"h-4 w-4"}),s(e(_e),null,{default:l(()=>[n("ul",fa,[(c(!0),f(A,null,D(F.value,t=>(c(),f("li",{key:t},u(t),1))),128))])]),_:1})]),_:1})):b("",!0),n("div",pa,[s(e(C),{type:"button",variant:"outline",onClick:we},{default:l(()=>[s(e(Ie),{class:"mr-2 h-4 w-4"}),a[33]||(a[33]=d(" Cancelar ",-1))]),_:1}),s(e(C),{type:"submit",disabled:!Se.value},{default:l(()=>[s(e(Te),{class:"mr-2 h-4 w-4"}),d(" "+u(e(o).processing?m.mode==="create"?"Creando...":"Actualizando...":m.mode==="create"?"Crear Entregable":"Actualizar Entregable"),1)]),_:1},8,["disabled"])])],32),s(ge,{modelValue:P.value,"onUpdate:modelValue":a[11]||(a[11]=t=>P.value=t),title:"Seleccionar Responsable Principal",description:"Selecciona el usuario que será el responsable principal del entregable","search-endpoint":m.searchUsersEndpoint,"excluded-ids":e(o).responsable_id?[e(o).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:Ve},null,8,["modelValue","search-endpoint","excluded-ids"]),s(ge,{modelValue:j.value,"onUpdate:modelValue":a[12]||(a[12]=t=>j.value=t),title:"Agregar Colaboradores",description:"Selecciona los usuarios que colaborarán en este entregable","search-endpoint":m.searchUsersEndpoint,"excluded-ids":Ee.value,"extra-fields":ye.value,"submit-button-text":"Agregar Colaboradores","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:Ce},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"])]))}}),Ia=Me(ba,[["__scopeId","data-v-9c699fe9"]]);export{Ia as E};
