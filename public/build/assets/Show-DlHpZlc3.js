import{d as ae,c as b,r as F,p as le,s as oe,i as g,e as a,f as t,q as se,w as l,g as o,t as u,b as h,j as _,v as j,h as r,m as c,n as N,F as I,k as T,y as ie}from"./app-B8akDo5X.js";import{_ as ne}from"./AdminLayout.vue_vue_type_script_setup_true_lang-B4t-alUY.js";import{_ as y,a as x,c as $,b as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-VAG0deZE.js";import{_ as k}from"./CardDescription.vue_vue_type_script_setup_true_lang-BOSUkiNt.js";import{_ as U}from"./createLucideIcon-CRQ99TGv.js";import{_ as C}from"./index--CWYxasj.js";import{_ as re}from"./Progress.vue_vue_type_script_setup_true_lang-DVLxzFAk.js";import{_ as q,a as B,b as H}from"./index-CfRa1x7f.js";import{_ as de,a as ue,b as E,c as V}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-C4vCaUdB.js";import{_ as ce,a as me}from"./index-CP2JwLSi.js";import{A as fe,_ as pe,a as ve}from"./EvidenciasTable.vue_vue_type_script_setup_true_lang-BHK0Jk95.js";import{_ as be,a as ge}from"./ActivityLog.vue_vue_type_script_setup_true_lang-DFDBp8ix.js";import{_ as _e}from"./ComentariosPanel.vue_vue_type_script_setup_true_lang-mTq_wc5z.js";import{_ as he}from"./CamposPersonalizadosDisplay.vue_vue_type_script_setup_true_lang-DBxAY9Qk.js";import{d as ye}from"./differenceInDays-CDkc-BiT.js";import{A as xe}from"./arrow-left-DstM9ZNx.js";import{S as $e}from"./square-pen-DKhMDSNk.js";import{F as we}from"./flag-Ty-_EcxD.js";import{C as ke}from"./clock-DZGwd0ij.js";import{F as Ce}from"./file-text-ZwoXWfv1.js";import{U as Ee}from"./users-BR6J8NIl.js";import{I as Ve}from"./image-DLVnda-a.js";import{C as R}from"./calendar-B0PAIiz9.js";import{C as Pe}from"./circle-alert-CTs4Wwq6.js";import{a as Ae}from"./target-FURL_xmb.js";import{f as L,e as O}from"./es-BDPlFIsO.js";import{p as G}from"./parseISO-DFjB8F03.js";import"./useFlashMessages-Br_6a2wW.js";import"./index-0bs2A4xi.js";import"./floating-ui.vue-BHXfgLCE.js";import"./x-CHbquDlp.js";import"./Input.vue_vue_type_script_setup_true_lang-BT--LyGg.js";import"./index-CiK5heoQ.js";import"./shield-CrQoXXPk.js";import"./user-BADaMnv3.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bdm0k4cQ.js";import"./chevron-right-D4nKoAMA.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BpTrTnbW.js";import"./VisuallyHidden-BYTEKKJx.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-ygs_JmN5.js";import"./check-j4eDw8Me.js";import"./Label.vue_vue_type_script_setup_true_lang-Cl05gzIl.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Cz__yGA_.js";import"./index-MXz-Q0Yh.js";import"./map-pin-CfZE2EC5.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-czHI3s6d.js";import"./chevrons-up-down-DcVL1VS9.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-B9UspFrS.js";import"./folder-BsiNk3bO.js";import"./vote-ELGWwUFj.js";import"./folder-open-CcJP8wow.js";import"./send-_unJGDxP.js";import"./briefcase-DBMZCMMU.js";import"./megaphone-B00Vm1oZ.js";import"./user-check-CcWs0pjr.js";import"./clipboard-list-E_of-12V.js";import"./mail-D13J0FZB.js";import"./message-square-BEkHJV0a.js";import"./external-link-Dl806rea.js";import"./panel-left-BPqCDKay.js";import"./index-B2MM9Imq.js";import"./RovingFocusItem-BcY6AMnB.js";import"./utils-CLO8z8sK.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-D-lx7f0c.js";import"./useArrowNavigation-B5rxJs06.js";import"./eye-CIjoxe5T.js";import"./download-Cn9bpWz0.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-agqC_9dt.js";import"./filter-C3osBROY.js";import"./arrow-right-D7WuAVt8.js";import"./Skeleton.vue_vue_type_script_setup_true_lang-DVHFajMS.js";import"./RichTextEditor-BpkcF-Tl.js";import"./italic-jBx5qyIY.js";import"./list-EsqyouL5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FileUploadField.vue_vue_type_script_setup_true_lang-C4jFDTX2.js";import"./useFileUpload-4eNO5_L3.js";import"./upload-D3ZfuIPL.js";import"./file-CDHeCd9X.js";import"./paperclip-RRVF0AeA.js";import"./loader-circle-NK4mQeBk.js";import"./ellipsis-B_qN98CF.js";import"./trash-2-Cmq-C3uy.js";import"./chevron-left-B9Kk93m3.js";const De={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ze={class:"flex items-center justify-between"},Fe={class:"text-3xl font-bold"},Ie={class:"text-muted-foreground mt-2"},Me={class:"flex gap-2"},Se={class:"grid gap-4 md:grid-cols-4"},je={class:"flex items-center gap-2"},Ne={class:"font-medium capitalize"},Te={class:"space-y-2"},Ue={class:"flex justify-between"},qe={class:"text-2xl font-bold"},Be={key:0,class:"flex items-center gap-2"},He={class:"font-medium"},Re={key:1,class:"text-muted-foreground"},Le={key:0},Oe={class:"text-sm"},Ge={class:"grid gap-4 md:grid-cols-2"},Je={class:"flex items-center gap-2"},Ke={class:"flex items-center gap-2"},Qe={key:1},We={class:"border-t pt-4"},Xe={class:"space-y-3 text-sm"},Ye={class:"block"},Ze={class:"block"},et={class:"block"},tt={class:"flex items-center gap-2"},at={class:"flex flex-wrap gap-2"},lt={key:0,class:"flex items-center gap-3"},ot={class:"font-medium"},st={class:"text-sm text-muted-foreground"},it={key:1,class:"text-muted-foreground"},nt={key:0,class:"space-y-3"},rt={class:"flex items-center gap-3"},dt={class:"font-medium"},ut={class:"text-sm text-muted-foreground"},ct={key:1,class:"text-muted-foreground"},Ra=ae({__name:"Show",props:{proyecto:{},hito:{},entregable:{},usuariosAsignados:{},actividades:{},usuariosActividades:{},camposPersonalizados:{},valoresCamposPersonalizados:{},canEdit:{type:Boolean},canDelete:{type:Boolean}},setup(i){const d=i,A=b(()=>d.usuariosAsignados||[]),M=b(()=>d.actividades||[]),J=["detalles","equipo","evidencias","comentarios","actividad"],D=F((()=>{const e=new URLSearchParams(window.location.search).get("tab");return e&&J.includes(e)?e:"detalles"})());le(D,s=>{const e=`/admin/proyectos/${d.proyecto.id}/hitos/${d.hito.id}/entregables/${d.entregable.id}?tab=${s}`;oe.get(e,{},{preserveState:!0,preserveScroll:!0,replace:!0,only:[]})});const f=F({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),v=F({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),K=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:d.proyecto.nombre,href:`/admin/proyectos/${d.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${d.proyecto.id}/hitos`},{title:d.hito.nombre,href:`/admin/proyectos/${d.proyecto.id}/hitos/${d.hito.id}`},{title:"Entregables",href:`/admin/proyectos/${d.proyecto.id}/hitos/${d.hito.id}/entregables`},{title:d.entregable.nombre}],Q=b(()=>({pendiente:"secondary",en_progreso:"default",completado:"outline",cancelado:"destructive"})[d.entregable.estado]||"default"),W=b(()=>({pendiente:"Pendiente",en_progreso:"En Progreso",completado:"Completado",cancelado:"Cancelado"})[d.entregable.estado]||d.entregable.estado),X=b(()=>({baja:"text-blue-500",media:"text-yellow-500",alta:"text-red-500"})[d.entregable.prioridad]||""),p=b(()=>d.entregable.fecha_fin?ye(new Date(d.entregable.fecha_fin),new Date):null);b(()=>{if(d.entregable.estado==="completado")return"Completado";if(d.entregable.estado==="cancelado")return"Cancelado";if(p.value!==null){if(p.value<0)return"Vencido";if(p.value===0)return"Vence hoy";if(p.value<=3)return"Por vencer"}return"En curso"});const z=s=>s?L(G(s),"d 'de' MMMM 'de' yyyy",{locale:O}):"No definida",S=s=>L(G(s),"d MMM yyyy 'a las' HH:mm",{locale:O}),w=b(()=>d.entregable.evidencias||[]),Y=b(()=>{const s=new Map;return w.value.forEach(e=>{var n;if((n=e.obligacion)!=null&&n.contrato){const m=e.obligacion.contrato;s.has(m.id)||s.set(m.id,{id:m.id,nombre:m.nombre})}}),Array.from(s.values())}),Z=b(()=>{let s=w.value;return f.value.contrato_id&&(s=s.filter(e=>{var n;return((n=e.obligacion)==null?void 0:n.contrato_id)===f.value.contrato_id})),f.value.tipo&&(s=s.filter(e=>e.tipo_evidencia===f.value.tipo)),f.value.estado&&(s=s.filter(e=>e.estado===f.value.estado)),f.value.usuario_id&&(s=s.filter(e=>{var n;return((n=e.usuario)==null?void 0:n.id)===f.value.usuario_id})),(f.value.fecha_inicio||f.value.fecha_fin)&&(s=s.filter(e=>{const n=new Date(e.created_at);if(f.value.fecha_inicio){const m=new Date(f.value.fecha_inicio);if(n<m)return!1}if(f.value.fecha_fin){const m=new Date(f.value.fecha_fin);if(m.setHours(23,59,59,999),n>m)return!1}return!0})),s}),ee=b(()=>{const s={};return Z.value.forEach(e=>{var n;if((n=e.obligacion)!=null&&n.contrato){const m=e.obligacion.contrato.id;s[m]||(s[m]={contrato:e.obligacion.contrato,evidencias:[]}),s[m].evidencias.push({...e,obligacion_titulo:e.obligacion.titulo})}}),Object.values(s)}),te=b(()=>{let s=d.actividades||[];return v.value.usuario_id&&(s=s.filter(e=>{var n;return((n=e.causer)==null?void 0:n.id)===v.value.usuario_id})),v.value.tipo_accion&&(s=s.filter(e=>e.event===v.value.tipo_accion)),(v.value.fecha_inicio||v.value.fecha_fin)&&(s=s.filter(e=>{const n=new Date(e.created_at);if(v.value.fecha_inicio){const m=new Date(v.value.fecha_inicio);if(n<m)return!1}if(v.value.fecha_fin){const m=new Date(v.value.fecha_fin);if(m.setHours(23,59,59,999),n>m)return!1}return!0})),s});return(s,e)=>(c(),g(I,null,[a(t(se),{title:`Entregable - ${i.entregable.nombre}`},null,8,["title"]),a(ne,{breadcrumbs:K},{default:l(()=>[o("div",De,[o("div",ze,[o("div",null,[o("h1",Fe,u(i.entregable.nombre),1),o("p",Ie,' Entregable del hito "'+u(i.hito.nombre)+'" ',1)]),o("div",Me,[a(t(j),{href:`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables`},{default:l(()=>[a(t(U),{variant:"outline",size:"sm"},{default:l(()=>[a(t(xe),{class:"h-4 w-4 mr-2"}),e[3]||(e[3]=r(" Volver ",-1))]),_:1})]),_:1},8,["href"]),i.canEdit?(c(),h(t(j),{key:0,href:`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables/${i.entregable.id}/edit`},{default:l(()=>[a(t(U),{variant:"outline",size:"sm"},{default:l(()=>[a(t($e),{class:"h-4 w-4 mr-2"}),e[4]||(e[4]=r(" Editar ",-1))]),_:1})]),_:1},8,["href"])):_("",!0)])]),o("div",Se,[a(t(y),null,{default:l(()=>[a(t(x),{class:"pb-2"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[5]||(e[5]=[r("Estado",-1)])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[a(t(C),{variant:Q.value,class:"text-sm"},{default:l(()=>[r(u(W.value),1)]),_:1},8,["variant"])]),_:1})]),_:1}),a(t(y),null,{default:l(()=>[a(t(x),{class:"pb-2"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[6]||(e[6]=[r("Prioridad",-1)])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[o("div",je,[a(t(we),{class:N(["h-4 w-4",X.value])},null,8,["class"]),o("span",Ne,u(i.entregable.prioridad),1)])]),_:1})]),_:1}),a(t(y),null,{default:l(()=>[a(t(x),{class:"pb-2"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[7]||(e[7]=[r("Progreso",-1)])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[o("div",Te,[o("div",Ue,[o("span",qe,u(i.entregable.porcentaje_completado)+"%",1)]),a(t(re),{"model-value":i.entregable.porcentaje_completado},null,8,["model-value"])])]),_:1})]),_:1}),a(t(y),null,{default:l(()=>[a(t(x),{class:"pb-2"},{default:l(()=>[a(t(k),null,{default:l(()=>[...e[8]||(e[8]=[r("Tiempo Restante",-1)])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[p.value!==null?(c(),g("div",Be,[a(t(ke),{class:N(["h-4 w-4",{"text-red-500":p.value<0,"text-yellow-500":p.value>=0&&p.value<=3,"text-green-500":p.value>3}])},null,8,["class"]),o("span",He,u(p.value<0?`Vencido hace ${Math.abs(p.value)} días`:p.value===0?"Vence hoy":`${p.value} días`),1)])):(c(),g("span",Re,"Sin fecha límite"))]),_:1})]),_:1})]),a(t(de),{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=n=>D.value=n),class:"flex-1"},{default:l(()=>[a(t(ue),null,{default:l(()=>[a(t(E),{value:"detalles"},{default:l(()=>[a(t(Ce),{class:"h-4 w-4 mr-2"}),e[9]||(e[9]=r(" Detalles ",-1))]),_:1}),a(t(E),{value:"equipo"},{default:l(()=>[a(t(Ee),{class:"h-4 w-4 mr-2"}),e[10]||(e[10]=r(" Equipo ",-1))]),_:1}),a(t(E),{value:"evidencias"},{default:l(()=>[a(t(Ve),{class:"h-4 w-4 mr-2"}),e[11]||(e[11]=r(" Evidencias ",-1)),w.value.length>0?(c(),h(t(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[r(u(w.value.length),1)]),_:1})):_("",!0)]),_:1}),a(t(E),{value:"comentarios"},{default:l(()=>[e[12]||(e[12]=r(" Comentarios ",-1)),i.entregable.total_comentarios>0?(c(),h(t(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[r(u(i.entregable.total_comentarios),1)]),_:1})):_("",!0)]),_:1}),a(t(E),{value:"actividad"},{default:l(()=>[a(t(fe),{class:"h-4 w-4 mr-2"}),e[13]||(e[13]=r(" Actividad ",-1))]),_:1})]),_:1}),a(t(V),{value:"detalles",class:"space-y-4"},{default:l(()=>[a(t(y),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(P),null,{default:l(()=>[...e[14]||(e[14]=[r("Información General",-1)])]),_:1})]),_:1}),a(t($),{class:"space-y-4"},{default:l(()=>[i.entregable.descripcion?(c(),g("div",Le,[e[15]||(e[15]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Descripción",-1)),o("p",Oe,u(i.entregable.descripcion),1)])):_("",!0),o("div",Ge,[o("div",null,[e[16]||(e[16]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Fecha de Inicio",-1)),o("div",Je,[a(t(R),{class:"h-4 w-4"}),o("span",null,u(z(i.entregable.fecha_inicio)),1)])]),o("div",null,[e[17]||(e[17]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Fecha de Fin",-1)),o("div",Ke,[a(t(R),{class:"h-4 w-4"}),o("span",null,u(z(i.entregable.fecha_fin)),1)])])]),i.entregable.notas?(c(),g("div",Qe,[e[18]||(e[18]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Notas",-1)),a(t(ce),null,{default:l(()=>[a(t(Pe),{class:"h-4 w-4"}),a(t(me),null,{default:l(()=>[r(u(i.entregable.notas),1)]),_:1})]),_:1})])):_("",!0),o("div",We,[e[22]||(e[22]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-4"},"Metadatos",-1)),o("div",Xe,[o("div",null,[e[19]||(e[19]=o("span",{class:"text-muted-foreground text-xs font-medium block mb-1"},"Creado",-1)),o("span",Ye,u(S(i.entregable.created_at)),1)]),o("div",null,[e[20]||(e[20]=o("span",{class:"text-muted-foreground text-xs font-medium block mb-1"},"Última actualización",-1)),o("span",Ze,u(S(i.entregable.updated_at)),1)]),o("div",null,[e[21]||(e[21]=o("span",{class:"text-muted-foreground text-xs font-medium block mb-1"},"Orden de visualización",-1)),o("span",et,u(i.entregable.orden),1)])])])]),_:1})]),_:1}),i.camposPersonalizados&&i.camposPersonalizados.length>0?(c(),h(he,{key:0,campos:i.camposPersonalizados,"valores-campos":i.valoresCamposPersonalizados,descripcion:"Información adicional específica del entregable",columns:2},null,8,["campos","valores-campos"])):_("",!0),i.entregable.etiquetas&&i.entregable.etiquetas.length>0?(c(),h(t(y),{key:1},{default:l(()=>[a(t(x),null,{default:l(()=>[o("div",tt,[a(t(Ae),{class:"h-5 w-5"}),a(t(P),null,{default:l(()=>[...e[23]||(e[23]=[r("Etiquetas",-1)])]),_:1})]),a(t(k),null,{default:l(()=>[...e[24]||(e[24]=[r(" Etiquetas asignadas a este entregable para su organización y categorización ",-1)])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[o("div",at,[(c(!0),g(I,null,T(i.entregable.etiquetas,n=>(c(),h(t(C),{key:n.id,variant:"outline",class:"px-3 py-1.5",style:ie({borderColor:n.color||"#94a3b8",color:n.color||"#64748b",backgroundColor:`${n.color}15`||"#f1f5f9"})},{default:l(()=>[r(u(n.nombre),1)]),_:2},1032,["style"]))),128))])]),_:1})]),_:1})):_("",!0)]),_:1}),a(t(V),{value:"equipo",class:"space-y-4"},{default:l(()=>[a(t(y),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(P),null,{default:l(()=>[...e[25]||(e[25]=[r("Responsable Principal",-1)])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[i.entregable.responsable?(c(),g("div",lt,[a(t(q),{class:"h-10 w-10"},{default:l(()=>[i.entregable.responsable.avatar?(c(),h(t(B),{key:0,src:i.entregable.responsable.avatar},null,8,["src"])):_("",!0),a(t(H),null,{default:l(()=>[r(u(i.entregable.responsable.name.substring(0,2).toUpperCase()),1)]),_:1})]),_:1}),o("div",null,[o("p",ot,u(i.entregable.responsable.name),1),o("p",st,u(i.entregable.responsable.email),1)])])):(c(),g("p",it,"No hay responsable asignado"))]),_:1})]),_:1}),a(t(y),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(P),null,{default:l(()=>[...e[26]||(e[26]=[r("Colaboradores",-1)])]),_:1}),a(t(k),null,{default:l(()=>[r(u(A.value.length)+" usuarios asignados ",1)]),_:1})]),_:1}),a(t($),null,{default:l(()=>[A.value.length>0?(c(),g("div",nt,[(c(!0),g(I,null,T(A.value,n=>(c(),g("div",{key:n.user_id,class:"flex items-center justify-between p-3 bg-muted rounded-lg"},[o("div",rt,[a(t(q),{class:"h-8 w-8"},{default:l(()=>[n.user.avatar?(c(),h(t(B),{key:0,src:n.user.avatar},null,8,["src"])):_("",!0),a(t(H),null,{default:l(()=>[r(u(n.user.name.substring(0,2).toUpperCase()),1)]),_:2},1024)]),_:2},1024),o("div",null,[o("p",dt,u(n.user.name),1),o("p",ut,u(n.user.email),1)])]),a(t(C),{variant:"outline"},{default:l(()=>[r(u(n.rol),1)]),_:2},1024)]))),128))])):(c(),g("p",ct,"No hay colaboradores asignados"))]),_:1})]),_:1})]),_:1}),a(t(V),{value:"evidencias",class:"space-y-4 mt-6"},{default:l(()=>[w.value.length>0?(c(),h(pe,{key:0,modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),contratos:Y.value,evidencias:w.value},null,8,["modelValue","contratos","evidencias"])):_("",!0),a(ve,{mode:"grouped","evidencias-agrupadas":ee.value,"format-date":z},null,8,["evidencias-agrupadas"])]),_:1}),a(t(V),{value:"comentarios",class:"space-y-4"},{default:l(()=>[a(_e,{"commentable-type":"entregables","commentable-id":i.entregable.id,"can-create":i.canEdit},null,8,["commentable-id","can-create"])]),_:1}),a(t(V),{value:"actividad",class:"space-y-4"},{default:l(()=>[M.value&&M.value.length>0?(c(),h(be,{key:0,modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n),usuarios:i.usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):_("",!0),a(ge,{activities:te.value,title:"Historial de Actividad",description:"Registro de cambios y eventos del entregable","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{Ra as default};
