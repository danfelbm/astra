import{d as Q,r as B,c as L,i as g,e as s,j as u,f as t,w as a,b as f,g as k,h as i,t as c,F as W,k as X,m as r,n as V,v as E,s as T}from"./app-b8_bfoa9.js";import{_ as Y,c as Z}from"./CardTitle.vue_vue_type_script_setup_true_lang-ChEDhgpu.js";import{_ as b}from"./createLucideIcon-jMLPrHZq.js";import{_ as D}from"./index-Cl6Mk0dD.js";import{_ as M}from"./Checkbox.vue_vue_type_script_setup_true_lang--RqN3OLk.js";import{a as ee,b as N,c as x,d as te,e as v,_ as se}from"./TableHeader.vue_vue_type_script_setup_true_lang-DcXGUKQu.js";import{_ as ae,a as le,b as ie,c as oe,d as P,e as p}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-PTnNV47i.js";import{u as re}from"./useToast-DZfJCqgm.js";import{F as O}from"./file-text-DR9j7dm-.js";import{C as ne}from"./circle-alert-BTKmsP7n.js";import{C as de}from"./calendar-CX82M-Gf.js";import{D as ue}from"./dollar-sign-nsXlQAaa.js";import{E as fe}from"./ellipsis-DAZzGzvR.js";import{E as ce}from"./eye-Dc5wk_Ma.js";import{S as me}from"./square-pen-B6rPBksJ.js";import{L as ge}from"./list-s-_C_gJF.js";import{D as ve}from"./download-C4_wDjhP.js";import{C as ke}from"./copy-DFGtkNE-.js";import{T as xe}from"./trash-2-Bs3Aw1uS.js";const ye={borrador:"Borrador",activo:"Activo",finalizado:"Finalizado",cancelado:"Cancelado"},be={servicio:"Servicio",obra:"Obra",suministro:"Suministro",consultoria:"Consultoría",otro:"Otro"};function pe(n){return ye[n]||n}function _e(n){return be[n]||n}function he(n,F="USD"){return n?new Intl.NumberFormat("es-ES",{style:"currency",currency:F,minimumFractionDigits:2,maximumFractionDigits:2}).format(n):"-"}const we={class:"space-y-4"},Ce={key:0,class:"flex items-center justify-center py-12"},$e={class:"flex items-center gap-1"},Se={key:0,class:"text-xs"},ze={class:"flex items-center gap-1"},Ee={key:0,class:"text-xs"},De={class:"flex items-center gap-1"},Fe={key:0,class:"text-xs"},Ae={class:"flex flex-col gap-2"},Be={class:"flex items-center gap-2"},Le={class:"flex items-center gap-1 mt-1"},Ve={key:0,class:"flex items-center gap-1 flex-wrap"},Te={key:1,class:"text-gray-400"},Ne={class:"flex items-center gap-1"},Pe={key:0,class:"flex items-center gap-1"},Ue={key:1,class:"text-gray-400"},je={key:0,class:"text-sm text-gray-600"},it=Q({__name:"ContratosList",props:{contratos:{},loading:{type:Boolean,default:!1},showProyecto:{type:Boolean,default:!0},showActions:{type:Boolean,default:!0},showSelection:{type:Boolean,default:!1},selectedIds:{default:()=>[]},actionsStyle:{default:"dropdown"}},emits:["select","selectAll","edit","delete","duplicate","changeStatus","download"],setup(n,{expose:F,emit:U}){const w=n,C=U,q=re(),m=B(new Set(w.selectedIds)),_=B("fecha_inicio"),h=B("desc"),S=L(()=>w.contratos.length>0&&w.contratos.every(o=>m.value.has(o.id))),R=L(()=>w.contratos.some(o=>m.value.has(o.id))&&!S.value),j=L(()=>{const o=[...w.contratos];return o.sort((e,l)=>{let d=e[_.value],$=l[_.value];return d==null?1:$==null?-1:(typeof d=="string"&&(d=d.toLowerCase(),$=$.toLowerCase()),h.value==="asc"?d>$?1:-1:d<$?1:-1)}),o}),G=o=>({borrador:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",activo:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",finalizado:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",cancelado:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"})[o]||"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",H=o=>({servicio:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",obra:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",suministro:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200",consultoria:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",otro:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"})[o]||"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",I=o=>o?new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",A=o=>{_.value===o?h.value=h.value==="asc"?"desc":"asc":(_.value=o,h.value="asc")},J=o=>{m.value.has(o)?m.value.delete(o):m.value.add(o)},K=()=>{S.value?m.value.clear():w.contratos.forEach(o=>m.value.add(o.id)),C("selectAll",S.value)},y=(o,e)=>{switch(o){case"view":T.get(route("admin.contratos.show",e.id));break;case"edit":C("edit",e),T.get(route("admin.contratos.edit",e.id));break;case"obligations":T.get(route("admin.obligaciones.index",{contrato_id:e.id}));break;case"duplicate":C("duplicate",e);break;case"delete":C("delete",e);break;case"download":e.archivo_pdf?(C("download",e),window.open(e.archivo_pdf,"_blank")):q.error("Este contrato no tiene archivo PDF");break}},z=(o,e)=>{C("changeStatus",o,e)};return F({selectedContratos:m}),(o,e)=>(r(),g("div",we,[s(t(Y),null,{default:a(()=>[s(t(Z),{class:"p-0"},{default:a(()=>[n.loading?(r(),g("div",Ce,[...e[3]||(e[3]=[k("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)])])):(r(),f(t(se),{key:1},{default:a(()=>[s(t(ee),null,{default:a(()=>[s(t(N),null,{default:a(()=>[n.showSelection?(r(),f(t(x),{key:0,class:"w-12"},{default:a(()=>[s(t(M),{checked:S.value,indeterminate:R.value,"onUpdate:checked":K},null,8,["checked","indeterminate"])]),_:1})):u("",!0),s(t(x),{class:"cursor-pointer hover:bg-gray-50",onClick:e[0]||(e[0]=l=>A("nombre"))},{default:a(()=>[k("div",$e,[e[4]||(e[4]=i(" Nombre ",-1)),_.value==="nombre"?(r(),g("span",Se,c(h.value==="asc"?"↑":"↓"),1)):u("",!0)])]),_:1}),n.showProyecto?(r(),f(t(x),{key:1},{default:a(()=>[...e[5]||(e[5]=[i("Proyecto",-1)])]),_:1})):u("",!0),s(t(x),null,{default:a(()=>[...e[6]||(e[6]=[i("Estado",-1)])]),_:1}),s(t(x),null,{default:a(()=>[...e[7]||(e[7]=[i("Tipo",-1)])]),_:1}),s(t(x),{class:"cursor-pointer hover:bg-gray-50",onClick:e[1]||(e[1]=l=>A("fecha_inicio"))},{default:a(()=>[k("div",ze,[e[8]||(e[8]=i(" Fecha Inicio ",-1)),_.value==="fecha_inicio"?(r(),g("span",Ee,c(h.value==="asc"?"↑":"↓"),1)):u("",!0)])]),_:1}),s(t(x),null,{default:a(()=>[...e[9]||(e[9]=[i("Fecha Fin",-1)])]),_:1}),s(t(x),{class:"cursor-pointer hover:bg-gray-50",onClick:e[2]||(e[2]=l=>A("monto_total"))},{default:a(()=>[k("div",De,[e[10]||(e[10]=i(" Monto ",-1)),_.value==="monto_total"?(r(),g("span",Fe,c(h.value==="asc"?"↑":"↓"),1)):u("",!0)])]),_:1}),s(t(x),null,{default:a(()=>[...e[11]||(e[11]=[i("Responsable",-1)])]),_:1}),n.showActions&&n.actionsStyle==="dropdown"?(r(),f(t(x),{key:2,class:"text-right"},{default:a(()=>[...e[12]||(e[12]=[i("Acciones",-1)])]),_:1})):u("",!0)]),_:1})]),_:1}),s(t(te),null,{default:a(()=>[j.value.length>0?(r(!0),g(W,{key:0},X(j.value,l=>(r(),f(t(N),{key:l.id,class:V({"bg-gray-50":m.value.has(l.id)})},{default:a(()=>[n.showSelection?(r(),f(t(v),{key:0},{default:a(()=>[s(t(M),{checked:m.value.has(l.id),"onUpdate:checked":()=>J(l.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024)):u("",!0),s(t(v),{class:"font-medium"},{default:a(()=>[k("div",Ae,[k("div",Be,[s(t(O),{class:"h-4 w-4 text-gray-400"}),k("div",null,[i(c(l.nombre)+" ",1),k("div",Le,[l.esta_vencido?(r(),f(t(D),{key:0,variant:"destructive",class:"text-xs"},{default:a(()=>[...e[13]||(e[13]=[i(" Vencido ",-1)])]),_:1})):l.esta_proximo_vencer?(r(),f(t(D),{key:1,variant:"outline",class:"text-xs text-yellow-600 border-yellow-600"},{default:a(()=>[s(t(ne),{class:"h-3 w-3 mr-1"}),i(" "+c(l.dias_restantes)+" días ",1)]),_:2},1024)):u("",!0)])])]),n.showActions&&n.actionsStyle==="buttons"?(r(),g("div",Ve,[s(t(E),{href:o.route("admin.contratos.show",l.id)},{default:a(()=>[s(t(b),{variant:"outline",size:"sm",class:"h-7 text-xs"},{default:a(()=>[...e[14]||(e[14]=[i(" Ver detalles ",-1)])]),_:1})]),_:1},8,["href"]),s(t(E),{href:o.route("admin.contratos.edit",l.id)},{default:a(()=>[s(t(b),{variant:"outline",size:"sm",class:"h-7 text-xs"},{default:a(()=>[...e[15]||(e[15]=[i(" Editar ",-1)])]),_:1})]),_:1},8,["href"]),s(t(E),{href:o.route("admin.obligaciones.index",{contrato_id:l.id})},{default:a(()=>[s(t(b),{variant:"outline",size:"sm",class:"h-7 text-xs"},{default:a(()=>[...e[16]||(e[16]=[i(" Ver obligaciones ",-1)])]),_:1})]),_:1},8,["href"]),l.estado==="borrador"?(r(),f(t(b),{key:0,variant:"outline",size:"sm",class:"h-7 text-xs text-green-600 hover:text-green-700 hover:bg-green-50 dark:hover:bg-green-950",onClick:d=>z(l,"activo")},{default:a(()=>[...e[17]||(e[17]=[i(" Activar ",-1)])]),_:1},8,["onClick"])):u("",!0),l.estado==="activo"?(r(),f(t(b),{key:1,variant:"outline",size:"sm",class:"h-7 text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:hover:bg-blue-950",onClick:d=>z(l,"finalizado")},{default:a(()=>[...e[18]||(e[18]=[i(" Finalizar ",-1)])]),_:1},8,["onClick"])):u("",!0),s(t(b),{variant:"outline",size:"sm",class:"h-7 text-xs text-purple-600 hover:text-purple-700 hover:bg-purple-50 dark:hover:bg-purple-950",onClick:d=>y("duplicate",l)},{default:a(()=>[...e[19]||(e[19]=[i(" Duplicar ",-1)])]),_:1},8,["onClick"]),s(t(b),{variant:"outline",size:"sm",class:"h-7 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950",onClick:d=>y("delete",l)},{default:a(()=>[...e[20]||(e[20]=[i(" Eliminar ",-1)])]),_:1},8,["onClick"])])):u("",!0)])]),_:2},1024),n.showProyecto?(r(),f(t(v),{key:1},{default:a(()=>[l.proyecto?(r(),f(t(E),{key:0,href:o.route("admin.proyectos.show",l.proyecto.id),class:"text-blue-600 hover:underline"},{default:a(()=>[i(c(l.proyecto.nombre),1)]),_:2},1032,["href"])):(r(),g("span",Te,"-"))]),_:2},1024)):u("",!0),s(t(v),null,{default:a(()=>[s(t(D),{class:V(G(l.estado))},{default:a(()=>[i(c(t(pe)(l.estado)),1)]),_:2},1032,["class"])]),_:2},1024),s(t(v),null,{default:a(()=>[s(t(D),{class:V(H(l.tipo)),variant:"outline"},{default:a(()=>[i(c(t(_e)(l.tipo)),1)]),_:2},1032,["class"])]),_:2},1024),s(t(v),null,{default:a(()=>[k("div",Ne,[s(t(de),{class:"h-4 w-4 text-gray-400"}),i(" "+c(I(l.fecha_inicio)),1)])]),_:2},1024),s(t(v),null,{default:a(()=>[i(c(I(l.fecha_fin)),1)]),_:2},1024),s(t(v),null,{default:a(()=>[l.monto_total?(r(),g("div",Pe,[s(t(ue),{class:"h-4 w-4 text-gray-400"}),i(" "+c(t(he)(l.monto_total,l.moneda)),1)])):(r(),g("span",Ue,"-"))]),_:2},1024),s(t(v),null,{default:a(()=>{var d;return[i(c(((d=l.responsable)==null?void 0:d.name)||"-"),1)]}),_:2},1024),n.showActions&&n.actionsStyle==="dropdown"?(r(),f(t(v),{key:2,class:"text-right"},{default:a(()=>[s(t(ae),null,{default:a(()=>[s(t(le),{asChild:""},{default:a(()=>[s(t(b),{variant:"ghost",size:"sm"},{default:a(()=>[s(t(fe),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ie),{align:"end"},{default:a(()=>[s(t(oe),null,{default:a(()=>[...e[21]||(e[21]=[i("Acciones",-1)])]),_:1}),s(t(P)),s(t(p),{onClick:d=>y("view",l)},{default:a(()=>[s(t(ce),{class:"h-4 w-4 mr-2"}),e[22]||(e[22]=i(" Ver detalles ",-1))]),_:1},8,["onClick"]),s(t(p),{onClick:d=>y("edit",l)},{default:a(()=>[s(t(me),{class:"h-4 w-4 mr-2"}),e[23]||(e[23]=i(" Editar ",-1))]),_:1},8,["onClick"]),s(t(p),{onClick:d=>y("obligations",l)},{default:a(()=>[s(t(ge),{class:"h-4 w-4 mr-2"}),e[24]||(e[24]=i(" Ver obligaciones ",-1))]),_:1},8,["onClick"]),l.archivo_pdf?(r(),f(t(p),{key:0,onClick:d=>y("download",l)},{default:a(()=>[s(t(ve),{class:"h-4 w-4 mr-2"}),e[25]||(e[25]=i(" Descargar PDF ",-1))]),_:1},8,["onClick"])):u("",!0),s(t(P)),l.estado==="borrador"?(r(),f(t(p),{key:1,onClick:d=>z(l,"activo")},{default:a(()=>[...e[26]||(e[26]=[i(" Activar ",-1)])]),_:1},8,["onClick"])):u("",!0),l.estado==="activo"?(r(),f(t(p),{key:2,onClick:d=>z(l,"finalizado")},{default:a(()=>[...e[27]||(e[27]=[i(" Finalizar ",-1)])]),_:1},8,["onClick"])):u("",!0),s(t(p),{onClick:d=>y("duplicate",l)},{default:a(()=>[s(t(ke),{class:"h-4 w-4 mr-2"}),e[28]||(e[28]=i(" Duplicar ",-1))]),_:1},8,["onClick"]),s(t(P)),s(t(p),{class:"text-red-600",onClick:d=>y("delete",l)},{default:a(()=>[s(t(xe),{class:"h-4 w-4 mr-2"}),e[29]||(e[29]=i(" Eliminar ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):u("",!0)]),_:2},1032,["class"]))),128)):(r(),f(t(N),{key:1},{default:a(()=>[s(t(v),{colspan:n.showSelection?10:9,class:"text-center py-8 text-gray-500"},{default:a(()=>[s(t(O),{class:"h-12 w-12 text-gray-300 mx-auto mb-2"}),e[30]||(e[30]=k("p",null,"No se encontraron contratos",-1))]),_:1},8,["colspan"])]),_:1}))]),_:1})]),_:1}))]),_:1})]),_:1}),n.showSelection&&m.value.size>0?(r(),g("div",je,c(m.value.size)+" contrato(s) seleccionado(s) ",1)):u("",!0)]))}});export{it as _};
