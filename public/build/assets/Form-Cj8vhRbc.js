import{d as Xe,k as H,c as I,w as oe,s as Qe,a as m,o as u,j as N,i as V,e as c,b as r,u as e,g as x,f as l,t as v,F as Y,r as Q,bT as tt,n as J,C as at,v as rt,m as st,h as it,at as ot,J as dt,bK as nt,as as lt}from"./app-DUwT5XjW.js";import{_ as se}from"./AppLogo.vue_vue_type_script_setup_true_lang-TtBKHXHP.js";import{_ as de,a as ne}from"./CardContent.vue_vue_type_script_setup_true_lang-5UaTZODP.js";import{_ as le,a as Pe}from"./CardTitle.vue_vue_type_script_setup_true_lang-DawTe2K_.js";import{_ as ut}from"./Checkbox.vue_vue_type_script_setup_true_lang-C__YTuiO.js";import{_ as fe}from"./Input.vue_vue_type_script_setup_true_lang-Bavi-x6e.js";import{_ as ae}from"./Label.vue_vue_type_script_setup_true_lang-BVnk0AbU.js";import{_ as ct,a as ft,b as mt,c as _t,d as pt}from"./SelectValue.vue_vue_type_script_setup_true_lang-B7z30C33.js";import{_ as gt}from"./Textarea.vue_vue_type_script_setup_true_lang-Dt20lwRw.js";import{u as vt,a as bt,_ as yt,b as ht,c as xt,d as kt}from"./useConditionalFields-PAUs2EUe.js";import{a as Re,C as Me,U as St,u as R,_ as wt,v as $t}from"./AppLayout.vue_vue_type_script_setup_true_lang-C-TXGeAC.js";import{_ as We}from"./CardDescription.vue_vue_type_script_setup_true_lang-DfN2mHkg.js";import{_ as Ct,a as Ge}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-CdT4M2ja.js";import{a as me,_ as _e}from"./index-WuW-kuf-.js";import{_ as pe}from"./AlertTitle.vue_vue_type_script_setup_true_lang-Cef66v0s.js";import{C as X}from"./circle-alert-BDYdSiMf.js";import{M as ie}from"./map-pin-BB9auFN7.js";import{A as Et}from"./arrow-left-D-Ud-LWr.js";import{C as ge}from"./clock-DtY7_Md1.js";import{C as Tt}from"./circle-check-big-CGUkHjNB.js";import{U as Vt}from"./user-D-EGq6iO.js";import{S as Ye}from"./save-HBhGoMFp.js";import"./index-S1odQ9fv.js";import"./index-lXub5hNN.js";import"./useForwardExpose-DCR6Fykl.js";import"./usePrimitiveElement-DXJMmht_.js";import"./createContext-BqTg7DGM.js";import"./Collection-C7Tlg6fc.js";import"./useNonce-CVR6C3wM.js";import"./chevron-up-mMt2Z1mV.js";import"./handleAndDispatchCustomEvent-CYpUamdb.js";import"./nullish-CHIgUVhi.js";import"./useFormControl-B3_kincx.js";import"./VisuallyHidden-BH4I_bjZ.js";import"./upload-BCDFVy9m.js";import"./eye-DOHKdpym.js";import"./download-BXf1S9k-.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-bnGfnvpd.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CStynK6i.js";import"./plus-C_Zgpucy.js";import"./grip-vertical-BsmuzG_W.js";import"./trash-2-CF8unIwz.js";import"./RovingFocusItem-Cmn667_L.js";import"./VisuallyHiddenInput-BhUX47yR.js";const At={class:"space-y-4"},jt={key:1,class:"text-center py-8"},Ut={key:3,class:"space-y-6"},Ot={key:0},It={class:"text-sm font-medium text-muted-foreground mb-3"},Ft={class:"space-y-3"},qt={class:"flex items-start gap-3"},Dt={class:"flex-1"},Nt={class:"flex items-center justify-between"},Bt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Lt={class:"flex items-center gap-2 text-muted-foreground"},zt={class:"flex items-center gap-2 text-muted-foreground"},Pt={class:"flex items-center gap-2 text-muted-foreground"},Rt={key:0,class:"flex items-center gap-2 text-muted-foreground"},Mt={class:"mt-3 text-xs text-muted-foreground"},Wt={key:1},Gt={class:"text-sm font-medium text-muted-foreground mb-3"},Yt={class:"space-y-3"},Jt={class:"flex items-start gap-3"},Kt={class:"flex-1"},Ht={class:"flex items-center justify-between"},Xt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Qt={class:"flex items-center gap-2 text-muted-foreground"},Zt={class:"flex items-center gap-2 text-muted-foreground"},ea={class:"flex items-center gap-2 text-muted-foreground"},ta={class:"mt-3 text-xs text-muted-foreground"},aa={key:5,class:"mt-4 p-3 bg-muted/50 rounded-lg"},ra={class:"text-sm text-muted-foreground"},sa=Xe({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(s,{emit:i}){const w=s,j=i,$=H([]),E=H(!1),A=H(null),a=H(w.modelValue),y=async()=>{E.value=!0,A.value=null;try{const h=await tt.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:w.filtrarPorUbicacion,incluir_futuras:!0}});$.value=h.data}catch(h){A.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",h)}finally{E.value=!1}},T=I(()=>{const h={abiertas:[],futuras:[]};return $.value.forEach(p=>{p.estado_temporal==="abierta"?h.abiertas.push(p):p.estado_temporal==="futura"&&h.futuras.push(p)}),h}),M=I(()=>$.value.find(h=>h.id===a.value));oe(a,h=>{j("update:modelValue",h)}),oe(()=>w.modelValue,h=>{a.value=h});const F=h=>new Date(h).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=h=>{switch(h){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},U=h=>{switch(h){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Qe(()=>{y()}),(h,p)=>(u(),m("div",At,[h.showPostulacionWarning&&a.value?(u(),N(e(_e),{key:0,class:"border-blue-200 bg-blue-50"},{default:c(()=>[r(e(X),{class:"h-4 w-4 text-blue-600"}),r(e(pe),{class:"text-blue-800"},{default:c(()=>p[1]||(p[1]=[x("Postulación Automática")])),_:1}),r(e(me),{class:"text-blue-700"},{default:c(()=>p[2]||(p[2]=[x(' Al enviar este formulario de candidatura, se creará automáticamente una postulación a la convocatoria seleccionada, la cual quedará en estado "Enviada" para revisión administrativa. ')])),_:1})]),_:1})):V("",!0),E.value?(u(),m("div",jt,p[3]||(p[3]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),l("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):A.value?(u(),N(e(_e),{key:2,variant:"destructive"},{default:c(()=>[r(e(X),{class:"h-4 w-4"}),r(e(pe),null,{default:c(()=>p[4]||(p[4]=[x("Error")])),_:1}),r(e(me),null,{default:c(()=>[x(v(A.value),1)]),_:1})]),_:1})):$.value.length>0?(u(),m("div",Ut,[r(e(Ct),{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=_=>a.value=_),disabled:h.disabled},{default:c(()=>[T.value.abiertas.length>0?(u(),m("div",Ot,[l("h4",It," Convocatorias Abiertas ("+v(T.value.abiertas.length)+") ",1),l("div",Ft,[(u(!0),m(Y,null,Q(T.value.abiertas,_=>(u(),N(e(de),{key:_.id,class:J(["cursor-pointer hover:shadow-md transition-shadow",{"ring-2 ring-primary":a.value===_.id}])},{default:c(()=>[r(e(le),{class:"pb-3"},{default:c(()=>[l("div",qt,[r(e(Ge),{value:_.id.toString(),id:`conv-${_.id}`},null,8,["value","id"]),l("div",Dt,[l("div",Nt,[r(e(ae),{for:`conv-${_.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[x(v(_.nombre),1)]),_:2},1032,["for"]),r(e(Re),{class:J(B(_.estado_temporal))},{default:c(()=>[x(v(U(_.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(We),{class:"mt-1"},{default:c(()=>[x(v(_.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(ne),{class:"pt-0"},{default:c(()=>[l("div",Bt,[l("div",Lt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.cargo.nombre),1)]),l("div",zt,[r(e(Me),{class:"h-4 w-4"}),l("span",null,v(_.periodo_electoral.nombre),1)]),l("div",Pt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.ubicacion),1)]),_.numero_postulaciones!==void 0?(u(),m("div",Rt,[r(e(St),{class:"h-4 w-4"}),l("span",null,v(_.numero_postulaciones)+" postulaciones",1)])):V("",!0)]),l("div",Mt,[p[5]||(p[5]=l("span",{class:"font-medium"},"Cierre:",-1)),x(" "+v(F(_.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0),T.value.futuras.length>0?(u(),m("div",Wt,[l("h4",Gt," Próximas Convocatorias ("+v(T.value.futuras.length)+") ",1),l("div",Yt,[(u(!0),m(Y,null,Q(T.value.futuras,_=>(u(),N(e(de),{key:_.id,class:J(["cursor-pointer hover:shadow-md transition-shadow opacity-90",{"ring-2 ring-primary":a.value===_.id}])},{default:c(()=>[r(e(le),{class:"pb-3"},{default:c(()=>[l("div",Jt,[r(e(Ge),{value:_.id.toString(),id:`conv-${_.id}`},null,8,["value","id"]),l("div",Kt,[l("div",Ht,[r(e(ae),{for:`conv-${_.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[x(v(_.nombre),1)]),_:2},1032,["for"]),r(e(Re),{class:J(B(_.estado_temporal))},{default:c(()=>[x(v(U(_.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(We),{class:"mt-1"},{default:c(()=>[x(v(_.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(ne),{class:"pt-0"},{default:c(()=>[l("div",Xt,[l("div",Qt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.cargo.nombre),1)]),l("div",Zt,[r(e(Me),{class:"h-4 w-4"}),l("span",null,v(_.periodo_electoral.nombre),1)]),l("div",ea,[r(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.ubicacion),1)])]),l("div",ta,[p[6]||(p[6]=l("span",{class:"font-medium"},"Apertura:",-1)),x(" "+v(F(_.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),N(e(_e),{key:4},{default:c(()=>[r(e(X),{class:"h-4 w-4"}),r(e(pe),null,{default:c(()=>p[7]||(p[7]=[x("Sin convocatorias disponibles")])),_:1}),r(e(me),null,{default:c(()=>p[8]||(p[8]=[x(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),M.value&&!h.disabled?(u(),m("div",aa,[p[9]||(p[9]=l("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),l("p",ra,v(M.value.nombre),1)])):V("",!0)]))}});var ia=typeof global=="object"&&global&&global.Object===Object&&global,oa=typeof self=="object"&&self&&self.Object===Object&&self,Ze=ia||oa||Function("return this")(),ue=Ze.Symbol,et=Object.prototype,da=et.hasOwnProperty,na=et.toString,te=ue?ue.toStringTag:void 0;function la(s){var i=da.call(s,te),w=s[te];try{s[te]=void 0;var j=!0}catch{}var $=na.call(s);return j&&(i?s[te]=w:delete s[te]),$}var ua=Object.prototype,ca=ua.toString;function fa(s){return ca.call(s)}var ma="[object Null]",_a="[object Undefined]",Je=ue?ue.toStringTag:void 0;function pa(s){return s==null?s===void 0?_a:ma:Je&&Je in Object(s)?la(s):fa(s)}function ga(s){return s!=null&&typeof s=="object"}var va="[object Symbol]";function ba(s){return typeof s=="symbol"||ga(s)&&pa(s)==va}var ya=/\s/;function ha(s){for(var i=s.length;i--&&ya.test(s.charAt(i)););return i}var xa=/^\s+/;function ka(s){return s&&s.slice(0,ha(s)+1).replace(xa,"")}function be(s){var i=typeof s;return s!=null&&(i=="object"||i=="function")}var Ke=NaN,Sa=/^[-+]0x[0-9a-f]+$/i,wa=/^0b[01]+$/i,$a=/^0o[0-7]+$/i,Ca=parseInt;function He(s){if(typeof s=="number")return s;if(ba(s))return Ke;if(be(s)){var i=typeof s.valueOf=="function"?s.valueOf():s;s=be(i)?i+"":i}if(typeof s!="string")return s===0?s:+s;s=ka(s);var w=wa.test(s);return w||$a.test(s)?Ca(s.slice(2),w?2:8):Sa.test(s)?Ke:+s}var ve=function(){return Ze.Date.now()},Ea="Expected a function",Ta=Math.max,Va=Math.min;function Aa(s,i,w){var j,$,E,A,a,y,T=0,M=!1,F=!1,B=!0;if(typeof s!="function")throw new TypeError(Ea);i=He(i)||0,be(w)&&(M=!!w.leading,F="maxWait"in w,E=F?Ta(He(w.maxWait)||0,i):E,B="trailing"in w?!!w.trailing:B);function U(k){var D=j,g=$;return j=$=void 0,T=k,A=s.apply(g,D),A}function h(k){return T=k,a=setTimeout(L,i),M?U(k):A}function p(k){var D=k-y,g=k-T,C=i-D;return F?Va(C,E-g):C}function _(k){var D=k-y,g=k-T;return y===void 0||D>=i||D<0||F&&g>=E}function L(){var k=ve();if(_(k))return G(k);a=setTimeout(L,p(k))}function G(k){return a=void 0,B&&j?U(k):(j=$=void 0,A)}function Z(){a!==void 0&&clearTimeout(a),T=0,j=y=$=a=void 0}function K(){return a===void 0?A:G(ve())}function q(){var k=ve(),D=_(k);if(j=arguments,$=this,y=k,D){if(a===void 0)return h(y);if(F)return clearTimeout(a),a=setTimeout(L,i),U(y)}return a===void 0&&(a=setTimeout(L,i)),A}return q.cancel=Z,q.flush=K,q}function ja(s,i){const{url:w,candidaturaId:j=null,debounceTime:$=3e3,showNotifications:E=!0,useLocalStorage:A=!0,localStorageKey:a="candidatura_draft"}=i,y=H({status:"idle",lastSaved:null,lastError:null,candidaturaId:j}),T=I(()=>y.value.status==="saving"),M=I(()=>y.value.lastSaved!==null),F=I(()=>y.value.status==="error"),B=()=>{if(A)try{const g={formulario_data:s.value,timestamp:new Date().toISOString(),candidaturaId:y.value.candidaturaId};localStorage.setItem(a,JSON.stringify(g))}catch(g){console.error("Error guardando en localStorage:",g)}},U=()=>{if(!A)return null;try{const g=localStorage.getItem(a);if(g){const C=JSON.parse(g),z=new Date(C.timestamp);if((Date.now()-z.getTime())/(1e3*60*60)<24)return C;localStorage.removeItem(a)}}catch(g){console.error("Error cargando desde localStorage:",g)}return null},h=()=>{A&&localStorage.removeItem(a)},p=async()=>{try{const g=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(g.ok){const C=await g.text(),O=new DOMParser().parseFromString(C,"text/html").querySelector('meta[name="csrf-token"]');if(O){const ee=O.getAttribute("content"),W=document.querySelector('meta[name="csrf-token"]');if(W&&ee)return W.setAttribute("content",ee),ee}}}catch(g){console.error("Error renovando token CSRF:",g)}return null},_=async(g,C,z=0)=>{const P=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":C,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:s.value})});if(P.status===419&&z<1){const O=await p();if(O)return E&&R.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),_(g,O,z+1)}return P},L=async()=>{var g;if(y.value.status!=="saving"&&!(!s.value||Object.keys(s.value).length===0)){y.value.status="saving",y.value.lastError=null;try{const C=y.value.candidaturaId?w.replace("autosave",`${y.value.candidaturaId}/autosave`):w,z=((g=document.querySelector('meta[name="csrf-token"]'))==null?void 0:g.getAttribute("content"))||"";if(!z)throw new Error("Token CSRF no encontrado");const P=await _(C,z);if(!P.ok)throw new Error(`Error ${P.status}: ${P.statusText}`);const O=await P.json();if(O.success)y.value.status="saved",y.value.lastSaved=new Date,!y.value.candidaturaId&&O.candidatura_id&&(y.value.candidaturaId=O.candidatura_id),B(),E&&R.success("Cambios guardados",{description:`Autoguardado a las ${O.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(O.message||"Error al guardar")}catch(C){y.value.status="error",y.value.lastError=C instanceof Error?C.message:"Error desconocido",B(),C instanceof Error&&C.message.includes("419")?E&&R.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):E&&R.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",C)}}},G=Aa(L,$),Z=()=>(G.cancel(),L()),K=()=>oe(s,()=>{y.value.status!=="error"&&G()},{deep:!0}),q=()=>{G.cancel()},k=()=>{q(),y.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:j},h()},D=()=>{const g=U();return g&&g.formulario_data?(E&&R.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),g):null};return{state:I(()=>y.value),isSaving:T,hasSaved:M,hasError:F,saveNow:Z,startWatching:K,stopAutoSave:q,reset:k,restoreDraft:D,clearLocalStorage:h}}const Ua={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Oa={class:"flex items-center justify-between"},Ia={class:"text-3xl font-bold"},Fa={class:"text-muted-foreground"},qa={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Da={key:0,class:"flex items-center gap-1.5"},Na={key:1,class:"flex items-center gap-1.5"},Ba={key:2,class:"flex items-center gap-1.5 text-amber-600"},La={key:3,class:"flex items-center gap-1.5"},za={class:"text-blue-700 dark:text-blue-300"},Pa={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Ra={class:"flex items-start gap-3"},Ma={class:"text-sm text-blue-800"},Wa={key:0,class:"mt-1 text-blue-600"},Ga={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},Ya={class:"flex items-start gap-3"},Ja={key:0,class:"text-red-500"},Ka={key:0,class:"text-sm text-muted-foreground"},Ha={key:6,class:"space-y-2"},Xa=["id","name","value","onUpdate:modelValue"],Qa={key:7,class:"space-y-2"},Za={key:8},er={key:9},tr={key:0,class:"text-red-500 text-sm mt-1"},ar={key:10},rr={key:11},sr={key:12},ir={key:13,class:"text-sm text-destructive"},or={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},dr={class:"text-red-800 text-sm"},nr={class:"flex justify-between pt-6"},lr={key:0,class:"fixed bottom-6 right-6 z-50"},ur=Xe({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(s){var ye,he;const i=s,w=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:i.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:j}=vt(),$=H({}),E=I(()=>{var S;if(!i.is_editing||!((S=i.candidatura)!=null&&S.formulario_data))return!1;const n=Object.keys(i.candidatura.formulario_data),d=i.configuracion_campos.map(t=>t.id),o=n.some(t=>!d.includes(t)),b=i.configuracion_campos.some(t=>t.required&&!i.candidatura.formulario_data[t.id]);return o||b}),a=at((()=>{var d;const n={};return i.configuracion_campos.forEach(o=>{o.type==="checkbox"?n[o.id]=[]:o.type==="file"?n[o.id]=[]:o.type==="convocatoria"?n[o.id]=void 0:o.type==="disclaimer"?n[o.id]=null:o.type==="repeater"?n[o.id]=[]:o.type==="datepicker"?n[o.id]=null:n[o.id]=""}),(d=i.candidatura)!=null&&d.formulario_data&&(Object.assign(n,i.candidatura.formulario_data),i.configuracion_campos.forEach(o=>{o.type==="file"&&n[o.id]&&(Array.isArray(n[o.id])||(n[o.id]=[n[o.id]]))})),{formulario_data:n}})()),y=H(i.configuracion_campos),T=I(()=>a.formulario_data),{visibleFields:M,clearHiddenFieldValues:F}=bt(y,T);oe(M,()=>{F()});const{state:B,isSaving:U,hasSaved:h,hasError:p,saveNow:_,startWatching:L,stopAutoSave:G,restoreDraft:Z,clearLocalStorage:K}=ja(T,{url:"/candidaturas/autosave",candidaturaId:((ye=i.candidatura)==null?void 0:ye.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((he=i.candidatura)==null?void 0:he.id)||"new"}`});let q=null;Qe(()=>{const n=["borrador","rechazado"];if(!i.candidatura||n.includes(i.candidatura.estado)){if(!i.is_editing){const o=Z();o&&o.formulario_data&&(R.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{K(),a.reset(),R.success("Borrador descartado")}},duration:5e3}),Object.assign(a.formulario_data,o.formulario_data))}q=L()}}),rt(()=>{q&&q(),G()});const k=async()=>{if(U.value){R.warning("Ya se está guardando...");return}await _(),p.value||R.success("Borrador guardado manualmente")},D=I(()=>z.value.map(o=>{var t;if(!o.required)return{campo:o.id,valid:!0};const b=a.formulario_data[o.id];let S=!1;if(o.type==="checkbox")S=Array.isArray(b)&&b.length>0;else if(o.type==="file")(Array.isArray(b)&&b.length>0||$.value[o.id]&&$.value[o.id].length>0)&&(S=!0);else if(o.type==="convocatoria")S=b!=null&&b!=="";else if(o.type==="disclaimer")S=b&&b.accepted===!0;else if(o.type==="repeater"){const re=((t=o.repeaterConfig)==null?void 0:t.minItems)||0;S=Array.isArray(b)&&b.length>=re}else o.type==="datepicker"?S=b!=null&&b!=="":S=b&&b.toString().trim()!=="";return!S&&o.required,{campo:o.id,valid:S}}).every(o=>o.valid)),g=I(()=>i.is_editing?"Editar Candidatura":"Crear Candidatura"),C=I(()=>{var n,d;return a.processing?"Guardando...":i.is_editing?((n=i.candidatura)==null?void 0:n.estado)==="rechazado"?"Reenviar Candidatura":((d=i.candidatura)==null?void 0:d.estado)==="aprobado"?"Solicitar Revisión":"Actualizar Candidatura":"Crear Candidatura"}),z=I(()=>{var d;let n=[...M.value];return i.is_editing&&i.candidatura&&["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=n.filter(b=>b.type!=="convocatoria")),i.is_editing&&((d=i.candidatura)==null?void 0:d.estado)==="aprobado"&&(n=n.filter(o=>o.editable===!0)),n}),P=I(()=>{var o;if(!i.is_editing||!i.candidatura)return!1;let n=!1;if(["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=i.configuracion_campos.some(b=>b.type==="convocatoria")),((o=i.candidatura)==null?void 0:o.estado)==="aprobado"){const b=i.configuracion_campos.some(S=>!S.editable&&S.type!=="convocatoria");return n||b}return n}),O=(n,d)=>{$.value[n]=d,a.formulario_data[n]=[...a.formulario_data[n]||[]]},ee=async()=>{for(const[d,o]of Object.entries($.value))if(o&&o.length>0)try{const b=await j(o,{module:"candidaturas",fieldId:d});a.formulario_data[d]=b.map(S=>S.path),$.value[d]=[]}catch(b){console.error("Error al subir archivos:",b);return}const n={...a.formulario_data};i.configuracion_campos.forEach(d=>{const o=n[d.id];d.required||(o===""||o===void 0||Array.isArray(o)&&o.length===0&&d.type!=="checkbox"&&d.type!=="file")&&(n[d.id]=null)}),a.formulario_data=n,G(),i.is_editing?a.put(`/candidaturas/${i.candidatura.id}`,{onSuccess:()=>{K(),R.success("Candidatura actualizada exitosamente")},onError:d=>{console.error("Errores de validación:",d),(!i.candidatura||["borrador","rechazado"].includes(i.candidatura.estado))&&(q=L())}}):a.post("/candidaturas",{onSuccess:()=>{K(),R.success("Candidatura creada exitosamente")},onError:d=>{console.error("Errores de validación:",d),q=L()}})},W=n=>!!a.errors[`formulario_data.${n}`];return(n,d)=>(u(),m(Y,null,[r(e(st),{title:g.value},null,8,["title"]),r(wt,{breadcrumbs:w},{default:c(()=>{var o,b;return[l("div",Ua,[l("div",Oa,[l("div",null,[l("h1",Ia,v(g.value),1),l("p",Fa,v(n.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),r(e(se),{variant:"outline",onClick:d[0]||(d[0]=S=>n.$inertia.visit("/candidaturas"))},{default:c(()=>[r(e(Et),{class:"mr-2 h-4 w-4"}),d[2]||(d[2]=x(" Volver "))]),_:1})]),!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)?(u(),m("div",qa,[e(U)?(u(),m("div",Da,[r(e(ge),{class:"h-4 w-4 animate-spin"}),d[3]||(d[3]=l("span",null,"Guardando automáticamente...",-1))])):e(h)&&!e(p)?(u(),m("div",Na,[r(e(Tt),{class:"h-4 w-4 text-green-600"}),l("span",null,"Guardado automáticamente a las "+v((o=e(B).lastSaved)==null?void 0:o.toLocaleTimeString()),1)])):e(p)?(u(),m("div",Ba,[r(e(X),{class:"h-4 w-4"}),d[4]||(d[4]=l("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),m("div",La,[r(e(ge),{class:"h-4 w-4"}),d[5]||(d[5]=l("span",null,"Autoguardado activado",-1))]))])):V("",!0),n.is_editing&&((b=n.candidatura)!=null&&b.comentarios_admin)?(u(),N(e(de),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:c(()=>[r(e(le),null,{default:c(()=>[r(e(Pe),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:c(()=>[r(e(X),{class:"h-5 w-5"}),d[6]||(d[6]=x(" Comentarios de la comisión "))]),_:1})]),_:1}),r(e(ne),null,{default:c(()=>[l("p",za,v(n.candidatura.comentarios_admin),1)]),_:1})]),_:1})):V("",!0),r(e(de),null,{default:c(()=>[r(e(le),null,{default:c(()=>[r(e(Pe),{class:"flex items-center gap-2"},{default:c(()=>[r(e(Vt),{class:"h-5 w-5"}),d[7]||(d[7]=x(" Información de Candidatura "))]),_:1})]),_:1}),r(e(ne),null,{default:c(()=>{var S;return[l("form",{onSubmit:it(ee,["prevent"]),class:"space-y-6"},[n.is_editing&&((S=n.candidatura)==null?void 0:S.estado)==="aprobado"?(u(),m("div",Pa,[l("div",Ra,[r(e(X),{class:"h-5 w-5 text-blue-600 mt-0.5"}),l("div",Ma,[d[8]||(d[8]=l("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),d[9]||(d[9]=l("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),P.value?(u(),m("p",Wa," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):V("",!0)])])])):V("",!0),E.value?(u(),m("div",Ga,[l("div",Ya,[r(e(X),{class:"h-5 w-5 text-amber-600 mt-0.5"}),d[10]||(d[10]=l("div",{class:"text-sm text-amber-800"},[l("p",{class:"font-medium"},"Formulario Actualizado"),l("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):V("",!0),r(ot,{name:"fade-field",tag:"div",class:"space-y-6"},{default:c(()=>[(u(!0),m(Y,null,Q(z.value,t=>{var re,xe,ke,Se,we,$e,Ce,Ee,Te,Ve,Ae,je,Ue,Oe,Ie,Fe,qe,De,Ne,Be,Le;return u(),m("div",{key:t.id,class:"space-y-2"},[r(e(ae),{for:t.id,class:"flex items-center gap-1"},{default:c(()=>[x(v(t.title)+" ",1),t.required?(u(),m("span",Ja,"*")):V("",!0)]),_:2},1032,["for"]),t.description?(u(),m("p",Ka,v(t.description),1)):V("",!0),t.type==="text"||t.type==="email"?(u(),N(e(fe),{key:1,id:t.id,type:t.type,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:J({"border-destructive":W(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(u(),N(e(gt),{key:2,id:t.id,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",rows:4,class:J({"border-destructive":W(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(u(),N(e(fe),{key:3,id:t.id,type:"number",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:J({"border-destructive":W(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(u(),N(e(fe),{key:4,id:t.id,type:"date",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,class:J({"border-destructive":W(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(u(),N(e(ct),{key:5,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f},{default:c(()=>[r(e(ft),{class:J({"border-destructive":W(t.id)})},{default:c(()=>[r(e(mt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),r(e(_t),null,{default:c(()=>[(u(!0),m(Y,null,Q(t.options,f=>(u(),N(e(pt),{key:f,value:f},{default:c(()=>[x(v(f),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(u(),m("div",Ha,[(u(!0),m(Y,null,Q(t.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[dt(l("input",{id:`${t.id}_${f}`,name:t.id,type:"radio",value:f,"onUpdate:modelValue":ce=>e(a).formulario_data[t.id]=ce,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Xa),[[nt,e(a).formulario_data[t.id]]]),r(e(ae),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[x(v(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(u(),m("div",Qa,[(u(!0),m(Y,null,Q(t.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[r(e(ut),{id:`${t.id}_${f}`,checked:e(a).formulario_data[t.id].includes(f),"onUpdate:checked":ce=>{if(ce)e(a).formulario_data[t.id].includes(f)||e(a).formulario_data[t.id].push(f);else{const ze=e(a).formulario_data[t.id].indexOf(f);ze>-1&&e(a).formulario_data[t.id].splice(ze,1)}}},null,8,["id","checked","onUpdate:checked"]),r(e(ae),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[x(v(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(u(),m("div",Za,[r(yt,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,onFilesSelected:f=>O(t.id,f),label:"",description:"",required:t.required,multiple:((re=t.fileConfig)==null?void 0:re.multiple)||!1,"max-files":((xe=t.fileConfig)==null?void 0:xe.maxFiles)||5,"max-file-size":((ke=t.fileConfig)==null?void 0:ke.maxFileSize)||10,accept:((Se=t.fileConfig)==null?void 0:Se.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(a).errors[`formulario_data.${t.id}`],disabled:e(a).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(u(),m("div",er,[r(sa,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,required:t.required,disabled:e(a).processing||n.is_editing&&((we=n.candidatura)==null?void 0:we.estado)!=="borrador","filtrar-por-ubicacion":(($e=t.convocatoriaConfig)==null?void 0:$e.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),W(t.id)?(u(),m("div",tr,v(e(a).errors[`formulario_data.${t.id}`]),1)):V("",!0)])):t.type==="datepicker"?(u(),m("div",ar,[r(ht,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-date":(Ce=t.datepickerConfig)==null?void 0:Ce.minDate,"max-date":(Ee=t.datepickerConfig)==null?void 0:Ee.maxDate,format:((Te=t.datepickerConfig)==null?void 0:Te.format)||"DD/MM/YYYY","allow-past-dates":((Ve=t.datepickerConfig)==null?void 0:Ve.allowPastDates)??!0,"allow-future-dates":((Ae=t.datepickerConfig)==null?void 0:Ae.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(u(),m("div",rr,[r(xt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"disclaimer-text":((je=t.disclaimerConfig)==null?void 0:je.disclaimerText)||"","modal-title":((Ue=t.disclaimerConfig)==null?void 0:Ue.modalTitle)||"Términos y Condiciones","accept-button-text":((Oe=t.disclaimerConfig)==null?void 0:Oe.acceptButtonText)||"Acepto","decline-button-text":((Ie=t.disclaimerConfig)==null?void 0:Ie.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(u(),m("div",sr,[r(kt,{"model-value":e(a).formulario_data[t.id]||[],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-items":((Fe=t.repeaterConfig)==null?void 0:Fe.minItems)||0,"max-items":((qe=t.repeaterConfig)==null?void 0:qe.maxItems)||10,"item-name":((De=t.repeaterConfig)==null?void 0:De.itemName)||"Elemento","add-button-text":((Ne=t.repeaterConfig)==null?void 0:Ne.addButtonText)||"Agregar elemento","remove-button-text":((Be=t.repeaterConfig)==null?void 0:Be.removeButtonText)||"Eliminar",fields:((Le=t.repeaterConfig)==null?void 0:Le.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):V("",!0),W(t.id)?(u(),m("p",ir,v(e(a).errors[`formulario_data.${t.id}`]),1)):V("",!0)])}),128))]),_:1}),e(a).errors.general?(u(),m("div",or,[l("p",dr,v(e(a).errors.general),1)])):V("",!0),l("div",nr,[r(e(se),{variant:"outline",type:"button",onClick:d[1]||(d[1]=t=>n.$inertia.visit("/candidaturas"))},{default:c(()=>d[11]||(d[11]=[x(" Cancelar ")])),_:1}),r(e(se),{type:"submit",disabled:!D.value||e(a).processing},{default:c(()=>[r(e(Ye),{class:"mr-2 h-4 w-4"}),x(" "+v(C.value),1)]),_:1},8,["disabled"])])],32)]}),_:1})]),_:1})]),r(lt,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:c(()=>[(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&!e(a).processing?(u(),m("div",lr,[r(e(se),{onClick:k,disabled:e(U),size:"lg",class:"shadow-lg hover:shadow-xl transition-shadow duration-200"},{default:c(()=>[e(U)?(u(),m(Y,{key:0},[r(e(ge),{class:"mr-2 h-5 w-5 animate-spin"}),d[12]||(d[12]=x(" Guardando... "))],64)):(u(),m(Y,{key:1},[r(e(Ye),{class:"mr-2 h-5 w-5"}),d[13]||(d[13]=x(" Guardar como borrador "))],64))]),_:1},8,["disabled"])])):V("",!0)]),_:1})]}),_:1})],64))}}),ts=$t(ur,[["__scopeId","data-v-e684938c"]]);export{ts as default};
