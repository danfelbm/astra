import{d as M,r as y,c as H,p as U,i as V,F as Q,k as X,b as E,n as G,f as a,m as p,o as Y,B as Z,e as o,w as d,g as c,h as f,j as k,t as $,s as ee}from"./app-BimSYFfn.js";import{a as te,b as ae,c as se,_ as le}from"./CardTitle.vue_vue_type_script_setup_true_lang-AcWFyddQ.js";import{_ as oe}from"./CardDescription.vue_vue_type_script_setup_true_lang-CbvP-NDY.js";import{c as ie,_ as F}from"./createLucideIcon-8SUuN7PU.js";import{_ as L}from"./Label.vue_vue_type_script_setup_true_lang-DSauWxiR.js";import{_ as W,a as z}from"./index-DhvzXRkc.js";import{_ as N}from"./AlertTitle.vue_vue_type_script_setup_true_lang-Dr6n-259.js";import{_ as P}from"./index-B9gY3UTB.js";import{_ as re}from"./Input.vue_vue_type_script_setup_true_lang-Br5uUBy0.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{t as q}from"./index-Bv291Cm0.js";import{U as ue}from"./user-1Nbmh03m.js";import{C as j}from"./circle-check-big-BzU3kF2B.js";import{T as de}from"./timer-C7PW8Tm6.js";import{R as ce}from"./refresh-cw-Bp25rV74.js";import{C as me}from"./circle-alert-QifRli_0.js";import{A as fe}from"./arrow-left-D_R_sWvS.js";import{A as ve}from"./arrow-right-C5_csrQ6.js";import"./index-uz18abos.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=ie("ShieldCheckIcon",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ge={class:"flex gap-2"},he=M({__name:"VerificationCodeInput",props:{modelValue:{default:""},length:{default:6},disabled:{type:Boolean,default:!1},error:{},autoFocus:{type:Boolean,default:!1}},emits:["update:modelValue","complete"],setup(g,{emit:B}){const r=g,R=B,i=y(Array(r.length).fill("")),h=y([]),I=H(()=>i.value.every(t=>t!=="")&&i.value.join("").length===r.length);U(()=>r.modelValue,t=>{if(t)for(i.value=t.split("").slice(0,r.length);i.value.length<r.length;)i.value.push("");else i.value=Array(r.length).fill("")},{immediate:!0}),U(i,t=>{const s=t.join("");R("update:modelValue",s),s.length===r.length&&!s.includes("")&&R("complete",s)},{deep:!0});const A=(t,s)=>{var u,C;const n=s.target,l=n.value;if(!/^\d*$/.test(l)){n.value="",i.value[t]="";return}if(l&&t<r.length-1){const _=h.value[t+1];_&&((C=(u=_.$el)==null?void 0:u.querySelector("input"))==null||C.focus())}},x=(t,s)=>{var l,u,C,_,b,T;const n=s.key;if(n==="Backspace")if(s.preventDefault(),!i.value[t]&&t>0){const w=h.value[t-1];w&&(i.value[t-1]="",(u=(l=w.$el)==null?void 0:l.querySelector("input"))==null||u.focus())}else i.value[t]="";if(n==="ArrowLeft"&&t>0){s.preventDefault();const w=h.value[t-1];(_=(C=w==null?void 0:w.$el)==null?void 0:C.querySelector("input"))==null||_.focus()}if(n==="ArrowRight"&&t<r.length-1){s.preventDefault();const w=h.value[t+1];(T=(b=w==null?void 0:w.$el)==null?void 0:b.querySelector("input"))==null||T.focus()}!/^\d$/.test(n)&&!["Backspace","Delete","Tab","ArrowLeft","ArrowRight"].includes(n)&&s.preventDefault()},D=t=>{var l;t.preventDefault();const n=(((l=t.clipboardData)==null?void 0:l.getData("text"))||"").replace(/\D/g,"").slice(0,r.length);if(n){for(i.value=n.split("");i.value.length<r.length;)i.value.push("");const u=i.value.findLastIndex(_=>_!==""),C=u<r.length-1?u+1:u;setTimeout(()=>{var _,b,T;(T=(b=(_=h.value[C])==null?void 0:_.$el)==null?void 0:b.querySelector("input"))==null||T.focus()},0)}},S=t=>{setTimeout(()=>{var n,l;const s=(l=(n=h.value[t])==null?void 0:n.$el)==null?void 0:l.querySelector("input");s&&s.select()},0)};return r.autoFocus&&setTimeout(()=>{var t,s,n;(n=(s=(t=h.value[0])==null?void 0:t.$el)==null?void 0:s.querySelector("input"))==null||n.focus()},100),(t,s)=>(p(),V("div",ge,[(p(!0),V(Q,null,X(i.value,(n,l)=>(p(),E(a(re),{key:l,ref_for:!0,ref:u=>h.value[l]=u,modelValue:i.value[l],"onUpdate:modelValue":u=>i.value[l]=u,type:"text",inputmode:"numeric",pattern:"[0-9]",maxlength:"1",class:G(["w-12 h-12 text-center text-lg font-semibold",{"border-destructive":g.error,"border-green-500":I.value&&!g.error,"opacity-50":g.disabled}]),disabled:g.disabled,onInput:u=>A(l,u),onKeydown:u=>x(l,u),onPaste:D,onFocus:u=>S(l)},null,8,["modelValue","onUpdate:modelValue","class","disabled","onInput","onKeydown","onFocus"]))),128))]))}}),K=ne(he,[["__scopeId","data-v-3d697b77"]]),ye={class:"max-w-2xl mx-auto"},_e={class:"flex items-center gap-2"},we={class:"mt-2 space-y-1"},ke={key:0},Ce={class:"space-y-4"},be={class:"flex gap-2 mt-1"},$e={key:0,class:"text-sm text-destructive mt-1"},Ve={key:0},Ie={class:"flex gap-2 mt-1"},Ae={key:0,class:"text-sm text-destructive mt-1"},xe={key:0,class:"space-y-3"},De={class:"flex items-center justify-between p-4 bg-muted rounded-lg"},Te={class:"flex items-center gap-2"},Se={class:"text-sm"},Ee={class:"flex justify-between"},Ze=M({__name:"VerificationProcess",props:{user:{},verificationRequestId:{},initialTimeout:{default:10}},emits:["back","verified","timeout"],setup(g,{emit:B}){const r=g,R=B,i=y(""),h=y(""),I=y(!1),A=y(!1),x=y(""),D=y(""),S=y(r.initialTimeout),t=y(!1),s=y(null),n=y(!1),l=y(!1),u=H(()=>{const m=I.value||!r.user.email,e=A.value||!r.user.telefono;return m&&e}),C=m=>{const[e,v]=m.split("@");return`${e.substring(0,2)+"***"}@${v}`},_=m=>`***${m.replace(/\D/g,"").slice(-4)}`,b=()=>{s.value=setInterval(()=>{S.value--,S.value<=0&&(clearInterval(s.value),t.value=!0,R("timeout"))},1e3)},T=async()=>{var m,e;if(i.value.length===6)try{(await axios.post(route("registro.confirmacion.verify-code"),{verification_id:r.verificationRequestId,code:String(i.value),channel:"email"})).data.success&&(I.value=!0,x.value="",q.success("Email verificado",{description:"Tu email ha sido verificado correctamente"}))}catch(v){x.value=((e=(m=v.response)==null?void 0:m.data)==null?void 0:e.message)||"Código inválido"}},w=async()=>{var m,e;if(h.value.length===6)try{(await axios.post(route("registro.confirmacion.verify-code"),{verification_id:r.verificationRequestId,code:String(h.value),channel:"whatsapp"})).data.success&&(A.value=!0,D.value="",q.success("WhatsApp verificado",{description:"Tu WhatsApp ha sido verificado correctamente"}))}catch(v){D.value=((e=(m=v.response)==null?void 0:m.data)==null?void 0:e.message)||"Código inválido"}},J=async()=>{var m,e;l.value=!0;try{await axios.post(route("registro.confirmacion.send-verification"),{verification_id:r.verificationRequestId}),q.info("Códigos reenviados",{description:"Revisa tu email y WhatsApp"}),S.value=r.initialTimeout,t.value=!1,s.value&&clearInterval(s.value),b()}catch(v){q.error("Error al reenviar códigos",{description:((e=(m=v.response)==null?void 0:m.data)==null?void 0:e.message)||"Intenta nuevamente"})}finally{l.value=!1}},O=()=>{n.value=!0,t.value?ee.get(route("registro.confirmacion.update-form")):R("verified",{email:I.value,whatsapp:A.value})};return Y(()=>{b()}),Z(()=>{s.value&&clearInterval(s.value)}),(m,e)=>(p(),V("div",ye,[o(a(le),null,{default:d(()=>[o(a(te),null,{default:d(()=>[o(a(ae),null,{default:d(()=>[c("div",_e,[o(a(pe),{class:"h-5 w-5"}),e[3]||(e[3]=f(" Verificación de Identidad ",-1))])]),_:1}),o(a(oe),null,{default:d(()=>[...e[4]||(e[4]=[f(" Hemos enviado códigos de verificación a tu email y WhatsApp ",-1)])]),_:1})]),_:1}),o(a(se),{class:"space-y-6"},{default:d(()=>[o(a(W),null,{default:d(()=>[o(a(ue),{class:"h-4 w-4"}),o(a(N),null,{default:d(()=>[...e[5]||(e[5]=[f("Usuario encontrado",-1)])]),_:1}),o(a(z),null,{default:d(()=>[c("div",we,[c("p",null,[e[6]||(e[6]=c("strong",null,"Nombre:",-1)),f(" "+$(g.user.name),1)]),c("p",null,[e[7]||(e[7]=c("strong",null,"Documento:",-1)),f(" "+$(g.user.documento_identidad),1)]),c("p",null,[e[8]||(e[8]=c("strong",null,"Email:",-1)),f(" "+$(C(g.user.email)),1)]),g.user.telefono?(p(),V("p",ke,[e[9]||(e[9]=c("strong",null,"Teléfono:",-1)),f(" "+$(_(g.user.telefono)),1)])):k("",!0)])]),_:1})]),_:1}),c("div",Ce,[c("div",null,[o(a(L),null,{default:d(()=>[...e[10]||(e[10]=[f("Código enviado por Email",-1)])]),_:1}),c("div",be,[o(K,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=v=>i.value=v),disabled:I.value,error:x.value,onComplete:T},null,8,["modelValue","disabled","error"]),I.value?(p(),E(a(P),{key:0,variant:"success"},{default:d(()=>[o(a(j),{class:"h-3 w-3 mr-1"}),e[11]||(e[11]=f(" Verificado ",-1))]),_:1})):k("",!0)]),x.value?(p(),V("p",$e,$(x.value),1)):k("",!0)]),g.user.telefono?(p(),V("div",Ve,[o(a(L),null,{default:d(()=>[...e[12]||(e[12]=[f("Código enviado por WhatsApp",-1)])]),_:1}),c("div",Ie,[o(K,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=v=>h.value=v),disabled:A.value,error:D.value,onComplete:w},null,8,["modelValue","disabled","error"]),A.value?(p(),E(a(P),{key:0,variant:"success"},{default:d(()=>[o(a(j),{class:"h-3 w-3 mr-1"}),e[13]||(e[13]=f(" Verificado ",-1))]),_:1})):k("",!0)]),D.value?(p(),V("p",Ae,$(D.value),1)):k("",!0)])):k("",!0)]),u.value?k("",!0):(p(),V("div",xe,[c("div",De,[c("div",Te,[o(a(de),{class:"h-4 w-4 text-muted-foreground"}),c("span",Se,$(t.value?"Tiempo agotado":`Esperando códigos: ${S.value}s`),1)]),t.value?k("",!0):(p(),E(a(F),{key:0,variant:"ghost",size:"sm",onClick:J,disabled:l.value},{default:d(()=>[o(a(ce),{class:G(["h-4 w-4 mr-1",{"animate-spin":l.value}])},null,8,["class"]),e[14]||(e[14]=f(" Reenviar códigos ",-1))]),_:1},8,["disabled"]))]),t.value?(p(),E(a(W),{key:0,variant:"warning"},{default:d(()=>[o(a(me),{class:"h-4 w-4"}),o(a(N),null,{default:d(()=>[...e[15]||(e[15]=[f("¿No recibiste los códigos?",-1)])]),_:1}),o(a(z),null,{default:d(()=>[...e[16]||(e[16]=[f(" Puedes actualizar tu información de contacto para recibir futuras comunicaciones. ",-1)])]),_:1})]),_:1})):k("",!0)])),c("div",Ee,[o(a(F),{variant:"outline",onClick:e[2]||(e[2]=v=>m.$emit("back"))},{default:d(()=>[o(a(fe),{class:"h-4 w-4 mr-2"}),e[17]||(e[17]=f(" Volver ",-1))]),_:1}),u.value||t.value?(p(),E(a(F),{key:0,onClick:O,disabled:n.value},{default:d(()=>[f($(t.value?"Actualizar datos":"Continuar")+" ",1),o(a(ve),{class:"h-4 w-4 ml-2"})]),_:1},8,["disabled"])):k("",!0)])]),_:1})]),_:1})]))}});export{Ze as default};
