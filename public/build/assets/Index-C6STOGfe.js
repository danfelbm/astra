import{d as A,i as u,e,w as a,f as t,h as d,F as X,k as J,g as c,m as l,b as g,j as p,y as tt,v as K,t as k,c as N,r as q,s as $,n as R}from"./app-CmZXEU6r.js";import{_ as et}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CZ8TAy5u.js";import{c as at,_ as w}from"./createLucideIcon-CnNZrfzB.js";import{_ as T,c as z,a as ot,b as st}from"./CardTitle.vue_vue_type_script_setup_true_lang-B1S67cXd.js";import{O as it}from"./ObligacionTree-_QXabeRp.js";import{_ as U}from"./index-BxKCYSwr.js";import{a as lt,b as H,c as j,d as nt,_ as rt,e as V}from"./TableHeader.vue_vue_type_script_setup_true_lang-cI0BJVd7.js";import{_ as dt,a as ct,b as mt,e as F,d as ut}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-B8dJNjdD.js";import{u as Q}from"./usePermissions-BStJ4z0r.js";import{C as ft}from"./circle-alert-D9XfP6Me.js";import{E as pt}from"./ellipsis-vertical-EL-BCEr1.js";import{E as vt}from"./eye-B1Ivn6OU.js";import{P as gt}from"./pencil-BNaFtfSu.js";import{T as bt}from"./trash-2-D-RhzEvF.js";import{_ as _t}from"./Input.vue_vue_type_script_setup_true_lang-D2njpHVb.js";import{_ as M}from"./Label.vue_vue_type_script_setup_true_lang-DqIcWBli.js";import{_ as xt,a as ht,b as yt,c as $t,d as G}from"./SelectValue.vue_vue_type_script_setup_true_lang-D5V10iEd.js";import{S as kt}from"./search-BUYmF1F5.js";import{F as wt}from"./filter-VE8MdV7U.js";import{X as Ct}from"./x-BVEqjV7Q.js";import{_ as Ot}from"./Pagination.vue_vue_type_script_setup_true_lang-DUut5OEH.js";import{t as D}from"./index-B6_LNVRx.js";import{l as Et}from"./lodash-CRH2Yzp7.js";import{D as St}from"./download-C5COzMGf.js";import{P as jt}from"./plus-mYLokCEG.js";import{T as Vt}from"./tree-pine-Cq4fEQE8.js";import{L as Bt}from"./list-BJKeYdem.js";import"./useFlashMessages-BpL8H_no.js";import"./index-BugGZhnT.js";import"./floating-ui.vue--1V60ZwA.js";import"./index-BvJ6gQQI.js";import"./shield-AVCx69V3.js";import"./user-BJGT1mW-.js";import"./chevron-right-CYROSQyW.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-E09DhlJW.js";import"./VisuallyHidden-Bx32aKt8.js";import"./index-mWTuss3Z.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DtV0O_79.js";import"./map-pin-Du1aaOJd.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-CphGqDFa.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CAKMLsIx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-D1gfH8ue.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BoSpr1Bv.js";import"./tag-D3585RHn.js";import"./users-ByXG9ROn.js";import"./target-Bog0QKiV.js";import"./vote-BL_ofRTJ.js";import"./folder-open-CZswK3s5.js";import"./send-PLReseKd.js";import"./file-text-DK4-w4Jw.js";import"./briefcase-hTwR-IXe.js";import"./calendar-DdB3Zl5z.js";import"./megaphone-CHwvcgCb.js";import"./user-check-qt4DS1z5.js";import"./clipboard-list-XJfoBgH3.js";import"./mail-QviqNq9E.js";import"./message-square-DxEcHFRh.js";import"./external-link-5YuBm0tM.js";import"./panel-left-Ca3N5dqr.js";import"./check-Co0UTQtg.js";import"./index-CpHEh2Qy.js";import"./Separator.vue_vue_type_script_setup_true_lang-B2egUMH3.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-B1GtNxv7.js";import"./circle-DPi4Trf6.js";import"./layers-C2wfQz9A.js";import"./paperclip-Ba41mm4S.js";import"./loader-circle-CXSDkxRs.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=at("CornerDownRightIcon",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),Dt={key:0},Tt={class:"flex items-center"},zt={class:"text-sm text-gray-600"},At={key:0,class:"text-sm"},Pt={key:1,class:"text-sm text-gray-400"},Lt={key:1,class:"text-center py-8 text-gray-500"},It=A({__name:"ObligacionTable",props:{obligaciones:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1}},emits:["view","edit","delete"],setup(o,{emit:f}){const y=f,{hasPermission:b}=Q();return(m,s)=>(l(),u("div",null,[o.obligaciones&&o.obligaciones.length>0?(l(),u("div",Dt,[e(t(rt),null,{default:a(()=>[e(t(lt),null,{default:a(()=>[e(t(H),null,{default:a(()=>[e(t(j),null,{default:a(()=>[...s[0]||(s[0]=[d("Título",-1)])]),_:1}),e(t(j),null,{default:a(()=>[...s[1]||(s[1]=[d("Descripción",-1)])]),_:1}),e(t(j),null,{default:a(()=>[...s[2]||(s[2]=[d("Archivos",-1)])]),_:1}),e(t(j),{class:"text-right"},{default:a(()=>[...s[3]||(s[3]=[d("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(nt),null,{default:a(()=>[(l(!0),u(X,null,J(o.obligaciones,r=>(l(),g(t(H),{key:r.id},{default:a(()=>[e(t(V),{class:"font-medium"},{default:a(()=>[c("div",Tt,[r.nivel>0?(l(),u("span",{key:0,class:"flex items-center text-muted-foreground mr-2",style:tt({paddingLeft:`${(r.nivel-1)*12}px`})},[e(t(Ft),{class:"h-4 w-4"})],4)):p("",!0),c("div",null,[e(t(K),{href:`/admin/obligaciones/${r.id}`,class:"hover:text-blue-600 hover:underline"},{default:a(()=>[d(k(r.titulo),1)]),_:2},1032,["href"]),r.padre?(l(),g(t(U),{key:0,variant:"secondary",class:"ml-2 text-xs"},{default:a(()=>[...s[4]||(s[4]=[d(" Hija ",-1)])]),_:1})):p("",!0),r.tiene_hijos?(l(),g(t(U),{key:1,variant:"outline",class:"ml-1 text-xs"},{default:a(()=>[d(k(r.total_hijos)+" hijos ",1)]),_:2},1024)):p("",!0)])])]),_:2},1024),e(t(V),null,{default:a(()=>[c("span",zt,k(r.descripcion?r.descripcion.length>100?r.descripcion.substring(0,100)+"...":r.descripcion:"Sin descripción"),1)]),_:2},1024),e(t(V),null,{default:a(()=>{var _;return[(_=r.archivos_adjuntos)!=null&&_.length?(l(),u("span",At,k(r.archivos_adjuntos.length)+" archivo(s) ",1)):(l(),u("span",Pt,"Sin archivos"))]}),_:2},1024),e(t(V),{class:"text-right"},{default:a(()=>[e(t(dt),null,{default:a(()=>[e(t(ct),{asChild:""},{default:a(()=>[e(t(w),{variant:"ghost",size:"icon",class:"h-8 w-8"},{default:a(()=>[e(t(pt),{class:"h-4 w-4"})]),_:1})]),_:1}),e(t(mt),{align:"end"},{default:a(()=>[e(t(F),{onClick:_=>y("view",r)},{default:a(()=>[e(t(vt),{class:"h-4 w-4 mr-2"}),s[5]||(s[5]=d(" Ver ",-1))]),_:1},8,["onClick"]),o.canEdit||t(b)("obligaciones.edit")?(l(),g(t(F),{key:0,onClick:_=>y("edit",r)},{default:a(()=>[e(t(gt),{class:"h-4 w-4 mr-2"}),s[6]||(s[6]=d(" Editar ",-1))]),_:1},8,["onClick"])):p("",!0),e(t(ut)),o.canDelete||t(b)("obligaciones.delete")?(l(),g(t(F),{key:1,class:"text-red-600",onClick:_=>y("delete",r)},{default:a(()=>[e(t(bt),{class:"h-4 w-4 mr-2"}),s[7]||(s[7]=d(" Eliminar ",-1))]),_:1},8,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(l(),u("div",Lt,[e(t(ft),{class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),s[8]||(s[8]=c("p",null,"No se encontraron obligaciones",-1)),s[9]||(s[9]=c("p",{class:"text-sm mt-1"},"Crea una nueva obligación para comenzar",-1))]))]))}}),Nt={class:"flex flex-col sm:flex-row gap-4"},qt={class:"flex-1"},Rt={class:"relative"},Ut={key:0,class:"w-full sm:w-64"},Ht=A({__name:"ObligacionFilters",props:{modelValue:{},contratos:{default:()=>[]},loading:{type:Boolean,default:!1},showContratoFilter:{type:Boolean,default:!0}},emits:["update:modelValue","filter","clear"],setup(o,{emit:f}){const y=o,b=f,m=N({get:()=>y.modelValue,set:x=>b("update:modelValue",x)}),s=N(()=>m.value.search||y.showContratoFilter&&m.value.contrato_id),r=x=>{m.value={...m.value,search:x},b("filter")},_=x=>{const v=x==="all"?null:x;m.value={...m.value,contrato_id:v},b("filter")},B=()=>{m.value={search:"",contrato_id:null},b("clear")};return(x,v)=>(l(),g(t(T),null,{default:a(()=>[e(t(z),{class:"pt-6"},{default:a(()=>{var C;return[c("div",Nt,[c("div",qt,[e(t(M),{for:"search",class:"sr-only"},{default:a(()=>[...v[0]||(v[0]=[d("Buscar",-1)])]),_:1}),c("div",Rt,[e(t(kt),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e(t(_t),{id:"search","model-value":m.value.search,type:"text",placeholder:"Buscar por título o descripción...",class:"pl-10",disabled:o.loading,"onUpdate:modelValue":r},null,8,["model-value","disabled"])])]),o.showContratoFilter&&o.contratos.length>0?(l(),u("div",Ut,[e(t(M),{for:"contrato_id",class:"sr-only"},{default:a(()=>[...v[1]||(v[1]=[d("Contrato",-1)])]),_:1}),e(t(xt),{"model-value":((C=m.value.contrato_id)==null?void 0:C.toString())||"all",disabled:o.loading,"onUpdate:modelValue":_},{default:a(()=>[e(t(ht),{id:"contrato_id"},{default:a(()=>[e(t(wt),{class:"h-4 w-4 mr-2 text-gray-400"}),e(t(yt),{placeholder:"Todos los contratos"})]),_:1}),e(t($t),null,{default:a(()=>[e(t(G),{value:"all"},{default:a(()=>[...v[2]||(v[2]=[d("Todos los contratos",-1)])]),_:1}),(l(!0),u(X,null,J(o.contratos,O=>(l(),g(t(G),{key:O.id,value:O.id.toString()},{default:a(()=>[d(k(O.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])])):p("",!0),s.value?(l(),g(t(w),{key:1,variant:"ghost",size:"icon",disabled:o.loading,onClick:B,title:"Limpiar filtros"},{default:a(()=>[e(t(Ct),{class:"h-4 w-4"})]),_:1},8,["disabled"])):p("",!0)])]}),_:1})]),_:1}))}}),Mt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Gt={class:"flex items-center justify-between"},Xt={class:"text-3xl font-bold"},Jt={key:0,class:"text-sm text-gray-600"},Kt={class:"flex items-center gap-2"},Qt={class:"text-2xl font-bold"},Wt={class:"flex items-center justify-between"},Yt={class:"flex items-center gap-2"},Zt={key:0},te={key:1},ee={key:0,class:"mt-4 flex justify-center"},ga=A({__name:"Index",props:{obligaciones:{},estadisticas:{},filters:{},contrato:{},contratos:{},estadisticasResponsables:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canExport:{type:Boolean}},setup(o){var P,L,I;const f=o,y=f.contrato?[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:f.contrato.nombre,href:`/admin/contratos/${f.contrato.id}`},{title:"Obligaciones",href:"#"}]:[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"}],{hasPermission:b}=Q(),m=q("tabla"),s=q({search:((P=f.filters)==null?void 0:P.search)||"",contrato_id:((L=f.filters)==null?void 0:L.contrato_id)||((I=f.contrato)==null?void 0:I.id)||null}),r=Et.debounce(()=>{$.get(route("admin.obligaciones.index"),s.value,{preserveState:!0,preserveScroll:!0})},300),_=()=>{var n;s.value={search:"",contrato_id:((n=f.contrato)==null?void 0:n.id)||null},r()},B=()=>{var n;$.visit(route("admin.obligaciones.create",{contrato_id:(n=f.contrato)==null?void 0:n.id}))},x=n=>{$.visit(route("admin.obligaciones.show",n.id))},v=n=>{$.visit(route("admin.obligaciones.edit",n.id))},C=n=>{const i=n.tiene_hijos?`¿Estás seguro de eliminar "${n.titulo}" y todas sus obligaciones hijas?`:`¿Estás seguro de eliminar "${n.titulo}"?`;confirm(i)&&$.delete(route("admin.obligaciones.destroy",n.id),{preserveScroll:!0,onSuccess:()=>{D.success("Obligación eliminada exitosamente")}})},O=n=>{$.post(route("admin.obligaciones.completar",n.id),{},{preserveScroll:!0,onSuccess:()=>{D.success("Obligación marcada como cumplida")}})},W=n=>{$.visit(route("admin.obligaciones.create",{contrato_id:n.contrato_id,parent_id:n.id}))},Y=(n,i,S)=>{$.post(route("admin.obligaciones.mover",n.id),{nuevo_parent_id:i,nuevo_orden:S},{preserveScroll:!0,onSuccess:()=>{D.success("Obligación movida exitosamente")}})},Z=()=>{window.open(route("admin.obligaciones.exportar",s.value),"_blank")};return(n,i)=>(l(),g(et,{breadcrumbs:t(y)},{default:a(()=>{var S;return[c("div",Mt,[c("div",Gt,[c("div",null,[c("h1",Xt,[i[3]||(i[3]=d(" Obligaciones ",-1)),o.contrato?(l(),u("span",Jt," - "+k(o.contrato.nombre),1)):p("",!0)]),i[4]||(i[4]=c("p",{class:"text-gray-600 mt-1"},"Gestiona las obligaciones de los contratos",-1))]),c("div",Kt,[o.canExport||t(b)("obligaciones.export")?(l(),g(t(w),{key:0,variant:"outline",size:"sm",onClick:Z},{default:a(()=>[e(t(St),{class:"h-4 w-4 mr-2"}),i[5]||(i[5]=d(" Exportar ",-1))]),_:1})):p("",!0),o.canCreate||t(b)("obligaciones.create")?(l(),g(t(K),{key:1,href:n.route("admin.obligaciones.create",{contrato_id:(S=o.contrato)==null?void 0:S.id})},{default:a(()=>[e(t(w),null,{default:a(()=>[e(t(jt),{class:"h-4 w-4 mr-2"}),i[6]||(i[6]=d(" Nueva Obligación ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])]),e(Ht,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=h=>s.value=h),contratos:o.contratos||[],"show-contrato-filter":!o.contrato,onFilter:t(r),onClear:_},null,8,["modelValue","contratos","show-contrato-filter","onFilter"]),e(t(T),null,{default:a(()=>[e(t(z),{class:"pt-6"},{default:a(()=>{var h,E;return[c("div",Qt,k(((E=(h=o.obligaciones)==null?void 0:h.data)==null?void 0:E.length)||0),1),i[7]||(i[7]=c("p",{class:"text-sm text-gray-600"},"Total Obligaciones",-1))]}),_:1})]),_:1}),e(t(T),{class:"flex-1"},{default:a(()=>[e(t(ot),null,{default:a(()=>[c("div",Wt,[e(t(st),null,{default:a(()=>[...i[8]||(i[8]=[d("Lista de Obligaciones",-1)])]),_:1}),c("div",Yt,[e(t(w),{variant:"ghost",size:"sm",class:R({"bg-gray-100":m.value==="arbol"}),onClick:i[1]||(i[1]=h=>m.value="arbol")},{default:a(()=>[e(t(Vt),{class:"h-4 w-4 mr-1"}),i[9]||(i[9]=d(" Árbol ",-1))]),_:1},8,["class"]),e(t(w),{variant:"ghost",size:"sm",class:R({"bg-gray-100":m.value==="tabla"}),onClick:i[2]||(i[2]=h=>m.value="tabla")},{default:a(()=>[e(t(Bt),{class:"h-4 w-4 mr-1"}),i[10]||(i[10]=d(" Tabla ",-1))]),_:1},8,["class"])])])]),_:1}),e(t(z),null,{default:a(()=>{var h,E;return[m.value==="arbol"&&o.obligaciones.data&&o.obligaciones.data.length>0?(l(),u("div",Zt,[e(it,{obligaciones:o.obligaciones.data,contratoId:(h=o.contrato)==null?void 0:h.id,editable:!0,onCreate:B,onEdit:v,onDelete:C,onComplete:O,onAddChild:W,onMove:Y},null,8,["obligaciones","contratoId"])])):m.value==="tabla"?(l(),u("div",te,[e(It,{obligaciones:o.obligaciones.data||[],"can-edit":o.canEdit,"can-delete":o.canDelete,onView:x,onEdit:v,onDelete:C},null,8,["obligaciones","can-edit","can-delete"]),o.obligaciones.links&&((E=o.obligaciones.data)!=null&&E.length)?(l(),u("div",ee,[e(Ot,{links:o.obligaciones.links,meta:o.obligaciones.meta},null,8,["links","meta"])])):p("",!0)])):p("",!0)]}),_:1})]),_:1})])]}),_:1},8,["breadcrumbs"]))}});export{ga as default};
