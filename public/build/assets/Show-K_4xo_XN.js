import{r as M,s as k,d as le,c as I,b as y,w as o,j as p,e as s,f as t,g as r,i as b,h as d,t as c,v as V,n as U,F as z,k as O,m as n,q as he,x as be,l as ae}from"./app-Tc5FcPos.js";import{_ as we}from"./AdminLayout.vue_vue_type_script_setup_true_lang-LQ6X0muo.js";import{a as T,b as B,c as q,_ as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-BMrN_h_j.js";import{_ as ne}from"./CardDescription.vue_vue_type_script_setup_true_lang-NHPaX2aV.js";import{_ as D}from"./createLucideIcon-H6zLNTbI.js";import{_ as H}from"./index-Cly0Qei5.js";import{_ as de}from"./Progress.vue_vue_type_script_setup_true_lang-B3AH_H15.js";import{_ as _e,a as $e,b as F,c as L}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-B4437WSW.js";import{_ as Ee,a as ke,b as se,c as j,d as qe,e as A}from"./TableHeader.vue_vue_type_script_setup_true_lang-KFQw8M7V.js";import{t as P}from"./index-Diz7G8K9.js";import{E as Ce}from"./EtiquetaDisplay-3V5BXtRh.js";import{E as De}from"./EtiquetaSelector-BJfyDLkE.js";import{_ as Se}from"./ContratosList.vue_vue_type_script_setup_true_lang-BCbhrt8M.js";import{_ as He,a as Ve,b as Pe,c as Te,d as Be}from"./AccordionContent.vue_vue_type_script_setup_true_lang-oJejyxtU.js";import{_ as je,a as Ae}from"./ActivityLog.vue_vue_type_script_setup_true_lang-CRGj6IlK.js";import{L as Me,H as Ne}from"./HitoCard-GdwP0HSW.js";import{T as Z}from"./target-Dz509VvQ.js";import{P as J}from"./plus-CYgqSIcI.js";import{S as oe}from"./square-pen-CQPLl26J.js";import{T as ze}from"./trash-2-GLHIknF1.js";import{I as Ie}from"./info-DdnoFtJ5.js";import{F as W}from"./file-text-CnRiRvkf.js";import{M as Fe,B as Le,C as Ue}from"./milestone-BCNwQ4m_.js";import{I as Y}from"./image-CyqjM2Fy.js";import{A as Oe}from"./activity-BooxtDOC.js";import{F as Re}from"./flag-CfaZOABW.js";import{C as re}from"./calendar-DTCaY4jd.js";import{C as Ge}from"./clock-DuU2ihnB.js";import{U as ie}from"./user-BlnlQS9T.js";import{E as Je}from"./external-link-ByQJhuSk.js";import{D as Ke}from"./download-DQ08CtpJ.js";import{C as Xe}from"./circle-check-big-BvkA8kX7.js";import{C as Qe}from"./circle-play-BBFyOEPI.js";import{C as We}from"./circle-alert-AjGR6gnE.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-_ZjZfSfF.js";import"./index-DNeKSjmC.js";import"./floating-ui.vue-BG3fS9ma.js";import"./x-CVNMc2LC.js";import"./Input.vue_vue_type_script_setup_true_lang-INVWSEmQ.js";import"./index-BkyXZ5PZ.js";import"./index-CKthGIYI.js";import"./shield-CCpXm5HU.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BfWiD7tz.js";import"./chevron-right-DvYMqVHa.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BesWdtCP.js";import"./VisuallyHidden-CXQrF-Ui.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-DkcNq_01.js";import"./check-Bpn9XuIe.js";import"./Label.vue_vue_type_script_setup_true_lang-BZ0oMeu3.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BxXxORQ8.js";import"./map-pin-BlDRspux.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-7F-9_guF.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-C7i0MCTs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-BJZP6ctq.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Dk6p9glA.js";import"./tag-1F8xYGqt.js";import"./users-Jlbe-ZJc.js";import"./vote-D_GetRcJ.js";import"./folder-open-BZYYPaTW.js";import"./send-fqecDwiE.js";import"./briefcase-vIbVsaq7.js";import"./megaphone-2iz6bDHh.js";import"./user-check-CRiWIxbt.js";import"./clipboard-list-CyHrlK57.js";import"./mail-CrUveOYG.js";import"./message-square-D5eN9iPu.js";import"./panel-left-ORu1bHUK.js";import"./index-8LKY-cbr.js";import"./RovingFocusItem-BLQ3HjmH.js";import"./utils-DuuWKWL8.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CbDiwCCM.js";import"./layers-Cf4gFD15.js";import"./zap-DfnijOH9.js";import"./trending-up-mWQTmaIm.js";import"./award-DFGMh6WQ.js";import"./hash-CVnnGk60.js";import"./index-Y9pl3cMs.js";import"./search-C3lRFARU.js";import"./useKbd-kRIii9yh.js";import"./VisuallyHiddenInput-6wC6eFlw.js";import"./useEtiquetaHierarchy-DTUaXqnb.js";import"./list-CmrDvkzd.js";import"./tree-pine-CLzaM7uu.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BvjF2l0g.js";import"./useToast-Bv6LOeJe.js";import"./dollar-sign-wxZN8IDm.js";import"./ellipsis-DLvxuoQz.js";import"./eye-B71Ey79G.js";import"./copy-BUin6tGB.js";import"./useArrowNavigation-B5rxJs06.js";import"./filter-3EWDNXuh.js";import"./es-BDPlFIsO.js";import"./parseISO-DFjB8F03.js";import"./CardFooter.vue_vue_type_script_setup_true_lang-CeVGK6MH.js";import"./pen-BLCrZEju.js";import"./calendar-days-BKdr8qdH.js";function Ye(){const a=M(!1),u=M(null);async function N(h,m){return a.value=!0,u.value=null,new Promise((v,_)=>{k.post(`/admin/proyectos/${h}/etiquetas`,{etiqueta_id:m},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{a.value=!1,v(!0)},onError:E=>{a.value=!1,u.value=Object.values(E).join(", "),_(E)}})})}async function w(h,m){return a.value=!0,u.value=null,new Promise((v,_)=>{k.delete(`/admin/proyectos/${h}/etiquetas/${m}`,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{a.value=!1,v(!0)},onError:E=>{a.value=!1,u.value="Error al quitar la etiqueta",_(E)}})})}async function x(h,m){return a.value=!0,u.value=null,new Promise((v,_)=>{k.put(`/admin/proyectos/${h}/etiquetas/sync`,{etiquetas:m},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{a.value=!1,v(!0)},onError:E=>{a.value=!1,u.value="Error al sincronizar etiquetas",_(E)}})})}async function g(h){a.value=!0,u.value=null;try{const m=await fetch(`/admin/proyectos/${h}/etiquetas/suggest`);if(!m.ok)throw new Error("Error al obtener sugerencias");const v=await m.json();return a.value=!1,v.etiquetas||[]}catch(m){return a.value=!1,u.value="Error al obtener sugerencias de etiquetas",console.error(m),[]}}async function $(h){var m;a.value=!0,u.value=null;try{const v=await fetch("/admin/etiquetas",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content"))||""},body:JSON.stringify(h)});if(!v.ok){const E=await v.json();throw new Error(E.message||"Error al crear etiqueta")}const _=await v.json();return a.value=!1,_.data}catch(v){return a.value=!1,u.value=v.message||"Error al crear etiqueta",console.error(v),null}}async function S(h){if(h.length<2)return[];try{const m=await fetch(`/admin/etiquetas/search?q=${encodeURIComponent(h)}`);if(!m.ok)throw new Error("Error al buscar etiquetas");return(await m.json()).data||[]}catch(m){return console.error("Error buscando etiquetas:",m),[]}}function R(h){const m=new Map;return h.forEach(v=>{var E;const _=((E=v.categoria)==null?void 0:E.nombre)||"Sin categoría";m.has(_)||m.set(_,[]),m.get(_).push(v)}),m}function K(h){var m;return h.color||((m=h.categoria)==null?void 0:m.color)||"gray"}function X(h,m=10){return h<m}async function Q(h,m){return a.value=!0,u.value=null,new Promise((v,_)=>{k.post(`/admin/proyectos/${h}/etiquetas/reorder`,{etiquetas:m},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{a.value=!1,v(!0)},onError:E=>{a.value=!1,u.value="Error al reordenar etiquetas",_(E)}})})}return{isLoading:a,error:u,addEtiquetaToProyecto:N,removeEtiquetaFromProyecto:w,syncEtiquetasProyecto:x,getSugerenciasEtiquetas:g,reorderEtiquetas:Q,createEtiqueta:$,searchEtiquetas:S,groupEtiquetasByCategoria:R,getEtiquetaColor:K,canAddMoreEtiquetas:X}}const Ze={key:0,class:"flex items-center gap-2"},et={key:0,class:"mb-6"},tt={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},at={class:"text-center"},st={class:"text-2xl font-bold"},ot={class:"text-center"},rt={class:"text-2xl font-bold text-blue-500"},it={class:"text-center"},lt={class:"text-2xl font-bold text-green-500"},nt={class:"text-center"},dt={class:"space-y-2"},ct={class:"flex justify-between items-center text-sm"},ut={class:"font-medium"},mt={key:1,class:"space-y-4"},ft={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},yt={key:2,class:"text-center py-6"},gt={class:"text-muted-foreground mb-3"},vt=le({__name:"HitosGrid",props:{hitos:{},proyectoId:{},proyectoNombre:{},estadisticas:{},showStats:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0},showActions:{type:Boolean,default:!0},showViewAll:{type:Boolean,default:!0},maxHitos:{default:void 0},canCreate:{type:Boolean,default:!1},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canManageDeliverables:{type:Boolean,default:!1},emptyMessage:{default:"No hay hitos definidos para este proyecto"}},emits:["view","edit","delete","duplicate","add-entregable","view-entregables"],setup(a){const u=a,N=I(()=>u.maxHitos&&u.maxHitos>0?u.hitos.slice(0,u.maxHitos):u.hitos),w=I(()=>u.maxHitos&&u.hitos.length>u.maxHitos);return(x,g)=>(n(),y(t(C),null,{default:o(()=>[a.showHeader?(n(),y(t(T),{key:0,class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:o(()=>[r("div",null,[s(t(B),{class:"flex items-center gap-2"},{default:o(()=>[s(t(Z),{class:"h-5 w-5"}),g[0]||(g[0]=d(" Hitos y Entregables ",-1))]),_:1}),a.proyectoNombre?(n(),y(t(ne),{key:0},{default:o(()=>[d(c(a.proyectoNombre),1)]),_:1})):p("",!0)]),a.showActions?(n(),b("div",Ze,[a.showViewAll&&a.hitos.length>0?(n(),y(t(V),{key:0,href:`/admin/proyectos/${a.proyectoId}/hitos`},{default:o(()=>[s(t(D),{variant:"outline",size:"sm"},{default:o(()=>[s(t(Me),{class:"h-4 w-4 mr-2"}),g[1]||(g[1]=d(" Ver Todos ",-1))]),_:1})]),_:1},8,["href"])):p("",!0),a.canCreate?(n(),y(t(V),{key:1,href:`/admin/proyectos/${a.proyectoId}/hitos/create`},{default:o(()=>[s(t(D),{size:"sm"},{default:o(()=>[s(t(J),{class:"h-4 w-4 mr-2"}),g[2]||(g[2]=d(" Nuevo Hito ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])):p("",!0)]),_:1})):p("",!0),s(t(q),null,{default:o(()=>[a.showStats&&a.estadisticas&&a.estadisticas.total>0?(n(),b("div",et,[r("div",tt,[r("div",at,[r("p",st,c(a.estadisticas.total),1),g[3]||(g[3]=r("p",{class:"text-xs text-muted-foreground"},"Total Hitos",-1))]),r("div",ot,[r("p",rt,c(a.estadisticas.en_progreso),1),g[4]||(g[4]=r("p",{class:"text-xs text-muted-foreground"},"En Progreso",-1))]),r("div",it,[r("p",lt,c(a.estadisticas.completados),1),g[5]||(g[5]=r("p",{class:"text-xs text-muted-foreground"},"Completados",-1))]),r("div",nt,[r("p",{class:U(["text-2xl font-bold",{"text-red-500":a.estadisticas.vencidos>0}])},c(a.estadisticas.vencidos),3),g[6]||(g[6]=r("p",{class:"text-xs text-muted-foreground"},"Vencidos",-1))])]),r("div",dt,[r("div",ct,[g[7]||(g[7]=r("span",{class:"text-muted-foreground"},"Progreso General",-1)),r("span",ut,c(a.estadisticas.progreso_general)+"%",1)]),s(t(de),{value:a.estadisticas.progreso_general,class:"h-2"},null,8,["value"])])])):p("",!0),a.hitos.length>0?(n(),b("div",mt,[r("div",ft,[(n(!0),b(z,null,O(N.value,$=>(n(),y(Ne,{key:$.id,hito:$,canEdit:a.canEdit,canDelete:a.canDelete,canManageDeliverables:a.canManageDeliverables,showActions:!0,onView:S=>x.$emit("view",$),onEdit:S=>x.$emit("edit",$),onDelete:S=>x.$emit("delete",$),onDuplicate:S=>x.$emit("duplicate",$),onAddEntregable:S=>x.$emit("add-entregable",$),onViewEntregables:S=>x.$emit("view-entregables",$)},null,8,["hito","canEdit","canDelete","canManageDeliverables","onView","onEdit","onDelete","onDuplicate","onAddEntregable","onViewEntregables"]))),128))]),w.value?(n(),y(t(V),{key:0,href:`/admin/proyectos/${a.proyectoId}/hitos`,class:"block text-center mt-4 text-sm text-primary hover:underline"},{default:o(()=>[d(" Ver todos los hitos ("+c(a.hitos.length)+") ",1)]),_:1},8,["href"])):p("",!0)])):(n(),b("div",yt,[s(t(Z),{class:"h-10 w-10 mx-auto text-muted-foreground mb-3"}),r("p",gt,c(a.emptyMessage),1),a.canCreate?(n(),y(t(V),{key:0,href:`/admin/proyectos/${a.proyectoId}/hitos/create`},{default:o(()=>[s(t(D),{variant:"outline",size:"sm"},{default:o(()=>[s(t(J),{class:"h-4 w-4 mr-2"}),g[8]||(g[8]=d(" Crear Primer Hito ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)]))]),_:1})]),_:1}))}}),pt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ht={class:"text-2xl font-bold text-gray-900 dark:text-white"},bt={key:0,class:"mt-2 text-gray-600 dark:text-gray-400"},wt={class:"flex gap-2"},_t={class:"flex items-center justify-between"},$t={class:"flex items-center gap-3"},Et={class:"flex items-center gap-3"},kt={class:"space-y-2"},qt={class:"flex justify-between text-sm"},Ct={class:"font-medium"},Dt={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2"},St={class:"flex items-start gap-3"},Ht={class:"font-medium"},Vt={class:"text-xs text-gray-500"},Pt={key:0,class:"flex items-start gap-3"},Tt={class:"font-medium"},Bt={class:"text-xs text-gray-500"},jt={key:0,class:"flex items-center gap-3 pt-2"},At={class:"font-medium ml-2"},Mt={key:0},Nt={key:1,class:"text-sm text-muted-foreground"},zt={key:1,class:"space-y-4"},It={class:"flex gap-2"},Ft={class:"space-y-4"},Lt={class:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1"},Ut={class:"text-gray-900 dark:text-gray-100"},Ot={key:0,class:"flex items-center gap-3"},Rt={class:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},Gt={class:"font-medium"},Jt={class:"text-sm text-gray-500"},Kt={key:1,class:"text-gray-500"},Xt={class:"font-mono"},Qt={class:"font-medium"},Wt={class:"text-sm"},Yt={class:"text-sm"},Zt={class:"space-y-3"},ea={class:"w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},ta={class:"flex-1"},aa={class:"text-sm"},sa={class:"font-medium"},oa={class:"text-xs text-gray-500 mt-1"},ra={key:0,class:"flex justify-end"},ia={class:"space-y-4"},la={class:"text-center"},na={key:1},da={class:"flex items-center justify-between w-full pr-4"},ca={class:"flex items-center gap-3"},ua={class:"text-left"},ma={class:"font-semibold"},fa={class:"text-sm text-gray-500"},ya={class:"flex items-center gap-3"},ga={class:"text-sm text-gray-600"},va={class:"text-sm"},pa=["href"],xa={class:"text-center"},ha={class:"text-center"},co=le({__name:"Show",props:{proyecto:{},categorias:{},activities:{},usuariosActividades:{},totales:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canManageTags:{type:Boolean},canViewContracts:{type:Boolean},canCreateContracts:{type:Boolean},canViewHitos:{type:Boolean},canCreateHitos:{type:Boolean},canEditHitos:{type:Boolean},canDeleteHitos:{type:Boolean},canManageEntregables:{type:Boolean},estadisticasHitos:{}},setup(a){const u=a,N=M("general"),w=M({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),x=M({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),g=M(!1),$=M([]),{syncEtiquetasProyecto:S,isLoading:R}=Ye();u.proyecto.etiquetas&&($.value=u.proyecto.etiquetas.map(i=>i.id));const K=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:u.proyecto.nombre,href:`/admin/proyectos/${u.proyecto.id}`}],X=()=>{confirm(`¿Estás seguro de eliminar el proyecto "${u.proyecto.nombre}"?`)&&k.delete(`/admin/proyectos/${u.proyecto.id}`,{onSuccess:()=>{P.success("Proyecto eliminado exitosamente")},onError:()=>{P.error("Error al eliminar el proyecto")}})},Q=i=>({planificacion:Z,en_progreso:Qe,pausado:Ue,completado:Xe,cancelado:Le})[i]||We,h=i=>({planificacion:"bg-blue-100 text-blue-800",en_progreso:"bg-yellow-100 text-yellow-800",pausado:"bg-orange-100 text-orange-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[i]||"bg-gray-100 text-gray-800",m=i=>({baja:"bg-gray-100 text-gray-800",media:"bg-blue-100 text-blue-800",alta:"bg-orange-100 text-orange-800",critica:"bg-red-100 text-red-800"})[i]||"bg-gray-100 text-gray-800",v=i=>new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),_=i=>{const e=Math.floor((new Date(i).getTime()-new Date().getTime())/864e5);return e===0?"Hoy":e===1?"Mañana":e===-1?"Ayer":e>0?`En ${e} días`:`Hace ${Math.abs(e)} días`},E=async()=>{try{await S(u.proyecto.id,$.value),g.value=!1,P.success("Etiquetas actualizadas exitosamente"),k.reload({only:["proyecto"]})}catch{P.error("Error al actualizar las etiquetas")}},ce=()=>{var i;$.value=((i=u.proyecto.etiquetas)==null?void 0:i.map(e=>e.id))||[],g.value=!1},ue=i=>{k.visit(`/admin/proyectos/${u.proyecto.id}/hitos/${i.id}`)},me=i=>{k.visit(`/admin/proyectos/${u.proyecto.id}/hitos/${i.id}/edit`)},fe=i=>{confirm(`¿Estás seguro de eliminar el hito "${i.nombre}"? Se eliminarán también todos sus entregables.`)&&k.delete(`/admin/proyectos/${u.proyecto.id}/hitos/${i.id}`,{onSuccess:()=>{P.success("Hito eliminado exitosamente"),k.reload({only:["proyecto"]})},onError:()=>{P.error("Error al eliminar el hito")}})},ye=i=>{k.post(`/admin/proyectos/${u.proyecto.id}/hitos/${i.id}/duplicar`,{},{onSuccess:()=>{P.success("Hito duplicado exitosamente"),k.reload({only:["proyecto"]})},onError:()=>{P.error("Error al duplicar el hito")}})},ge=i=>{k.visit(`/admin/proyectos/${u.proyecto.id}/hitos/${i.id}/entregables/create`)},ve=i=>{k.visit(`/admin/proyectos/${u.proyecto.id}/hitos/${i.id}/entregables`)},G=I(()=>{const i=[];return u.proyecto.contratos&&u.proyecto.contratos.forEach(e=>{e.obligaciones&&e.obligaciones.forEach(l=>{l.evidencias&&l.evidencias.forEach(f=>{i.push({...f,contrato_id:e.id,contrato_numero:e.numero_contrato,contrato_nombre:e.nombre,obligacion_titulo:l.titulo,_contrato:e})})})}),i}),pe=I(()=>{let i=G.value;return w.value.contrato_id&&(i=i.filter(e=>e.contrato_id===w.value.contrato_id)),w.value.tipo&&(i=i.filter(e=>e.tipo_evidencia===w.value.tipo)),w.value.estado&&(i=i.filter(e=>e.estado===w.value.estado)),w.value.usuario_id&&(i=i.filter(e=>{var l;return((l=e.usuario)==null?void 0:l.id)===w.value.usuario_id})),(w.value.fecha_inicio||w.value.fecha_fin)&&(i=i.filter(e=>{const l=new Date(e.created_at);if(w.value.fecha_inicio){const f=new Date(w.value.fecha_inicio);if(l<f)return!1}if(w.value.fecha_fin){const f=new Date(w.value.fecha_fin);if(f.setHours(23,59,59,999),l>f)return!1}return!0})),i}),ee=I(()=>{const i={};return pe.value.forEach(e=>{i[e.contrato_id]||(i[e.contrato_id]={contrato:e._contrato,evidencias:[]}),i[e.contrato_id].evidencias.push(e)}),Object.values(i)}),xe=I(()=>{let i=u.activities||[];return x.value.usuario_id&&(i=i.filter(e=>{var l;return((l=e.causer)==null?void 0:l.id)===x.value.usuario_id})),x.value.tipo_entidad&&(i=i.filter(e=>e.subject_type===x.value.tipo_entidad)),x.value.tipo_accion&&(i=i.filter(e=>e.event===x.value.tipo_accion)),(x.value.fecha_inicio||x.value.fecha_fin)&&(i=i.filter(e=>{const l=new Date(e.created_at);if(x.value.fecha_inicio){const f=new Date(x.value.fecha_inicio);if(l<f)return!1}if(x.value.fecha_fin){const f=new Date(x.value.fecha_fin);if(f.setHours(23,59,59,999),l>f)return!1}return!0})),i});return(i,e)=>(n(),b(z,null,[s(t(he),{title:`Proyecto: ${a.proyecto.nombre}`},null,8,["title"]),s(we,{breadcrumbs:K},{default:o(()=>[r("div",pt,[r("div",xt,[r("div",null,[r("h1",ht,c(a.proyecto.nombre),1),a.proyecto.descripcion?(n(),b("p",bt,c(a.proyecto.descripcion),1)):p("",!0)]),r("div",wt,[a.canEdit?(n(),y(t(V),{key:0,href:`/admin/proyectos/${a.proyecto.id}/edit`},{default:o(()=>[s(t(D),null,{default:o(()=>[s(t(oe),{class:"mr-2 h-4 w-4"}),e[7]||(e[7]=d(" Editar ",-1))]),_:1})]),_:1},8,["href"])):p("",!0),a.canDelete?(n(),y(t(D),{key:1,variant:"destructive",onClick:X},{default:o(()=>[s(t(ze),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=d(" Eliminar ",-1))]),_:1})):p("",!0)])]),s(t(_e),{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=l=>N.value=l),class:"w-full"},{default:o(()=>[s(t($e),{class:"grid w-full grid-cols-5"},{default:o(()=>[s(t(F),{value:"general"},{default:o(()=>[s(t(Ie),{class:"mr-2 h-4 w-4"}),e[9]||(e[9]=d(" General ",-1))]),_:1}),s(t(F),{value:"contratos"},{default:o(()=>{var l;return[s(t(W),{class:"mr-2 h-4 w-4"}),e[10]||(e[10]=d(" Contratos ",-1)),(l=a.totales)!=null&&l.contratos?(n(),y(t(H),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[d(c(a.totales.contratos),1)]),_:1})):p("",!0)]}),_:1}),s(t(F),{value:"hitos"},{default:o(()=>{var l;return[s(t(Fe),{class:"mr-2 h-4 w-4"}),e[11]||(e[11]=d(" Hitos y Entregables ",-1)),(l=a.totales)!=null&&l.hitos?(n(),y(t(H),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[d(c(a.totales.hitos),1)]),_:1})):p("",!0)]}),_:1}),s(t(F),{value:"evidencias"},{default:o(()=>{var l;return[s(t(Y),{class:"mr-2 h-4 w-4"}),e[12]||(e[12]=d(" Evidencias ",-1)),(l=a.totales)!=null&&l.evidencias?(n(),y(t(H),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[d(c(a.totales.evidencias),1)]),_:1})):p("",!0)]}),_:1}),s(t(F),{value:"actividad"},{default:o(()=>[s(t(Oe),{class:"mr-2 h-4 w-4"}),e[13]||(e[13]=d(" Actividad ",-1))]),_:1})]),_:1}),s(t(L),{value:"general",class:"space-y-4 mt-6"},{default:o(()=>[s(t(C),null,{default:o(()=>[s(t(T),null,{default:o(()=>[s(t(B),null,{default:o(()=>[...e[14]||(e[14]=[d("Estado del Proyecto",-1)])]),_:1})]),_:1}),s(t(q),{class:"space-y-4"},{default:o(()=>[r("div",_t,[r("div",$t,[(n(),y(be(Q(a.proyecto.estado)),{class:"h-5 w-5 text-gray-500"})),e[15]||(e[15]=r("span",{class:"font-medium"},"Estado:",-1)),s(t(H),{class:U(h(a.proyecto.estado))},{default:o(()=>[d(c(a.proyecto.estado_label),1)]),_:1},8,["class"])]),r("div",Et,[s(t(Re),{class:"h-5 w-5 text-gray-500"}),e[16]||(e[16]=r("span",{class:"font-medium"},"Prioridad:",-1)),s(t(H),{class:U(m(a.proyecto.prioridad))},{default:o(()=>[d(c(a.proyecto.prioridad_label),1)]),_:1},8,["class"])])]),r("div",kt,[r("div",qt,[e[17]||(e[17]=r("span",{class:"text-gray-600 dark:text-gray-400"},"Progreso",-1)),r("span",Ct,c(a.proyecto.porcentaje_completado)+"%",1)]),s(t(de),{value:a.proyecto.porcentaje_completado,class:"h-2"},null,8,["value"])]),r("div",Dt,[r("div",St,[s(t(re),{class:"h-5 w-5 text-gray-500 mt-0.5"}),r("div",null,[e[18]||(e[18]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de inicio",-1)),r("p",Ht,c(v(a.proyecto.fecha_inicio)),1),r("p",Vt,c(_(a.proyecto.fecha_inicio)),1)])]),a.proyecto.fecha_fin?(n(),b("div",Pt,[s(t(re),{class:"h-5 w-5 text-gray-500 mt-0.5"}),r("div",null,[e[19]||(e[19]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de fin",-1)),r("p",Tt,c(v(a.proyecto.fecha_fin)),1),r("p",Bt,c(_(a.proyecto.fecha_fin)),1)])])):p("",!0)]),a.proyecto.duracion_dias?(n(),b("div",jt,[s(t(Ge),{class:"h-5 w-5 text-gray-500"}),r("div",null,[e[20]||(e[20]=r("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Duración total:",-1)),r("span",At,c(a.proyecto.duracion_dias)+" días",1)])])):p("",!0)]),_:1})]),_:1}),s(t(C),null,{default:o(()=>[s(t(T),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:o(()=>[s(t(B),null,{default:o(()=>[...e[21]||(e[21]=[d(" Etiquetas ",-1)])]),_:1}),a.canManageTags&&!g.value?(n(),y(t(D),{key:0,variant:"ghost",size:"sm",onClick:e[0]||(e[0]=l=>g.value=!0)},{default:o(()=>[s(t(oe),{class:"h-4 w-4"})]),_:1})):p("",!0)]),_:1}),s(t(q),null,{default:o(()=>[g.value?(n(),b("div",zt,[a.categorias?(n(),y(De,{key:0,modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=l=>$.value=l),categorias:a.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas...",description:"Selecciona hasta 10 etiquetas para este proyecto"},null,8,["modelValue","categorias"])):p("",!0),r("div",It,[s(t(D),{size:"sm",onClick:E,disabled:t(R)},{default:o(()=>[...e[22]||(e[22]=[d(" Guardar ",-1)])]),_:1},8,["disabled"]),s(t(D),{size:"sm",variant:"outline",onClick:ce,disabled:t(R)},{default:o(()=>[...e[23]||(e[23]=[d(" Cancelar ",-1)])]),_:1},8,["disabled"])])])):(n(),b("div",Mt,[a.proyecto.etiquetas&&a.proyecto.etiquetas.length>0?(n(),y(Ce,{key:0,etiquetas:a.proyecto.etiquetas,"show-categoria":!0,interactive:!0,size:"md"},null,8,["etiquetas"])):(n(),b("p",Nt," No hay etiquetas asignadas "))]))]),_:1})]),_:1}),a.proyecto.campos_personalizados&&a.proyecto.campos_personalizados.length>0?(n(),y(t(C),{key:0},{default:o(()=>[s(t(T),null,{default:o(()=>[s(t(B),null,{default:o(()=>[...e[24]||(e[24]=[d("Campos Personalizados",-1)])]),_:1})]),_:1}),s(t(q),null,{default:o(()=>[r("div",Ft,[(n(!0),b(z,null,O(a.proyecto.campos_personalizados,l=>{var f;return n(),b("div",{key:l.id,class:"py-2 border-b last:border-b-0"},[r("p",Lt,c((f=l.campo_personalizado)==null?void 0:f.nombre),1),r("p",Ut,c(l.valor_formateado||l.valor||"-"),1)])}),128))])]),_:1})]),_:1})):p("",!0),s(t(C),null,{default:o(()=>[s(t(T),null,{default:o(()=>[s(t(B),null,{default:o(()=>[...e[25]||(e[25]=[d("Responsable",-1)])]),_:1})]),_:1}),s(t(q),null,{default:o(()=>[a.proyecto.responsable?(n(),b("div",Ot,[r("div",Rt,[s(t(ie),{class:"h-5 w-5 text-gray-500"})]),r("div",null,[r("p",Gt,c(a.proyecto.responsable.name),1),r("p",Jt,c(a.proyecto.responsable.email),1)])])):(n(),b("p",Kt,"Sin asignar"))]),_:1})]),_:1}),s(t(C),null,{default:o(()=>[s(t(T),null,{default:o(()=>[s(t(B),null,{default:o(()=>[...e[26]||(e[26]=[d("Información del Sistema",-1)])]),_:1})]),_:1}),s(t(q),{class:"space-y-3"},{default:o(()=>{var l;return[r("div",null,[e[27]||(e[27]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"ID del Proyecto",-1)),r("p",Xt,"#"+c(a.proyecto.id),1)]),r("div",null,[e[28]||(e[28]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Estado",-1)),s(t(H),{class:U(a.proyecto.activo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800")},{default:o(()=>[d(c(a.proyecto.activo?"Activo":"Inactivo"),1)]),_:1},8,["class"])]),r("div",null,[e[29]||(e[29]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Creado por",-1)),r("p",Qt,c(((l=a.proyecto.creador)==null?void 0:l.name)||"Sistema"),1)]),r("div",null,[e[30]||(e[30]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de creación",-1)),r("p",Wt,c(v(a.proyecto.created_at)),1)]),r("div",null,[e[31]||(e[31]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Última actualización",-1)),r("p",Yt,c(v(a.proyecto.updated_at)),1)])]}),_:1})]),_:1}),a.proyecto.activities&&a.proyecto.activities.length>0?(n(),y(t(C),{key:1},{default:o(()=>[s(t(T),null,{default:o(()=>[s(t(B),null,{default:o(()=>[...e[32]||(e[32]=[d("Actividad Reciente",-1)])]),_:1})]),_:1}),s(t(q),null,{default:o(()=>[r("div",Zt,[(n(!0),b(z,null,O(a.proyecto.activities,l=>{var f;return n(),b("div",{key:l.id,class:"flex items-start gap-3 pb-3 border-b last:border-b-0"},[r("div",ea,[s(t(ie),{class:"h-4 w-4 text-gray-500"})]),r("div",ta,[r("p",aa,[r("span",sa,c(((f=l.causer)==null?void 0:f.name)||"Sistema"),1),d(" "+c(l.description),1)]),r("p",oa,c(_(l.created_at)),1)])])}),128))])]),_:1})]),_:1})):p("",!0)]),_:1}),s(t(L),{value:"contratos",class:"space-y-4 mt-6"},{default:o(()=>[a.canCreateContracts?(n(),b("div",ra,[s(t(V),{href:`/admin/contratos/create?proyecto_id=${a.proyecto.id}`},{default:o(()=>[s(t(D),null,{default:o(()=>[s(t(J),{class:"mr-2 h-4 w-4"}),e[33]||(e[33]=d(" Nuevo Contrato ",-1))]),_:1})]),_:1},8,["href"])])):p("",!0),a.proyecto.contratos&&a.proyecto.contratos.length>0?(n(),y(t(C),{key:1},{default:o(()=>[s(t(T),null,{default:o(()=>[s(t(B),null,{default:o(()=>[...e[34]||(e[34]=[d("Contratos del Proyecto",-1)])]),_:1}),s(t(ne),null,{default:o(()=>[...e[35]||(e[35]=[d(" Lista de contratos asociados a este proyecto ",-1)])]),_:1})]),_:1}),s(t(q),null,{default:o(()=>[r("div",ia,[s(Se,{contratos:a.proyecto.contratos,"show-proyecto":!1,"show-actions":!0,"actions-style":"buttons"},null,8,["contratos"])])]),_:1})]),_:1})):(n(),y(t(C),{key:2},{default:o(()=>[s(t(q),{class:"py-8"},{default:o(()=>[r("div",la,[s(t(W),{class:"mx-auto h-12 w-12 text-gray-400"}),e[37]||(e[37]=r("p",{class:"mt-2 text-sm text-gray-600"},"No hay contratos asociados",-1)),a.canCreateContracts?(n(),y(t(V),{key:0,href:`/admin/contratos/create?proyecto_id=${a.proyecto.id}`,class:"mt-4 inline-block"},{default:o(()=>[s(t(D),{variant:"outline"},{default:o(()=>[s(t(J),{class:"mr-2 h-4 w-4"}),e[36]||(e[36]=d(" Crear primer contrato ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])]),_:1})]),_:1}))]),_:1}),s(t(L),{value:"hitos",class:"space-y-4 mt-6"},{default:o(()=>[a.canViewHitos?(n(),y(vt,{key:0,hitos:a.proyecto.hitos||[],"proyecto-id":a.proyecto.id,estadisticas:a.estadisticasHitos,"show-stats":!0,"show-header":!0,"show-actions":!0,"show-view-all":!0,"can-create":a.canCreateHitos,"can-edit":a.canEditHitos,"can-delete":a.canDeleteHitos,"can-manage-deliverables":a.canManageEntregables,"empty-message":"No hay hitos definidos para este proyecto",onView:ue,onEdit:me,onDelete:fe,onDuplicate:ye,onAddEntregable:ge,onViewEntregables:ve},null,8,["hitos","proyecto-id","estadisticas","can-create","can-edit","can-delete","can-manage-deliverables"])):p("",!0)]),_:1}),s(t(L),{value:"evidencias",class:"space-y-4 mt-6"},{default:o(()=>[G.value.length>0?(n(),y(He,{key:0,modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),contratos:a.proyecto.contratos||[],evidencias:G.value},null,8,["modelValue","contratos","evidencias"])):p("",!0),ee.value.length>0?(n(),b("div",na,[s(t(Ve),{type:"multiple",class:"space-y-4",collapsible:""},{default:o(()=>[(n(!0),b(z,null,O(ee.value,l=>(n(),y(t(Pe),{key:l.contrato.id,value:`contrato-${l.contrato.id}`,class:"border rounded-lg bg-card"},{default:o(()=>[s(t(Te),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:o(()=>[r("div",da,[r("div",ca,[s(t(W),{class:"h-5 w-5 text-gray-500"}),r("div",ua,[r("div",ma,c(l.contrato.nombre),1),r("div",fa,c(l.contrato.numero_contrato||"Sin número"),1)])]),r("div",ya,[s(t(H),{variant:"secondary"},{default:o(()=>[d(c(l.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),s(t(V),{href:`/admin/contratos/${l.contrato.id}`,onClick:e[3]||(e[3]=ae(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:o(()=>[e[38]||(e[38]=d(" Ver contrato ",-1)),s(t(Je),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),s(t(Be),{class:"px-4 pb-4"},{default:o(()=>[s(t(Ee),null,{default:o(()=>[s(t(ke),null,{default:o(()=>[s(t(se),null,{default:o(()=>[s(t(j),null,{default:o(()=>[...e[39]||(e[39]=[d("Tipo",-1)])]),_:1}),s(t(j),null,{default:o(()=>[...e[40]||(e[40]=[d("Obligación",-1)])]),_:1}),s(t(j),null,{default:o(()=>[...e[41]||(e[41]=[d("Descripción",-1)])]),_:1}),s(t(j),null,{default:o(()=>[...e[42]||(e[42]=[d("Usuario",-1)])]),_:1}),s(t(j),null,{default:o(()=>[...e[43]||(e[43]=[d("Estado",-1)])]),_:1}),s(t(j),null,{default:o(()=>[...e[44]||(e[44]=[d("Fecha",-1)])]),_:1}),s(t(j),{class:"text-right"},{default:o(()=>[...e[45]||(e[45]=[d("Acciones",-1)])]),_:1})]),_:1})]),_:1}),s(t(qe),null,{default:o(()=>[(n(!0),b(z,null,O(l.evidencias,f=>(n(),y(t(se),{key:f.id,class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800"},{default:o(()=>[s(t(V),{href:`/admin/contratos/${f.contrato_id}/evidencias/${f.id}`,class:"contents"},{default:o(()=>[s(t(A),null,{default:o(()=>[s(t(H),{variant:"outline"},{default:o(()=>[d(c(f.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),s(t(A),null,{default:o(()=>[d(c(f.obligacion_titulo),1)]),_:2},1024),s(t(A),null,{default:o(()=>[r("span",ga,c(f.descripcion||"-"),1)]),_:2},1024),s(t(A),null,{default:o(()=>{var te;return[r("span",va,c(((te=f.usuario)==null?void 0:te.name)||"-"),1)]}),_:2},1024),s(t(A),null,{default:o(()=>[s(t(H),{class:U({"bg-yellow-100 text-yellow-800":f.estado==="pendiente","bg-green-100 text-green-800":f.estado==="aprobada","bg-red-100 text-red-800":f.estado==="rechazada"})},{default:o(()=>[d(c(f.estado),1)]),_:2},1032,["class"])]),_:2},1024),s(t(A),null,{default:o(()=>[d(c(v(f.created_at)),1)]),_:2},1024),s(t(A),{class:"text-right"},{default:o(()=>[f.archivo_url?(n(),b("a",{key:0,href:f.archivo_url,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800",onClick:e[4]||(e[4]=ae(()=>{},["stop"]))},[s(t(Ke),{class:"h-4 w-4"})],8,pa)):p("",!0)]),_:2},1024)]),_:2},1032,["href"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):G.value.length===0?(n(),y(t(C),{key:2},{default:o(()=>[s(t(q),{class:"py-8"},{default:o(()=>[r("div",xa,[s(t(Y),{class:"mx-auto h-12 w-12 text-gray-400"}),e[46]||(e[46]=r("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias cargadas",-1)),e[47]||(e[47]=r("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(n(),y(t(C),{key:3},{default:o(()=>[s(t(q),{class:"py-8"},{default:o(()=>[r("div",ha,[s(t(Y),{class:"mx-auto h-12 w-12 text-gray-400"}),e[48]||(e[48]=r("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),e[49]||(e[49]=r("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1}))]),_:1}),s(t(L),{value:"actividad",class:"space-y-4 mt-6"},{default:o(()=>[a.activities&&a.activities.length>0?(n(),y(je,{key:0,modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=l=>x.value=l),usuarios:a.usuariosActividades,"context-level":"proyecto"},null,8,["modelValue","usuarios"])):p("",!0),s(Ae,{activities:xe.value,title:"Historial de Actividad",description:"Registro completo de cambios y eventos del proyecto, hitos y entregables","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{co as default};
