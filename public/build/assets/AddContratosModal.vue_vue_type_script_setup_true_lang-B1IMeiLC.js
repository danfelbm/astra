import{e as X,_ as Y,a as Z,b as ee,c as te,d as ae}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BNj1aFxp.js";import{_ as k}from"./createLucideIcon-P3NRsumo.js";import{_ as se}from"./Input.vue_vue_type_script_setup_true_lang-CQKpRggb.js";import{_ as oe}from"./Checkbox.vue_vue_type_script_setup_true_lang-BO90EcIa.js";import{_ as le}from"./index-BD9cFrTB.js";import{_ as ne,a as re,b as ie}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-2qwCWigq.js";import{_ as de,a as ue,b as ce,c as me,e as fe,d as U}from"./index-0gpCGcC3.js";import{d as ve,c as L,r as v,p as V,b as I,f as a,w as n,e as s,g as l,h as _,t as r,i as c,j as y,n as M,F as O,k as D,a as pe,m as i}from"./app-DvZ1-K7a.js";import{t as R}from"./index-Bbh0mYdX.js";import{g as _e,f as ye}from"./contratos-BiUTbrRP.js";import{C as he}from"./chevrons-up-down-B1jhx-SJ.js";import{C as q}from"./check-D7HNl1Oq.js";import{S as xe}from"./search-Bc6iXQXx.js";import{L as A}from"./loader-circle-BuYOFQXj.js";import{F as ge}from"./file-text-BbQo20m-.js";import{C as be}from"./chevron-left-CzM7x7pJ.js";import{C as ke}from"./chevron-right-DqS2t5k7.js";import{f as Ce,e as $e}from"./es-BDPlFIsO.js";import{p as we}from"./parseISO-DFjB8F03.js";const Se={class:"space-y-4"},Pe={class:"grid gap-4 md:grid-cols-2"},Be={key:0},Ve={class:"truncate"},Ie={class:"relative"},Me={class:"border rounded-lg"},Te={class:"max-h-96 overflow-y-auto p-4"},Ee={key:0,class:"flex items-center justify-center py-8"},je={key:1,class:"space-y-2"},ze=["for"],Fe={class:"font-medium"},Ne={key:0,class:"text-sm text-muted-foreground"},Ue={class:"flex items-center gap-2 mt-1"},Le={class:"text-xs text-muted-foreground"},Oe={class:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground"},De={key:0},Re={key:0,class:"font-medium"},qe={key:2,class:"text-center py-8"},Ae={class:"text-muted-foreground"},Qe={key:0,class:"border-t px-4 py-3"},Ge={class:"flex items-center justify-between"},He={class:"text-sm text-muted-foreground"},Je={key:0},Ke={class:"flex gap-2"},We={class:"flex items-center justify-between w-full"},Xe={class:"text-sm text-muted-foreground"},Ye={key:0,class:"font-medium text-foreground"},Ze={key:1},et={class:"flex gap-2"},tt={key:1},bt=ve({__name:"AddContratosModal",props:{modelValue:{type:Boolean},title:{default:"Seleccionar Contrato"},description:{default:"Selecciona el contrato que deseas utilizar"},searchEndpoint:{},excludedIds:{},proyectos:{},proyectoId:{},estadosPermitidos:{},maxSelection:{},submitButtonText:{default:"Seleccionar"},searchPlaceholder:{default:"Buscar por nombre, proyecto o contraparte..."},emptyMessage:{default:"Escribe para buscar contratos disponibles"},noResultsMessage:{default:"No se encontraron contratos con esa búsqueda"}},emits:["update:modelValue","submit"],setup(m,{emit:Q}){const d=m,T=Q,h=L({get:()=>d.modelValue,set:o=>T("update:modelValue",o)}),g=v(""),x=v([]),u=v([]),P=v(!1),E=v(!1),C=v(!1),p=v(d.proyectoId||null),$=v(!1),f=v(1),b=v(1),w=v(0),G=L(()=>!p.value||!d.proyectos?null:d.proyectos.find(o=>o.id===p.value)),S=async(o=1)=>{P.value=!0;try{const t={page:o,search:g.value};p.value&&(t.proyecto_id=p.value),d.estadosPermitidos&&d.estadosPermitidos.length>0&&(t.estados=d.estadosPermitidos),d.excludedIds&&d.excludedIds.length>0&&(t.excluded_ids=d.excludedIds);const e=await pe.get(d.searchEndpoint,{params:t});e.data.contratos?(x.value=e.data.contratos||[],f.value=e.data.current_page||1,b.value=e.data.last_page||1,w.value=e.data.total||0):(x.value=e.data.data||[],f.value=e.data.current_page||1,b.value=e.data.last_page||1,w.value=e.data.total||0)}catch(t){console.error("Error buscando contratos:",t),R.error("Error al buscar contratos",{description:"Por favor intenta nuevamente",duration:3e3}),x.value=[]}finally{P.value=!1}};let B=null;V(g,()=>{B&&clearTimeout(B),B=setTimeout(()=>{h.value&&(f.value=1,S(1))},500)}),V(p,()=>{h.value&&C.value&&(f.value=1,S(1))}),V(h,o=>{o&&!C.value&&(C.value=!0,S(1)),o||(u.value=[],g.value="",x.value=[],f.value=1,C.value=!1,d.proyectoId||(p.value=null))});const H=(o,t)=>{if(t){if(d.maxSelection&&u.value.length>=d.maxSelection){R.warning(`Máximo ${d.maxSelection} contrato(s) permitido(s)`);return}u.value.includes(o)||u.value.push(o)}else{const e=u.value.indexOf(o);e>-1&&u.value.splice(e,1)}},J=o=>u.value.includes(o),j=o=>{f.value=o,S(o)},K=async()=>{if(u.value.length===0)return;const o=x.value.filter(t=>u.value.includes(t.id));T("submit",{contratoIds:u.value,contratos:o}),h.value=!1},z=o=>{p.value=o,$.value=!1},F=o=>{if(!o)return"-";try{return Ce(we(o),"dd MMM yyyy",{locale:$e})}catch{return o}},W=o=>({borrador:"secondary",activo:"success",finalizado:"default",cancelado:"destructive"})[o]||"secondary";return(o,t)=>(i(),I(a(X),{open:h.value,"onUpdate:open":t[6]||(t[6]=e=>h.value=e)},{default:n(()=>[s(a(Y),{class:"max-w-3xl"},{default:n(()=>[s(a(Z),null,{default:n(()=>[s(a(ee),null,{default:n(()=>[_(r(m.title),1)]),_:1}),s(a(te),null,{default:n(()=>[_(r(m.description),1)]),_:1})]),_:1}),l("div",Se,[l("div",Pe,[m.proyectos&&m.proyectos.length>0&&!m.proyectoId?(i(),c("div",Be,[t[9]||(t[9]=l("label",{class:"text-sm font-medium"},"Filtrar por Proyecto",-1)),s(a(ne),{open:$.value,"onUpdate:open":t[1]||(t[1]=e=>$.value=e)},{default:n(()=>[s(a(re),{asChild:""},{default:n(()=>[s(a(k),{variant:"outline",role:"combobox","aria-expanded":$.value,class:"w-full justify-between"},{default:n(()=>{var e;return[l("span",Ve,r(((e=G.value)==null?void 0:e.nombre)||"Todos los proyectos"),1),s(a(he),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]}),_:1},8,["aria-expanded"])]),_:1}),s(a(ie),{class:"w-[300px] p-0"},{default:n(()=>[s(a(de),null,{default:n(()=>[s(a(ue),{placeholder:"Buscar proyecto..."}),s(a(ce),null,{default:n(()=>[s(a(me),null,{default:n(()=>[...t[7]||(t[7]=[_("No se encontraron proyectos.",-1)])]),_:1}),s(a(fe),null,{default:n(()=>[s(a(U),{value:"todos",onSelect:t[0]||(t[0]=e=>z(null))},{default:n(()=>[s(a(q),{class:M(["mr-2 h-4 w-4",p.value?"opacity-0":"opacity-100"])},null,8,["class"]),t[8]||(t[8]=_(" Todos los proyectos ",-1))]),_:1}),(i(!0),c(O,null,D(m.proyectos,e=>(i(),I(a(U),{key:e.id,value:e.nombre,onSelect:N=>z(e.id)},{default:n(()=>[s(a(q),{class:M(["mr-2 h-4 w-4",p.value===e.id?"opacity-100":"opacity-0"])},null,8,["class"]),_(" "+r(e.nombre),1)]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])):y("",!0),l("div",{class:M({"md:col-span-2":!m.proyectos||m.proyectos.length===0||m.proyectoId})},[t[10]||(t[10]=l("label",{class:"text-sm font-medium"},"Buscar Contratos",-1)),l("div",Ie,[s(a(xe),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s(a(se),{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=e=>g.value=e),placeholder:m.searchPlaceholder,type:"text",class:"pl-10"},null,8,["modelValue","placeholder"])])],2)]),l("div",Me,[l("div",Te,[P.value?(i(),c("div",Ee,[s(a(A),{class:"h-8 w-8 animate-spin text-muted-foreground"}),t[11]||(t[11]=l("span",{class:"ml-2 text-muted-foreground"},"Buscando contratos...",-1))])):x.value.length>0?(i(),c("div",je,[(i(!0),c(O,null,D(x.value,e=>(i(),c("div",{key:e.id,class:"flex items-start space-x-3 py-3 px-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded transition-colors border-b last:border-b-0"},[s(a(oe),{id:`contrato-${e.id}`,checked:J(e.id),"onUpdate:checked":N=>H(e.id,N),class:"mt-1"},null,8,["id","checked","onUpdate:checked"]),l("label",{for:`contrato-${e.id}`,class:"flex-1 cursor-pointer"},[l("div",Fe,r(e.nombre),1),e.proyecto?(i(),c("div",Ne,r(e.proyecto.nombre),1)):y("",!0),l("div",Ue,[s(a(le),{variant:W(e.estado),class:"text-xs"},{default:n(()=>[_(r(a(_e)(e.estado)),1)]),_:2},1032,["variant"]),l("span",Le,r(e.tipo),1)]),l("div",Oe,[l("span",null,[_(r(F(e.fecha_inicio))+" ",1),e.fecha_fin?(i(),c("span",De," → "+r(F(e.fecha_fin)),1)):y("",!0)]),e.monto_total?(i(),c("span",Re,r(a(ye)(e.monto_total,e.moneda)),1)):y("",!0)])],8,ze)]))),128))])):(i(),c("div",qe,[s(a(ge),{class:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),l("p",Ae,r(g.value||p.value?m.noResultsMessage:m.emptyMessage),1)]))]),b.value>1?(i(),c("div",Qe,[l("div",Ge,[l("span",He,[_(" Página "+r(f.value)+" de "+r(b.value)+" ",1),w.value>0?(i(),c("span",Je," ("+r(w.value)+" contratos disponibles) ",1)):y("",!0)]),l("div",Ke,[s(a(k),{variant:"outline",size:"sm",disabled:f.value===1,onClick:t[3]||(t[3]=e=>j(f.value-1))},{default:n(()=>[s(a(be),{class:"h-4 w-4"})]),_:1},8,["disabled"]),s(a(k),{variant:"outline",size:"sm",disabled:f.value===b.value,onClick:t[4]||(t[4]=e=>j(f.value+1))},{default:n(()=>[s(a(ke),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])])):y("",!0)])]),s(a(ae),null,{default:n(()=>[l("div",We,[l("span",Xe,[u.value.length>0?(i(),c("span",Ye,r(u.value.length)+" contrato(s) seleccionado(s) ",1)):(i(),c("span",Ze," Selecciona contratos para continuar "))]),l("div",et,[s(a(k),{variant:"outline",onClick:t[5]||(t[5]=e=>h.value=!1)},{default:n(()=>[...t[12]||(t[12]=[_(" Cancelar ",-1)])]),_:1}),s(a(k),{onClick:K,disabled:u.value.length===0||E.value},{default:n(()=>[E.value?(i(),I(a(A),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):y("",!0),_(" "+r(m.submitButtonText)+" ",1),u.value.length>0?(i(),c("span",tt," ("+r(u.value.length)+") ",1)):y("",!0)]),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{bt as _};
