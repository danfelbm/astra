import{d as te,u as ae,r as b,c as V,p as N,o as re,G as se,i as h,e as t,g as s,f as e,q as ie,J as le,b as f,j as p,w as i,h as u,t as v,m as d,F as q,k as ne,aj as ue,s as de}from"./app-Bf6d3A8V.js";import{_ as z}from"./createLucideIcon-YOpGmVvB.js";import{c as B,_ as E,a as M,b as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-CWsLvUG8.js";import{_ as G}from"./CardDescription.vue_vue_type_script_setup_true_lang-CHxShqt8.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-CB0Htk7P.js";import{_ as S}from"./Label.vue_vue_type_script_setup_true_lang-BacdJgZB.js";import{_ as I,a as R}from"./index-Cqi08Cdd.js";import{_ as me}from"./index-BnkuBoco.js";import{_ as ce}from"./Progress.vue_vue_type_script_setup_true_lang-BxN1b3nJ.js";import{D as fe}from"./DynamicFormRenderer-icUeuLx8.js";import{u as pe}from"./useAutoSave-D7NbUun4.js";import{t as _}from"./index-B7Xm9lmr.js";import{C as O}from"./circle-check-OoCOUsSh.js";import{C as W}from"./circle-alert-ArH3XEnl.js";import{L as J}from"./loader-circle-BqoIAG-c.js";import{C as ve}from"./clock-DkGIQVTd.js";import{S as _e}from"./save-KeojBsvl.js";import{S as ge}from"./send-Ct-MIBzO.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-YyYkLrGZ.js";import"./VisuallyHidden-CvJLPDA7.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-BCxhgvZ-.js";import"./check-JaT99j2w.js";import"./floating-ui.vue-EE3Fw0dW.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-D-xJOVx0.js";import"./index-DaC273bK.js";import"./Textarea.vue_vue_type_script_setup_true_lang-B_H8uLPM.js";import"./plus-Ch8CjZIN.js";import"./file-text-dmr_h2lM.js";import"./user-BE9TqBpG.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-T8dntDpU.js";import"./RovingFocusItem-DsHP-DSS.js";import"./utils-DMHAqwvu.js";import"./VisuallyHiddenInput-Da1uB7Be.js";import"./circle-CCp_E0il.js";import"./users-CJyDlKkF.js";import"./index-Bl_xx9UH.js";import"./FileUploadField.vue_vue_type_script_setup_true_lang-D_6WHXMz.js";import"./useFileUpload-Bkqclx4b.js";import"./upload-B58PBvLt.js";import"./file-DCKaDObP.js";import"./eye-DsaEmmIA.js";import"./download-CE6qY2cb.js";import"./x-CY3swbP8.js";import"./useConditionalFields-B42EFSCD.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BB-dSUA7.js";import"./calendar-B695ca8q.js";import"./grip-vertical-CE_-I2h7.js";import"./trash-2-B2RPIbPy.js";import"./debounce-Cj3IoKoK.js";const he={class:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"},xe={class:"bg-white border-b"},we={class:"container mx-auto px-4 py-6"},ye={class:"max-w-4xl mx-auto"},Ve={class:"text-3xl font-bold text-gray-900"},ke={key:1,class:"text-gray-600 mt-2"},Se={class:"container mx-auto px-4 py-8"},Ce={class:"max-w-4xl mx-auto"},Fe={class:"flex items-center justify-between mb-2"},$e={class:"text-sm text-muted-foreground"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"flex items-center gap-2 text-green-600"},De={class:"list-disc list-inside mt-2"},Te={class:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t shadow-lg z-50"},Le={class:"container mx-auto px-4"},Ue={class:"max-w-4xl mx-auto py-4"},je={class:"flex items-center justify-between"},Ae={class:"flex items-center gap-4"},Ne={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},qe={key:1,class:"flex items-center gap-2 text-sm text-green-600"},ze={class:"hidden md:flex items-center gap-2 text-sm text-muted-foreground"},Me={class:"flex items-center gap-2"},Pe=te({__name:"Show",props:{formulario:{},respuestaBorrador:{},esVisitante:{type:Boolean},candidatosElegibles:{}},setup(m){var j,A;const r=m,l=ae({respuestas:((j=r.respuestaBorrador)==null?void 0:j.respuestas)||{},nombre_visitante:"",email_visitante:"",telefono_visitante:"",documento_visitante:"",captcha:""}),w=b((()=>{var o;const a={};return(o=r.respuestaBorrador)!=null&&o.respuestas&&Object.assign(a,r.respuestaBorrador.respuestas),r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.forEach(n=>{if(!(n.id in a))switch(n.type){case"checkbox":a[n.id]=!1;break;case"number":a[n.id]=0;break;case"select":case"radio":a[n.id]="";break;default:a[n.id]=""}}),a})());b(0),V(()=>1);const C=V(()=>r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.length>0),c=b(!1),K=b(!0),F=b(null),g=V(()=>{const a=r.formulario.configuracion_campos.length,o=Object.keys(l.respuestas).filter(n=>{const x=l.respuestas[n];return x!==null&&x!==""&&x!==void 0}).length;return a>0?Math.round(o/a*100):0}),{state:D,isSaving:y,hasSaved:T,saveNow:H,startWatching:$,stopWatching:L,clearLocalStorage:Q}=pe(w||b({}),{url:route("api.formularios.autosave"),resourceId:((A=r.respuestaBorrador)==null?void 0:A.id)||null,resourceIdField:"respuesta_id",debounceTime:3e3,showNotifications:!1,useLocalStorage:!0,localStorageKey:`formulario_${r.formulario.slug}_draft`,additionalData:{formulario_id:r.formulario.id}});N(w,a=>{a&&(l.respuestas=a)},{deep:!0}),N(()=>D.value.status,a=>{a==="saved"&&(F.value=D.value.lastSaved)}),re(()=>{r.esVisitante||$(),window.addEventListener("beforeunload",U)}),se(()=>{r.esVisitante||L(),window.removeEventListener("beforeunload",U)});const U=a=>{(y.value||g.value>0&&g.value<100)&&(a.preventDefault(),a.returnValue="¿Estás seguro de que quieres salir? Los cambios no guardados se perderán.")},X=()=>{const a=r.formulario.configuracion_campos||[];for(const o of a)if(o.required&&!l.respuestas[o.id])return _.error(`El campo "${o.title}" es requerido`),!1;if(r.esVisitante){if(!l.nombre_visitante||!l.email_visitante)return _.error("Por favor completa tu nombre y email"),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email_visitante))return _.error("Por favor ingresa un email válido"),!1}return!0},Y=async()=>{if(X()){c.value=!0,r.esVisitante||L();try{const a={...l.data(),formulario_id:r.formulario.id};await de.post(route("formularios.store",r.formulario.slug),a,{preserveScroll:!0,onSuccess:()=>{Q(),_.success("Formulario enviado exitosamente")},onError:o=>{_.error("Error al enviar el formulario"),console.error(o),c.value=!1,r.esVisitante||$()}})}catch{_.error("Error inesperado al enviar el formulario"),c.value=!1,r.esVisitante||$()}}},Z=()=>{r.esVisitante||(H(),_.success("Borrador guardado"))},ee=V(()=>{if(!F.value)return"";const o=Math.floor((new Date().getTime()-F.value.getTime())/1e3);return o<60?"hace unos segundos":o<3600?`hace ${Math.floor(o/60)} minutos`:o<86400?`hace ${Math.floor(o/3600)} horas`:"hace más de un día"}),oe=a=>{w.value=a||{}};return(a,o)=>(d(),h(q,null,[t(e(ie),{title:m.formulario.titulo},null,8,["title"]),s("div",he,[s("div",xe,[s("div",we,[s("div",ye,[m.formulario.categoria?(d(),f(e(me),{key:0,class:"mb-2"},{default:i(()=>[u(v(m.formulario.categoria.nombre),1)]),_:1})):p("",!0),s("h1",Ve,v(m.formulario.titulo),1),m.formulario.descripcion?(d(),h("p",ke,v(m.formulario.descripcion),1)):p("",!0)])])]),s("div",Se,[s("div",Ce,[t(e(E),{class:"mb-6"},{default:i(()=>[t(e(B),{class:"py-4"},{default:i(()=>[s("div",Fe,[o[4]||(o[4]=s("span",{class:"text-sm font-medium"},"Progreso del formulario",-1)),s("span",$e,v(g.value)+"% completado",1)]),t(e(ce),{value:g.value,class:"h-2"},null,8,["value"])]),_:1})]),_:1}),m.esVisitante?(d(),f(e(E),{key:0,class:"mb-6"},{default:i(()=>[t(e(M),null,{default:i(()=>[t(e(P),null,{default:i(()=>[...o[5]||(o[5]=[u("Información de contacto",-1)])]),_:1}),t(e(G),null,{default:i(()=>[...o[6]||(o[6]=[u(" Por favor proporciona tus datos para poder contactarte ",-1)])]),_:1})]),_:1}),t(e(B),{class:"space-y-4"},{default:i(()=>[s("div",Be,[s("div",null,[t(e(S),{htmlFor:"nombre"},{default:i(()=>[...o[7]||(o[7]=[u("Nombre completo *",-1)])]),_:1}),t(e(k),{id:"nombre",modelValue:e(l).nombre_visitante,"onUpdate:modelValue":o[0]||(o[0]=n=>e(l).nombre_visitante=n),placeholder:"Tu nombre completo",disabled:c.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(S),{htmlFor:"email"},{default:i(()=>[...o[8]||(o[8]=[u("Correo electrónico *",-1)])]),_:1}),t(e(k),{id:"email",type:"email",modelValue:e(l).email_visitante,"onUpdate:modelValue":o[1]||(o[1]=n=>e(l).email_visitante=n),placeholder:"tu@email.com",disabled:c.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(S),{htmlFor:"telefono"},{default:i(()=>[...o[9]||(o[9]=[u("Teléfono",-1)])]),_:1}),t(e(k),{id:"telefono",modelValue:e(l).telefono_visitante,"onUpdate:modelValue":o[2]||(o[2]=n=>e(l).telefono_visitante=n),placeholder:"Tu número de teléfono",disabled:c.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(S),{htmlFor:"documento"},{default:i(()=>[...o[10]||(o[10]=[u("Documento de identidad",-1)])]),_:1}),t(e(k),{id:"documento",modelValue:e(l).documento_visitante,"onUpdate:modelValue":o[3]||(o[3]=n=>e(l).documento_visitante=n),placeholder:"Tu número de documento",disabled:c.value},null,8,["modelValue","disabled"])])])]),_:1})]),_:1})):p("",!0),t(e(E),{class:"mb-20"},{default:i(()=>[t(e(M),null,{default:i(()=>[t(e(P),null,{default:i(()=>[...o[11]||(o[11]=[u("Completa el formulario",-1)])]),_:1}),!m.esVisitante&&e(T)?(d(),f(e(G),{key:0},{default:i(()=>[s("div",Ee,[t(e(O),{class:"h-4 w-4"}),u(" Autoguardado "+v(ee.value),1)])]),_:1})):p("",!0)]),_:1}),t(e(B),null,{default:i(()=>[C.value?p("",!0):(d(),f(e(I),{key:0,variant:"destructive",class:"mb-4"},{default:i(()=>[t(e(W),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>[...o[12]||(o[12]=[u(" Este formulario no tiene campos configurados. Por favor, contacta al administrador. ",-1)])]),_:1})]),_:1})),C.value?(d(),f(fe,{key:1,fields:m.formulario.configuracion_campos||[],"model-value":w.value||{},disabled:c.value,"candidatos-elegibles":r.candidatosElegibles||{},context:"formulario","onUpdate:modelValue":oe},null,8,["fields","model-value","disabled","candidatos-elegibles"])):p("",!0)]),_:1})]),_:1}),e(l).errors&&Object.keys(e(l).errors).length>0?(d(),f(e(I),{key:1,class:"mb-6",variant:"destructive"},{default:i(()=>[t(e(W),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>[s("ul",De,[(d(!0),h(q,null,ne(e(l).errors,(n,x)=>(d(),h("li",{key:x},v(n),1))),128))])]),_:1})]),_:1})):p("",!0)])]),le(s("div",Te,[s("div",Le,[s("div",Ue,[s("div",je,[s("div",Ae,[e(y)?(d(),h("div",Ne,[t(e(J),{class:"h-4 w-4 animate-spin"}),o[13]||(o[13]=u(" Guardando... ",-1))])):e(T)&&!m.esVisitante?(d(),h("div",qe,[t(e(O),{class:"h-4 w-4"}),o[14]||(o[14]=u(" Guardado ",-1))])):p("",!0),s("div",ze,[t(e(ve),{class:"h-4 w-4"}),u(" "+v(g.value)+"% completado ",1)])]),s("div",Me,[m.esVisitante?p("",!0):(d(),f(e(z),{key:0,variant:"outline",size:"sm",onClick:Z,disabled:e(y)||c.value},{default:i(()=>[t(e(_e),{class:"mr-2 h-4 w-4"}),o[15]||(o[15]=u(" Guardar borrador ",-1))]),_:1},8,["disabled"])),t(e(z),{size:"sm",onClick:Y,disabled:c.value||e(y)||g.value===0||!C.value},{default:i(()=>[c.value?(d(),f(e(J),{key:1,class:"mr-2 h-4 w-4 animate-spin"})):(d(),f(e(ge),{key:0,class:"mr-2 h-4 w-4"})),u(" "+v(c.value?"Enviando...":"Enviar formulario"),1)]),_:1},8,["disabled"])])])])])],512),[[ue,K.value]])])],64))}}),Mo=be(Pe,[["__scopeId","data-v-77040375"]]);export{Mo as default};
