import{c as S,_ as z}from"./createLucideIcon-CDD88oTc.js";import{d as J,r as x,c as M,i as h,F as V,b as m,j as E,e as t,f as a,w as s,k as P,g as n,h as i,t as c,s as D,m as u,v as q,l as K,n as Q}from"./app-DB52i0Vi.js";import{c as N,_ as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-DhGz-PEe.js";import{_ as F}from"./index-CBsS3L2Y.js";import{_ as W,a as Y,b as L,c as v,d as Z,e as p}from"./TableHeader.vue_vue_type_script_setup_true_lang-C-HreWb1.js";import{_ as ee,a as ae,b as te,c as se,d as oe}from"./AccordionContent.vue_vue_type_script_setup_true_lang-fr91myHt.js";import{e as le,_ as re,a as ne,b as ie,c as de,d as ue}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Lbr02lfH.js";import{_ as ce,a as fe,b as me,c as _e,d as I}from"./SelectValue.vue_vue_type_script_setup_true_lang-CZdpgezo.js";import{_ as ve}from"./Textarea.vue_vue_type_script_setup_true_lang-7R2GJmbJ.js";import{_ as pe}from"./Label.vue_vue_type_script_setup_true_lang-DNBAD1R6.js";import{t as B}from"./index-B7CL-mW0.js";import{I as R}from"./image-C_zcE-Hu.js";import{F as be}from"./file-text-P5qiexdG.js";import{E as ye}from"./external-link-7U9r7dL8.js";import{E as xe}from"./eye-DCSEm6gP.js";import{D as he}from"./download-D5H5Xxnp.js";import{C as ge}from"./circle-check-big-Dcr0bDve.js";import{C as $e}from"./circle-x-9HpFn4h6.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=S("BanIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=S("CirclePauseIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=S("MilestoneIcon",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M4 6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h13a2 2 0 0 0 1.152-.365l3.424-2.317a1 1 0 0 0 0-1.635l-3.424-2.318A2 2 0 0 0 17 6z",key:"1btarq"}]]),ke={key:1,class:"mt-4"},Ee={class:"flex items-center justify-between w-full pr-4"},we={class:"flex items-center gap-3"},Ce={class:"text-left"},ze={class:"font-semibold"},Ve={class:"text-sm text-gray-500"},De={class:"flex items-center gap-3"},Be={class:"text-sm text-gray-600"},Me={class:"text-sm"},Fe={class:"flex items-center justify-end gap-2"},Ie=["href"],Se={class:"text-center"},je={class:"text-center"},Ae={class:"space-y-4 py-4"},oa=J({__name:"EvidenciasDisplay",props:{contratos:{default:()=>[]},proyectoId:{},modo:{},puedeGestionarEstado:{type:Boolean,default:!1},formatDate:{}},setup(_){const b=_,d=x({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),g=x(!1),w=x(null),f=x(null),$=x(""),k=x(!1),C=M(()=>{const o=[];return b.contratos&&b.contratos.forEach(e=>{e.obligaciones&&e.obligaciones.forEach(r=>{r.evidencias&&r.evidencias.forEach(l=>{o.push({...l,contrato_id:e.id,contrato_numero:e.numero_contrato,contrato_nombre:e.nombre,obligacion_titulo:r.titulo,_contrato:e})})})}),o}),O=M(()=>{let o=C.value;return d.value.contrato_id&&(o=o.filter(e=>e.contrato_id===d.value.contrato_id)),d.value.tipo&&(o=o.filter(e=>e.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(e=>e.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(e=>{var r;return((r=e.usuario)==null?void 0:r.id)===d.value.usuario_id})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(e=>{const r=new Date(e.created_at);if(d.value.fecha_inicio){const l=new Date(d.value.fecha_inicio);if(r<l)return!1}if(d.value.fecha_fin){const l=new Date(d.value.fecha_fin);if(l.setHours(23,59,59,999),r>l)return!1}return!0})),o}),j=M(()=>{const o={};return O.value.forEach(e=>{o[e.contrato_id]||(o[e.contrato_id]={contrato:e._contrato,evidencias:[]}),o[e.contrato_id].evidencias.push(e)}),Object.values(o)}),T=o=>b.modo==="admin"?`/admin/contratos/${o}`:`/miembro/mis-contratos/${o}`,G=(o,e)=>b.modo==="admin"?`/admin/contratos/${o}/evidencias/${e}`:`/miembro/mis-contratos/${o}/evidencias/${e}`,A=(o,e)=>{w.value=o,f.value=e,$.value="",g.value=!0},H=async()=>{if(!w.value||!f.value)return;k.value=!0;const o=`/api/proyectos/${b.proyectoId}/evidencias/${w.value.id}/${f.value}`;D.post(o,{observaciones:$.value||null},{preserveScroll:!0,onSuccess:()=>{B.success(f.value==="aprobar"?"Evidencia aprobada exitosamente":"Evidencia rechazada"),g.value=!1,w.value=null,f.value=null,$.value="",D.reload({only:["proyecto"]})},onError:e=>{B.error("Error al cambiar el estado de la evidencia"),console.error(e)},onFinish:()=>{k.value=!1}})},X=(o,e)=>{if(e===o.estado)return;const r=`/admin/proyectos/${b.proyectoId}/evidencias/${o.id}/cambiar-estado`;D.post(r,{estado:e,observaciones:null},{preserveScroll:!0,onSuccess:()=>{const l={pendiente:"Estado cambiado a Pendiente",aprobada:"Evidencia aprobada",rechazada:"Evidencia rechazada"};B.success(l[e]||"Estado actualizado"),D.reload({only:["proyecto"]})},onError:l=>{B.error("Error al cambiar el estado"),console.error(l)}})};return(o,e)=>(u(),h(V,null,[C.value.length>0?(u(),m(ee,{key:0,modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=r=>d.value=r),contratos:_.contratos||[],evidencias:C.value},null,8,["modelValue","contratos","evidencias"])):E("",!0),j.value.length>0?(u(),h("div",ke,[t(a(ae),{type:"multiple",class:"space-y-4",collapsible:""},{default:s(()=>[(u(!0),h(V,null,P(j.value,r=>(u(),m(a(te),{key:r.contrato.id,value:`contrato-${r.contrato.id}`,class:"border rounded-lg bg-card"},{default:s(()=>[t(a(se),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:s(()=>[n("div",Ee,[n("div",we,[t(a(be),{class:"h-5 w-5 text-gray-500"}),n("div",Ce,[n("div",ze,c(r.contrato.nombre),1),n("div",Ve,c(r.contrato.numero_contrato||"Sin número"),1)])]),n("div",De,[t(a(F),{variant:"secondary"},{default:s(()=>[i(c(r.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),t(a(q),{href:T(r.contrato.id),onClick:e[1]||(e[1]=K(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:s(()=>[e[5]||(e[5]=i(" Ver contrato ",-1)),t(a(ye),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),t(a(oe),{class:"px-4 pb-4"},{default:s(()=>[t(a(W),null,{default:s(()=>[t(a(Y),null,{default:s(()=>[t(a(L),null,{default:s(()=>[t(a(v),null,{default:s(()=>[...e[6]||(e[6]=[i("Tipo",-1)])]),_:1}),t(a(v),null,{default:s(()=>[...e[7]||(e[7]=[i("Obligación",-1)])]),_:1}),t(a(v),null,{default:s(()=>[...e[8]||(e[8]=[i("Descripción",-1)])]),_:1}),_.modo==="admin"?(u(),m(a(v),{key:0},{default:s(()=>[...e[9]||(e[9]=[i("Usuario",-1)])]),_:1})):E("",!0),t(a(v),null,{default:s(()=>[...e[10]||(e[10]=[i("Estado",-1)])]),_:1}),t(a(v),null,{default:s(()=>[...e[11]||(e[11]=[i("Fecha",-1)])]),_:1}),t(a(v),{class:"text-right"},{default:s(()=>[...e[12]||(e[12]=[i("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(a(Z),null,{default:s(()=>[(u(!0),h(V,null,P(r.evidencias,l=>(u(),m(a(L),{key:l.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:s(()=>[t(a(p),null,{default:s(()=>[t(a(F),{variant:"outline"},{default:s(()=>[i(c(l.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(a(p),null,{default:s(()=>[i(c(l.obligacion_titulo),1)]),_:2},1024),t(a(p),null,{default:s(()=>[n("span",Be,c(l.descripcion||"-"),1)]),_:2},1024),_.modo==="admin"?(u(),m(a(p),{key:0},{default:s(()=>{var y;return[n("span",Me,c(((y=l.usuario)==null?void 0:y.name)||"-"),1)]}),_:2},1024)):E("",!0),t(a(p),null,{default:s(()=>[t(a(F),{class:Q({"bg-yellow-100 text-yellow-800":l.estado==="pendiente","bg-green-100 text-green-800":l.estado==="aprobada","bg-red-100 text-red-800":l.estado==="rechazada"})},{default:s(()=>[i(c(l.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(a(p),null,{default:s(()=>[i(c(_.formatDate(l.created_at)),1)]),_:2},1024),t(a(p),{class:"text-right"},{default:s(()=>[n("div",Fe,[t(a(q),{href:G(l.contrato_id,l.id),class:"inline-flex items-center text-blue-600 hover:text-blue-800"},{default:s(()=>[t(a(xe),{class:"h-4 w-4"})]),_:1},8,["href"]),l.archivo_url?(u(),h("a",{key:0,href:l.archivo_url,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800"},[t(a(he),{class:"h-4 w-4"})],8,Ie)):E("",!0),_.modo==="admin"?(u(),m(a(ce),{key:1,"model-value":l.estado,"onUpdate:modelValue":y=>X(l,y)},{default:s(()=>[t(a(fe),{class:"h-8 w-32"},{default:s(()=>[t(a(me))]),_:1}),t(a(_e),null,{default:s(()=>[t(a(I),{value:"pendiente"},{default:s(()=>[...e[13]||(e[13]=[n("span",{class:"text-yellow-600"},"Pendiente",-1)])]),_:1}),t(a(I),{value:"aprobada"},{default:s(()=>[...e[14]||(e[14]=[n("span",{class:"text-green-600"},"Aprobada",-1)])]),_:1}),t(a(I),{value:"rechazada"},{default:s(()=>[...e[15]||(e[15]=[n("span",{class:"text-red-600"},"Rechazada",-1)])]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):_.puedeGestionarEstado&&l.estado==="pendiente"?(u(),h(V,{key:2},[t(a(z),{size:"sm",variant:"ghost",onClick:y=>A(l,"aprobar"),class:"h-8 w-8 p-0 text-green-600 hover:text-green-800 hover:bg-green-50"},{default:s(()=>[t(a(ge),{class:"h-4 w-4"})]),_:1},8,["onClick"]),t(a(z),{size:"sm",variant:"ghost",onClick:y=>A(l,"rechazar"),class:"h-8 w-8 p-0 text-red-600 hover:text-red-800 hover:bg-red-50"},{default:s(()=>[t(a($e),{class:"h-4 w-4"})]),_:1},8,["onClick"])],64)):E("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):C.value.length===0?(u(),m(a(U),{key:2,class:"mt-4"},{default:s(()=>[t(a(N),{class:"py-8"},{default:s(()=>[n("div",Se,[t(a(R),{class:"mx-auto h-12 w-12 text-gray-400"}),e[16]||(e[16]=n("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias cargadas",-1)),e[17]||(e[17]=n("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(u(),m(a(U),{key:3,class:"mt-4"},{default:s(()=>[t(a(N),{class:"py-8"},{default:s(()=>[n("div",je,[t(a(R),{class:"mx-auto h-12 w-12 text-gray-400"}),e[18]||(e[18]=n("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),e[19]||(e[19]=n("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1})),t(a(le),{open:g.value,"onUpdate:open":e[4]||(e[4]=r=>g.value=r)},{default:s(()=>[t(a(re),null,{default:s(()=>[t(a(ne),null,{default:s(()=>[t(a(ie),null,{default:s(()=>[i(c(f.value==="aprobar"?"Aprobar Evidencia":"Rechazar Evidencia"),1)]),_:1}),t(a(de),null,{default:s(()=>[i(c(f.value==="aprobar"?"Estás a punto de aprobar esta evidencia. Puedes agregar observaciones opcionales.":"Estás a punto de rechazar esta evidencia. Es recomendable agregar el motivo del rechazo."),1)]),_:1})]),_:1}),n("div",Ae,[n("div",null,[t(a(pe),{for:"observaciones"},{default:s(()=>[i(" Observaciones "+c(f.value==="rechazar"?"(recomendado)":"(opcional)"),1)]),_:1}),t(a(ve),{id:"observaciones",modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=r=>$.value=r),placeholder:f.value==="rechazar"?"Explica el motivo del rechazo...":"Agrega comentarios adicionales...",rows:"4",class:"mt-2"},null,8,["modelValue","placeholder"])])]),t(a(ue),null,{default:s(()=>[t(a(z),{variant:"outline",onClick:e[3]||(e[3]=r=>g.value=!1),disabled:k.value},{default:s(()=>[...e[20]||(e[20]=[i(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(a(z),{variant:f.value==="aprobar"?"default":"destructive",onClick:H,disabled:k.value},{default:s(()=>[i(c(k.value?"Procesando...":f.value==="aprobar"?"Aprobar":"Rechazar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])],64))}});export{aa as B,ta as C,sa as M,oa as _};
