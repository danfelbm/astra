import{d as Qe,k as X,c as U,w as de,s as Ze,a as p,o as u,j as q,i as j,f as o,e as m,b as i,u as e,g as w,t as _,F as G,r as H,bT as st,n as Y,C as it,v as ot,m as dt,W as nt,h as lt,Y as ut,bQ as ct,bG as ft,T as mt,X as gt}from"./app-DbkfmGRE.js";import{_ as ie}from"./AppLogo.vue_vue_type_script_setup_true_lang-DrqDJzr9.js";import{r as Q,_ as ne,a as le,j as Le,c as ue,M as oe,C as Pe,U as pt,af as O,b as Re,d as _t,e as vt,f as bt,g as yt,h as ht,ag as xt,i as kt,ah as St}from"./AppLayout.vue_vue_type_script_setup_true_lang-Bb4ttR9D.js";import{_ as wt}from"./Checkbox.vue_vue_type_script_setup_true_lang-DP4vGSOl.js";import{_ as re,a as me}from"./Label.vue_vue_type_script_setup_true_lang-B3pnbTjs.js";import{_ as Ct}from"./Progress.vue_vue_type_script_setup_true_lang-C-bR4Dpx.js";import{_ as $t}from"./Textarea.vue_vue_type_script_setup_true_lang-BaFmld0e.js";import{u as Et,a as Tt,_ as Vt,b as At,c as jt,d as Ot}from"./useConditionalFields-CJ5AdRCn.js";import{_ as ze}from"./CardDescription.vue_vue_type_script_setup_true_lang-Dvm7Op7K.js";import{_ as Ut,a as Me}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-CZalc8Ed.js";import{a as We,_ as Ge}from"./index-K3Izu5rz.js";import{_ as Ye}from"./AlertTitle.vue_vue_type_script_setup_true_lang-DPLrS_2t.js";import{A as Ft}from"./arrow-left-CqRZXtcX.js";import{C as ge}from"./clock-DDoJSg_v.js";import{C as Je}from"./circle-check-big-Cxe-71oo.js";import{U as It}from"./user-C0tXMJVT.js";import{S as Nt}from"./save-DKolvrXY.js";import"./index-B_GEekfi.js";import"./VisuallyHidden-Dz0_1hP9.js";import"./upload-BgEQ4_iw.js";import"./eye-CGMu6TTX.js";import"./download-JRR3AfzS.js";import"./plus-D2k-M-HN.js";import"./grip-vertical-BdDJOD-b.js";import"./trash-2-S3yb-2tw.js";import"./RovingFocusItem-DD6aXCsO.js";import"./VisuallyHiddenInput-D3dJvNHk.js";const qt={class:"space-y-4"},Dt={key:0,class:"text-center py-8"},Bt={key:2,class:"space-y-6"},Lt={key:0},Pt={class:"text-sm font-medium text-muted-foreground mb-3"},Rt={class:"space-y-3"},zt={class:"flex items-start gap-3"},Mt={class:"flex-1"},Wt={class:"flex items-center justify-between"},Gt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Yt={class:"flex items-center gap-2 text-muted-foreground"},Jt={class:"flex items-center gap-2 text-muted-foreground"},Kt={class:"flex items-center gap-2 text-muted-foreground"},Xt={key:0,class:"flex items-center gap-2 text-muted-foreground"},Ht={class:"mt-3 text-xs text-muted-foreground"},Qt={key:1},Zt={class:"text-sm font-medium text-muted-foreground mb-3"},ea={class:"space-y-3"},ta={class:"flex items-start gap-3"},aa={class:"flex-1"},ra={class:"flex items-center justify-between"},sa={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},ia={class:"flex items-center gap-2 text-muted-foreground"},oa={class:"flex items-center gap-2 text-muted-foreground"},da={class:"flex items-center gap-2 text-muted-foreground"},na={class:"mt-3 text-xs text-muted-foreground"},la={key:4,class:"mt-4 p-3 bg-muted/50 rounded-lg"},ua={class:"text-sm text-muted-foreground"},ca=Qe({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(d,{emit:n}){var W;const C=d,V=n,k=X([]),E=X(!1),A=X(null),a=X((W=C.modelValue)==null?void 0:W.toString()),h=async()=>{E.value=!0,A.value=null;try{const v=await st.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:C.filtrarPorUbicacion,incluir_futuras:!0}});k.value=v.data}catch(v){A.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",v)}finally{E.value=!1}},T=U(()=>{const v={abiertas:[],futuras:[]};return k.value.forEach(x=>{x.estado_temporal==="abierta"?v.abiertas.push(x):x.estado_temporal==="futura"&&v.futuras.push(x)}),v}),z=U(()=>k.value.find(v=>v.id===Number(a.value)));de(a,v=>{V("update:modelValue",v?Number(v):void 0)}),de(()=>C.modelValue,v=>{a.value=v==null?void 0:v.toString()});const D=v=>new Date(v).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=v=>{switch(v){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},I=v=>{switch(v){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Ze(()=>{h()}),(v,x)=>(u(),p("div",qt,[E.value?(u(),p("div",Dt,x[1]||(x[1]=[o("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),o("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):A.value?(u(),q(e(Ge),{key:1,variant:"destructive"},{default:m(()=>[i(e(Q),{class:"h-4 w-4"}),i(e(Ye),null,{default:m(()=>x[2]||(x[2]=[w("Error")])),_:1}),i(e(We),null,{default:m(()=>[w(_(A.value),1)]),_:1})]),_:1})):k.value.length>0?(u(),p("div",Bt,[i(e(Ut),{modelValue:a.value,"onUpdate:modelValue":x[0]||(x[0]=f=>a.value=f),disabled:v.disabled},{default:m(()=>[T.value.abiertas.length>0?(u(),p("div",Lt,[o("h4",Pt," Convocatorias Abiertas ("+_(T.value.abiertas.length)+") ",1),o("div",Rt,[(u(!0),p(G,null,H(T.value.abiertas,f=>(u(),q(e(ne),{key:f.id,class:Y(["cursor-pointer hover:shadow-md transition-all duration-200",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":a.value===f.id.toString(),"hover:bg-muted/50":a.value!==f.id.toString()}]),onClick:R=>a.value=f.id.toString()},{default:m(()=>[i(e(le),{class:"pb-3"},{default:m(()=>[o("div",zt,[i(e(Me),{value:f.id.toString(),id:`conv-${f.id}`},null,8,["value","id"]),o("div",Mt,[o("div",Wt,[i(e(re),{for:`conv-${f.id}`,class:"text-base font-semibold cursor-pointer"},{default:m(()=>[w(_(f.nombre),1)]),_:2},1032,["for"]),i(e(Le),{class:Y(P(f.estado_temporal))},{default:m(()=>[w(_(I(f.estado_temporal)),1)]),_:2},1032,["class"])]),i(e(ze),{class:"mt-1"},{default:m(()=>[w(_(f.descripcion),1)]),_:2},1024)])])]),_:2},1024),i(e(ue),{class:"pt-0"},{default:m(()=>[o("div",Gt,[o("div",Yt,[i(e(oe),{class:"h-4 w-4"}),o("span",null,_(f.cargo.nombre),1)]),o("div",Jt,[i(e(Pe),{class:"h-4 w-4"}),o("span",null,_(f.periodo_electoral.nombre),1)]),o("div",Kt,[i(e(oe),{class:"h-4 w-4"}),o("span",null,_(f.ubicacion),1)]),f.numero_postulaciones!==void 0?(u(),p("div",Xt,[i(e(pt),{class:"h-4 w-4"}),o("span",null,_(f.numero_postulaciones)+" postulaciones",1)])):j("",!0)]),o("div",Ht,[x[3]||(x[3]=o("span",{class:"font-medium"},"Cierre:",-1)),w(" "+_(D(f.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):j("",!0),T.value.futuras.length>0?(u(),p("div",Qt,[o("h4",Zt," Próximas Convocatorias ("+_(T.value.futuras.length)+") ",1),o("div",ea,[(u(!0),p(G,null,H(T.value.futuras,f=>(u(),q(e(ne),{key:f.id,class:Y(["cursor-pointer hover:shadow-md transition-all duration-200 opacity-90",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":a.value===f.id.toString(),"hover:bg-muted/50":a.value!==f.id.toString()}]),onClick:R=>a.value=f.id.toString()},{default:m(()=>[i(e(le),{class:"pb-3"},{default:m(()=>[o("div",ta,[i(e(Me),{value:f.id.toString(),id:`conv-${f.id}`},null,8,["value","id"]),o("div",aa,[o("div",ra,[i(e(re),{for:`conv-${f.id}`,class:"text-base font-semibold cursor-pointer"},{default:m(()=>[w(_(f.nombre),1)]),_:2},1032,["for"]),i(e(Le),{class:Y(P(f.estado_temporal))},{default:m(()=>[w(_(I(f.estado_temporal)),1)]),_:2},1032,["class"])]),i(e(ze),{class:"mt-1"},{default:m(()=>[w(_(f.descripcion),1)]),_:2},1024)])])]),_:2},1024),i(e(ue),{class:"pt-0"},{default:m(()=>[o("div",sa,[o("div",ia,[i(e(oe),{class:"h-4 w-4"}),o("span",null,_(f.cargo.nombre),1)]),o("div",oa,[i(e(Pe),{class:"h-4 w-4"}),o("span",null,_(f.periodo_electoral.nombre),1)]),o("div",da,[i(e(oe),{class:"h-4 w-4"}),o("span",null,_(f.ubicacion),1)])]),o("div",na,[x[4]||(x[4]=o("span",{class:"font-medium"},"Apertura:",-1)),w(" "+_(D(f.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):j("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),q(e(Ge),{key:3},{default:m(()=>[i(e(Q),{class:"h-4 w-4"}),i(e(Ye),null,{default:m(()=>x[5]||(x[5]=[w("Sin convocatorias disponibles")])),_:1}),i(e(We),null,{default:m(()=>x[6]||(x[6]=[w(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),z.value&&!v.disabled?(u(),p("div",la,[x[7]||(x[7]=o("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),o("p",ua,_(z.value.nombre),1)])):j("",!0)]))}});var fa=typeof global=="object"&&global&&global.Object===Object&&global,ma=typeof self=="object"&&self&&self.Object===Object&&self,et=fa||ma||Function("return this")(),ce=et.Symbol,tt=Object.prototype,ga=tt.hasOwnProperty,pa=tt.toString,ae=ce?ce.toStringTag:void 0;function _a(d){var n=ga.call(d,ae),C=d[ae];try{d[ae]=void 0;var V=!0}catch{}var k=pa.call(d);return V&&(n?d[ae]=C:delete d[ae]),k}var va=Object.prototype,ba=va.toString;function ya(d){return ba.call(d)}var ha="[object Null]",xa="[object Undefined]",Ke=ce?ce.toStringTag:void 0;function ka(d){return d==null?d===void 0?xa:ha:Ke&&Ke in Object(d)?_a(d):ya(d)}function Sa(d){return d!=null&&typeof d=="object"}var wa="[object Symbol]";function Ca(d){return typeof d=="symbol"||Sa(d)&&ka(d)==wa}var $a=/\s/;function Ea(d){for(var n=d.length;n--&&$a.test(d.charAt(n)););return n}var Ta=/^\s+/;function Va(d){return d&&d.slice(0,Ea(d)+1).replace(Ta,"")}function _e(d){var n=typeof d;return d!=null&&(n=="object"||n=="function")}var Xe=NaN,Aa=/^[-+]0x[0-9a-f]+$/i,ja=/^0b[01]+$/i,Oa=/^0o[0-7]+$/i,Ua=parseInt;function He(d){if(typeof d=="number")return d;if(Ca(d))return Xe;if(_e(d)){var n=typeof d.valueOf=="function"?d.valueOf():d;d=_e(n)?n+"":n}if(typeof d!="string")return d===0?d:+d;d=Va(d);var C=ja.test(d);return C||Oa.test(d)?Ua(d.slice(2),C?2:8):Aa.test(d)?Xe:+d}var pe=function(){return et.Date.now()},Fa="Expected a function",Ia=Math.max,Na=Math.min;function qa(d,n,C){var V,k,E,A,a,h,T=0,z=!1,D=!1,P=!0;if(typeof d!="function")throw new TypeError(Fa);n=He(n)||0,_e(C)&&(z=!!C.leading,D="maxWait"in C,E=D?Ia(He(C.maxWait)||0,n):E,P="trailing"in C?!!C.trailing:P);function I(S){var L=V,b=k;return V=k=void 0,T=S,A=d.apply(b,L),A}function W(S){return T=S,a=setTimeout(f,n),z?I(S):A}function v(S){var L=S-h,b=S-T,$=n-L;return D?Na($,E-b):$}function x(S){var L=S-h,b=S-T;return h===void 0||L>=n||L<0||D&&b>=E}function f(){var S=pe();if(x(S))return R(S);a=setTimeout(f,v(S))}function R(S){return a=void 0,P&&V?I(S):(V=k=void 0,A)}function Z(){a!==void 0&&clearTimeout(a),T=0,V=h=k=a=void 0}function J(){return a===void 0?A:R(pe())}function B(){var S=pe(),L=x(S);if(V=arguments,k=this,h=S,L){if(a===void 0)return W(h);if(D)return clearTimeout(a),a=setTimeout(f,n),I(h)}return a===void 0&&(a=setTimeout(f,n)),A}return B.cancel=Z,B.flush=J,B}function Da(d,n){const{url:C,candidaturaId:V=null,debounceTime:k=3e3,showNotifications:E=!0,useLocalStorage:A=!0,localStorageKey:a="candidatura_draft"}=n,h=X({status:"idle",lastSaved:null,lastError:null,candidaturaId:V}),T=U(()=>h.value.status==="saving"),z=U(()=>h.value.lastSaved!==null),D=U(()=>h.value.status==="error"),P=()=>{if(A)try{const b={formulario_data:d.value,timestamp:new Date().toISOString(),candidaturaId:h.value.candidaturaId};localStorage.setItem(a,JSON.stringify(b))}catch(b){console.error("Error guardando en localStorage:",b)}},I=()=>{if(!A)return null;try{const b=localStorage.getItem(a);if(b){const $=JSON.parse(b),M=new Date($.timestamp);if((Date.now()-M.getTime())/(1e3*60*60)<24)return $;localStorage.removeItem(a)}}catch(b){console.error("Error cargando desde localStorage:",b)}return null},W=()=>{A&&localStorage.removeItem(a)},v=async()=>{try{const b=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(b.ok){const $=await b.text(),N=new DOMParser().parseFromString($,"text/html").querySelector('meta[name="csrf-token"]');if(N){const ee=N.getAttribute("content"),te=document.querySelector('meta[name="csrf-token"]');if(te&&ee)return te.setAttribute("content",ee),ee}}}catch(b){console.error("Error renovando token CSRF:",b)}return null},x=async(b,$,M=0)=>{const F=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":$,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:d.value})});if(F.status===419&&M<1){const N=await v();if(N)return E&&O.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),x(b,N,M+1)}return F},f=async()=>{var b;if(h.value.status!=="saving"&&!(!d.value||Object.keys(d.value).length===0)){h.value.status="saving",h.value.lastError=null;try{const $=h.value.candidaturaId?C.replace("autosave",`${h.value.candidaturaId}/autosave`):C,M=((b=document.querySelector('meta[name="csrf-token"]'))==null?void 0:b.getAttribute("content"))||"";if(!M)throw new Error("Token CSRF no encontrado");const F=await x($,M);if(!F.ok)throw new Error(`Error ${F.status}: ${F.statusText}`);const N=await F.json();if(N.success)h.value.status="saved",h.value.lastSaved=new Date,!h.value.candidaturaId&&N.candidatura_id&&(h.value.candidaturaId=N.candidatura_id),P(),E&&O.success("Cambios guardados",{description:`Autoguardado a las ${N.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(N.message||"Error al guardar")}catch($){h.value.status="error",h.value.lastError=$ instanceof Error?$.message:"Error desconocido",P(),$ instanceof Error&&$.message.includes("419")?E&&O.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):E&&O.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",$)}}},R=qa(f,k),Z=()=>(R.cancel(),f()),J=()=>de(d,()=>{h.value.status!=="error"&&R()},{deep:!0}),B=()=>{R.cancel()},S=()=>{B(),h.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:V},W()},L=()=>{const b=I();return b&&b.formulario_data?(E&&O.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),b):null};return{state:U(()=>h.value),isSaving:T,hasSaved:z,hasError:D,saveNow:Z,startWatching:J,stopAutoSave:B,reset:S,restoreDraft:L,clearLocalStorage:W}}const Ba={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 pb-24"},La={class:"flex items-center justify-between"},Pa={class:"text-3xl font-bold"},Ra={class:"text-muted-foreground"},za={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Ma={key:0,class:"flex items-center gap-1.5"},Wa={key:1,class:"flex items-center gap-1.5"},Ga={key:2,class:"flex items-center gap-1.5 text-amber-600"},Ya={key:3,class:"flex items-center gap-1.5"},Ja={class:"text-blue-700 dark:text-blue-300"},Ka={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Xa={class:"flex items-start gap-3"},Ha={class:"text-sm text-blue-800"},Qa={key:0,class:"mt-1 text-blue-600"},Za={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},er={class:"flex items-start gap-3"},tr={key:0,class:"text-red-500"},ar={key:0,class:"text-sm text-muted-foreground"},rr={key:6,class:"space-y-2"},sr=["id","name","value","onUpdate:modelValue"],ir={key:7,class:"space-y-2"},or={key:8},dr={key:9},nr={key:0,class:"text-red-500 text-sm mt-1"},lr={key:10},ur={key:11},cr={key:12},fr={key:13,class:"text-sm text-destructive"},mr={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},gr={class:"text-red-800 text-sm"},pr={key:0,class:"fixed bottom-0 left-0 right-0 z-50 px-2 sm:px-4 pb-2 sm:pb-4"},_r={class:"mx-auto max-w-7xl"},vr={class:"backdrop-blur-lg bg-tertiary-60 dark:bg-gray-900/80 border border-gray-200/50 dark:border-gray-700/50 rounded-xl sm:rounded-2xl shadow-2xl p-3 sm:p-4"},br={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},yr={class:"hidden sm:flex items-center"},hr={class:"flex-1 sm:max-w-xs lg:max-w-sm mx-0 sm:mx-4"},xr={class:"flex items-center gap-3"},kr={class:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap font-medium"},Sr={class:"flex items-center gap-2 sm:gap-3"},wr={class:"ml-2 whitespace-nowrap"},Cr=Qe({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(d){var ve,be;const n=d,C=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:n.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:V}=Et(),k=X({}),E=U(()=>{var y;if(!n.is_editing||!((y=n.candidatura)!=null&&y.formulario_data))return!1;const l=Object.keys(n.candidatura.formulario_data),s=n.configuracion_campos.map(t=>t.id),r=l.some(t=>!s.includes(t)),c=n.configuracion_campos.some(t=>t.required&&!n.candidatura.formulario_data[t.id]);return r||c}),a=it((()=>{var s;const l={};return n.configuracion_campos.forEach(r=>{r.type==="checkbox"?l[r.id]=[]:r.type==="file"?l[r.id]=[]:r.type==="convocatoria"?l[r.id]=void 0:r.type==="disclaimer"?l[r.id]=null:r.type==="repeater"?l[r.id]=[]:r.type==="datepicker"?l[r.id]=null:l[r.id]=""}),(s=n.candidatura)!=null&&s.formulario_data&&(Object.assign(l,n.candidatura.formulario_data),n.configuracion_campos.forEach(r=>{r.type==="file"&&l[r.id]&&(Array.isArray(l[r.id])||(l[r.id]=[l[r.id]]))})),{formulario_data:l}})()),h=X(n.configuracion_campos),T=U(()=>a.formulario_data),{visibleFields:z,clearHiddenFieldValues:D}=Tt(h,T);de(z,()=>{D()});const{state:P,isSaving:I,hasSaved:W,hasError:v,saveNow:x,startWatching:f,stopAutoSave:R,restoreDraft:Z,clearLocalStorage:J}=Da(T,{url:"/candidaturas/autosave",candidaturaId:((ve=n.candidatura)==null?void 0:ve.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((be=n.candidatura)==null?void 0:be.id)||"new"}`});let B=null;Ze(()=>{const l=["borrador","rechazado"];if(!n.candidatura||l.includes(n.candidatura.estado)){if(!n.is_editing){const r=Z();r&&r.formulario_data&&(O.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{J(),a.reset(),O.success("Borrador descartado")}},duration:5e3}),Object.assign(a.formulario_data,r.formulario_data))}B=f()}}),ot(()=>{B&&B(),R()});const S=async()=>{if(I.value){O.warning("Ya se está guardando...");return}await x(),v.value||O.success("Borrador guardado manualmente")},L=U(()=>F.value.map(r=>{var t;if(!r.required)return{campo:r.id,valid:!0};const c=a.formulario_data[r.id];let y=!1;if(r.type==="checkbox")y=Array.isArray(c)&&c.length>0;else if(r.type==="file")(Array.isArray(c)&&c.length>0||k.value[r.id]&&k.value[r.id].length>0)&&(y=!0);else if(r.type==="convocatoria")y=c!=null&&c!=="";else if(r.type==="disclaimer")y=c&&c.accepted===!0;else if(r.type==="repeater"){const se=((t=r.repeaterConfig)==null?void 0:t.minItems)||0;y=Array.isArray(c)&&c.length>=se}else r.type==="datepicker"?y=c!=null&&c!=="":y=c&&c.toString().trim()!=="";return!y&&r.required,{campo:r.id,valid:y}}).every(r=>r.valid)),b=U(()=>{const l=F.value.length;let s=0;return F.value.forEach(r=>{const c=a.formulario_data[r.id];let y=!1;r.type==="checkbox"?y=Array.isArray(c)&&c.length>0:r.type==="file"?y=Array.isArray(c)&&c.length>0||k.value[r.id]&&k.value[r.id].length>0:r.type==="convocatoria"?y=c!=null&&c!=="":r.type==="disclaimer"?y=c&&c.accepted===!0:r.type==="repeater"?y=Array.isArray(c)&&c.length>0:r.type==="datepicker"?y=c!=null&&c!=="":y=c&&c.toString().trim()!=="",y&&s++}),{llenos:s,total:l,porcentaje:l>0?Math.round(s/l*100):0}}),$=U(()=>n.is_editing?"Editar Candidatura":"Crear Candidatura"),M=U(()=>{var l,s;return a.processing?"Guardando...":n.is_editing?((l=n.candidatura)==null?void 0:l.estado)==="rechazado"?"Reenviar Candidatura":((s=n.candidatura)==null?void 0:s.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),F=U(()=>{var s;let l=[...z.value];return n.is_editing&&n.candidatura&&["pendiente","aprobado"].includes(n.candidatura.estado)&&(l=l.filter(c=>c.type!=="convocatoria")),n.is_editing&&((s=n.candidatura)==null?void 0:s.estado)==="aprobado"&&(l=l.filter(r=>r.editable===!0)),l}),N=U(()=>{var r;if(!n.is_editing||!n.candidatura)return!1;let l=!1;if(["pendiente","aprobado"].includes(n.candidatura.estado)&&(l=n.configuracion_campos.some(c=>c.type==="convocatoria")),((r=n.candidatura)==null?void 0:r.estado)==="aprobado"){const c=n.configuracion_campos.some(y=>!y.editable&&y.type!=="convocatoria");return l||c}return l}),ee=async(l,s)=>{if(k.value[l]=s,s&&s.length>0)try{O.info("Subiendo archivos...",{duration:2e3});const c=(await V(s,{module:"candidaturas",fieldId:l})).map(y=>y.path);Array.isArray(a.formulario_data[l]),a.formulario_data[l]=c,k.value[l]=[],O.success("Archivos subidos correctamente",{duration:2e3})}catch(r){console.error("Error al subir archivos:",r),O.error("Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else a.formulario_data[l]=[]},te=async()=>{for(const[s,r]of Object.entries(k.value))if(r&&r.length>0)try{O.info("Subiendo archivos pendientes...",{duration:2e3});const c=await V(r,{module:"candidaturas",fieldId:s});a.formulario_data[s]=c.map(y=>y.path),k.value[s]=[]}catch(c){console.error("Error al subir archivos:",c),O.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const l={...a.formulario_data};n.configuracion_campos.forEach(s=>{const r=l[s.id];s.required||(r===""||r===void 0||Array.isArray(r)&&r.length===0&&s.type!=="checkbox"&&s.type!=="file")&&(l[s.id]=null)}),a.formulario_data=l,R(),n.is_editing?a.put(`/candidaturas/${n.candidatura.id}`,{onSuccess:()=>{J(),O.success("Candidatura actualizada exitosamente")},onError:s=>{console.error("Errores de validación:",s),(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&(B=f())}}):a.post("/candidaturas",{onSuccess:()=>{J(),O.success("Candidatura creada exitosamente")},onError:s=>{console.error("Errores de validación:",s),B=f()}})},K=l=>!!a.errors[`formulario_data.${l}`],at=U(()=>!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)),rt=()=>{const l=document.querySelector('[data-sidebar="trigger"]');l&&l.click()};return(l,s)=>(u(),p(G,null,[i(e(dt),{title:$.value},null,8,["title"]),i(kt,{breadcrumbs:C},{default:m(()=>{var r,c;return[o("div",Ba,[o("div",La,[o("div",null,[o("h1",Pa,_($.value),1),o("p",Ra,_(l.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),i(e(ie),{variant:"outline",onClick:s[0]||(s[0]=y=>e(nt).visit("/candidaturas"))},{default:m(()=>[i(e(Ft),{class:"mr-2 h-4 w-4"}),s[1]||(s[1]=w(" Volver "))]),_:1})]),!l.candidatura||["borrador","rechazado"].includes(l.candidatura.estado)?(u(),p("div",za,[e(I)?(u(),p("div",Ma,[i(e(ge),{class:"h-4 w-4 animate-spin"}),s[2]||(s[2]=o("span",null,"Guardando automáticamente...",-1))])):e(W)&&!e(v)?(u(),p("div",Wa,[i(e(Je),{class:"h-4 w-4 text-green-600"}),o("span",null,"Guardado automáticamente a las "+_((r=e(P).lastSaved)==null?void 0:r.toLocaleTimeString()),1)])):e(v)?(u(),p("div",Ga,[i(e(Q),{class:"h-4 w-4"}),s[3]||(s[3]=o("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),p("div",Ya,[i(e(ge),{class:"h-4 w-4"}),s[4]||(s[4]=o("span",null,"Autoguardado activado",-1))]))])):j("",!0),l.is_editing&&((c=l.candidatura)!=null&&c.comentarios_admin)?(u(),q(e(ne),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:m(()=>[i(e(le),null,{default:m(()=>[i(e(Re),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:m(()=>[i(e(Q),{class:"h-5 w-5"}),s[5]||(s[5]=w(" Comentarios de la comisión "))]),_:1})]),_:1}),i(e(ue),null,{default:m(()=>[o("p",Ja,_(l.candidatura.comentarios_admin),1)]),_:1})]),_:1})):j("",!0),i(e(ne),null,{default:m(()=>[i(e(le),null,{default:m(()=>[i(e(Re),{class:"flex items-center gap-2"},{default:m(()=>[i(e(It),{class:"h-5 w-5"}),s[6]||(s[6]=w(" Información de Candidatura "))]),_:1})]),_:1}),i(e(ue),null,{default:m(()=>{var y;return[o("form",{onSubmit:lt(te,["prevent"]),class:"space-y-6"},[l.is_editing&&((y=l.candidatura)==null?void 0:y.estado)==="aprobado"?(u(),p("div",Ka,[o("div",Xa,[i(e(Q),{class:"h-5 w-5 text-blue-600 mt-0.5"}),o("div",Ha,[s[7]||(s[7]=o("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),s[8]||(s[8]=o("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),N.value?(u(),p("p",Qa," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):j("",!0)])])])):j("",!0),E.value?(u(),p("div",Za,[o("div",er,[i(e(Q),{class:"h-5 w-5 text-amber-600 mt-0.5"}),s[9]||(s[9]=o("div",{class:"text-sm text-amber-800"},[o("p",{class:"font-medium"},"Formulario Actualizado"),o("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):j("",!0),i(ut,{name:"fade-field",tag:"div",class:"space-y-6"},{default:m(()=>[(u(!0),p(G,null,H(F.value,t=>{var se,ye,he,xe,ke,Se,we,Ce,$e,Ee,Te,Ve,Ae,je,Oe,Ue,Fe,Ie,Ne,qe,De;return u(),p("div",{key:t.id,class:"space-y-2"},[i(e(re),{for:t.id,class:"flex items-center gap-1"},{default:m(()=>[w(_(t.title)+" ",1),t.required?(u(),p("span",tr,"*")):j("",!0)]),_:2},1032,["for"]),t.description?(u(),p("p",ar,_(t.description),1)):j("",!0),t.type==="text"||t.type==="email"?(u(),q(e(me),{key:1,id:t.id,type:t.type,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,placeholder:t.placeholder||"",class:Y({"border-destructive":K(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(u(),q(e($t),{key:2,id:t.id,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,placeholder:t.placeholder||"",rows:4,class:Y({"border-destructive":K(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(u(),q(e(me),{key:3,id:t.id,type:"number",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,placeholder:t.placeholder||"",class:Y({"border-destructive":K(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(u(),q(e(me),{key:4,id:t.id,type:"date",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,class:Y({"border-destructive":K(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(u(),q(e(_t),{key:5,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g},{default:m(()=>[i(e(vt),{class:Y({"border-destructive":K(t.id)})},{default:m(()=>[i(e(bt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),i(e(yt),null,{default:m(()=>[(u(!0),p(G,null,H(t.options,g=>(u(),q(e(ht),{key:g,value:g},{default:m(()=>[w(_(g),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(u(),p("div",rr,[(u(!0),p(G,null,H(t.options,g=>(u(),p("div",{key:g,class:"flex items-center space-x-2"},[ct(o("input",{id:`${t.id}_${g}`,name:t.id,type:"radio",value:g,"onUpdate:modelValue":fe=>e(a).formulario_data[t.id]=fe,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,sr),[[ft,e(a).formulario_data[t.id]]]),i(e(re),{for:`${t.id}_${g}`,class:"text-sm font-normal"},{default:m(()=>[w(_(g),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(u(),p("div",ir,[(u(!0),p(G,null,H(t.options,g=>(u(),p("div",{key:g,class:"flex items-center space-x-2"},[i(e(wt),{id:`${t.id}_${g}`,checked:e(a).formulario_data[t.id].includes(g),"onUpdate:checked":fe=>{if(fe)e(a).formulario_data[t.id].includes(g)||e(a).formulario_data[t.id].push(g);else{const Be=e(a).formulario_data[t.id].indexOf(g);Be>-1&&e(a).formulario_data[t.id].splice(Be,1)}}},null,8,["id","checked","onUpdate:checked"]),i(e(re),{for:`${t.id}_${g}`,class:"text-sm font-normal"},{default:m(()=>[w(_(g),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(u(),p("div",or,[i(Vt,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,onFilesSelected:g=>ee(t.id,g),label:"",description:"",required:t.required,multiple:((se=t.fileConfig)==null?void 0:se.multiple)||!1,"max-files":((ye=t.fileConfig)==null?void 0:ye.maxFiles)||5,"max-file-size":((he=t.fileConfig)==null?void 0:he.maxFileSize)||10,accept:((xe=t.fileConfig)==null?void 0:xe.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(a).errors[`formulario_data.${t.id}`],disabled:e(a).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(u(),p("div",dr,[i(ca,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,required:t.required,disabled:e(a).processing||l.is_editing&&((ke=l.candidatura)==null?void 0:ke.estado)!=="borrador","filtrar-por-ubicacion":((Se=t.convocatoriaConfig)==null?void 0:Se.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),K(t.id)?(u(),p("div",nr,_(e(a).errors[`formulario_data.${t.id}`]),1)):j("",!0)])):t.type==="datepicker"?(u(),p("div",lr,[i(At,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-date":(we=t.datepickerConfig)==null?void 0:we.minDate,"max-date":(Ce=t.datepickerConfig)==null?void 0:Ce.maxDate,format:(($e=t.datepickerConfig)==null?void 0:$e.format)||"DD/MM/YYYY","allow-past-dates":((Ee=t.datepickerConfig)==null?void 0:Ee.allowPastDates)??!0,"allow-future-dates":((Te=t.datepickerConfig)==null?void 0:Te.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(u(),p("div",ur,[i(jt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"disclaimer-text":((Ve=t.disclaimerConfig)==null?void 0:Ve.disclaimerText)||"","modal-title":((Ae=t.disclaimerConfig)==null?void 0:Ae.modalTitle)||"Términos y Condiciones","accept-button-text":((je=t.disclaimerConfig)==null?void 0:je.acceptButtonText)||"Acepto","decline-button-text":((Oe=t.disclaimerConfig)==null?void 0:Oe.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(u(),p("div",cr,[i(Ot,{"model-value":e(a).formulario_data[t.id]||[],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-items":((Ue=t.repeaterConfig)==null?void 0:Ue.minItems)||0,"max-items":((Fe=t.repeaterConfig)==null?void 0:Fe.maxItems)||10,"item-name":((Ie=t.repeaterConfig)==null?void 0:Ie.itemName)||"Elemento","add-button-text":((Ne=t.repeaterConfig)==null?void 0:Ne.addButtonText)||"Agregar elemento","remove-button-text":((qe=t.repeaterConfig)==null?void 0:qe.removeButtonText)||"Eliminar",fields:((De=t.repeaterConfig)==null?void 0:De.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):j("",!0),K(t.id)?(u(),p("p",fr,_(e(a).errors[`formulario_data.${t.id}`]),1)):j("",!0)])}),128))]),_:1}),e(a).errors.general?(u(),p("div",mr,[o("p",gr,_(e(a).errors.general),1)])):j("",!0),s[10]||(s[10]=o("div",{class:"h-4"},null,-1))],32)]}),_:1})]),_:1})]),(u(),q(mt,{to:"body"},[i(gt,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-4 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-4 opacity-0"},{default:m(()=>[(u(),p("div",pr,[o("div",_r,[o("div",vr,[o("div",br,[o("div",yr,[i(e(ie),{variant:"outline",type:"button",onClick:rt,class:"backdrop-blur-sm flex-shrink-0 text-xs sm:text-sm py-2 px-3"},{default:m(()=>[i(e(xt),{class:"h-4 w-4"}),s[11]||(s[11]=o("span",{class:"ml-2"},"Ocultar sidebar",-1))]),_:1})]),o("div",hr,[o("div",xr,[i(e(Ct),{modelValue:b.value.porcentaje,class:"flex-1"},null,8,["modelValue"]),o("span",kr,_(b.value.llenos)+" / "+_(b.value.total),1)]),s[12]||(s[12]=o("p",{class:"text-xs text-muted-foreground mt-1 text-center hidden sm:block"}," Campos completados ",-1))]),o("div",Sr,[at.value?(u(),q(e(ie),{key:0,onClick:S,disabled:e(I),variant:"outline",class:"backdrop-blur-sm flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:m(()=>[e(I)?(u(),p(G,{key:0},[i(e(ge),{class:"mr-2 h-4 w-4 animate-spin"}),s[13]||(s[13]=w(" Guardando... "))],64)):(u(),p(G,{key:1},[i(e(Nt),{class:"mr-2 h-4 w-4"}),s[14]||(s[14]=w(" Guardar borrador "))],64))]),_:1},8,["disabled"])):j("",!0),i(e(ie),{onClick:te,disabled:!L.value||e(a).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400 flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:m(()=>[i(e(Je),{class:"h-4 w-4"}),o("span",wr,_(M.value),1)]),_:1},8,["disabled"])])])])])]))]),_:1})]))]}),_:1})],64))}}),Zr=St(Cr,[["__scopeId","data-v-8b03533f"]]);export{Zr as default};
