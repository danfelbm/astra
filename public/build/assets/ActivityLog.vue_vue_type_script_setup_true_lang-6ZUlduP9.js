import{a as X,b as q,c as G,_ as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-BvB8Nmm4.js";import{_ as C}from"./Label.vue_vue_type_script_setup_true_lang-CAV2IJKL.js";import{_ as x}from"./createLucideIcon-CCv9JMZk.js";import{_ as z,a as D,b as U,c as L,d as H,C as B}from"./SelectValue.vue_vue_type_script_setup_true_lang-DiGTnrHw.js";import{_ as Y,a as Z,b as ee}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DUTV_HmV.js";import{F as I}from"./filter-iaEhGTw5.js";import{X as T}from"./x-DCIVO5nz.js";import{C as te}from"./calendar-DlH8Ax9_.js";import{d as K,c as A,b as g,i as u,w as a,e as s,f as t,g as n,j as m,h as r,F as y,k as j,t as d,m as o,r as se,p as ae,v as N}from"./app-CchgBPDI.js";import{f as Q,e as W}from"./es-BDPlFIsO.js";import{_ as R,a as S,b as O}from"./index-982-a3Qk.js";import{_ as le}from"./CardDescription.vue_vue_type_script_setup_true_lang-CYSJq7w-.js";import{p as oe}from"./parseISO-DFjB8F03.js";const ne={class:"flex items-center justify-between"},ie={class:"flex items-center gap-2"},de={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ue={key:0,class:"space-y-2"},re={class:"flex gap-2"},ce={key:1,class:"space-y-2"},fe={class:"flex gap-2"},_e={class:"space-y-2"},me={class:"flex gap-2"},ve={class:"space-y-2"},pe={class:"flex gap-2"},ge={key:0,class:"text-sm"},he={key:1,class:"text-muted-foreground"},xe={class:"p-3 space-y-2"},ye=["value"],ke=["value"],be={key:1,class:"space-y-4"},$e={class:"flex items-center justify-between"},we={class:"flex items-center gap-2"},ot=K({__name:"ActivityFilters",props:{modelValue:{},usuarios:{default:()=>[]},contextLevel:{default:"proyecto"},showCard:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(_,{emit:$}){const w=_,k=$,c=A({get:()=>w.modelValue,set:i=>k("update:modelValue",i)}),M=A(()=>{const i=[];return w.contextLevel==="proyecto"?i.push({value:"Modules\\Proyectos\\Models\\Proyecto",label:"Proyecto"},{value:"Modules\\Proyectos\\Models\\Hito",label:"Hito"},{value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}):w.contextLevel==="hito"?i.push({value:"Modules\\Proyectos\\Models\\Hito",label:"Hito"},{value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}):i.push({value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}),i}),E=[{value:"created",label:"Creado"},{value:"updated",label:"Actualizado"},{value:"deleted",label:"Eliminado"},{value:"restored",label:"Restaurado"},{value:"custom",label:"Acción personalizada"}],h=(i,e)=>{c.value={...c.value,[i]:e}},b=i=>{h(i,null)},F=()=>{c.value={usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}},p=A(()=>Object.values(c.value).some(i=>i!=null)),f=i=>{if(!i)return"";try{return Q(new Date(i),"d 'de' MMM yyyy",{locale:W})}catch{return i}};return(i,e)=>_.showCard?(o(),g(t(J),{key:0},{default:a(()=>[s(t(X),{class:"pb-3"},{default:a(()=>[n("div",ne,[n("div",ie,[s(t(I),{class:"h-4 w-4"}),s(t(q),{class:"text-base"},{default:a(()=>[...e[9]||(e[9]=[r("Filtros de Actividad",-1)])]),_:1})]),p.value?(o(),g(t(x),{key:0,variant:"ghost",size:"sm",onClick:F},{default:a(()=>[s(t(T),{class:"h-4 w-4 mr-1"}),e[10]||(e[10]=r(" Limpiar ",-1))]),_:1})):m("",!0)])]),_:1}),s(t(G),null,{default:a(()=>{var v;return[n("div",de,[_.usuarios.length>0?(o(),u("div",ue,[s(t(C),{for:"usuario"},{default:a(()=>[...e[11]||(e[11]=[r("Usuario",-1)])]),_:1}),n("div",re,[s(t(z),{"model-value":(v=c.value.usuario_id)==null?void 0:v.toString(),"onUpdate:modelValue":e[0]||(e[0]=l=>h("usuario_id",l?parseInt(l):null))},{default:a(()=>[s(t(D),{id:"usuario"},{default:a(()=>[s(t(U),{placeholder:"Todos los usuarios"})]),_:1}),s(t(L),null,{default:a(()=>[s(t(H),{value:"null"},{default:a(()=>[...e[12]||(e[12]=[r("Todos los usuarios",-1)])]),_:1}),(o(!0),u(y,null,j(_.usuarios,l=>(o(),g(t(H),{key:l.id,value:l.id.toString()},{default:a(()=>[r(d(l.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),c.value.usuario_id?(o(),g(t(x),{key:0,variant:"ghost",size:"icon",onClick:e[1]||(e[1]=l=>b("usuario_id"))},{default:a(()=>[s(t(T),{class:"h-4 w-4"})]),_:1})):m("",!0)])])):m("",!0),M.value.length>1?(o(),u("div",ce,[s(t(C),{for:"tipo-entidad"},{default:a(()=>[...e[13]||(e[13]=[r("Tipo de Entidad",-1)])]),_:1}),n("div",fe,[s(t(z),{"model-value":c.value.tipo_entidad||"null","onUpdate:modelValue":e[2]||(e[2]=l=>h("tipo_entidad",l==="null"?null:l))},{default:a(()=>[s(t(D),{id:"tipo-entidad"},{default:a(()=>[s(t(U),{placeholder:"Todas las entidades"})]),_:1}),s(t(L),null,{default:a(()=>[s(t(H),{value:"null"},{default:a(()=>[...e[14]||(e[14]=[r("Todas las entidades",-1)])]),_:1}),(o(!0),u(y,null,j(M.value,l=>(o(),g(t(H),{key:l.value,value:l.value},{default:a(()=>[r(d(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),c.value.tipo_entidad?(o(),g(t(x),{key:0,variant:"ghost",size:"icon",onClick:e[3]||(e[3]=l=>b("tipo_entidad"))},{default:a(()=>[s(t(T),{class:"h-4 w-4"})]),_:1})):m("",!0)])])):m("",!0),n("div",_e,[s(t(C),{for:"tipo-accion"},{default:a(()=>[...e[15]||(e[15]=[r("Tipo de Acción",-1)])]),_:1}),n("div",me,[s(t(z),{"model-value":c.value.tipo_accion||"null","onUpdate:modelValue":e[4]||(e[4]=l=>h("tipo_accion",l==="null"?null:l))},{default:a(()=>[s(t(D),{id:"tipo-accion"},{default:a(()=>[s(t(U),{placeholder:"Todas las acciones"})]),_:1}),s(t(L),null,{default:a(()=>[s(t(H),{value:"null"},{default:a(()=>[...e[16]||(e[16]=[r("Todas las acciones",-1)])]),_:1}),(o(),u(y,null,j(E,l=>s(t(H),{key:l.value,value:l.value},{default:a(()=>[r(d(l.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value"]),c.value.tipo_accion?(o(),g(t(x),{key:0,variant:"ghost",size:"icon",onClick:e[5]||(e[5]=l=>b("tipo_accion"))},{default:a(()=>[s(t(T),{class:"h-4 w-4"})]),_:1})):m("",!0)])]),n("div",ve,[s(t(C),null,{default:a(()=>[...e[17]||(e[17]=[r("Rango de Fechas",-1)])]),_:1}),n("div",pe,[s(t(Y),null,{default:a(()=>[s(t(Z),{"as-child":""},{default:a(()=>[s(t(x),{variant:"outline",class:"w-full justify-start text-left font-normal"},{default:a(()=>[s(t(te),{class:"mr-2 h-4 w-4"}),c.value.fecha_inicio||c.value.fecha_fin?(o(),u("span",ge,d(c.value.fecha_inicio?f(c.value.fecha_inicio):"...")+" - "+d(c.value.fecha_fin?f(c.value.fecha_fin):"..."),1)):(o(),u("span",he,"Seleccionar rango"))]),_:1})]),_:1}),s(t(ee),{class:"w-auto p-0",align:"start"},{default:a(()=>[n("div",xe,[n("div",null,[s(t(C),{class:"text-xs"},{default:a(()=>[...e[18]||(e[18]=[r("Desde",-1)])]),_:1}),n("input",{type:"date",value:c.value.fecha_inicio||"",onInput:e[6]||(e[6]=l=>h("fecha_inicio",l.target.value)),class:"w-full mt-1 px-3 py-2 border rounded-md text-sm"},null,40,ye)]),n("div",null,[s(t(C),{class:"text-xs"},{default:a(()=>[...e[19]||(e[19]=[r("Hasta",-1)])]),_:1}),n("input",{type:"date",value:c.value.fecha_fin||"",onInput:e[7]||(e[7]=l=>h("fecha_fin",l.target.value)),class:"w-full mt-1 px-3 py-2 border rounded-md text-sm"},null,40,ke)])])]),_:1})]),_:1}),c.value.fecha_inicio||c.value.fecha_fin?(o(),g(t(x),{key:0,variant:"ghost",size:"icon",onClick:e[8]||(e[8]=l=>{b("fecha_inicio"),b("fecha_fin")})},{default:a(()=>[s(t(T),{class:"h-4 w-4"})]),_:1})):m("",!0)])])])]}),_:1})]),_:1})):(o(),u("div",be,[n("div",$e,[n("div",we,[s(t(I),{class:"h-4 w-4"}),e[20]||(e[20]=n("h3",{class:"text-sm font-medium"},"Filtros",-1))]),p.value?(o(),g(t(x),{key:0,variant:"ghost",size:"sm",onClick:F},{default:a(()=>[s(t(T),{class:"h-4 w-4 mr-1"}),e[21]||(e[21]=r(" Limpiar ",-1))]),_:1})):m("",!0)]),e[22]||(e[22]=n("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},null,-1))]))}}),Me={class:"flex items-center justify-between"},Ce={key:0,class:"text-xs text-muted-foreground"},He={key:0,class:"space-y-4"},Te={class:"flex-1 min-w-0"},Ae={class:"text-sm"},Fe={class:"flex items-center gap-2 mt-1"},je={class:"text-xs text-muted-foreground"},Ee={key:0,class:"text-xs text-muted-foreground"},Pe={key:0,class:"pt-2 text-center"},Ve={key:1,class:"text-center py-8"},ze={class:"text-sm text-muted-foreground"},De={key:1},Ue={key:0,class:"space-y-4"},Le={class:"flex-1 min-w-0"},Be={class:"text-sm"},Ie={class:"flex items-center gap-2 mt-1"},Ne={class:"text-xs text-muted-foreground"},Re={key:0,class:"text-xs text-muted-foreground"},Se={key:0,class:"pt-2 text-center"},Oe={key:1,class:"text-center py-8"},Xe={class:"text-sm text-muted-foreground"},nt=K({__name:"ActivityLog",props:{activities:{},title:{default:"Historial de Actividad"},description:{default:"Registro completo de cambios y eventos"},emptyMessage:{default:"No hay actividad registrada"},showCard:{type:Boolean,default:!0},perPage:{default:20}},setup(_){const $=_,w=se(1),k=A(()=>{const i=w.value*$.perPage;return $.activities.slice(0,i)}),c=A(()=>k.value.length<$.activities.length),M=A(()=>$.activities.length),E=()=>{w.value++};ae(()=>$.activities,()=>{w.value=1},{deep:!0});const h=f=>{try{const i=oe(f),v=new Date().getTime()-i.getTime(),l=Math.floor(v/6e4),P=Math.floor(v/36e5),V=Math.floor(v/864e5);return l<1?"Hace un momento":l<60?`Hace ${l} ${l===1?"minuto":"minutos"}`:P<24?`Hace ${P} ${P===1?"hora":"horas"}`:V<7?`Hace ${V} ${V===1?"día":"días"}`:Q(i,"d 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:W})}catch{return f}},b=f=>f?f.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2):"SI",F=f=>{if(!f)return"";const i=f.split("\\");return i[i.length-1]},p=f=>{const i=f.description||"",e=f.properties;if(e!=null&&e.entidad_url&&(e!=null&&e.entidad_nombre)&&(e!=null&&e.entidad_tipo)){const v=new RegExp(`(.*)(en ${e.entidad_tipo} ')([^']+)('.*)`),l=i.match(v);if(l)return{before:l[1]+`en ${e.entidad_tipo} '`,linkText:l[3],linkUrl:e.entidad_url,after:l[4]}}return{text:i}};return(f,i)=>_.showCard?(o(),g(t(J),{key:0},{default:a(()=>[s(t(X),null,{default:a(()=>[n("div",Me,[n("div",null,[s(t(q),null,{default:a(()=>[r(d(_.title),1)]),_:1}),s(t(le),null,{default:a(()=>[r(d(_.description),1)]),_:1})]),M.value>0?(o(),u("span",Ce,d(k.value.length)+" de "+d(M.value),1)):m("",!0)])]),_:1}),s(t(G),null,{default:a(()=>[_.activities&&_.activities.length>0?(o(),u("div",He,[(o(!0),u(y,null,j(k.value,e=>(o(),u("div",{key:e.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[s(t(R),{class:"h-8 w-8 flex-shrink-0"},{default:a(()=>{var v;return[(v=e.causer)!=null&&v.avatar?(o(),g(t(S),{key:0,src:e.causer.avatar},null,8,["src"])):m("",!0),s(t(O),null,{default:a(()=>{var l;return[r(d(b(((l=e.causer)==null?void 0:l.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),n("div",Te,[n("p",Ae,[p(e).linkUrl?(o(),u(y,{key:0},[n("span",null,d(p(e).before),1),s(t(N),{href:p(e).linkUrl,class:"font-medium text-primary hover:underline"},{default:a(()=>[r(d(p(e).linkText),1)]),_:2},1032,["href"]),n("span",null,d(p(e).after),1)],64)):(o(),u(y,{key:1},[r(d(e.description),1)],64))]),n("div",Fe,[n("p",je,d(h(e.created_at)),1),e.subject_type?(o(),u("span",Ee," • "+d(F(e.subject_type)),1)):m("",!0)])])]))),128)),c.value?(o(),u("div",Pe,[s(t(x),{variant:"ghost",size:"sm",onClick:E,class:"text-muted-foreground"},{default:a(()=>[s(t(B),{class:"h-4 w-4 mr-1"}),r(" Cargar más ("+d(M.value-k.value.length)+" restantes) ",1)]),_:1})])):m("",!0)])):(o(),u("div",Ve,[n("p",ze,d(_.emptyMessage),1)]))]),_:1})]),_:1})):(o(),u("div",De,[_.activities&&_.activities.length>0?(o(),u("div",Ue,[(o(!0),u(y,null,j(k.value,e=>(o(),u("div",{key:e.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[s(t(R),{class:"h-8 w-8 flex-shrink-0"},{default:a(()=>{var v;return[(v=e.causer)!=null&&v.avatar?(o(),g(t(S),{key:0,src:e.causer.avatar},null,8,["src"])):m("",!0),s(t(O),null,{default:a(()=>{var l;return[r(d(b(((l=e.causer)==null?void 0:l.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),n("div",Le,[n("p",Be,[p(e).linkUrl?(o(),u(y,{key:0},[n("span",null,d(p(e).before),1),s(t(N),{href:p(e).linkUrl,class:"font-medium text-primary hover:underline"},{default:a(()=>[r(d(p(e).linkText),1)]),_:2},1032,["href"]),n("span",null,d(p(e).after),1)],64)):(o(),u(y,{key:1},[r(d(e.description),1)],64))]),n("div",Ie,[n("p",Ne,d(h(e.created_at)),1),e.subject_type?(o(),u("span",Re," • "+d(F(e.subject_type)),1)):m("",!0)])])]))),128)),c.value?(o(),u("div",Se,[s(t(x),{variant:"ghost",size:"sm",onClick:E,class:"text-muted-foreground"},{default:a(()=>[s(t(B),{class:"h-4 w-4 mr-1"}),r(" Cargar más ("+d(M.value-k.value.length)+" restantes) ",1)]),_:1})])):m("",!0)])):(o(),u("div",Oe,[n("p",Xe,d(_.emptyMessage),1)]))]))}});export{ot as _,nt as a};
