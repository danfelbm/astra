import{_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BopaKI9e.js";import{d as X,r as G,b as k,w as l,e,g as a,f as t,q as K,t as r,h as o,n as Q,v as S,i as m,j as D,m as u,F as E,k as T,s as N}from"./app-DHSrnHfp.js";import{_ as y}from"./createLucideIcon-zXPLd4q8.js";import{_ as g,a as _,b as p,c as x}from"./CardTitle.vue_vue_type_script_setup_true_lang-BV5s5-k1.js";import{_ as U}from"./CardDescription.vue_vue_type_script_setup_true_lang-BM4iSuVx.js";import{_ as h}from"./index-NGSL-QiB.js";import{_ as W,a as Y,b as V,c as w,d as Z,e as $}from"./TableHeader.vue_vue_type_script_setup_true_lang-Cy4tygZe.js";import{_ as tt,a as et,b as st}from"./index-Bo75OZHR.js";import{_ as lt,a as at,b as C,c as j}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BKT8yb50.js";import{_ as nt}from"./ScrollArea.vue_vue_type_script_setup_true_lang-EjIfaF6p.js";import{T as ot}from"./target-D1uREh3C.js";import{R as it}from"./refresh-cw-__67xQG9.js";import{T as rt}from"./trash-DgEFFGqM.js";import{S as dt}from"./square-pen--WW6Hxzu.js";import{A as ut}from"./arrow-left-DO_-wCCd.js";import{U as mt}from"./users-LBaiSssu.js";import{S as ft}from"./useFlashMessages-BROVnI5z.js";import{C as ct}from"./calendar-CzXWvXjv.js";import{H as gt}from"./hash-CP-ntuUp.js";import{M as _t}from"./mail-xdCzYSzg.js";import{U as pt}from"./user-Bka4JVfI.js";import"./index-DpDw7NO-.js";import"./floating-ui.vue-BjLC2OFg.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DSXs3ALr.js";import"./chevron-right-By1-gIwT.js";import"./chevrons-up-down-CCi1KSZa.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-q9I5pcXe.js";import"./tag-Dg93x7Bj.js";import"./shield-CoQaz8b5.js";import"./vote-BO2hWkkB.js";import"./folder-open-B9dYxvDv.js";import"./send-spqQh1rM.js";import"./file-text-D78DwBqE.js";import"./briefcase-C79f5kqC.js";import"./megaphone-CSYRFGvv.js";import"./user-check-BHZSjTFi.js";import"./clipboard-list-DEJNrul-.js";import"./message-square-BqfkFxfh.js";import"./external-link-B_5oGna2.js";import"./panel-left-Bc38eaeS.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-D7aF8MxH.js";import"./VisuallyHidden-RF-i7APh.js";import"./Input.vue_vue_type_script_setup_true_lang-CHuSx3Ys.js";import"./index-Dx7kY3nB.js";import"./check-zayXb_7B.js";import"./index-DJ4I9UWD.js";import"./index-BCWL5Ihb.js";import"./RovingFocusItem-CYVWpnFU.js";import"./utils-C-KfRYdn.js";import"./x-DyOutZHi.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BkqrVUKl.js";import"./Label.vue_vue_type_script_setup_true_lang-B85kH-Bv.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-822EfkoS.js";import"./circle-alert-CJTy1Swl.js";import"./map-pin-hGUy45pc.js";const xt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},vt={class:"flex items-center justify-between"},yt={class:"flex items-center gap-4"},bt={class:"p-3 bg-primary/10 rounded-lg"},ht={class:"text-2xl font-bold tracking-tight"},wt={class:"flex items-center gap-2 mt-1"},$t={class:"flex gap-2"},kt={class:"grid gap-6 md:grid-cols-4"},St={class:"text-2xl font-bold"},Ct={class:"text-2xl font-bold"},jt={class:"text-sm font-bold"},Dt={class:"text-2xl font-bold"},Et={class:"flex items-center gap-3"},Tt={class:"font-medium"},Ut={class:"flex items-center gap-1"},At={class:"text-sm"},Rt={key:1,class:"text-center py-8 text-muted-foreground"},Nt={key:2,class:"mt-4 text-sm text-muted-foreground text-center"},Vt={key:0},Ft={class:"space-y-4"},Lt={class:"flex items-center justify-between"},Mt={class:"font-semibold"},zt={class:"text-sm text-muted-foreground"},qt={key:1,class:"text-center py-8 text-muted-foreground"},Bt={key:0,class:"space-y-3"},Pt={class:"font-semibold"},It={class:"text-sm text-muted-foreground"},Ot={key:1,class:"text-center py-8 text-muted-foreground"},Ht={class:"grid grid-cols-2 gap-4"},Jt={class:"text-sm font-mono"},Xt={class:"text-sm font-mono"},Gt={class:"text-sm"},Kt={class:"text-sm"},Qt={class:"text-sm"},Wt={key:0},Yt={class:"text-sm"},ts=X({__name:"Show",props:{segment:{},users:{},metadata:{},isPaginated:{type:Boolean}},setup(i){const v=i,F=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:v.segment.name,href:"#"}],b=G(!1),L=n=>n.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2),M=n=>new Date(n).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),A=n=>new Date(n).toLocaleString("es-ES"),z=n=>n<60?`${n} segundos`:n<3600?`${Math.floor(n/60)} minutos`:`${Math.floor(n/3600)} horas`,q=n=>n.split("\\").pop()||n,B=n=>n!=null&&n.last_calculated_at?new Date(n.last_calculated_at).toLocaleString():"Nunca",P=async()=>{var n;b.value=!0;try{(await(await fetch(`/admin/segments/${v.segment.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""}})).json()).success&&N.reload()}catch(s){console.error("Error evaluating segment:",s)}finally{b.value=!1}},I=()=>{N.post(`/admin/segments/${v.segment.id}/clear-cache`)},R=()=>v.isPaginated?v.users:{data:v.users},O=n=>Array.isArray(n)?n.join(", "):typeof n=="object"&&n!==null?JSON.stringify(n):String(n),H=n=>{if(!n||typeof n!="object")return[];const s=[];for(const[d,f]of Object.entries(n))f!=null&&s.push({field:d,value:f});return s};return(n,s)=>(u(),k(J,{breadcrumbs:F},{default:l(()=>[e(t(K),{title:`Segmento: ${i.segment.name}`},null,8,["title"]),a("div",xt,[a("div",vt,[a("div",yt,[a("div",bt,[e(t(ot),{class:"h-8 w-8 text-primary"})]),a("div",null,[a("h2",ht,r(i.segment.name),1),a("div",wt,[e(t(h),{variant:i.segment.is_dynamic?"default":"secondary"},{default:l(()=>[o(r(i.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"]),e(t(h),{variant:"outline"},{default:l(()=>[o(r(q(i.segment.model_type)),1)]),_:1})])])]),a("div",$t,[e(t(y),{onClick:P,variant:"secondary",disabled:b.value},{default:l(()=>[e(t(it),{class:Q(["mr-2 h-4 w-4",{"animate-spin":b.value}])},null,8,["class"]),o(" "+r(b.value?"Evaluando...":"Recalcular"),1)]),_:1},8,["disabled"]),e(t(y),{onClick:I,variant:"ghost"},{default:l(()=>[e(t(rt),{class:"mr-2 h-4 w-4"}),s[0]||(s[0]=o(" Limpiar Cache ",-1))]),_:1}),e(t(S),{href:`/admin/segments/${i.segment.id}/edit`},{default:l(()=>[e(t(y),null,{default:l(()=>[e(t(dt),{class:"mr-2 h-4 w-4"}),s[1]||(s[1]=o(" Editar ",-1))]),_:1})]),_:1},8,["href"]),e(t(S),{href:n.route("admin.segments.index")},{default:l(()=>[e(t(y),{variant:"outline"},{default:l(()=>[e(t(ut),{class:"mr-2 h-4 w-4"}),s[2]||(s[2]=o(" Volver ",-1))]),_:1})]),_:1},8,["href"])])]),a("div",kt,[e(t(g),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(p),{class:"text-sm font-medium"},{default:l(()=>[...s[3]||(s[3]=[o("Usuarios Totales",-1)])]),_:1}),e(t(mt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(x),null,{default:l(()=>{var d;return[a("div",St,r(((d=i.metadata)==null?void 0:d.contacts_count)||0),1),s[4]||(s[4]=a("p",{class:"text-xs text-muted-foreground"},"usuarios en este segmento",-1))]}),_:1})]),_:1}),e(t(g),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(p),{class:"text-sm font-medium"},{default:l(()=>[...s[5]||(s[5]=[o("Cache",-1)])]),_:1}),e(t(ft),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(x),null,{default:l(()=>[a("div",Ct,r(z(i.segment.cache_duration)),1),s[6]||(s[6]=a("p",{class:"text-xs text-muted-foreground"},"duración del cache",-1))]),_:1})]),_:1}),e(t(g),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(p),{class:"text-sm font-medium"},{default:l(()=>[...s[7]||(s[7]=[o("Última Evaluación",-1)])]),_:1}),e(t(ct),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(x),null,{default:l(()=>[a("div",jt,r(B(i.metadata)),1),s[8]||(s[8]=a("p",{class:"text-xs text-muted-foreground"},"última actualización",-1))]),_:1})]),_:1}),e(t(g),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(p),{class:"text-sm font-medium"},{default:l(()=>[...s[9]||(s[9]=[o("Roles",-1)])]),_:1}),e(t(gt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(x),null,{default:l(()=>{var d;return[a("div",Dt,r(((d=i.segment.roles)==null?void 0:d.length)||0),1),s[10]||(s[10]=a("p",{class:"text-xs text-muted-foreground"},"roles asociados",-1))]}),_:1})]),_:1})]),e(t(lt),{defaultValue:"users",class:"space-y-4"},{default:l(()=>[e(t(at),null,{default:l(()=>[e(t(C),{value:"users"},{default:l(()=>[...s[11]||(s[11]=[o("Usuarios",-1)])]),_:1}),e(t(C),{value:"filters"},{default:l(()=>[...s[12]||(s[12]=[o("Filtros",-1)])]),_:1}),e(t(C),{value:"roles"},{default:l(()=>[...s[13]||(s[13]=[o("Roles",-1)])]),_:1}),e(t(C),{value:"details"},{default:l(()=>[...s[14]||(s[14]=[o("Detalles",-1)])]),_:1})]),_:1}),e(t(j),{value:"users"},{default:l(()=>[e(t(g),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(p),null,{default:l(()=>[...s[15]||(s[15]=[o("Usuarios en este Segmento",-1)])]),_:1}),e(t(U),null,{default:l(()=>[...s[16]||(s[16]=[o(" Lista de usuarios que cumplen con los criterios del segmento ",-1)])]),_:1})]),_:1}),e(t(x),null,{default:l(()=>{var d,f;return[(d=R().data)!=null&&d.length?(u(),k(t(W),{key:0},{default:l(()=>[e(t(Y),null,{default:l(()=>[e(t(V),null,{default:l(()=>[e(t(w),null,{default:l(()=>[...s[17]||(s[17]=[o("Usuario",-1)])]),_:1}),e(t(w),null,{default:l(()=>[...s[18]||(s[18]=[o("Email",-1)])]),_:1}),e(t(w),null,{default:l(()=>[...s[19]||(s[19]=[o("Estado",-1)])]),_:1}),e(t(w),null,{default:l(()=>[...s[20]||(s[20]=[o("Registro",-1)])]),_:1}),e(t(w),{class:"text-right"},{default:l(()=>[...s[21]||(s[21]=[o("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(Z),null,{default:l(()=>[(u(!0),m(E,null,T(R().data,c=>(u(),k(t(V),{key:c.id},{default:l(()=>[e(t($),null,{default:l(()=>[a("div",Et,[e(t(tt),{class:"h-8 w-8"},{default:l(()=>[c.avatar_url?(u(),k(t(et),{key:0,src:c.avatar_url,alt:c.name},null,8,["src","alt"])):D("",!0),e(t(st),null,{default:l(()=>[o(r(L(c.name)),1)]),_:2},1024)]),_:2},1024),a("span",Tt,r(c.name),1)])]),_:2},1024),e(t($),null,{default:l(()=>[a("div",Ut,[e(t(_t),{class:"h-4 w-4 text-muted-foreground"}),a("span",At,r(c.email),1)])]),_:2},1024),e(t($),null,{default:l(()=>[e(t(h),{variant:c.activo?"default":"secondary"},{default:l(()=>[o(r(c.activo?"Activo":"Inactivo"),1)]),_:2},1032,["variant"])]),_:2},1024),e(t($),null,{default:l(()=>[o(r(M(c.created_at)),1)]),_:2},1024),e(t($),{class:"text-right"},{default:l(()=>[e(t(S),{href:`/admin/users/${c.id}`},{default:l(()=>[e(t(y),{size:"sm",variant:"ghost"},{default:l(()=>[e(t(pt),{class:"mr-2 h-4 w-4"}),s[22]||(s[22]=o(" Ver Usuario ",-1))]),_:1})]),_:1},8,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(u(),m("div",Rt," No hay usuarios en este segmento ")),i.isPaginated?(u(),m("div",Nt," Mostrando "+r((f=i.users.data)==null?void 0:f.length)+" de "+r(i.users.total)+" usuarios ",1)):D("",!0)]}),_:1})]),_:1})]),_:1}),e(t(j),{value:"filters"},{default:l(()=>[e(t(g),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(p),null,{default:l(()=>[...s[23]||(s[23]=[o("Criterios de Filtrado",-1)])]),_:1}),e(t(U),null,{default:l(()=>[...s[24]||(s[24]=[o(" Filtros aplicados para determinar los usuarios de este segmento ",-1)])]),_:1})]),_:1}),e(t(x),null,{default:l(()=>[i.segment.filters&&Object.keys(i.segment.filters).length>0?(u(),m("div",Vt,[e(t(nt),{class:"h-[400px]"},{default:l(()=>[a("div",Ft,[(u(!0),m(E,null,T(H(i.segment.filters),d=>(u(),m("div",{key:d.field,class:"p-4 border rounded-lg"},[a("div",Lt,[a("div",null,[a("p",Mt,r(d.field),1),a("p",zt,r(O(d.value)),1)]),e(t(h),{variant:"outline"},{default:l(()=>[o(r(typeof d.value=="object"?"Complejo":"Simple"),1)]),_:2},1024)])]))),128))])]),_:1})])):(u(),m("div",qt," No hay filtros definidos para este segmento "))]),_:1})]),_:1})]),_:1}),e(t(j),{value:"roles"},{default:l(()=>[e(t(g),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(p),null,{default:l(()=>[...s[25]||(s[25]=[o("Roles Asociados",-1)])]),_:1}),e(t(U),null,{default:l(()=>[...s[26]||(s[26]=[o(" Roles que utilizan este segmento para delimitar el alcance de datos ",-1)])]),_:1})]),_:1}),e(t(x),null,{default:l(()=>{var d;return[(d=i.segment.roles)!=null&&d.length?(u(),m("div",Bt,[(u(!0),m(E,null,T(i.segment.roles,f=>(u(),m("div",{key:f.id,class:"flex items-center justify-between p-4 border rounded-lg"},[a("div",null,[a("h4",Pt,r(f.display_name),1),a("p",It,r(f.name),1)]),e(t(S),{href:`/admin/roles/${f.id}`},{default:l(()=>[e(t(y),{size:"sm",variant:"ghost"},{default:l(()=>[...s[27]||(s[27]=[o(" Ver Rol ",-1)])]),_:1})]),_:1},8,["href"])]))),128))])):(u(),m("div",Ot," No hay roles asociados a este segmento "))]}),_:1})]),_:1})]),_:1}),e(t(j),{value:"details"},{default:l(()=>[e(t(g),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(p),null,{default:l(()=>[...s[28]||(s[28]=[o("Información del Segmento",-1)])]),_:1})]),_:1}),e(t(x),{class:"space-y-4"},{default:l(()=>{var d;return[a("div",Ht,[a("div",null,[s[29]||(s[29]=a("p",{class:"text-sm font-medium text-muted-foreground"},"ID del Segmento",-1)),a("p",Jt,r(i.segment.id),1)]),a("div",null,[s[30]||(s[30]=a("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Modelo",-1)),a("p",Xt,r(i.segment.model_type),1)]),a("div",null,[s[31]||(s[31]=a("p",{class:"text-sm font-medium text-muted-foreground"},"Creado por",-1)),a("p",Gt,r(((d=i.segment.created_by)==null?void 0:d.name)||"Sistema"),1)]),a("div",null,[s[32]||(s[32]=a("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo",-1)),e(t(h),{variant:i.segment.is_dynamic?"default":"secondary"},{default:l(()=>[o(r(i.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"])]),a("div",null,[s[33]||(s[33]=a("p",{class:"text-sm font-medium text-muted-foreground"},"Creado",-1)),a("p",Kt,r(A(i.segment.created_at)),1)]),a("div",null,[s[34]||(s[34]=a("p",{class:"text-sm font-medium text-muted-foreground"},"Última Actualización",-1)),a("p",Qt,r(A(i.segment.updated_at)),1)])]),i.segment.description?(u(),m("div",Wt,[s[35]||(s[35]=a("p",{class:"text-sm font-medium text-muted-foreground mb-2"},"Descripción",-1)),a("p",Yt,r(i.segment.description),1)])):D("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}))}});export{ts as default};
