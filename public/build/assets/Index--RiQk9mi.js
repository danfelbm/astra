import{d as q,r as D,b as p,w as a,g as l,e as s,h as r,i as c,j as b,m,t as _,f as t,v as J,n as P,F as K,k as Q,s as u}from"./app-Tc5FcPos.js";import{_ as W}from"./AdminLayout.vue_vue_type_script_setup_true_lang-LQ6X0muo.js";import{_ as x}from"./createLucideIcon-H6zLNTbI.js";import{_ as w,c as O,a as X,b as Y}from"./CardTitle.vue_vue_type_script_setup_true_lang-BMrN_h_j.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang-INVWSEmQ.js";import{_ as tt}from"./Label.vue_vue_type_script_setup_true_lang-BZ0oMeu3.js";import{_ as et}from"./index-Cly0Qei5.js";import{_ as st,a as at,b as z,c as $,d as ot,e as C}from"./TableHeader.vue_vue_type_script_setup_true_lang-KFQw8M7V.js";import{_ as it,a as lt,b as nt,e as E,d as rt}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BfWiD7tz.js";import{O as mt}from"./ObligacionTree-DMlETfB_.js";import{_ as dt}from"./Pagination.vue_vue_type_script_setup_true_lang-BWUA0Hgm.js";import{u as ct}from"./usePermissions-eRmpAsO2.js";import{t as j}from"./index-Diz7G8K9.js";import{l as ut}from"./lodash-B9dgNnfR.js";import{D as ft}from"./download-DQ08CtpJ.js";import{P as pt}from"./plus-CYgqSIcI.js";import{S as bt}from"./search-C3lRFARU.js";import{T as gt}from"./tree-pine-CLzaM7uu.js";import{L as _t}from"./list-CmrDvkzd.js";import{E as vt}from"./ellipsis-vertical-MNzY9-8n.js";import{E as xt}from"./eye-B71Ey79G.js";import{P as ht}from"./pencil-C3GB7eam.js";import{T as yt}from"./trash-2-GLHIknF1.js";import{C as kt}from"./circle-alert-AjGR6gnE.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-_ZjZfSfF.js";import"./index-DNeKSjmC.js";import"./floating-ui.vue-BG3fS9ma.js";import"./x-CVNMc2LC.js";import"./index-CKthGIYI.js";import"./shield-CCpXm5HU.js";import"./user-BlnlQS9T.js";import"./chevron-right-DvYMqVHa.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BesWdtCP.js";import"./VisuallyHidden-CXQrF-Ui.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-DkcNq_01.js";import"./index-BkyXZ5PZ.js";import"./check-Bpn9XuIe.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BxXxORQ8.js";import"./map-pin-BlDRspux.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-7F-9_guF.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-C7i0MCTs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-BJZP6ctq.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Dk6p9glA.js";import"./tag-1F8xYGqt.js";import"./users-Jlbe-ZJc.js";import"./target-Dz509VvQ.js";import"./vote-D_GetRcJ.js";import"./folder-open-BZYYPaTW.js";import"./send-fqecDwiE.js";import"./file-text-CnRiRvkf.js";import"./briefcase-vIbVsaq7.js";import"./calendar-DTCaY4jd.js";import"./megaphone-2iz6bDHh.js";import"./user-check-CRiWIxbt.js";import"./clipboard-list-CyHrlK57.js";import"./mail-CrUveOYG.js";import"./message-square-D5eN9iPu.js";import"./external-link-ByQJhuSk.js";import"./panel-left-ORu1bHUK.js";import"./index-8LKY-cbr.js";import"./Separator.vue_vue_type_script_setup_true_lang-Bp9iICng.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-D8fFP9r5.js";import"./circle-BANkofRf.js";import"./layers-Cf4gFD15.js";import"./paperclip-sFL-GAwD.js";import"./loader-circle-BdWXJTGV.js";const $t={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ct={class:"flex items-center justify-between"},wt={class:"text-3xl font-bold"},Ot={key:0,class:"text-sm text-gray-600"},Et={class:"flex items-center gap-2"},jt={class:"relative"},St={class:"text-2xl font-bold"},Bt={class:"flex items-center justify-between"},Tt={class:"flex items-center gap-2"},Vt={key:0},At={key:1},Dt={class:"text-sm text-gray-600"},Pt={key:0,class:"text-sm"},zt={key:1,class:"text-sm text-gray-400"},Nt={key:0,class:"mt-4 flex justify-center"},It={key:2,class:"text-center py-8 text-gray-500"},Ye=q({__name:"Index",props:{obligaciones:{},estadisticas:{},filters:{},contrato:{},estadisticasResponsables:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canExport:{type:Boolean}},setup(i){var T,V,A;const f=i,N=f.contrato?[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:f.contrato.nombre,href:`/admin/contratos/${f.contrato.id}`},{title:"Obligaciones",href:"#"}]:[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"}],{hasPermission:h}=ct(),g=D("tabla"),y=D({search:((T=f.filters)==null?void 0:T.search)||"",contrato_id:((V=f.filters)==null?void 0:V.contrato_id)||((A=f.contrato)==null?void 0:A.id)||""}),I=()=>{u.get(route("admin.obligaciones.index"),y.value,{preserveState:!0,preserveScroll:!0})},L=ut.debounce(()=>{I()},500),F=()=>{var o;u.visit(route("admin.obligaciones.create",{contrato_id:(o=f.contrato)==null?void 0:o.id}))},G=o=>{u.visit(route("admin.obligaciones.show",o.id))},S=o=>{u.visit(route("admin.obligaciones.edit",o.id))},B=o=>{const e=o.tiene_hijos?`¿Estás seguro de eliminar "${o.titulo}" y todas sus obligaciones hijas?`:`¿Estás seguro de eliminar "${o.titulo}"?`;confirm(e)&&u.delete(route("admin.obligaciones.destroy",o.id),{preserveScroll:!0,onSuccess:()=>{j.success("Obligación eliminada exitosamente")}})},H=o=>{u.post(route("admin.obligaciones.completar",o.id),{},{preserveScroll:!0,onSuccess:()=>{j.success("Obligación marcada como cumplida")}})},M=o=>{u.visit(route("admin.obligaciones.create",{contrato_id:o.contrato_id,parent_id:o.id}))},R=(o,e,k)=>{u.post(route("admin.obligaciones.mover",o.id),{nuevo_parent_id:e,nuevo_orden:k},{preserveScroll:!0,onSuccess:()=>{j.success("Obligación movida exitosamente")}})},U=()=>{window.open(route("admin.obligaciones.exportar",y.value),"_blank")};return(o,e)=>(m(),p(W,{breadcrumbs:t(N)},{default:a(()=>{var k;return[l("div",$t,[l("div",Ct,[l("div",null,[l("h1",wt,[e[3]||(e[3]=r(" Obligaciones ",-1)),i.contrato?(m(),c("span",Ot," - "+_(i.contrato.nombre),1)):b("",!0)]),e[4]||(e[4]=l("p",{class:"text-gray-600 mt-1"},"Gestiona las obligaciones de los contratos",-1))]),l("div",Et,[i.canExport||t(h)("obligaciones.export")?(m(),p(t(x),{key:0,variant:"outline",size:"sm",onClick:U},{default:a(()=>[s(t(ft),{class:"h-4 w-4 mr-2"}),e[5]||(e[5]=r(" Exportar ",-1))]),_:1})):b("",!0),i.canCreate||t(h)("obligaciones.create")?(m(),p(t(J),{key:1,href:o.route("admin.obligaciones.create",{contrato_id:(k=i.contrato)==null?void 0:k.id})},{default:a(()=>[s(t(x),null,{default:a(()=>[s(t(pt),{class:"h-4 w-4 mr-2"}),e[6]||(e[6]=r(" Nueva Obligación ",-1))]),_:1})]),_:1},8,["href"])):b("",!0)])]),s(t(w),null,{default:a(()=>[s(t(O),{class:"pt-6"},{default:a(()=>[l("div",null,[s(t(tt),{for:"search"},{default:a(()=>[...e[7]||(e[7]=[r("Buscar",-1)])]),_:1}),l("div",jt,[s(t(bt),{class:"absolute left-2 top-2.5 h-4 w-4 text-gray-400"}),s(t(Z),{id:"search",modelValue:y.value.search,"onUpdate:modelValue":e[0]||(e[0]=d=>y.value.search=d),type:"text",placeholder:"Buscar obligaciones por título o descripción...",class:"pl-8",onInput:t(L)},null,8,["modelValue","onInput"])])])]),_:1})]),_:1}),s(t(w),null,{default:a(()=>[s(t(O),{class:"pt-6"},{default:a(()=>{var d,n;return[l("div",St,_(((n=(d=i.obligaciones)==null?void 0:d.data)==null?void 0:n.length)||0),1),e[8]||(e[8]=l("p",{class:"text-sm text-gray-600"},"Total Obligaciones",-1))]}),_:1})]),_:1}),s(t(w),{class:"flex-1"},{default:a(()=>[s(t(X),null,{default:a(()=>[l("div",Bt,[s(t(Y),null,{default:a(()=>[...e[9]||(e[9]=[r("Lista de Obligaciones",-1)])]),_:1}),l("div",Tt,[s(t(x),{variant:"ghost",size:"sm",class:P({"bg-gray-100":g.value==="arbol"}),onClick:e[1]||(e[1]=d=>g.value="arbol")},{default:a(()=>[s(t(gt),{class:"h-4 w-4 mr-1"}),e[10]||(e[10]=r(" Árbol ",-1))]),_:1},8,["class"]),s(t(x),{variant:"ghost",size:"sm",class:P({"bg-gray-100":g.value==="tabla"}),onClick:e[2]||(e[2]=d=>g.value="tabla")},{default:a(()=>[s(t(_t),{class:"h-4 w-4 mr-1"}),e[11]||(e[11]=r(" Tabla ",-1))]),_:1},8,["class"])])])]),_:1}),s(t(O),null,{default:a(()=>{var d;return[g.value==="arbol"&&i.obligaciones.data&&i.obligaciones.data.length>0?(m(),c("div",Vt,[s(mt,{obligaciones:i.obligaciones.data,contratoId:(d=i.contrato)==null?void 0:d.id,editable:!0,onCreate:F,onEdit:S,onDelete:B,onComplete:H,onAddChild:M,onMove:R},null,8,["obligaciones","contratoId"])])):g.value==="tabla"&&i.obligaciones.data&&i.obligaciones.data.length>0?(m(),c("div",At,[s(t(st),null,{default:a(()=>[s(t(at),null,{default:a(()=>[s(t(z),null,{default:a(()=>[s(t($),null,{default:a(()=>[...e[12]||(e[12]=[r("Título",-1)])]),_:1}),s(t($),null,{default:a(()=>[...e[13]||(e[13]=[r("Descripción",-1)])]),_:1}),s(t($),null,{default:a(()=>[...e[14]||(e[14]=[r("Archivos",-1)])]),_:1}),s(t($),{class:"text-right"},{default:a(()=>[...e[15]||(e[15]=[r("Acciones",-1)])]),_:1})]),_:1})]),_:1}),s(t(ot),null,{default:a(()=>[(m(!0),c(K,null,Q(i.obligaciones.data,n=>(m(),p(t(z),{key:n.id},{default:a(()=>[s(t(C),{class:"font-medium"},{default:a(()=>[l("div",null,[l("span",null,_(n.titulo),1),n.tiene_hijos?(m(),p(t(et),{key:0,variant:"outline",class:"ml-2 text-xs"},{default:a(()=>[r(_(n.total_hijos)+" hijos ",1)]),_:2},1024)):b("",!0)])]),_:2},1024),s(t(C),null,{default:a(()=>[l("span",Dt,_(n.descripcion?n.descripcion.length>100?n.descripcion.substring(0,100)+"...":n.descripcion:"Sin descripción"),1)]),_:2},1024),s(t(C),null,{default:a(()=>{var v;return[(v=n.archivos_adjuntos)!=null&&v.length?(m(),c("span",Pt,_(n.archivos_adjuntos.length)+" archivo(s) ",1)):(m(),c("span",zt,"Sin archivos"))]}),_:2},1024),s(t(C),{class:"text-right"},{default:a(()=>[s(t(it),null,{default:a(()=>[s(t(lt),{asChild:""},{default:a(()=>[s(t(x),{variant:"ghost",size:"icon",class:"h-8 w-8"},{default:a(()=>[s(t(vt),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(nt),{align:"end"},{default:a(()=>[s(t(E),{onClick:v=>G(n)},{default:a(()=>[s(t(xt),{class:"h-4 w-4 mr-2"}),e[16]||(e[16]=r(" Ver ",-1))]),_:1},8,["onClick"]),i.canEdit||t(h)("obligaciones.edit")?(m(),p(t(E),{key:0,onClick:v=>S(n)},{default:a(()=>[s(t(ht),{class:"h-4 w-4 mr-2"}),e[17]||(e[17]=r(" Editar ",-1))]),_:1},8,["onClick"])):b("",!0),s(t(rt)),i.canDelete||t(h)("obligaciones.delete")?(m(),p(t(E),{key:1,class:"text-red-600",onClick:v=>B(n)},{default:a(()=>[s(t(yt),{class:"h-4 w-4 mr-2"}),e[18]||(e[18]=r(" Eliminar ",-1))]),_:1},8,["onClick"])):b("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),i.obligaciones.links?(m(),c("div",Nt,[s(dt,{links:i.obligaciones.links,meta:i.obligaciones.meta},null,8,["links","meta"])])):b("",!0)])):(m(),c("div",It,[s(t(kt),{class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e[19]||(e[19]=l("p",null,"No se encontraron obligaciones",-1)),e[20]||(e[20]=l("p",{class:"text-sm mt-1"},"Crea una nueva obligación para comenzar",-1))]))]}),_:1})]),_:1})])]}),_:1},8,["breadcrumbs"]))}});export{Ye as default};
