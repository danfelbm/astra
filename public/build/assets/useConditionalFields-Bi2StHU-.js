import{k as T,q as G,d as Z,c as I,a as d,o,f as y,b as p,i as m,u as n,e as v,g as x,t as c,n as W,F as z,r as N,j as M,h as J,K as oe,w as X}from"./app-BYrg8azN.js";import{c as re,_ as P}from"./createLucideIcon-DxPAJKhv.js";import{_ as K,c as ae,a as ne}from"./CardTitle.vue_vue_type_script_setup_true_lang-DlaYTSU0.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-CpYAXHQ5.js";import{U as ie}from"./upload-BchiVH36.js";import{E as de}from"./eye-DZtEPcHP.js";import{D as ue}from"./download-BO4uatT5.js";import{X as Q,_ as ce,a as me,b as pe,c as fe,d as ve,e as he}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DhSQWsLU.js";import{_ as se}from"./Checkbox.vue_vue_type_script_setup_true_lang-DIDmoHU5.js";import{_ as H}from"./Input.vue_vue_type_script_setup_true_lang-cNMPFlQg.js";import{_ as ye}from"./Textarea.vue_vue_type_script_setup_true_lang-CtHMuZrV.js";import{_ as be,a as _e,b as ge,c as $e,d as ke}from"./SelectValue.vue_vue_type_script_setup_true_lang-D0KTl89S.js";import{C as we}from"./calendar-DjYpadyA.js";import{P as xe}from"./plus-B3vGyxqV.js";import{G as Fe}from"./grip-vertical-Dpu_XeLC.js";import{T as De}from"./trash-2-MIyhm2eH.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=re("FileIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);function Ce(){const F=T(!1),C=T({}),u=T(new Map);return{isUploading:F,uploadProgress:C,uploadErrors:u,uploadFiles:async(f,e)=>{var t,i;F.value=!0,u.value.clear();const s=new FormData;f.forEach(r=>{s.append("files[]",r)}),s.append("module",e.module),s.append("field_id",e.fieldId);try{const r=await G.post("/api/files/upload",s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:$=>{if($.total){const a=Math.round($.loaded*100/$.total);f.forEach(k=>{C.value[k.name]=a,e.onProgress&&e.onProgress(k.name,a)})}}});if(r.data.success)return e.onSuccess&&e.onSuccess(r.data.files),r.data.files;throw new Error(r.data.message||"Error al subir archivos")}catch(r){const $=((i=(t=r.response)==null?void 0:t.data)==null?void 0:i.message)||r.message||"Error desconocido al subir archivos";throw f.forEach(a=>{u.value.set(a.name,$)}),e.onError&&e.onError(r),r}finally{F.value=!1,setTimeout(()=>{C.value={}},2e3)}},deleteFile:async f=>{try{return(await G.delete("/api/files/delete",{data:{path:f}})).data.success}catch(e){return console.error("Error al eliminar archivo:",e),!1}},downloadFile:async(f,e)=>{try{const s=await G.get("/api/files/download",{params:{path:f},responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.href=t,i.setAttribute("download",e||f.split("/").pop()||"archivo"),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(t)}catch(s){throw console.error("Error al descargar archivo:",s),s}},getFileInfo:async f=>{try{const e=await G.get("/api/files/info",{params:{path:f}});return e.data.success?e.data.file:null}catch(e){return console.error("Error al obtener información del archivo:",e),null}},validateFileType:(f,e)=>{var i;const s=e.split(",").map(r=>r.trim().toLowerCase()),t="."+((i=f.name.split(".").pop())==null?void 0:i.toLowerCase());return s.some(r=>r===t)},validateFileSize:(f,e)=>{const s=e*1024*1024;return f.size<=s},formatFileSize:f=>{if(f===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(f)/Math.log(e));return Math.round(f/Math.pow(e,t)*100)/100+" "+s[t]}}}const Se={class:"space-y-2"},Ae={key:0,class:"text-red-500 ml-1"},Me={key:0,class:"text-sm text-muted-foreground"},Ee={class:"flex flex-col items-center justify-center text-center"},Be={class:"text-sm font-medium mb-1"},Ue={class:"text-xs text-muted-foreground"},ze=["multiple","accept","disabled"],Te={key:0,class:"space-y-2"},Ie={class:"space-y-2"},Ve={class:"flex items-center justify-between"},qe={class:"flex items-center space-x-3 flex-1"},Pe={class:"min-w-0 flex-1"},je={class:"text-sm font-medium truncate"},Le={key:0,class:"text-xs text-muted-foreground"},Re={class:"flex items-center space-x-2"},Ye={key:1,class:"space-y-2"},Ne={class:"space-y-2"},He={class:"space-y-2"},Oe={class:"flex items-center justify-between"},Ge={class:"flex items-center space-x-3 flex-1"},Ke=["src","alt"],We={class:"min-w-0 flex-1"},Xe={class:"text-sm font-medium truncate"},Ze={class:"text-xs text-muted-foreground"},Je={key:0,class:"w-full space-y-1"},Qe={class:"flex justify-between text-xs text-muted-foreground"},et={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},tt={key:1,class:"text-xs text-red-600"},at={key:2,class:"text-sm text-red-600"},st={key:3,class:"text-xs text-muted-foreground"},lt={key:0},ca=Z({__name:"FileUploadField",props:{modelValue:{},label:{},description:{},required:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},maxFiles:{default:5},maxFileSize:{default:10},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"},error:{},disabled:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0},module:{default:"postulaciones"},fieldId:{default:"file"},autoUpload:{type:Boolean,default:!0}},emits:["update:modelValue","filesSelected"],setup(F,{expose:C,emit:u}){const b=F,h=u,{isUploading:g,uploadFiles:E,deleteFile:V,formatFileSize:D}=Ce(),q=T(),f=T([]),e=T(new Map),s=T(new Map),t=T(new Map);T(!1);const i=I(()=>b.modelValue?b.modelValue.length>0&&typeof b.modelValue[0]=="string"?b.modelValue.map((l,w)=>({id:`existing_${w}`,name:l.split("/").pop()||"archivo",size:0,path:l,url:`/storage/${l}`})):b.modelValue:[]),r=I(()=>{const l=i.value.length+f.value.length;return b.multiple?l<b.maxFiles:l===0}),$=I(()=>b.accept.split(",").map(l=>l.trim().toLowerCase())),a=()=>{var l;!b.disabled&&r.value&&((l=q.value)==null||l.click())},k=l=>{var _;const w="."+((_=l.name.split(".").pop())==null?void 0:_.toLowerCase());return $.value.some(S=>S===w)},B=l=>{const w=b.maxFileSize*1024*1024;return l.size<=w},R=async l=>{const w=l.target,_=Array.from(w.files||[]);t.value.clear();const S=[];if(_.forEach(A=>{if(!k(A)){t.value.set(A.name,`Tipo de archivo no permitido. Solo se permiten: ${b.accept}`);return}if(!B(A)){t.value.set(A.name,`El archivo excede el tamaño máximo de ${b.maxFileSize}MB`);return}const Y=i.value.length+S.length;if(b.multiple&&Y>=b.maxFiles){t.value.set(A.name,`Se ha alcanzado el límite de ${b.maxFiles} archivos`);return}if(S.push(A),A.type.startsWith("image/")&&b.showPreview){const L=new FileReader;L.onload=le=>{var ee;e.value.set(A.name,(ee=le.target)==null?void 0:ee.result)},L.readAsDataURL(A)}}),b.multiple?f.value=[...f.value,...S]:f.value=S.slice(0,1),S.length>0&&(h("filesSelected",S),b.autoUpload&&b.module&&b.fieldId))try{const A=await E(S,{module:b.module,fieldId:b.fieldId,onProgress:(Y,L)=>{s.value.set(Y,L)},onSuccess:Y=>{const L=[...i.value,...Y];h("update:modelValue",L),f.value=[],e.value.clear()},onError:Y=>{console.error("Error al subir archivos:",Y),S.forEach(L=>{t.value.set(L.name,"Error al subir el archivo")})}})}catch(A){console.error("Error en carga automática:",A)}w.value=""},j=l=>{const w=f.value[l];e.value.delete(w.name),s.value.delete(w.name),t.value.delete(w.name),f.value.splice(l,1)},O=async l=>{const w=i.value[l];if(w.path)try{await V(w.path)}catch(S){console.error("Error al eliminar archivo del servidor:",S)}const _=[...i.value];if(_.splice(l,1),typeof b.modelValue[0]=="string"){const S=_.map(A=>A.path).filter(Boolean);h("update:modelValue",S)}else h("update:modelValue",_)};return C({selectedFiles:f,uploadProgress:s,uploadErrors:t}),(l,w)=>(o(),d("div",Se,[y("div",null,[p(n(U),{class:"text-sm font-medium"},{default:v(()=>[x(c(l.label)+" ",1),l.required?(o(),d("span",Ae,"*")):m("",!0)]),_:1}),l.description?(o(),d("p",Me,c(l.description),1)):m("",!0)]),p(n(K),{class:W(["border-2 border-dashed hover:border-primary/50 transition-colors cursor-pointer",{"opacity-50 cursor-not-allowed":l.disabled||!r.value||n(g),"border-red-300":l.error}]),onClick:a},{default:v(()=>[p(n(ae),{class:"p-6"},{default:v(()=>[y("div",Ee,[p(n(ie),{class:"h-10 w-10 text-muted-foreground mb-3"}),y("p",Be,c(n(g)?"Subiendo archivos...":r.value?"Haz clic para seleccionar archivos":"Límite de archivos alcanzado"),1),y("p",Ue,c(l.multiple?`Hasta ${l.maxFiles} archivos`:"Un archivo")+" • Máx. "+c(l.maxFileSize)+"MB • Formatos: "+c(l.accept),1)])]),_:1})]),_:1},8,["class"]),y("input",{ref_key:"fileInputRef",ref:q,type:"file",multiple:l.multiple,accept:l.accept,disabled:l.disabled||!r.value||n(g),onChange:R,class:"hidden"},null,40,ze),i.value.length>0?(o(),d("div",Te,[p(n(U),{class:"text-xs text-muted-foreground"},{default:v(()=>w[0]||(w[0]=[x("Archivos cargados:")])),_:1}),y("div",Ie,[(o(!0),d(z,null,N(i.value,(_,S)=>(o(),M(n(K),{key:_.id,class:"p-3"},{default:v(()=>[y("div",Ve,[y("div",qe,[p(n(te),{class:"h-5 w-5 text-muted-foreground flex-shrink-0"}),y("div",Pe,[y("p",je,c(_.name),1),_.size>0?(o(),d("p",Le,c(n(D)(_.size)),1)):m("",!0)])]),y("div",Re,[_.url?(o(),M(n(P),{key:0,type:"button",variant:"ghost",size:"sm",onClick:J(A=>l.window.open(_.url,"_blank"),["stop"])},{default:v(()=>[p(n(de),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):m("",!0),_.url?(o(),M(n(P),{key:1,type:"button",variant:"ghost",size:"sm",onClick:J(A=>l.window.open(_.url+"?download=true","_blank"),["stop"])},{default:v(()=>[p(n(ue),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):m("",!0),l.disabled?m("",!0):(o(),M(n(P),{key:2,type:"button",variant:"ghost",size:"sm",onClick:J(A=>O(S),["stop"])},{default:v(()=>[p(n(Q),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"]))])])]),_:2},1024))),128))])])):m("",!0),f.value.length>0?(o(),d("div",Ye,[p(n(U),{class:"text-xs text-muted-foreground"},{default:v(()=>[x(c(s.value.size>0?"Subiendo archivos...":"Archivos pendientes de carga:"),1)]),_:1}),y("div",Ne,[(o(!0),d(z,null,N(f.value,(_,S)=>(o(),M(n(K),{key:_.name,class:W(["p-3",{"border-red-300":t.value.has(_.name)}])},{default:v(()=>[y("div",He,[y("div",Oe,[y("div",Ge,[e.value.has(_.name)&&l.showPreview?(o(),d("img",{key:0,src:e.value.get(_.name),alt:_.name,class:"h-10 w-10 object-cover rounded flex-shrink-0"},null,8,Ke)):(o(),M(n(te),{key:1,class:"h-5 w-5 text-muted-foreground flex-shrink-0"})),y("div",We,[y("p",Xe,c(_.name),1),y("p",Ze,c(n(D)(_.size)),1)])]),l.disabled?m("",!0):(o(),M(n(P),{key:0,type:"button",variant:"ghost",size:"sm",onClick:A=>j(S)},{default:v(()=>[p(n(Q),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"]))]),s.value.has(_.name)?(o(),d("div",Je,[y("div",Qe,[w[1]||(w[1]=y("span",null,"Subiendo...",-1)),y("span",null,c(s.value.get(_.name))+"%",1)]),y("div",et,[y("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:oe({width:`${s.value.get(_.name)}%`})},w[2]||(w[2]=[y("div",{class:"h-full bg-white/30 animate-pulse"},null,-1)]),4)])])):m("",!0),t.value.has(_.name)?(o(),d("p",tt,c(t.value.get(_.name)),1)):m("",!0)])]),_:2},1032,["class"]))),128))])])):m("",!0),l.error?(o(),d("p",at,c(l.error),1)):m("",!0),!l.disabled&&r.value?(o(),d("div",st,[l.multiple?(o(),d("p",lt,c(i.value.length+f.value.length)+" de "+c(l.maxFiles)+" archivos ",1)):m("",!0)])):m("",!0)]))}}),ot={class:"space-y-2"},rt={key:0,class:"text-red-500 ml-1"},nt={key:1,class:"text-sm text-muted-foreground"},it={class:"relative"},dt={class:"flex gap-2"},ut={class:"flex-1 relative"},ct={key:0,class:"text-xs text-muted-foreground mt-1"},mt=["id"],pt={key:3,class:"text-xs text-muted-foreground space-y-1"},ft={key:0},vt={key:1},ht={key:2},yt={key:3},bt=Z({__name:"DatePickerField",props:{modelValue:{},label:{},description:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{},minDate:{},maxDate:{},format:{default:"DD/MM/YYYY"},allowPastDates:{type:Boolean,default:!0},allowFutureDates:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(F,{emit:C}){const u=F,b=C,h=I({get:()=>{if(!u.modelValue)return"";let e;if(u.modelValue instanceof Date?e=u.modelValue:e=new Date(u.modelValue),isNaN(e.getTime()))return"";const s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${s}-${t}-${i}`},set:e=>{if(!e){b("update:modelValue",null);return}const s=new Date(e),t=new Date;t.setHours(0,0,0,0),s.setHours(0,0,0,0),!(!u.allowPastDates&&s<t)&&(!u.allowFutureDates&&s>t||b("update:modelValue",e))}}),g=I(()=>u.minDate?u.minDate:u.allowPastDates?"":new Date().toISOString().split("T")[0]),E=I(()=>u.maxDate?u.maxDate:u.allowFutureDates?"":new Date().toISOString().split("T")[0]),V=e=>{if(!e)return"";try{const[s,t,i]=e.split("-");return u.format==="DD/MM/YYYY"?`${i}/${t}/${s}`:e}catch(s){return console.error("Error al formatear fecha:",s),e}},D=I(()=>h.value?V(h.value):""),q=()=>{b("update:modelValue",null)},f=`datepicker-${Math.random().toString(36).substr(2,9)}`;return(e,s)=>(o(),d("div",ot,[e.label?(o(),M(n(U),{key:0,for:f,class:"text-sm font-medium"},{default:v(()=>[x(c(e.label)+" ",1),e.required?(o(),d("span",rt,"*")):m("",!0)]),_:1})):m("",!0),e.description?(o(),d("p",nt,c(e.description),1)):m("",!0),y("div",it,[y("div",dt,[y("div",ut,[p(n(H),{id:f,type:"date",modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=t=>h.value=t),disabled:e.disabled,min:g.value,max:E.value,class:W(["w-full",e.error?"border-red-300 focus:border-red-500":""]),"aria-invalid":!!e.error,"aria-describedby":e.error?`${f}-error`:void 0},null,8,["modelValue","disabled","min","max","class","aria-invalid","aria-describedby"]),p(n(we),{class:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"})]),!e.required&&h.value?(o(),M(n(P),{key:0,type:"button",variant:"outline",size:"icon",onClick:q,disabled:e.disabled,title:"Limpiar fecha"},{default:v(()=>[p(n(Q),{class:"h-4 w-4"})]),_:1},8,["disabled"])):m("",!0)]),D.value&&e.format!=="YYYY-MM-DD"?(o(),d("p",ct," Fecha seleccionada: "+c(D.value),1)):m("",!0)]),e.error?(o(),d("p",{key:2,id:`${f}-error`,class:"text-sm text-red-600"},c(e.error),9,mt)):m("",!0),!e.allowPastDates||!e.allowFutureDates||e.minDate||e.maxDate?(o(),d("div",pt,[!e.allowPastDates&&!e.minDate?(o(),d("p",ft," * No se permiten fechas pasadas ")):m("",!0),!e.allowFutureDates&&!e.maxDate?(o(),d("p",vt," * No se permiten fechas futuras ")):m("",!0),e.minDate?(o(),d("p",ht," * Fecha mínima: "+c(V(e.minDate)),1)):m("",!0),e.maxDate?(o(),d("p",yt," * Fecha máxima: "+c(V(e.maxDate)),1)):m("",!0)])):m("",!0)]))}}),_t={class:"space-y-2"},gt={class:"flex items-start space-x-3"},$t={class:"flex-1 space-y-1"},kt={key:0,class:"text-red-500 ml-1"},wt={key:0,class:"text-sm text-muted-foreground"},xt={key:1,class:"text-xs text-green-600"},Ft=["id"],Dt={class:"my-6 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700"},Ct=["innerHTML"],ma=Z({__name:"DisclaimerField",props:{modelValue:{type:[Boolean,Object,null]},label:{},description:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{},disclaimerText:{},modalTitle:{default:"Términos y Condiciones"},acceptButtonText:{default:"Acepto"},declineButtonText:{default:"No acepto"}},emits:["update:modelValue"],setup(F,{emit:C}){const u=F,b=C,h=T(!1),g=T(!1),E=T(null);u.modelValue&&(typeof u.modelValue=="boolean"?g.value=u.modelValue:typeof u.modelValue=="object"&&u.modelValue.accepted&&(g.value=u.modelValue.accepted,E.value=u.modelValue.timestamp||null)),X(()=>u.modelValue,s=>{s?typeof s=="boolean"?g.value=s:typeof s=="object"&&s.accepted!==void 0&&(g.value=s.accepted,E.value=s.timestamp||null):(g.value=!1,E.value=null)});const V=s=>{s&&!g.value&&!u.disabled?h.value=!0:s||q()},D=()=>{g.value=!0,E.value=new Date().toISOString(),b("update:modelValue",{accepted:!0,timestamp:E.value}),h.value=!1},q=()=>{g.value=!1,E.value=null,b("update:modelValue",null),h.value=!1},f=`disclaimer-${Math.random().toString(36).substr(2,9)}`,e=s=>new Date(s).toLocaleString("es-CO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(s,t)=>(o(),d("div",_t,[y("div",gt,[p(n(se),{id:f,checked:g.value,"onUpdate:checked":V,disabled:s.disabled,"aria-invalid":!!s.error,"aria-describedby":s.error?`${f}-error`:void 0,class:"mt-1"},null,8,["checked","disabled","aria-invalid","aria-describedby"]),y("div",$t,[p(n(U),{for:f,class:"text-sm font-medium cursor-pointer leading-relaxed",onClick:t[0]||(t[0]=()=>!s.disabled&&!g.value&&(h.value=!0))},{default:v(()=>[x(c(s.label)+" ",1),s.required?(o(),d("span",kt,"*")):m("",!0)]),_:1}),s.description?(o(),d("p",wt,c(s.description),1)):m("",!0),g.value&&E.value?(o(),d("p",xt," ✓ Aceptado el "+c(e(E.value)),1)):m("",!0),s.disabled?m("",!0):(o(),d("button",{key:2,type:"button",onClick:t[1]||(t[1]=i=>h.value=!0),class:"text-xs text-blue-600 hover:text-blue-800 underline"},c(g.value?"Ver términos aceptados":"Leer términos y condiciones"),1))])]),s.error?(o(),d("p",{key:0,id:`${f}-error`,class:"text-sm text-red-600 ml-6"},c(s.error),9,Ft)):m("",!0),p(n(ce),{open:h.value,"onUpdate:open":t[3]||(t[3]=i=>h.value=i)},{default:v(()=>[p(n(me),{class:"max-w-2xl max-h-[80vh] overflow-y-auto"},{default:v(()=>[p(n(pe),null,{default:v(()=>[p(n(fe),null,{default:v(()=>[x(c(s.modalTitle),1)]),_:1}),p(n(ve),null,{default:v(()=>t[4]||(t[4]=[x(" Por favor, lea atentamente los siguientes términos y condiciones: ")])),_:1})]),_:1}),y("div",Dt,[y("div",{class:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap",innerHTML:s.disclaimerText},null,8,Ct)]),p(n(he),{class:"flex gap-2 sm:gap-0"},{default:v(()=>[!g.value||!s.disabled?(o(),M(n(P),{key:0,type:"button",variant:"outline",onClick:q,disabled:s.disabled},{default:v(()=>[x(c(s.declineButtonText),1)]),_:1},8,["disabled"])):m("",!0),!g.value||!s.disabled?(o(),M(n(P),{key:1,type:"button",onClick:D,disabled:s.disabled},{default:v(()=>[x(c(s.acceptButtonText),1)]),_:1},8,["disabled"])):m("",!0),g.value&&s.disabled?(o(),M(n(P),{key:2,type:"button",variant:"outline",onClick:t[2]||(t[2]=i=>h.value=!1)},{default:v(()=>t[5]||(t[5]=[x(" Cerrar ")])),_:1})):m("",!0)]),_:1})]),_:1})]),_:1},8,["open"])]))}}),St={class:"space-y-4"},At={key:0,class:"text-red-500 ml-1"},Mt={key:0,class:"text-sm text-muted-foreground mt-1"},Et={key:1,class:"text-xs text-muted-foreground mt-1"},Bt={class:"space-y-3"},Ut={class:"flex items-center justify-between"},zt={class:"flex items-center gap-2"},Tt={class:"text-sm font-medium"},It={key:0,class:"text-red-500 ml-1"},Vt={key:0,class:"text-red-500 ml-1"},qt={key:0,class:"text-red-500 ml-1"},Pt={key:0,class:"text-red-500 ml-1"},jt={key:0,class:"text-red-500 ml-1"},Lt={key:0,class:"text-red-500 ml-1"},Rt={key:0,class:"text-red-500 ml-1"},Yt={class:"space-y-2"},Nt=["id","name","value","checked","onChange","disabled"],Ht={key:0,class:"text-red-500 ml-1"},Ot={class:"space-y-2"},Gt={key:1,class:"text-sm text-muted-foreground text-center"},Kt={key:2,class:"text-sm text-red-600"},pa=Z({__name:"RepeaterField",props:{modelValue:{},label:{},description:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{},minItems:{default:0},maxItems:{default:10},itemName:{default:"Elemento"},addButtonText:{default:"Agregar elemento"},removeButtonText:{default:"Eliminar"},fields:{}},emits:["update:modelValue"],setup(F,{emit:C}){const u=F,b=C,h=T([]);if(u.modelValue&&Array.isArray(u.modelValue))h.value=u.modelValue;else if(u.minItems>0)for(let t=0;t<u.minItems;t++)h.value.push(g());X(()=>u.modelValue,t=>{t&&Array.isArray(t)&&(h.value=t)}),X(h,t=>{b("update:modelValue",t)},{deep:!0});function g(){const t={id:`item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,data:{}};return u.fields.forEach(i=>{i.type==="checkbox"?t.data[i.id]=[]:i.type==="repeater"?t.data[i.id]=[]:t.data[i.id]=""}),t}const E=()=>{h.value.length<u.maxItems&&h.value.push(g())},V=t=>{h.value.length>u.minItems&&h.value.splice(t,1)},D=(t,i,r)=>{h.value[t]&&(h.value[t].data[i]=r)},q=(t,i,r,$)=>{const a=h.value[t].data[i]||[];let k;$?k=[...a,r]:k=a.filter(B=>B!==r),D(t,i,k)},f=I(()=>h.value.length<u.maxItems),e=I(()=>h.value.length>u.minItems),s=I(()=>{const t=[];return u.minItems>0&&t.push(`Mínimo ${u.minItems} elemento${u.minItems>1?"s":""}`),u.maxItems<1/0&&t.push(`Máximo ${u.maxItems} elemento${u.maxItems>1?"s":""}`),t.length>0?t.join(" | "):""});return(t,i)=>(o(),d("div",St,[y("div",null,[p(n(U),{class:"text-base font-semibold"},{default:v(()=>[x(c(t.label)+" ",1),t.required?(o(),d("span",At,"*")):m("",!0)]),_:1}),t.description?(o(),d("p",Mt,c(t.description),1)):m("",!0),s.value?(o(),d("p",Et,c(s.value),1)):m("",!0)]),y("div",Bt,[(o(!0),d(z,null,N(h.value,(r,$)=>(o(),M(n(K),{key:r.id,class:W(["relative",[t.disabled?"opacity-60":""]])},{default:v(()=>[p(n(ne),{class:"pb-3"},{default:v(()=>[y("div",Ut,[y("div",zt,[p(n(Fe),{class:"h-4 w-4 text-muted-foreground"}),y("span",Tt,c(t.itemName)+" "+c($+1),1)]),e.value?(o(),M(n(P),{key:0,type:"button",variant:"ghost",size:"sm",onClick:a=>V($),disabled:t.disabled,class:"h-8 px-2"},{default:v(()=>[p(n(De),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick","disabled"])):m("",!0)])]),_:2},1024),p(n(ae),{class:"space-y-4"},{default:v(()=>[(o(!0),d(z,null,N(t.fields,a=>{var k,B,R,j,O;return o(),d("div",{key:a.id,class:"space-y-2"},[a.type==="text"?(o(),d(z,{key:0},[p(n(U),{for:`${r.id}-${a.id}`,class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",It,"*")):m("",!0)]),_:2},1032,["for"]),p(n(H),{id:`${r.id}-${a.id}`,"model-value":r.data[a.id]||"","onUpdate:modelValue":l=>D($,a.id,l),placeholder:a.description,disabled:t.disabled},null,8,["id","model-value","onUpdate:modelValue","placeholder","disabled"])],64)):a.type==="textarea"?(o(),d(z,{key:1},[p(n(U),{for:`${r.id}-${a.id}`,class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",Vt,"*")):m("",!0)]),_:2},1032,["for"]),p(n(ye),{id:`${r.id}-${a.id}`,"model-value":r.data[a.id]||"","onUpdate:modelValue":l=>D($,a.id,l),placeholder:a.description,disabled:t.disabled,rows:"3"},null,8,["id","model-value","onUpdate:modelValue","placeholder","disabled"])],64)):a.type==="number"?(o(),d(z,{key:2},[p(n(U),{for:`${r.id}-${a.id}`,class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",qt,"*")):m("",!0)]),_:2},1032,["for"]),p(n(H),{id:`${r.id}-${a.id}`,type:"number","model-value":r.data[a.id]||"","onUpdate:modelValue":l=>D($,a.id,l),placeholder:a.description,disabled:t.disabled},null,8,["id","model-value","onUpdate:modelValue","placeholder","disabled"])],64)):a.type==="email"?(o(),d(z,{key:3},[p(n(U),{for:`${r.id}-${a.id}`,class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",Pt,"*")):m("",!0)]),_:2},1032,["for"]),p(n(H),{id:`${r.id}-${a.id}`,type:"email","model-value":r.data[a.id]||"","onUpdate:modelValue":l=>D($,a.id,l),placeholder:"ejemplo@correo.com",disabled:t.disabled},null,8,["id","model-value","onUpdate:modelValue","disabled"])],64)):a.type==="date"?(o(),d(z,{key:4},[p(n(U),{for:`${r.id}-${a.id}`,class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",jt,"*")):m("",!0)]),_:2},1032,["for"]),p(n(H),{id:`${r.id}-${a.id}`,type:"date","model-value":r.data[a.id]||"","onUpdate:modelValue":l=>D($,a.id,l),disabled:t.disabled},null,8,["id","model-value","onUpdate:modelValue","disabled"])],64)):a.type==="datepicker"?(o(),M(bt,{key:5,"model-value":r.data[a.id]||null,"onUpdate:modelValue":l=>D($,a.id,l),label:a.title,description:a.description,required:a.required,disabled:t.disabled,minDate:(k=a.datepickerConfig)==null?void 0:k.minDate,maxDate:(B=a.datepickerConfig)==null?void 0:B.maxDate,format:(R=a.datepickerConfig)==null?void 0:R.format,allowPastDates:(j=a.datepickerConfig)==null?void 0:j.allowPastDates,allowFutureDates:(O=a.datepickerConfig)==null?void 0:O.allowFutureDates},null,8,["model-value","onUpdate:modelValue","label","description","required","disabled","minDate","maxDate","format","allowPastDates","allowFutureDates"])):a.type==="select"?(o(),d(z,{key:6},[p(n(U),{for:`${r.id}-${a.id}`,class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",Lt,"*")):m("",!0)]),_:2},1032,["for"]),p(n(be),{"model-value":r.data[a.id]||"","onUpdate:modelValue":l=>D($,a.id,l),disabled:t.disabled},{default:v(()=>[p(n(_e),null,{default:v(()=>[p(n(ge),{placeholder:`Seleccionar ${a.title.toLowerCase()}`},null,8,["placeholder"])]),_:2},1024),p(n($e),null,{default:v(()=>[(o(!0),d(z,null,N(a.options,l=>(o(),M(n(ke),{key:l,value:l},{default:v(()=>[x(c(l),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue","disabled"])],64)):a.type==="radio"?(o(),d(z,{key:7},[p(n(U),{class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",Rt,"*")):m("",!0)]),_:2},1024),y("div",Yt,[(o(!0),d(z,null,N(a.options,l=>(o(),d("div",{key:l,class:"flex items-center space-x-2"},[y("input",{id:`${r.id}-${a.id}-${l}`,type:"radio",name:`${r.id}-${a.id}`,value:l,checked:r.data[a.id]===l,onChange:()=>D($,a.id,l),disabled:t.disabled,class:"h-4 w-4"},null,40,Nt),p(n(U),{for:`${r.id}-${a.id}-${l}`,class:"text-sm font-normal"},{default:v(()=>[x(c(l),1)]),_:2},1032,["for"])]))),128))])],64)):a.type==="checkbox"?(o(),d(z,{key:8},[p(n(U),{class:"text-sm"},{default:v(()=>[x(c(a.title)+" ",1),a.required?(o(),d("span",Ht,"*")):m("",!0)]),_:2},1024),y("div",Ot,[(o(!0),d(z,null,N(a.options,l=>(o(),d("div",{key:l,class:"flex items-center space-x-2"},[p(n(se),{id:`${r.id}-${a.id}-${l}`,checked:(r.data[a.id]||[]).includes(l),"onUpdate:checked":w=>q($,a.id,l,w),disabled:t.disabled},null,8,["id","checked","onUpdate:checked","disabled"]),p(n(U),{for:`${r.id}-${a.id}-${l}`,class:"text-sm font-normal"},{default:v(()=>[x(c(l),1)]),_:2},1032,["for"])]))),128))])],64)):m("",!0)])}),128))]),_:2},1024)]),_:2},1032,["class"]))),128))]),f.value?(o(),M(n(P),{key:0,type:"button",variant:"outline",onClick:E,disabled:t.disabled,class:"w-full"},{default:v(()=>[p(n(xe),{class:"h-4 w-4 mr-2"}),x(" "+c(t.addButtonText),1)]),_:1},8,["disabled"])):m("",!0),f.value?m("",!0):(o(),d("p",Gt," Has alcanzado el límite máximo de "+c(t.maxItems)+" elementos ",1)),t.error?(o(),d("p",Kt,c(t.error),1)):m("",!0)]))}});function fa(F,C){const u=T(new Map);X(C,()=>{u.value.clear()},{deep:!0});const b=(e,s,t)=>{const i=r=>r==null?"":typeof r=="boolean"?r?"true":"false":String(r);switch(s){case"equals":return Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every(r=>t.includes(r)):i(e)===i(t);case"not_equals":return Array.isArray(e)&&Array.isArray(t)?e.length!==t.length||!e.every(r=>t.includes(r)):i(e)!==i(t);case"contains":return Array.isArray(e)?Array.isArray(t)?t.some(r=>e.includes(r)):e.includes(t):i(e).includes(i(t));case"not_contains":return Array.isArray(e)?Array.isArray(t)?!t.some(r=>e.includes(r)):!e.includes(t):!i(e).includes(i(t));case"is_empty":return Array.isArray(e)?e.length===0:!e||i(e)==="";case"is_not_empty":return Array.isArray(e)?e.length>0:!!e&&i(e)!=="";default:return console.warn(`Operador condicional no soportado: ${s}`),!0}},h=e=>{var a;if(!((a=e.conditionalConfig)!=null&&a.enabled))return!0;const s=e.id;if(u.value.has(s))return u.value.get(s);const{showWhen:t,conditions:i}=e.conditionalConfig;if(!i||i.length===0)return!0;const r=i.map(k=>{const B=C.value[k.fieldId];return b(B,k.operator,k.value)}),$=t==="all"?r.every(k=>k):r.some(k=>k);return u.value.set(s,$),$},g=I(()=>F.value.filter(e=>h(e)));return{evaluateCondition:b,shouldShowField:h,visibleFields:g,getDependentFields:e=>F.value.filter(s=>{var t;return(t=s.conditionalConfig)!=null&&t.enabled?s.conditionalConfig.conditions.some(i=>i.fieldId===e):!1}),validateConditionalRules:e=>{var $;const s=[];if(!(($=e.conditionalConfig)!=null&&$.enabled))return s;e.conditionalConfig.conditions.some(a=>a.fieldId===e.id)&&s.push(`El campo "${e.title}" no puede depender de sí mismo`),e.conditionalConfig.conditions.forEach(a=>{const k=F.value.find(B=>B.id===a.fieldId);k?["select","radio","checkbox"].includes(k.type)||s.push(`El campo "${e.title}" depende de "${k.title}" que no es de tipo select, radio o checkbox`):s.push(`El campo "${e.title}" hace referencia a un campo inexistente: ${a.fieldId}`)});const i=new Set,r=(a,k=[])=>{var R;if(k.includes(a))return s.push(`Referencia circular detectada: ${[...k,a].join(" → ")}`),!0;if(i.has(a))return!1;i.add(a);const B=F.value.find(j=>j.id===a);if(!((R=B==null?void 0:B.conditionalConfig)!=null&&R.enabled))return!1;for(const j of B.conditionalConfig.conditions)r(j.fieldId,[...k,a]);return!1};return r(e.id),s},getAvailableSourceFields:e=>F.value.filter(s=>s.id===e?!1:["select","radio","checkbox"].includes(s.type)),getFieldOptions:e=>{const s=F.value.find(t=>t.id===e);return s?s.options&&s.options.length>0?s.options:s.type==="checkbox"?["checked","unchecked"]:[]:[]},clearHiddenFieldValues:()=>{F.value.forEach(e=>{h(e)||(e.type==="checkbox"?C.value[e.id]=[]:e.type==="repeater"?C.value[e.id]=[]:e.type==="disclaimer"?C.value[e.id]=null:C.value[e.id]="")})},evaluationCache:I(()=>u.value)}}export{ca as _,fa as a,bt as b,ma as c,pa as d,Ce as u};
