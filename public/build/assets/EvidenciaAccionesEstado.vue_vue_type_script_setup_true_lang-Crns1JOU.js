import{d as E,r as c,p as k,i as x,e as l,j as V,f as n,n as F,w as d,g as w,h,F as M,t as b,m as v,c as z,k as D,s as N,b as j,x as q}from"./app-DvZ1-K7a.js";import{_ as $}from"./createLucideIcon-P3NRsumo.js";import{_ as L}from"./Switch.vue_vue_type_script_setup_true_lang-HFkTo7ev.js";import{_ as S}from"./Label.vue_vue_type_script_setup_true_lang-CGy7mMpA.js";import{_ as T,a as O,b as X,c as G,d as H,e as J}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BNj1aFxp.js";import{t as U}from"./index-Bbh0mYdX.js";import{R as K}from"./RichTextEditor-Cj8wO5rW.js";import{_ as Q}from"./FileUploadField.vue_vue_type_script_setup_true_lang-Dxx8Qlpt.js";import{P as W}from"./paperclip-DiSzydwU.js";import{C as Y}from"./clock-Dgxe2pZn.js";import{C as Z}from"./circle-x-DN7i0mds.js";import{C as ee}from"./circle-check-big-Dsstb7RP.js";const ae={class:"space-y-3"},oe={key:0,class:"mt-2"},le={key:1,class:"flex items-center"},te={class:"text-xs"},se=E({__name:"ComentarioContextoInput",props:{modelValue:{default:""},placeholder:{default:"Escribe un comentario..."},rows:{default:3},showFileUpload:{type:Boolean,default:!0},uploadModule:{default:"comentarios"},uploadFieldId:{default:"archivos"}},emits:["update:modelValue","update:archivos"],setup(m,{expose:g,emit:_}){const a=m,p=_,i=c(a.modelValue),e=c([]),u=c(!1);k(()=>a.modelValue,t=>{i.value=t}),k(i,t=>{p("update:modelValue",t)}),k(e,t=>{p("update:archivos",t)},{deep:!0});const y=()=>{u.value=!u.value};return g({clear:()=>{i.value="",e.value=[],u.value=!1},getContenido:()=>i.value,getArchivos:()=>e.value,isValid:()=>i.value.replace(/<[^>]*>/g,"").trim().length>0}),(t,f)=>(v(),x("div",ae,[l(K,{modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=C=>i.value=C),placeholder:m.placeholder,rows:m.rows},null,8,["modelValue","placeholder","rows"]),m.showFileUpload&&u.value?(v(),x("div",oe,[l(Q,{modelValue:e.value,"onUpdate:modelValue":f[1]||(f[1]=C=>e.value=C),label:"Archivos adjuntos",description:"Máximo 3 archivos de 10MB cada uno",module:m.uploadModule,"field-id":m.uploadFieldId,multiple:!0,"max-files":3,"max-file-size":10,accept:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.xls,.xlsx","auto-upload":!0},null,8,["modelValue","module","field-id"])])):V("",!0),m.showFileUpload?(v(),x("div",le,[l(n($),{variant:"ghost",size:"sm",type:"button",onClick:y,class:F({"text-primary":u.value||e.value.length>0}),title:"Adjuntar archivos"},{default:d(()=>[l(n(W),{class:"h-4 w-4 mr-1"}),w("span",te,[f[2]||(f[2]=h(" Adjuntar archivos ",-1)),e.value.length>0?(v(),x(M,{key:0},[h("("+b(e.value.length)+")",1)],64)):V("",!0)])]),_:1},8,["class"])])):V("",!0)]))}}),re={class:"flex items-center gap-2"},ne={class:"space-y-4 py-4"},ie={class:"flex items-center justify-between"},ue={key:0,class:"space-y-2"},Ve=E({__name:"EvidenciaAccionesEstado",props:{evidencia:{},proyectoId:{},estadoActual:{}},setup(m){const g=m,_=c(!1),a=c(null),p=c(""),i=c([]),e=c(!1),u=c(!1),y=c(null),t={aprobada:{label:"Aprobar",icon:ee,color:"text-green-600 hover:text-green-700 hover:bg-green-50",variant:"ghost",defaultComentario:!1},rechazada:{label:"Rechazar",icon:Z,color:"text-red-600 hover:text-red-700 hover:bg-red-50",variant:"ghost",defaultComentario:!0},pendiente:{label:"A Pendiente",icon:Y,color:"text-yellow-600 hover:text-yellow-700 hover:bg-yellow-50",variant:"ghost",defaultComentario:!1}},f=z(()=>{const o=[];return g.estadoActual!=="aprobada"&&o.push("aprobada"),g.estadoActual!=="rechazada"&&o.push("rechazada"),g.estadoActual!=="pendiente"&&o.push("pendiente"),o}),C=z(()=>a.value?`${t[a.value].label} evidencia`:""),B=z(()=>a.value?{aprobada:"¿Confirmas que deseas aprobar esta evidencia?",rechazada:"¿Confirmas que deseas rechazar esta evidencia?",pendiente:"¿Confirmas que deseas devolver esta evidencia a estado pendiente?"}[a.value]:""),I=o=>{a.value=o,p.value="",e.value=t[o].defaultComentario,_.value=!0},P=()=>{a.value&&(u.value=!0,N.post(`/admin/proyectos/${g.proyectoId}/evidencias/${g.evidencia.id}/cambiar-estado`,{estado:a.value,comentario:e.value?p.value:null,agregar_comentario:e.value,archivos:e.value?i.value:[]},{preserveScroll:!0,onSuccess:()=>{U.success(`Estado cambiado a ${a.value}`),_.value=!1,A()},onError:o=>{const s=Object.values(o).flat().join(", ")||"Error al cambiar estado";U.error(s)},onFinish:()=>{u.value=!1}}))},A=()=>{var o;p.value="",i.value=[],(o=y.value)==null||o.clear()},R=()=>{_.value=!1,a.value=null,e.value=!1,A()};return(o,s)=>(v(),x("div",re,[(v(!0),x(M,null,D(f.value,r=>(v(),j(n($),{key:r,variant:t[r].variant,size:"sm",class:F(["h-8",t[r].color]),onClick:de=>I(r)},{default:d(()=>[(v(),j(q(t[r].icon),{class:"h-4 w-4 mr-1"})),h(" "+b(t[r].label),1)]),_:2},1032,["variant","class","onClick"]))),128)),l(n(J),{open:_.value,"onUpdate:open":s[3]||(s[3]=r=>_.value=r)},{default:d(()=>[l(n(T),{class:"sm:max-w-lg"},{default:d(()=>[l(n(O),null,{default:d(()=>[l(n(X),null,{default:d(()=>[h(b(C.value),1)]),_:1}),l(n(G),null,{default:d(()=>[h(b(B.value),1)]),_:1})]),_:1}),w("div",ne,[w("div",ie,[l(n(S),{for:"agregar-comentario",class:"text-sm"},{default:d(()=>[h(b(a.value==="rechazada"?"Agregar motivo":"Agregar comentario"),1)]),_:1}),l(n(L),{id:"agregar-comentario",modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=r=>e.value=r)},null,8,["modelValue"])]),e.value?(v(),x("div",ue,[l(se,{ref_key:"comentarioInputRef",ref:y,modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=r=>p.value=r),placeholder:a.value==="rechazada"?"Describe el motivo del rechazo...":"Agrega un comentario opcional...",rows:3,"show-file-upload":!0,"upload-module":"comentarios","upload-field-id":"evidencia-comentario","onUpdate:archivos":s[2]||(s[2]=r=>i.value=r)},null,8,["modelValue","placeholder"]),s[4]||(s[4]=w("p",{class:"text-xs text-muted-foreground"}," Este comentario aparecerá con el badge del nuevo estado. ",-1))])):V("",!0)]),l(n(H),{class:"gap-2 sm:gap-0"},{default:d(()=>[l(n($),{variant:"outline",onClick:R,disabled:u.value},{default:d(()=>[...s[5]||(s[5]=[h(" Cancelar ",-1)])]),_:1},8,["disabled"]),l(n($),{variant:a.value==="rechazada"?"destructive":"default",onClick:P,disabled:u.value},{default:d(()=>[h(b(u.value?"Procesando...":"Confirmar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}});export{Ve as _};
