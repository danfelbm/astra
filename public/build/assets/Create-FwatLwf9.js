import{d as $e,u as Ee,r as N,c as j,p as ae,U as we,o as Pe,M as Ae,B as ze,b as y,w as r,g as n,e as t,f as o,v as Fe,h as l,j as _,i as p,m as u,t as f,l as Ne,F as E,k as w,s as K}from"./app-B8jLIquf.js";import{_ as De}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Ds5Yb68h.js";import{_ as x,a as V,b as C,c as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-CwvDUtJA.js";import{_ as U}from"./CardDescription.vue_vue_type_script_setup_true_lang-DQU_0X32.js";import{_ as k}from"./createLucideIcon-CoRxGeMz.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-D1BhiD8f.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-nBWFi7Vu.js";import{_ as te}from"./Textarea.vue_vue_type_script_setup_true_lang-D6TsEDRL.js";import{_ as B,a as O,b as T,c as L,d as b}from"./SelectValue.vue_vue_type_script_setup_true_lang-D9pbqtVi.js";import{_ as Ie,a as je}from"./index-p_mdT28X.js";import{_ as Be,a as Oe,b as D,c as I}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Cwgl2Cjw.js";import{u as Te}from"./useToast-dIdmubGi.js";import{u as Le,_ as Me}from"./FileUploadField.vue_vue_type_script_setup_true_lang-C8MtqAC1.js";import{u as Re}from"./useAutoSave-DuWmTXXL.js";import{_ as W}from"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-Dw6UqA5S.js";import{_ as re}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-Bo72ivqV.js";import{A as qe}from"./arrow-left-CZ17viy3.js";import{C as Ge}from"./clock-B42ucROl.js";import{C as Je}from"./circle-check-big-DL6IK3Z8.js";import{C as se}from"./circle-alert-BEl5DoMm.js";import{X as le}from"./x-Db305Yr4.js";import{U as Xe}from"./user-plus-tJbBgtxp.js";import{U as ie}from"./users-S8AX2-Wm.js";import{T as Ke}from"./trash-2-DvXkYhPp.js";import{S as We}from"./save-BZ3kc2fV.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BQoIb-iH.js";import"./index-DsoRH3_1.js";import"./floating-ui.vue-CDqra15C.js";import"./index-xH6fuIAq.js";import"./shield-BleVYcej.js";import"./user-DXGm6IYr.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-yEqYuGKr.js";import"./chevron-right-40KxJyU6.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DoqjFrKn.js";import"./VisuallyHidden-c5G_Y1-F.js";import"./index-gUIEoC_C.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Cuu9V0m-.js";import"./index-BIFztAr4.js";import"./map-pin-VuOGBv30.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-CcYYl75a.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DUIj5-nr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-DATvKK5h.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CtpK6IOL.js";import"./tag-BF3vhfWv.js";import"./target-DMpZWzHm.js";import"./vote-BsZDzqyH.js";import"./folder-open-C9XMhm5o.js";import"./send-DArdzb31.js";import"./file-text-BxT36rHH.js";import"./briefcase-HN0MUFbh.js";import"./calendar-DjVB9cun.js";import"./megaphone-C3_U7m_D.js";import"./user-check-Z5NneTb1.js";import"./clipboard-list-B5Tcs7Qu.js";import"./mail-B0-advyj.js";import"./message-square-BCI0N4Q4.js";import"./external-link-B9xWD9Tf.js";import"./panel-left-D_Nud89_.js";import"./index-CI4aGeLr.js";import"./check-D6Hm08tN.js";import"./index-BnsEjg8Z.js";import"./RovingFocusItem-7klXaaP1.js";import"./utils-rBtsDzTD.js";import"./upload-BTBVwZnN.js";import"./file-DKIX_7Ab.js";import"./eye-C7BaLt1I.js";import"./download-Do-dgtjd.js";import"./debounce-CBXp3j32.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CiSShXV_.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-DfmcVgNZ.js";import"./VisuallyHiddenInput-9I-8Ol0L.js";import"./circle-Bc-bByGS.js";import"./search-Bql3zAAR.js";import"./loader-circle-DyVtUl3V.js";import"./chevron-left-D7Chpj23.js";const He={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Qe={class:"flex items-center justify-between"},Ye={class:"flex items-center gap-4"},Ze={class:"flex items-center gap-2 text-sm text-muted-foreground"},eo={key:3},oo={key:4},ao={key:5},to={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-blue-600 rounded-full"},ro={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},so={key:0,class:"text-red-500 text-sm mt-1"},lo={key:0,class:"text-red-500 text-sm mt-1"},io={key:0,class:"text-red-500 text-sm mt-1"},no={key:0,class:"space-y-4 pt-4 border-t"},uo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},po={key:0,class:"text-red-500 text-sm mt-1"},mo={key:0,class:"text-red-500 text-sm mt-1"},co={key:0,class:"text-red-500 text-sm mt-1"},fo={key:0,class:"text-red-500 text-sm mt-1"},_o={key:0},vo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bo={key:0,class:"text-red-500 text-sm mt-1"},go={key:0,class:"text-red-500 text-sm mt-1"},ho={key:0,class:"space-y-4 pt-4 border-t"},yo={class:"space-y-6"},xo={class:"space-y-4"},Vo={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},Co={class:"font-medium"},So={class:"text-sm text-muted-foreground"},Uo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ko={class:"space-y-4"},$o={key:0,class:"space-y-2"},Eo={class:"flex items-center justify-between"},wo={class:"font-medium"},Po={class:"text-sm text-muted-foreground"},Ao={class:"flex items-center gap-2 mt-1"},zo={class:"text-xs bg-primary/10 text-primary px-2 py-1 rounded"},Fo={key:0,class:"text-xs text-muted-foreground"},No={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},Do={key:0,class:"text-red-500 text-sm mt-1"},Io={key:0,class:"space-y-4 pt-4 border-t"},jo={class:"flex justify-between items-center gap-4"},Bo={key:1},Oo={class:"flex gap-4"},dt=$e({__name:"Create",props:{proyecto:{},proyectos:{},camposPersonalizados:{},usuarios:{default:()=>[]},borrador:{default:void 0}},setup(M){var oe;const m=M,g=Te(),{uploadFiles:ne}=Le(),de=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:"Crear Contrato",href:"/admin/contratos/create"}],a=Ee({proyecto_id:((oe=m.proyecto)==null?void 0:oe.id)||"",nombre:"",descripcion:"",fecha_inicio:"",fecha_fin:"",estado:"borrador",tipo:"servicio",monto_total:"",moneda:"USD",responsable_id:"none",contraparte_user_id:null,contraparte_nombre:"",contraparte_identificacion:"",contraparte_email:"",contraparte_telefono:"",participantes:[],archivo_pdf:null,archivos_paths:[],archivos_nombres:[],tipos_archivos:{},observaciones:"",campos_personalizados:{}}),ue=N(""),P=N([]),G=N("informacion"),A=N([]),J=N(!1),X=N(!1),{route:z}=window,R=j(()=>{var i;return a.contraparte_user_id?(i=m.usuarios)==null?void 0:i.find(e=>e.id===a.contraparte_user_id):null}),pe=j(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"testigo",label:"Testigo"},{value:"revisor",label:"Revisor"},{value:"aprobador",label:"Aprobador"},{value:"observador",label:"Observador"}],value:"testigo",required:!0},{name:"notas",label:"Notas (opcional)",type:"text",value:"",required:!1}]),me=j(()=>{const i=a.participantes.map(e=>e.user_id);return a.contraparte_user_id&&i.push(a.contraparte_user_id),i}),ce=j(()=>a.data()),{state:fe,isSaving:H,hasSaved:Q,hasError:q,startWatching:_e,stopAutoSave:Y,restoreDraft:ve,clearLocalStorage:Z}=Re(ce,{url:"/admin/contratos/autosave",resourceIdField:"contrato_id",debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:"contrato_draft_create"}),be=[{value:"USD",label:"USD - Dólar Estadounidense"},{value:"EUR",label:"EUR - Euro"},{value:"MXN",label:"MXN - Peso Mexicano"},{value:"COP",label:"COP - Peso Colombiano"},{value:"ARS",label:"ARS - Peso Argentino"},{value:"CLP",label:"CLP - Peso Chileno"},{value:"PEN",label:"PEN - Sol Peruano"}],F=j(()=>{const i={informacion:[],financiero:[],otros:[]};return m.camposPersonalizados.forEach(e=>{e.slug.includes("financ")||e.slug.includes("monto")||e.slug.includes("precio")?i.financiero.push(e):e.slug.includes("info")||e.slug.includes("descrip")?i.informacion.push(e):i.otros.push(e)}),i}),ge=i=>{const e=i.target;e.files&&e.files[0]&&(a.archivo_pdf=e.files[0],ue.value=e.files[0].name)},he=async i=>{try{const e=await ne(i,{module:"contratos",fieldId:"archivos",folder:"contratos",maxSize:10485760}),d=e.map(h=>h.path),s=e.map(h=>h.name),c={};e.forEach(h=>{c[h.path]=h.mime_type}),a.archivos_paths=[...a.archivos_paths,...d],a.archivos_nombres=[...a.archivos_nombres,...s],a.tipos_archivos={...a.tipos_archivos,...c},P.value=[...P.value,...e],g.success(`${e.length} archivo(s) subido(s) exitosamente`)}catch(e){g.error(e.message||"Error al subir archivos")}},ye=()=>{const i=[];return a.proyecto_id||i.push("Debe seleccionar un proyecto"),a.nombre.trim()||i.push("El nombre del contrato es obligatorio"),a.fecha_inicio||i.push("La fecha de inicio es obligatoria"),a.fecha_fin&&a.fecha_fin<a.fecha_inicio&&i.push("La fecha de fin debe ser posterior a la fecha de inicio"),m.camposPersonalizados.forEach(e=>{e.es_requerido&&!a.campos_personalizados[e.id]&&i.push(`El campo "${e.nombre}" es obligatorio`)}),i},xe=i=>{var e;if(i.userIds.length>0){a.contraparte_user_id=i.userIds[0];const d=(e=m.usuarios)==null?void 0:e.find(s=>s.id===i.userIds[0]);d&&(a.contraparte_nombre=d.name,a.contraparte_email=d.email||"")}},Ve=i=>{i.userIds.forEach(e=>{a.participantes.some(s=>s.user_id===e)||a.participantes.push({user_id:e,rol:i.extraData.rol||"testigo",notas:i.extraData.notas||""})})},Ce=i=>{const e=a.participantes.findIndex(d=>d.user_id===i);e>-1&&a.participantes.splice(e,1)},ee=i=>{var e;return(e=m.usuarios)==null?void 0:e.find(d=>d.id===i)},Se=()=>{const i=ye();if(i.length>0){i.forEach(d=>g.error(d));return}const e=new FormData;Object.keys(a.data()).forEach(d=>{d==="campos_personalizados"?Object.keys(a.campos_personalizados).forEach(s=>{const c=a.campos_personalizados[s];c!=null&&c!==""&&e.append(`campos_personalizados[${s}]`,c)}):d==="participantes"?a.participantes.forEach((s,c)=>{e.append(`participantes[${c}][user_id]`,s.user_id.toString()),e.append(`participantes[${c}][rol]`,s.rol),s.notas&&e.append(`participantes[${c}][notas]`,s.notas)}):d==="archivos_paths"||d==="archivos_nombres"||d==="tipos_archivos"?d==="archivos_paths"&&Array.isArray(a.archivos_paths)&&a.archivos_paths.length>0?e.append("archivos_paths",JSON.stringify(a.archivos_paths)):d==="archivos_nombres"&&Array.isArray(a.archivos_nombres)&&a.archivos_nombres.length>0?e.append("archivos_nombres",JSON.stringify(a.archivos_nombres)):d==="tipos_archivos"&&a.tipos_archivos&&Object.keys(a.tipos_archivos).length>0&&e.append("tipos_archivos",JSON.stringify(a.tipos_archivos)):d==="archivo_pdf"&&a.archivo_pdf?e.append("archivo_pdf",a.archivo_pdf):d==="responsable_id"&&a[d]==="none"||a[d]!==null&&a[d]!==""&&e.append(d,a[d])}),K.post(z("admin.contratos.store"),e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{Y(),Z(),g.success("Contrato creado exitosamente")},onError:d=>{typeof d=="object"&&d!==null?Object.values(d).forEach(s=>{Array.isArray(s)?s.forEach(c=>g.error(String(c))):typeof s=="string"?g.error(s):g.error("Error al crear el contrato")}):g.error("Error al crear el contrato")}})},Ue=()=>{confirm("¿Está seguro de cancelar? Los cambios no guardados se perderán.")&&K.get(z("admin.contratos.index"))},ke=()=>{confirm("¿Está seguro de descartar el borrador? Esta acción no se puede deshacer.")&&K.delete(z("admin.contratos.borrador"),{preserveScroll:!1,onFinish:()=>{Z()}})};return ae(G,i=>{i==="archivos"&&A.value.length>0&&we(()=>{P.value=A.value,A.value=[]})}),ae(P,i=>{a.archivos_paths=i.map(d=>d.path).filter(Boolean),a.archivos_nombres=i.map(d=>d.name).filter(Boolean);const e={};i.forEach(d=>{d.path&&d.mime_type&&(e[d.path]=d.mime_type)}),a.tipos_archivos=e},{deep:!0}),Pe(()=>{var e,d;const i=Ae();if((e=i.props.flash)!=null&&e.success&&g.success(i.props.flash.success),(d=i.props.flash)!=null&&d.error&&g.error(i.props.flash.error),m.borrador){if(a.proyecto_id=m.borrador.proyecto_id||"",a.nombre=m.borrador.nombre||"",a.descripcion=m.borrador.descripcion||"",a.fecha_inicio=m.borrador.fecha_inicio||"",a.fecha_fin=m.borrador.fecha_fin||"",a.tipo=m.borrador.tipo||"servicio",a.monto_total=m.borrador.monto_total||"",a.moneda=m.borrador.moneda||"USD",a.responsable_id=m.borrador.responsable_id||"none",a.contraparte_user_id=m.borrador.contraparte_user_id||null,a.contraparte_nombre=m.borrador.contraparte_nombre||"",a.contraparte_identificacion=m.borrador.contraparte_identificacion||"",a.contraparte_email=m.borrador.contraparte_email||"",a.contraparte_telefono=m.borrador.contraparte_telefono||"",a.observaciones=m.borrador.observaciones||"",a.archivos_paths=m.borrador.archivos_paths||[],a.archivos_nombres=m.borrador.archivos_nombres||[],a.tipos_archivos=m.borrador.tipos_archivos||{},a.archivos_paths.length>0){const s=a.archivos_paths.map((c,h)=>({id:`borrador_${h}`,name:a.archivos_nombres[h]||c.split("/").pop()||"archivo",size:0,path:c,url:`/storage/${c}`,mime_type:a.tipos_archivos[c]||"application/octet-stream"}));A.value=s}g.success("Borrador recuperado",{description:`Borrador del servidor cargado (${a.archivos_paths.length} archivo(s))`})}else{const s=ve();s&&s.data&&(Object.assign(a,s.data),g.info("Borrador recuperado",{description:"Se recuperaron tus cambios del navegador"}))}_e()}),ze(()=>{Y()}),(i,e)=>(u(),y(De,{breadcrumbs:de},{default:r(()=>{var d;return[n("div",He,[n("div",Qe,[n("div",Ye,[t(o(Fe),{href:o(z)("admin.contratos.index")},{default:r(()=>[t(o(k),{variant:"ghost",size:"sm"},{default:r(()=>[t(o(qe),{class:"h-4 w-4 mr-2"}),e[22]||(e[22]=l(" Volver ",-1))]),_:1})]),_:1},8,["href"]),e[23]||(e[23]=n("div",null,[n("h1",{class:"text-3xl font-bold"},"Crear Contrato"),n("p",{class:"text-gray-600 mt-1"},"Complete la información para crear un nuevo contrato")],-1))]),n("div",Ze,[o(H)?(u(),y(o(Ge),{key:0,class:"h-4 w-4 animate-spin"})):o(Q)&&!o(q)?(u(),y(o(Je),{key:1,class:"h-4 w-4 text-green-600"})):o(q)?(u(),y(o(se),{key:2,class:"h-4 w-4 text-amber-600"})):_("",!0),o(H)?(u(),p("span",eo,"Guardando borrador...")):o(Q)&&!o(q)?(u(),p("span",oo,"Borrador guardado a las "+f((d=o(fe).lastSaved)==null?void 0:d.toLocaleTimeString()),1)):o(q)?(u(),p("span",ao,"Guardado localmente")):_("",!0)])]),n("form",{onSubmit:Ne(Se,["prevent"]),class:"space-y-6"},[t(o(Be),{modelValue:G.value,"onUpdate:modelValue":e[19]||(e[19]=s=>G.value=s)},{default:r(()=>[t(o(Oe),{class:"grid w-full grid-cols-6"},{default:r(()=>[t(o(D),{value:"informacion"},{default:r(()=>[...e[24]||(e[24]=[l("Información General",-1)])]),_:1}),t(o(D),{value:"fechas"},{default:r(()=>[...e[25]||(e[25]=[l("Fechas y Estado",-1)])]),_:1}),t(o(D),{value:"financiero"},{default:r(()=>[...e[26]||(e[26]=[l("Información Financiera",-1)])]),_:1}),t(o(D),{value:"contraparte"},{default:r(()=>[...e[27]||(e[27]=[l("Contraparte",-1)])]),_:1}),t(o(D),{value:"archivos"},{default:r(()=>[e[28]||(e[28]=l(" Archivos ",-1)),A.value.length>0?(u(),p("span",to,f(A.value.length),1)):_("",!0)]),_:1}),t(o(D),{value:"adicional"},{default:r(()=>[...e[29]||(e[29]=[l("Información Adicional",-1)])]),_:1})]),_:1}),t(o(I),{value:"informacion"},{default:r(()=>[t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[30]||(e[30]=[l("Información General",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[31]||(e[31]=[l("Datos principales del contrato",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:r(()=>[n("div",ro,[n("div",null,[t(o(v),{for:"proyecto_id"},{default:r(()=>[...e[32]||(e[32]=[l("Proyecto *",-1)])]),_:1}),t(o(B),{modelValue:o(a).proyecto_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o(a).proyecto_id=s),disabled:!!m.proyecto},{default:r(()=>[t(o(O),null,{default:r(()=>[t(o(T),{placeholder:"Seleccione un proyecto"})]),_:1}),t(o(L),null,{default:r(()=>[(u(!0),p(E,null,w(M.proyectos,s=>(u(),y(o(b),{key:s.id,value:s.id.toString()},{default:r(()=>[l(f(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),o(a).errors.proyecto_id?(u(),p("div",so,f(o(a).errors.proyecto_id),1)):_("",!0)]),n("div",null,[t(o(v),{for:"nombre"},{default:r(()=>[...e[33]||(e[33]=[l("Nombre del Contrato *",-1)])]),_:1}),t(o($),{id:"nombre",modelValue:o(a).nombre,"onUpdate:modelValue":e[1]||(e[1]=s=>o(a).nombre=s),placeholder:"Ej: Contrato de servicios de consultoría"},null,8,["modelValue"]),o(a).errors.nombre?(u(),p("div",lo,f(o(a).errors.nombre),1)):_("",!0)])]),n("div",null,[t(o(v),{for:"descripcion"},{default:r(()=>[...e[34]||(e[34]=[l("Descripción",-1)])]),_:1}),t(o(te),{id:"descripcion",modelValue:o(a).descripcion,"onUpdate:modelValue":e[2]||(e[2]=s=>o(a).descripcion=s),placeholder:"Descripción detallada del contrato...",rows:"4"},null,8,["modelValue"]),o(a).errors.descripcion?(u(),p("div",io,f(o(a).errors.descripcion),1)):_("",!0)]),F.value.informacion.length>0?(u(),p("div",no,[e[35]||(e[35]=n("h3",{class:"font-medium"},"Información Complementaria",-1)),(u(!0),p(E,null,w(F.value.informacion,s=>(u(),p("div",{key:s.id},[t(W,{campo:s,modelValue:o(a).campos_personalizados[s.id],"onUpdate:modelValue":c=>o(a).campos_personalizados[s.id]=c},null,8,["campo","modelValue","onUpdate:modelValue"])]))),128))])):_("",!0)]),_:1})]),_:1})]),_:1}),t(o(I),{value:"fechas"},{default:r(()=>[t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[36]||(e[36]=[l("Fechas y Estado",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[37]||(e[37]=[l("Configure las fechas y el estado del contrato",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:r(()=>[n("div",uo,[n("div",null,[t(o(v),{for:"fecha_inicio"},{default:r(()=>[...e[38]||(e[38]=[l("Fecha de Inicio *",-1)])]),_:1}),t(o($),{id:"fecha_inicio",type:"date",modelValue:o(a).fecha_inicio,"onUpdate:modelValue":e[3]||(e[3]=s=>o(a).fecha_inicio=s)},null,8,["modelValue"]),o(a).errors.fecha_inicio?(u(),p("div",po,f(o(a).errors.fecha_inicio),1)):_("",!0)]),n("div",null,[t(o(v),{for:"fecha_fin"},{default:r(()=>[...e[39]||(e[39]=[l("Fecha de Fin",-1)])]),_:1}),t(o($),{id:"fecha_fin",type:"date",modelValue:o(a).fecha_fin,"onUpdate:modelValue":e[4]||(e[4]=s=>o(a).fecha_fin=s)},null,8,["modelValue"]),o(a).errors.fecha_fin?(u(),p("div",mo,f(o(a).errors.fecha_fin),1)):_("",!0)]),n("div",null,[t(o(v),{for:"estado"},{default:r(()=>[...e[40]||(e[40]=[l("Estado",-1)])]),_:1}),t(o(B),{modelValue:o(a).estado,"onUpdate:modelValue":e[5]||(e[5]=s=>o(a).estado=s)},{default:r(()=>[t(o(O),null,{default:r(()=>[t(o(T))]),_:1}),t(o(L),null,{default:r(()=>[t(o(b),{value:"borrador"},{default:r(()=>[...e[41]||(e[41]=[l("Borrador",-1)])]),_:1}),t(o(b),{value:"activo"},{default:r(()=>[...e[42]||(e[42]=[l("Activo",-1)])]),_:1}),t(o(b),{value:"finalizado"},{default:r(()=>[...e[43]||(e[43]=[l("Finalizado",-1)])]),_:1}),t(o(b),{value:"cancelado"},{default:r(()=>[...e[44]||(e[44]=[l("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(a).errors.estado?(u(),p("div",co,f(o(a).errors.estado),1)):_("",!0)]),n("div",null,[t(o(v),{for:"tipo"},{default:r(()=>[...e[45]||(e[45]=[l("Tipo de Contrato *",-1)])]),_:1}),t(o(B),{modelValue:o(a).tipo,"onUpdate:modelValue":e[6]||(e[6]=s=>o(a).tipo=s)},{default:r(()=>[t(o(O),null,{default:r(()=>[t(o(T))]),_:1}),t(o(L),null,{default:r(()=>[t(o(b),{value:"servicio"},{default:r(()=>[...e[46]||(e[46]=[l("Servicio",-1)])]),_:1}),t(o(b),{value:"obra"},{default:r(()=>[...e[47]||(e[47]=[l("Obra",-1)])]),_:1}),t(o(b),{value:"suministro"},{default:r(()=>[...e[48]||(e[48]=[l("Suministro",-1)])]),_:1}),t(o(b),{value:"consultoria"},{default:r(()=>[...e[49]||(e[49]=[l("Consultoría",-1)])]),_:1}),t(o(b),{value:"otro"},{default:r(()=>[...e[50]||(e[50]=[l("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(a).errors.tipo?(u(),p("div",fo,f(o(a).errors.tipo),1)):_("",!0)])]),M.usuarios?(u(),p("div",_o,[t(o(v),{for:"responsable_id"},{default:r(()=>[...e[51]||(e[51]=[l("Responsable",-1)])]),_:1}),t(o(B),{modelValue:o(a).responsable_id,"onUpdate:modelValue":e[7]||(e[7]=s=>o(a).responsable_id=s)},{default:r(()=>[t(o(O),null,{default:r(()=>[t(o(T),{placeholder:"Seleccione un responsable"})]),_:1}),t(o(L),null,{default:r(()=>[t(o(b),{value:"none"},{default:r(()=>[...e[52]||(e[52]=[l("Sin responsable",-1)])]),_:1}),(u(!0),p(E,null,w(M.usuarios,s=>(u(),y(o(b),{key:s.id,value:s.id.toString()},{default:r(()=>[l(f(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])):_("",!0)]),_:1})]),_:1})]),_:1}),t(o(I),{value:"financiero"},{default:r(()=>[t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[53]||(e[53]=[l("Información Financiera",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[54]||(e[54]=[l("Montos y detalles financieros del contrato",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:r(()=>[n("div",vo,[n("div",null,[t(o(v),{for:"monto_total"},{default:r(()=>[...e[55]||(e[55]=[l("Monto Total",-1)])]),_:1}),t(o($),{id:"monto_total",type:"number",step:"0.01",modelValue:o(a).monto_total,"onUpdate:modelValue":e[8]||(e[8]=s=>o(a).monto_total=s),placeholder:"0.00"},null,8,["modelValue"]),o(a).errors.monto_total?(u(),p("div",bo,f(o(a).errors.monto_total),1)):_("",!0)]),n("div",null,[t(o(v),{for:"moneda"},{default:r(()=>[...e[56]||(e[56]=[l("Moneda",-1)])]),_:1}),t(o(B),{modelValue:o(a).moneda,"onUpdate:modelValue":e[9]||(e[9]=s=>o(a).moneda=s)},{default:r(()=>[t(o(O),null,{default:r(()=>[t(o(T))]),_:1}),t(o(L),null,{default:r(()=>[(u(),p(E,null,w(be,s=>t(o(b),{key:s.value,value:s.value},{default:r(()=>[l(f(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"]),o(a).errors.moneda?(u(),p("div",go,f(o(a).errors.moneda),1)):_("",!0)])]),F.value.financiero.length>0?(u(),p("div",ho,[e[57]||(e[57]=n("h3",{class:"font-medium"},"Campos Financieros Personalizados",-1)),(u(!0),p(E,null,w(F.value.financiero,s=>(u(),p("div",{key:s.id},[t(W,{campo:s,modelValue:o(a).campos_personalizados[s.id],"onUpdate:modelValue":c=>o(a).campos_personalizados[s.id]=c},null,8,["campo","modelValue","onUpdate:modelValue"])]))),128))])):_("",!0)]),_:1})]),_:1})]),_:1}),t(o(I),{value:"contraparte"},{default:r(()=>[n("div",yo,[t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[58]||(e[58]=[l("Contraparte - Usuario del Sistema",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[59]||(e[59]=[l(" Seleccione un usuario del sistema como contraparte del contrato ",-1)])]),_:1})]),_:1}),t(o(S),null,{default:r(()=>[n("div",xo,[n("div",null,[t(o(v),null,{default:r(()=>[...e[60]||(e[60]=[l("Usuario Contraparte",-1)])]),_:1}),e[61]||(e[61]=n("p",{class:"text-sm text-muted-foreground mb-2"}," Si la contraparte es un usuario registrado en el sistema, selecciónelo aquí ",-1))]),R.value?(u(),p("div",Vo,[n("div",null,[n("p",Co,f(R.value.name),1),n("p",So,f(R.value.email),1)]),t(o(k),{type:"button",variant:"ghost",size:"sm",onClick:e[10]||(e[10]=s=>{o(a).contraparte_user_id=null,o(a).contraparte_nombre="",o(a).contraparte_email=""})},{default:r(()=>[t(o(le),{class:"h-4 w-4"})]),_:1})])):_("",!0),t(o(k),{type:"button",variant:"outline",onClick:e[11]||(e[11]=s=>J.value=!0),class:"w-full"},{default:r(()=>[t(o(Xe),{class:"h-4 w-4 mr-2"}),l(" "+f(R.value?"Cambiar Contraparte":"Seleccionar Contraparte"),1)]),_:1})])]),_:1})]),_:1}),t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[62]||(e[62]=[l("Contraparte - Información Externa",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[63]||(e[63]=[l(" Complete estos campos si la contraparte no es un usuario del sistema ",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:r(()=>[o(a).contraparte_user_id?(u(),y(o(Ie),{key:0,class:"mb-4"},{default:r(()=>[t(o(se),{class:"h-4 w-4"}),t(o(je),null,{default:r(()=>[...e[64]||(e[64]=[l(" Los campos de contraparte externa están deshabilitados porque ya se seleccionó un usuario del sistema. ",-1)])]),_:1})]),_:1})):_("",!0),n("div",Uo,[n("div",null,[t(o(v),{for:"contraparte_nombre"},{default:r(()=>[...e[65]||(e[65]=[l("Nombre de la Contraparte",-1)])]),_:1}),t(o($),{id:"contraparte_nombre",modelValue:o(a).contraparte_nombre,"onUpdate:modelValue":e[12]||(e[12]=s=>o(a).contraparte_nombre=s),placeholder:"Nombre de la empresa o persona",disabled:!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(v),{for:"contraparte_identificacion"},{default:r(()=>[...e[66]||(e[66]=[l("Identificación/RUC",-1)])]),_:1}),t(o($),{id:"contraparte_identificacion",modelValue:o(a).contraparte_identificacion,"onUpdate:modelValue":e[13]||(e[13]=s=>o(a).contraparte_identificacion=s),placeholder:"Número de identificación",disabled:!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(v),{for:"contraparte_email"},{default:r(()=>[...e[67]||(e[67]=[l("Email de Contacto",-1)])]),_:1}),t(o($),{id:"contraparte_email",type:"email",modelValue:o(a).contraparte_email,"onUpdate:modelValue":e[14]||(e[14]=s=>o(a).contraparte_email=s),placeholder:"email@ejemplo.com",disabled:!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(v),{for:"contraparte_telefono"},{default:r(()=>[...e[68]||(e[68]=[l("Teléfono de Contacto",-1)])]),_:1}),t(o($),{id:"contraparte_telefono",modelValue:o(a).contraparte_telefono,"onUpdate:modelValue":e[15]||(e[15]=s=>o(a).contraparte_telefono=s),placeholder:"+1234567890",disabled:!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])])])]),_:1})]),_:1}),t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[69]||(e[69]=[l("Participantes del Contrato",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[70]||(e[70]=[l(" Agregue usuarios del sistema que participarán en este contrato con diferentes roles ",-1)])]),_:1})]),_:1}),t(o(S),null,{default:r(()=>[n("div",ko,[t(o(k),{type:"button",variant:"outline",onClick:e[16]||(e[16]=s=>X.value=!0),class:"w-full"},{default:r(()=>[t(o(ie),{class:"h-4 w-4 mr-2"}),e[71]||(e[71]=l(" Agregar Participantes ",-1))]),_:1}),o(a).participantes.length>0?(u(),p("div",$o,[e[72]||(e[72]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Participantes agregados:",-1)),(u(!0),p(E,null,w(o(a).participantes,s=>{var c,h;return u(),p("div",{key:s.user_id,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[n("div",Eo,[n("div",null,[n("p",wo,f((c=ee(s.user_id))==null?void 0:c.name),1),n("p",Po,f((h=ee(s.user_id))==null?void 0:h.email),1),n("div",Ao,[n("span",zo,f(s.rol),1),s.notas?(u(),p("span",Fo,f(s.notas),1)):_("",!0)])]),t(o(k),{type:"button",variant:"ghost",size:"sm",onClick:To=>Ce(s.user_id)},{default:r(()=>[t(o(le),{class:"h-4 w-4"})]),_:1},8,["onClick"])])])}),128))])):(u(),p("div",No,[t(o(ie),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),e[73]||(e[73]=n("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))]))])]),_:1})]),_:1})])]),_:1}),t(o(I),{value:"archivos"},{default:r(()=>[t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[74]||(e[74]=[l("Archivos del Contrato",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[75]||(e[75]=[l("Sube múltiples archivos relacionados con el contrato (máximo 10)",-1)])]),_:1})]),_:1}),t(o(S),null,{default:r(()=>[t(Me,{modelValue:P.value,"onUpdate:modelValue":e[17]||(e[17]=s=>P.value=s),label:"Archivos",description:"Sube archivos del contrato (PDF, imágenes, documentos)",onFilesSelected:he,multiple:!0,maxFiles:10,maxFileSize:10,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.xls,.xlsx",autoUpload:!1,module:"contratos",fieldId:"archivos"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(o(I),{value:"adicional"},{default:r(()=>[t(o(x),null,{default:r(()=>[t(o(V),null,{default:r(()=>[t(o(C),null,{default:r(()=>[...e[76]||(e[76]=[l("Información Adicional",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[77]||(e[77]=[l("Observaciones y campos personalizados",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:r(()=>[n("div",null,[t(o(v),{for:"observaciones"},{default:r(()=>[...e[78]||(e[78]=[l("Observaciones",-1)])]),_:1}),t(o(te),{id:"observaciones",modelValue:o(a).observaciones,"onUpdate:modelValue":e[18]||(e[18]=s=>o(a).observaciones=s),placeholder:"Notas u observaciones adicionales...",rows:"4"},null,8,["modelValue"]),o(a).errors.observaciones?(u(),p("div",Do,f(o(a).errors.observaciones),1)):_("",!0)]),F.value.otros.length>0?(u(),p("div",Io,[e[79]||(e[79]=n("h3",{class:"font-medium"},"Campos Personalizados",-1)),(u(!0),p(E,null,w(F.value.otros,s=>(u(),p("div",{key:s.id},[t(W,{campo:s,modelValue:o(a).campos_personalizados[s.id],"onUpdate:modelValue":c=>o(a).campos_personalizados[s.id]=c},null,8,["campo","modelValue","onUpdate:modelValue"])]))),128))])):_("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",jo,[m.borrador?(u(),y(o(k),{key:0,variant:"destructive",type:"button",onClick:ke,disabled:o(a).processing},{default:r(()=>[t(o(Ke),{class:"h-4 w-4 mr-2"}),e[80]||(e[80]=l(" Descartar Borrador ",-1))]),_:1},8,["disabled"])):(u(),p("div",Bo)),n("div",Oo,[t(o(k),{type:"button",variant:"outline",onClick:Ue,disabled:o(a).processing},{default:r(()=>[...e[81]||(e[81]=[l(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(o(k),{type:"submit",disabled:o(a).processing},{default:r(()=>[t(o(We),{class:"h-4 w-4 mr-2"}),l(" "+f(o(a).processing?"Guardando...":"Guardar Contrato"),1)]),_:1},8,["disabled"])])])],32)]),n("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:ge,class:"hidden"},null,544),t(re,{modelValue:J.value,"onUpdate:modelValue":e[20]||(e[20]=s=>J.value=s),title:"Seleccionar Contraparte",description:"Selecciona el usuario que será la contraparte del contrato","search-endpoint":o(z)("admin.proyectos.search-users"),"excluded-ids":o(a).contraparte_user_id?[o(a).contraparte_user_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Contraparte","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:xe},null,8,["modelValue","search-endpoint","excluded-ids"]),t(re,{modelValue:X.value,"onUpdate:modelValue":e[21]||(e[21]=s=>X.value=s),title:"Agregar Participantes",description:"Selecciona los usuarios que participarán en este contrato y define su rol","search-endpoint":o(z)("admin.proyectos.search-users"),"excluded-ids":me.value,"extra-fields":pe.value,"submit-button-text":"Agregar Participantes","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:Ve},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"])]}),_:1}))}});export{dt as default};
