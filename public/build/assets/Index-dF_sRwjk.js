import{_ as re}from"./UserLayout.vue_vue_type_script_setup_true_lang-CguWVpgr.js";import{d as q,r as f,m as K,c as B,i as g,e as r,F as E,g as u,b as p,j as _,f as t,u as e,w as o,h as v,k as R,t as C,s as ne,o as Q,O as ie,q as ue,n as j,W as A,A as de,p as ce}from"./app-DiTimFRW.js";import{_ as ve}from"./VotacionGrid.vue_vue_type_script_setup_true_lang-D_5Ezbl8.js";import{l as me}from"./lodash-i8stdNKk.js";import{_ as pe}from"./Input.vue_vue_type_script_setup_true_lang-DV6Pygaj.js";import{_ as $}from"./createLucideIcon-Dk3zluZI.js";import{_ as H}from"./index-B3yR8zRW.js";import{_ as fe}from"./Label.vue_vue_type_script_setup_true_lang-4iKq4xxO.js";import{_ as _e}from"./Switch.vue_vue_type_script_setup_true_lang-D7fBwX9H.js";import{a as N,b as O,c as W,d as T,_ as X}from"./SelectValue.vue_vue_type_script_setup_true_lang-BMVrxUBm.js";import{_ as Y,a as Z,b as ee,c as ge,d as ae,e as te}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DUoOhpVe.js";import{S as ye}from"./search-cLCdZBht.js";import{F as we}from"./filter-DCodNDeL.js";import{X as G}from"./x-B8GY1MI9.js";import{_ as he}from"./Progress.vue_vue_type_script_setup_true_lang-eDPHobYp.js";import{C as ke}from"./clock-D_txVMHF.js";import{C as J}from"./circle-alert-DDbs2Nt7.js";import{C as z}from"./circle-check-big-BiInhZH3.js";import{E as be}from"./eye-B_Z8OHgz.js";import{R as $e}from"./refresh-cw-Di4gzqlY.js";import{t as Ve}from"./index-EWMIzLdg.js";import{V as xe}from"./vote-C60zH4XJ.js";import{L as Ce}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-CxRmp7hj.js";import{L as Fe}from"./list-DoyKJ37w.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-D4VxpJOB.js";import"./index-DFMQtHIN.js";import"./index-DxL_b2wa.js";import"./floating-ui.vue-D_og6XPx.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DkvdjrY7.js";import"./square-check-big-DDoqWsQW.js";import"./user-CUHyzddX.js";import"./file-text-C-sOenCV.js";import"./users-CFfVU7pw.js";import"./map-pin-BvqPixGK.js";import"./index-BI0ShkNY.js";import"./circle-x-u6a-lriS.js";import"./loader-circle-Be3HcCHC.js";import"./calendar-Dbux0LSg.js";import"./globe-d0QydumG.js";import"./circle-check-BvbdfyTs.js";import"./es-BRx6Co7f.js";import"./index-C21nUFg-.js";import"./VisuallyHidden-DXFAgcH_.js";import"./PopperContent-B6hdrYo4.js";import"./VisuallyHiddenInput-BE3LQBwR.js";import"./check-BJ_4A3-M.js";import"./nullish-CHIgUVhi.js";import"./shield-OXelDVUT.js";import"./CardTitle.vue_vue_type_script_setup_true_lang-Do8VxmPU.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-lBNHpRAr.js";const Pe={class:"space-y-4"},Se={class:"flex flex-col sm:flex-row gap-3"},Be={class:"flex-1"},Ie={class:"relative"},Me={class:"flex gap-2"},Te={key:2,class:"flex items-center space-x-2"},Ae={key:0,class:"flex flex-wrap gap-2"},Ue={class:"space-y-4 py-4"},Ee=q({__name:"VotacionFilters",props:{filters:{},categorias:{default:()=>[]},showCategoryFilter:{type:Boolean,default:!0},showStatusFilter:{type:Boolean,default:!0},showPastToggle:{type:Boolean,default:!0},showAdvancedFilters:{type:Boolean,default:!1}},emits:["update"],setup(L,{emit:h}){const k=L,b=h,l=f({...k.filters}),c=f(!1),y=Math.random().toString(36).substr(2,9);K(()=>k.filters,n=>{l.value={...n}},{deep:!0});const P=me.debounce(()=>{m()},300),m=()=>{b("update",{...l.value})},V=()=>{l.value={search:"",categoria_id:null,estado:null,mostrar_pasadas:!1,advanced_filters:null},m()},S=()=>{c.value=!1,m()},F=n=>{n==="advanced_filters"?l.value.advanced_filters=null:l.value[n]=null,m()},I=B(()=>l.value.search||l.value.categoria_id||l.value.estado||l.value.mostrar_pasadas||l.value.advanced_filters),M=B(()=>{let n=0;return l.value.advanced_filters&&(n+=Object.keys(l.value.advanced_filters).length),n}),U=B(()=>{const n=[];if(l.value.search&&n.push({key:"search",label:"Búsqueda",value:l.value.search}),l.value.categoria_id&&k.categorias){const a=k.categorias.find(s=>s.id===l.value.categoria_id);a&&n.push({key:"categoria_id",label:"Categoría",value:a.nombre})}return l.value.estado&&n.push({key:"estado",label:"Estado",value:l.value.estado}),n});return(n,a)=>(r(),g(E,null,[u("div",Pe,[u("div",Se,[u("div",Be,[u("div",Ie,[t(e(ye),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),t(e(pe),{modelValue:l.value.search,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value.search=s),onInput:e(P),placeholder:"Buscar votaciones...",class:"pl-10"},null,8,["modelValue","onInput"])])]),u("div",Me,[n.showCategoryFilter&&n.categorias.length>0?(r(),p(e(X),{key:0,modelValue:l.value.categoria_id,"onUpdate:modelValue":[a[1]||(a[1]=s=>l.value.categoria_id=s),m]},{default:o(()=>[t(e(N),{class:"w-[180px]"},{default:o(()=>[t(e(O),{placeholder:"Todas las categorías"})]),_:1}),t(e(W),null,{default:o(()=>[t(e(T),{value:null},{default:o(()=>[...a[7]||(a[7]=[v(" Todas las categorías ",-1)])]),_:1}),(r(!0),g(E,null,R(n.categorias,s=>(r(),p(e(T),{key:s.id,value:s.id},{default:o(()=>[v(C(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):_("",!0),n.showStatusFilter?(r(),p(e(X),{key:1,modelValue:l.value.estado,"onUpdate:modelValue":[a[2]||(a[2]=s=>l.value.estado=s),m]},{default:o(()=>[t(e(N),{class:"w-[150px]"},{default:o(()=>[t(e(O),{placeholder:"Todos los estados"})]),_:1}),t(e(W),null,{default:o(()=>[t(e(T),{value:null},{default:o(()=>[...a[8]||(a[8]=[v(" Todos los estados ",-1)])]),_:1}),t(e(T),{value:"activa"},{default:o(()=>[...a[9]||(a[9]=[v("Activas",-1)])]),_:1}),t(e(T),{value:"pendiente"},{default:o(()=>[...a[10]||(a[10]=[v("Pendientes",-1)])]),_:1}),t(e(T),{value:"finalizada"},{default:o(()=>[...a[11]||(a[11]=[v("Finalizadas",-1)])]),_:1}),t(e(T),{value:"cancelada"},{default:o(()=>[...a[12]||(a[12]=[v("Canceladas",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])):_("",!0),n.showPastToggle?(r(),g("div",Te,[t(e(_e),{id:"show-past-"+e(y),checked:l.value.mostrar_pasadas,"onUpdate:checked":[a[3]||(a[3]=s=>l.value.mostrar_pasadas=s),m]},null,8,["id","checked"]),t(e(fe),{for:"show-past-"+e(y),class:"cursor-pointer"},{default:o(()=>[...a[13]||(a[13]=[v(" Mostrar pasadas ",-1)])]),_:1},8,["for"])])):_("",!0),n.showAdvancedFilters?(r(),p(e($),{key:3,onClick:a[4]||(a[4]=s=>c.value=!0),variant:"outline",size:"default"},{default:o(()=>[t(e(we),{class:"h-4 w-4 mr-2"}),a[14]||(a[14]=v(" Filtros ",-1)),M.value>0?(r(),p(e(H),{key:0,class:"ml-2",variant:"secondary"},{default:o(()=>[v(C(M.value),1)]),_:1})):_("",!0)]),_:1})):_("",!0),I.value?(r(),p(e($),{key:4,onClick:V,variant:"ghost",size:"icon"},{default:o(()=>[t(e(G),{class:"h-4 w-4"})]),_:1})):_("",!0)])]),U.value.length>0?(r(),g("div",Ae,[(r(!0),g(E,null,R(U.value,s=>(r(),p(e(H),{key:s.key,variant:"secondary",class:"cursor-pointer hover:bg-secondary/80",onClick:i=>F(s.key)},{default:o(()=>[v(C(s.label)+": "+C(s.value)+" ",1),t(e(G),{class:"h-3 w-3 ml-1"})]),_:2},1032,["onClick"]))),128))])):_("",!0)]),n.showAdvancedFilters?(r(),p(e(te),{key:0,open:c.value,"onUpdate:open":a[6]||(a[6]=s=>c.value=s)},{default:o(()=>[t(e(Y),{class:"max-w-2xl"},{default:o(()=>[t(e(Z),null,{default:o(()=>[t(e(ee),null,{default:o(()=>[...a[15]||(a[15]=[v("Filtros avanzados",-1)])]),_:1}),t(e(ge),null,{default:o(()=>[...a[16]||(a[16]=[v(" Configura filtros detallados para encontrar las votaciones que buscas. ",-1)])]),_:1})]),_:1}),u("div",Ue,[ne(n.$slots,"advanced-filters",{filters:l.value})]),t(e(ae),null,{default:o(()=>[t(e($),{onClick:a[5]||(a[5]=s=>c.value=!1),variant:"outline"},{default:o(()=>[...a[17]||(a[17]=[v(" Cancelar ",-1)])]),_:1}),t(e($),{onClick:S},{default:o(()=>[...a[18]||(a[18]=[v(" Aplicar filtros ",-1)])]),_:1})]),_:1})]),_:3})]),_:3},8,["open"])):_("",!0)],64))}}),Le={class:"space-y-4"},je={class:"flex flex-col items-center justify-center py-6"},ze={key:0,class:"relative"},Re={key:1,class:"text-green-600"},qe={key:2,class:"text-red-600"},De={class:"mt-4 text-center text-sm text-muted-foreground"},He={key:3,class:"mt-4 w-full"},Ne={class:"mt-2 text-center text-xs text-muted-foreground"},Oe={key:4,class:"mt-4 w-full rounded-lg bg-green-50 dark:bg-green-950 p-4"},We={class:"space-y-2 text-sm"},Xe={class:"flex items-center justify-between"},Ge={class:"rounded bg-black/10 px-2 py-1 text-xs font-mono"},Je={class:"flex items-center justify-between"},Ke={class:"font-medium"},Qe=q({__name:"VoteProcessingModal",props:{votacionId:{},checkStatusUrl:{},modelValue:{type:Boolean}},emits:["update:modelValue","completed","error"],setup(L,{emit:h}){const k=L,b=h,l=f(k.modelValue??!0),c=f("pending"),y=f("Preparando firma digital..."),P=f(null),m=f(0),V=f(10),S=f(null),F=B(()=>["pending","processing"].includes(c.value)),I=B(()=>["error","failed","duplicate"].includes(c.value)),M=B(()=>{switch(c.value){case"completed":return z;case"error":case"failed":case"duplicate":return J;default:return ke}}),U=B(()=>c.value==="completed"?"text-green-600":I.value?"text-red-600":"text-primary animate-pulse"),n=B(()=>{switch(c.value){case"pending":return"Preparando tu voto";case"processing":return"Procesando tu voto";case"completed":return"¡Voto registrado!";case"duplicate":return"Voto duplicado";case"error":case"failed":return"Error al procesar";default:return"Verificando estado"}}),a=async()=>{try{m.value++;const x=await fetch(k.checkStatusUrl,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!x.ok)throw new Error("Error al verificar estado");const d=await x.json();c.value=d.status,y.value=d.message,d.status==="processing"&&(V.value=Math.min(90,V.value+10)),d.completed?(V.value=100,P.value={voto_id:d.voto_id,token_preview:d.token_preview,created_at:d.created_at},i(),b("completed",d),setTimeout(()=>{c.value==="completed"&&w()},5e3)):d.error&&(i(),b("error",d))}catch(x){console.error("Error checking vote status:",x),m.value>=10&&(c.value="error",y.value="No se pudo verificar el estado. Por favor, recarga la página.",i())}},s=()=>{a(),S.value=window.setInterval(()=>{a()},1500)},i=()=>{S.value&&(clearInterval(S.value),S.value=null)},w=()=>{A.visit(`/miembro/votaciones/${k.votacionId}/mi-voto`)},D=()=>{A.visit(`/miembro/votaciones/${k.votacionId}/votar`)},se=()=>{l.value=!1,b("update:modelValue",!1),F.value&&A.visit("/miembro/votaciones")},oe=x=>new Date(x).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return Q(()=>{s()}),ie(()=>{i()}),K(l,x=>{b("update:modelValue",x),x||i()}),(x,d)=>(r(),p(e(te),{open:l.value,"onUpdate:open":d[0]||(d[0]=le=>l.value=le)},{default:o(()=>[t(e(Y),{class:"sm:max-w-md"},{default:o(()=>[t(e(Z),null,{default:o(()=>[t(e(ee),{class:"flex items-center gap-2"},{default:o(()=>[(r(),p(ue(M.value),{class:j([U.value,"h-5 w-5"])},null,8,["class"])),v(" "+C(n.value),1)]),_:1})]),_:1}),u("div",Le,[u("div",je,[F.value?(r(),g("div",ze,[d[1]||(d[1]=u("div",{class:"h-16 w-16 animate-spin rounded-full border-4 border-muted border-t-primary"},null,-1)),c.value==="processing"?(r(),p(e(z),{key:0,class:"absolute left-1/2 top-1/2 h-8 w-8 -translate-x-1/2 -translate-y-1/2 text-primary opacity-50"})):_("",!0)])):c.value==="completed"?(r(),g("div",Re,[t(e(z),{class:"h-16 w-16"})])):I.value?(r(),g("div",qe,[t(e(J),{class:"h-16 w-16"})])):_("",!0),u("p",De,C(y.value),1),F.value?(r(),g("div",He,[t(e(he),{value:V.value,class:"h-2"},null,8,["value"]),u("p",Ne,C(m.value>0?`Intento ${m.value} de verificación...`:"Conectando..."),1)])):_("",!0),c.value==="completed"&&P.value?(r(),g("div",Oe,[u("div",We,[u("div",Xe,[d[2]||(d[2]=u("span",{class:"text-muted-foreground"},"Token:",-1)),u("code",Ge,C(P.value.token_preview),1)]),u("div",Je,[d[3]||(d[3]=u("span",{class:"text-muted-foreground"},"Registrado:",-1)),u("span",Ke,C(oe(P.value.created_at)),1)])])])):_("",!0)]),t(e(ae),null,{default:o(()=>[c.value==="completed"?(r(),p(e($),{key:0,onClick:w,class:"w-full"},{default:o(()=>[t(e(be),{class:"mr-2 h-4 w-4"}),d[4]||(d[4]=v(" Ver mi voto ",-1))]),_:1})):I.value?(r(),p(e($),{key:1,onClick:D,variant:"destructive",class:"w-full"},{default:o(()=>[t(e($e),{class:"mr-2 h-4 w-4"}),d[5]||(d[5]=v(" Intentar nuevamente ",-1))]),_:1})):(r(),p(e($),{key:2,onClick:se,variant:"outline",class:"w-full",disabled:F.value},{default:o(()=>[v(C(F.value?"Procesando...":"Cerrar"),1)]),_:1},8,["disabled"]))]),_:1})])]),_:1})]),_:1},8,["open"]))}}),Ye={class:"space-y-6"},Ze={class:"flex items-center justify-between"},ea={class:"text-2xl font-bold flex items-center gap-2"},aa={class:"flex gap-2"},ta={key:0,class:"flex justify-center mt-6"},sa={class:"flex gap-1"},et=q({__name:"Index",props:{votaciones:{},categorias:{},filters:{},mostrar_pasadas:{type:Boolean},filterFieldsConfig:{},hasProcessingVotes:{type:Boolean},canVote:{type:Boolean},canViewResults:{type:Boolean},canViewOwnVote:{type:Boolean}},setup(L){var a;const h=L,k=[{title:"Dashboard",href:"/miembro/dashboard"},{title:"Mis Votaciones",href:"/miembro/votaciones"}],b=f(!1),l=f(null),c=f(""),y=f("grid"),{route:P}=window,m=f(null),V=f(!1),S=f({search:h.filters.search||"",categoria:((a=h.filters.categoria_id)==null?void 0:a.toString())||"",estado:h.filters.estado||"",mostrar_pasadas:h.mostrar_pasadas||!1}),F=s=>{const i={};s.search&&(i.search=s.search),s.categoria&&(i.categoria_id=s.categoria),s.estado&&(i.estado=s.estado),s.mostrar_pasadas&&(i.mostrar_pasadas=s.mostrar_pasadas),A.get(P("user.votaciones.index"),i,{preserveState:!0,preserveScroll:!0})},I=()=>{V.value||!h.hasProcessingVotes||(V.value=!0,m.value=setInterval(()=>{A.reload({preserveScroll:!0,only:["votaciones","hasProcessingVotes"],onSuccess:()=>{h.hasProcessingVotes||(M(),Ve.success("Todos los votos han sido procesados"))}})},5e3))},M=()=>{m.value&&(clearInterval(m.value),m.value=null),V.value=!1},U=(s,i)=>{l.value=s,c.value=i,b.value=!0},n=()=>{b.value=!1,l.value=null,c.value="",A.reload({preserveScroll:!0})};return Q(()=>{h.hasProcessingVotes&&I()}),de(()=>{M()}),(s,i)=>(r(),g(E,null,[t(e(ce),{title:"Mis Votaciones"}),t(re,{breadcrumbs:k},{default:o(()=>[u("div",Ye,[u("div",Ze,[u("div",null,[u("h1",ea,[t(e(xe),{class:"h-7 w-7"}),i[3]||(i[3]=v(" Mis Votaciones ",-1))]),i[4]||(i[4]=u("p",{class:"text-muted-foreground mt-1"}," Participa en las votaciones disponibles para ti ",-1))]),u("div",aa,[t(e($),{variant:"outline",size:"sm",onClick:i[0]||(i[0]=w=>y.value="grid"),class:j({"bg-accent":y.value==="grid"})},{default:o(()=>[t(e(Ce),{class:"h-4 w-4"})]),_:1},8,["class"]),t(e($),{variant:"outline",size:"sm",onClick:i[1]||(i[1]=w=>y.value="list"),class:j({"bg-accent":y.value==="list"})},{default:o(()=>[t(e(Fe),{class:"h-4 w-4"})]),_:1},8,["class"])])]),t(Ee,{categorias:s.categorias,"initial-filters":S.value,onFiltersChanged:F},null,8,["categorias","initial-filters"]),t(ve,{votaciones:s.votaciones.data,"view-mode":y.value,"can-vote":s.canVote,"can-view-results":s.canViewResults,onVoteProcessing:U},null,8,["votaciones","view-mode","can-vote","can-view-results"]),s.votaciones.last_page>1?(r(),g("div",ta,[u("nav",sa,[(r(!0),g(E,null,R(s.votaciones.links,w=>(r(),g(E,{key:w.label},[w.url?(r(),p(e($),{key:0,variant:"outline",size:"sm",class:j({"bg-primary text-primary-foreground":w.active}),onClick:D=>e(A).get(w.url,{},{preserveState:!0,preserveScroll:!0}),innerHTML:w.label},null,8,["class","onClick","innerHTML"])):(r(),p(e($),{key:1,variant:"outline",size:"sm",disabled:"",innerHTML:w.label},null,8,["innerHTML"]))],64))),128))])])):_("",!0),b.value?(r(),p(Qe,{key:1,"votacion-id":l.value,"check-url":c.value,onComplete:n,onClose:i[2]||(i[2]=w=>b.value=!1)},null,8,["votacion-id","check-url"])):_("",!0)])]),_:1})],64))}});export{et as default};
