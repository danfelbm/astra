import{d as ee,r as p,p as se,b as m,w as a,e as s,g as r,f as e,q as ae,j as f,h as o,n as te,t as u,i as b,m as i,F as U,k as F,l as N,A as le,s as C,a as re}from"./app-BFqKuHja.js";import{_ as c}from"./createLucideIcon-tZKQ8FV-.js";import{_ as W,c as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-By0rrIVN.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-BV39iPGt.js";import{_ as J}from"./index-BF1JDgfE.js";import{_ as oe,a as ie,b as ne,c as ue,d as de}from"./SelectValue.vue_vue_type_script_setup_true_lang-Rq0QpW8I.js";import{_ as me,a as pe,b as j,c as $,d as fe,e as g}from"./TableHeader.vue_vue_type_script_setup_true_lang-DVyMhRir.js";import{e as ce,_ as _e,a as ve,b as ge,c as xe,d as we}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DWo8uhvu.js";import{_ as he}from"./Label.vue_vue_type_script_setup_true_lang-Dqhxdf2C.js";import{_ as $e,a as ke}from"./index-C01_JZa5.js";import{_ as L,a as O,b as R}from"./index-BgOZXF3v.js";import{_ as ye}from"./Pagination.vue_vue_type_script_setup_true_lang-CUEynZdL.js";import{_ as be}from"./AdminLayout.vue_vue_type_script_setup_true_lang-a0Yimc9j.js";import{t as k}from"./index-D11OkfIY.js";import{d as Ce}from"./debounce-BWEJZWaj.js";import{R as Ge}from"./refresh-cw-BqbLQJ8a.js";import{P as Ae}from"./plus-HWvCG-pg.js";import{S as Se}from"./search-Bo0C7ovi.js";import{M as E}from"./message-square-BfcC0tAy.js";import{U as T}from"./users-CymRd8l_.js";import{E as je}from"./eye-pgBp_Zgj.js";import{T as Ee}from"./trash-2-DIQRuMTg.js";import{L as q}from"./loader-circle-C_8YyK-M.js";import"./index-F5rpf4iw.js";import"./VisuallyHidden-DP9KERvz.js";import"./check-C0Px08fC.js";import"./floating-ui.vue-BMPmqikX.js";import"./x-Bmm2Newm.js";import"./index-C8QA5EYi.js";import"./useFlashMessages-Rq45FhUU.js";import"./shield-97w7M3te.js";import"./user-BAyKQNNj.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-FLlUFPmJ.js";import"./chevron-right-Cw5c0nod.js";import"./house-ChRKKXPV.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BEi-RCnv.js";import"./circle-alert-B3cw7wFG.js";import"./map-pin-C_udGJei.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-_5gfTs1o.js";import"./chevrons-up-down-BeNxFT55.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CG0Gldao.js";import"./target-BJiaG4BP.js";import"./vote-Xnz8P6lY.js";import"./folder-open-BYgWiTs_.js";import"./send-B8eSg7eS.js";import"./file-text-BGYDQgob.js";import"./briefcase-BxbIIMmV.js";import"./calendar-TQY1ssum.js";import"./megaphone-i8HADNBc.js";import"./user-check-D1WCGWxM.js";import"./clipboard-list-DmGkpb4E.js";import"./mail-DplI3j6U.js";import"./external-link-e9aSyS64.js";import"./panel-left-DIEiSQw2.js";import"./index-BY2HrsFe.js";const Ie={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ze={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},Ve={class:"flex gap-2"},De={class:"flex flex-col sm:flex-row gap-4"},Pe={class:"flex-1"},Ue={class:"relative"},Fe={class:"w-full sm:w-48"},Ne={class:"font-medium"},We={key:0,class:"text-sm text-muted-foreground truncate max-w-xs"},Me={class:"flex items-center justify-center gap-1"},Be={class:"text-xs bg-muted px-2 py-1 rounded"},Je={class:"flex justify-end gap-1"},Le={class:"space-y-4"},Oe={key:1,class:"border rounded-lg p-4 bg-muted/50"},Re={class:"flex items-start gap-3"},Te={class:"flex-1 min-w-0"},qe={class:"font-medium"},Ke={key:0,class:"text-sm text-muted-foreground truncate"},He={class:"flex items-center gap-2 mt-1"},Xs=ee({__name:"Index",props:{grupos:{},filters:{},tiposOptions:{}},setup(x){const I=x,K=[{title:"Admin",href:"/admin/dashboard"},{title:"Campañas",href:"/admin/envio-campanas"},{title:"Grupos de WhatsApp",href:"#"}],G=p(I.filters.search||""),w=p(I.filters.tipo||"all"),h=p(!1),y=p(!1),_=p(""),A=p(!1),n=p(null),v=p(""),S=p(!1),H=Ce(()=>{C.get("/admin/whatsapp-groups",{search:G.value||void 0,tipo:w.value&&w.value!=="all"?w.value:void 0},{preserveState:!0,preserveScroll:!0,replace:!0})},300);se([G,w],()=>{H()});const z=()=>{h.value||confirm(`¿Sincronizar todos los grupos desde WhatsApp?

Esta operación puede tardar hasta 5 minutos.`)&&(h.value=!0,C.post("/admin/whatsapp-groups/sync",{},{preserveScroll:!0,onSuccess:()=>{k.success("Grupos sincronizados")},onError:()=>{k.error("Error al sincronizar grupos")},onFinish:()=>{h.value=!1}}))},Q=()=>{_.value="",n.value=null,v.value="",y.value=!0},V=async()=>{var d,t;if(!_.value.trim()){v.value="Ingresa un Group ID";return}A.value=!0,v.value="",n.value=null;try{const l=await re.post("/admin/whatsapp-groups/preview-jid",{group_jid:_.value.trim()});l.data.success?n.value=l.data.preview:v.value=l.data.message||"Grupo no encontrado"}catch(l){v.value=((t=(d=l.response)==null?void 0:d.data)==null?void 0:t.message)||"Error al buscar el grupo"}finally{A.value=!1}},X=()=>{n.value&&(S.value=!0,C.post("/admin/whatsapp-groups/add-by-jid",{group_jid:_.value.trim()},{onSuccess:()=>{y.value=!1,k.success("Grupo añadido correctamente")},onError:()=>{k.error("Error al añadir el grupo")},onFinish:()=>{S.value=!1}}))},D=d=>{C.visit(`/admin/whatsapp-groups/${d.id}`)},Y=d=>{confirm(`¿Eliminar el grupo "${d.nombre}" de la base de datos?

Esto no afecta al grupo en WhatsApp.`)&&C.delete(`/admin/whatsapp-groups/${d.id}`,{preserveScroll:!0,onSuccess:()=>{k.success("Grupo eliminado")},onError:()=>{k.error("Error al eliminar el grupo")}})},Z=d=>d.replace("@g.us","");return(d,t)=>(i(),m(be,{breadcrumbs:K},{default:a(()=>[s(e(ae),{title:"Grupos de WhatsApp"}),r("div",Ie,[r("div",ze,[t[8]||(t[8]=r("div",null,[r("h1",{class:"text-3xl font-bold"},"Grupos de WhatsApp"),r("p",{class:"text-muted-foreground mt-1"}," Gestiona los grupos sincronizados desde Evolution API ")],-1)),r("div",Ve,[s(e(c),{variant:"outline",onClick:z,disabled:h.value},{default:a(()=>[s(e(Ge),{class:te(["w-4 h-4 mr-2",{"animate-spin":h.value}])},null,8,["class"]),o(" "+u(h.value?"Sincronizando...":"Sincronizar Grupos"),1)]),_:1},8,["disabled"]),s(e(c),{onClick:Q},{default:a(()=>[s(e(Ae),{class:"w-4 h-4 mr-2"}),t[7]||(t[7]=o(" Añadir Grupo ",-1))]),_:1})])]),s(e(W),null,{default:a(()=>[s(e(M),{class:"pt-6"},{default:a(()=>[r("div",De,[r("div",Pe,[r("div",Ue,[s(e(Se),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s(e(B),{modelValue:G.value,"onUpdate:modelValue":t[0]||(t[0]=l=>G.value=l),placeholder:"Buscar grupos...",class:"pl-10"},null,8,["modelValue"])])]),r("div",Fe,[s(e(oe),{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=l=>w.value=l)},{default:a(()=>[s(e(ie),null,{default:a(()=>[s(e(ne),{placeholder:"Filtrar por tipo"})]),_:1}),s(e(ue),null,{default:a(()=>[(i(!0),b(U,null,F(x.tiposOptions,l=>(i(),m(e(de),{key:l.value,value:l.value},{default:a(()=>[o(u(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),s(e(W),null,{default:a(()=>[s(e(M),{class:"p-0"},{default:a(()=>[s(e(me),null,{default:a(()=>[s(e(pe),null,{default:a(()=>[s(e(j),null,{default:a(()=>[s(e($),{class:"w-12"}),s(e($),null,{default:a(()=>[...t[9]||(t[9]=[o("Nombre del Grupo",-1)])]),_:1}),s(e($),null,{default:a(()=>[...t[10]||(t[10]=[o("Tipo",-1)])]),_:1}),s(e($),{class:"text-center"},{default:a(()=>[...t[11]||(t[11]=[o("Participantes",-1)])]),_:1}),s(e($),null,{default:a(()=>[...t[12]||(t[12]=[o("Group ID",-1)])]),_:1}),s(e($),{class:"text-right"},{default:a(()=>[...t[13]||(t[13]=[o("Acciones",-1)])]),_:1})]),_:1})]),_:1}),s(e(fe),null,{default:a(()=>[(i(!0),b(U,null,F(x.grupos.data,l=>(i(),m(e(j),{key:l.id,class:"cursor-pointer hover:bg-muted/50",onClick:P=>D(l)},{default:a(()=>[s(e(g),{onClick:t[2]||(t[2]=N(()=>{},["stop"]))},{default:a(()=>[s(e(L),{class:"h-10 w-10"},{default:a(()=>[s(e(O),{src:l.avatar_url||void 0},null,8,["src"]),s(e(R),null,{default:a(()=>[s(e(E),{class:"h-5 w-5"})]),_:1})]),_:2},1024)]),_:2},1024),s(e(g),null,{default:a(()=>[r("div",null,[r("div",Ne,u(l.nombre),1),l.descripcion?(i(),b("div",We,u(l.descripcion),1)):f("",!0)])]),_:2},1024),s(e(g),null,{default:a(()=>[s(e(J),{variant:l.tipo==="comunidad"?"default":"secondary"},{default:a(()=>[o(u(l.tipo==="comunidad"?"COMUNIDAD":"GRUPO"),1)]),_:2},1032,["variant"])]),_:2},1024),s(e(g),{class:"text-center"},{default:a(()=>[r("div",Me,[s(e(T),{class:"h-4 w-4 text-muted-foreground"}),o(" "+u(l.participantes_count.toLocaleString()),1)])]),_:2},1024),s(e(g),null,{default:a(()=>[r("code",Be,u(Z(l.group_jid))+"@g.us ",1)]),_:2},1024),s(e(g),{class:"text-right",onClick:t[3]||(t[3]=N(()=>{},["stop"]))},{default:a(()=>[r("div",Je,[s(e(c),{variant:"ghost",size:"icon",onClick:P=>D(l)},{default:a(()=>[s(e(je),{class:"h-4 w-4"})]),_:1},8,["onClick"]),s(e(c),{variant:"ghost",size:"icon",onClick:P=>Y(l)},{default:a(()=>[s(e(Ee),{class:"h-4 w-4 text-destructive"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1032,["onClick"]))),128)),x.grupos.data.length===0?(i(),m(e(j),{key:0},{default:a(()=>[s(e(g),{colspan:"6",class:"text-center py-8 text-muted-foreground"},{default:a(()=>[s(e(E),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),t[15]||(t[15]=r("p",null,"No hay grupos sincronizados",-1)),s(e(c),{variant:"link",onClick:z,class:"mt-2"},{default:a(()=>[...t[14]||(t[14]=[o(" Sincronizar ahora ",-1)])]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),x.grupos.links?(i(),m(ye,{key:0,links:x.grupos.links},null,8,["links"])):f("",!0)]),s(e(ce),{open:y.value,"onUpdate:open":t[6]||(t[6]=l=>y.value=l)},{default:a(()=>[s(e(_e),{class:"sm:max-w-md"},{default:a(()=>[s(e(ve),null,{default:a(()=>[s(e(ge),null,{default:a(()=>[...t[16]||(t[16]=[o("Añadir Grupo por ID",-1)])]),_:1}),s(e(xe),null,{default:a(()=>[...t[17]||(t[17]=[o(" Ingresa el ID del grupo de WhatsApp (debe terminar en @g.us) ",-1)])]),_:1})]),_:1}),r("div",Le,[r("div",null,[s(e(he),{for:"group-jid"},{default:a(()=>[...t[18]||(t[18]=[o("Group ID (Remote JID): *",-1)])]),_:1}),s(e(B),{id:"group-jid",modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=l=>_.value=l),placeholder:"Ej: 120363295648424210@g.us",onKeyup:le(V,["enter"])},null,8,["modelValue"]),t[19]||(t[19]=r("p",{class:"text-xs text-muted-foreground mt-1"}," Ingresa el ID del grupo de WhatsApp (debe terminar en @g.us) ",-1))]),v.value?(i(),m(e($e),{key:0,variant:"destructive"},{default:a(()=>[s(e(ke),null,{default:a(()=>[o(u(v.value),1)]),_:1})]),_:1})):f("",!0),n.value?(i(),b("div",Oe,[r("div",Re,[s(e(L),{class:"h-12 w-12"},{default:a(()=>[s(e(O),{src:n.value.pictureUrl||void 0},null,8,["src"]),s(e(R),null,{default:a(()=>[s(e(E),{class:"h-6 w-6"})]),_:1})]),_:1}),r("div",Te,[r("h4",qe,u(n.value.subject),1),n.value.desc?(i(),b("p",Ke,u(n.value.desc),1)):f("",!0),r("div",He,[s(e(J),{variant:"secondary"},{default:a(()=>[s(e(T),{class:"h-3 w-3 mr-1"}),o(" "+u(n.value.size)+" participantes ",1)]),_:1})])])])])):f("",!0)]),s(e(we),{class:"gap-2 sm:gap-0"},{default:a(()=>[s(e(c),{variant:"outline",onClick:t[5]||(t[5]=l=>y.value=!1)},{default:a(()=>[...t[20]||(t[20]=[o(" Cancelar ",-1)])]),_:1}),n.value?(i(),m(e(c),{key:1,onClick:X,disabled:S.value},{default:a(()=>[S.value?(i(),m(e(q),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):f("",!0),t[22]||(t[22]=o(" Añadir Grupo ",-1))]),_:1},8,["disabled"])):(i(),m(e(c),{key:0,onClick:V,disabled:A.value||!_.value.trim()},{default:a(()=>[A.value?(i(),m(e(q),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):f("",!0),t[21]||(t[21]=o(" Previsualizar ",-1))]),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Xs as default};
