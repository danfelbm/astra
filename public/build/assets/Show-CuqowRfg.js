import{d as Q,r as H,c as N,i as p,e as a,f as t,q as R,w as l,g as i,t as d,b as g,j as _,v as j,h as n,m as u,F as D,k as C,s as W,n as X,l as Y}from"./app-D3uL80DL.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-5b8sApI_.js";import{c as tt,_ as P}from"./createLucideIcon-BrIWJaVK.js";import{_ as b,a as k,b as w,c as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-qn2XrUlO.js";import{_ as S}from"./CardDescription.vue_vue_type_script_setup_true_lang-DxN2cRJp.js";import{_ as $}from"./index-oixONa7Y.js";import{_ as et}from"./Label.vue_vue_type_script_setup_true_lang-gGRu1ZPZ.js";import{_ as at,a as lt,b as I,c as E}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DyhNKN5y.js";import{_ as it,a as ot,b as T,c as v,d as st,e as x}from"./TableHeader.vue_vue_type_script_setup_true_lang-B9n_iXov.js";import{_ as nt}from"./EvidenciaFilters.vue_vue_type_script_setup_true_lang-CsSxkqxt.js";import{O as rt}from"./ObligacionTree-BCi3aWdX.js";import{u as ut}from"./usePermissions-D6XTNTik.js";import{A as dt}from"./arrow-left-B6BcXQnN.js";import{P as mt}from"./pencil-BuhpUWcs.js";import{I as ft}from"./info-C6cQxCO8.js";import{I as V}from"./image-CYIn1MXk.js";import{P as ct}from"./paperclip-D7gkzTi6.js";import{D as pt}from"./download-BGT3MxGT.js";import{f as F,e as q}from"./es-BDPlFIsO.js";import{p as U}from"./parseISO-DFjB8F03.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BznyTpGx.js";import"./index-TDmGTbds.js";import"./floating-ui.vue-BNjM7QfA.js";import"./x-BzM2ne4W.js";import"./Input.vue_vue_type_script_setup_true_lang-uaeWT7ys.js";import"./index-Co0N6nza.js";import"./index-bPeRYsmi.js";import"./shield-B6xROWvg.js";import"./user-CWm-7GfG.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-oX-V50Fz.js";import"./chevron-right-Dr7PM1oh.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BH87WPyf.js";import"./VisuallyHidden-C1r3Vs3T.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-BOihT4Gi.js";import"./check-BgfrpJ3m.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CMVjCFVi.js";import"./index-B0qEHdwE.js";import"./circle-alert-k0Ae0_nD.js";import"./map-pin-D30VnEkT.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-D6KXfYdF.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Di9ublVQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-MvU5-ZU8.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-C247yu8_.js";import"./tag-BE3jt4iA.js";import"./users-DQdQrWqw.js";import"./target-oXTbk5NL.js";import"./vote-BVQT8UmH.js";import"./folder-open-8K0iuanW.js";import"./send-DuzmAr6j.js";import"./file-text-DcJUgIfz.js";import"./briefcase-BEuFNtLg.js";import"./calendar-CDRuCcQt.js";import"./megaphone-NaazjYw7.js";import"./user-check-DUScA6Vz.js";import"./clipboard-list-DWwYfDFn.js";import"./mail-TC-dEBUZ.js";import"./message-square-C2LYB39K.js";import"./external-link-fPhA16MY.js";import"./panel-left-uN3Ol8Pl.js";import"./index-dOclHMU_.js";import"./RovingFocusItem-ByMnhA07.js";import"./utils-Br8-RYzW.js";import"./Separator.vue_vue_type_script_setup_true_lang-DOQN3trL.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-5fRJrpOy.js";import"./circle-_8hYjrZ-.js";import"./layers-DDC6xzf7.js";import"./plus-D-R--w-I.js";import"./trash-2-05Ewy39g.js";import"./loader-circle-C49th0rO.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=tt("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),_t={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},bt={class:"flex items-center justify-between"},yt={class:"text-3xl font-bold"},vt={class:"text-muted-foreground mt-2"},xt={class:"flex gap-2"},ht={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},kt={class:"md:col-span-2 space-y-6"},wt={class:"mt-1"},$t={class:"space-y-6"},jt={class:"font-medium"},Dt={class:"text-sm text-gray-600 mt-1"},Mt={class:"space-y-2"},Ct=["href"],It={class:"text-xs text-gray-500"},Et={key:0},Vt={class:"text-xs text-gray-500"},At={key:1},Ot={class:"text-xs text-gray-500"},Bt={key:1},Lt={class:"text-sm text-gray-600"},zt={key:0,class:"flex flex-wrap gap-1"},Ht={key:1,class:"text-sm text-gray-500"},Nt={class:"text-sm"},Pt=["href"],St={class:"text-center"},Tt={class:"text-center"},ia=Q({__name:"Show",props:{obligacion:{},contrato:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canCreateChild:{type:Boolean}},setup(s){const A=s,{hasPermission:G}=ut(),O=H("general"),f=H({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null,entregable_id:null}),J=[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"},{title:A.obligacion.titulo}],h=N(()=>A.obligacion.evidencias||[]),B=N(()=>{let r=h.value;return f.value.tipo&&(r=r.filter(e=>e.tipo_evidencia===f.value.tipo)),f.value.estado&&(r=r.filter(e=>e.estado===f.value.estado)),f.value.usuario_id&&(r=r.filter(e=>{var c;return((c=e.usuario)==null?void 0:c.id)===f.value.usuario_id})),f.value.entregable_id&&(r=r.filter(e=>{var c;return(c=e.entregables)==null?void 0:c.some(o=>o.id===f.value.entregable_id)})),(f.value.fecha_inicio||f.value.fecha_fin)&&(r=r.filter(e=>{const c=new Date(e.created_at);if(f.value.fecha_inicio){const o=new Date(f.value.fecha_inicio);if(c<o)return!1}if(f.value.fecha_fin){const o=new Date(f.value.fecha_fin);if(o.setHours(23,59,59,999),c>o)return!1}return!0})),r}),M=r=>{if(!r)return"Sin fecha";try{return F(U(r),"dd MMM yyyy HH:mm",{locale:q})}catch{return r}},K=r=>{if(!r)return"-";try{return F(U(r),"d 'de' MMMM 'de' yyyy",{locale:q})}catch{return r}};return(r,e)=>(u(),p(D,null,[a(t(R),{title:`Obligación - ${s.obligacion.titulo}`},null,8,["title"]),a(Z,{breadcrumbs:J},{default:l(()=>[i("div",_t,[i("div",bt,[i("div",null,[i("h1",yt,d(s.obligacion.titulo),1),i("p",vt," Contrato: "+d(s.contrato.nombre),1)]),i("div",xt,[a(t(j),{href:`/admin/contratos/${s.contrato.id}`},{default:l(()=>[a(t(P),{variant:"outline",size:"sm"},{default:l(()=>[a(t(dt),{class:"h-4 w-4 mr-2"}),e[4]||(e[4]=n(" Ver Contrato ",-1))]),_:1})]),_:1},8,["href"]),s.canEdit?(u(),g(t(j),{key:0,href:r.route("admin.obligaciones.edit",s.obligacion.id)},{default:l(()=>[a(t(P),{variant:"outline",size:"sm"},{default:l(()=>[a(t(mt),{class:"h-4 w-4 mr-2"}),e[5]||(e[5]=n(" Editar ",-1))]),_:1})]),_:1},8,["href"])):_("",!0)])]),a(t(at),{modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=c=>O.value=c),class:"flex-1"},{default:l(()=>{var c;return[a(t(lt),null,{default:l(()=>{var o;return[a(t(I),{value:"general"},{default:l(()=>[a(t(ft),{class:"h-4 w-4 mr-2"}),e[6]||(e[6]=n(" General ",-1))]),_:1}),(o=s.obligacion.hijos)!=null&&o.length?(u(),g(t(I),{key:0,value:"hijos"},{default:l(()=>{var m;return[a(t(gt),{class:"h-4 w-4 mr-2"}),e[7]||(e[7]=n(" Obligaciones Hijas ",-1)),(m=s.obligacion.hijos)!=null&&m.length?(u(),g(t($),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[n(d(s.obligacion.hijos.length),1)]),_:1})):_("",!0)]}),_:1})):_("",!0),a(t(I),{value:"evidencias"},{default:l(()=>[a(t(V),{class:"h-4 w-4 mr-2"}),e[8]||(e[8]=n(" Evidencias ",-1)),h.value.length>0?(u(),g(t($),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[n(d(h.value.length),1)]),_:1})):_("",!0)]),_:1})]}),_:1}),a(t(E),{value:"general",class:"space-y-4 mt-6"},{default:l(()=>{var o;return[i("div",ht,[i("div",kt,[a(t(b),null,{default:l(()=>[a(t(k),null,{default:l(()=>[a(t(w),null,{default:l(()=>[...e[9]||(e[9]=[n("Información General",-1)])]),_:1})]),_:1}),a(t(y),{class:"space-y-4"},{default:l(()=>[i("div",null,[a(t(et),null,{default:l(()=>[...e[10]||(e[10]=[n("Descripción",-1)])]),_:1}),i("p",wt,d(s.obligacion.descripcion||"Sin descripción"),1)])]),_:1})]),_:1})]),i("div",$t,[a(t(b),null,{default:l(()=>[a(t(k),null,{default:l(()=>[a(t(w),null,{default:l(()=>[...e[11]||(e[11]=[n("Detalles del Contrato",-1)])]),_:1})]),_:1}),a(t(y),null,{default:l(()=>{var m;return[a(t(j),{href:r.route("admin.contratos.show",s.contrato.id),class:"hover:underline"},{default:l(()=>[i("h3",jt,d(s.contrato.nombre),1)]),_:1},8,["href"]),i("p",Dt,d((m=s.contrato.proyecto)==null?void 0:m.nombre),1)]}),_:1})]),_:1}),(o=s.obligacion.archivos_adjuntos)!=null&&o.length?(u(),g(t(b),{key:0},{default:l(()=>[a(t(k),null,{default:l(()=>[a(t(w),null,{default:l(()=>[...e[12]||(e[12]=[n("Archivos Adjuntos",-1)])]),_:1})]),_:1}),a(t(y),null,{default:l(()=>[i("div",Mt,[(u(!0),p(D,null,C(s.obligacion.archivos_adjuntos,m=>(u(),p("div",{key:m.ruta,class:"flex items-center gap-2"},[a(t(ct),{class:"h-4 w-4"}),i("a",{href:m.ruta,target:"_blank",class:"hover:underline text-sm"},d(m.nombre_original),9,Ct)]))),128))])]),_:1})]),_:1})):_("",!0),a(t(b),null,{default:l(()=>[a(t(k),null,{default:l(()=>[a(t(w),null,{default:l(()=>[...e[13]||(e[13]=[n("Auditoría",-1)])]),_:1})]),_:1}),a(t(y),{class:"text-sm space-y-2"},{default:l(()=>{var m,L,z;return[i("div",null,[e[14]||(e[14]=i("span",{class:"text-gray-600"},"Creado por:",-1)),i("p",null,d(((m=s.obligacion.creador)==null?void 0:m.name)||"Sistema"),1),i("p",It,d(M(s.obligacion.created_at)),1)]),s.obligacion.updated_at?(u(),p("div",Et,[e[15]||(e[15]=i("span",{class:"text-gray-600"},"Última actualización:",-1)),i("p",null,d(((L=s.obligacion.actualizador)==null?void 0:L.name)||"Sistema"),1),i("p",Vt,d(M(s.obligacion.updated_at)),1)])):_("",!0),s.obligacion.cumplido_at?(u(),p("div",At,[e[16]||(e[16]=i("span",{class:"text-gray-600"},"Cumplido por:",-1)),i("p",null,d(((z=s.obligacion.cumplido_por_usuario)==null?void 0:z.name)||"Sistema"),1),i("p",Ot,d(M(s.obligacion.cumplido_at)),1)])):_("",!0)]}),_:1})]),_:1})])])]}),_:1}),(c=s.obligacion.hijos)!=null&&c.length?(u(),g(t(E),{key:0,value:"hijos",class:"space-y-4 mt-6"},{default:l(()=>[a(t(b),null,{default:l(()=>[a(t(k),null,{default:l(()=>[a(t(w),null,{default:l(()=>[...e[17]||(e[17]=[n("Obligaciones Hijas",-1)])]),_:1}),a(t(S),null,{default:l(()=>[...e[18]||(e[18]=[n(" Sub-obligaciones derivadas de esta obligación principal ",-1)])]),_:1})]),_:1}),a(t(y),null,{default:l(()=>[a(rt,{obligaciones:s.obligacion.hijos,contratoId:s.obligacion.contrato_id,editable:t(G)("obligaciones.edit"),onEdit:e[0]||(e[0]=o=>t(W).visit(r.route("admin.obligaciones.edit",o.id)))},null,8,["obligaciones","contratoId","editable"])]),_:1})]),_:1})]),_:1})):_("",!0),a(t(E),{value:"evidencias",class:"space-y-4 mt-6"},{default:l(()=>[h.value.length>0?(u(),g(nt,{key:0,modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o),contratos:[s.contrato],evidencias:h.value},null,8,["modelValue","contratos","evidencias"])):_("",!0),B.value.length>0?(u(),p("div",Bt,[a(t(b),null,{default:l(()=>[a(t(k),null,{default:l(()=>[a(t(w),null,{default:l(()=>[...e[19]||(e[19]=[n("Evidencias Asociadas",-1)])]),_:1}),a(t(S),null,{default:l(()=>[...e[20]||(e[20]=[n(" Evidencias cargadas para esta obligación ",-1)])]),_:1})]),_:1}),a(t(y),null,{default:l(()=>[a(t(it),null,{default:l(()=>[a(t(ot),null,{default:l(()=>[a(t(T),null,{default:l(()=>[a(t(v),null,{default:l(()=>[...e[21]||(e[21]=[n("Tipo",-1)])]),_:1}),a(t(v),null,{default:l(()=>[...e[22]||(e[22]=[n("Descripción",-1)])]),_:1}),a(t(v),null,{default:l(()=>[...e[23]||(e[23]=[n("Entregable",-1)])]),_:1}),a(t(v),null,{default:l(()=>[...e[24]||(e[24]=[n("Usuario",-1)])]),_:1}),a(t(v),null,{default:l(()=>[...e[25]||(e[25]=[n("Estado",-1)])]),_:1}),a(t(v),null,{default:l(()=>[...e[26]||(e[26]=[n("Fecha",-1)])]),_:1}),a(t(v),{class:"text-right"},{default:l(()=>[...e[27]||(e[27]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),a(t(st),null,{default:l(()=>[(u(!0),p(D,null,C(B.value,o=>(u(),g(t(T),{key:o.id,class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800"},{default:l(()=>[a(t(j),{href:`/admin/contratos/${s.contrato.id}/evidencias/${o.id}`,class:"contents"},{default:l(()=>[a(t(x),null,{default:l(()=>[a(t($),{variant:"outline"},{default:l(()=>[n(d(o.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),a(t(x),null,{default:l(()=>[i("span",Lt,d(o.descripcion||"-"),1)]),_:2},1024),a(t(x),null,{default:l(()=>[o.entregables&&o.entregables.length>0?(u(),p("div",zt,[(u(!0),p(D,null,C(o.entregables,m=>(u(),g(t($),{key:m.id,variant:"secondary",class:"text-xs"},{default:l(()=>[n(d(m.nombre),1)]),_:2},1024))),128))])):(u(),p("span",Ht,"-"))]),_:2},1024),a(t(x),null,{default:l(()=>{var m;return[i("span",Nt,d(((m=o.usuario)==null?void 0:m.name)||"-"),1)]}),_:2},1024),a(t(x),null,{default:l(()=>[a(t($),{class:X({"bg-yellow-100 text-yellow-800":o.estado==="pendiente","bg-green-100 text-green-800":o.estado==="aprobada","bg-red-100 text-red-800":o.estado==="rechazada"})},{default:l(()=>[n(d(o.estado),1)]),_:2},1032,["class"])]),_:2},1024),a(t(x),null,{default:l(()=>[n(d(K(o.created_at)),1)]),_:2},1024),a(t(x),{class:"text-right"},{default:l(()=>[o.archivo_url?(u(),p("a",{key:0,href:o.archivo_url,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800",onClick:e[2]||(e[2]=Y(()=>{},["stop"]))},[a(t(pt),{class:"h-4 w-4"})],8,Pt)):_("",!0)]),_:2},1024)]),_:2},1032,["href"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})])):h.value.length===0?(u(),g(t(b),{key:2},{default:l(()=>[a(t(y),{class:"py-8"},{default:l(()=>[i("div",St,[a(t(V),{class:"mx-auto h-12 w-12 text-gray-400"}),e[28]||(e[28]=i("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias asociadas",-1)),e[29]||(e[29]=i("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(u(),g(t(b),{key:3},{default:l(()=>[a(t(y),{class:"py-8"},{default:l(()=>[i("div",Tt,[a(t(V),{class:"mx-auto h-12 w-12 text-gray-400"}),e[30]||(e[30]=i("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),e[31]||(e[31]=i("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1}))]),_:1})]}),_:1},8,["modelValue"])])]),_:1})],64))}});export{ia as default};
