import{d as L,i as m,e,w as o,f as t,h as d,F as tt,k as et,g as c,m as n,b,j as f,y as ot,v as J,t as _,r as z,c as q,p as at,s as y,n as H}from"./app-CrD_KEFj.js";import{_ as st}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DsZMIhJR.js";import{c as it,_ as x}from"./createLucideIcon-ZnxzUm35.js";import{_ as A,c as I,a as lt,b as nt}from"./CardTitle.vue_vue_type_script_setup_true_lang-xJVPjAdU.js";import{O as rt}from"./ObligacionTree-yCIH4xgy.js";import{_ as G}from"./index-CiAadxSQ.js";import{a as ct,b as Q,c as O,d as dt,_ as mt,e as V}from"./TableHeader.vue_vue_type_script_setup_true_lang-Bl7TS-f3.js";import{u as K}from"./usePermissions-Bk65yHFH.js";import{C as ut}from"./circle-alert-0K4JQ-z5.js";import{E as ft}from"./eye-B_K4Me0I.js";import{P as pt}from"./pencil-Czh1xZQM.js";import{T as vt}from"./trash-2-IGEYkNoE.js";import{_ as gt}from"./Input.vue_vue_type_script_setup_true_lang-CDAyKT8J.js";import{_ as X}from"./Label.vue_vue_type_script_setup_true_lang-BaMHB0QC.js";import{_ as bt}from"./AddContratosModal.vue_vue_type_script_setup_true_lang-CQdFV_k9.js";import{S as xt}from"./search-C_lXaZA2.js";import{F as j}from"./file-text-Bu1VvZe4.js";import{X as E}from"./x-B7aKZY06.js";import{_ as ht}from"./Pagination.vue_vue_type_script_setup_true_lang-D-VdvLZH.js";import{t as T}from"./index-BP3SOsfU.js";import{l as yt}from"./lodash-B9AwByK5.js";import{D as _t}from"./download-8YXVWcdv.js";import{P as kt}from"./plus-COKDgwUI.js";import{T as wt}from"./tree-pine-DunMc3wX.js";import{L as $t}from"./list-Cb0NPxqx.js";import"./useFlashMessages-trgAog73.js";import"./index-777viwuQ.js";import"./floating-ui.vue-gpeSOIY0.js";import"./index-Bt8AT0c4.js";import"./shield-DJolrK95.js";import"./user-5xjrPwhc.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CLmN0hbT.js";import"./chevron-right-C9WzyXtv.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CyEERs4H.js";import"./VisuallyHidden-1uupHXlw.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-GMm3aUgQ.js";import"./index-c4ehKeV7.js";import"./check-BPUn1pTh.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CM3JmPaK.js";import"./map-pin-BiDcjO9W.js";import"./chevrons-up-down-DyidzQ0P.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-1jA7iwBL.js";import"./tag-DS-1Ejin.js";import"./users-BaF55dbJ.js";import"./target-D9-QNOuA.js";import"./vote-IRVpGuAQ.js";import"./folder-open-xNF7AHc7.js";import"./send-TyaYyBhR.js";import"./briefcase-DREJOcCn.js";import"./calendar-BLm5XE2X.js";import"./megaphone-BaDiRPWr.js";import"./user-check-IQDv947s.js";import"./clipboard-list-Cs-V_sio.js";import"./mail-C1dcLyQd.js";import"./message-square-DPOk_07o.js";import"./external-link-DTi_Y1WS.js";import"./panel-left-C1oWoC8m.js";import"./index-Cx43HDCP.js";import"./Separator.vue_vue_type_script_setup_true_lang-BjnHTmvp.js";import"./circle-unRoth4C.js";import"./layers-C0UqY0oq.js";import"./paperclip-lg4Iz78z.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./loader-circle-zM1-A8Qd.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-aE6EeFVb.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BN01YbHp.js";import"./index-B7xeZPh-.js";import"./useKbd-kRIii9yh.js";import"./utils-BaUQ2S0d.js";import"./VisuallyHiddenInput-D2TiXZkP.js";import"./contratos-BiUTbrRP.js";import"./chevron-left-xMHM-RHI.js";import"./es-BDPlFIsO.js";import"./parseISO-DFjB8F03.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=it("CornerDownRightIcon",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),St={key:0},Ft={class:"flex items-center"},Ot={class:"text-sm text-gray-600"},Vt={key:0,class:"text-sm"},jt={key:1,class:"text-sm text-gray-400"},Et={class:"flex items-center justify-end gap-1"},zt={key:1,class:"text-center py-8 text-gray-500"},Bt=L({__name:"ObligacionTable",props:{obligaciones:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1}},emits:["view","edit","delete"],setup(i,{emit:g}){const k=g,{hasPermission:p}=K();return($,a)=>(n(),m("div",null,[i.obligaciones&&i.obligaciones.length>0?(n(),m("div",St,[e(t(mt),null,{default:o(()=>[e(t(ct),null,{default:o(()=>[e(t(Q),null,{default:o(()=>[e(t(O),null,{default:o(()=>[...a[0]||(a[0]=[d("Título",-1)])]),_:1}),e(t(O),null,{default:o(()=>[...a[1]||(a[1]=[d("Descripción",-1)])]),_:1}),e(t(O),null,{default:o(()=>[...a[2]||(a[2]=[d("Archivos",-1)])]),_:1}),e(t(O),{class:"text-right"},{default:o(()=>[...a[3]||(a[3]=[d("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(dt),null,{default:o(()=>[(n(!0),m(tt,null,et(i.obligaciones,s=>(n(),b(t(Q),{key:s.id},{default:o(()=>[e(t(V),{class:"font-medium"},{default:o(()=>[c("div",Ft,[s.nivel>0?(n(),m("span",{key:0,class:"flex items-center text-muted-foreground mr-2",style:ot({paddingLeft:`${(s.nivel-1)*12}px`})},[e(t(Ct),{class:"h-4 w-4"})],4)):f("",!0),c("div",null,[e(t(J),{href:`/admin/obligaciones/${s.id}`,class:"hover:text-blue-600 hover:underline"},{default:o(()=>[d(_(s.titulo),1)]),_:2},1032,["href"]),s.padre?(n(),b(t(G),{key:0,variant:"secondary",class:"ml-2 text-xs"},{default:o(()=>[...a[4]||(a[4]=[d(" Hija ",-1)])]),_:1})):f("",!0),s.tiene_hijos?(n(),b(t(G),{key:1,variant:"outline",class:"ml-1 text-xs"},{default:o(()=>[d(_(s.total_hijos)+" hijos ",1)]),_:2},1024)):f("",!0)])])]),_:2},1024),e(t(V),null,{default:o(()=>[c("span",Ot,_(s.descripcion?s.descripcion.length>100?s.descripcion.substring(0,100)+"...":s.descripcion:"Sin descripción"),1)]),_:2},1024),e(t(V),null,{default:o(()=>{var h;return[(h=s.archivos_adjuntos)!=null&&h.length?(n(),m("span",Vt,_(s.archivos_adjuntos.length)+" archivo(s) ",1)):(n(),m("span",jt,"Sin archivos"))]}),_:2},1024),e(t(V),{class:"text-right"},{default:o(()=>[c("div",Et,[e(t(x),{variant:"ghost",size:"sm",class:"h-8 px-2",onClick:h=>k("view",s)},{default:o(()=>[e(t(ft),{class:"h-4 w-4 mr-1"}),a[5]||(a[5]=d(" Ver ",-1))]),_:1},8,["onClick"]),i.canEdit||t(p)("obligaciones.edit")?(n(),b(t(x),{key:0,variant:"ghost",size:"sm",class:"h-8 px-2",onClick:h=>k("edit",s)},{default:o(()=>[e(t(pt),{class:"h-4 w-4 mr-1"}),a[6]||(a[6]=d(" Editar ",-1))]),_:1},8,["onClick"])):f("",!0),i.canDelete||t(p)("obligaciones.delete")?(n(),b(t(x),{key:1,variant:"ghost",size:"sm",class:"h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:h=>k("delete",s)},{default:o(()=>[e(t(vt),{class:"h-4 w-4 mr-1"}),a[7]||(a[7]=d(" Eliminar ",-1))]),_:1},8,["onClick"])):f("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(n(),m("div",zt,[e(t(ut),{class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),a[8]||(a[8]=c("p",null,"No se encontraron obligaciones",-1)),a[9]||(a[9]=c("p",{class:"text-sm mt-1"},"Crea una nueva obligación para comenzar",-1))]))]))}}),Dt={class:"flex flex-col sm:flex-row gap-4"},Pt={class:"flex-1"},Tt={class:"relative"},At={key:0,class:"w-full sm:w-auto"},It={key:0,class:"flex items-center gap-2 px-3 py-2 bg-muted rounded-lg"},Lt={class:"flex-1 min-w-0"},Nt={class:"font-medium text-sm truncate"},Ut={key:0,class:"text-xs text-muted-foreground truncate"},Rt={key:1,class:"flex items-center gap-2 px-3 py-2 bg-muted rounded-lg"},Mt={class:"flex-1 min-w-0"},qt={class:"font-medium text-sm"},Ht=L({__name:"ObligacionFilters",props:{modelValue:{},proyectos:{default:()=>[]},loading:{type:Boolean,default:!1},showContratoFilter:{type:Boolean,default:!0},contratoSeleccionado:{default:null}},emits:["update:modelValue","update:contratoSeleccionado","filter","clear"],setup(i,{emit:g}){const k=i,p=g,$=z(!1),a=z(k.contratoSeleccionado),s=q({get:()=>k.modelValue,set:v=>p("update:modelValue",v)}),h=q(()=>s.value.search||k.showContratoFilter&&s.value.contrato_id),B=v=>{s.value={...s.value,search:v},p("filter")},D=v=>{v.contratoIds.length>0&&(s.value={...s.value,contrato_id:v.contratoIds[0]},v.contratos&&v.contratos.length>0&&(a.value=v.contratos[0],p("update:contratoSeleccionado",v.contratos[0])),p("filter"))},C=()=>{s.value={...s.value,contrato_id:null},a.value=null,p("update:contratoSeleccionado",null),p("filter")},P=()=>{s.value={search:"",contrato_id:null},a.value=null,p("update:contratoSeleccionado",null),p("clear")};return(v,u)=>(n(),b(t(A),null,{default:o(()=>[e(t(I),{class:"pt-6"},{default:o(()=>[c("div",Dt,[c("div",Pt,[e(t(X),{for:"search",class:"sr-only"},{default:o(()=>[...u[2]||(u[2]=[d("Buscar",-1)])]),_:1}),c("div",Tt,[e(t(xt),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e(t(gt),{id:"search","model-value":s.value.search,type:"text",placeholder:"Buscar por título o descripción...",class:"pl-10",disabled:i.loading,"onUpdate:modelValue":B},null,8,["model-value","disabled"])])]),i.showContratoFilter?(n(),m("div",At,[e(t(X),{for:"contrato_filter",class:"sr-only"},{default:o(()=>[...u[3]||(u[3]=[d("Contrato",-1)])]),_:1}),a.value?(n(),m("div",It,[e(t(j),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),c("div",Lt,[c("p",Nt,_(a.value.nombre),1),a.value.proyecto?(n(),m("p",Ut,_(a.value.proyecto.nombre),1)):f("",!0)]),e(t(x),{type:"button",variant:"ghost",size:"sm",class:"h-6 w-6 p-0 flex-shrink-0",onClick:C},{default:o(()=>[e(t(E),{class:"h-4 w-4"})]),_:1})])):s.value.contrato_id?(n(),m("div",Rt,[e(t(j),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),c("div",Mt,[c("p",qt,"Contrato #"+_(s.value.contrato_id),1),u[4]||(u[4]=c("p",{class:"text-xs text-muted-foreground"},"Filtro activo",-1))]),e(t(x),{type:"button",variant:"ghost",size:"sm",class:"h-6 w-6 p-0 flex-shrink-0",onClick:C},{default:o(()=>[e(t(E),{class:"h-4 w-4"})]),_:1})])):(n(),b(t(x),{key:2,type:"button",variant:"outline",onClick:u[0]||(u[0]=S=>$.value=!0),disabled:i.loading,class:"w-full sm:w-auto"},{default:o(()=>[e(t(j),{class:"h-4 w-4 mr-2"}),u[5]||(u[5]=d(" Filtrar por Contrato ",-1))]),_:1},8,["disabled"])),e(bt,{modelValue:$.value,"onUpdate:modelValue":u[1]||(u[1]=S=>$.value=S),title:"Filtrar por Contrato",description:"Selecciona el contrato para filtrar las obligaciones","search-endpoint":"/admin/contratos/search",proyectos:i.proyectos,"excluded-ids":[],"max-selection":1,"submit-button-text":"Aplicar Filtro",onSubmit:D},null,8,["modelValue","proyectos"])])):f("",!0),h.value?(n(),b(t(x),{key:1,variant:"ghost",size:"icon",disabled:i.loading,onClick:P,title:"Limpiar filtros"},{default:o(()=>[e(t(E),{class:"h-4 w-4"})]),_:1},8,["disabled"])):f("",!0)])]),_:1})]),_:1}))}}),Gt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Qt={class:"flex items-center justify-between"},Xt={class:"text-3xl font-bold"},Jt={key:0,class:"text-sm text-gray-600"},Kt={class:"flex items-center gap-2"},Wt={class:"flex items-center justify-between"},Yt={class:"flex items-center gap-2"},Zt={class:"text-sm text-blue-800"},te={class:"font-medium"},ee={key:0,class:"text-blue-600"},oe={class:"flex items-center justify-between"},ae={class:"flex items-center gap-2"},se={key:0},ie={key:1},le={key:0,class:"mt-4 flex justify-center"},Oo=L({__name:"Index",props:{obligaciones:{},estadisticas:{},filters:{},contrato:{},proyectos:{},estadisticasResponsables:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canExport:{type:Boolean}},setup(i){var N,U,R;const g=i,k=g.contrato?[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:g.contrato.nombre,href:`/admin/contratos/${g.contrato.id}`},{title:"Obligaciones",href:"#"}]:[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"}],{hasPermission:p}=K(),a=z(new URLSearchParams(window.location.search).get("vista")==="arbol"?"arbol":"tabla"),s=z({search:((N=g.filters)==null?void 0:N.search)||"",contrato_id:((U=g.filters)==null?void 0:U.contrato_id)||((R=g.contrato)==null?void 0:R.id)||null});at(a,r=>{const l={...s.value,vista:r};y.get(route("admin.obligaciones.index"),l,{preserveState:!0,preserveScroll:!0,replace:!0,only:[]})});const h=yt.debounce(()=>{y.get(route("admin.obligaciones.index"),{...s.value,vista:a.value},{preserveState:!0,preserveScroll:!0})},300),B=()=>{var r;s.value={search:"",contrato_id:((r=g.contrato)==null?void 0:r.id)||null},h()},D=()=>{y.get(route("admin.obligaciones.index"),{search:s.value.search,vista:a.value},{preserveState:!1})},C=()=>{var r;y.visit(route("admin.obligaciones.create",{contrato_id:(r=g.contrato)==null?void 0:r.id}))},P=r=>{y.visit(route("admin.obligaciones.show",r.id))},v=r=>{y.visit(route("admin.obligaciones.edit",r.id))},u=r=>{const l=r.tiene_hijos?`¿Estás seguro de eliminar "${r.titulo}" y todas sus obligaciones hijas?`:`¿Estás seguro de eliminar "${r.titulo}"?`;confirm(l)&&y.delete(route("admin.obligaciones.destroy",r.id),{preserveScroll:!0,onSuccess:()=>{T.success("Obligación eliminada exitosamente")}})},S=r=>{y.post(route("admin.obligaciones.completar",r.id),{},{preserveScroll:!0,onSuccess:()=>{T.success("Obligación marcada como cumplida")}})},W=r=>{y.visit(route("admin.obligaciones.create",{contrato_id:r.contrato_id,parent_id:r.id}))},Y=(r,l,F)=>{y.post(route("admin.obligaciones.mover",r.id),{nuevo_parent_id:l,nuevo_orden:F},{preserveScroll:!0,onSuccess:()=>{T.success("Obligación movida exitosamente")}})},Z=()=>{window.open(route("admin.obligaciones.exportar",s.value),"_blank")};return(r,l)=>(n(),b(st,{breadcrumbs:t(k)},{default:o(()=>{var F;return[c("div",Gt,[c("div",Qt,[c("div",null,[c("h1",Xt,[l[3]||(l[3]=d(" Obligaciones ",-1)),i.contrato?(n(),m("span",Jt," - "+_(i.contrato.nombre),1)):f("",!0)]),l[4]||(l[4]=c("p",{class:"text-gray-600 mt-1"},"Gestiona las obligaciones de los contratos",-1))]),c("div",Kt,[i.canExport||t(p)("obligaciones.export")?(n(),b(t(x),{key:0,variant:"outline",size:"sm",onClick:Z},{default:o(()=>[e(t(_t),{class:"h-4 w-4 mr-2"}),l[5]||(l[5]=d(" Exportar ",-1))]),_:1})):f("",!0),i.canCreate||t(p)("obligaciones.create")?(n(),b(t(J),{key:1,href:r.route("admin.obligaciones.create",{contrato_id:(F=i.contrato)==null?void 0:F.id})},{default:o(()=>[e(t(x),null,{default:o(()=>[e(t(kt),{class:"h-4 w-4 mr-2"}),l[6]||(l[6]=d(" Nueva Obligación ",-1))]),_:1})]),_:1},8,["href"])):f("",!0)])]),i.contrato?(n(),b(t(A),{key:0,class:"border-blue-200 bg-blue-50"},{default:o(()=>[e(t(I),{class:"py-3"},{default:o(()=>[c("div",Wt,[c("div",Yt,[e(t(j),{class:"h-4 w-4 text-blue-600"}),c("span",Zt,[l[7]||(l[7]=d(" Filtrando por contrato: ",-1)),c("span",te,_(i.contrato.nombre),1),i.contrato.proyecto?(n(),m("span",ee," ("+_(i.contrato.proyecto.nombre)+")",1)):f("",!0)])]),e(t(x),{variant:"ghost",size:"sm",class:"h-8 text-blue-700 hover:text-blue-900 hover:bg-blue-100",onClick:D},{default:o(()=>[e(t(E),{class:"h-4 w-4 mr-1"}),l[8]||(l[8]=d(" Quitar filtro ",-1))]),_:1})])]),_:1})]),_:1})):f("",!0),e(Ht,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=w=>s.value=w),proyectos:i.proyectos||[],"show-contrato-filter":!i.contrato,onFilter:t(h),onClear:B},null,8,["modelValue","proyectos","show-contrato-filter","onFilter"]),e(t(A),{class:"flex-1"},{default:o(()=>[e(t(lt),null,{default:o(()=>[c("div",oe,[e(t(nt),null,{default:o(()=>[...l[9]||(l[9]=[d("Lista de Obligaciones",-1)])]),_:1}),c("div",ae,[e(t(x),{variant:"ghost",size:"sm",class:H({"bg-gray-100":a.value==="arbol"}),onClick:l[1]||(l[1]=w=>a.value="arbol")},{default:o(()=>[e(t(wt),{class:"h-4 w-4 mr-1"}),l[10]||(l[10]=d(" Árbol ",-1))]),_:1},8,["class"]),e(t(x),{variant:"ghost",size:"sm",class:H({"bg-gray-100":a.value==="tabla"}),onClick:l[2]||(l[2]=w=>a.value="tabla")},{default:o(()=>[e(t($t),{class:"h-4 w-4 mr-1"}),l[11]||(l[11]=d(" Tabla ",-1))]),_:1},8,["class"])])])]),_:1}),e(t(I),null,{default:o(()=>{var w,M;return[a.value==="arbol"&&i.obligaciones.data&&i.obligaciones.data.length>0?(n(),m("div",se,[e(rt,{obligaciones:i.obligaciones.data,contratoId:(w=i.contrato)==null?void 0:w.id,editable:!0,onCreate:C,onEdit:v,onDelete:u,onComplete:S,onAddChild:W,onMove:Y},null,8,["obligaciones","contratoId"])])):a.value==="tabla"?(n(),m("div",ie,[e(Bt,{obligaciones:i.obligaciones.data||[],"can-edit":i.canEdit,"can-delete":i.canDelete,onView:P,onEdit:v,onDelete:u},null,8,["obligaciones","can-edit","can-delete"]),i.obligaciones.links&&((M=i.obligaciones.data)!=null&&M.length)?(n(),m("div",le,[e(ht,{links:i.obligaciones.links,meta:i.obligaciones.meta},null,8,["links","meta"])])):f("",!0)])):f("",!0)]}),_:1})]),_:1})])]}),_:1},8,["breadcrumbs"]))}});export{Oo as default};
