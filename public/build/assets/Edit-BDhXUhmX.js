import{d as I,C as J,r as N,i as m,e as n,f as t,u as e,p as L,w as s,g as i,P as B,h as l,l as O,j as c,n as _,t as p,F as x,k as $,b as W,a as E}from"./app-CR-2XB3C.js";import{_ as h}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BeDoGI8L.js";import{_ as C}from"./createLucideIcon-DpqMcHcs.js";import{_ as g,a as y,b,c as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-CXc292e6.js";import{_ as k}from"./CardDescription.vue_vue_type_script_setup_true_lang-CghfIXbW.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-87jkhHIN.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-CTFOyKy8.js";import{_ as H,a as K,b as Q,c as X,d as j}from"./SelectValue.vue_vue_type_script_setup_true_lang-e9C0UTAB.js";import{_ as Y}from"./Switch.vue_vue_type_script_setup_true_lang-BIn1iS3a.js";import{_ as Z}from"./Checkbox.vue_vue_type_script_setup_true_lang-geKRIMEf.js";import{_ as ee}from"./GeographicSelector.vue_vue_type_script_setup_true_lang-y6H-OSrV.js";import{_ as re}from"./AvatarUpload.vue_vue_type_script_setup_true_lang-Dzp43Yft.js";import{t as w}from"./index-DEPFt58J.js";import{A as oe}from"./arrow-left-BBVGGo-X.js";import{S as te}from"./save-fZDcFWE3.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Ert7fISp.js";import"./index-BZs2h2K_.js";import"./floating-ui.vue-BhiDC_BV.js";import"./x-BtC0hBQf.js";import"./index-E07s-QL0.js";import"./shield-4oMICjJq.js";import"./user-DHtFWwAY.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang--Zg1QsWs.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Dfpf6sX3.js";import"./VisuallyHidden-BWbUvSRY.js";import"./index-B_J_AOJU.js";import"./circle-alert-Ce-R__0b.js";import"./map-pin-CH_1kWrL.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-D_zYDN4Z.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-D4bt_NVp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-DnobICLq.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DspZ-Okb.js";import"./target-PRmdjiaM.js";import"./users-2q8ym3rK.js";import"./vote-BGunVfqa.js";import"./folder-open-B73Z5LJI.js";import"./send-DrZ9C7tM.js";import"./file-text-bOjPW4fi.js";import"./briefcase-VNV3HxYQ.js";import"./calendar-K2tiWc-j.js";import"./megaphone-B1ul-h89.js";import"./user-check-DqzH6i1N.js";import"./mail-mHQkAKOp.js";import"./message-square-CKxkeyaY.js";import"./external-link-BksJeFVg.js";import"./panel-left-C66hQ-oC.js";import"./index-Bv2D6OQs.js";import"./check-COi2Akip.js";import"./index-CuEHpEfT.js";import"./nullish-CHIgUVhi.js";import"./VisuallyHiddenInput-y0SKat9x.js";import"./loader-circle-Dz5wQVS9.js";import"./upload-d9B55jVi.js";const ae={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},se={class:"flex items-center justify-between"},de={class:"grid gap-4 md:grid-cols-2"},ie={key:0,class:"text-sm text-red-600 mt-1"},le={key:0,class:"text-sm text-red-600 mt-1"},ne={key:0,class:"text-sm text-red-600 mt-1"},ue={key:0,class:"text-sm text-red-600 mt-1"},me={key:0,class:"text-sm text-red-600 mt-1"},pe={class:"text-xs text-muted-foreground mt-1"},ce={key:0,class:"text-sm text-red-600 mt-1"},fe={class:"grid gap-4 md:grid-cols-2"},_e={key:0,class:"text-sm text-red-600 mt-1"},ve={key:0,class:"text-sm text-red-600 mt-1"},xe={class:"space-y-4"},ge={key:0},ye={class:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-4"},be={class:"flex-1"},Ve={key:0,class:"text-sm text-muted-foreground"},ke={key:1,class:"text-xs text-blue-600"},we={key:0,class:"text-sm text-red-600 mt-1"},Ue={key:1},$e={class:"p-3 bg-muted rounded-md"},Ce={key:0,class:"space-y-1"},Se={key:1,class:"text-sm font-medium"},Ae={key:0,class:"text-sm text-red-600 mt-1"},De={class:"flex items-center space-x-2"},Ne={key:0,class:"text-sm text-red-600 mt-2"},Be={class:"flex items-center justify-end space-x-2"},Er=I({__name:"Edit",props:{user:{},cargos:{},roles:{},canAssignRoles:{type:Boolean}},setup(P){var A;const u=P,R=[{title:"Admin",href:"/admin/dashboard"},{title:"Usuarios",href:"/admin/usuarios"},{title:"Editar Usuario",href:"#"}],F=((A=u.user.roles)==null?void 0:A.map(d=>d.id))||[],o=J({name:u.user.name,email:u.user.email,password:"",password_confirmation:"",role_ids:F,cargo_id:u.user.cargo_id?u.user.cargo_id.toString():"none",documento_identidad:u.user.documento_identidad||"",telefono:u.user.telefono||"",direccion:u.user.direccion||"",territorio_id:u.user.territorio_id||null,departamento_id:u.user.departamento_id||null,municipio_id:u.user.municipio_id||null,localidad_id:u.user.localidad_id||null,activo:u.user.activo,created_at:u.user.created_at?u.user.created_at.replace(" ","T").substring(0,19):""}),S=N({territorio_id:u.user.territorio_id||void 0,departamento_id:u.user.departamento_id||void 0,municipio_id:u.user.municipio_id||void 0,localidad_id:u.user.localidad_id||void 0}),G=d=>{S.value=d,o.territorio_id=d.territorio_id||null,o.departamento_id=d.departamento_id||null,o.municipio_id=d.municipio_id||null,o.localidad_id=d.localidad_id||null},T=()=>{o.transform(d=>(d.created_at&&(d.created_at=d.created_at.replace("T"," ")),d)).put(route("admin.usuarios.update",u.user.id))},U=N(u.user.avatar_url),z=async d=>{const r=new FormData;r.append("avatar",d);try{const a=await E.post(route("admin.usuarios.avatar.upload",u.user.id),r,{headers:{"Content-Type":"multipart/form-data"}});a.data.success&&(U.value=a.data.avatar_url,w.success("Avatar actualizado correctamente"))}catch(a){console.error("Error uploading avatar:",a),w.error("No se pudo cargar el avatar")}},M=async()=>{try{const d=await E.delete(route("admin.usuarios.avatar.delete",u.user.id));d.data.success&&(U.value=d.data.avatar_url,w.success("Avatar eliminado correctamente"))}catch(d){console.error("Error deleting avatar:",d),w.error("No se pudo eliminar el avatar")}};return(d,r)=>(n(),m(x,null,[t(e(L),{title:"Editar Usuario"}),t(h,{breadcrumbs:R},{default:s(()=>[i("div",ae,[i("div",se,[r[11]||(r[11]=i("div",null,[i("h1",{class:"text-3xl font-bold tracking-tight"},"Editar Usuario"),i("p",{class:"text-muted-foreground"}," Modifica la información del usuario ")],-1)),t(e(B),{href:d.route("admin.usuarios.index")},{default:s(()=>[t(e(C),{variant:"outline"},{default:s(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),r[10]||(r[10]=l(" Volver ",-1))]),_:1})]),_:1},8,["href"])]),i("form",{onSubmit:O(T,["prevent"]),class:"space-y-6"},[t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...r[12]||(r[12]=[l("Foto de Perfil",-1)])]),_:1}),t(e(k),null,{default:s(()=>[...r[13]||(r[13]=[l(" Avatar personalizado del usuario ",-1)])]),_:1})]),_:1}),t(e(V),null,{default:s(()=>[t(re,{"model-value":U.value,"user-name":e(o).name,label:"Avatar del usuario",description:"Sube una foto de perfil para el usuario. JPG, PNG o WEBP. Máximo 5MB.",onUpload:z,onDelete:M},null,8,["model-value","user-name"])]),_:1})]),_:1}),t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...r[14]||(r[14]=[l("Información Básica",-1)])]),_:1}),t(e(k),null,{default:s(()=>[...r[15]||(r[15]=[l(" Datos principales del usuario ",-1)])]),_:1})]),_:1}),t(e(V),{class:"space-y-4"},{default:s(()=>[i("div",de,[i("div",null,[t(e(f),{for:"name"},{default:s(()=>[...r[16]||(r[16]=[l("Nombre completo *",-1)])]),_:1}),t(e(v),{id:"name",modelValue:e(o).name,"onUpdate:modelValue":r[0]||(r[0]=a=>e(o).name=a),type:"text",placeholder:"Juan Pérez",class:_({"border-red-500":e(o).errors.name})},null,8,["modelValue","class"]),e(o).errors.name?(n(),m("p",ie,p(e(o).errors.name),1)):c("",!0)]),i("div",null,[t(e(f),{for:"email"},{default:s(()=>[...r[17]||(r[17]=[l("Correo electrónico *",-1)])]),_:1}),t(e(v),{id:"email",modelValue:e(o).email,"onUpdate:modelValue":r[1]||(r[1]=a=>e(o).email=a),type:"email",placeholder:"juan@ejemplo.com",class:_({"border-red-500":e(o).errors.email})},null,8,["modelValue","class"]),e(o).errors.email?(n(),m("p",le,p(e(o).errors.email),1)):c("",!0)]),i("div",null,[t(e(f),{for:"documento_identidad"},{default:s(()=>[...r[18]||(r[18]=[l("Documento de identidad *",-1)])]),_:1}),t(e(v),{id:"documento_identidad",modelValue:e(o).documento_identidad,"onUpdate:modelValue":r[2]||(r[2]=a=>e(o).documento_identidad=a),type:"text",placeholder:"12345678",class:_({"border-red-500":e(o).errors.documento_identidad}),required:""},null,8,["modelValue","class"]),e(o).errors.documento_identidad?(n(),m("p",ne,p(e(o).errors.documento_identidad),1)):c("",!0)]),i("div",null,[t(e(f),{for:"telefono"},{default:s(()=>[...r[19]||(r[19]=[l("Teléfono *",-1)])]),_:1}),t(e(v),{id:"telefono",modelValue:e(o).telefono,"onUpdate:modelValue":r[3]||(r[3]=a=>e(o).telefono=a),type:"tel",placeholder:"3001234567",class:_({"border-red-500":e(o).errors.telefono}),required:""},null,8,["modelValue","class"]),e(o).errors.telefono?(n(),m("p",ue,p(e(o).errors.telefono),1)):c("",!0)])]),i("div",null,[t(e(f),{for:"direccion"},{default:s(()=>[...r[20]||(r[20]=[l("Dirección",-1)])]),_:1}),t(e(v),{id:"direccion",modelValue:e(o).direccion,"onUpdate:modelValue":r[4]||(r[4]=a=>e(o).direccion=a),type:"text",placeholder:"Calle 123 #45-67",class:_({"border-red-500":e(o).errors.direccion})},null,8,["modelValue","class"]),e(o).errors.direccion?(n(),m("p",me,p(e(o).errors.direccion),1)):c("",!0)]),i("div",null,[t(e(f),{for:"created_at"},{default:s(()=>[...r[21]||(r[21]=[l("Fecha de creación (opcional)",-1)])]),_:1}),t(e(v),{id:"created_at",modelValue:e(o).created_at,"onUpdate:modelValue":r[5]||(r[5]=a=>e(o).created_at=a),type:"datetime-local",class:_({"border-red-500":e(o).errors.created_at}),step:"1"},null,8,["modelValue","class"]),i("p",pe," Deja vacío para mantener la fecha actual del usuario: "+p(d.user.created_at||"No disponible"),1),e(o).errors.created_at?(n(),m("p",ce,p(e(o).errors.created_at),1)):c("",!0)])]),_:1})]),_:1}),t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...r[22]||(r[22]=[l("Seguridad",-1)])]),_:1}),t(e(k),null,{default:s(()=>[...r[23]||(r[23]=[l(" Configuración de acceso y contraseña ",-1)])]),_:1})]),_:1}),t(e(V),{class:"space-y-4"},{default:s(()=>[r[33]||(r[33]=i("div",{class:"p-4 bg-muted rounded-lg mb-4"},[i("p",{class:"text-sm text-muted-foreground"}," Deja los campos de contraseña vacíos si no deseas cambiarla. ")],-1)),i("div",fe,[i("div",null,[t(e(f),{for:"password"},{default:s(()=>[...r[24]||(r[24]=[l("Nueva contraseña",-1)])]),_:1}),t(e(v),{id:"password",modelValue:e(o).password,"onUpdate:modelValue":r[6]||(r[6]=a=>e(o).password=a),type:"password",placeholder:"••••••••",class:_({"border-red-500":e(o).errors.password})},null,8,["modelValue","class"]),e(o).errors.password?(n(),m("p",_e,p(e(o).errors.password),1)):c("",!0)]),i("div",null,[t(e(f),{for:"password_confirmation"},{default:s(()=>[...r[25]||(r[25]=[l("Confirmar nueva contraseña",-1)])]),_:1}),t(e(v),{id:"password_confirmation",modelValue:e(o).password_confirmation,"onUpdate:modelValue":r[7]||(r[7]=a=>e(o).password_confirmation=a),type:"password",placeholder:"••••••••",class:_({"border-red-500":e(o).errors.password_confirmation})},null,8,["modelValue","class"]),e(o).errors.password_confirmation?(n(),m("p",ve,p(e(o).errors.password_confirmation),1)):c("",!0)])]),i("div",xe,[d.canAssignRoles?(n(),m("div",ge,[t(e(f),null,{default:s(()=>[...r[26]||(r[26]=[l("Roles del usuario *",-1)])]),_:1}),r[27]||(r[27]=i("p",{class:"text-sm text-muted-foreground mb-3"}," Selecciona uno o más roles para este usuario ",-1)),i("div",ye,[(n(!0),m(x,null,$(d.roles,a=>(n(),m("div",{key:a.value,class:"flex items-start space-x-3 py-2"},[t(e(Z),{id:`role-${a.value}`,checked:e(o).role_ids.includes(a.value),"onUpdate:checked":q=>{if(q)e(o).role_ids.includes(a.value)||e(o).role_ids.push(a.value);else{const D=e(o).role_ids.indexOf(a.value);D>-1&&e(o).role_ids.splice(D,1)}}},null,8,["id","checked","onUpdate:checked"]),i("div",be,[t(e(f),{for:`role-${a.value}`,class:"text-base font-medium cursor-pointer"},{default:s(()=>[l(p(a.label),1)]),_:2},1032,["for"]),a.description?(n(),m("p",Ve,p(a.description),1)):c("",!0),a.is_system?(n(),m("span",ke," (Rol del Sistema) ")):c("",!0)])]))),128))]),e(o).errors.role_ids?(n(),m("p",we,p(e(o).errors.role_ids),1)):c("",!0)])):(n(),m("div",Ue,[t(e(f),null,{default:s(()=>[...r[28]||(r[28]=[l("Roles actuales",-1)])]),_:1}),i("div",$e,[d.user.roles&&d.user.roles.length>0?(n(),m("div",Ce,[(n(!0),m(x,null,$(d.user.roles,a=>(n(),m("p",{key:a.id,class:"text-sm font-medium"}," • "+p(a.display_name||a.name),1))),128))])):(n(),m("p",Se," Sin roles asignados ")),r[29]||(r[29]=i("p",{class:"text-xs text-muted-foreground mt-2"}," No tienes permisos para cambiar los roles de este usuario ",-1))])])),i("div",null,[t(e(f),{for:"cargo_id"},{default:s(()=>[...r[30]||(r[30]=[l("Cargo",-1)])]),_:1}),t(e(H),{modelValue:e(o).cargo_id,"onUpdate:modelValue":r[8]||(r[8]=a=>e(o).cargo_id=a)},{default:s(()=>[t(e(K),{class:_({"border-red-500":e(o).errors.cargo_id})},{default:s(()=>[t(e(Q),{placeholder:"Selecciona un cargo"})]),_:1},8,["class"]),t(e(X),null,{default:s(()=>[t(e(j),{value:"none"},{default:s(()=>[...r[31]||(r[31]=[l("Sin cargo",-1)])]),_:1}),(n(!0),m(x,null,$(d.cargos,a=>(n(),W(e(j),{key:a.id,value:a.id.toString()},{default:s(()=>[l(p(a.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(o).errors.cargo_id?(n(),m("p",Ae,p(e(o).errors.cargo_id),1)):c("",!0)])]),i("div",De,[t(e(Y),{id:"activo",checked:e(o).activo,"onUpdate:checked":r[9]||(r[9]=a=>e(o).activo=a)},null,8,["checked"]),t(e(f),{for:"activo"},{default:s(()=>[...r[32]||(r[32]=[l("Usuario activo",-1)])]),_:1})])]),_:1})]),_:1}),t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...r[34]||(r[34]=[l("Ubicación Geográfica",-1)])]),_:1}),t(e(k),null,{default:s(()=>[...r[35]||(r[35]=[l(" Define la ubicación del usuario (opcional) ",-1)])]),_:1})]),_:1}),t(e(V),null,{default:s(()=>[t(ee,{"model-value":S.value,"onUpdate:modelValue":G,mode:"single","show-card":!1,title:"",description:""},null,8,["model-value"]),e(o).errors.territorio_id||e(o).errors.departamento_id||e(o).errors.municipio_id||e(o).errors.localidad_id?(n(),m("div",Ne,p(e(o).errors.territorio_id||e(o).errors.departamento_id||e(o).errors.municipio_id||e(o).errors.localidad_id),1)):c("",!0)]),_:1})]),_:1}),i("div",Be,[t(e(B),{href:d.route("admin.usuarios.index")},{default:s(()=>[t(e(C),{variant:"outline",type:"button"},{default:s(()=>[...r[36]||(r[36]=[l(" Cancelar ",-1)])]),_:1})]),_:1},8,["href"]),t(e(C),{type:"submit",disabled:e(o).processing},{default:s(()=>[t(e(te),{class:"mr-2 h-4 w-4"}),r[37]||(r[37]=l(" Guardar Cambios ",-1))]),_:1},8,["disabled"])])],32)])]),_:1})],64))}});export{Er as default};
