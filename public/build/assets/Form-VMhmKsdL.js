import{d as Ke,k as H,c as O,w as se,s as Ye,a as _,o as u,j as q,i as j,e as c,b as i,u as e,g as k,f as l,t as v,F as Y,r as Z,bT as Qe,n as M,C as Ze,v as et,m as tt,h as at,at as rt,J as it,bK as st}from"./app-Df_XpEAt.js";import{_ as ce}from"./AppLogo.vue_vue_type_script_setup_true_lang-Cm9O2wcI.js";import{_ as oe,a as de}from"./CardContent.vue_vue_type_script_setup_true_lang-DpvJI9u6.js";import{_ as ne,a as Be}from"./CardTitle.vue_vue_type_script_setup_true_lang-BppcWH6e.js";import{_ as ot}from"./Checkbox.vue_vue_type_script_setup_true_lang-C_MpZ9RK.js";import{_ as fe}from"./Input.vue_vue_type_script_setup_true_lang-DXtBxhay.js";import{_ as ae}from"./Label.vue_vue_type_script_setup_true_lang-DlOvwav0.js";import{_ as dt,a as nt,b as lt,c as ut,d as ct}from"./SelectValue.vue_vue_type_script_setup_true_lang-BqZRPH_d.js";import{_ as ft}from"./Textarea.vue_vue_type_script_setup_true_lang-aEyqqkP7.js";import{u as mt,a as _t,_ as pt,b as gt,c as vt,d as bt}from"./useConditionalFields-CVdCdkyF.js";import{a as Le,C as Pe,U as yt,u as W,_ as ht,v as xt}from"./AppLayout.vue_vue_type_script_setup_true_lang-C_K_7soM.js";import{_ as Re}from"./CardDescription.vue_vue_type_script_setup_true_lang-BctLpHuq.js";import{_ as kt,a as ze}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-fWCpyfE2.js";import{a as me,_ as _e}from"./index-CY9j1fFa.js";import{_ as pe}from"./AlertTitle.vue_vue_type_script_setup_true_lang-BiLkY8ak.js";import{C as X}from"./circle-alert-DIsU94cK.js";import{M as ie}from"./map-pin-DkpdkCH0.js";import{A as St}from"./arrow-left-akQJVDR5.js";import{C as Me}from"./clock-C1PsLs-t.js";import{C as $t}from"./circle-check-big-CUriUECu.js";import{U as Ct}from"./user-CanKRfGD.js";import{S as wt}from"./save-56wtP7ud.js";import"./index-B1pkzvRA.js";import"./index-CrGlExaQ.js";import"./useForwardExpose-DiGKx0L3.js";import"./usePrimitiveElement-CIANssro.js";import"./createContext-BXwDQvZJ.js";import"./Collection-D8NNtd7R.js";import"./useNonce-DmGZhgD0.js";import"./chevron-up-CHg7eWXV.js";import"./handleAndDispatchCustomEvent-CYpUamdb.js";import"./nullish-CHIgUVhi.js";import"./useFormControl-D498Wec-.js";import"./VisuallyHidden-wBwWBqQZ.js";import"./upload-CbXe_BGH.js";import"./eye-DzS6W6Ng.js";import"./download-CSCs_H3R.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-_ODQH6IG.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-DQZw1vDI.js";import"./plus-Qgyn9Mes.js";import"./grip-vertical-Csp9sNUP.js";import"./trash-2-_2tyqgGh.js";import"./RovingFocusItem-CnHp1cWz.js";import"./VisuallyHiddenInput-Do627rsB.js";const Et={class:"space-y-4"},Tt={key:1,class:"text-center py-8"},Vt={key:3,class:"space-y-6"},At={key:0},jt={class:"text-sm font-medium text-muted-foreground mb-3"},Ut={class:"space-y-3"},Ot={class:"flex items-start gap-3"},It={class:"flex-1"},Ft={class:"flex items-center justify-between"},qt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Dt={class:"flex items-center gap-2 text-muted-foreground"},Nt={class:"flex items-center gap-2 text-muted-foreground"},Bt={class:"flex items-center gap-2 text-muted-foreground"},Lt={key:0,class:"flex items-center gap-2 text-muted-foreground"},Pt={class:"mt-3 text-xs text-muted-foreground"},Rt={key:1},zt={class:"text-sm font-medium text-muted-foreground mb-3"},Mt={class:"space-y-3"},Wt={class:"flex items-start gap-3"},Gt={class:"flex-1"},Jt={class:"flex items-center justify-between"},Kt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Yt={class:"flex items-center gap-2 text-muted-foreground"},Ht={class:"flex items-center gap-2 text-muted-foreground"},Xt={class:"flex items-center gap-2 text-muted-foreground"},Qt={class:"mt-3 text-xs text-muted-foreground"},Zt={key:5,class:"mt-4 p-3 bg-muted/50 rounded-lg"},ea={class:"text-sm text-muted-foreground"},ta=Ke({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(r,{emit:s}){const $=r,U=s,C=H([]),T=H(!1),A=H(null),a=H($.modelValue),y=async()=>{T.value=!0,A.value=null;try{const h=await Qe.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:$.filtrarPorUbicacion,incluir_futuras:!0}});C.value=h.data}catch(h){A.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",h)}finally{T.value=!1}},V=O(()=>{const h={abiertas:[],futuras:[]};return C.value.forEach(p=>{p.estado_temporal==="abierta"?h.abiertas.push(p):p.estado_temporal==="futura"&&h.futuras.push(p)}),h}),B=O(()=>C.value.find(h=>h.id===a.value));se(a,h=>{U("update:modelValue",h)}),se(()=>$.modelValue,h=>{a.value=h});const I=h=>new Date(h).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),D=h=>{switch(h){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},L=h=>{switch(h){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Ye(()=>{y()}),(h,p)=>(u(),_("div",Et,[h.showPostulacionWarning&&a.value?(u(),q(e(_e),{key:0,class:"border-blue-200 bg-blue-50"},{default:c(()=>[i(e(X),{class:"h-4 w-4 text-blue-600"}),i(e(pe),{class:"text-blue-800"},{default:c(()=>p[1]||(p[1]=[k("Postulación Automática")])),_:1}),i(e(me),{class:"text-blue-700"},{default:c(()=>p[2]||(p[2]=[k(' Al enviar este formulario de candidatura, se creará automáticamente una postulación a la convocatoria seleccionada, la cual quedará en estado "Enviada" para revisión administrativa. ')])),_:1})]),_:1})):j("",!0),T.value?(u(),_("div",Tt,p[3]||(p[3]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),l("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):A.value?(u(),q(e(_e),{key:2,variant:"destructive"},{default:c(()=>[i(e(X),{class:"h-4 w-4"}),i(e(pe),null,{default:c(()=>p[4]||(p[4]=[k("Error")])),_:1}),i(e(me),null,{default:c(()=>[k(v(A.value),1)]),_:1})]),_:1})):C.value.length>0?(u(),_("div",Vt,[i(e(kt),{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=f=>a.value=f),disabled:h.disabled},{default:c(()=>[V.value.abiertas.length>0?(u(),_("div",At,[l("h4",jt," Convocatorias Abiertas ("+v(V.value.abiertas.length)+") ",1),l("div",Ut,[(u(!0),_(Y,null,Z(V.value.abiertas,f=>(u(),q(e(oe),{key:f.id,class:M(["cursor-pointer hover:shadow-md transition-shadow",{"ring-2 ring-primary":a.value===f.id}])},{default:c(()=>[i(e(ne),{class:"pb-3"},{default:c(()=>[l("div",Ot,[i(e(ze),{value:f.id.toString(),id:`conv-${f.id}`},null,8,["value","id"]),l("div",It,[l("div",Ft,[i(e(ae),{for:`conv-${f.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[k(v(f.nombre),1)]),_:2},1032,["for"]),i(e(Le),{class:M(D(f.estado_temporal))},{default:c(()=>[k(v(L(f.estado_temporal)),1)]),_:2},1032,["class"])]),i(e(Re),{class:"mt-1"},{default:c(()=>[k(v(f.descripcion),1)]),_:2},1024)])])]),_:2},1024),i(e(de),{class:"pt-0"},{default:c(()=>[l("div",qt,[l("div",Dt,[i(e(ie),{class:"h-4 w-4"}),l("span",null,v(f.cargo.nombre),1)]),l("div",Nt,[i(e(Pe),{class:"h-4 w-4"}),l("span",null,v(f.periodo_electoral.nombre),1)]),l("div",Bt,[i(e(ie),{class:"h-4 w-4"}),l("span",null,v(f.ubicacion),1)]),f.numero_postulaciones!==void 0?(u(),_("div",Lt,[i(e(yt),{class:"h-4 w-4"}),l("span",null,v(f.numero_postulaciones)+" postulaciones",1)])):j("",!0)]),l("div",Pt,[p[5]||(p[5]=l("span",{class:"font-medium"},"Cierre:",-1)),k(" "+v(I(f.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):j("",!0),V.value.futuras.length>0?(u(),_("div",Rt,[l("h4",zt," Próximas Convocatorias ("+v(V.value.futuras.length)+") ",1),l("div",Mt,[(u(!0),_(Y,null,Z(V.value.futuras,f=>(u(),q(e(oe),{key:f.id,class:M(["cursor-pointer hover:shadow-md transition-shadow opacity-90",{"ring-2 ring-primary":a.value===f.id}])},{default:c(()=>[i(e(ne),{class:"pb-3"},{default:c(()=>[l("div",Wt,[i(e(ze),{value:f.id.toString(),id:`conv-${f.id}`},null,8,["value","id"]),l("div",Gt,[l("div",Jt,[i(e(ae),{for:`conv-${f.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[k(v(f.nombre),1)]),_:2},1032,["for"]),i(e(Le),{class:M(D(f.estado_temporal))},{default:c(()=>[k(v(L(f.estado_temporal)),1)]),_:2},1032,["class"])]),i(e(Re),{class:"mt-1"},{default:c(()=>[k(v(f.descripcion),1)]),_:2},1024)])])]),_:2},1024),i(e(de),{class:"pt-0"},{default:c(()=>[l("div",Kt,[l("div",Yt,[i(e(ie),{class:"h-4 w-4"}),l("span",null,v(f.cargo.nombre),1)]),l("div",Ht,[i(e(Pe),{class:"h-4 w-4"}),l("span",null,v(f.periodo_electoral.nombre),1)]),l("div",Xt,[i(e(ie),{class:"h-4 w-4"}),l("span",null,v(f.ubicacion),1)])]),l("div",Qt,[p[6]||(p[6]=l("span",{class:"font-medium"},"Apertura:",-1)),k(" "+v(I(f.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):j("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),q(e(_e),{key:4},{default:c(()=>[i(e(X),{class:"h-4 w-4"}),i(e(pe),null,{default:c(()=>p[7]||(p[7]=[k("Sin convocatorias disponibles")])),_:1}),i(e(me),null,{default:c(()=>p[8]||(p[8]=[k(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),B.value&&!h.disabled?(u(),_("div",Zt,[p[9]||(p[9]=l("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),l("p",ea,v(B.value.nombre),1)])):j("",!0)]))}});var aa=typeof global=="object"&&global&&global.Object===Object&&global,ra=typeof self=="object"&&self&&self.Object===Object&&self,He=aa||ra||Function("return this")(),le=He.Symbol,Xe=Object.prototype,ia=Xe.hasOwnProperty,sa=Xe.toString,te=le?le.toStringTag:void 0;function oa(r){var s=ia.call(r,te),$=r[te];try{r[te]=void 0;var U=!0}catch{}var C=sa.call(r);return U&&(s?r[te]=$:delete r[te]),C}var da=Object.prototype,na=da.toString;function la(r){return na.call(r)}var ua="[object Null]",ca="[object Undefined]",We=le?le.toStringTag:void 0;function fa(r){return r==null?r===void 0?ca:ua:We&&We in Object(r)?oa(r):la(r)}function ma(r){return r!=null&&typeof r=="object"}var _a="[object Symbol]";function pa(r){return typeof r=="symbol"||ma(r)&&fa(r)==_a}var ga=/\s/;function va(r){for(var s=r.length;s--&&ga.test(r.charAt(s)););return s}var ba=/^\s+/;function ya(r){return r&&r.slice(0,va(r)+1).replace(ba,"")}function ve(r){var s=typeof r;return r!=null&&(s=="object"||s=="function")}var Ge=NaN,ha=/^[-+]0x[0-9a-f]+$/i,xa=/^0b[01]+$/i,ka=/^0o[0-7]+$/i,Sa=parseInt;function Je(r){if(typeof r=="number")return r;if(pa(r))return Ge;if(ve(r)){var s=typeof r.valueOf=="function"?r.valueOf():r;r=ve(s)?s+"":s}if(typeof r!="string")return r===0?r:+r;r=ya(r);var $=xa.test(r);return $||ka.test(r)?Sa(r.slice(2),$?2:8):ha.test(r)?Ge:+r}var ge=function(){return He.Date.now()},$a="Expected a function",Ca=Math.max,wa=Math.min;function Ea(r,s,$){var U,C,T,A,a,y,V=0,B=!1,I=!1,D=!0;if(typeof r!="function")throw new TypeError($a);s=Je(s)||0,ve($)&&(B=!!$.leading,I="maxWait"in $,T=I?Ca(Je($.maxWait)||0,s):T,D="trailing"in $?!!$.trailing:D);function L(x){var F=U,g=C;return U=C=void 0,V=x,A=r.apply(g,F),A}function h(x){return V=x,a=setTimeout(P,s),B?L(x):A}function p(x){var F=x-y,g=x-V,w=s-F;return I?wa(w,T-g):w}function f(x){var F=x-y,g=x-V;return y===void 0||F>=s||F<0||I&&g>=T}function P(){var x=ge();if(f(x))return G(x);a=setTimeout(P,p(x))}function G(x){return a=void 0,D&&U?L(x):(U=C=void 0,A)}function K(){a!==void 0&&clearTimeout(a),V=0,U=y=C=a=void 0}function z(){return a===void 0?A:G(ge())}function J(){var x=ge(),F=f(x);if(U=arguments,C=this,y=x,F){if(a===void 0)return h(y);if(I)return clearTimeout(a),a=setTimeout(P,s),L(y)}return a===void 0&&(a=setTimeout(P,s)),A}return J.cancel=K,J.flush=z,J}function Ta(r,s){const{url:$,candidaturaId:U=null,debounceTime:C=3e3,showNotifications:T=!0,useLocalStorage:A=!0,localStorageKey:a="candidatura_draft"}=s,y=H({status:"idle",lastSaved:null,lastError:null,candidaturaId:U}),V=O(()=>y.value.status==="saving"),B=O(()=>y.value.lastSaved!==null),I=O(()=>y.value.status==="error"),D=()=>{if(A)try{const g={formulario_data:r.value,timestamp:new Date().toISOString(),candidaturaId:y.value.candidaturaId};localStorage.setItem(a,JSON.stringify(g))}catch(g){console.error("Error guardando en localStorage:",g)}},L=()=>{if(!A)return null;try{const g=localStorage.getItem(a);if(g){const w=JSON.parse(g),R=new Date(w.timestamp);if((Date.now()-R.getTime())/(1e3*60*60)<24)return w;localStorage.removeItem(a)}}catch(g){console.error("Error cargando desde localStorage:",g)}return null},h=()=>{A&&localStorage.removeItem(a)},p=async()=>{try{const g=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(g.ok){const w=await g.text(),E=new DOMParser().parseFromString(w,"text/html").querySelector('meta[name="csrf-token"]');if(E){const Q=E.getAttribute("content"),ee=document.querySelector('meta[name="csrf-token"]');if(ee&&Q)return ee.setAttribute("content",Q),Q}}}catch(g){console.error("Error renovando token CSRF:",g)}return null},f=async(g,w,R=0)=>{const N=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":w,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:r.value})});if(N.status===419&&R<1){const E=await p();if(E)return T&&W.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),f(g,E,R+1)}return N},P=async()=>{var g;if(y.value.status!=="saving"&&!(!r.value||Object.keys(r.value).length===0)){y.value.status="saving",y.value.lastError=null;try{const w=y.value.candidaturaId?$.replace("autosave",`${y.value.candidaturaId}/autosave`):$,R=((g=document.querySelector('meta[name="csrf-token"]'))==null?void 0:g.getAttribute("content"))||"";if(!R)throw new Error("Token CSRF no encontrado");const N=await f(w,R);if(!N.ok)throw new Error(`Error ${N.status}: ${N.statusText}`);const E=await N.json();if(E.success)y.value.status="saved",y.value.lastSaved=new Date,!y.value.candidaturaId&&E.candidatura_id&&(y.value.candidaturaId=E.candidatura_id),D(),T&&W.success("Cambios guardados",{description:`Autoguardado a las ${E.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(E.message||"Error al guardar")}catch(w){y.value.status="error",y.value.lastError=w instanceof Error?w.message:"Error desconocido",D(),w instanceof Error&&w.message.includes("419")?T&&W.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):T&&W.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",w)}}},G=Ea(P,C),K=()=>(G.cancel(),P()),z=()=>se(r,()=>{y.value.status!=="error"&&G()},{deep:!0}),J=()=>{G.cancel()},x=()=>{J(),y.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:U},h()},F=()=>{const g=L();return g&&g.formulario_data?(T&&W.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),g):null};return{state:O(()=>y.value),isSaving:V,hasSaved:B,hasError:I,saveNow:K,startWatching:z,stopAutoSave:J,reset:x,restoreDraft:F,clearLocalStorage:h}}const Va={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Aa={class:"flex items-center justify-between"},ja={class:"text-3xl font-bold"},Ua={class:"text-muted-foreground"},Oa={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Ia={key:0,class:"flex items-center gap-1.5"},Fa={key:1,class:"flex items-center gap-1.5"},qa={key:2,class:"flex items-center gap-1.5 text-amber-600"},Da={key:3,class:"flex items-center gap-1.5"},Na={class:"text-blue-700 dark:text-blue-300"},Ba={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},La={class:"flex items-start gap-3"},Pa={class:"text-sm text-blue-800"},Ra={key:0,class:"mt-1 text-blue-600"},za={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},Ma={class:"flex items-start gap-3"},Wa={key:0,class:"text-red-500"},Ga={key:0,class:"text-sm text-muted-foreground"},Ja={key:6,class:"space-y-2"},Ka=["id","name","value","onUpdate:modelValue"],Ya={key:7,class:"space-y-2"},Ha={key:8},Xa={key:9},Qa={key:0,class:"text-red-500 text-sm mt-1"},Za={key:10},er={key:11},tr={key:12},ar={key:13,class:"text-sm text-destructive"},rr={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},ir={class:"text-red-800 text-sm"},sr={class:"flex justify-between pt-6"},or=Ke({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(r){var Q,ee;const s=r,$=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:s.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:U}=mt(),C=H({}),T=O(()=>{var S;if(!s.is_editing||!((S=s.candidatura)!=null&&S.formulario_data))return!1;const d=Object.keys(s.candidatura.formulario_data),n=s.configuracion_campos.map(t=>t.id),o=d.some(t=>!n.includes(t)),b=s.configuracion_campos.some(t=>t.required&&!s.candidatura.formulario_data[t.id]);return o||b}),a=Ze((()=>{var n;const d={};return s.configuracion_campos.forEach(o=>{o.type==="checkbox"?d[o.id]=[]:o.type==="file"?d[o.id]=[]:o.type==="convocatoria"?d[o.id]=void 0:o.type==="disclaimer"?d[o.id]=null:o.type==="repeater"?d[o.id]=[]:o.type==="datepicker"?d[o.id]=null:d[o.id]=""}),(n=s.candidatura)!=null&&n.formulario_data&&(Object.assign(d,s.candidatura.formulario_data),s.configuracion_campos.forEach(o=>{o.type==="file"&&d[o.id]&&(Array.isArray(d[o.id])||(d[o.id]=[d[o.id]]))})),{formulario_data:d}})()),y=H(s.configuracion_campos),V=O(()=>a.formulario_data),{visibleFields:B,clearHiddenFieldValues:I}=_t(y,V);se(B,()=>{I()});const{state:D,isSaving:L,hasSaved:h,hasError:p,startWatching:f,stopAutoSave:P,restoreDraft:G,clearLocalStorage:K}=Ta(V,{url:"/candidaturas/autosave",candidaturaId:((Q=s.candidatura)==null?void 0:Q.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((ee=s.candidatura)==null?void 0:ee.id)||"new"}`});let z=null;Ye(()=>{const d=["borrador","rechazado"];if(!s.candidatura||d.includes(s.candidatura.estado)){if(!s.is_editing){const o=G();o&&o.formulario_data&&(W.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{K(),a.reset(),W.success("Borrador descartado")}},duration:5e3}),Object.assign(a.formulario_data,o.formulario_data))}z=f()}}),et(()=>{z&&z(),P()});const J=O(()=>g.value.map(o=>{var t;if(!o.required)return{campo:o.id,valid:!0};const b=a.formulario_data[o.id];let S=!1;if(o.type==="checkbox")S=Array.isArray(b)&&b.length>0;else if(o.type==="file")(Array.isArray(b)&&b.length>0||C.value[o.id]&&C.value[o.id].length>0)&&(S=!0);else if(o.type==="convocatoria")S=b!=null&&b!=="";else if(o.type==="disclaimer")S=b&&b.accepted===!0;else if(o.type==="repeater"){const re=((t=o.repeaterConfig)==null?void 0:t.minItems)||0;S=Array.isArray(b)&&b.length>=re}else o.type==="datepicker"?S=b!=null&&b!=="":S=b&&b.toString().trim()!=="";return!S&&o.required,{campo:o.id,valid:S}}).every(o=>o.valid)),x=O(()=>s.is_editing?"Editar Candidatura":"Crear Candidatura"),F=O(()=>{var d,n;return a.processing?"Guardando...":s.is_editing?((d=s.candidatura)==null?void 0:d.estado)==="rechazado"?"Reenviar Candidatura":((n=s.candidatura)==null?void 0:n.estado)==="aprobado"?"Solicitar Revisión":"Actualizar Candidatura":"Crear Candidatura"}),g=O(()=>{var n;let d=[...B.value];return s.is_editing&&s.candidatura&&["pendiente","aprobado"].includes(s.candidatura.estado)&&(d=d.filter(b=>b.type!=="convocatoria")),s.is_editing&&((n=s.candidatura)==null?void 0:n.estado)==="aprobado"&&(d=d.filter(o=>o.editable===!0)),d}),w=O(()=>{var o;if(!s.is_editing||!s.candidatura)return!1;let d=!1;if(["pendiente","aprobado"].includes(s.candidatura.estado)&&(d=s.configuracion_campos.some(b=>b.type==="convocatoria")),((o=s.candidatura)==null?void 0:o.estado)==="aprobado"){const b=s.configuracion_campos.some(S=>!S.editable&&S.type!=="convocatoria");return d||b}return d}),R=(d,n)=>{C.value[d]=n,a.formulario_data[d]=[...a.formulario_data[d]||[]]},N=async()=>{for(const[n,o]of Object.entries(C.value))if(o&&o.length>0)try{const b=await U(o,{module:"candidaturas",fieldId:n});a.formulario_data[n]=b.map(S=>S.path),C.value[n]=[]}catch(b){console.error("Error al subir archivos:",b);return}const d={...a.formulario_data};s.configuracion_campos.forEach(n=>{const o=d[n.id];n.required||(o===""||o===void 0||Array.isArray(o)&&o.length===0&&n.type!=="checkbox"&&n.type!=="file")&&(d[n.id]=null)}),a.formulario_data=d,P(),s.is_editing?a.put(`/candidaturas/${s.candidatura.id}`,{onSuccess:()=>{K(),W.success("Candidatura actualizada exitosamente")},onError:n=>{console.error("Errores de validación:",n),(!s.candidatura||["borrador","rechazado"].includes(s.candidatura.estado))&&(z=f())}}):a.post("/candidaturas",{onSuccess:()=>{K(),W.success("Candidatura creada exitosamente")},onError:n=>{console.error("Errores de validación:",n),z=f()}})},E=d=>!!a.errors[`formulario_data.${d}`];return(d,n)=>(u(),_(Y,null,[i(e(tt),{title:x.value},null,8,["title"]),i(ht,{breadcrumbs:$},{default:c(()=>{var o,b;return[l("div",Va,[l("div",Aa,[l("div",null,[l("h1",ja,v(x.value),1),l("p",Ua,v(d.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),i(e(ce),{variant:"outline",onClick:n[0]||(n[0]=S=>d.$inertia.visit("/candidaturas"))},{default:c(()=>[i(e(St),{class:"mr-2 h-4 w-4"}),n[2]||(n[2]=k(" Volver "))]),_:1})]),!d.candidatura||["borrador","rechazado"].includes(d.candidatura.estado)?(u(),_("div",Oa,[e(L)?(u(),_("div",Ia,[i(e(Me),{class:"h-4 w-4 animate-spin"}),n[3]||(n[3]=l("span",null,"Guardando automáticamente...",-1))])):e(h)&&!e(p)?(u(),_("div",Fa,[i(e($t),{class:"h-4 w-4 text-green-600"}),l("span",null,"Guardado automáticamente a las "+v((o=e(D).lastSaved)==null?void 0:o.toLocaleTimeString()),1)])):e(p)?(u(),_("div",qa,[i(e(X),{class:"h-4 w-4"}),n[4]||(n[4]=l("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),_("div",Da,[i(e(Me),{class:"h-4 w-4"}),n[5]||(n[5]=l("span",null,"Autoguardado activado",-1))]))])):j("",!0),d.is_editing&&((b=d.candidatura)!=null&&b.comentarios_admin)?(u(),q(e(oe),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:c(()=>[i(e(ne),null,{default:c(()=>[i(e(Be),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:c(()=>[i(e(X),{class:"h-5 w-5"}),n[6]||(n[6]=k(" Comentarios de la comisión "))]),_:1})]),_:1}),i(e(de),null,{default:c(()=>[l("p",Na,v(d.candidatura.comentarios_admin),1)]),_:1})]),_:1})):j("",!0),i(e(oe),null,{default:c(()=>[i(e(ne),null,{default:c(()=>[i(e(Be),{class:"flex items-center gap-2"},{default:c(()=>[i(e(Ct),{class:"h-5 w-5"}),n[7]||(n[7]=k(" Información de Candidatura "))]),_:1})]),_:1}),i(e(de),null,{default:c(()=>{var S;return[l("form",{onSubmit:at(N,["prevent"]),class:"space-y-6"},[d.is_editing&&((S=d.candidatura)==null?void 0:S.estado)==="aprobado"?(u(),_("div",Ba,[l("div",La,[i(e(X),{class:"h-5 w-5 text-blue-600 mt-0.5"}),l("div",Pa,[n[8]||(n[8]=l("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),n[9]||(n[9]=l("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),w.value?(u(),_("p",Ra," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):j("",!0)])])])):j("",!0),T.value?(u(),_("div",za,[l("div",Ma,[i(e(X),{class:"h-5 w-5 text-amber-600 mt-0.5"}),n[10]||(n[10]=l("div",{class:"text-sm text-amber-800"},[l("p",{class:"font-medium"},"Formulario Actualizado"),l("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):j("",!0),i(rt,{name:"fade-field",tag:"div",class:"space-y-6"},{default:c(()=>[(u(!0),_(Y,null,Z(g.value,t=>{var re,be,ye,he,xe,ke,Se,$e,Ce,we,Ee,Te,Ve,Ae,je,Ue,Oe,Ie,Fe,qe,De;return u(),_("div",{key:t.id,class:"space-y-2"},[i(e(ae),{for:t.id,class:"flex items-center gap-1"},{default:c(()=>[k(v(t.title)+" ",1),t.required?(u(),_("span",Wa,"*")):j("",!0)]),_:2},1032,["for"]),t.description?(u(),_("p",Ga,v(t.description),1)):j("",!0),t.type==="text"||t.type==="email"?(u(),q(e(fe),{key:1,id:t.id,type:t.type,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,placeholder:t.placeholder||"",class:M({"border-destructive":E(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(u(),q(e(ft),{key:2,id:t.id,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,placeholder:t.placeholder||"",rows:4,class:M({"border-destructive":E(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(u(),q(e(fe),{key:3,id:t.id,type:"number",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,placeholder:t.placeholder||"",class:M({"border-destructive":E(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(u(),q(e(fe),{key:4,id:t.id,type:"date",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,class:M({"border-destructive":E(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(u(),q(e(dt),{key:5,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m},{default:c(()=>[i(e(nt),{class:M({"border-destructive":E(t.id)})},{default:c(()=>[i(e(lt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),i(e(ut),null,{default:c(()=>[(u(!0),_(Y,null,Z(t.options,m=>(u(),q(e(ct),{key:m,value:m},{default:c(()=>[k(v(m),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(u(),_("div",Ja,[(u(!0),_(Y,null,Z(t.options,m=>(u(),_("div",{key:m,class:"flex items-center space-x-2"},[it(l("input",{id:`${t.id}_${m}`,name:t.id,type:"radio",value:m,"onUpdate:modelValue":ue=>e(a).formulario_data[t.id]=ue,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Ka),[[st,e(a).formulario_data[t.id]]]),i(e(ae),{for:`${t.id}_${m}`,class:"text-sm font-normal"},{default:c(()=>[k(v(m),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(u(),_("div",Ya,[(u(!0),_(Y,null,Z(t.options,m=>(u(),_("div",{key:m,class:"flex items-center space-x-2"},[i(e(ot),{id:`${t.id}_${m}`,checked:e(a).formulario_data[t.id].includes(m),"onUpdate:checked":ue=>{if(ue)e(a).formulario_data[t.id].includes(m)||e(a).formulario_data[t.id].push(m);else{const Ne=e(a).formulario_data[t.id].indexOf(m);Ne>-1&&e(a).formulario_data[t.id].splice(Ne,1)}}},null,8,["id","checked","onUpdate:checked"]),i(e(ae),{for:`${t.id}_${m}`,class:"text-sm font-normal"},{default:c(()=>[k(v(m),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(u(),_("div",Ha,[i(pt,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,onFilesSelected:m=>R(t.id,m),label:"",description:"",required:t.required,multiple:((re=t.fileConfig)==null?void 0:re.multiple)||!1,"max-files":((be=t.fileConfig)==null?void 0:be.maxFiles)||5,"max-file-size":((ye=t.fileConfig)==null?void 0:ye.maxFileSize)||10,accept:((he=t.fileConfig)==null?void 0:he.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(a).errors[`formulario_data.${t.id}`],disabled:e(a).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(u(),_("div",Xa,[i(ta,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,required:t.required,disabled:e(a).processing||d.is_editing&&((xe=d.candidatura)==null?void 0:xe.estado)!=="borrador","filtrar-por-ubicacion":((ke=t.convocatoriaConfig)==null?void 0:ke.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),E(t.id)?(u(),_("div",Qa,v(e(a).errors[`formulario_data.${t.id}`]),1)):j("",!0)])):t.type==="datepicker"?(u(),_("div",Za,[i(gt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-date":(Se=t.datepickerConfig)==null?void 0:Se.minDate,"max-date":($e=t.datepickerConfig)==null?void 0:$e.maxDate,format:((Ce=t.datepickerConfig)==null?void 0:Ce.format)||"DD/MM/YYYY","allow-past-dates":((we=t.datepickerConfig)==null?void 0:we.allowPastDates)??!0,"allow-future-dates":((Ee=t.datepickerConfig)==null?void 0:Ee.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(u(),_("div",er,[i(vt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"disclaimer-text":((Te=t.disclaimerConfig)==null?void 0:Te.disclaimerText)||"","modal-title":((Ve=t.disclaimerConfig)==null?void 0:Ve.modalTitle)||"Términos y Condiciones","accept-button-text":((Ae=t.disclaimerConfig)==null?void 0:Ae.acceptButtonText)||"Acepto","decline-button-text":((je=t.disclaimerConfig)==null?void 0:je.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(u(),_("div",tr,[i(bt,{"model-value":e(a).formulario_data[t.id]||[],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-items":((Ue=t.repeaterConfig)==null?void 0:Ue.minItems)||0,"max-items":((Oe=t.repeaterConfig)==null?void 0:Oe.maxItems)||10,"item-name":((Ie=t.repeaterConfig)==null?void 0:Ie.itemName)||"Elemento","add-button-text":((Fe=t.repeaterConfig)==null?void 0:Fe.addButtonText)||"Agregar elemento","remove-button-text":((qe=t.repeaterConfig)==null?void 0:qe.removeButtonText)||"Eliminar",fields:((De=t.repeaterConfig)==null?void 0:De.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):j("",!0),E(t.id)?(u(),_("p",ar,v(e(a).errors[`formulario_data.${t.id}`]),1)):j("",!0)])}),128))]),_:1}),e(a).errors.general?(u(),_("div",rr,[l("p",ir,v(e(a).errors.general),1)])):j("",!0),l("div",sr,[i(e(ce),{variant:"outline",type:"button",onClick:n[1]||(n[1]=t=>d.$inertia.visit("/candidaturas"))},{default:c(()=>n[11]||(n[11]=[k(" Cancelar ")])),_:1}),i(e(ce),{type:"submit",disabled:!J.value||e(a).processing},{default:c(()=>[i(e(wt),{class:"mr-2 h-4 w-4"}),k(" "+v(F.value),1)]),_:1},8,["disabled"])])],32)]}),_:1})]),_:1})])]}),_:1})],64))}}),Xr=xt(or,[["__scopeId","data-v-54a7c930"]]);export{Xr as default};
