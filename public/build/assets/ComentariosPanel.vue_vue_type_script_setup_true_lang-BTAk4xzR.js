import{r as M,c as q,d as Z,i as b,e as s,g as _,f as e,t as E,m as a,p as ke,b as R,w as c,j as $,n as J,h as P,F as N,k as G,x as ue,I as Me,o as Se}from"./app-Bf6d3A8V.js";import{_ as we,c as Ce,a as Pe,b as je}from"./CardTitle.vue_vue_type_script_setup_true_lang-CWsLvUG8.js";import{_ as Te}from"./CardDescription.vue_vue_type_script_setup_true_lang-CHxShqt8.js";import{c as se,_ as I}from"./createLucideIcon-YOpGmVvB.js";import{_ as ve}from"./Skeleton.vue_vue_type_script_setup_true_lang-DMIwX4UJ.js";import{C as be,_ as ze,a as qe,b as Ie,c as Le,d as Ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-BCxhgvZ-.js";import{R as Ue}from"./RichTextEditor-BA7itXx5.js";import{_ as Be}from"./FileUploadField.vue_vue_type_script_setup_true_lang-D_6WHXMz.js";import{X as Ve}from"./x-CY3swbP8.js";import{P as De}from"./paperclip-DtCUnI6o.js";import{L as Xe}from"./loader-circle-BqoIAG-c.js";import{S as Fe}from"./send-Ct-MIBzO.js";import{b as Ne,_ as Oe}from"./index-Bl_xx9UH.js";import{_ as de}from"./index-BnkuBoco.js";import{b as He,c as Qe,g as _e,d as We}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Lr2SO7Rm.js";import{_ as Ke,a as Ge,b as Je}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CQC7ii_W.js";import{e as Ze,_ as Ye,a as et,b as tt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BB-dSUA7.js";import{E as at}from"./external-link-DnyNl7_t.js";import{D as he}from"./download-CE6qY2cb.js";import{I as st}from"./image-D7z2e-kU.js";import{F as ot}from"./file-text-dmr_h2lM.js";import{A as nt}from"./arrow-right-DUfmRT-L.js";import{C as rt}from"./clock-DkGIQVTd.js";import{M as xe}from"./message-square-DGcAUHzs.js";import{E as lt}from"./ellipsis-8byiH7oD.js";import{S as it}from"./square-pen-DOvbviun.js";import{T as ct}from"./trash-2-B2RPIbPy.js";import{C as $e}from"./chevron-right-BSaBhVvo.js";import{t as O}from"./index-B7Xm9lmr.js";import{C as ut}from"./chevron-left-r7y96DzQ.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=se("ArrowUpDownIcon",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=se("ChevronsLeftIcon",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=se("ChevronsRightIcon",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=se("FileSpreadsheetIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=se("QuoteIcon",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=se("SmilePlusIcon",[["path",{d:"M22 11v1a10 10 0 1 1-9-10",key:"ew0xw9"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}],["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}]]);function vt(t,j,v={}){const{paginaInicial:p=1,urlParam:S="pagina",sincronizarUrl:w=!0}=v,h=M([]),u=M(!1),x=M(null),r=M(p),k=M(1),d=M(0),V=M(0),B=M(0),T=M([]),C=M("recientes"),D={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},X=`/api/comentarios/${t}/${j}`,oe=m=>{if(!w)return;const y=new URL(window.location.href);m>1?y.searchParams.set(S,String(m)):y.searchParams.delete(S),window.history.replaceState({},"",y.toString())},W=async(m,y=!0)=>{const l=m??r.value;u.value=!0,x.value=null;try{const i=new URLSearchParams({page:String(l),sort:C.value}),o=await(await fetch(`${X}?${i}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();if(o.success&&o.data)h.value=o.data.data,r.value=o.data.current_page,k.value=o.data.last_page,d.value=o.data.total,V.value=o.data.from||0,B.value=o.data.to||0,T.value=o.data.links||[],y&&oe(l);else throw new Error(o.message||"Error al cargar comentarios")}catch(i){x.value=i instanceof Error?i.message:"Error desconocido",console.error("Error cargando comentarios:",i)}finally{u.value=!1}},te=async m=>{m!==C.value&&(C.value=m,await W(1))},ae=async m=>{m>=1&&m<=k.value&&m!==r.value&&await W(m)},ne=async()=>{r.value<k.value&&await W(r.value+1)},re=async()=>{r.value>1&&await W(r.value-1)},le=async m=>{u.value=!0,x.value=null;try{const l=await(await fetch(X,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin",body:JSON.stringify(m)})).json();return l.success&&l.comentario&&(m.parent_id?F(m.parent_id,l.comentario):(h.value=[l.comentario,...h.value],d.value++)),l}catch(y){const l=y instanceof Error?y.message:"Error al crear comentario";return x.value=l,{success:!1,message:l}}finally{u.value=!1}},ie=async(m,y)=>{u.value=!0,x.value=null;try{const i=await(await fetch(`/api/comentarios/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin",body:JSON.stringify(y)})).json();return i.success&&i.comentario&&U(i.comentario),i}catch(l){const i=l instanceof Error?l.message:"Error al actualizar comentario";return x.value=i,{success:!1,message:i}}finally{u.value=!1}},ce=async m=>{u.value=!0,x.value=null;try{const l=await(await fetch(`/api/comentarios/${m}`,{method:"DELETE",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin"})).json();return l.success&&(K(m),d.value--),l}catch(y){const l=y instanceof Error?y.message:"Error al eliminar comentario";return x.value=l,{success:!1,message:l}}finally{u.value=!1}},L=async(m,y)=>{try{const i=await(await fetch(`/api/comentarios/${m}/reaccion`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin",body:JSON.stringify({emoji:y})})).json();return i.success&&i.reacciones&&Y(m,i.reacciones),i}catch(l){return{success:!1,message:l instanceof Error?l.message:"Error al agregar reacciÃ³n"}}},f=async(m,y=0,l=10)=>{try{const i=new URLSearchParams({offset:String(y),limit:String(l)}),o=await(await fetch(`/api/comentarios/${m}/respuestas?${i}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();return o.success&&o.data&&Q(m,o.data),o}catch(i){return{success:!1,message:i instanceof Error?i.message:"Error al cargar respuestas"}}},A=()=>{var y;return((y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content"))||""},z=m=>m.respuestas||m.respuestas_limitadas||[],F=(m,y)=>{const l=i=>{for(const n of i){if(n.id===m){!n.respuestas&&!n.respuestas_limitadas&&(n.respuestas=[]);const g=n.respuestas||n.respuestas_limitadas;return g==null||g.push(y),!0}const o=z(n);if(o.length>0&&l(o))return!0}return!1};l(h.value)},Q=(m,y)=>{const l=i=>{for(const n of i){if(n.id===m){!n.respuestas&&!n.respuestas_limitadas&&(n.respuestas=[]);const g=n.respuestas||n.respuestas_limitadas;return g&&g.push(...y),n.total_respuestas_anidadas!==void 0&&(n.total_respuestas_anidadas=Math.max(0,n.total_respuestas_anidadas-y.length)),!0}const o=z(n);if(o.length>0&&l(o))return!0}return!1};l(h.value)},U=m=>{const y=l=>{for(let i=0;i<l.length;i++){if(l[i].id===m.id)return l[i]={...m,respuestas:l[i].respuestas,respuestas_limitadas:l[i].respuestas_limitadas},!0;const n=z(l[i]);if(n.length>0&&y(n))return!0}return!1};y(h.value)},K=m=>{const y=l=>l.filter(i=>i.id!==m).map(i=>(z(i),{...i,respuestas:i.respuestas?y(i.respuestas):void 0,respuestas_limitadas:i.respuestas_limitadas?y(i.respuestas_limitadas):void 0}));h.value=y(h.value)},Y=(m,y)=>{const l=i=>{for(const n of i){if(n.id===m)return n.reacciones_resumen=y,!0;const o=z(n);if(o.length>0&&l(o))return!0}return!1};l(h.value)},me=q(()=>h.value.length>0),fe=q(()=>k.value>1),pe=q(()=>r.value>1),ge=q(()=>r.value<k.value);return{comentarios:h,loading:u,error:x,currentPage:r,lastPage:k,total:d,from:V,to:B,links:T,emojis:D,sortBy:C,tieneComentarios:me,tienePaginacion:fe,puedePaginaAnterior:pe,puedePaginaSiguiente:ge,cargar:W,irAPagina:ae,paginaSiguiente:ne,paginaAnterior:re,crear:le,editar:ie,eliminar:ce,toggleReaccion:L,cambiarOrden:te,cargarRespuestasAdicionales:f}}const ht={class:"flex items-start gap-2 p-3 bg-muted/50 rounded-md border-l-4 border-primary/30 text-sm"},xt={class:"flex-1 min-w-0"},yt={class:"flex items-center gap-2 mb-1"},bt={class:"font-medium text-xs"},_t={class:"text-xs text-muted-foreground"},kt=["innerHTML"],Ee=Z({__name:"ComentarioQuote",props:{comentario:{}},setup(t){return(j,v)=>{var p;return a(),b("div",ht,[s(e(Re),{class:"h-4 w-4 text-muted-foreground flex-shrink-0 mt-0.5"}),_("div",xt,[_("div",yt,[_("span",bt,E(((p=t.comentario.autor)==null?void 0:p.name)||"Usuario"),1),_("span",_t,E(t.comentario.fecha_relativa),1)]),_("p",{class:"text-muted-foreground line-clamp-2",innerHTML:t.comentario.contenido_truncado||t.comentario.contenido_plain},null,8,kt)])])}}}),wt={key:1,class:"flex items-center gap-2 text-sm text-muted-foreground"},Ct={class:"font-medium"},$t={key:2,class:"mt-2"},Rt={class:"flex items-center justify-between gap-2"},Et={class:"text-xs"},Mt={class:"flex items-center gap-2"},ye=Z({__name:"ComentarioForm",props:{mode:{default:"create"},comentarioEditar:{default:null},comentarioCitar:{default:null},comentarioResponder:{default:null},loading:{type:Boolean,default:!1},placeholder:{default:"Escribe un comentario..."}},emits:["submit","cancel"],setup(t,{expose:j,emit:v}){const p=t,S=v,w=M(""),h=M([]),u=M(!1);ke(()=>p.comentarioEditar,T=>{T&&(w.value=T.contenido,T.archivos_info&&T.archivos_info.length>0&&(h.value=T.archivos_info.map((C,D)=>({id:`existing_${D}`,name:C.nombre,size:0,path:C.path,url:C.url,mime_type:C.tipo,uploaded_at:""})),u.value=!0))},{immediate:!0});const x=q(()=>{switch(p.mode){case"edit":return"Guardar cambios";case"reply":return"Responder";case"quote":return"Comentar";default:return"Comentar"}}),r=q(()=>{var T,C;switch(p.mode){case"reply":return`Responder a ${((C=(T=p.comentarioResponder)==null?void 0:T.autor)==null?void 0:C.name)||"usuario"}...`;case"quote":return"Escribe tu comentario sobre la cita...";default:return p.placeholder}}),k=q(()=>w.value.replace(/<[^>]*>/g,"").trim().length>0),d=()=>{var D,X;if(!k.value||p.loading)return;const T=p.mode==="reply"&&((D=p.comentarioResponder)==null?void 0:D.id)||null,C=p.mode==="quote"&&((X=p.comentarioCitar)==null?void 0:X.id)||null;S("submit",w.value,T,C,h.value),p.mode!=="edit"&&(w.value="",h.value=[],u.value=!1)},V=()=>{w.value="",h.value=[],u.value=!1,S("cancel")},B=()=>{u.value=!u.value};return j({clear:()=>{w.value="",h.value=[],u.value=!1}}),(T,C)=>(a(),R(e(we),{class:"border-0 shadow-none"},{default:c(()=>[s(e(Ce),{class:"p-0 space-y-3"},{default:c(()=>{var D;return[t.mode==="quote"&&t.comentarioCitar?(a(),R(Ee,{key:0,comentario:t.comentarioCitar},null,8,["comentario"])):$("",!0),t.mode==="reply"&&t.comentarioResponder?(a(),b("div",wt,[C[2]||(C[2]=_("span",null,"Respondiendo a",-1)),_("span",Ct,E((D=t.comentarioResponder.autor)==null?void 0:D.name),1),s(e(I),{variant:"ghost",size:"sm",class:"h-5 w-5 p-0 ml-auto",onClick:V},{default:c(()=>[s(e(Ve),{class:"h-3 w-3"})]),_:1})])):$("",!0),s(Ue,{modelValue:w.value,"onUpdate:modelValue":C[0]||(C[0]=X=>w.value=X),placeholder:r.value,rows:3},null,8,["modelValue","placeholder"]),u.value?(a(),b("div",$t,[s(Be,{modelValue:h.value,"onUpdate:modelValue":C[1]||(C[1]=X=>h.value=X),label:"Archivos adjuntos",description:"MÃ¡ximo 3 archivos de 10MB cada uno",module:"comentarios","field-id":"archivos",multiple:!0,"max-files":3,"max-file-size":10,accept:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.xls,.xlsx","auto-upload":!0},null,8,["modelValue"])])):$("",!0),_("div",Rt,[s(e(I),{variant:"ghost",size:"sm",type:"button",onClick:B,class:J({"text-primary":u.value||h.value.length>0}),title:"Adjuntar archivos"},{default:c(()=>[s(e(De),{class:"h-4 w-4 mr-1"}),_("span",Et,[C[3]||(C[3]=P(" Adjuntar archivos ",-1)),h.value.length>0?(a(),b(N,{key:0},[P("("+E(h.value.length)+")",1)],64)):$("",!0)])]),_:1},8,["class"]),_("div",Mt,[t.mode!=="create"?(a(),R(e(I),{key:0,variant:"ghost",size:"sm",onClick:V,disabled:t.loading},{default:c(()=>[...C[4]||(C[4]=[P(" Cancelar ",-1)])]),_:1},8,["disabled"])):$("",!0),s(e(I),{size:"sm",onClick:d,disabled:!k.value||t.loading},{default:c(()=>[t.loading?(a(),R(e(Xe),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):(a(),R(e(Fe),{key:1,class:"h-4 w-4 mr-2"})),P(" "+E(x.value),1)]),_:1},8,["disabled"])])])]}),_:1})]),_:1}))}}),St={class:"flex items-center gap-1.5 flex-wrap"},Pt={class:"text-muted-foreground"},jt={class:"flex gap-1"},Tt=Z({__name:"ComentarioReacciones",props:{reacciones:{default:()=>[]},canReact:{type:Boolean,default:!0}},emits:["toggle"],setup(t,{emit:j}){const v=t,p=j,S={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},w=M(!1),h=q(()=>[...v.reacciones].sort((r,k)=>k.count-r.count)),u=r=>{const k=v.reacciones.find(d=>d.emoji===r);return(k==null?void 0:k.usuario_actual_reacciono)||!1},x=r=>{p("toggle",r),w.value=!1};return(r,k)=>(a(),b("div",St,[(a(!0),b(N,null,G(h.value,d=>(a(),R(e(I),{key:d.emoji,variant:"ghost",size:"sm",class:J(["h-7 px-2 text-xs gap-1",{"bg-primary/10 hover:bg-primary/20":d.usuario_actual_reacciono}]),onClick:V=>x(d.emoji),disabled:!t.canReact},{default:c(()=>[_("span",null,E(d.simbolo),1),_("span",Pt,E(d.count),1)]),_:2},1032,["class","onClick","disabled"]))),128)),t.canReact?(a(),R(e(Ke),{key:0,open:w.value,"onUpdate:open":k[0]||(k[0]=d=>w.value=d)},{default:c(()=>[s(e(Ge),{asChild:""},{default:c(()=>[s(e(I),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:c(()=>[s(e(gt),{class:"h-4 w-4 text-muted-foreground"})]),_:1})]),_:1}),s(e(Je),{class:"w-auto p-2",align:"start"},{default:c(()=>[_("div",jt,[(a(),b(N,null,G(S,(d,V)=>s(e(I),{key:V,variant:"ghost",size:"sm",class:J(["h-8 w-8 p-0 text-lg hover:scale-125 transition-transform",{"bg-primary/10":u(V)}]),onClick:B=>x(V)},{default:c(()=>[P(E(d),1)]),_:2},1032,["class","onClick"])),64))])]),_:1})]),_:1},8,["open"])):$("",!0)]))}}),zt={class:"flex items-center gap-2 mt-2"},qt={class:"flex items-center justify-center p-4 bg-muted/30 min-h-[300px] max-h-[calc(90vh-80px)] overflow-auto"},It=["src","alt"],Lt=Z({__name:"ImagePreviewModal",props:{open:{type:Boolean},archivo:{}},emits:["update:open"],setup(t,{emit:j}){const v=t,p=j,S=q({get:()=>v.open,set:u=>p("update:open",u)}),w=()=>{var u;(u=v.archivo)!=null&&u.url&&window.open(v.archivo.url,"_blank")},h=()=>{var u;if((u=v.archivo)!=null&&u.url){const x=document.createElement("a");x.href=v.archivo.url,x.download=v.archivo.nombre,document.body.appendChild(x),x.click(),document.body.removeChild(x)}};return(u,x)=>(a(),R(e(Ze),{open:S.value,"onUpdate:open":x[1]||(x[1]=r=>S.value=r)},{default:c(()=>[s(e(Ye),{class:"max-w-4xl max-h-[90vh] p-0 overflow-hidden"},{default:c(()=>{var r;return[s(e(et),{class:"p-4 pb-2 pr-10"},{default:c(()=>[s(e(tt),{class:"text-sm font-medium truncate"},{default:c(()=>{var k;return[P(E(((k=t.archivo)==null?void 0:k.nombre)||"Imagen"),1)]}),_:1}),_("div",zt,[s(e(I),{variant:"outline",size:"sm",onClick:w},{default:c(()=>[s(e(at),{class:"h-4 w-4 mr-1"}),x[2]||(x[2]=P(" Abrir ",-1))]),_:1}),s(e(I),{variant:"outline",size:"sm",onClick:h},{default:c(()=>[s(e(he),{class:"h-4 w-4 mr-1"}),x[3]||(x[3]=P(" Descargar ",-1))]),_:1})])]),_:1}),_("div",qt,[(r=t.archivo)!=null&&r.url?(a(),b("img",{key:0,src:t.archivo.url,alt:t.archivo.nombre,class:"max-w-full max-h-full object-contain rounded",onError:x[0]||(x[0]=k=>k.target.src="/images/placeholder.png")},null,40,It)):$("",!0)])]}),_:1})]),_:1},8,["open"]))}}),At={key:0,class:"mt-2"},Ut={class:"flex flex-wrap gap-2"},Bt=["onClick"],Vt={key:0,class:"relative w-20 h-20 rounded-md overflow-hidden border bg-muted/30 hover:ring-2 hover:ring-primary transition-all"},Dt=["src","alt"],Xt={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},Ft={key:1,class:"flex items-center gap-2 px-3 py-2 rounded-md border bg-muted/30 hover:bg-muted/50 transition-colors max-w-[200px]"},Nt={class:"flex-1 min-w-0"},Ot={class:"text-xs font-medium truncate"},Ht=Z({__name:"ComentarioAdjuntos",props:{archivos:{}},setup(t){const j=M(!1),v=M(null),p=r=>{v.value=r,j.value=!0},S=r=>{window.open(r.url,"_blank")},w=r=>{r.es_imagen?p(r):S(r)},h=r=>["jpg","jpeg","png","gif","webp"].includes(r)?st:["xls","xlsx"].includes(r)?pt:ot,u=r=>["jpg","jpeg","png","gif","webp"].includes(r)?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":["pdf"].includes(r)?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":["doc","docx"].includes(r)?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":["xls","xlsx"].includes(r)?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",x=(r,k)=>{k.stopPropagation();const d=document.createElement("a");d.href=r.url,d.download=r.nombre,document.body.appendChild(d),d.click(),document.body.removeChild(d)};return(r,k)=>t.archivos&&t.archivos.length>0?(a(),b("div",At,[_("div",Ut,[(a(!0),b(N,null,G(t.archivos,(d,V)=>(a(),b("div",{key:V,class:"group relative cursor-pointer",onClick:B=>w(d)},[d.es_imagen?(a(),b("div",Vt,[_("img",{src:d.url,alt:d.nombre,class:"w-full h-full object-cover",onError:k[0]||(k[0]=B=>B.target.style.display="none")},null,40,Dt),_("div",Xt,[s(e(he),{class:"h-5 w-5 text-white hover:scale-110 transition-transform",onClick:B=>x(d,B)},null,8,["onClick"])])])):(a(),b("div",Ft,[(a(),R(ue(h(d.extension)),{class:"h-5 w-5 flex-shrink-0 text-muted-foreground"})),_("div",Nt,[_("p",Ot,E(d.nombre),1),s(e(de),{class:J([u(d.extension),"text-[10px] px-1"])},{default:c(()=>[P(E(d.extension.toUpperCase()),1)]),_:2},1032,["class"])]),s(e(he),{class:"h-4 w-4 text-muted-foreground hover:text-foreground transition-colors flex-shrink-0",onClick:B=>x(d,B)},null,8,["onClick"])]))],8,Bt))),128))]),s(Lt,{open:j.value,"onUpdate:open":k[1]||(k[1]=d=>j.value=d),archivo:v.value},null,8,["open","archivo"])])):$("",!0)}}),Qt={key:0,class:"inline-flex items-center gap-1.5 flex-wrap"},Wt=Z({__name:"ComentarioContextoBadge",props:{contexto:{},showTransition:{type:Boolean,default:!0}},setup(t){const j=t,v=h=>{const u={green:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",red:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",gray:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",purple:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400"};return u[h||"gray"]||u.gray},p=q(()=>v(j.contexto.color_anterior)),S=q(()=>v(j.contexto.color_nuevo)),w=q(()=>j.contexto.label_nuevo||j.contexto.estado_nuevo);return(h,u)=>w.value?(a(),b("div",Qt,[t.showTransition&&(t.contexto.label_anterior||t.contexto.estado_anterior)?(a(),b(N,{key:0},[s(e(de),{variant:"outline",class:J(["text-xs h-5 font-normal",p.value])},{default:c(()=>[P(E(t.contexto.label_anterior||t.contexto.estado_anterior),1)]),_:1},8,["class"]),s(e(nt),{class:"h-3 w-3 text-muted-foreground flex-shrink-0"})],64)):$("",!0),s(e(de),{variant:"outline",class:J(["text-xs h-5 font-medium",S.value])},{default:c(()=>[P(E(t.contexto.label_nuevo||t.contexto.estado_nuevo),1)]),_:1},8,["class"])])):$("",!0)}}),Kt={class:"group/item flex gap-3"},Gt={class:"flex-1 min-w-0"},Jt={class:"flex items-center gap-2 flex-wrap"},Zt={class:"font-medium text-sm"},Yt={class:"text-xs text-muted-foreground"},ea={key:2,class:"text-xs text-muted-foreground flex items-center gap-1"},ta={key:0,class:"mt-2"},aa=["innerHTML"],sa={class:"mt-2 flex items-center gap-2 flex-wrap"},oa={class:"flex items-center gap-1 opacity-0 group-hover/item:opacity-100 transition-opacity"},na={key:2,class:"mt-3"},ra={key:0,class:"mt-3 space-y-3"},la={key:1,class:"mt-2 ml-6 pl-4"},ia=Z({__name:"ComentarioItem",props:{comentario:{},nivel:{default:0},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0}},emits:["reply","quote","edit","delete","toggleReaccion","submitReply","cargarMasRespuestas"],setup(t,{emit:j}){const v=t,p=j,S=M(!1),w=M(!1),h=M(!1),u=M(!1),x=M(!1),r=q(()=>v.comentario.respuestas||v.comentario.respuestas_limitadas||[]),k=q(()=>{const L=f=>{const A=f.respuestas||f.respuestas_limitadas||[];let z=A.length;return A.forEach(F=>{z+=L(F)}),z};return L(v.comentario)}),d=q(()=>r.value.length>0),V=q(()=>(v.comentario.total_respuestas_anidadas||0)>0),B=q(()=>{var f;return(((f=v.comentario.autor)==null?void 0:f.name)||"U").substring(0,2).toUpperCase()}),T=q(()=>v.comentario.es_editable||!1),C=q(()=>{const L=v.comentario.tiempo_restante_edicion;if(!L||L<=0)return null;const f=Math.floor(L/60),A=L%60;return f>0?`${f}h ${A}m para editar`:`${A}m para editar`}),D=()=>{S.value=!S.value},X=()=>{w.value=!0},oe=(L,f,A,z=[])=>{p("submitReply",L,v.comentario.id,z),w.value=!1},W=()=>{w.value=!1},te=()=>{p("quote",v.comentario)},ae=()=>{h.value=!0},ne=(L,f,A,z=[])=>{p("edit",v.comentario,L,z),h.value=!1},re=()=>{h.value=!1},le=()=>{u.value?(p("delete",v.comentario),u.value=!1):(u.value=!0,setTimeout(()=>{u.value=!1},3e3))},ie=L=>{p("toggleReaccion",v.comentario.id,L)},ce=()=>{x.value=!0,p("cargarMasRespuestas",v.comentario.id),setTimeout(()=>{x.value=!1},2e3)};return(L,f)=>{var z,F;const A=Me("ComentarioItem",!0);return a(),b("div",{class:J({"ml-6 border-l-2 border-muted pl-4":t.nivel>0})},[_("div",Kt,[s(e(Oe),{class:"h-8 w-8 flex-shrink-0"},{default:c(()=>[s(e(Ne),{class:"text-xs"},{default:c(()=>[P(E(B.value),1)]),_:1})]),_:1}),_("div",Gt,[_("div",Jt,[_("span",Zt,E(((z=t.comentario.autor)==null?void 0:z.name)||"Usuario"),1),_("span",Yt,E(t.comentario.fecha_relativa),1),t.comentario.es_editado?(a(),R(e(de),{key:0,variant:"outline",class:"text-xs h-5"},{default:c(()=>[...f[8]||(f[8]=[P(" editado ",-1)])]),_:1})):$("",!0),t.comentario.tiene_contexto&&((F=t.comentario.contexto_info)==null?void 0:F.tipo)==="cambio_estado"?(a(),R(Wt,{key:1,contexto:t.comentario.contexto_info},null,8,["contexto"])):$("",!0),C.value?(a(),b("span",ea,[s(e(rt),{class:"h-3 w-3"}),P(" "+E(C.value),1)])):$("",!0)]),h.value?(a(),b("div",ta,[s(ye,{mode:"edit","comentario-editar":t.comentario,onSubmit:f[0]||(f[0]=Q=>ne(Q)),onCancel:re},null,8,["comentario-editar"])])):(a(),b(N,{key:1},[t.comentario.comentario_citado?(a(),R(Ee,{key:0,comentario:t.comentario.comentario_citado,class:"mt-2"},null,8,["comentario"])):$("",!0),_("div",{class:"mt-1 text-sm prose prose-sm dark:prose-invert max-w-none",innerHTML:t.comentario.contenido},null,8,aa),t.comentario.archivos_info&&t.comentario.archivos_info.length>0?(a(),R(Ht,{key:1,archivos:t.comentario.archivos_info},null,8,["archivos"])):$("",!0),_("div",sa,[s(Tt,{reacciones:t.comentario.reacciones_resumen||[],"can-react":t.canReact,onToggle:ie},null,8,["reacciones","can-react"]),_("div",oa,[t.canCreate?(a(),R(e(I),{key:0,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:X},{default:c(()=>[s(e(xe),{class:"h-3 w-3 mr-1"}),f[9]||(f[9]=P(" Responder ",-1))]),_:1})):$("",!0),t.canCreate?(a(),R(e(I),{key:1,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:te},{default:c(()=>[s(e(Re),{class:"h-3 w-3 mr-1"}),f[10]||(f[10]=P(" Citar ",-1))]),_:1})):$("",!0),T.value||t.comentario.es_eliminable?(a(),R(e(He),{key:2},{default:c(()=>[s(e(Qe),{asChild:""},{default:c(()=>[s(e(I),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:c(()=>[s(e(lt),{class:"h-4 w-4"})]),_:1})]),_:1}),s(e(We),{align:"end"},{default:c(()=>[t.comentario.es_editable?(a(),R(e(_e),{key:0,onClick:ae},{default:c(()=>[s(e(it),{class:"h-4 w-4 mr-2"}),f[11]||(f[11]=P(" Editar ",-1))]),_:1})):$("",!0),t.comentario.es_eliminable?(a(),R(e(_e),{key:1,class:"text-destructive",onClick:le},{default:c(()=>[s(e(ct),{class:"h-4 w-4 mr-2"}),P(" "+E(u.value?"Confirmar eliminaciÃ³n":"Eliminar"),1)]),_:1})):$("",!0)]),_:1})]),_:1})):$("",!0),d.value?(a(),R(e(I),{key:3,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:D},{default:c(()=>[S.value?(a(),R(e($e),{key:1,class:"h-3 w-3 mr-1"})):(a(),R(e(be),{key:0,class:"h-3 w-3 mr-1"})),P(" "+E(S.value?`Mostrar ${k.value}`:"Ocultar"),1)]),_:1})):$("",!0)])])],64)),w.value?(a(),b("div",na,[s(ye,{mode:"reply","comentario-responder":t.comentario,onSubmit:oe,onCancel:W},null,8,["comentario-responder"])])):$("",!0)])]),d.value&&!S.value?(a(),b("div",ra,[(a(!0),b(N,null,G(r.value,Q=>(a(),R(A,{key:Q.id,comentario:Q,nivel:t.nivel+1,"can-create":t.canCreate,"can-react":t.canReact,onReply:f[1]||(f[1]=U=>p("reply",U)),onQuote:f[2]||(f[2]=U=>p("quote",U)),onEdit:f[3]||(f[3]=(U,K,Y)=>p("edit",U,K,Y)),onDelete:f[4]||(f[4]=U=>p("delete",U)),onToggleReaccion:f[5]||(f[5]=(U,K)=>p("toggleReaccion",U,K)),onSubmitReply:f[6]||(f[6]=(U,K,Y)=>p("submitReply",U,K,Y)),onCargarMasRespuestas:f[7]||(f[7]=U=>p("cargarMasRespuestas",U))},null,8,["comentario","nivel","can-create","can-react"]))),128))])):$("",!0),V.value&&!S.value?(a(),b("div",la,[s(e(I),{variant:"ghost",size:"sm",class:"h-7 text-xs text-muted-foreground",disabled:x.value,onClick:ce},{default:c(()=>[s(e(be),{class:"h-3 w-3 mr-1"}),P(" "+E(x.value?"Cargando...":`Cargar ${t.comentario.total_respuestas_anidadas} respuestas mÃ¡s`),1)]),_:1},8,["disabled"])])):$("",!0)],2)}}}),ca={class:"flex items-center justify-between"},ua={key:0},da={key:1,class:"space-y-4"},ma={class:"flex-1 space-y-2"},fa={key:2,class:"text-center py-8 text-destructive"},pa={key:3,class:"text-center py-8"},ga={key:0,class:"text-sm text-muted-foreground mt-1"},va={key:4,class:"space-y-4"},ha={key:0,class:"flex flex-col items-center gap-3 pt-4 border-t"},xa={class:"text-sm text-muted-foreground"},ya={class:"flex items-center gap-1"},ba={key:0,class:"px-2 text-muted-foreground"},Ja=Z({__name:"ComentariosPanel",props:{commentableType:{},commentableId:{},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0},embedded:{type:Boolean,default:!1}},setup(t){const j=[{value:"recientes",label:"MÃ¡s recientes"},{value:"antiguos",label:"MÃ¡s antiguos"},{value:"populares",label:"MÃ¡s populares"}],v=t,p=()=>{const o=new URLSearchParams(window.location.search).get("pagina");return o?parseInt(o,10):1},{comentarios:S,loading:w,error:h,total:u,lastPage:x,from:r,to:k,links:d,tienePaginacion:V,puedePaginaAnterior:B,puedePaginaSiguiente:T,sortBy:C,cargar:D,irAPagina:X,paginaSiguiente:oe,paginaAnterior:W,crear:te,editar:ae,eliminar:ne,toggleReaccion:re,cambiarOrden:le,cargarRespuestasAdicionales:ie}=vt(v.commentableType,v.commentableId,{paginaInicial:p(),urlParam:"pagina",sincronizarUrl:!0}),ce=q(()=>!d.value||d.value.length<=3?[]:d.value),L=n=>{if(!n.url||n.active)return;const o=new URL(n.url,window.location.origin),g=parseInt(o.searchParams.get("page")||"1",10);X(g)},f=M("create"),A=M(null),z=M(null),F=M(null),Q=M(!1),U=M(null);Se(()=>{D()}),ke(()=>[v.commentableType,v.commentableId],()=>{D()});const K=async(n,o,g,H=[])=>{Q.value=!0;try{if(f.value==="edit"&&F.value){const ee=await ae(F.value.id,{contenido:n,archivos:H});ee.success?(O.success(ee.message),l()):O.error(ee.message||"Error al actualizar")}else{const ee=await te({contenido:n,parent_id:o,quoted_comentario_id:g,archivos:H});ee.success?(O.success(ee.message),l()):O.error(ee.message||"Error al publicar")}}finally{Q.value=!1}},Y=n=>{f.value="reply",A.value=n,z.value=null,F.value=null},me=n=>{f.value="quote",z.value=n,A.value=null,F.value=null},fe=async(n,o,g=[])=>{const H=await ae(n.id,{contenido:o,archivos:g});H.success?O.success(H.message):O.error(H.message||"Error al actualizar")},pe=async n=>{const o=await ne(n.id);o.success?O.success(o.message):O.error(o.message||"Error al eliminar")},ge=async(n,o)=>{const g=await re(n,o);g.success||O.error(g.message||"Error al agregar reacciÃ³n")},m=async(n,o,g=[])=>{const H=await te({contenido:n,parent_id:o,quoted_comentario_id:null,archivos:g});H.success?O.success(H.message):O.error(H.message||"Error al enviar respuesta")},y=async n=>{const o=await ie(n);o.success||O.error(o.message||"Error al cargar respuestas")},l=()=>{var n;f.value="create",A.value=null,z.value=null,F.value=null,(n=U.value)==null||n.clear()},i=()=>{l()};return(n,o)=>(a(),R(ue(t.embedded?"div":e(we)),{class:J({"space-y-4":t.embedded})},{default:c(()=>[(a(),R(ue(t.embedded?"div":e(Pe)),null,{default:c(()=>[_("div",ca,[_("div",null,[s(e(je),{class:"flex items-center gap-2"},{default:c(()=>[s(e(xe),{class:"h-5 w-5"}),o[3]||(o[3]=P(" Comentarios ",-1))]),_:1}),e(u)>0?(a(),R(e(Te),{key:0},{default:c(()=>[P(E(e(u))+" "+E(e(u)===1?"comentario":"comentarios"),1)]),_:1})):$("",!0)]),e(u)>1?(a(),R(e(ze),{key:0,"model-value":e(C),"onUpdate:modelValue":e(le)},{default:c(()=>[s(e(qe),{class:"w-[160px] h-8 text-xs"},{default:c(()=>[s(e(dt),{class:"h-3 w-3 mr-1"}),s(e(Ie))]),_:1}),s(e(Le),null,{default:c(()=>[(a(),b(N,null,G(j,g=>s(e(Ae),{key:g.value,value:g.value},{default:c(()=>[P(E(g.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):$("",!0)])]),_:1})),(a(),R(ue(t.embedded?"div":e(Ce)),{class:"space-y-6"},{default:c(()=>[t.canCreate?(a(),b("div",ua,[s(ye,{ref_key:"formRef",ref:U,mode:f.value,"comentario-editar":F.value,"comentario-citar":z.value,"comentario-responder":A.value,loading:Q.value,onSubmit:K,onCancel:i},null,8,["mode","comentario-editar","comentario-citar","comentario-responder","loading"])])):$("",!0),e(w)&&e(S).length===0?(a(),b("div",da,[(a(),b(N,null,G(3,g=>_("div",{key:g,class:"flex gap-3"},[s(e(ve),{class:"h-8 w-8 rounded-full"}),_("div",ma,[s(e(ve),{class:"h-4 w-32"}),s(e(ve),{class:"h-16 w-full"})])])),64))])):e(h)?(a(),b("div",fa,[_("p",null,E(e(h)),1),s(e(I),{variant:"outline",size:"sm",class:"mt-2",onClick:o[0]||(o[0]=g=>e(D)())},{default:c(()=>[...o[4]||(o[4]=[P(" Reintentar ",-1)])]),_:1})])):e(S).length===0?(a(),b("div",pa,[s(e(xe),{class:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),o[5]||(o[5]=_("p",{class:"text-muted-foreground"},"No hay comentarios todavÃ­a",-1)),t.canCreate?(a(),b("p",ga," SÃ© el primero en comentar ")):$("",!0)])):(a(),b("div",va,[(a(!0),b(N,null,G(e(S),g=>(a(),R(ia,{key:g.id,comentario:g,"can-create":t.canCreate,"can-react":t.canReact,onReply:Y,onQuote:me,onEdit:fe,onDelete:pe,onToggleReaccion:ge,onSubmitReply:m,onCargarMasRespuestas:y},null,8,["comentario","can-create","can-react"]))),128)),e(V)?(a(),b("div",ha,[_("div",xa," Mostrando "+E(e(r))+" a "+E(e(k))+" de "+E(e(u))+" comentarios ",1),_("div",ya,[s(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(B)||e(w),onClick:o[1]||(o[1]=g=>e(X)(1)),title:"Primera pÃ¡gina"},{default:c(()=>[s(e(mt),{class:"h-4 w-4"})]),_:1},8,["disabled"]),s(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(B)||e(w),onClick:e(W),title:"PÃ¡gina anterior"},{default:c(()=>[s(e(ut),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),(a(!0),b(N,null,G(ce.value,g=>(a(),b(N,{key:g.label},[!g.label.includes("Previous")&&!g.label.includes("Next")&&!g.label.includes("previous")&&!g.label.includes("next")?(a(),b(N,{key:0},[g.label==="..."?(a(),b("span",ba," ... ")):(a(),R(e(I),{key:1,variant:g.active?"default":"outline",size:"sm",class:"h-8 min-w-[32px] px-2",disabled:e(w)||g.active,onClick:H=>L(g)},{default:c(()=>[P(E(g.label),1)]),_:2},1032,["variant","disabled","onClick"]))],64)):$("",!0)],64))),128)),s(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(T)||e(w),onClick:e(oe),title:"PÃ¡gina siguiente"},{default:c(()=>[s(e($e),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),s(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(T)||e(w),onClick:o[2]||(o[2]=g=>e(X)(e(x))),title:"Ãšltima pÃ¡gina"},{default:c(()=>[s(e(ft),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])):$("",!0)]))]),_:1}))]),_:1},8,["class"]))}});export{Ja as _};
