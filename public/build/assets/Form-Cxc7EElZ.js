import{d as fe,k as z,c as C,w as oe,p as Oe,a as f,o as d,j as $,i as h,f as a,e as u,b as s,u as e,g as v,t as m,F as E,r as D,q as Ke,n as V,P as Qe,C as Xe,x as Ze,m as et,W as tt,h as at,ad as st,y as rt,bJ as it,a9 as ot,ac as lt}from"./app-CvmEvLYR.js";import{_ as Q}from"./createLucideIcon-BYllV5HV.js";import{_ as M,a as R,c as G,b as le}from"./CardTitle.vue_vue_type_script_setup_true_lang-DYJiR0p0.js";import{_ as dt}from"./Checkbox.vue_vue_type_script_setup_true_lang-Dd-bbs95.js";import{_ as L,a as re}from"./Label.vue_vue_type_script_setup_true_lang-CgIva2F9.js";import{_ as nt}from"./Progress.vue_vue_type_script_setup_true_lang-Crk3gMiI.js";import{_ as ut,a as ct,b as ft,c as mt,d as _t}from"./SelectValue.vue_vue_type_script_setup_true_lang-r7XLmnfE.js";import{_ as pt}from"./Textarea.vue_vue_type_script_setup_true_lang-CMtcUVc4.js";import{u as gt,a as bt,_ as vt,b as xt,c as yt,d as ht}from"./useConditionalFields-IlFjnGb3.js";import{C as N,_ as Z}from"./index-CsjRfzmR.js";import{_ as de}from"./CardDescription.vue_vue_type_script_setup_true_lang-yc6Z-fk3.js";import{_ as kt,a as Te}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-DFaMDXRt.js";import{a as ne,_ as ue}from"./index-D98fgULL.js";import{_ as ce}from"./AlertTitle.vue_vue_type_script_setup_true_lang-C-jGrtPC.js";import{M as X,B as $t,q as Ct,_ as wt}from"./AppLayout.vue_vue_type_script_setup_true_lang-DoxXDT1a.js";import{C as O,U as Vt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-5vU3YFIn.js";import{E as St}from"./external-link-E7x1e0gh.js";import{u as Et}from"./useAutoSave-XsyH22Ss.js";import{t as w}from"./index-DInCOE0r.js";import{A as At}from"./arrow-left-BGXglPm8.js";import{C as ie}from"./clock-EqkxgZ8m.js";import{C as Le}from"./circle-check-big-ZL9lZIrE.js";import{U as Ut}from"./user-N5Mcn8oq.js";import{S as Ft}from"./save-D-oHFreR.js";import{_ as qt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-gc5pLPKR.js";import"./check-dzKj6L88.js";import"./VisuallyHidden-NjImnF9U.js";import"./upload-DoEfrVM3.js";import"./eye-VdhGunbM.js";import"./download-1dH6veZU.js";import"./plus-e8N9cuUE.js";import"./grip-vertical-BGgDYYiR.js";import"./trash-2-Cuw6xOXz.js";import"./RovingFocusItem-BwA5U3O2.js";import"./utils-CPiem64V.js";import"./VisuallyHiddenInput-Cb86Aprz.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Dm0IxuZI.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-YDjYOfNF.js";const Bt={class:"space-y-4"},Pt={key:0,class:"text-center py-8"},zt={key:2,class:"space-y-6"},Dt={key:0},Nt={class:"text-sm font-medium text-muted-foreground mb-3"},jt={class:"space-y-3"},Tt={class:"flex items-start gap-3"},Lt={class:"flex-1"},Ot={class:"flex items-center justify-between"},Mt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Rt={class:"flex items-center gap-2 text-muted-foreground"},Gt={class:"flex items-center gap-2 text-muted-foreground"},Yt={class:"flex items-center gap-2 text-muted-foreground"},Wt={key:0,class:"flex items-center gap-2 text-muted-foreground"},It={class:"mt-3 text-xs text-muted-foreground"},Ht={key:1},Jt={class:"text-sm font-medium text-muted-foreground mb-3"},Kt={class:"space-y-3"},Qt={class:"flex items-start gap-3"},Xt={class:"flex-1"},Zt={class:"flex items-center justify-between"},ea={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},ta={class:"flex items-center gap-2 text-muted-foreground"},aa={class:"flex items-center gap-2 text-muted-foreground"},sa={class:"flex items-center gap-2 text-muted-foreground"},ra={class:"mt-3 text-xs text-muted-foreground"},ia={key:4,class:"mt-4 p-3 bg-muted/50 rounded-lg"},oa={class:"text-sm text-muted-foreground"},la=fe({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(j,{emit:n}){var P;const A=j,q=n,k=z([]),B=z(!1),i=z(null),_=z((P=A.modelValue)==null?void 0:P.toString()),Y=async()=>{B.value=!0,i.value=null;try{const x=await Ke.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:A.filtrarPorUbicacion,incluir_futuras:!0}});k.value=x.data}catch(x){i.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",x)}finally{B.value=!1}},S=C(()=>{const x={abiertas:[],futuras:[]};return k.value.forEach(y=>{y.estado_temporal==="abierta"?x.abiertas.push(y):y.estado_temporal==="futura"&&x.futuras.push(y)}),x}),W=C(()=>k.value.find(x=>x.id===Number(_.value)));oe(_,x=>{q("update:modelValue",x?Number(x):void 0)}),oe(()=>A.modelValue,x=>{_.value=x==null?void 0:x.toString()});const I=x=>new Date(x).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=x=>{switch(x){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},H=x=>{switch(x){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Oe(()=>{Y()}),(x,y)=>(d(),f("div",Bt,[B.value?(d(),f("div",Pt,y[1]||(y[1]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),a("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):i.value?(d(),$(e(ue),{key:1,variant:"destructive"},{default:u(()=>[s(e(N),{class:"h-4 w-4"}),s(e(ce),null,{default:u(()=>y[2]||(y[2]=[v("Error")])),_:1}),s(e(ne),null,{default:u(()=>[v(m(i.value),1)]),_:1})]),_:1})):k.value.length>0?(d(),f("div",zt,[s(e(kt),{modelValue:_.value,"onUpdate:modelValue":y[0]||(y[0]=g=>_.value=g),disabled:x.disabled},{default:u(()=>[S.value.abiertas.length>0?(d(),f("div",Dt,[a("h4",Nt," Convocatorias Abiertas ("+m(S.value.abiertas.length)+") ",1),a("div",jt,[(d(!0),f(E,null,D(S.value.abiertas,g=>(d(),$(e(M),{key:g.id,class:V(["cursor-pointer hover:shadow-md transition-all duration-200",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":_.value===g.id.toString(),"hover:bg-muted/50":_.value!==g.id.toString()}]),onClick:ee=>_.value=g.id.toString()},{default:u(()=>[s(e(R),{class:"pb-3"},{default:u(()=>[a("div",Tt,[s(e(Te),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),a("div",Lt,[a("div",Ot,[s(e(L),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:u(()=>[v(m(g.nombre),1)]),_:2},1032,["for"]),s(e(Z),{class:V(U(g.estado_temporal))},{default:u(()=>[v(m(H(g.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(de),{class:"mt-1"},{default:u(()=>[v(m(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(G),{class:"pt-0"},{default:u(()=>[a("div",Mt,[a("div",Rt,[s(e(X),{class:"h-4 w-4"}),a("span",null,m(g.cargo.nombre),1)]),a("div",Gt,[s(e(O),{class:"h-4 w-4"}),a("span",null,m(g.periodo_electoral.nombre),1)]),a("div",Yt,[s(e(X),{class:"h-4 w-4"}),a("span",null,m(g.ubicacion),1)]),g.numero_postulaciones!==void 0?(d(),f("div",Wt,[s(e(Vt),{class:"h-4 w-4"}),a("span",null,m(g.numero_postulaciones)+" postulaciones",1)])):h("",!0)]),a("div",It,[y[3]||(y[3]=a("span",{class:"font-medium"},"Cierre:",-1)),v(" "+m(I(g.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):h("",!0),S.value.futuras.length>0?(d(),f("div",Ht,[a("h4",Jt," Próximas Convocatorias ("+m(S.value.futuras.length)+") ",1),a("div",Kt,[(d(!0),f(E,null,D(S.value.futuras,g=>(d(),$(e(M),{key:g.id,class:V(["cursor-pointer hover:shadow-md transition-all duration-200 opacity-90",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":_.value===g.id.toString(),"hover:bg-muted/50":_.value!==g.id.toString()}]),onClick:ee=>_.value=g.id.toString()},{default:u(()=>[s(e(R),{class:"pb-3"},{default:u(()=>[a("div",Qt,[s(e(Te),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),a("div",Xt,[a("div",Zt,[s(e(L),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:u(()=>[v(m(g.nombre),1)]),_:2},1032,["for"]),s(e(Z),{class:V(U(g.estado_temporal))},{default:u(()=>[v(m(H(g.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(de),{class:"mt-1"},{default:u(()=>[v(m(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(G),{class:"pt-0"},{default:u(()=>[a("div",ea,[a("div",ta,[s(e(X),{class:"h-4 w-4"}),a("span",null,m(g.cargo.nombre),1)]),a("div",aa,[s(e(O),{class:"h-4 w-4"}),a("span",null,m(g.periodo_electoral.nombre),1)]),a("div",sa,[s(e(X),{class:"h-4 w-4"}),a("span",null,m(g.ubicacion),1)])]),a("div",ra,[y[4]||(y[4]=a("span",{class:"font-medium"},"Apertura:",-1)),v(" "+m(I(g.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):h("",!0)]),_:1},8,["modelValue","disabled"])])):(d(),$(e(ue),{key:3},{default:u(()=>[s(e(N),{class:"h-4 w-4"}),s(e(ce),null,{default:u(()=>y[5]||(y[5]=[v("Sin convocatorias disponibles")])),_:1}),s(e(ne),null,{default:u(()=>y[6]||(y[6]=[v(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),W.value&&!x.disabled?(d(),f("div",ia,[y[7]||(y[7]=a("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),a("p",oa,m(W.value.nombre),1)])):h("",!0)]))}}),da={class:"space-y-4"},na={class:"mt-2"},ua={class:"flex items-start justify-between"},ca={class:"space-y-1"},fa={class:"flex gap-2"},ma={class:"flex items-start gap-2"},_a={class:"text-sm"},pa={class:"font-medium text-gray-900 ml-1"},ga={class:"flex items-start gap-2"},ba={class:"text-sm"},va={class:"font-medium text-gray-900 ml-1"},xa={class:"flex items-start gap-2"},ya={class:"text-sm"},ha={class:"font-medium text-gray-900 ml-1"},ka={key:0,class:"flex items-start gap-2"},$a={class:"text-sm"},Ca={class:"font-medium text-gray-900 ml-1"},wa=fe({__name:"ConvocatoriaSeleccionada",props:{postulacion:{}},setup(j){const n=j,A=i=>{switch(i){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},q=i=>{switch(i){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}},k=i=>{switch(i){case"enviada":return"bg-yellow-100 text-yellow-800";case"en_revision":return"bg-blue-100 text-blue-800";case"aceptada":return"bg-green-100 text-green-800";case"rechazada":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},B=i=>{switch(i){case"enviada":return"Enviada";case"en_revision":return"En revisión";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";default:return i}};return(i,_)=>(d(),f("div",da,[s(e(ue),{class:"border-blue-200 bg-blue-50"},{default:u(()=>[s(e(N),{class:"h-4 w-4 text-blue-600"}),s(e(ce),{class:"text-blue-900"},{default:u(()=>_[0]||(_[0]=[v("Convocatoria ya seleccionada")])),_:1}),s(e(ne),{class:"text-blue-800"},{default:u(()=>[_[6]||(_[6]=a("p",null,"Ya has elegido una convocatoria para tu candidatura. La información de tu postulación se muestra a continuación.",-1)),a("p",na,[_[2]||(_[2]=v(" Si deseas postularte a un cargo distinto, por favor ve al ")),s(e(Qe),{href:i.route("postulaciones.index"),class:"font-semibold underline hover:text-blue-900 inline-flex items-center gap-1"},{default:u(()=>[_[1]||(_[1]=v(" menú de Postulaciones ")),s(e(St),{class:"h-3 w-3"})]),_:1},8,["href"]),_[3]||(_[3]=v(". Si necesitas ayuda, escríbenos a: ")),_[4]||(_[4]=a("b",null,"soporte@colombiahumana.co",-1)),_[5]||(_[5]=v(". "))])]),_:1})]),_:1}),s(e(M),{class:"border-2 bg-gray-50"},{default:u(()=>[s(e(R),null,{default:u(()=>[a("div",ua,[a("div",ca,[s(e(le),{class:"text-lg"},{default:u(()=>[v(m(n.postulacion.convocatoria.nombre),1)]),_:1}),s(e(de),{class:"text-sm"},{default:u(()=>_[7]||(_[7]=[v(" Convocatoria seleccionada en tu candidatura ")])),_:1})]),a("div",fa,[s(e(Z),{class:V([A(n.postulacion.convocatoria.estado_temporal),"text-xs"])},{default:u(()=>[v(m(q(n.postulacion.convocatoria.estado_temporal)),1)]),_:1},8,["class"]),s(e(Z),{class:V([k(n.postulacion.estado),"text-xs"])},{default:u(()=>[v(" Postulación "+m(B(n.postulacion.estado)),1)]),_:1},8,["class"])])])]),_:1}),s(e(G),{class:"space-y-3"},{default:u(()=>[a("div",ma,[s(e($t),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",_a,[_[8]||(_[8]=a("span",{class:"text-gray-600"},"Cargo:",-1)),a("span",pa,m(n.postulacion.convocatoria.cargo),1)])]),a("div",ga,[s(e(O),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",ba,[_[9]||(_[9]=a("span",{class:"text-gray-600"},"Periodo:",-1)),a("span",va,m(n.postulacion.convocatoria.periodo),1)])]),a("div",xa,[s(e(O),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",ya,[_[10]||(_[10]=a("span",{class:"text-gray-600"},"Fecha de cierre:",-1)),a("span",ha,m(n.postulacion.convocatoria.fecha_cierre),1)])]),n.postulacion.fecha_postulacion?(d(),f("div",ka,[s(e(O),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",$a,[_[11]||(_[11]=a("span",{class:"text-gray-600"},"Fecha de tu postulación:",-1)),a("span",Ca,m(n.postulacion.fecha_postulacion),1)])])):h("",!0),_[12]||(_[12]=a("div",{class:"border-t pt-3 mt-3"},[a("p",{class:"text-xs text-gray-500"}," Esta convocatoria fue seleccionada cuando creaste tu candidatura. No es posible cambiarla desde este formulario para mantener la integridad de tu postulación y su historial de seguimiento. ")],-1))]),_:1})]),_:1})]))}}),Va={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 pb-24"},Sa={class:"flex items-center justify-between"},Ea={class:"text-3xl font-bold"},Aa={class:"text-muted-foreground"},Ua={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Fa={key:0,class:"flex items-center gap-1.5"},qa={key:1,class:"flex items-center gap-1.5"},Ba={key:2,class:"flex items-center gap-1.5 text-amber-600"},Pa={key:3,class:"flex items-center gap-1.5"},za={class:"text-blue-700 dark:text-blue-300"},Da={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Na={class:"flex items-start gap-3"},ja={class:"text-sm text-blue-800"},Ta={key:0,class:"mt-1 text-blue-600"},La={key:0,class:"text-red-500"},Oa={key:0,class:"text-sm text-muted-foreground"},Ma={key:6,class:"space-y-2"},Ra=["id","name","value","onUpdate:modelValue"],Ga={key:7,class:"space-y-2"},Ya={key:8},Wa={key:9},Ia={key:2,class:"text-red-500 text-sm mt-1"},Ha={key:10},Ja={key:11},Ka={key:12},Qa={key:13,class:"text-sm text-destructive"},Xa={key:1,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},Za={class:"text-red-800 text-sm"},es={key:0,class:"fixed bottom-0 left-0 right-0 z-50 px-2 sm:px-4 pb-2 sm:pb-4"},ts={class:"mx-auto max-w-7xl"},as={class:"backdrop-blur-lg bg-tertiary-60 dark:bg-gray-900/80 border border-gray-200/50 dark:border-gray-700/50 rounded-xl sm:rounded-2xl shadow-2xl p-3 sm:p-4"},ss={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},rs={class:"hidden sm:flex items-center"},is={class:"flex-1 sm:max-w-xs lg:max-w-sm mx-0 sm:mx-4"},os={class:"flex items-center gap-3"},ls={class:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap font-medium"},ds={class:"flex items-center gap-2 sm:gap-3"},ns={class:"ml-2 whitespace-nowrap"},us=fe({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean},postulacion_existente:{}},setup(j){var pe,ge;const n=j,A=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:n.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:q}=gt(),k=z({});C(()=>{var b;if(!n.is_editing||!((b=n.candidatura)!=null&&b.formulario_data))return!1;const o=Object.keys(n.candidatura.formulario_data),l=n.configuracion_campos.map(t=>t.id),r=o.some(t=>!l.includes(t)),c=n.configuracion_campos.some(t=>t.required&&!n.candidatura.formulario_data[t.id]);return r||c});const i=Xe((()=>{var l;const o={};return n.configuracion_campos.forEach(r=>{r.type==="checkbox"?o[r.id]=[]:r.type==="file"?o[r.id]=[]:r.type==="convocatoria"?o[r.id]=void 0:r.type==="disclaimer"?o[r.id]=null:r.type==="repeater"?o[r.id]=[]:r.type==="datepicker"?o[r.id]=null:o[r.id]=""}),(l=n.candidatura)!=null&&l.formulario_data&&(Object.assign(o,n.candidatura.formulario_data),n.configuracion_campos.forEach(r=>{r.type==="file"&&o[r.id]&&(Array.isArray(o[r.id])||(o[r.id]=[o[r.id]]))})),{formulario_data:o}})()),_=z(n.configuracion_campos),Y=C(()=>i.formulario_data),{visibleFields:S,clearHiddenFieldValues:W}=bt(_,Y);oe(S,()=>{W()});const{state:I,isSaving:U,hasSaved:H,hasError:P,saveNow:x,startWatching:y,stopAutoSave:g,restoreDraft:ee,clearLocalStorage:te}=Et(Y,{url:"/candidaturas/autosave",resourceId:((pe=n.candidatura)==null?void 0:pe.id)||null,resourceIdField:"candidatura_id",debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((ge=n.candidatura)==null?void 0:ge.id)||"new"}`});let T=null;Oe(()=>{const o=["borrador","rechazado"];if(!n.candidatura||o.includes(n.candidatura.estado)){if(!n.is_editing){const r=ee();r&&r.formulario_data&&(w.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{te(),i.reset(),w.success("Borrador descartado")}},duration:5e3}),Object.assign(i.formulario_data,r.formulario_data))}T=y()}}),Ze(()=>{T&&T(),g()});const Me=async()=>{if(U.value){w.warning("Ya se está guardando...");return}await x(),P.value||w.success("Borrador guardado manualmente")},Re=C(()=>J.value.map(r=>{var t;if(!r.required)return{campo:r.id,valid:!0};const c=i.formulario_data[r.id];let b=!1;if(r.type==="checkbox")b=Array.isArray(c)&&c.length>0;else if(r.type==="file")(Array.isArray(c)&&c.length>0||k.value[r.id]&&k.value[r.id].length>0)&&(b=!0);else if(r.type==="convocatoria")b=c!=null&&c!=="";else if(r.type==="disclaimer")b=c&&c.accepted===!0;else if(r.type==="repeater"){const K=((t=r.repeaterConfig)==null?void 0:t.minItems)||0;b=Array.isArray(c)&&c.length>=K}else r.type==="datepicker"?b=c!=null&&c!=="":b=c&&c.toString().trim()!=="";return!b&&r.required,{campo:r.id,valid:b}}).every(r=>r.valid)),ae=C(()=>{const o=J.value.length;let l=0;return J.value.forEach(r=>{const c=i.formulario_data[r.id];let b=!1;r.type==="checkbox"?b=Array.isArray(c)&&c.length>0:r.type==="file"?b=Array.isArray(c)&&c.length>0||k.value[r.id]&&k.value[r.id].length>0:r.type==="convocatoria"?b=c!=null&&c!=="":r.type==="disclaimer"?b=c&&c.accepted===!0:r.type==="repeater"?b=Array.isArray(c)&&c.length>0:r.type==="datepicker"?b=c!=null&&c!=="":b=c&&c.toString().trim()!=="",b&&l++}),{llenos:l,total:o,porcentaje:o>0?Math.round(l/o*100):0}}),me=C(()=>n.is_editing?"Editar Candidatura":"Crear Candidatura"),Ge=C(()=>{var o,l;return i.processing?"Guardando...":n.is_editing?((o=n.candidatura)==null?void 0:o.estado)==="rechazado"?"Reenviar Candidatura":((l=n.candidatura)==null?void 0:l.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),Ye=C(()=>{var o,l;return!n.is_editing||n.postulacion_existente&&["borrador","rechazado"].includes(((o=n.candidatura)==null?void 0:o.estado)||"")?!1:!!["pendiente","aprobado"].includes(((l=n.candidatura)==null?void 0:l.estado)||"")}),J=C(()=>{var l;let o=[...S.value];return Ye.value&&(o=o.filter(r=>r.type!=="convocatoria")),n.is_editing&&((l=n.candidatura)==null?void 0:l.estado)==="aprobado"&&(o=o.filter(r=>r.editable===!0)),o}),We=C(()=>{var r;if(!n.is_editing||!n.candidatura)return!1;let o=!1;if(["pendiente","aprobado"].includes(n.candidatura.estado)&&(o=n.configuracion_campos.some(c=>c.type==="convocatoria")),((r=n.candidatura)==null?void 0:r.estado)==="aprobado"){const c=n.configuracion_campos.some(b=>!b.editable&&b.type!=="convocatoria");return o||c}return o}),Ie=async(o,l)=>{if(k.value[o]=l,l&&l.length>0)try{w.info("Subiendo archivos...",{duration:2e3});const c=(await q(l,{module:"candidaturas",fieldId:o})).map(b=>b.path);Array.isArray(i.formulario_data[o]),i.formulario_data[o]=c,k.value[o]=[],w.success("Archivos subidos correctamente",{duration:2e3})}catch(r){console.error("Error al subir archivos:",r),w.error("Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else i.formulario_data[o]=[]},_e=async()=>{for(const[l,r]of Object.entries(k.value))if(r&&r.length>0)try{w.info("Subiendo archivos pendientes...",{duration:2e3});const c=await q(r,{module:"candidaturas",fieldId:l});i.formulario_data[l]=c.map(b=>b.path),k.value[l]=[]}catch(c){console.error("Error al subir archivos:",c),w.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const o={...i.formulario_data};n.configuracion_campos.forEach(l=>{const r=o[l.id];l.required||(r===""||r===void 0||Array.isArray(r)&&r.length===0&&l.type!=="checkbox"&&l.type!=="file")&&(o[l.id]=null)}),i.formulario_data=o,g(),n.is_editing?i.put(`/candidaturas/${n.candidatura.id}`,{onSuccess:()=>{te(),w.success("Candidatura actualizada exitosamente")},onError:l=>{console.error("Errores de validación:",l),(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&(T=y())}}):i.post("/candidaturas",{onSuccess:()=>{te(),w.success("Candidatura creada exitosamente")},onError:l=>{console.error("Errores de validación:",l),T=y()}})},F=o=>!!i.errors[`formulario_data.${o}`],He=C(()=>!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)),Je=()=>{const o=document.querySelector('[data-sidebar="trigger"]');o&&o.click()};return(o,l)=>(d(),f(E,null,[s(e(et),{title:me.value},null,8,["title"]),s(wt,{breadcrumbs:A},{default:u(()=>{var r,c;return[a("div",Va,[a("div",Sa,[a("div",null,[a("h1",Ea,m(me.value),1),a("p",Aa,m(o.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),s(e(Q),{variant:"outline",onClick:l[0]||(l[0]=b=>e(tt).visit("/candidaturas"))},{default:u(()=>[s(e(At),{class:"mr-2 h-4 w-4"}),l[1]||(l[1]=v(" Volver "))]),_:1})]),!o.candidatura||["borrador","rechazado"].includes(o.candidatura.estado)?(d(),f("div",Ua,[e(U)?(d(),f("div",Fa,[s(e(ie),{class:"h-4 w-4 animate-spin"}),l[2]||(l[2]=a("span",null,"Guardando automáticamente...",-1))])):e(H)&&!e(P)?(d(),f("div",qa,[s(e(Le),{class:"h-4 w-4 text-green-600"}),a("span",null,"Guardado automáticamente a las "+m((r=e(I).lastSaved)==null?void 0:r.toLocaleTimeString()),1)])):e(P)?(d(),f("div",Ba,[s(e(N),{class:"h-4 w-4"}),l[3]||(l[3]=a("span",null,"Guardado localmente (sin conexión)",-1))])):(d(),f("div",Pa,[s(e(ie),{class:"h-4 w-4"}),l[4]||(l[4]=a("span",null,"Autoguardado activado",-1))]))])):h("",!0),o.is_editing&&((c=o.candidatura)!=null&&c.comentarios_admin)?(d(),$(e(M),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:u(()=>[s(e(R),null,{default:u(()=>[s(e(le),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:u(()=>[s(e(N),{class:"h-5 w-5"}),l[5]||(l[5]=v(" Comentarios de la comisión "))]),_:1})]),_:1}),s(e(G),null,{default:u(()=>[a("p",za,m(o.candidatura.comentarios_admin),1)]),_:1})]),_:1})):h("",!0),s(e(M),null,{default:u(()=>[s(e(R),null,{default:u(()=>[s(e(le),{class:"flex items-center gap-2"},{default:u(()=>[s(e(Ut),{class:"h-5 w-5"}),l[6]||(l[6]=v(" Información de Candidatura "))]),_:1})]),_:1}),s(e(G),null,{default:u(()=>{var b;return[a("form",{onSubmit:at(_e,["prevent"]),class:"space-y-6"},[o.is_editing&&((b=o.candidatura)==null?void 0:b.estado)==="aprobado"?(d(),f("div",Da,[a("div",Na,[s(e(N),{class:"h-5 w-5 text-blue-600 mt-0.5"}),a("div",ja,[l[7]||(l[7]=a("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),l[8]||(l[8]=a("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),We.value?(d(),f("p",Ta," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):h("",!0)])])])):h("",!0),s(st,{name:"fade-field",tag:"div",class:"space-y-6"},{default:u(()=>[(d(!0),f(E,null,D(J.value,t=>{var K,be,ve,xe,ye,he,ke,$e,Ce,we,Ve,Se,Ee,Ae,Ue,Fe,qe,Be,Pe,ze,De,Ne;return d(),f("div",{key:t.id,class:"space-y-2"},[s(e(L),{for:t.id,class:"flex items-center gap-1"},{default:u(()=>[v(m(t.title)+" ",1),t.required?(d(),f("span",La,"*")):h("",!0)]),_:2},1032,["for"]),t.description?(d(),f("p",Oa,m(t.description),1)):h("",!0),t.type==="text"||t.type==="email"?(d(),$(e(re),{key:1,id:t.id,type:t.type,modelValue:e(i).formulario_data[t.id],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,placeholder:t.placeholder||"",class:V({"border-destructive":F(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(d(),$(e(pt),{key:2,id:t.id,modelValue:e(i).formulario_data[t.id],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,placeholder:t.placeholder||"",rows:4,class:V({"border-destructive":F(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(d(),$(e(re),{key:3,id:t.id,type:"number",modelValue:e(i).formulario_data[t.id],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,placeholder:t.placeholder||"",class:V({"border-destructive":F(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(d(),$(e(re),{key:4,id:t.id,type:"date",modelValue:e(i).formulario_data[t.id],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,class:V({"border-destructive":F(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(d(),$(e(ut),{key:5,modelValue:e(i).formulario_data[t.id],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p},{default:u(()=>[s(e(ct),{class:V({"border-destructive":F(t.id)})},{default:u(()=>[s(e(ft),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),s(e(mt),null,{default:u(()=>[(d(!0),f(E,null,D(t.options,p=>(d(),$(e(_t),{key:p,value:p},{default:u(()=>[v(m(p),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(d(),f("div",Ma,[(d(!0),f(E,null,D(t.options,p=>(d(),f("div",{key:p,class:"flex items-center space-x-2"},[rt(a("input",{id:`${t.id}_${p}`,name:t.id,type:"radio",value:p,"onUpdate:modelValue":se=>e(i).formulario_data[t.id]=se,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Ra),[[it,e(i).formulario_data[t.id]]]),s(e(L),{for:`${t.id}_${p}`,class:"text-sm font-normal"},{default:u(()=>[v(m(p),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(d(),f("div",Ga,[(d(!0),f(E,null,D(t.options,p=>(d(),f("div",{key:p,class:"flex items-center space-x-2"},[s(e(dt),{id:`${t.id}_${p}`,checked:e(i).formulario_data[t.id].includes(p),"onUpdate:checked":se=>{if(se)e(i).formulario_data[t.id].includes(p)||e(i).formulario_data[t.id].push(p);else{const je=e(i).formulario_data[t.id].indexOf(p);je>-1&&e(i).formulario_data[t.id].splice(je,1)}}},null,8,["id","checked","onUpdate:checked"]),s(e(L),{for:`${t.id}_${p}`,class:"text-sm font-normal"},{default:u(()=>[v(m(p),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(d(),f("div",Ya,[s(vt,{modelValue:e(i).formulario_data[t.id],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,onFilesSelected:p=>Ie(t.id,p),label:"",description:"",required:t.required,multiple:((K=t.fileConfig)==null?void 0:K.multiple)||!1,"max-files":((be=t.fileConfig)==null?void 0:be.maxFiles)||5,"max-file-size":((ve=t.fileConfig)==null?void 0:ve.maxFileSize)||10,accept:((xe=t.fileConfig)==null?void 0:xe.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(i).errors[`formulario_data.${t.id}`],disabled:e(i).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(d(),f("div",Wa,[o.postulacion_existente&&["borrador","rechazado"].includes(((ye=o.candidatura)==null?void 0:ye.estado)||"")?(d(),$(wa,{key:0,postulacion:o.postulacion_existente},null,8,["postulacion"])):(d(),$(la,{key:1,modelValue:e(i).formulario_data[t.id],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,required:t.required,disabled:e(i).processing||o.is_editing&&((he=o.candidatura)==null?void 0:he.estado)!=="borrador","filtrar-por-ubicacion":((ke=t.convocatoriaConfig)==null?void 0:ke.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"])),F(t.id)&&!o.postulacion_existente?(d(),f("div",Ia,m(e(i).errors[`formulario_data.${t.id}`]),1)):h("",!0)])):t.type==="datepicker"?(d(),f("div",Ha,[s(xt,{"model-value":e(i).formulario_data[t.id]||null,"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,label:"",description:"",required:t.required,disabled:e(i).processing,error:e(i).errors[`formulario_data.${t.id}`],"min-date":($e=t.datepickerConfig)==null?void 0:$e.minDate,"max-date":(Ce=t.datepickerConfig)==null?void 0:Ce.maxDate,format:((we=t.datepickerConfig)==null?void 0:we.format)||"DD/MM/YYYY","allow-past-dates":((Ve=t.datepickerConfig)==null?void 0:Ve.allowPastDates)??!0,"allow-future-dates":((Se=t.datepickerConfig)==null?void 0:Se.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(d(),f("div",Ja,[s(yt,{"model-value":e(i).formulario_data[t.id]||null,"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,label:"",description:"",required:t.required,disabled:e(i).processing,error:e(i).errors[`formulario_data.${t.id}`],"disclaimer-text":((Ee=t.disclaimerConfig)==null?void 0:Ee.disclaimerText)||"","modal-title":((Ae=t.disclaimerConfig)==null?void 0:Ae.modalTitle)||"Términos y Condiciones","accept-button-text":((Ue=t.disclaimerConfig)==null?void 0:Ue.acceptButtonText)||"Acepto","decline-button-text":((Fe=t.disclaimerConfig)==null?void 0:Fe.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(d(),f("div",Ka,[s(ht,{"model-value":e(i).formulario_data[t.id]||[],"onUpdate:modelValue":p=>e(i).formulario_data[t.id]=p,label:"",description:"",required:t.required,disabled:e(i).processing,error:e(i).errors[`formulario_data.${t.id}`],"min-items":((qe=t.repeaterConfig)==null?void 0:qe.minItems)||0,"max-items":((Be=t.repeaterConfig)==null?void 0:Be.maxItems)||10,"item-name":((Pe=t.repeaterConfig)==null?void 0:Pe.itemName)||"Elemento","add-button-text":((ze=t.repeaterConfig)==null?void 0:ze.addButtonText)||"Agregar elemento","remove-button-text":((De=t.repeaterConfig)==null?void 0:De.removeButtonText)||"Eliminar",fields:((Ne=t.repeaterConfig)==null?void 0:Ne.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):h("",!0),F(t.id)?(d(),f("p",Qa,m(e(i).errors[`formulario_data.${t.id}`]),1)):h("",!0)])}),128))]),_:1}),e(i).errors.general?(d(),f("div",Xa,[a("p",Za,m(e(i).errors.general),1)])):h("",!0),l[9]||(l[9]=a("div",{class:"h-4"},null,-1))],32)]}),_:1})]),_:1})]),(d(),$(ot,{to:"body"},[s(lt,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-4 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-4 opacity-0"},{default:u(()=>[(d(),f("div",es,[a("div",ts,[a("div",as,[a("div",ss,[a("div",rs,[s(e(Q),{variant:"outline",type:"button",onClick:Je,class:"backdrop-blur-sm flex-shrink-0 text-xs sm:text-sm py-2 px-3"},{default:u(()=>[s(e(Ct),{class:"h-4 w-4"}),l[10]||(l[10]=a("span",{class:"ml-2"},"Ocultar sidebar",-1))]),_:1})]),a("div",is,[a("div",os,[s(e(nt),{modelValue:ae.value.porcentaje,class:"flex-1"},null,8,["modelValue"]),a("span",ls,m(ae.value.llenos)+" / "+m(ae.value.total),1)]),l[11]||(l[11]=a("p",{class:"text-xs text-muted-foreground mt-1 text-center hidden sm:block"}," Campos completados ",-1))]),a("div",ds,[He.value?(d(),$(e(Q),{key:0,onClick:Me,disabled:e(U),variant:"outline",class:"backdrop-blur-sm flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:u(()=>[e(U)?(d(),f(E,{key:0},[s(e(ie),{class:"mr-2 h-4 w-4 animate-spin"}),l[12]||(l[12]=v(" Guardando... "))],64)):(d(),f(E,{key:1},[s(e(Ft),{class:"mr-2 h-4 w-4"}),l[13]||(l[13]=v(" Guardar borrador "))],64))]),_:1},8,["disabled"])):h("",!0),s(e(Q),{onClick:_e,disabled:!Re.value||e(i).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400 flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:u(()=>[s(e(Le),{class:"h-4 w-4"}),a("span",ns,m(Ge.value),1)]),_:1},8,["disabled"])])])])])]))]),_:1})]))]}),_:1})],64))}}),Ks=qt(us,[["__scopeId","data-v-2be1d4e9"]]);export{Ks as default};
