import{d as Ie,u as Re,r as C,c as T,o as De,B as je,b as x,w as a,g as d,e as t,i as p,j as f,f as o,v as Te,h as i,t as v,m as u,l as Oe,F as N,k as I,s as O}from"./app-B9TOPmlt.js";import{_ as Me}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DBuYjDAl.js";import{_ as V,a as S,b as E,c as k}from"./CardTitle.vue_vue_type_script_setup_true_lang-8JbMmZ0-.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-S9Day0Vc.js";import{_ as b}from"./createLucideIcon-DpBiCm_n.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-CvNMbvGN.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-B_9lqbQW.js";import{_ as ne}from"./Textarea.vue_vue_type_script_setup_true_lang-Ch7dBgvo.js";import{_ as q,a as G,b as J,c as X,d as h}from"./SelectValue.vue_vue_type_script_setup_true_lang-D3EwhHq3.js";import{_ as de,a as ue}from"./index-C3rdOr2P.js";import{_ as Be,a as Le,b as R,c as D}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-JlMm7mrA.js";import{u as qe}from"./useToast-I3BUm4S6.js";import{u as Ge}from"./useFileUpload-x8TMVJZu.js";import{u as Je}from"./useAutoSave-DZ2Ug7c1.js";import{_ as Y}from"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-kvaDeNrW.js";import{_ as Z}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-D_7Btmny.js";import{_ as Xe}from"./FileUploadField.vue_vue_type_script_setup_true_lang-Ddw3-TuC.js";import{A as We}from"./arrow-left-kjMhejoF.js";import{T as He}from"./trash-2-CoPlWJbq.js";import{C as Ke}from"./clock-CZ3tr_0q.js";import{C as Qe}from"./circle-check-big-BiHvKdw5.js";import{C as ee}from"./circle-alert-DS5qv-mP.js";import{X as oe}from"./x-Cei9FK_W.js";import{U as me}from"./user-plus-DXyP2bd1.js";import{U as pe}from"./users-B0NsgXmm.js";import{S as Ye}from"./save-BPMMprLQ.js";import"./useFlashMessages-w2rvDQtt.js";import"./index-DkWnUc8Q.js";import"./floating-ui.vue-BEixnLxp.js";import"./index-pQLg4C2_.js";import"./shield-Dn7CuH8Q.js";import"./user-Da-HkZ5M.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-sawyMmTN.js";import"./chevron-right-_4nRJ_uY.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-ByW9z0kj.js";import"./VisuallyHidden-Bi-0hazS.js";import"./index-FFvcsDEl.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Ca09oUOe.js";import"./index-BTjg3Nao.js";import"./map-pin-DmiZTikP.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-VJiJrCsO.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-lQ-C-vnU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B0ZmeXV3.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-ucYiIJj7.js";import"./tag-CF53NfGo.js";import"./target-Co51nDF2.js";import"./vote-C77vNdCE.js";import"./folder-open-CTk950sb.js";import"./send-CU6BPHgu.js";import"./file-text-Crx8E7OL.js";import"./briefcase-BE5QRmL6.js";import"./calendar-DorXl5Ec.js";import"./megaphone-B6hd4taf.js";import"./user-check-DbK6PlHx.js";import"./clipboard-list-B6e5Biye.js";import"./mail-BSXGefXW.js";import"./message-square-DPwDV_-Y.js";import"./external-link-BD2lnkio.js";import"./panel-left-DBOf36Cl.js";import"./index-BX3b2fLA.js";import"./check-CcWYkizm.js";import"./index-DHeDABhg.js";import"./RovingFocusItem-UMGvH3Ea.js";import"./utils-C5vilUL6.js";import"./debounce-BJz6yXw2.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DRoN06db.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-CTjivzLJ.js";import"./VisuallyHiddenInput-DclMDNbi.js";import"./circle-CLRHjMFm.js";import"./search-C3SA702q.js";import"./loader-circle-txzZleJg.js";import"./chevron-left-BOsHlzSD.js";import"./upload-CNhMs-i7.js";import"./file-DHByRbIp.js";import"./eye-Cd-dDIQG.js";import"./download-CyuA8ekH.js";const Ze={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},eo={class:"flex items-center justify-between"},oo={class:"flex items-center gap-4"},to={class:"text-gray-600 mt-1"},ao={class:"flex gap-2"},ro={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},so={key:3},lo={key:4},io={key:5},no={class:"flex gap-2"},uo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},mo={key:0,class:"text-red-500 text-sm mt-1"},po={key:0,class:"text-red-500 text-sm mt-1"},co={key:0,class:"text-red-500 text-sm mt-1"},fo={key:0,class:"space-y-4 pt-4 border-t"},vo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},_o={key:0,class:"text-red-500 text-sm mt-1"},bo={key:0,class:"text-red-500 text-sm mt-1"},go={key:0,class:"text-red-500 text-sm mt-1"},yo={key:0,class:"text-red-500 text-sm mt-1"},xo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},ho={key:0,class:"text-red-500 text-sm mt-1"},Co={key:0,class:"text-red-500 text-sm mt-1"},Vo={key:0,class:"space-y-4 pt-4 border-t"},So={class:"space-y-6"},Eo={class:"space-y-4"},ko={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between mb-2"},Uo={class:"font-medium"},$o={class:"text-sm text-muted-foreground"},wo={class:"space-y-4"},zo={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},Po={class:"font-medium"},Ao={class:"text-sm text-muted-foreground"},Fo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},No={class:"space-y-4"},Io={key:0,class:"space-y-2"},Ro={class:"flex items-center justify-between"},Do={class:"font-medium"},jo={class:"text-sm text-muted-foreground"},To={class:"flex items-center gap-2 mt-1"},Oo={class:"text-xs bg-primary/10 text-primary px-2 py-1 rounded"},Mo={key:0,class:"text-xs text-muted-foreground"},Bo={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},Lo={key:0,class:"text-red-500 text-sm mt-1"},qo={key:0,class:"space-y-4 pt-4 border-t"},Go={key:0,class:"flex justify-end gap-4"},_a=Ie({__name:"Edit",props:{contrato:{},proyectos:{},camposPersonalizados:{},valoresCampos:{}},setup(j){var le,ie;const n=j,y=qe(),{uploadFiles:ce}=Ge(),fe=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:n.contrato.nombre,href:`/admin/contratos/${n.contrato.id}`},{title:"Editar",href:`/admin/contratos/${n.contrato.id}/edit`}],ve=()=>!n.contrato.participantes||n.contrato.participantes.length===0?[]:n.contrato.participantes.map(l=>{var e,m,s;return{user_id:((e=l.pivot)==null?void 0:e.user_id)||l.user_id||l.id,rol:((m=l.pivot)==null?void 0:m.rol)||l.rol||"participante",notas:((s=l.pivot)==null?void 0:s.notas)||l.notas||""}}),r=Re({proyecto_id:n.contrato.proyecto_id.toString(),nombre:n.contrato.nombre,descripcion:n.contrato.descripcion||"",fecha_inicio:n.contrato.fecha_inicio,fecha_fin:n.contrato.fecha_fin||"",estado:n.contrato.estado,tipo:n.contrato.tipo,monto_total:((le=n.contrato.monto_total)==null?void 0:le.toString())||"",moneda:n.contrato.moneda,responsable_id:((ie=n.contrato.responsable_id)==null?void 0:ie.toString())||"none",contraparte_user_id:n.contrato.contraparte_user_id||null,contraparte_nombre:n.contrato.contraparte_nombre||"",contraparte_identificacion:n.contrato.contraparte_identificacion||"",contraparte_email:n.contrato.contraparte_email||"",contraparte_telefono:n.contrato.contraparte_telefono||"",participantes:ve(),archivo_pdf:null,archivos_paths:n.contrato.archivos_paths||[],archivos_nombres:n.contrato.archivos_nombres||[],tipos_archivos:n.contrato.tipos_archivos||{},observaciones:n.contrato.observaciones||"",campos_personalizados:n.valoresCampos||{},_method:"PUT"}),_e=C(n.contrato.archivo_pdf?"Archivo actual: "+n.contrato.archivo_pdf.split("/").pop():""),M=C((n.contrato.archivos_paths||[]).map((l,e)=>{var m,s;return{id:`existing_${e}`,name:((m=n.contrato.archivos_nombres)==null?void 0:m[e])||l.split("/").pop()||"archivo",size:0,path:l,url:`/storage/${l}`,mime_type:((s=n.contrato.tipos_archivos)==null?void 0:s[l])||"application/octet-stream",uploaded_at:n.contrato.updated_at}})),te=C("informacion");C(!1);const W=C(!1),H=C(!1),K=C(!1),{route:U}=window,be=[{value:"USD",label:"USD - D칩lar Estadounidense"},{value:"EUR",label:"EUR - Euro"},{value:"MXN",label:"MXN - Peso Mexicano"},{value:"COP",label:"COP - Peso Colombiano"},{value:"ARS",label:"ARS - Peso Argentino"},{value:"CLP",label:"CLP - Peso Chileno"},{value:"PEN",label:"PEN - Sol Peruano"}],A=C(n.contrato.contraparteUser||null),z=C(n.contrato.responsable||null),ge=T(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"testigo",label:"Testigo"},{value:"revisor",label:"Revisor"},{value:"aprobador",label:"Aprobador"},{value:"observador",label:"Observador"}],value:"testigo",required:!0},{name:"notas",label:"Notas (opcional)",type:"text",value:"",required:!1}]),ye=T(()=>{const l=r.participantes.map(e=>e.user_id);return r.contraparte_user_id&&l.push(r.contraparte_user_id),l}),xe=l=>{if(l.userIds.length>0&&(r.contraparte_user_id=l.userIds[0],l.users&&l.users.length>0)){const e=l.users[0];A.value=e,r.contraparte_nombre=e.name,r.contraparte_email=e.email||""}},he=l=>{l.userIds.length>0&&(r.responsable_id=l.userIds[0],l.users&&l.users.length>0&&(z.value=l.users[0]))},Q=C(new Map);n.contrato.participantes&&n.contrato.participantes.length>0&&n.contrato.participantes.forEach(l=>{Q.value.set(l.id,{id:l.id,name:l.name,email:l.email})});const Ce=l=>{l.userIds.forEach((e,m)=>{r.participantes.some(_=>_.user_id===e)||(r.participantes.push({user_id:e,rol:l.extraData.rol||"testigo",notas:l.extraData.notas||""}),l.users&&l.users[m]&&Q.value.set(e,l.users[m]))})},Ve=l=>{const e=r.participantes.findIndex(m=>m.user_id===l);e>-1&&r.participantes.splice(e,1)},ae=l=>Q.value.get(l),F=T(()=>{const l={informacion:[],financiero:[],otros:[]};return n.camposPersonalizados.forEach(e=>{e.slug.includes("financ")||e.slug.includes("monto")||e.slug.includes("precio")?l.financiero.push(e):e.slug.includes("info")||e.slug.includes("descrip")?l.informacion.push(e):l.otros.push(e)}),l}),c=T(()=>n.contrato.estado!=="finalizado"&&n.contrato.estado!=="cancelado"),Se=T(()=>r.data()),{state:Ee,isSaving:re,hasSaved:se,hasError:B,startWatching:ke,stopAutoSave:Ue}=Je(Se,{url:`/admin/contratos/${n.contrato.id}/autosave`,debounceTime:3e3,showNotifications:!0,useLocalStorage:!1}),$e=l=>{const e=l.target;e.files&&e.files[0]&&(r.archivo_pdf=e.files[0],_e.value="Nuevo archivo: "+e.files[0].name)},we=async l=>{try{const e=await ce(l,{module:"contratos",fieldId:"archivos",folder:"contratos",maxSize:10485760}),m=e.map($=>$.path),s=e.map($=>$.name),_={};e.forEach($=>{_[$.path]=$.mime_type}),r.archivos_paths=[...r.archivos_paths,...m],r.archivos_nombres=[...r.archivos_nombres,...s],r.tipos_archivos={...r.tipos_archivos,..._},M.value=[...M.value,...e],y.success(`${e.length} archivo(s) agregado(s) exitosamente`)}catch(e){y.error(e.message||"Error al subir archivos")}},ze=()=>{const l=[];return r.proyecto_id||l.push("Debe seleccionar un proyecto"),r.nombre.trim()||l.push("El nombre del contrato es obligatorio"),r.fecha_inicio||l.push("La fecha de inicio es obligatoria"),r.fecha_fin&&r.fecha_fin<r.fecha_inicio&&l.push("La fecha de fin debe ser posterior a la fecha de inicio"),n.camposPersonalizados.forEach(e=>{e.es_requerido&&!r.campos_personalizados[e.id]&&l.push(`El campo "${e.nombre}" es obligatorio`)}),l},Pe=()=>{const l=ze();if(l.length>0){l.forEach(m=>y.error(m));return}const e=new FormData;Object.keys(r.data()).forEach(m=>{m==="campos_personalizados"?Object.keys(r.campos_personalizados).forEach(s=>{const _=r.campos_personalizados[s];_!=null&&_!==""&&e.append(`campos_personalizados[${s}]`,_)}):m==="participantes"?r.participantes.forEach((s,_)=>{e.append(`participantes[${_}][user_id]`,s.user_id.toString()),e.append(`participantes[${_}][rol]`,s.rol),s.notas&&e.append(`participantes[${_}][notas]`,s.notas)}):m==="archivos_paths"||m==="archivos_nombres"||m==="tipos_archivos"?m==="archivos_paths"&&Array.isArray(r.archivos_paths)&&r.archivos_paths.length>0?e.append("archivos_paths",JSON.stringify(r.archivos_paths)):m==="archivos_nombres"&&Array.isArray(r.archivos_nombres)&&r.archivos_nombres.length>0?e.append("archivos_nombres",JSON.stringify(r.archivos_nombres)):m==="tipos_archivos"&&r.tipos_archivos&&Object.keys(r.tipos_archivos).length>0&&e.append("tipos_archivos",JSON.stringify(r.tipos_archivos)):m==="archivo_pdf"&&r.archivo_pdf?e.append("archivo_pdf",r.archivo_pdf):m==="responsable_id"&&r[m]==="none"||m!=="_method"&&r[m]!==null&&r[m]!==""&&e.append(m,r[m])}),e.append("_method","PUT"),O.post(U("admin.contratos.update",n.contrato.id),e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{y.success("Contrato actualizado exitosamente")},onError:m=>{typeof m=="object"&&m!==null?Object.values(m).forEach(s=>{Array.isArray(s)?s.forEach(_=>y.error(String(_))):typeof s=="string"?y.error(s):y.error("Error al actualizar el contrato")}):y.error("Error al actualizar el contrato")}})},Ae=()=>{confirm("쮼st치 seguro de eliminar este contrato? Esta acci칩n no se puede deshacer.")&&O.delete(U("admin.contratos.destroy",n.contrato.id),{onSuccess:()=>{y.success("Contrato eliminado exitosamente")},onError:()=>{y.error("Error al eliminar el contrato")}})},Fe=()=>{confirm("쮻esea duplicar este contrato?")&&O.post(U("admin.contratos.duplicar",n.contrato.id),{},{onSuccess:()=>{y.success("Contrato duplicado exitosamente")},onError:()=>{y.error("Error al duplicar el contrato")}})},L=l=>{O.post(U("admin.contratos.cambiar-estado",n.contrato.id),{estado:l},{onSuccess:()=>{r.estado=l,y.success("Estado actualizado exitosamente")},onError:()=>{y.error("Error al cambiar el estado")}})},Ne=()=>{confirm("쮼st치 seguro de cancelar? Los cambios no guardados se perder치n.")&&O.get(U("admin.contratos.show",n.contrato.id))};return De(()=>{console.log("游댌 Edit.vue - DEBUG CONTRAPARTE onMounted",{contrato_id:n.contrato.id,contraparte_user_id:n.contrato.contraparte_user_id,contraparteUser:n.contrato.contraparteUser,contraparteUser_existe:!!n.contrato.contraparteUser,contraparteSeleccionada_value:A.value,form_contraparte_user_id:r.contraparte_user_id,form_contraparte_nombre:r.contraparte_nombre}),c.value&&ke()}),je(()=>{Ue()}),(l,e)=>(u(),x(Me,{breadcrumbs:fe},{default:a(()=>{var m;return[d("div",Ze,[d("div",eo,[d("div",oo,[t(o(Te),{href:o(U)("admin.contratos.index")},{default:a(()=>[t(o(b),{variant:"ghost",size:"sm"},{default:a(()=>[t(o(We),{class:"h-4 w-4 mr-2"}),e[28]||(e[28]=i(" Volver ",-1))]),_:1})]),_:1},8,["href"]),d("div",null,[e[29]||(e[29]=d("h1",{class:"text-3xl font-bold"},"Editar Contrato",-1)),d("p",to,"Modificar informaci칩n del contrato #"+v(j.contrato.id),1)])]),d("div",ao,[t(o(b),{variant:"outline",onClick:Fe},{default:a(()=>[...e[30]||(e[30]=[i(" Duplicar ",-1)])]),_:1}),t(o(b),{variant:"destructive",onClick:Ae},{default:a(()=>[t(o(He),{class:"h-4 w-4 mr-2"}),e[31]||(e[31]=i(" Eliminar ",-1))]),_:1})])]),c.value?(u(),p("div",ro,[o(re)?(u(),x(o(Ke),{key:0,class:"h-4 w-4 animate-spin"})):o(se)&&!o(B)?(u(),x(o(Qe),{key:1,class:"h-4 w-4 text-green-600"})):o(B)?(u(),x(o(ee),{key:2,class:"h-4 w-4 text-amber-600"})):f("",!0),o(re)?(u(),p("span",so,"Guardando cambios...")):o(se)&&!o(B)?(u(),p("span",lo,"Guardado a las "+v((m=o(Ee).lastSaved)==null?void 0:m.toLocaleTimeString()),1)):o(B)?(u(),p("span",io,"Error al guardar")):f("",!0)])):f("",!0),c.value?f("",!0):(u(),x(o(de),{key:1,variant:"warning"},{default:a(()=>[t(o(ee),{class:"h-4 w-4"}),t(o(ue),null,{default:a(()=>[i(" Este contrato est치 "+v(j.contrato.estado)+" y no puede ser editado. ",1),j.contrato.estado==="finalizado"?(u(),x(o(b),{key:0,variant:"link",size:"sm",onClick:e[0]||(e[0]=s=>L("activo")),class:"ml-2"},{default:a(()=>[...e[32]||(e[32]=[i(" Reactivar ",-1)])]),_:1})):f("",!0)]),_:1})]),_:1})),c.value?(u(),x(o(V),{key:2},{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),{class:"text-lg"},{default:a(()=>[...e[33]||(e[33]=[i("Cambio R치pido de Estado",-1)])]),_:1})]),_:1}),t(o(k),null,{default:a(()=>[d("div",no,[o(r).estado==="borrador"?(u(),x(o(b),{key:0,variant:"outline",size:"sm",onClick:e[1]||(e[1]=s=>L("activo"))},{default:a(()=>[...e[34]||(e[34]=[i(" Activar Contrato ",-1)])]),_:1})):f("",!0),o(r).estado==="activo"?(u(),x(o(b),{key:1,variant:"outline",size:"sm",onClick:e[2]||(e[2]=s=>L("finalizado"))},{default:a(()=>[...e[35]||(e[35]=[i(" Finalizar Contrato ",-1)])]),_:1})):f("",!0),o(r).estado!=="cancelado"?(u(),x(o(b),{key:2,variant:"outline",size:"sm",class:"text-red-600",onClick:e[3]||(e[3]=s=>L("cancelado"))},{default:a(()=>[...e[36]||(e[36]=[i(" Cancelar Contrato ",-1)])]),_:1})):f("",!0)])]),_:1})]),_:1})):f("",!0),d("form",{onSubmit:Oe(Pe,["prevent"]),class:"space-y-6"},[t(o(Be),{modelValue:te.value,"onUpdate:modelValue":e[24]||(e[24]=s=>te.value=s)},{default:a(()=>[t(o(Le),{class:"grid w-full grid-cols-6"},{default:a(()=>[t(o(R),{value:"informacion"},{default:a(()=>[...e[37]||(e[37]=[i("Informaci칩n General",-1)])]),_:1}),t(o(R),{value:"fechas"},{default:a(()=>[...e[38]||(e[38]=[i("Fechas y Estado",-1)])]),_:1}),t(o(R),{value:"financiero"},{default:a(()=>[...e[39]||(e[39]=[i("Informaci칩n Financiera",-1)])]),_:1}),t(o(R),{value:"contraparte"},{default:a(()=>[...e[40]||(e[40]=[i("Participantes",-1)])]),_:1}),t(o(R),{value:"archivos"},{default:a(()=>[...e[41]||(e[41]=[i("Archivos",-1)])]),_:1}),t(o(R),{value:"adicional"},{default:a(()=>[...e[42]||(e[42]=[i("Informaci칩n Adicional",-1)])]),_:1})]),_:1}),t(o(D),{value:"informacion"},{default:a(()=>[t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[43]||(e[43]=[i("Informaci칩n General",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[44]||(e[44]=[i("Datos principales del contrato",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:a(()=>[d("div",uo,[d("div",null,[t(o(g),{for:"proyecto_id"},{default:a(()=>[...e[45]||(e[45]=[i("Proyecto *",-1)])]),_:1}),t(o(q),{modelValue:o(r).proyecto_id,"onUpdate:modelValue":e[4]||(e[4]=s=>o(r).proyecto_id=s),disabled:!c.value},{default:a(()=>[t(o(G),null,{default:a(()=>[t(o(J),{placeholder:"Seleccione un proyecto"})]),_:1}),t(o(X),null,{default:a(()=>[(u(!0),p(N,null,I(j.proyectos,s=>(u(),x(o(h),{key:s.id,value:s.id.toString()},{default:a(()=>[i(v(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.proyecto_id?(u(),p("div",mo,v(o(r).errors.proyecto_id),1)):f("",!0)]),d("div",null,[t(o(g),{for:"nombre"},{default:a(()=>[...e[46]||(e[46]=[i("Nombre del Contrato *",-1)])]),_:1}),t(o(P),{id:"nombre",modelValue:o(r).nombre,"onUpdate:modelValue":e[5]||(e[5]=s=>o(r).nombre=s),placeholder:"Ej: Contrato de servicios de consultor칤a",disabled:!c.value},null,8,["modelValue","disabled"]),o(r).errors.nombre?(u(),p("div",po,v(o(r).errors.nombre),1)):f("",!0)])]),d("div",null,[t(o(g),{for:"descripcion"},{default:a(()=>[...e[47]||(e[47]=[i("Descripci칩n",-1)])]),_:1}),t(o(ne),{id:"descripcion",modelValue:o(r).descripcion,"onUpdate:modelValue":e[6]||(e[6]=s=>o(r).descripcion=s),placeholder:"Descripci칩n detallada del contrato...",rows:"4",disabled:!c.value},null,8,["modelValue","disabled"]),o(r).errors.descripcion?(u(),p("div",co,v(o(r).errors.descripcion),1)):f("",!0)]),F.value.informacion.length>0?(u(),p("div",fo,[e[48]||(e[48]=d("h3",{class:"font-medium"},"Informaci칩n Complementaria",-1)),(u(!0),p(N,null,I(F.value.informacion,s=>(u(),p("div",{key:s.id},[t(Y,{campo:s,modelValue:o(r).campos_personalizados[s.id],"onUpdate:modelValue":_=>o(r).campos_personalizados[s.id]=_,disabled:!c.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):f("",!0)]),_:1})]),_:1})]),_:1}),t(o(D),{value:"fechas"},{default:a(()=>[t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[49]||(e[49]=[i("Fechas y Estado",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[50]||(e[50]=[i("Configure las fechas y el estado del contrato",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:a(()=>[d("div",vo,[d("div",null,[t(o(g),{for:"fecha_inicio"},{default:a(()=>[...e[51]||(e[51]=[i("Fecha de Inicio *",-1)])]),_:1}),t(o(P),{id:"fecha_inicio",type:"date",modelValue:o(r).fecha_inicio,"onUpdate:modelValue":e[7]||(e[7]=s=>o(r).fecha_inicio=s),disabled:!c.value},null,8,["modelValue","disabled"]),o(r).errors.fecha_inicio?(u(),p("div",_o,v(o(r).errors.fecha_inicio),1)):f("",!0)]),d("div",null,[t(o(g),{for:"fecha_fin"},{default:a(()=>[...e[52]||(e[52]=[i("Fecha de Fin",-1)])]),_:1}),t(o(P),{id:"fecha_fin",type:"date",modelValue:o(r).fecha_fin,"onUpdate:modelValue":e[8]||(e[8]=s=>o(r).fecha_fin=s),disabled:!c.value},null,8,["modelValue","disabled"]),o(r).errors.fecha_fin?(u(),p("div",bo,v(o(r).errors.fecha_fin),1)):f("",!0)]),d("div",null,[t(o(g),{for:"estado"},{default:a(()=>[...e[53]||(e[53]=[i("Estado",-1)])]),_:1}),t(o(q),{modelValue:o(r).estado,"onUpdate:modelValue":e[9]||(e[9]=s=>o(r).estado=s),disabled:!c.value},{default:a(()=>[t(o(G),null,{default:a(()=>[t(o(J))]),_:1}),t(o(X),null,{default:a(()=>[t(o(h),{value:"borrador"},{default:a(()=>[...e[54]||(e[54]=[i("Borrador",-1)])]),_:1}),t(o(h),{value:"activo"},{default:a(()=>[...e[55]||(e[55]=[i("Activo",-1)])]),_:1}),t(o(h),{value:"finalizado"},{default:a(()=>[...e[56]||(e[56]=[i("Finalizado",-1)])]),_:1}),t(o(h),{value:"cancelado"},{default:a(()=>[...e[57]||(e[57]=[i("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.estado?(u(),p("div",go,v(o(r).errors.estado),1)):f("",!0)]),d("div",null,[t(o(g),{for:"tipo"},{default:a(()=>[...e[58]||(e[58]=[i("Tipo de Contrato *",-1)])]),_:1}),t(o(q),{modelValue:o(r).tipo,"onUpdate:modelValue":e[10]||(e[10]=s=>o(r).tipo=s),disabled:!c.value},{default:a(()=>[t(o(G),null,{default:a(()=>[t(o(J))]),_:1}),t(o(X),null,{default:a(()=>[t(o(h),{value:"servicio"},{default:a(()=>[...e[59]||(e[59]=[i("Servicio",-1)])]),_:1}),t(o(h),{value:"obra"},{default:a(()=>[...e[60]||(e[60]=[i("Obra",-1)])]),_:1}),t(o(h),{value:"suministro"},{default:a(()=>[...e[61]||(e[61]=[i("Suministro",-1)])]),_:1}),t(o(h),{value:"consultoria"},{default:a(()=>[...e[62]||(e[62]=[i("Consultor칤a",-1)])]),_:1}),t(o(h),{value:"otro"},{default:a(()=>[...e[63]||(e[63]=[i("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.tipo?(u(),p("div",yo,v(o(r).errors.tipo),1)):f("",!0)])])]),_:1})]),_:1})]),_:1}),t(o(D),{value:"financiero"},{default:a(()=>[t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[64]||(e[64]=[i("Informaci칩n Financiera",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[65]||(e[65]=[i("Montos y detalles financieros del contrato",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:a(()=>[d("div",xo,[d("div",null,[t(o(g),{for:"monto_total"},{default:a(()=>[...e[66]||(e[66]=[i("Monto Total",-1)])]),_:1}),t(o(P),{id:"monto_total",type:"number",step:"0.01",modelValue:o(r).monto_total,"onUpdate:modelValue":e[11]||(e[11]=s=>o(r).monto_total=s),placeholder:"0.00",disabled:!c.value},null,8,["modelValue","disabled"]),o(r).errors.monto_total?(u(),p("div",ho,v(o(r).errors.monto_total),1)):f("",!0)]),d("div",null,[t(o(g),{for:"moneda"},{default:a(()=>[...e[67]||(e[67]=[i("Moneda",-1)])]),_:1}),t(o(q),{modelValue:o(r).moneda,"onUpdate:modelValue":e[12]||(e[12]=s=>o(r).moneda=s),disabled:!c.value},{default:a(()=>[t(o(G),null,{default:a(()=>[t(o(J))]),_:1}),t(o(X),null,{default:a(()=>[(u(),p(N,null,I(be,s=>t(o(h),{key:s.value,value:s.value},{default:a(()=>[i(v(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.moneda?(u(),p("div",Co,v(o(r).errors.moneda),1)):f("",!0)])]),F.value.financiero.length>0?(u(),p("div",Vo,[e[68]||(e[68]=d("h3",{class:"font-medium"},"Campos Financieros Personalizados",-1)),(u(!0),p(N,null,I(F.value.financiero,s=>(u(),p("div",{key:s.id},[t(Y,{campo:s,modelValue:o(r).campos_personalizados[s.id],"onUpdate:modelValue":_=>o(r).campos_personalizados[s.id]=_,disabled:!c.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):f("",!0)]),_:1})]),_:1})]),_:1}),t(o(D),{value:"contraparte"},{default:a(()=>[d("div",So,[t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[69]||(e[69]=[i("Responsable del Contrato",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[70]||(e[70]=[i(" Asigna un usuario responsable de este contrato ",-1)])]),_:1})]),_:1}),t(o(k),null,{default:a(()=>[d("div",Eo,[z.value?(u(),p("div",ko,[d("div",null,[d("p",Uo,v(z.value.name),1),d("p",$o,v(z.value.email),1)]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:e[13]||(e[13]=s=>{z.value=null,o(r).responsable_id="none"}),disabled:!c.value},{default:a(()=>[t(o(oe),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):f("",!0),t(o(b),{type:"button",variant:"outline",onClick:e[14]||(e[14]=s=>K.value=!0),class:"w-full",disabled:!c.value},{default:a(()=>[t(o(me),{class:"h-4 w-4 mr-2"}),i(" "+v(z.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[71]||(e[71]=[i("Contraparte - Usuario del Sistema",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[72]||(e[72]=[i(" Seleccione un usuario del sistema como contraparte del contrato ",-1)])]),_:1})]),_:1}),t(o(k),null,{default:a(()=>[d("div",wo,[d("div",null,[t(o(g),null,{default:a(()=>[...e[73]||(e[73]=[i("Usuario Contraparte",-1)])]),_:1}),e[74]||(e[74]=d("p",{class:"text-sm text-muted-foreground mb-2"}," Si la contraparte es un usuario registrado en el sistema, selecci칩nelo aqu칤 ",-1))]),A.value?(u(),p("div",zo,[d("div",null,[d("p",Po,v(A.value.name),1),d("p",Ao,v(A.value.email),1)]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:e[15]||(e[15]=s=>{o(r).contraparte_user_id=null,A.value.value=null,o(r).contraparte_nombre="",o(r).contraparte_email=""}),disabled:!c.value},{default:a(()=>[t(o(oe),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):f("",!0),t(o(b),{type:"button",variant:"outline",onClick:e[16]||(e[16]=s=>W.value=!0),class:"w-full",disabled:!c.value},{default:a(()=>[t(o(me),{class:"h-4 w-4 mr-2"}),i(" "+v(A.value?"Cambiar Contraparte":"Seleccionar Contraparte"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[75]||(e[75]=[i("Contraparte - Informaci칩n Externa",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[76]||(e[76]=[i(" Complete estos campos si la contraparte no es un usuario del sistema ",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:a(()=>[o(r).contraparte_user_id?(u(),x(o(de),{key:0,class:"mb-4"},{default:a(()=>[t(o(ee),{class:"h-4 w-4"}),t(o(ue),null,{default:a(()=>[...e[77]||(e[77]=[i(" Los campos de contraparte externa est치n deshabilitados porque ya se seleccion칩 un usuario del sistema. ",-1)])]),_:1})]),_:1})):f("",!0),d("div",Fo,[d("div",null,[t(o(g),{for:"contraparte_nombre"},{default:a(()=>[...e[78]||(e[78]=[i("Nombre de la Contraparte",-1)])]),_:1}),t(o(P),{id:"contraparte_nombre",modelValue:o(r).contraparte_nombre,"onUpdate:modelValue":e[17]||(e[17]=s=>o(r).contraparte_nombre=s),placeholder:"Nombre de la empresa o persona",disabled:!c.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])]),d("div",null,[t(o(g),{for:"contraparte_identificacion"},{default:a(()=>[...e[79]||(e[79]=[i("Identificaci칩n/RUC",-1)])]),_:1}),t(o(P),{id:"contraparte_identificacion",modelValue:o(r).contraparte_identificacion,"onUpdate:modelValue":e[18]||(e[18]=s=>o(r).contraparte_identificacion=s),placeholder:"N칰mero de identificaci칩n",disabled:!c.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])]),d("div",null,[t(o(g),{for:"contraparte_email"},{default:a(()=>[...e[80]||(e[80]=[i("Email de Contacto",-1)])]),_:1}),t(o(P),{id:"contraparte_email",type:"email",modelValue:o(r).contraparte_email,"onUpdate:modelValue":e[19]||(e[19]=s=>o(r).contraparte_email=s),placeholder:"email@ejemplo.com",disabled:!c.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])]),d("div",null,[t(o(g),{for:"contraparte_telefono"},{default:a(()=>[...e[81]||(e[81]=[i("Tel칠fono de Contacto",-1)])]),_:1}),t(o(P),{id:"contraparte_telefono",modelValue:o(r).contraparte_telefono,"onUpdate:modelValue":e[20]||(e[20]=s=>o(r).contraparte_telefono=s),placeholder:"+1234567890",disabled:!c.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])])])]),_:1})]),_:1}),t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[82]||(e[82]=[i("Participantes del Contrato",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[83]||(e[83]=[i(" Agregue usuarios del sistema que participar치n en este contrato con diferentes roles ",-1)])]),_:1})]),_:1}),t(o(k),null,{default:a(()=>[d("div",No,[t(o(b),{type:"button",variant:"outline",onClick:e[21]||(e[21]=s=>H.value=!0),class:"w-full",disabled:!c.value},{default:a(()=>[t(o(pe),{class:"h-4 w-4 mr-2"}),e[84]||(e[84]=i(" Agregar Participantes ",-1))]),_:1},8,["disabled"]),o(r).participantes.length>0?(u(),p("div",Io,[e[85]||(e[85]=d("p",{class:"text-sm font-medium text-muted-foreground"},"Participantes agregados:",-1)),(u(!0),p(N,null,I(o(r).participantes,s=>{var _,$;return u(),p("div",{key:s.user_id,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[d("div",Ro,[d("div",null,[d("p",Do,v((_=ae(s.user_id))==null?void 0:_.name),1),d("p",jo,v(($=ae(s.user_id))==null?void 0:$.email),1),d("div",To,[d("span",Oo,v(s.rol),1),s.notas?(u(),p("span",Mo,v(s.notas),1)):f("",!0)])]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:Jo=>Ve(s.user_id),disabled:!c.value},{default:a(()=>[t(o(oe),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])])])}),128))])):(u(),p("div",Bo,[t(o(pe),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),e[86]||(e[86]=d("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))]))])]),_:1})]),_:1})])]),_:1}),t(o(D),{value:"archivos"},{default:a(()=>[t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[87]||(e[87]=[i("Archivos del Contrato",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[88]||(e[88]=[i("Sube m칰ltiples archivos relacionados con el contrato (m치ximo 10)",-1)])]),_:1})]),_:1}),t(o(k),null,{default:a(()=>[t(Xe,{modelValue:M.value,"onUpdate:modelValue":e[22]||(e[22]=s=>M.value=s),label:"Archivos",description:"Agrega archivos adicionales al contrato (PDF, im치genes, documentos)",onFilesSelected:we,multiple:!0,maxFiles:10,maxFileSize:10,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.xls,.xlsx",autoUpload:!1,disabled:!c.value,module:"contratos",fieldId:"archivos"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(o(D),{value:"adicional"},{default:a(()=>[t(o(V),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[89]||(e[89]=[i("Informaci칩n Adicional",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[90]||(e[90]=[i("Observaciones y campos personalizados",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:a(()=>[d("div",null,[t(o(g),{for:"observaciones"},{default:a(()=>[...e[91]||(e[91]=[i("Observaciones",-1)])]),_:1}),t(o(ne),{id:"observaciones",modelValue:o(r).observaciones,"onUpdate:modelValue":e[23]||(e[23]=s=>o(r).observaciones=s),placeholder:"Notas u observaciones adicionales...",rows:"4",disabled:!c.value},null,8,["modelValue","disabled"]),o(r).errors.observaciones?(u(),p("div",Lo,v(o(r).errors.observaciones),1)):f("",!0)]),F.value.otros.length>0?(u(),p("div",qo,[e[92]||(e[92]=d("h3",{class:"font-medium"},"Campos Personalizados",-1)),(u(!0),p(N,null,I(F.value.otros,s=>(u(),p("div",{key:s.id},[t(Y,{campo:s,modelValue:o(r).campos_personalizados[s.id],"onUpdate:modelValue":_=>o(r).campos_personalizados[s.id]=_,disabled:!c.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),c.value?(u(),p("div",Go,[t(o(b),{type:"button",variant:"outline",onClick:Ne,disabled:o(r).processing},{default:a(()=>[...e[93]||(e[93]=[i(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(o(b),{type:"submit",disabled:o(r).processing},{default:a(()=>[t(o(Ye),{class:"h-4 w-4 mr-2"}),i(" "+v(o(r).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])):f("",!0)],32)]),d("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:$e,class:"hidden"},null,544),t(Z,{modelValue:W.value,"onUpdate:modelValue":e[25]||(e[25]=s=>W.value=s),title:"Seleccionar Contraparte",description:"Selecciona el usuario que ser치 la contraparte del contrato","search-endpoint":o(U)("admin.proyectos.search-users"),"excluded-ids":o(r).contraparte_user_id?[o(r).contraparte_user_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Contraparte","search-placeholder":"Buscar por nombre, email, documento o tel칠fono...",onSubmit:xe},null,8,["modelValue","search-endpoint","excluded-ids"]),t(Z,{modelValue:H.value,"onUpdate:modelValue":e[26]||(e[26]=s=>H.value=s),title:"Agregar Participantes",description:"Selecciona los usuarios que participar치n en este contrato y define su rol","search-endpoint":o(U)("admin.proyectos.search-users"),"excluded-ids":ye.value,"extra-fields":ge.value,"submit-button-text":"Agregar Participantes","search-placeholder":"Buscar por nombre, email, documento o tel칠fono...",onSubmit:Ce},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"]),t(Z,{modelValue:K.value,"onUpdate:modelValue":e[27]||(e[27]=s=>K.value=s),title:"Seleccionar Responsable",description:"Selecciona el usuario que ser치 responsable de este contrato","search-endpoint":o(U)("admin.proyectos.search-users"),"excluded-ids":z.value?[z.value.id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o tel칠fono...",onSubmit:he},null,8,["modelValue","search-endpoint","excluded-ids"])]}),_:1}))}});export{_a as default};
