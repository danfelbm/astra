import{c as S,_ as w}from"./createLucideIcon-1Ywf5Ocp.js";import{d as J,r as b,c as D,i as z,F as I,b as m,j as x,e as t,f as e,w as s,k as j,g as n,h as i,t as u,s as V,m as c,v as q,l as K,n as Q}from"./app-ATyJpd2O.js";import{c as N,_ as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-6G-r9fEC.js";import{_ as B}from"./index-B2tIfNAH.js";import{_ as W,a as X,b as U,c as p,d as Y,e as y}from"./TableHeader.vue_vue_type_script_setup_true_lang-DGnzMMs-.js";import{_ as Z,a as aa,b as ea,c as ta,d as sa}from"./AccordionContent.vue_vue_type_script_setup_true_lang-C483jRWq.js";import{e as oa,_ as la,a as ra,b as na,c as ia,d as da}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CcQQZd-J.js";import{_ as ua,a as ca,b as fa,c as ma,d as F}from"./SelectValue.vue_vue_type_script_setup_true_lang-CtGj6zeX.js";import{_ as _a}from"./Textarea.vue_vue_type_script_setup_true_lang-C3LflkWg.js";import{_ as va}from"./Label.vue_vue_type_script_setup_true_lang-CmrOjZrA.js";import{t as M}from"./index-BxEDkmHa.js";import{I as L}from"./image-4zRwSpCr.js";import{F as pa}from"./file-text-l0EtLDIi.js";import{E as ya}from"./external-link-BMl86Dil.js";import{E as ba}from"./eye-Cc46HphO.js";import{D as ga}from"./download-CufoN7RL.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=S("BanIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=S("CirclePauseIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=S("MilestoneIcon",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M4 6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h13a2 2 0 0 0 1.152-.365l3.424-2.317a1 1 0 0 0 0-1.635l-3.424-2.318A2 2 0 0 0 17 6z",key:"1btarq"}]]),xa={key:1,class:"mt-4"},ha={class:"flex items-center justify-between w-full pr-4"},$a={class:"flex items-center gap-3"},ka={class:"text-left"},Ea={class:"font-semibold"},wa={class:"text-sm text-gray-500"},za={class:"flex items-center gap-3"},Va={class:"text-sm text-gray-600"},Ca={class:"text-sm"},Da={class:"flex items-center justify-end gap-2"},Ia=["href"],Ba={class:"text-center"},Fa={class:"text-center"},Ma={class:"space-y-4 py-4"},Za=J({__name:"EvidenciasDisplay",props:{contratos:{default:()=>[]},proyectoId:{},modo:{},puedeGestionarEstado:{type:Boolean,default:!1},formatDate:{}},setup(_){const v=_,d=b({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),h=b(!1),C=b(null),f=b(null),$=b(""),g=b(!1),k=D(()=>{const o=[];return v.contratos&&v.contratos.forEach(a=>{a.obligaciones&&a.obligaciones.forEach(l=>{l.evidencias&&l.evidencias.forEach(r=>{o.push({...r,contrato_id:a.id,contrato_numero:a.numero_contrato,contrato_nombre:a.nombre,obligacion_titulo:l.titulo,_contrato:a})})})}),o}),R=D(()=>{let o=k.value;return d.value.contrato_id&&(o=o.filter(a=>a.contrato_id===d.value.contrato_id)),d.value.tipo&&(o=o.filter(a=>a.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(a=>a.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(a=>{var l;return((l=a.usuario)==null?void 0:l.id)===d.value.usuario_id})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(a=>{const l=new Date(a.created_at);if(d.value.fecha_inicio){const r=new Date(d.value.fecha_inicio);if(l<r)return!1}if(d.value.fecha_fin){const r=new Date(d.value.fecha_fin);if(r.setHours(23,59,59,999),l>r)return!1}return!0})),o}),A=D(()=>{const o={};return R.value.forEach(a=>{o[a.contrato_id]||(o[a.contrato_id]={contrato:a._contrato,evidencias:[]}),o[a.contrato_id].evidencias.push(a)}),Object.values(o)}),O=o=>v.modo==="admin"?`/admin/contratos/${o}`:`/miembro/mis-contratos/${o}`,T=(o,a)=>v.modo==="admin"?`/admin/contratos/${o}/evidencias/${a}`:`/miembro/mis-contratos/${o}/evidencias/${a}`,G=async()=>{if(!C.value||!f.value)return;g.value=!0;const o=`/api/proyectos/${v.proyectoId}/evidencias/${C.value.id}/${f.value}`;V.post(o,{observaciones:$.value||null},{preserveScroll:!0,onSuccess:()=>{M.success(f.value==="aprobar"?"Evidencia aprobada exitosamente":"Evidencia rechazada"),h.value=!1,C.value=null,f.value=null,$.value="",V.reload({only:["proyecto"]})},onError:a=>{M.error("Error al cambiar el estado de la evidencia"),console.error(a)},onFinish:()=>{g.value=!1}})},H=(o,a)=>{if(a===o.estado)return;const l=v.modo==="admin"?`/admin/proyectos/${v.proyectoId}/evidencias/${o.id}/cambiar-estado`:`/miembro/mis-proyectos/${v.proyectoId}/evidencias/${o.id}/cambiar-estado`;V.post(l,{estado:a,observaciones:null},{preserveScroll:!0,onSuccess:r=>{V.reload({only:["proyecto"]})},onError:r=>{M.error("Error al cambiar el estado"),console.error(r)}})};return(o,a)=>(c(),z(I,null,[k.value.length>0?(c(),m(Z,{key:0,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=l=>d.value=l),contratos:_.contratos||[],evidencias:k.value},null,8,["modelValue","contratos","evidencias"])):x("",!0),A.value.length>0?(c(),z("div",xa,[t(e(aa),{type:"multiple",class:"space-y-4",collapsible:""},{default:s(()=>[(c(!0),z(I,null,j(A.value,l=>(c(),m(e(ea),{key:l.contrato.id,value:`contrato-${l.contrato.id}`,class:"border rounded-lg bg-card"},{default:s(()=>[t(e(ta),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:s(()=>[n("div",ha,[n("div",$a,[t(e(pa),{class:"h-5 w-5 text-gray-500"}),n("div",ka,[n("div",Ea,u(l.contrato.nombre),1),n("div",wa,u(l.contrato.numero_contrato||"Sin número"),1)])]),n("div",za,[t(e(B),{variant:"secondary"},{default:s(()=>[i(u(l.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),t(e(q),{href:O(l.contrato.id),onClick:a[1]||(a[1]=K(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:s(()=>[a[5]||(a[5]=i(" Ver contrato ",-1)),t(e(ya),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),t(e(sa),{class:"px-4 pb-4"},{default:s(()=>[t(e(W),null,{default:s(()=>[t(e(X),null,{default:s(()=>[t(e(U),null,{default:s(()=>[t(e(p),null,{default:s(()=>[...a[6]||(a[6]=[i("Tipo",-1)])]),_:1}),t(e(p),null,{default:s(()=>[...a[7]||(a[7]=[i("Obligación",-1)])]),_:1}),t(e(p),null,{default:s(()=>[...a[8]||(a[8]=[i("Descripción",-1)])]),_:1}),_.modo==="admin"?(c(),m(e(p),{key:0},{default:s(()=>[...a[9]||(a[9]=[i("Usuario",-1)])]),_:1})):x("",!0),t(e(p),null,{default:s(()=>[...a[10]||(a[10]=[i("Estado",-1)])]),_:1}),t(e(p),null,{default:s(()=>[...a[11]||(a[11]=[i("Fecha",-1)])]),_:1}),t(e(p),{class:"text-right"},{default:s(()=>[...a[12]||(a[12]=[i("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(Y),null,{default:s(()=>[(c(!0),z(I,null,j(l.evidencias,r=>(c(),m(e(U),{key:r.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(B),{variant:"outline"},{default:s(()=>[i(u(r.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(e(y),null,{default:s(()=>[i(u(r.obligacion_titulo),1)]),_:2},1024),t(e(y),null,{default:s(()=>[n("span",Va,u(r.descripcion||"-"),1)]),_:2},1024),_.modo==="admin"?(c(),m(e(y),{key:0},{default:s(()=>{var E;return[n("span",Ca,u(((E=r.usuario)==null?void 0:E.name)||"-"),1)]}),_:2},1024)):x("",!0),t(e(y),null,{default:s(()=>[t(e(B),{class:Q({"bg-yellow-100 text-yellow-800":r.estado==="pendiente","bg-green-100 text-green-800":r.estado==="aprobada","bg-red-100 text-red-800":r.estado==="rechazada"})},{default:s(()=>[i(u(r.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(e(y),null,{default:s(()=>[i(u(_.formatDate(r.created_at)),1)]),_:2},1024),t(e(y),{class:"text-right"},{default:s(()=>[n("div",Da,[t(e(w),{variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:s(()=>[t(e(q),{href:T(r.contrato_id,r.id)},{default:s(()=>[t(e(ba),{class:"h-4 w-4"}),a[13]||(a[13]=n("span",{class:"ml-1"},"Ver",-1))]),_:1},8,["href"])]),_:2},1024),r.archivo_url?(c(),m(e(w),{key:0,variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:s(()=>[n("a",{href:r.archivo_url,target:"_blank"},[t(e(ga),{class:"h-4 w-4"}),a[14]||(a[14]=n("span",{class:"ml-1"},"Descargar",-1))],8,Ia)]),_:2},1024)):x("",!0),_.modo==="admin"||_.modo==="user"&&_.puedeGestionarEstado?(c(),m(e(ua),{key:1,"model-value":r.estado,"onUpdate:modelValue":E=>H(r,E)},{default:s(()=>[t(e(ca),{class:"h-8 w-32"},{default:s(()=>[t(e(fa))]),_:1}),t(e(ma),null,{default:s(()=>[t(e(F),{value:"pendiente"},{default:s(()=>[...a[15]||(a[15]=[n("span",{class:"text-yellow-600"},"Pendiente",-1)])]),_:1}),t(e(F),{value:"aprobada"},{default:s(()=>[...a[16]||(a[16]=[n("span",{class:"text-green-600"},"Aprobada",-1)])]),_:1}),t(e(F),{value:"rechazada"},{default:s(()=>[...a[17]||(a[17]=[n("span",{class:"text-red-600"},"Rechazada",-1)])]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):x("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):k.value.length===0?(c(),m(e(P),{key:2,class:"mt-4"},{default:s(()=>[t(e(N),{class:"py-8"},{default:s(()=>[n("div",Ba,[t(e(L),{class:"mx-auto h-12 w-12 text-gray-400"}),a[18]||(a[18]=n("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias cargadas",-1)),a[19]||(a[19]=n("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(c(),m(e(P),{key:3,class:"mt-4"},{default:s(()=>[t(e(N),{class:"py-8"},{default:s(()=>[n("div",Fa,[t(e(L),{class:"mx-auto h-12 w-12 text-gray-400"}),a[20]||(a[20]=n("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),a[21]||(a[21]=n("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1})),t(e(oa),{open:h.value,"onUpdate:open":a[4]||(a[4]=l=>h.value=l)},{default:s(()=>[t(e(la),null,{default:s(()=>[t(e(ra),null,{default:s(()=>[t(e(na),null,{default:s(()=>[i(u(f.value==="aprobar"?"Aprobar Evidencia":"Rechazar Evidencia"),1)]),_:1}),t(e(ia),null,{default:s(()=>[i(u(f.value==="aprobar"?"Estás a punto de aprobar esta evidencia. Puedes agregar observaciones opcionales.":"Estás a punto de rechazar esta evidencia. Es recomendable agregar el motivo del rechazo."),1)]),_:1})]),_:1}),n("div",Ma,[n("div",null,[t(e(va),{for:"observaciones"},{default:s(()=>[i(" Observaciones "+u(f.value==="rechazar"?"(recomendado)":"(opcional)"),1)]),_:1}),t(e(_a),{id:"observaciones",modelValue:$.value,"onUpdate:modelValue":a[2]||(a[2]=l=>$.value=l),placeholder:f.value==="rechazar"?"Explica el motivo del rechazo...":"Agrega comentarios adicionales...",rows:"4",class:"mt-2"},null,8,["modelValue","placeholder"])])]),t(e(da),null,{default:s(()=>[t(e(w),{variant:"outline",onClick:a[3]||(a[3]=l=>h.value=!1),disabled:g.value},{default:s(()=>[...a[22]||(a[22]=[i(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(e(w),{variant:f.value==="aprobar"?"default":"destructive",onClick:G,disabled:g.value},{default:s(()=>[i(u(g.value?"Procesando...":f.value==="aprobar"?"Aprobar":"Rechazar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])],64))}});export{Wa as B,Xa as C,Ya as M,Za as _};
