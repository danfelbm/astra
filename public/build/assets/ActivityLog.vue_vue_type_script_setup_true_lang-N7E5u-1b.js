import{d as q,r as G,c as H,p as J,b as A,i as o,f as s,w as c,e as l,g as i,j as h,h as f,t,F as k,k as B,m as a,v as R,n as C}from"./app-D295TwpG.js";import{_ as S,a as T,b as E}from"./index-D-3TFOik.js";import{_ as K,a as Q,b as W,c as X}from"./CardTitle.vue_vue_type_script_setup_true_lang-BxiJGsdC.js";import{_ as Y}from"./CardDescription.vue_vue_type_script_setup_true_lang-C5ihZYBK.js";import{_ as $}from"./index-pTKOFCV9.js";import{_ as L}from"./createLucideIcon-D-eVYV0X.js";import{C as V}from"./SelectValue.vue_vue_type_script_setup_true_lang-BgxQu3ec.js";import{A as I}from"./arrow-right-CMbRvqg_.js";import{p as Z}from"./parseISO-DFjB8F03.js";import{f as ee,e as te}from"./es-BDPlFIsO.js";const se={class:"flex items-center justify-between"},ae={key:0,class:"text-xs text-muted-foreground"},re={key:0,class:"space-y-4"},ne={class:"flex-1 min-w-0"},oe={class:"text-sm"},le={key:0,class:"inline-flex items-center gap-1.5 mt-1.5 flex-wrap"},de={class:"flex items-center gap-2 mt-1"},ce={class:"text-xs text-muted-foreground"},ie={key:0,class:"text-xs text-muted-foreground"},ue={key:0,class:"pt-2 text-center"},fe={key:1,class:"text-center py-8"},me={class:"text-sm text-muted-foreground"},_e={key:1},pe={key:0,class:"space-y-4"},ge={class:"flex-1 min-w-0"},he={class:"text-sm"},xe={key:0,class:"inline-flex items-center gap-1.5 mt-1.5 flex-wrap"},ke={class:"flex items-center gap-2 mt-1"},be={class:"text-xs text-muted-foreground"},ve={key:0,class:"text-xs text-muted-foreground"},we={key:0,class:"pt-2 text-center"},ye={key:1,class:"text-center py-8"},Ce={class:"text-sm text-muted-foreground"},Be=q({__name:"ActivityLog",props:{activities:{},title:{default:"Historial de Actividad"},description:{default:"Registro completo de cambios y eventos"},emptyMessage:{default:"No hay actividad registrada"},showCard:{type:Boolean,default:!0},perPage:{default:20}},setup(_){const b=_,M=G(1),x=H(()=>{const d=M.value*b.perPage;return b.activities.slice(0,d)}),P=H(()=>x.value.length<b.activities.length),v=H(()=>b.activities.length),j=()=>{M.value++};J(()=>b.activities,()=>{M.value=1},{deep:!0});const z=r=>{try{const d=Z(r),m=new Date().getTime()-d.getTime(),u=Math.floor(m/6e4),n=Math.floor(m/36e5),g=Math.floor(m/864e5);return u<1?"Hace un momento":u<60?`Hace ${u} ${u===1?"minuto":"minutos"}`:n<24?`Hace ${n} ${n===1?"hora":"horas"}`:g<7?`Hace ${g} ${g===1?"día":"días"}`:ee(d,"d 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:te})}catch{return r}},D=r=>r?r.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2):"SI",N=r=>{if(!r)return"";const d=r.split("\\");return d[d.length-1]},p=r=>{const d=r.description||"",e=r.properties;if(e!=null&&e.entidad_url&&(e!=null&&e.entidad_nombre)&&(e!=null&&e.entidad_tipo)){const m=new RegExp(`(.*)(en ${e.entidad_tipo} ')([^']+)('.*)`),u=d.match(m);if(u)return{before:u[1]+`en ${e.entidad_tipo} '`,linkText:u[3],linkUrl:e.entidad_url,after:u[4]}}return{text:d}},U=r=>{var d,e;return r.event==="state_changed"&&((d=r.properties)==null?void 0:d.old_value)&&((e=r.properties)==null?void 0:e.new_value)},F={planificacion:"Planificación",en_progreso:"En Progreso",pausado:"Pausado",completado:"Completado",cancelado:"Cancelado",pendiente:"Pendiente",aprobada:"Aprobada",rechazada:"Rechazada"},O={pendiente:"gray",planificacion:"blue",en_progreso:"yellow",pausado:"orange",completado:"green",cancelado:"red",aprobada:"green",rechazada:"red"},w=r=>F[r]||r,y=r=>{const d=O[r]||"gray",e={green:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",red:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",gray:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"};return e[d]||e.gray};return(r,d)=>_.showCard?(a(),A(s(K),{key:0},{default:c(()=>[l(s(Q),null,{default:c(()=>[i("div",se,[i("div",null,[l(s(W),null,{default:c(()=>[f(t(_.title),1)]),_:1}),l(s(Y),null,{default:c(()=>[f(t(_.description),1)]),_:1})]),v.value>0?(a(),o("span",ae,t(x.value.length)+" de "+t(v.value),1)):h("",!0)])]),_:1}),l(s(X),null,{default:c(()=>[_.activities&&_.activities.length>0?(a(),o("div",re,[(a(!0),o(k,null,B(x.value,e=>{var m,u;return a(),o("div",{key:e.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[l(s(S),{class:"h-8 w-8 flex-shrink-0"},{default:c(()=>{var n;return[(n=e.causer)!=null&&n.avatar?(a(),A(s(T),{key:0,src:e.causer.avatar},null,8,["src"])):h("",!0),l(s(E),null,{default:c(()=>{var g;return[f(t(D(((g=e.causer)==null?void 0:g.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),i("div",ne,[i("p",oe,[p(e).linkUrl?(a(),o(k,{key:0},[i("span",null,t(p(e).before),1),l(s(R),{href:p(e).linkUrl,class:"font-medium text-primary hover:underline"},{default:c(()=>[f(t(p(e).linkText),1)]),_:2},1032,["href"]),i("span",null,t(p(e).after),1)],64)):(a(),o(k,{key:1},[f(t(e.description),1)],64))]),U(e)?(a(),o("div",le,[l(s($),{variant:"outline",class:C(["text-xs h-5 font-normal",y((m=e.properties)==null?void 0:m.old_value)])},{default:c(()=>{var n;return[f(t(w((n=e.properties)==null?void 0:n.old_value)),1)]}),_:2},1032,["class"]),l(s(I),{class:"h-3 w-3 text-muted-foreground flex-shrink-0"}),l(s($),{variant:"outline",class:C(["text-xs h-5 font-medium",y((u=e.properties)==null?void 0:u.new_value)])},{default:c(()=>{var n;return[f(t(w((n=e.properties)==null?void 0:n.new_value)),1)]}),_:2},1032,["class"])])):h("",!0),i("div",de,[i("p",ce,t(z(e.created_at)),1),e.subject_type?(a(),o("span",ie," • "+t(N(e.subject_type)),1)):h("",!0)])])])}),128)),P.value?(a(),o("div",ue,[l(s(L),{variant:"ghost",size:"sm",onClick:j,class:"text-muted-foreground"},{default:c(()=>[l(s(V),{class:"h-4 w-4 mr-1"}),f(" Cargar más ("+t(v.value-x.value.length)+" restantes) ",1)]),_:1})])):h("",!0)])):(a(),o("div",fe,[i("p",me,t(_.emptyMessage),1)]))]),_:1})]),_:1})):(a(),o("div",_e,[_.activities&&_.activities.length>0?(a(),o("div",pe,[(a(!0),o(k,null,B(x.value,e=>{var m,u;return a(),o("div",{key:e.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[l(s(S),{class:"h-8 w-8 flex-shrink-0"},{default:c(()=>{var n;return[(n=e.causer)!=null&&n.avatar?(a(),A(s(T),{key:0,src:e.causer.avatar},null,8,["src"])):h("",!0),l(s(E),null,{default:c(()=>{var g;return[f(t(D(((g=e.causer)==null?void 0:g.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),i("div",ge,[i("p",he,[p(e).linkUrl?(a(),o(k,{key:0},[i("span",null,t(p(e).before),1),l(s(R),{href:p(e).linkUrl,class:"font-medium text-primary hover:underline"},{default:c(()=>[f(t(p(e).linkText),1)]),_:2},1032,["href"]),i("span",null,t(p(e).after),1)],64)):(a(),o(k,{key:1},[f(t(e.description),1)],64))]),U(e)?(a(),o("div",xe,[l(s($),{variant:"outline",class:C(["text-xs h-5 font-normal",y((m=e.properties)==null?void 0:m.old_value)])},{default:c(()=>{var n;return[f(t(w((n=e.properties)==null?void 0:n.old_value)),1)]}),_:2},1032,["class"]),l(s(I),{class:"h-3 w-3 text-muted-foreground flex-shrink-0"}),l(s($),{variant:"outline",class:C(["text-xs h-5 font-medium",y((u=e.properties)==null?void 0:u.new_value)])},{default:c(()=>{var n;return[f(t(w((n=e.properties)==null?void 0:n.new_value)),1)]}),_:2},1032,["class"])])):h("",!0),i("div",ke,[i("p",be,t(z(e.created_at)),1),e.subject_type?(a(),o("span",ve," • "+t(N(e.subject_type)),1)):h("",!0)])])])}),128)),P.value?(a(),o("div",we,[l(s(L),{variant:"ghost",size:"sm",onClick:j,class:"text-muted-foreground"},{default:c(()=>[l(s(V),{class:"h-4 w-4 mr-1"}),f(" Cargar más ("+t(v.value-x.value.length)+" restantes) ",1)]),_:1})])):h("",!0)])):(a(),o("div",ye,[i("p",Ce,t(_.emptyMessage),1)]))]))}});export{Be as _};
