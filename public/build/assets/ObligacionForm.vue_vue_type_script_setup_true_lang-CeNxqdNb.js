import{d as J,r as C,i as f,e as t,g as c,w as l,f as a,h as s,j as _,b as y,n as I,F as w,k as V,t as b,l as Q,m as o}from"./app-CC6H0n1q.js";import{a as D,b as N,c as P,_ as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-cEX4BYE9.js";import{_ as h}from"./Label.vue_vue_type_script_setup_true_lang-CI7Ki7bk.js";import{_ as E}from"./Input.vue_vue_type_script_setup_true_lang-S95rAL8g.js";import{_ as R}from"./Textarea.vue_vue_type_script_setup_true_lang-CatedLfi.js";import{_ as k}from"./createLucideIcon-dYX5Zc3c.js";import{_ as L}from"./index-BF-_iLjl.js";import{_ as Y,a as Z,b as ee,c as ae,d as O}from"./SelectValue.vue_vue_type_script_setup_true_lang-2Hoc4pax.js";import{_ as B}from"./InputError.vue_vue_type_script_setup_true_lang-DER2qlcz.js";import{L as te}from"./loader-circle-CTj9aK9-.js";import{P as le}from"./paperclip-Dzt3sLqz.js";import{X as T}from"./x-Cqilunz3.js";import{U as ie}from"./upload-Dc6txLSd.js";const se={key:0},oe={key:0,class:"mb-4"},ne={class:"space-y-2 mt-2"},re={class:"flex items-center gap-2"},ue={class:"text-sm"},de={key:1,class:"mt-4"},ce={class:"space-y-2 mt-2"},me={class:"flex items-center gap-2"},fe={class:"text-sm"},ve={class:"flex justify-end gap-2"},Ae=J({__name:"ObligacionForm",props:{obligacion:{},contratoId:{},parentId:{},onSubmit:{},onCancel:{},loading:{type:Boolean,default:!1},errors:{default:()=>({})}},emits:["submit","cancel"],setup(i,{emit:K}){var z,M,F;const x=i,q=K,n=C({contrato_id:x.contratoId,parent_id:x.parentId||((z=x.obligacion)==null?void 0:z.parent_id)||null,titulo:((M=x.obligacion)==null?void 0:M.titulo)||"",descripcion:((F=x.obligacion)==null?void 0:F.descripcion)||"",archivos:[],archivos_eliminar:[]}),v=C([]),A=C([]),G=()=>{const r={...n.value,archivos:v.value};q("submit",r)},W=r=>{const e=r.target;if(!e.files)return;const g=Array.from(e.files).filter(u=>u.size>5*1024*1024?(alert(`El archivo ${u.name} excede el tamaño máximo de 5MB`),!1):!0);v.value.push(...g),n.value.archivos=v.value,e.value=""},X=r=>{v.value.splice(r,1),n.value.archivos=v.value},H=r=>{confirm("¿Estás seguro de eliminar este archivo?")&&(n.value.archivos_eliminar=n.value.archivos_eliminar||[],n.value.archivos_eliminar.push(r))},j=r=>{if(!r)return"0 KB";const e=["B","KB","MB","GB"],m=Math.floor(Math.log(r)/Math.log(1024));return`${(r/Math.pow(1024,m)).toFixed(1)} ${e[m]}`};return(r,e)=>(o(),f("form",{onSubmit:Q(G,["prevent"]),class:"space-y-4"},[t(a(U),null,{default:l(()=>[t(a(D),null,{default:l(()=>[t(a(N),null,{default:l(()=>[...e[4]||(e[4]=[s("Información Básica",-1)])]),_:1})]),_:1}),t(a(P),{class:"space-y-4"},{default:l(()=>{var m,g,u,p,$;return[c("div",null,[t(a(h),{for:"titulo",required:""},{default:l(()=>[...e[5]||(e[5]=[s("Título",-1)])]),_:1}),t(a(E),{id:"titulo",modelValue:n.value.titulo,"onUpdate:modelValue":e[0]||(e[0]=d=>n.value.titulo=d),type:"text",placeholder:"Título de la obligación",class:I({"border-red-500":(m=i.errors)==null?void 0:m.titulo})},null,8,["modelValue","class"]),(g=i.errors)!=null&&g.titulo?(o(),y(B,{key:0,message:i.errors.titulo[0]},null,8,["message"])):_("",!0)]),c("div",null,[t(a(h),{for:"descripcion"},{default:l(()=>[...e[6]||(e[6]=[s("Descripción",-1)])]),_:1}),t(a(R),{id:"descripcion",modelValue:n.value.descripcion,"onUpdate:modelValue":e[1]||(e[1]=d=>n.value.descripcion=d),placeholder:"Descripción detallada de la obligación",rows:3,class:I({"border-red-500":(u=i.errors)==null?void 0:u.descripcion})},null,8,["modelValue","class"]),(p=i.errors)!=null&&p.descripcion?(o(),y(B,{key:0,message:i.errors.descripcion[0]},null,8,["message"])):_("",!0)]),A.value.length>0?(o(),f("div",se,[t(a(h),{for:"parent_id"},{default:l(()=>[...e[7]||(e[7]=[s("Obligación Padre",-1)])]),_:1}),t(a(Y),{modelValue:n.value.parent_id,"onUpdate:modelValue":e[2]||(e[2]=d=>n.value.parent_id=d)},{default:l(()=>[t(a(Z),{id:"parent_id"},{default:l(()=>[t(a(ee),{placeholder:"Seleccionar obligación padre (opcional)"})]),_:1}),t(a(ae),null,{default:l(()=>[t(a(O),{value:null},{default:l(()=>[...e[8]||(e[8]=[s("Sin padre (raíz)",-1)])]),_:1}),(o(!0),f(w,null,V(A.value,d=>{var S;return o(),y(a(O),{key:d.id,value:d.id,disabled:d.id===((S=i.obligacion)==null?void 0:S.id)},{default:l(()=>[s(b("  ".repeat(d.nivel))+b(d.titulo),1)]),_:2},1032,["value","disabled"])}),128))]),_:1})]),_:1},8,["modelValue"]),($=i.errors)!=null&&$.parent_id?(o(),y(B,{key:0,message:i.errors.parent_id[0]},null,8,["message"])):_("",!0)])):_("",!0)]}),_:1})]),_:1}),t(a(U),null,{default:l(()=>[t(a(D),null,{default:l(()=>[t(a(N),null,{default:l(()=>[...e[9]||(e[9]=[s("Archivos Adjuntos",-1)])]),_:1})]),_:1}),t(a(P),null,{default:l(()=>{var m,g;return[(g=(m=i.obligacion)==null?void 0:m.archivos_adjuntos)!=null&&g.length?(o(),f("div",oe,[t(a(h),null,{default:l(()=>[...e[10]||(e[10]=[s("Archivos actuales",-1)])]),_:1}),c("div",ne,[(o(!0),f(w,null,V(i.obligacion.archivos_adjuntos,(u,p)=>(o(),f("div",{key:p,class:"flex items-center justify-between p-2 bg-gray-50 rounded-lg"},[c("div",re,[t(a(le),{class:"h-4 w-4 text-gray-500"}),c("span",ue,b(u.nombre_original),1),t(a(L),{variant:"outline",class:"text-xs"},{default:l(()=>[s(b(j(u.tamaño)),1)]),_:2},1024)]),t(a(k),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 text-red-600",onClick:$=>H(u.ruta)},{default:l(()=>[t(a(T),{class:"h-4 w-4"})]),_:1},8,["onClick"])]))),128))])])):_("",!0),c("div",null,[t(a(h),{for:"archivos"},{default:l(()=>[...e[11]||(e[11]=[s("Agregar nuevos archivos",-1)])]),_:1}),t(a(E),{id:"archivos",type:"file",multiple:"",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",onChange:W,class:"mt-1"}),e[12]||(e[12]=c("p",{class:"text-xs text-gray-500 mt-1"}," Formatos permitidos: PDF, Word, Excel, Imágenes. Máximo 5MB por archivo. ",-1))]),v.value.length>0?(o(),f("div",de,[t(a(h),null,{default:l(()=>[...e[13]||(e[13]=[s("Archivos a subir",-1)])]),_:1}),c("div",ce,[(o(!0),f(w,null,V(v.value,(u,p)=>(o(),f("div",{key:p,class:"flex items-center justify-between p-2 bg-blue-50 rounded-lg"},[c("div",me,[t(a(ie),{class:"h-4 w-4 text-blue-500"}),c("span",fe,b(u.name),1),t(a(L),{variant:"outline",class:"text-xs"},{default:l(()=>[s(b(j(u.size)),1)]),_:2},1024)]),t(a(k),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8",onClick:$=>X(p)},{default:l(()=>[t(a(T),{class:"h-4 w-4"})]),_:1},8,["onClick"])]))),128))])])):_("",!0)]}),_:1})]),_:1}),c("div",ve,[t(a(k),{type:"button",variant:"outline",onClick:e[3]||(e[3]=m=>r.$emit("cancel")),disabled:i.loading},{default:l(()=>[...e[14]||(e[14]=[s(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(a(k),{type:"submit",disabled:i.loading||!n.value.titulo},{default:l(()=>[i.loading?(o(),y(a(te),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):_("",!0),s(" "+b(i.obligacion?"Actualizar":"Crear")+" Obligación ",1)]),_:1},8,["disabled"])])],32))}});export{Ae as _};
