import{_ as j,C as A}from"./index-Dv-N3nwb.js";import{_ as g}from"./createLucideIcon-fihB36_E.js";import{_ as U,c as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-BgMXDg7e.js";import{_ as M}from"./Label.vue_vue_type_script_setup_true_lang-DBH3RslB.js";import{S as H,U as N,_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-DXwxsvvK.js";import{d as V,a as c,i as y,o as i,f as s,F as w,r as L,j as R,u as o,W as F,k as v,w as G,b as t,m as I,e as r,g as m,P as q,t as n,n as K}from"./app-DqUUG6Uh.js";import{_ as Q}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-CxkVsuN5.js";import{_ as X,a as Y,b as Z,c as ee,d as se,e as te}from"./DialogTitle.vue_vue_type_script_setup_true_lang-VfKRmWZM.js";import{_ as P}from"./Checkbox.vue_vue_type_script_setup_true_lang-DkxFB_ng.js";import{S as $}from"./send-QZWJRiK2.js";import{C as T}from"./clock-DrZC4Oy0.js";import{E as oe}from"./eye-1gmG0GWv.js";import{M as ae}from"./mail-BpPk8t54.js";import{M as re}from"./message-square--a7-NRrD.js";import"./index-DMtk79jl.js";import"./check-DFZdBX2N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DJ--NQfK.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-BfjlA0yq.js";import"./VisuallyHidden-C65ewHkz.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Drb3Q11h.js";import"./index-BPAHaQmV.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-CjsvxRD5.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-wePZGNCu.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DHVOv7YH.js";import"./es-DfN3vIXC.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-B-4nWNsC.js";import"./loader-circle-BymuSi6n.js";import"./trash-2-mazZLuKr.js";import"./plus-Cq8vfEh_.js";import"./search-FCxU_t5s.js";import"./history-Md_K4c3Y.js";import"./save-BRONYL_b.js";const ne={key:0,class:"mt-6 flex justify-center"},ie={class:"flex items-center gap-2"},le=["innerHTML"],de=V({__name:"Pagination",props:{links:{}},setup(S){const f=l=>({"pagination.previous":"&laquo; Anterior","pagination.next":"Siguiente &raquo;","&laquo; Previous":"&laquo; Anterior","Next &raquo;":"Siguiente &raquo;",Previous:"Anterior",Next:"Siguiente","...":"..."})[l]||l,k=l=>{l&&F.get(l)};return(l,C)=>l.links&&l.links.length>3?(i(),c("div",ne,[s("div",ie,[(i(!0),c(w,null,L(l.links,p=>(i(),c(w,{key:p.label},[p.url?(i(),R(o(g),{key:0,variant:p.active?"default":"outline",size:"sm",onClick:_=>k(p.url),innerHTML:f(p.label)},null,8,["variant","onClick","innerHTML"])):(i(),c("span",{key:1,class:"px-3 py-1 text-sm text-muted-foreground cursor-not-allowed",innerHTML:f(p.label)},null,8,le))],64))),128))])])):y("",!0)}}),ue={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ce={class:"flex items-center justify-between"},me={class:"flex gap-3"},pe={key:0,class:"text-center py-8"},fe={key:1,class:"space-y-4"},_e={class:"flex items-start justify-between"},ve={class:"flex-1"},ge={class:"flex items-center gap-2 mb-2"},xe={class:"text-lg font-semibold"},be={class:"text-muted-foreground mb-3"},he={class:"grid gap-2 md:grid-cols-2 lg:grid-cols-4 text-sm"},ye={class:"flex items-center gap-2"},we={class:"flex items-center gap-2"},ke={key:0},Ce={class:"text-muted-foreground"},$e={key:1},Se={key:0,class:"flex items-center gap-2"},Ee={class:"flex items-center gap-2"},je={key:0,class:"mt-3 p-2 bg-blue-50 dark:bg-blue-950/20 rounded border-l-4 border-blue-200 dark:border-blue-800"},Ae={class:"text-sm text-blue-800 dark:text-blue-200"},Me={class:"flex items-center gap-2 ml-4"},Ne={class:"space-y-6"},qe={class:"bg-orange-50 border border-orange-200 rounded-lg p-4"},Pe={class:"flex items-center gap-2 mb-3"},Te={class:"grid grid-cols-2 gap-3 text-sm"},Ve={class:"flex justify-between"},Le={class:"font-medium text-orange-900"},Re={class:"flex justify-between"},Fe={class:"font-medium text-orange-900"},We={class:"flex justify-between"},Be={class:"font-medium text-orange-900"},De={class:"flex justify-between"},Oe={class:"font-medium text-red-700"},Ue={class:"space-y-4"},ze={class:"space-y-3"},He={class:"flex items-center space-x-3"},Je={class:"flex items-center gap-2"},Ge={class:"text-sm text-muted-foreground ml-1"},Ie={class:"flex items-center space-x-3"},Ke={class:"flex items-center gap-2"},Qe={class:"text-sm text-muted-foreground ml-1"},Ms=V({__name:"Index",props:{candidaturas:{},filters:{},filterFieldsConfig:{}},setup(S){const f=S,k=[{title:"Admin",href:"/admin/dashboard"},{title:"Candidaturas",href:"#"}],l=v({estado:f.filters.estado||"null",search:f.filters.search||""});G(l,u=>{const e=Object.entries(u).reduce((a,[O,E])=>(a[O]=E==="null"?"":E,a),{});F.get("/admin/candidaturas",e,{preserveState:!0,replace:!0})},{deep:!0});const C={fields:f.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por nombre o email...",quickSearchFields:["user.name","user.email"],maxNestingLevel:2,allowSaveFilters:!0,debounceTime:500,autoApply:!1},{route:p}=window,_=v(!1),x=v(!1),b=v(!0),h=v(!0),d=v({total_borradores:0,con_email:0,con_telefono:0,sin_email:0,sin_telefono:0}),W=u=>new Date(u).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=async()=>{try{const e=await(await fetch(p("admin.candidaturas.estadisticas-borradores"))).json();d.value=e,_.value=!0}catch(u){console.error("Error cargando estadísticas:",u),alert("Error cargando estadísticas de candidaturas en borrador")}},D=async()=>{var u;if(!b.value&&!h.value){alert("Debes seleccionar al menos un tipo de recordatorio (email o WhatsApp)");return}x.value=!0;try{const a=await(await fetch(p("admin.candidaturas.enviar-recordatorios"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((u=document.querySelector('meta[name="csrf-token"]'))==null?void 0:u.getAttribute("content"))||""},body:JSON.stringify({incluir_email:b.value,incluir_whatsapp:h.value})})).json();a.success?(_.value=!1,alert(`Recordatorios enviados exitosamente!

• Candidaturas procesadas: ${a.contadores.total_candidaturas}
• Correos programados: ${a.contadores.emails_enviados}
• WhatsApps programados: ${a.contadores.whatsapps_enviados}
• Errores: ${a.contadores.errores}

Los mensajes se están enviando en segundo plano respetando los límites de velocidad configurados.`)):alert(`Error: ${a.message}`)}catch(e){console.error("Error enviando recordatorios:",e),alert("Error enviando recordatorios. Por favor intenta de nuevo.")}finally{x.value=!1}};return(u,e)=>(i(),c(w,null,[t(o(I),{title:"Candidaturas"}),t(J,{breadcrumbs:k},{default:r(()=>[s("div",ue,[s("div",ce,[e[6]||(e[6]=s("div",null,[s("h1",{class:"text-3xl font-bold"},"Candidaturas"),s("p",{class:"text-muted-foreground"}," Revisa y gestiona los perfiles de candidatura de los usuarios ")],-1)),s("div",me,[t(o(g),{onClick:B,variant:"outline",class:"bg-orange-50 border-orange-200 text-orange-700 hover:bg-orange-100 hover:border-orange-300"},{default:r(()=>[t(o($),{class:"mr-2 h-4 w-4"}),e[4]||(e[4]=m(" Recordatorios "))]),_:1}),t(o(q),{href:"/admin/candidaturas/configuracion"},{default:r(()=>[t(o(g),null,{default:r(()=>[t(o(H),{class:"mr-2 h-4 w-4"}),e[5]||(e[5]=m(" Configuración "))]),_:1})]),_:1})])]),t(Q,{config:C,route:o(p)("admin.candidaturas.index"),"initial-filters":{quickSearch:l.value.search,rootGroup:l.value.advanced_filters?JSON.parse(l.value.advanced_filters):void 0}},null,8,["route","initial-filters"]),t(o(U),null,{default:r(()=>[t(o(z),{class:"pt-6"},{default:r(()=>[u.candidaturas.data.length===0?(i(),c("div",pe,[t(o(N),{class:"mx-auto h-12 w-12 text-muted-foreground"}),e[7]||(e[7]=s("h3",{class:"mt-4 text-lg font-medium"},"No hay candidaturas",-1)),e[8]||(e[8]=s("p",{class:"text-muted-foreground"},"No se encontraron candidaturas con los filtros aplicados.",-1))])):(i(),c("div",fe,[(i(!0),c(w,null,L(u.candidaturas.data,a=>(i(),c("div",{key:a.id,class:"border rounded-lg p-4 hover:bg-muted/50 transition-colors"},[s("div",_e,[s("div",ve,[s("div",ge,[s("h3",xe,n(a.usuario.name),1),t(o(j),{class:K(a.estado_color)},{default:r(()=>[m(n(a.estado_label),1)]),_:2},1032,["class"]),a.esta_pendiente?(i(),R(o(j),{key:0,variant:"outline",class:"bg-blue-50 text-blue-700"},{default:r(()=>e[9]||(e[9]=[m(" Pendiente Revisión ")])),_:1})):y("",!0)]),s("p",be,n(a.usuario.email),1),s("div",he,[s("div",ye,[t(o(T),{class:"h-4 w-4 text-muted-foreground"}),e[10]||(e[10]=s("span",{class:"font-medium"},"Versión:",-1)),s("span",null,n(a.version),1)]),s("div",we,[t(o(A),{class:"h-4 w-4 text-muted-foreground"}),e[11]||(e[11]=s("span",{class:"font-medium"},"Datos:",-1)),a.total_campos>0?(i(),c("span",ke,[m(n(a.campos_llenados)+" / "+n(a.total_campos)+" ",1),s("span",Ce,"("+n(a.porcentaje_completado)+"%)",1)])):(i(),c("span",$e,"Sin configuración"))]),a.aprobado_por?(i(),c("div",Se,[t(o(N),{class:"h-4 w-4 text-muted-foreground"}),e[12]||(e[12]=s("span",{class:"font-medium"},"Aprobado por:",-1)),s("span",null,n(a.aprobado_por.name),1)])):y("",!0),s("div",Ee,[t(o(T),{class:"h-4 w-4 text-muted-foreground"}),e[13]||(e[13]=s("span",{class:"font-medium"},"Actualizado:",-1)),s("span",null,n(W(a.updated_at)),1)])]),a.comentarios_admin?(i(),c("div",je,[s("p",Ae,[e[14]||(e[14]=s("span",{class:"font-medium"},"Comentarios de la comisión:",-1)),m(" "+n(a.comentarios_admin),1)])])):y("",!0)]),s("div",Me,[t(o(q),{href:`/admin/candidaturas/${a.id}`},{default:r(()=>[t(o(g),{variant:"outline",size:"sm"},{default:r(()=>[t(o(oe),{class:"h-4 w-4"})]),_:1})]),_:2},1032,["href"])])])]))),128))])),t(de,{links:u.candidaturas.links},null,8,["links"])]),_:1})]),_:1}),t(o(X),{open:_.value,"onUpdate:open":e[3]||(e[3]=a=>_.value=a)},{default:r(()=>[t(o(Y),{class:"sm:max-w-md"},{default:r(()=>[t(o(Z),null,{default:r(()=>[t(o(ee),{class:"flex items-center gap-2"},{default:r(()=>[t(o($),{class:"h-5 w-5 text-orange-600"}),e[15]||(e[15]=m(" Enviar Recordatorios Masivos "))]),_:1}),t(o(se),null,{default:r(()=>e[16]||(e[16]=[m(" Envía recordatorios por correo y/o WhatsApp a todas las candidaturas en estado borrador. ")])),_:1})]),_:1}),s("div",Ne,[s("div",qe,[s("div",Pe,[t(o(A),{class:"h-5 w-5 text-orange-600"}),e[17]||(e[17]=s("h3",{class:"font-medium text-orange-900"},"Candidaturas en Borrador",-1))]),s("div",Te,[s("div",Ve,[e[18]||(e[18]=s("span",{class:"text-orange-700"},"Total en borrador:",-1)),s("span",Le,n(d.value.total_borradores),1)]),s("div",Re,[e[19]||(e[19]=s("span",{class:"text-orange-700"},"Con email:",-1)),s("span",Fe,n(d.value.con_email),1)]),s("div",We,[e[20]||(e[20]=s("span",{class:"text-orange-700"},"Con teléfono:",-1)),s("span",Be,n(d.value.con_telefono),1)]),s("div",De,[e[21]||(e[21]=s("span",{class:"text-red-600"},"Sin contacto:",-1)),s("span",Oe,n(Math.max(0,d.value.total_borradores-Math.max(d.value.con_email,d.value.con_telefono))),1)])])]),s("div",Ue,[e[24]||(e[24]=s("h4",{class:"font-medium text-gray-900"},"Selecciona los tipos de recordatorio:",-1)),s("div",ze,[s("div",He,[t(o(P),{id:"include-email",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),disabled:d.value.con_email===0},null,8,["modelValue","disabled"]),s("div",Je,[t(o(ae),{class:"h-4 w-4 text-blue-600"}),t(o(M),{for:"include-email",class:"flex-1"},{default:r(()=>[e[22]||(e[22]=m(" Correo electrónico ")),s("span",Ge," ("+n(d.value.con_email)+" candidaturas) ",1)]),_:1})])]),s("div",Ie,[t(o(P),{id:"include-whatsapp",modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),disabled:d.value.con_telefono===0},null,8,["modelValue","disabled"]),s("div",Ke,[t(o(re),{class:"h-4 w-4 text-green-600"}),t(o(M),{for:"include-whatsapp",class:"flex-1"},{default:r(()=>[e[23]||(e[23]=m(" WhatsApp ")),s("span",Qe," ("+n(d.value.con_telefono)+" candidaturas) ",1)]),_:1})])])])]),e[25]||(e[25]=s("div",{class:"text-xs text-muted-foreground bg-gray-50 border border-gray-200 rounded p-3"},[s("p",{class:"mb-1"},"• Los mensajes se envían respetando los límites de velocidad configurados"),s("p",{class:"mb-1"},"• Emails: 2 por segundo | WhatsApp: 5 por segundo"),s("p",null,"• El proceso se ejecuta en segundo plano")],-1))]),t(o(te),null,{default:r(()=>[t(o(g),{variant:"outline",onClick:e[2]||(e[2]=a=>_.value=!1),disabled:x.value},{default:r(()=>e[26]||(e[26]=[m(" Cancelar ")])),_:1},8,["disabled"]),t(o(g),{onClick:D,disabled:x.value||d.value.total_borradores===0||!b.value&&!h.value,class:"bg-orange-600 hover:bg-orange-700"},{default:r(()=>[t(o($),{class:"mr-2 h-4 w-4"}),m(" "+n(x.value?"Enviando...":`Enviar Recordatorios (${d.value.total_borradores})`),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{Ms as default};
