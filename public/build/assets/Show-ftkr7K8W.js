import{d as K,r as L,c as z,i as p,e as r,f as a,u as t,p as Q,w as l,g as s,t as u,b as c,j as _,P as $,h as n,F as j,k as M,W as R,n as X,l as Y}from"./app-B7JHmzZ3.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Cn8W63cg.js";import{c as tt,_ as H}from"./createLucideIcon-fGeWyvG_.js";import{_ as g,a as x,b as k,c as b}from"./CardTitle.vue_vue_type_script_setup_true_lang-xUjjE8IK.js";import{_ as N}from"./CardDescription.vue_vue_type_script_setup_true_lang-BcT4z-YO.js";import{_ as w}from"./index-rxln-YzF.js";import{_ as et}from"./Label.vue_vue_type_script_setup_true_lang-fFAFaom6.js";import{_ as at,a as lt,b as C,c as I}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BypX571T.js";import{_ as ot,a as st,b as S,c as y,d as it,e as v}from"./TableHeader.vue_vue_type_script_setup_true_lang-n0pGeC-L.js";import{_ as nt}from"./EvidenciaFilters.vue_vue_type_script_setup_true_lang-BDvG_tF2.js";import{u as rt,O as ut}from"./ObligacionTree-K8f1bGNF.js";import{A as dt}from"./arrow-left-C14FsogT.js";import{P as mt}from"./pencil-BNxNjp9D.js";import{I as ft}from"./info-C0X0fvmO.js";import{I as E}from"./image-ELAjC6NJ.js";import{P as pt}from"./paperclip-DzcxgdGt.js";import{D as ct}from"./download-BEGX5OK2.js";import{f as T,e as F}from"./es-BDPlFIsO.js";import{p as q}from"./parseISO-DFjB8F03.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-ySvG0ZHb.js";import"./index-BQ475Ea3.js";import"./floating-ui.vue-BEmTabXm.js";import"./x-FK84Jhx-.js";import"./Input.vue_vue_type_script_setup_true_lang-B6w5yMA0.js";import"./index-CBze1Ugy.js";import"./index-BmRuyn_S.js";import"./shield-Dtwt_JCC.js";import"./user-DJF4-usS.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CNoi2SIi.js";import"./chevron-right-CaXva2pS.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-ViHLnL4d.js";import"./VisuallyHidden-C5pU9xhK.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-lnv0J55m.js";import"./check-BGitBu-W.js";import"./nullish-CHIgUVhi.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CpNLwog-.js";import"./index-B0ovTKfR.js";import"./circle-alert-C_k_uumx.js";import"./map-pin-DCQWz_w1.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DjPpLf6Z.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DwYM0u2-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-AJnR2RTL.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CLZMVAKW.js";import"./tag-BljZmyPM.js";import"./users-gG9q0EaO.js";import"./target-2T0QWYoE.js";import"./vote-BcsUe5tH.js";import"./folder-open-B8-1f72n.js";import"./send-eowq9Jg7.js";import"./file-text-C_id9aKI.js";import"./briefcase-CbxQO1b8.js";import"./calendar-CwCHh7g1.js";import"./megaphone-BftmrAse.js";import"./user-check-BP067pt8.js";import"./clipboard-list-BRLYPA3i.js";import"./mail-FEyEUa_K.js";import"./message-square-DGOIulqV.js";import"./external-link-CNccGiTj.js";import"./panel-left-CbCUXSX9.js";import"./index-UQLhyimN.js";import"./RovingFocusItem-CbzwKcdf.js";import"./utils-KjZ3AL9C.js";import"./Separator.vue_vue_type_script_setup_true_lang-CBJggZEK.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-CJBoy3YJ.js";import"./circle-Bo3Fc5wm.js";import"./layers-J3HKtC4C.js";import"./plus-EszbJR6u.js";import"./trash-2-CqlVh8ns.js";import"./loader-circle-DSjk3Wn9.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=tt("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),gt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},bt={class:"flex items-center justify-between"},yt={class:"text-3xl font-bold"},vt={class:"text-muted-foreground mt-2"},ht={class:"flex gap-2"},xt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},kt={class:"md:col-span-2 space-y-6"},wt={class:"mt-1"},$t={class:"space-y-6"},jt={class:"font-medium"},Dt={class:"text-sm text-gray-600 mt-1"},Mt={class:"space-y-2"},Ct=["href"],It={class:"text-xs text-gray-500"},Et={key:0},Vt={class:"text-xs text-gray-500"},At={key:1},Ot={class:"text-xs text-gray-500"},Pt={key:1},Bt={class:"text-sm text-gray-600"},Lt={key:0,class:"flex flex-wrap gap-1"},zt={key:1,class:"text-sm text-gray-500"},Ht={class:"text-sm"},Nt=["href"],St={class:"text-center"},Tt={class:"text-center"},oa=K({__name:"Show",props:{obligacion:{},contrato:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canCreateChild:{type:Boolean}},setup(U){const V=U,{hasPermission:G}=rt(),A=L("general"),m=L({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null,entregable_id:null}),W=[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"},{title:V.obligacion.titulo}],h=z(()=>V.obligacion.evidencias||[]),O=z(()=>{let o=h.value;return m.value.tipo&&(o=o.filter(e=>e.tipo_evidencia===m.value.tipo)),m.value.estado&&(o=o.filter(e=>e.estado===m.value.estado)),m.value.usuario_id&&(o=o.filter(e=>{var f;return((f=e.usuario)==null?void 0:f.id)===m.value.usuario_id})),m.value.entregable_id&&(o=o.filter(e=>{var f;return(f=e.entregables)==null?void 0:f.some(i=>i.id===m.value.entregable_id)})),(m.value.fecha_inicio||m.value.fecha_fin)&&(o=o.filter(e=>{const f=new Date(e.created_at);if(m.value.fecha_inicio){const i=new Date(m.value.fecha_inicio);if(f<i)return!1}if(m.value.fecha_fin){const i=new Date(m.value.fecha_fin);if(i.setHours(23,59,59,999),f>i)return!1}return!0})),o}),D=o=>{if(!o)return"Sin fecha";try{return T(q(o),"dd MMM yyyy HH:mm",{locale:F})}catch{return o}},J=o=>{if(!o)return"-";try{return T(q(o),"d 'de' MMMM 'de' yyyy",{locale:F})}catch{return o}};return(o,e)=>(r(),p(j,null,[a(t(Q),{title:`Obligación - ${o.obligacion.titulo}`},null,8,["title"]),a(Z,{breadcrumbs:W},{default:l(()=>[s("div",gt,[s("div",bt,[s("div",null,[s("h1",yt,u(o.obligacion.titulo),1),s("p",vt," Contrato: "+u(o.contrato.nombre),1)]),s("div",ht,[a(t($),{href:`/admin/contratos/${o.contrato.id}`},{default:l(()=>[a(t(H),{variant:"outline",size:"sm"},{default:l(()=>[a(t(dt),{class:"h-4 w-4 mr-2"}),e[4]||(e[4]=n(" Ver Contrato ",-1))]),_:1})]),_:1},8,["href"]),o.canEdit?(r(),c(t($),{key:0,href:o.route("admin.obligaciones.edit",o.obligacion.id)},{default:l(()=>[a(t(H),{variant:"outline",size:"sm"},{default:l(()=>[a(t(mt),{class:"h-4 w-4 mr-2"}),e[5]||(e[5]=n(" Editar ",-1))]),_:1})]),_:1},8,["href"])):_("",!0)])]),a(t(at),{modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=f=>A.value=f),class:"flex-1"},{default:l(()=>{var f;return[a(t(lt),null,{default:l(()=>{var i;return[a(t(C),{value:"general"},{default:l(()=>[a(t(ft),{class:"h-4 w-4 mr-2"}),e[6]||(e[6]=n(" General ",-1))]),_:1}),(i=o.obligacion.hijos)!=null&&i.length?(r(),c(t(C),{key:0,value:"hijos"},{default:l(()=>{var d;return[a(t(_t),{class:"h-4 w-4 mr-2"}),e[7]||(e[7]=n(" Obligaciones Hijas ",-1)),(d=o.obligacion.hijos)!=null&&d.length?(r(),c(t(w),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[n(u(o.obligacion.hijos.length),1)]),_:1})):_("",!0)]}),_:1})):_("",!0),a(t(C),{value:"evidencias"},{default:l(()=>[a(t(E),{class:"h-4 w-4 mr-2"}),e[8]||(e[8]=n(" Evidencias ",-1)),h.value.length>0?(r(),c(t(w),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[n(u(h.value.length),1)]),_:1})):_("",!0)]),_:1})]}),_:1}),a(t(I),{value:"general",class:"space-y-4 mt-6"},{default:l(()=>{var i;return[s("div",xt,[s("div",kt,[a(t(g),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(k),null,{default:l(()=>[...e[9]||(e[9]=[n("Información General",-1)])]),_:1})]),_:1}),a(t(b),{class:"space-y-4"},{default:l(()=>[s("div",null,[a(t(et),null,{default:l(()=>[...e[10]||(e[10]=[n("Descripción",-1)])]),_:1}),s("p",wt,u(o.obligacion.descripcion||"Sin descripción"),1)])]),_:1})]),_:1})]),s("div",$t,[a(t(g),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(k),null,{default:l(()=>[...e[11]||(e[11]=[n("Detalles del Contrato",-1)])]),_:1})]),_:1}),a(t(b),null,{default:l(()=>{var d;return[a(t($),{href:o.route("admin.contratos.show",o.contrato.id),class:"hover:underline"},{default:l(()=>[s("h3",jt,u(o.contrato.nombre),1)]),_:1},8,["href"]),s("p",Dt,u((d=o.contrato.proyecto)==null?void 0:d.nombre),1)]}),_:1})]),_:1}),(i=o.obligacion.archivos_adjuntos)!=null&&i.length?(r(),c(t(g),{key:0},{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(k),null,{default:l(()=>[...e[12]||(e[12]=[n("Archivos Adjuntos",-1)])]),_:1})]),_:1}),a(t(b),null,{default:l(()=>[s("div",Mt,[(r(!0),p(j,null,M(o.obligacion.archivos_adjuntos,d=>(r(),p("div",{key:d.ruta,class:"flex items-center gap-2"},[a(t(pt),{class:"h-4 w-4"}),s("a",{href:d.ruta,target:"_blank",class:"hover:underline text-sm"},u(d.nombre_original),9,Ct)]))),128))])]),_:1})]),_:1})):_("",!0),a(t(g),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(k),null,{default:l(()=>[...e[13]||(e[13]=[n("Auditoría",-1)])]),_:1})]),_:1}),a(t(b),{class:"text-sm space-y-2"},{default:l(()=>{var d,P,B;return[s("div",null,[e[14]||(e[14]=s("span",{class:"text-gray-600"},"Creado por:",-1)),s("p",null,u(((d=o.obligacion.creador)==null?void 0:d.name)||"Sistema"),1),s("p",It,u(D(o.obligacion.created_at)),1)]),o.obligacion.updated_at?(r(),p("div",Et,[e[15]||(e[15]=s("span",{class:"text-gray-600"},"Última actualización:",-1)),s("p",null,u(((P=o.obligacion.actualizador)==null?void 0:P.name)||"Sistema"),1),s("p",Vt,u(D(o.obligacion.updated_at)),1)])):_("",!0),o.obligacion.cumplido_at?(r(),p("div",At,[e[16]||(e[16]=s("span",{class:"text-gray-600"},"Cumplido por:",-1)),s("p",null,u(((B=o.obligacion.cumplido_por_usuario)==null?void 0:B.name)||"Sistema"),1),s("p",Ot,u(D(o.obligacion.cumplido_at)),1)])):_("",!0)]}),_:1})]),_:1})])])]}),_:1}),(f=o.obligacion.hijos)!=null&&f.length?(r(),c(t(I),{key:0,value:"hijos",class:"space-y-4 mt-6"},{default:l(()=>[a(t(g),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(k),null,{default:l(()=>[...e[17]||(e[17]=[n("Obligaciones Hijas",-1)])]),_:1}),a(t(N),null,{default:l(()=>[...e[18]||(e[18]=[n(" Sub-obligaciones derivadas de esta obligación principal ",-1)])]),_:1})]),_:1}),a(t(b),null,{default:l(()=>[a(ut,{obligaciones:o.obligacion.hijos,contratoId:o.obligacion.contrato_id,editable:t(G)("obligaciones.edit"),onEdit:e[0]||(e[0]=i=>t(R).visit(o.route("admin.obligaciones.edit",i.id)))},null,8,["obligaciones","contratoId","editable"])]),_:1})]),_:1})]),_:1})):_("",!0),a(t(I),{value:"evidencias",class:"space-y-4 mt-6"},{default:l(()=>[h.value.length>0?(r(),c(nt,{key:0,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=i=>m.value=i),contratos:[o.contrato],evidencias:h.value},null,8,["modelValue","contratos","evidencias"])):_("",!0),O.value.length>0?(r(),p("div",Pt,[a(t(g),null,{default:l(()=>[a(t(x),null,{default:l(()=>[a(t(k),null,{default:l(()=>[...e[19]||(e[19]=[n("Evidencias Asociadas",-1)])]),_:1}),a(t(N),null,{default:l(()=>[...e[20]||(e[20]=[n(" Evidencias cargadas para esta obligación ",-1)])]),_:1})]),_:1}),a(t(b),null,{default:l(()=>[a(t(ot),null,{default:l(()=>[a(t(st),null,{default:l(()=>[a(t(S),null,{default:l(()=>[a(t(y),null,{default:l(()=>[...e[21]||(e[21]=[n("Tipo",-1)])]),_:1}),a(t(y),null,{default:l(()=>[...e[22]||(e[22]=[n("Descripción",-1)])]),_:1}),a(t(y),null,{default:l(()=>[...e[23]||(e[23]=[n("Entregable",-1)])]),_:1}),a(t(y),null,{default:l(()=>[...e[24]||(e[24]=[n("Usuario",-1)])]),_:1}),a(t(y),null,{default:l(()=>[...e[25]||(e[25]=[n("Estado",-1)])]),_:1}),a(t(y),null,{default:l(()=>[...e[26]||(e[26]=[n("Fecha",-1)])]),_:1}),a(t(y),{class:"text-right"},{default:l(()=>[...e[27]||(e[27]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),a(t(it),null,{default:l(()=>[(r(!0),p(j,null,M(O.value,i=>(r(),c(t(S),{key:i.id,class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800"},{default:l(()=>[a(t($),{href:`/admin/contratos/${o.contrato.id}/evidencias/${i.id}`,class:"contents"},{default:l(()=>[a(t(v),null,{default:l(()=>[a(t(w),{variant:"outline"},{default:l(()=>[n(u(i.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),a(t(v),null,{default:l(()=>[s("span",Bt,u(i.descripcion||"-"),1)]),_:2},1024),a(t(v),null,{default:l(()=>[i.entregables&&i.entregables.length>0?(r(),p("div",Lt,[(r(!0),p(j,null,M(i.entregables,d=>(r(),c(t(w),{key:d.id,variant:"secondary",class:"text-xs"},{default:l(()=>[n(u(d.nombre),1)]),_:2},1024))),128))])):(r(),p("span",zt,"-"))]),_:2},1024),a(t(v),null,{default:l(()=>{var d;return[s("span",Ht,u(((d=i.usuario)==null?void 0:d.name)||"-"),1)]}),_:2},1024),a(t(v),null,{default:l(()=>[a(t(w),{class:X({"bg-yellow-100 text-yellow-800":i.estado==="pendiente","bg-green-100 text-green-800":i.estado==="aprobada","bg-red-100 text-red-800":i.estado==="rechazada"})},{default:l(()=>[n(u(i.estado),1)]),_:2},1032,["class"])]),_:2},1024),a(t(v),null,{default:l(()=>[n(u(J(i.created_at)),1)]),_:2},1024),a(t(v),{class:"text-right"},{default:l(()=>[i.archivo_url?(r(),p("a",{key:0,href:i.archivo_url,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800",onClick:e[2]||(e[2]=Y(()=>{},["stop"]))},[a(t(ct),{class:"h-4 w-4"})],8,Nt)):_("",!0)]),_:2},1024)]),_:2},1032,["href"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})])):h.value.length===0?(r(),c(t(g),{key:2},{default:l(()=>[a(t(b),{class:"py-8"},{default:l(()=>[s("div",St,[a(t(E),{class:"mx-auto h-12 w-12 text-gray-400"}),e[28]||(e[28]=s("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias asociadas",-1)),e[29]||(e[29]=s("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(r(),c(t(g),{key:3},{default:l(()=>[a(t(b),{class:"py-8"},{default:l(()=>[s("div",Tt,[a(t(E),{class:"mx-auto h-12 w-12 text-gray-400"}),e[30]||(e[30]=s("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),e[31]||(e[31]=s("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1}))]),_:1})]}),_:1},8,["modelValue"])])]),_:1})],64))}});export{oa as default};
