import{d as Z,C as K,c as h,j as P,o as m,e as a,b as i,f as o,u as e,m as ee,i as $,g as n,P as G,h as se,a as c,F as b,r as x,t as p,W as ie}from"./app-CAdZzM_Z.js";import{T as ae,_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BO-svRXb.js";import{_ as y}from"./createLucideIcon-CXHANoFt.js";import{_ as D,a as U,b as j,c as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-DjHPkkDU.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-Dvdq-DmD.js";import{_ as N}from"./Input.vue_vue_type_script_setup_true_lang-mDQ3dGeJ.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-CiERRZLN.js";import{_ as le}from"./Textarea.vue_vue_type_script_setup_true_lang-CeKJh19A.js";import{_ as S}from"./Checkbox.vue_vue_type_script_setup_true_lang-DXQURKDh.js";import{_ as z}from"./index-CnmuFngV.js";import{_ as oe,a as re,b as E,c as O}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Cx0FraHe.js";import{_ as ne}from"./ScrollArea.vue_vue_type_script_setup_true_lang-2WMC8jmX.js";import{_ as de,a as me}from"./index-u9_L69cm.js";import{_ as ue}from"./Switch.vue_vue_type_script_setup_true_lang-Bt6yoFfJ.js";import{_ as ce,a as pe,b as fe,c as _e,d as ve}from"./SelectValue.vue_vue_type_script_setup_true_lang-DWP3i772.js";import{_ as g}from"./InputError.vue_vue_type_script_setup_true_lang-CT4skD9p.js";import{A as ge}from"./arrow-left-Bbymwfmw.js";import{C as be}from"./circle-alert-DJApAxfZ.js";import{S as xe}from"./shield-9TfN4vcB.js";import{L as ye}from"./lock-DrI4ofdq.js";import{H as ke}from"./house-X9U7kfHQ.js";import{S as he}from"./save-Y7_sM-_y.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BBCGXacZ.js";import"./index-Dk7v65kc.js";import"./floating-ui.vue-o9t0Cs1h.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CTiTYt3J.js";import"./VisuallyHidden-C9Q-Dzyf.js";import"./index-CDPaFMwS.js";import"./user-DCxajna_.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-pqFXBp6U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BJlwZ8Tj.js";import"./index-isMfZbaw.js";import"./map-pin-CpWHgFMG.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-jdsIb6uM.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-cz1j7wvU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-Bkqb2MWm.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CaNV7crr.js";import"./users-COCJ8eeW.js";import"./vote-Ch3ARerj.js";import"./file-text-CpgbbvpW.js";import"./calendar-DTHAcGLd.js";import"./briefcase-CxOizXu-.js";import"./megaphone-BAaLnDtT.js";import"./user-check-BNwGs4aj.js";import"./external-link-mZUJsxAi.js";import"./panel-left-BRV2vWPf.js";import"./check-D66TnJ1r.js";import"./index-DXvfFGMJ.js";import"./RovingFocusItem-BwPM_NOs.js";import"./utils-Atxy18Wm.js";import"./VisuallyHiddenInput-CPUP79hY.js";const Pe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},$e={class:"flex items-center justify-between"},Se={class:"flex gap-2"},Ve={class:"space-y-2"},De={class:"space-y-2"},Ue={class:"space-y-2"},je={class:"space-y-2"},Ce={class:"flex items-center justify-between"},we={class:"space-y-0.5"},Ee={class:"space-y-2"},Oe={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},Ae={class:"flex gap-2 mt-4"},Le={class:"space-y-8"},Re={key:0},Fe={class:"space-y-6 pl-4"},Ge={class:"flex items-center space-x-2 pb-2 border-b"},Ne={class:"grid grid-cols-2 gap-3 pl-6"},ze={key:1},Te={class:"space-y-6 pl-4"},Be={class:"flex items-center space-x-2 pb-2 border-b"},Me={class:"grid grid-cols-2 gap-3 pl-6"},qe={key:0,class:"space-y-3"},He={class:"flex-1"},Ie={class:"text-xs text-muted-foreground mt-1"},We={key:1,class:"text-center py-8 text-muted-foreground"},Je={class:"flex justify-end gap-4"},Ws=Z({__name:"Edit",props:{role:{},segments:{},availablePermissions:{},selectedSegments:{}},setup(T){const d=T,B=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Editar Rol",href:"#"}],t=K({name:d.role.name,display_name:d.role.display_name,description:d.role.description||"",is_administrative:!!d.role.is_administrative,redirect_after_login:d.role.redirect_after_login||"default",permissions:d.role.permissions||[],segment_ids:d.selectedSegments||[]}),A=[{value:"default",label:"Por defecto (según tipo de rol)"},{value:"admin.dashboard",label:"Dashboard Administrativo",group:"admin"},{value:"admin.candidaturas.dashboard",label:"Dashboard Candidaturas",group:"admin"},{value:"dashboard",label:"Dashboard Usuario",group:"user"},{value:"votaciones.index",label:"Votaciones",group:"user"},{value:"asambleas.index",label:"Asambleas",group:"user"},{value:"formularios.index",label:"Formularios",group:"user"},{value:"postulaciones.index",label:"Postulaciones",group:"user"},{value:"admin.otp-dashboard",label:"Dashboard OTP",group:"admin"},{value:"admin.configuracion.index",label:"Configuración",group:"admin"},{value:"admin.users.index",label:"Usuarios",group:"admin"},{value:"admin.roles.index",label:"Roles y Permisos",group:"admin"},{value:"admin.candidaturas.index",label:"Candidaturas (Lista)",group:"admin"}],M=h(()=>t.is_administrative?A:A.filter(r=>r.group!=="admin"||r.value==="default")),k=h(()=>["super_admin","admin","manager","user","end_customer"].includes(d.role.name));h(()=>({...d.availablePermissions.administrative,...d.availablePermissions.frontend}));const V=r=>{const s=d.availablePermissions.administrative[r]||d.availablePermissions.frontend[r];return s?Object.keys(s.permissions).every(u=>t.permissions.includes(u)):!1},L=r=>{const s=d.availablePermissions.administrative[r]||d.availablePermissions.frontend[r];if(!s)return!1;const l=Object.keys(s.permissions),u=l.filter(f=>t.permissions.includes(f)).length;return u>0&&u<l.length},R=r=>{const s=t.permissions.indexOf(r);s>-1?t.permissions.splice(s,1):t.permissions.push(r)},F=r=>{const s=d.availablePermissions.administrative[r]||d.availablePermissions.frontend[r];if(!s)return;const l=Object.keys(s.permissions);V(r)?t.permissions=t.permissions.filter(f=>!l.includes(f)):l.forEach(f=>{t.permissions.includes(f)||t.permissions.push(f)})},q=r=>{const s=t.segment_ids.indexOf(r);s>-1?t.segment_ids.splice(s,1):t.segment_ids.push(r)},H=()=>{t.put(`/admin/roles/${d.role.id}`,{preserveScroll:!0,onSuccess:()=>{}})},I=()=>{confirm(`¿Estás seguro de eliminar el rol "${d.role.display_name}"? Esta acción no se puede deshacer.`)&&ie.delete(`/admin/roles/${d.role.id}`)},W=()=>{const r=[];Object.values(d.availablePermissions.administrative).forEach(s=>{Object.keys(s.permissions).forEach(l=>{r.push(l)})}),Object.values(d.availablePermissions.frontend).forEach(s=>{Object.keys(s.permissions).forEach(l=>{r.push(l)})}),t.permissions=r},J=()=>{t.permissions=[]},Q=h(()=>t.permissions.length),X=h(()=>!k.value);return(r,s)=>(m(),P(te,{breadcrumbs:B},{default:a(()=>[i(e(ee),{title:"Editar Rol"}),o("div",Pe,[o("div",$e,[s[7]||(s[7]=o("div",null,[o("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Rol"),o("p",{class:"text-muted-foreground"}," Modifica los permisos y configuración del rol ")],-1)),o("div",Se,[X.value?(m(),P(e(y),{key:0,onClick:I,variant:"destructive",type:"button"},{default:a(()=>s[5]||(s[5]=[n(" Eliminar Rol ")])),_:1})):$("",!0),i(e(G),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(y),{variant:"outline"},{default:a(()=>[i(e(ge),{class:"mr-2 h-4 w-4"}),s[6]||(s[6]=n(" Volver "))]),_:1})]),_:1},8,["href"])])]),k.value?(m(),P(e(de),{key:0},{default:a(()=>[i(e(be),{class:"h-4 w-4"}),i(e(me),null,{default:a(()=>s[8]||(s[8]=[n(" Este es un rol del sistema. Algunas configuraciones pueden estar restringidas. ")])),_:1})]),_:1})):$("",!0),o("form",{onSubmit:se(H,["prevent"]),class:"space-y-6"},[i(e(oe),{defaultValue:"general",class:"space-y-4"},{default:a(()=>[i(e(re),{class:"grid w-full grid-cols-3"},{default:a(()=>[i(e(E),{value:"general"},{default:a(()=>[i(e(xe),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=n(" General "))]),_:1}),i(e(E),{value:"permissions"},{default:a(()=>[i(e(ye),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=n(" Permisos "))]),_:1}),i(e(E),{value:"segments"},{default:a(()=>[i(e(ae),{class:"mr-2 h-4 w-4"}),s[11]||(s[11]=n(" Segmentos "))]),_:1})]),_:1}),i(e(O),{value:"general"},{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>s[12]||(s[12]=[n("Información General")])),_:1}),i(e(w),null,{default:a(()=>s[13]||(s[13]=[n(" Define el nombre y descripción del rol ")])),_:1})]),_:1}),i(e(C),{class:"space-y-4"},{default:a(()=>[o("div",Ve,[i(e(_),{htmlFor:"name"},{default:a(()=>s[14]||(s[14]=[n("Nombre del Rol (interno)")])),_:1}),i(e(N),{id:"name",modelValue:e(t).name,"onUpdate:modelValue":s[0]||(s[0]=l=>e(t).name=l),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos",disabled:k.value},null,8,["modelValue","disabled"]),s[15]||(s[15]=o("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),i(g,{message:e(t).errors.name},null,8,["message"])]),o("div",De,[i(e(_),{htmlFor:"display_name"},{default:a(()=>s[16]||(s[16]=[n("Nombre a Mostrar")])),_:1}),i(e(N),{id:"display_name",modelValue:e(t).display_name,"onUpdate:modelValue":s[1]||(s[1]=l=>e(t).display_name=l),placeholder:"Administrador Regional"},null,8,["modelValue"]),i(g,{message:e(t).errors.display_name},null,8,["message"])]),o("div",Ue,[i(e(_),{htmlFor:"description"},{default:a(()=>s[17]||(s[17]=[n("Descripción")])),_:1}),i(e(le),{id:"description",modelValue:e(t).description,"onUpdate:modelValue":s[2]||(s[2]=l=>e(t).description=l),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),i(g,{message:e(t).errors.description},null,8,["message"])]),o("div",je,[o("div",Ce,[o("div",we,[i(e(_),{htmlFor:"is_administrative"},{default:a(()=>s[18]||(s[18]=[n("Rol Administrativo")])),_:1}),s[19]||(s[19]=o("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),i(e(ue),{id:"is_administrative",modelValue:e(t).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=l=>e(t).is_administrative=l),disabled:k.value},null,8,["modelValue","disabled"])]),i(g,{message:e(t).errors.is_administrative},null,8,["message"])]),o("div",Ee,[i(e(_),{htmlFor:"redirect_after_login"},{default:a(()=>[i(e(ke),{class:"inline-block h-4 w-4 mr-1"}),s[20]||(s[20]=n(" Página de Inicio Después del Login "))]),_:1}),i(e(ce),{modelValue:e(t).redirect_after_login,"onUpdate:modelValue":s[4]||(s[4]=l=>e(t).redirect_after_login=l),disabled:k.value},{default:a(()=>[i(e(pe),{id:"redirect_after_login"},{default:a(()=>[i(e(fe),{placeholder:"Seleccione la página de destino"})]),_:1}),i(e(_e),null,{default:a(()=>[(m(!0),c(b,null,x(M.value,l=>(m(),P(e(ve),{key:l.value,value:l.value},{default:a(()=>[n(p(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),s[21]||(s[21]=o("p",{class:"text-xs text-muted-foreground"}," Define a qué página se redirigirá al usuario después de autenticarse. Si no se especifica, usará el comportamiento por defecto. ",-1)),i(g,{message:e(t).errors.redirect_after_login},null,8,["message"])]),o("div",Oe,[o("p",null,"ID del Rol: "+p(r.role.id),1),o("p",null,"Creado: "+p(new Date(r.role.created_at).toLocaleDateString()),1),o("p",null,"Última actualización: "+p(new Date(r.role.updated_at).toLocaleDateString()),1)])]),_:1})]),_:1})]),_:1}),i(e(O),{value:"permissions"},{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>s[22]||(s[22]=[n("Matriz de Permisos")])),_:1}),i(e(w),null,{default:a(()=>s[23]||(s[23]=[n(" Selecciona los permisos que tendrá este rol. Los permisos están organizados en dos secciones: administrativos (acceso al panel admin) y frontend (funciones de usuario). ")])),_:1}),o("div",Ae,[i(e(y),{type:"button",size:"sm",variant:"outline",onClick:W},{default:a(()=>s[24]||(s[24]=[n(" Seleccionar Todos ")])),_:1}),i(e(y),{type:"button",size:"sm",variant:"outline",onClick:J},{default:a(()=>s[25]||(s[25]=[n(" Limpiar Todos ")])),_:1}),i(e(z),{variant:"secondary",class:"ml-auto"},{default:a(()=>[n(p(Q.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),i(e(C),null,{default:a(()=>[i(e(ne),{class:"h-[500px] pr-4"},{default:a(()=>[o("div",Le,[Object.keys(r.availablePermissions.administrative).length>0?(m(),c("div",Re,[s[26]||(s[26]=o("h3",{class:"text-lg font-semibold mb-4 text-orange-600 dark:text-orange-400"}," Permisos Administrativos ",-1)),o("div",Fe,[(m(!0),c(b,null,x(r.availablePermissions.administrative,(l,u)=>(m(),c("div",{key:`admin-${u}`,class:"space-y-3"},[o("div",Ge,[i(e(S),{checked:V(u),indeterminate:L(u),"onUpdate:checked":f=>F(u)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(_),{class:"text-sm font-semibold"},{default:a(()=>[n(p(l.label),1)]),_:2},1024)]),o("div",Ne,[(m(!0),c(b,null,x(l.permissions,(f,v)=>(m(),c("div",{key:v,class:"flex items-center space-x-2"},[i(e(S),{checked:e(t).permissions.includes(v),"onUpdate:checked":Y=>R(v)},null,8,["checked","onUpdate:checked"]),i(e(_),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[n(p(f),1)]),_:2},1024)]))),128))])]))),128))])])):$("",!0),s[28]||(s[28]=o("div",{class:"border-t-2 border-dashed"},null,-1)),Object.keys(r.availablePermissions.frontend).length>0?(m(),c("div",ze,[s[27]||(s[27]=o("h3",{class:"text-lg font-semibold mb-4 text-blue-600 dark:text-blue-400"}," Permisos de Usuario (Frontend) ",-1)),o("div",Te,[(m(!0),c(b,null,x(r.availablePermissions.frontend,(l,u)=>(m(),c("div",{key:`frontend-${u}`,class:"space-y-3"},[o("div",Be,[i(e(S),{checked:V(u),indeterminate:L(u),"onUpdate:checked":f=>F(u)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(_),{class:"text-sm font-semibold"},{default:a(()=>[n(p(l.label),1)]),_:2},1024)]),o("div",Me,[(m(!0),c(b,null,x(l.permissions,(f,v)=>(m(),c("div",{key:v,class:"flex items-center space-x-2"},[i(e(S),{checked:e(t).permissions.includes(v),"onUpdate:checked":Y=>R(v)},null,8,["checked","onUpdate:checked"]),i(e(_),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[n(p(f),1)]),_:2},1024)]))),128))])]))),128))])])):$("",!0)])]),_:1}),i(g,{message:e(t).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),i(e(O),{value:"segments"},{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>s[29]||(s[29]=[n("Segmentos de Datos")])),_:1}),i(e(w),null,{default:a(()=>s[30]||(s[30]=[n(" Asocia segmentos para limitar el alcance de datos visibles ")])),_:1})]),_:1}),i(e(C),null,{default:a(()=>[r.segments.length>0?(m(),c("div",qe,[(m(!0),c(b,null,x(r.segments,l=>(m(),c("div",{key:l.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[i(e(S),{checked:e(t).segment_ids.includes(l.id),"onUpdate:checked":u=>q(l.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),o("div",He,[i(e(_),{class:"text-sm font-medium cursor-pointer"},{default:a(()=>[n(p(l.name),1)]),_:2},1024),o("p",Ie,p(l.description||"Sin descripción"),1),l.user_count?(m(),P(e(z),{key:0,variant:"outline",class:"mt-2"},{default:a(()=>[n(p(l.user_count)+" usuarios ",1)]),_:2},1024)):$("",!0)])]))),128))])):(m(),c("div",We," No hay segmentos disponibles ")),i(g,{message:e(t).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),o("div",Je,[i(e(G),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(y),{type:"button",variant:"outline"},{default:a(()=>s[31]||(s[31]=[n(" Cancelar ")])),_:1})]),_:1},8,["href"]),i(e(y),{type:"submit",disabled:e(t).processing},{default:a(()=>[i(e(he),{class:"mr-2 h-4 w-4"}),n(" "+p(e(t).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{Ws as default};
