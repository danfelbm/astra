import{_ as L}from"./index-B8DuVZ6-.js";import{_ as x}from"./createLucideIcon-pi43BedF.js";import{_ as O,c as Q}from"./CardTitle.vue_vue_type_script_setup_true_lang-djiwawAA.js";import{_ as R}from"./Switch.vue_vue_type_script_setup_true_lang-CQHKUhPL.js";import{_ as K,a as W,b as k,c as v,d as X,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-B8pSMG1P.js";import{_ as y,a as $,b as C,c as w,d as z,e as S,f as E,g as F}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BJclOizw.js";import{_ as V}from"./AlertDialogTrigger.vue_vue_type_script_setup_true_lang-CKVSL3Ud.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BMnM7jZE.js";import{d as Z,c as tt,i as c,e,f as t,q as et,w as a,g as n,b as _,j as m,m as l,v as N,h as o,F as A,k as T,t as r,n as at,s as h}from"./app-FZoHOgaH.js";import{_ as st}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-C4hJ7cCw.js";import{P as it}from"./plus-DIWpweCj.js";import{U as ot}from"./users-D06yuiCC.js";import{F as lt}from"./file-text-C7Yp1Ly8.js";import{C as nt}from"./chart-column-D_SNm2Gf.js";import{S as rt}from"./square-pen-C1otOggx.js";import{T as dt}from"./trash-2-uQ-v_aYU.js";import"./index-Cc-BeIiM.js";import"./VisuallyHidden-Dbnz2TNK.js";import"./Input.vue_vue_type_script_setup_true_lang-BEgEQ1Ma.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Bm5Gj1mI.js";import"./check-D8MJB2af.js";import"./floating-ui.vue-C3D9D25A.js";import"./VisuallyHiddenInput-C4IojIA_.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CuJ5linQ.js";import"./x-Bg3XxnFA.js";import"./DialogTrigger-D7rdN84A.js";import"./useFlashMessages-Bm7N6KRp.js";import"./index-axiiZVyU.js";import"./index-ybiiC-LH.js";import"./shield-Dq12MYkj.js";import"./user-CPzkR__l.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BUkxjj6a.js";import"./chevron-right-BmPlSaC-.js";import"./Label.vue_vue_type_script_setup_true_lang-waJVfnmL.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CIHwSdjR.js";import"./index-CvxOO9P_.js";import"./circle-alert-C2ek-4S9.js";import"./map-pin-DMngM3dy.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-BiptSxHd.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DbGRc_BL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-Da_6ahJg.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DA-dsnb1.js";import"./tag-uDee8c9E.js";import"./target-ChjALuOe.js";import"./vote-Guhs9Ix2.js";import"./folder-open-CyZnsmsD.js";import"./send-B68USuYn.js";import"./briefcase-C7xhbZjB.js";import"./calendar-tvCvxrpC.js";import"./megaphone-Bf3YxDyR.js";import"./user-check-D5fucGr0.js";import"./clipboard-list-CmSzLpIl.js";import"./mail-BOH-fMhV.js";import"./message-square-CiGRX4EB.js";import"./external-link-M3oE2-QG.js";import"./panel-left-DxDlnwDZ.js";import"./index-Bpcp85lZ.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-CPhdmexu.js";import"./useKbd-kRIii9yh.js";import"./chevron-left-C0qEKhAp.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BJpWr-JC.js";import"./es-BDPlFIsO.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-D3V4C-Eo.js";import"./loader-circle-CVL0aAJ-.js";import"./search-CSHDnqRM.js";import"./filter-BOz6hTrn.js";import"./history-B-Gq3WOA.js";import"./save-CCkKWJrq.js";const ut={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},mt={class:"flex items-center justify-between"},ct={class:"relative min-h-[50vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border"},ft={class:"rounded-md border"},_t={class:"font-medium"},pt={key:0,class:"text-sm text-muted-foreground"},vt={class:"flex items-center gap-3"},gt={key:0,class:"flex items-center gap-2"},xt={key:0,class:"text-xs text-orange-600 mr-2",title:"Asigna votantes antes de activar"},ht={key:0},bt={key:1},kt={key:0,class:"text-orange-600 font-medium"},yt={class:"text-xs text-muted-foreground"},$t={key:1,class:"ml-2"},Ct={key:2,class:"text-xs text-muted-foreground"},wt={class:"flex items-center gap-1"},zt={class:"flex justify-end gap-2"},St={key:0,class:"flex items-center justify-between mt-4"},Et={class:"text-sm text-muted-foreground"},Ft={class:"flex gap-2"},Je=Z({__name:"Index",props:{votaciones:{},categorias:{},filters:{},filterFieldsConfig:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canManageVoters:{type:Boolean}},setup(g){const u=g,q=[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"}],M={fields:u.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por título o descripción...",quickSearchFields:["titulo","descripcion"],maxNestingLevel:2,allowSaveFilters:!0,debounceTime:500,autoApply:!1},j=d=>{h.get(`/admin/votaciones/${d}/imports`)},I=d=>{h.get(`/votaciones/${d}/resultados`)},{route:b}=window,P=tt(()=>({quickSearch:u.filters.search,rootGroup:u.filters.advanced_filters?JSON.parse(u.filters.advanced_filters):void 0})),G=d=>{h.delete(`/admin/votaciones/${d}`,{onSuccess:()=>{}})},H=d=>{const i=d.estado==="borrador"?"activa":"borrador";h.post(b("admin.votaciones.toggle-status",d.id),{estado:i},{preserveScroll:!0,onSuccess:()=>{},onError:s=>{console.error("Error toggling status:",s),s!=null&&s.message&&alert(s.message)}})},U=d=>{h.post(b("admin.votaciones.toggle-status",d.id),{estado:"finalizada"},{preserveScroll:!0,onSuccess:()=>{},onError:i=>{console.error("Error finalizando votación:",i),i!=null&&i.message&&alert(i.message)}})},J=d=>{switch(d){case"borrador":return"secondary";case"activa":return"default";case"finalizada":return"outline";default:return"secondary"}},B=d=>new Date(d).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(d,i)=>(l(),c(A,null,[e(t(et),{title:"Gestión de Votaciones"}),e(Y,{breadcrumbs:q},{default:a(()=>[n("div",ut,[n("div",mt,[i[1]||(i[1]=n("div",null,[n("h1",{class:"text-3xl font-bold"},"Gestión de Votaciones"),n("p",{class:"text-muted-foreground"}," Administra todas las votaciones del sistema ")],-1)),g.canCreate?(l(),_(t(x),{key:0,"as-child":""},{default:a(()=>[e(t(N),{href:t(b)("admin.votaciones.create")},{default:a(()=>[e(t(it),{class:"mr-2 h-4 w-4"}),i[0]||(i[0]=o(" Nueva Votación ",-1))]),_:1},8,["href"])]),_:1})):m("",!0)]),e(st,{config:M,route:t(b)("admin.votaciones.index"),"initial-filters":P.value},null,8,["route","initial-filters"]),n("div",ct,[e(t(O),{class:"border-0 shadow-none h-full"},{default:a(()=>[e(t(Q),{class:"pt-6"},{default:a(()=>[n("div",ft,[e(t(K),null,{default:a(()=>[e(t(W),null,{default:a(()=>[e(t(k),null,{default:a(()=>[e(t(v),null,{default:a(()=>[...i[2]||(i[2]=[o("Título",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...i[3]||(i[3]=[o("Categoría",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...i[4]||(i[4]=[o("Estado",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...i[5]||(i[5]=[o("Activar/Desactivar",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...i[6]||(i[6]=[o("Fecha Inicio",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...i[7]||(i[7]=[o("Fecha Fin",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...i[8]||(i[8]=[o("Votantes",-1)])]),_:1}),e(t(v),{class:"text-right"},{default:a(()=>[...i[9]||(i[9]=[o("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(X),null,{default:a(()=>[u.votaciones.data.length===0?(l(),_(t(k),{key:0},{default:a(()=>[e(t(f),{colspan:8,class:"text-center py-8 text-muted-foreground"},{default:a(()=>[...i[10]||(i[10]=[o(" No se encontraron votaciones ",-1)])]),_:1})]),_:1})):m("",!0),(l(!0),c(A,null,T(u.votaciones.data,s=>(l(),_(t(k),{key:s.id},{default:a(()=>[e(t(f),null,{default:a(()=>{var p,D;return[n("div",null,[n("p",_t,r(s.titulo),1),s.descripcion?(l(),c("p",pt,r((p=s.descripcion)==null?void 0:p.substring(0,60))+r(((D=s.descripcion)==null?void 0:D.length)>60?"...":""),1)):m("",!0)])]}),_:2},1024),e(t(f),null,{default:a(()=>[e(t(L),{variant:"outline"},{default:a(()=>[o(r(s.categoria.nombre),1)]),_:2},1024)]),_:2},1024),e(t(f),null,{default:a(()=>[e(t(L),{variant:J(s.estado)},{default:a(()=>[o(r(s.estado),1)]),_:2},1032,["variant"])]),_:2},1024),e(t(f),null,{default:a(()=>[n("div",vt,[s.estado!=="finalizada"?(l(),c("div",gt,[s.estado==="borrador"&&(!s.votantes_count||s.votantes_count===0)?(l(),c("div",xt," ⚠️ Sin votantes ")):m("",!0),g.canEdit?(l(),_(t(y),{key:1},{default:a(()=>[e(t(V),{"as-child":""},{default:a(()=>[e(t(R),{checked:s.estado==="activa",disabled:!1},null,8,["checked"])]),_:2},1024),e(t($),null,{default:a(()=>[e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[o(r(s.estado==="activa"?"Desactivar votación":"Activar votación"),1)]),_:2},1024),e(t(z),null,{default:a(()=>[s.estado==="activa"?(l(),c("span",ht,' La votación "'+r(s.titulo)+'" será desactivada y volverá al estado borrador. Los votantes no podrán acceder hasta que la actives nuevamente. ',1)):(l(),c("span",bt,[!s.votantes_count||s.votantes_count===0?(l(),c("span",kt,[...i[11]||(i[11]=[o(" ⚠️ Advertencia: Esta votación no tiene votantes asignados. Debes asignar votantes antes de poder activarla. ",-1),n("br",null,null,-1),n("br",null,null,-1)])])):m("",!0),o(' La votación "'+r(s.titulo)+'" será activada y los votantes podrán empezar a votar. Asegúrate de que la configuración esté completa. ',1)]))]),_:2},1024)]),_:2},1024),e(t(S),null,{default:a(()=>[e(t(E),null,{default:a(()=>[...i[12]||(i[12]=[o("Cancelar",-1)])]),_:1}),e(t(F),{onClick:p=>H(s),class:at((!s.votantes_count||s.votantes_count===0)&&s.estado==="borrador"?"bg-orange-600 hover:bg-orange-700":"")},{default:a(()=>[o(r(s.estado==="activa"?"Desactivar":"Activar"),1)]),_:2},1032,["onClick","class"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):m("",!0),n("span",yt,r(s.estado==="activa"?"Activa":"Inactiva"),1)])):m("",!0),s.estado==="activa"&&g.canEdit?(l(),c("div",$t,[e(t(y),null,{default:a(()=>[e(t(V),{"as-child":""},{default:a(()=>[e(t(x),{variant:"outline",size:"sm",class:"text-orange-600 hover:text-orange-700"},{default:a(()=>[...i[13]||(i[13]=[o(" Finalizar ",-1)])]),_:1})]),_:1}),e(t($),null,{default:a(()=>[e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[...i[14]||(i[14]=[o("Finalizar votación",-1)])]),_:1}),e(t(z),null,{default:a(()=>[o(' La votación "'+r(s.titulo)+'" será finalizada permanentemente. Esta acción no se puede deshacer y los votantes ya no podrán votar. ',1)]),_:2},1024)]),_:2},1024),e(t(S),null,{default:a(()=>[e(t(E),null,{default:a(()=>[...i[15]||(i[15]=[o("Cancelar",-1)])]),_:1}),e(t(F),{onClick:p=>U(s),class:"bg-orange-600 text-white hover:bg-orange-700"},{default:a(()=>[...i[16]||(i[16]=[o(" Finalizar ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])):m("",!0),s.estado==="finalizada"?(l(),c("div",Ct," Finalizada ")):m("",!0)])]),_:2},1024),e(t(f),null,{default:a(()=>[o(r(B(s.fecha_inicio)),1)]),_:2},1024),e(t(f),null,{default:a(()=>[o(r(B(s.fecha_fin)),1)]),_:2},1024),e(t(f),null,{default:a(()=>[n("div",wt,[e(t(ot),{class:"h-4 w-4 text-muted-foreground"}),n("span",null,r(s.votantes_count||0),1)])]),_:2},1024),e(t(f),{class:"text-right"},{default:a(()=>[n("div",zt,[g.canManageVoters?(l(),_(t(x),{key:0,variant:"ghost",size:"sm",onClick:p=>j(s.id),title:"Ver historial de importaciones"},{default:a(()=>[e(t(lt),{class:"h-4 w-4"})]),_:1},8,["onClick"])):m("",!0),s.resultados_publicos?(l(),_(t(x),{key:1,variant:"ghost",size:"sm",onClick:p=>I(s.id),title:"Ver resultados",class:"text-blue-600 hover:text-blue-700"},{default:a(()=>[e(t(nt),{class:"h-4 w-4"})]),_:1},8,["onClick"])):m("",!0),s.estado!=="finalizada"&&g.canEdit?(l(),_(t(x),{key:2,variant:"ghost",size:"sm","as-child":""},{default:a(()=>[e(t(N),{href:t(b)("admin.votaciones.edit",s.id)},{default:a(()=>[e(t(rt),{class:"h-4 w-4"})]),_:1},8,["href"])]),_:2},1024)):m("",!0),s.estado==="borrador"&&g.canDelete?(l(),_(t(y),{key:3},{default:a(()=>[e(t(V),{"as-child":""},{default:a(()=>[e(t(x),{variant:"ghost",size:"sm"},{default:a(()=>[e(t(dt),{class:"h-4 w-4 text-destructive"})]),_:1})]),_:1}),e(t($),null,{default:a(()=>[e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[...i[17]||(i[17]=[o("¿Eliminar votación?",-1)])]),_:1}),e(t(z),null,{default:a(()=>[o(' Esta acción no se puede deshacer. Se eliminará permanentemente la votación "'+r(s.titulo)+'" y todos sus datos asociados. ',1)]),_:2},1024)]),_:2},1024),e(t(S),null,{default:a(()=>[e(t(E),null,{default:a(()=>[...i[18]||(i[18]=[o("Cancelar",-1)])]),_:1}),e(t(F),{onClick:p=>G(s.id),class:"bg-destructive text-destructive-foreground hover:bg-destructive/90"},{default:a(()=>[...i[19]||(i[19]=[o(" Eliminar ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):m("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),u.votaciones.last_page>1?(l(),c("div",St,[n("p",Et," Mostrando "+r((u.votaciones.current_page-1)*u.votaciones.per_page+1)+" a "+r(Math.min(u.votaciones.current_page*u.votaciones.per_page,u.votaciones.total))+" de "+r(u.votaciones.total)+" resultados ",1),n("div",Ft,[(l(!0),c(A,null,T(u.votaciones.links,s=>(l(),_(t(x),{key:s.label,variant:s.active?"default":"outline",disabled:!s.url,size:"sm",onClick:p=>s.url&&t(h).get(s.url),innerHTML:s.label},null,8,["variant","disabled","onClick","innerHTML"]))),128))])])):m("",!0)]),_:1})]),_:1})])])]),_:1})],64))}});export{Je as default};
