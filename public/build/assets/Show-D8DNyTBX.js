import{d as q,r as V,c as D,i as b,e,f as t,q as G,w as i,g as s,t as c,b as g,j as p,v as I,h as u,m,F as O,k as R,s as J}from"./app-CiYKByDx.js";import{_ as K}from"./AdminLayout.vue_vue_type_script_setup_true_lang-zyTnkDHX.js";import{c as Q,_ as B}from"./createLucideIcon-vCxVUtgv.js";import{_,a as y,b as x,c as k}from"./CardTitle.vue_vue_type_script_setup_true_lang-HSpsIzMS.js";import{_ as W}from"./CardDescription.vue_vue_type_script_setup_true_lang-8xXpmH2S.js";import{_ as M}from"./index-CBfQJzNi.js";import{_ as X}from"./Label.vue_vue_type_script_setup_true_lang-ByqVB3B0.js";import{_ as Y,a as Z,b as w,c as $}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BO7b2YtV.js";import{_ as aa}from"./AccordionContent.vue_vue_type_script_setup_true_lang-PhPVl047.js";import{_ as ta}from"./EvidenciasTable.vue_vue_type_script_setup_true_lang-C3xA9EzD.js";import{O as ea}from"./ObligacionTree-UlddLWVy.js";import{_ as ia,a as la}from"./ActivityLog.vue_vue_type_script_setup_true_lang-CtKu_jbx.js";import{u as oa}from"./usePermissions-D0W1e031.js";import{A as sa}from"./arrow-left-BtamvHVy.js";import{P as na}from"./pencil-Cyndv7LT.js";import{I as ra}from"./info-CzfezrZP.js";import{I as da}from"./image-BC_d2F21.js";import{A as ua}from"./activity-4TxYgoBz.js";import{P as ca}from"./paperclip-cJiHZWo0.js";import{f as F,e as L}from"./es-BDPlFIsO.js";import{p as P}from"./parseISO-DFjB8F03.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-S6CgYmJE.js";import"./index-DOxNh0bZ.js";import"./floating-ui.vue-CL8FEkqP.js";import"./x-CXPZGP07.js";import"./Input.vue_vue_type_script_setup_true_lang-gE8KuA2i.js";import"./index-D3UOLBw5.js";import"./index-DGFgBY2S.js";import"./shield-BxAJWss7.js";import"./user-BJw_giDL.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BNFXC0bJ.js";import"./chevron-right-B-W4L8zY.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-93YjiwmB.js";import"./VisuallyHidden-NH1sY0jv.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-chRhyKDL.js";import"./check-Bb0tOxrP.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Bp8Fmgfx.js";import"./index-B6kxqeoX.js";import"./circle-alert-CPGGKiyu.js";import"./map-pin-cgEzkzwb.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-B5ApEFHj.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-5W_05qNw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-p_9iSoEq.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BrHz5HWe.js";import"./tag-BIqORR1G.js";import"./users-CtprPBb4.js";import"./target-CwFtMMUY.js";import"./vote-AckLOrAG.js";import"./folder-open-Ctjg_yvM.js";import"./send-Cyu4d_86.js";import"./file-text-BHhvAW8T.js";import"./briefcase-DRMnjkxD.js";import"./calendar-BPpWwgkz.js";import"./megaphone-KHZWJGl2.js";import"./user-check-BFUYGW0M.js";import"./clipboard-list-DH5kx6Km.js";import"./mail-DSsAb63T.js";import"./message-square-BRPAb3uw.js";import"./external-link-B7hKJaE7.js";import"./panel-left-BnECy0Gx.js";import"./index-B0BlEbJl.js";import"./RovingFocusItem-vImyJGFl.js";import"./utils-BZqgwCuC.js";import"./useArrowNavigation-B5rxJs06.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-jvC2Wrgk.js";import"./download-DKl48H-v.js";import"./Separator.vue_vue_type_script_setup_true_lang-BZ4rJPnn.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-BRZiK5q0.js";import"./circle-BHvYBrui.js";import"./layers-DeS92oPZ.js";import"./plus-AM__aCJH.js";import"./trash-2-BAlT_ibO.js";import"./loader-circle-BlmxD1f_.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-KozJrtAF.js";import"./filter-Dyyx6ih_.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Q("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),fa={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},va={class:"flex items-center justify-between"},pa={class:"text-3xl font-bold"},ga={class:"text-muted-foreground mt-2"},ha={class:"flex gap-2"},ba={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},_a={class:"md:col-span-2 space-y-6"},ya={class:"mt-1"},xa={class:"space-y-6"},ka={class:"font-medium"},wa={class:"text-sm text-gray-600 mt-1"},$a={class:"space-y-2"},ja=["href"],Aa={class:"text-xs text-gray-500"},Va={key:0},Da={class:"text-xs text-gray-500"},Ia={key:1},Ma={class:"text-xs text-gray-500"},Zt=q({__name:"Show",props:{obligacion:{},contrato:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canCreateChild:{type:Boolean},actividades:{},usuariosActividades:{}},setup(l){const j=l,{hasPermission:S}=oa(),C=V("general"),d=V({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null,entregable_id:null}),f=V({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),N=[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"},{title:j.obligacion.titulo}],h=D(()=>j.obligacion.evidencias||[]),T=D(()=>{let o=h.value;return d.value.tipo&&(o=o.filter(a=>a.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(a=>a.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(a=>{var r;return((r=a.usuario)==null?void 0:r.id)===d.value.usuario_id})),d.value.entregable_id&&(o=o.filter(a=>{var r;return(r=a.entregables)==null?void 0:r.some(n=>n.id===d.value.entregable_id)})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(a=>{const r=new Date(a.created_at);if(d.value.fecha_inicio){const n=new Date(d.value.fecha_inicio);if(r<n)return!1}if(d.value.fecha_fin){const n=new Date(d.value.fecha_fin);if(n.setHours(23,59,59,999),r>n)return!1}return!0})),o}),z=D(()=>{let o=j.actividades||[];return f.value.usuario_id&&(o=o.filter(a=>{var r;return((r=a.causer)==null?void 0:r.id)===f.value.usuario_id})),f.value.tipo_accion&&(o=o.filter(a=>a.event===f.value.tipo_accion)),(f.value.fecha_inicio||f.value.fecha_fin)&&(o=o.filter(a=>{const r=new Date(a.created_at);if(f.value.fecha_inicio){const n=new Date(f.value.fecha_inicio);if(r<n)return!1}if(f.value.fecha_fin){const n=new Date(f.value.fecha_fin);if(n.setHours(23,59,59,999),r>n)return!1}return!0})),o}),A=o=>{if(!o)return"Sin fecha";try{return F(P(o),"dd MMM yyyy HH:mm",{locale:L})}catch{return o}},U=o=>{if(!o)return"-";try{return F(P(o),"d 'de' MMMM 'de' yyyy",{locale:L})}catch{return o}};return(o,a)=>(m(),b(O,null,[e(t(G),{title:`Obligación - ${l.obligacion.titulo}`},null,8,["title"]),e(K,{breadcrumbs:N},{default:i(()=>[s("div",fa,[s("div",va,[s("div",null,[s("h1",pa,c(l.obligacion.titulo),1),s("p",ga," Contrato: "+c(l.contrato.nombre),1)]),s("div",ha,[e(t(I),{href:`/admin/contratos/${l.contrato.id}`},{default:i(()=>[e(t(B),{variant:"outline",size:"sm"},{default:i(()=>[e(t(sa),{class:"h-4 w-4 mr-2"}),a[4]||(a[4]=u(" Ver Contrato ",-1))]),_:1})]),_:1},8,["href"]),l.canEdit?(m(),g(t(I),{key:0,href:o.route("admin.obligaciones.edit",l.obligacion.id)},{default:i(()=>[e(t(B),{variant:"outline",size:"sm"},{default:i(()=>[e(t(na),{class:"h-4 w-4 mr-2"}),a[5]||(a[5]=u(" Editar ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])]),e(t(Y),{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=r=>C.value=r),class:"flex-1"},{default:i(()=>{var r;return[e(t(Z),null,{default:i(()=>{var n;return[e(t(w),{value:"general"},{default:i(()=>[e(t(ra),{class:"h-4 w-4 mr-2"}),a[6]||(a[6]=u(" General ",-1))]),_:1}),(n=l.obligacion.hijos)!=null&&n.length?(m(),g(t(w),{key:0,value:"hijos"},{default:i(()=>{var v;return[e(t(ma),{class:"h-4 w-4 mr-2"}),a[7]||(a[7]=u(" Obligaciones Hijas ",-1)),(v=l.obligacion.hijos)!=null&&v.length?(m(),g(t(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:i(()=>[u(c(l.obligacion.hijos.length),1)]),_:1})):p("",!0)]}),_:1})):p("",!0),e(t(w),{value:"evidencias"},{default:i(()=>[e(t(da),{class:"h-4 w-4 mr-2"}),a[8]||(a[8]=u(" Evidencias ",-1)),h.value.length>0?(m(),g(t(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:i(()=>[u(c(h.value.length),1)]),_:1})):p("",!0)]),_:1}),e(t(w),{value:"actividad"},{default:i(()=>[e(t(ua),{class:"h-4 w-4 mr-2"}),a[9]||(a[9]=u(" Actividad ",-1)),l.actividades&&l.actividades.length>0?(m(),g(t(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:i(()=>[u(c(l.actividades.length),1)]),_:1})):p("",!0)]),_:1})]}),_:1}),e(t($),{value:"general",class:"space-y-4 mt-6"},{default:i(()=>{var n;return[s("div",ba,[s("div",_a,[e(t(_),null,{default:i(()=>[e(t(y),null,{default:i(()=>[e(t(x),null,{default:i(()=>[...a[10]||(a[10]=[u("Información General",-1)])]),_:1})]),_:1}),e(t(k),{class:"space-y-4"},{default:i(()=>[s("div",null,[e(t(X),null,{default:i(()=>[...a[11]||(a[11]=[u("Descripción",-1)])]),_:1}),s("p",ya,c(l.obligacion.descripcion||"Sin descripción"),1)])]),_:1})]),_:1})]),s("div",xa,[e(t(_),null,{default:i(()=>[e(t(y),null,{default:i(()=>[e(t(x),null,{default:i(()=>[...a[12]||(a[12]=[u("Detalles del Contrato",-1)])]),_:1})]),_:1}),e(t(k),null,{default:i(()=>{var v;return[e(t(I),{href:o.route("admin.contratos.show",l.contrato.id),class:"hover:underline"},{default:i(()=>[s("h3",ka,c(l.contrato.nombre),1)]),_:1},8,["href"]),s("p",wa,c((v=l.contrato.proyecto)==null?void 0:v.nombre),1)]}),_:1})]),_:1}),(n=l.obligacion.archivos_adjuntos)!=null&&n.length?(m(),g(t(_),{key:0},{default:i(()=>[e(t(y),null,{default:i(()=>[e(t(x),null,{default:i(()=>[...a[13]||(a[13]=[u("Archivos Adjuntos",-1)])]),_:1})]),_:1}),e(t(k),null,{default:i(()=>[s("div",$a,[(m(!0),b(O,null,R(l.obligacion.archivos_adjuntos,v=>(m(),b("div",{key:v.ruta,class:"flex items-center gap-2"},[e(t(ca),{class:"h-4 w-4"}),s("a",{href:v.ruta,target:"_blank",class:"hover:underline text-sm"},c(v.nombre_original),9,ja)]))),128))])]),_:1})]),_:1})):p("",!0),e(t(_),null,{default:i(()=>[e(t(y),null,{default:i(()=>[e(t(x),null,{default:i(()=>[...a[14]||(a[14]=[u("Auditoría",-1)])]),_:1})]),_:1}),e(t(k),{class:"text-sm space-y-2"},{default:i(()=>{var v,E,H;return[s("div",null,[a[15]||(a[15]=s("span",{class:"text-gray-600"},"Creado por:",-1)),s("p",null,c(((v=l.obligacion.creador)==null?void 0:v.name)||"Sistema"),1),s("p",Aa,c(A(l.obligacion.created_at)),1)]),l.obligacion.updated_at?(m(),b("div",Va,[a[16]||(a[16]=s("span",{class:"text-gray-600"},"Última actualización:",-1)),s("p",null,c(((E=l.obligacion.actualizador)==null?void 0:E.name)||"Sistema"),1),s("p",Da,c(A(l.obligacion.updated_at)),1)])):p("",!0),l.obligacion.cumplido_at?(m(),b("div",Ia,[a[17]||(a[17]=s("span",{class:"text-gray-600"},"Cumplido por:",-1)),s("p",null,c(((H=l.obligacion.cumplido_por_usuario)==null?void 0:H.name)||"Sistema"),1),s("p",Ma,c(A(l.obligacion.cumplido_at)),1)])):p("",!0)]}),_:1})]),_:1})])])]}),_:1}),(r=l.obligacion.hijos)!=null&&r.length?(m(),g(t($),{key:0,value:"hijos",class:"space-y-4 mt-6"},{default:i(()=>[e(t(_),null,{default:i(()=>[e(t(y),null,{default:i(()=>[e(t(x),null,{default:i(()=>[...a[18]||(a[18]=[u("Obligaciones Hijas",-1)])]),_:1}),e(t(W),null,{default:i(()=>[...a[19]||(a[19]=[u(" Sub-obligaciones derivadas de esta obligación principal ",-1)])]),_:1})]),_:1}),e(t(k),null,{default:i(()=>[e(ea,{obligaciones:l.obligacion.hijos,contratoId:l.obligacion.contrato_id,editable:t(S)("obligaciones.edit"),onEdit:a[0]||(a[0]=n=>t(J).visit(o.route("admin.obligaciones.edit",n.id)))},null,8,["obligaciones","contratoId","editable"])]),_:1})]),_:1})]),_:1})):p("",!0),e(t($),{value:"evidencias",class:"space-y-4 mt-6"},{default:i(()=>[h.value.length>0?(m(),g(aa,{key:0,modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=n=>d.value=n),contratos:[l.contrato],evidencias:h.value},null,8,["modelValue","contratos","evidencias"])):p("",!0),e(ta,{mode:"simple",evidencias:T.value,contrato:l.contrato,"format-date":U,"card-title":"Evidencias Asociadas","card-description":"Evidencias cargadas para esta obligación"},null,8,["evidencias","contrato"])]),_:1}),e(t($),{value:"actividad",class:"space-y-4 mt-6"},{default:i(()=>[l.actividades&&l.actividades.length>0?(m(),g(ia,{key:0,modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=n=>f.value=n),usuarios:l.usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):p("",!0),e(la,{activities:z.value,title:"Historial de Actividad",description:"Registro de cambios y actividades relacionadas con esta obligación","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]}),_:1},8,["modelValue"])])]),_:1})],64))}});export{Zt as default};
