import{d as F,r as i,c as b,i as h,e as t,F as I,k as M,w as l,f as s,g as C,h as u,t as p,j as N,s as U,b as k,m as _,x as q,n as R}from"./app-DOAvpdpy.js";import{_ as x}from"./createLucideIcon-B8d5bW74.js";import{_ as S}from"./Switch.vue_vue_type_script_setup_true_lang-71QEUPTl.js";import{_ as P}from"./Label.vue_vue_type_script_setup_true_lang-D3G2L01q.js";import{_ as L,a as O,b as T,c as X,d as G,e as H}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Cep9uJW9.js";import{t as z}from"./index-D4UxCdcO.js";import{_ as J}from"./ComentarioContextoInput.vue_vue_type_script_setup_true_lang-BsFE5JFL.js";import{C as K}from"./clock-_CclVdPa.js";import{C as Q}from"./circle-x-BwZ4OB4t.js";import{C as W}from"./circle-check-big-Bp-GPbzd.js";const Y={class:"flex items-center gap-2"},Z={class:"space-y-4 py-4"},ee={class:"flex items-center justify-between"},ae={key:0,class:"space-y-2"},ve=F({__name:"EvidenciaAccionesEstado",props:{evidencia:{},proyectoId:{},estadoActual:{}},setup(w){const d=w,m=i(!1),r=i(null),v=i(""),g=i([]),n=i(!1),f=i(!1),y=i(null),c={aprobada:{label:"Aprobar",icon:W,color:"text-green-600 hover:text-green-700 hover:bg-green-50",variant:"ghost",defaultComentario:!1},rechazada:{label:"Rechazar",icon:Q,color:"text-red-600 hover:text-red-700 hover:bg-red-50",variant:"ghost",defaultComentario:!0},pendiente:{label:"A Pendiente",icon:K,color:"text-yellow-600 hover:text-yellow-700 hover:bg-yellow-50",variant:"ghost",defaultComentario:!1}},A=b(()=>{const e=[];return d.estadoActual!=="aprobada"&&e.push("aprobada"),d.estadoActual!=="rechazada"&&e.push("rechazada"),d.estadoActual!=="pendiente"&&e.push("pendiente"),e}),V=b(()=>r.value?`${c[r.value].label} evidencia`:""),E=b(()=>r.value?{aprobada:"¿Confirmas que deseas aprobar esta evidencia?",rechazada:"¿Confirmas que deseas rechazar esta evidencia?",pendiente:"¿Confirmas que deseas devolver esta evidencia a estado pendiente?"}[r.value]:""),j=e=>{r.value=e,v.value="",n.value=c[e].defaultComentario,m.value=!0},B=()=>{r.value&&(f.value=!0,U.post(`/admin/proyectos/${d.proyectoId}/evidencias/${d.evidencia.id}/cambiar-estado`,{estado:r.value,comentario:n.value?v.value:null,agregar_comentario:n.value,archivos:n.value?g.value:[]},{preserveScroll:!0,onSuccess:()=>{z.success(`Estado cambiado a ${r.value}`),m.value=!1,$()},onError:e=>{const a=Object.values(e).flat().join(", ")||"Error al cambiar estado";z.error(a)},onFinish:()=>{f.value=!1}}))},$=()=>{var e;v.value="",g.value=[],(e=y.value)==null||e.clear()},D=()=>{m.value=!1,r.value=null,n.value=!1,$()};return(e,a)=>(_(),h("div",Y,[(_(!0),h(I,null,M(A.value,o=>(_(),k(s(x),{key:o,variant:c[o].variant,size:"sm",class:R(["h-8",c[o].color]),onClick:oe=>j(o)},{default:l(()=>[(_(),k(q(c[o].icon),{class:"h-4 w-4 mr-1"})),u(" "+p(c[o].label),1)]),_:2},1032,["variant","class","onClick"]))),128)),t(s(H),{open:m.value,"onUpdate:open":a[3]||(a[3]=o=>m.value=o)},{default:l(()=>[t(s(L),{class:"sm:max-w-lg"},{default:l(()=>[t(s(O),null,{default:l(()=>[t(s(T),null,{default:l(()=>[u(p(V.value),1)]),_:1}),t(s(X),null,{default:l(()=>[u(p(E.value),1)]),_:1})]),_:1}),C("div",Z,[C("div",ee,[t(s(P),{for:"agregar-comentario",class:"text-sm"},{default:l(()=>[u(p(r.value==="rechazada"?"Agregar motivo":"Agregar comentario"),1)]),_:1}),t(s(S),{id:"agregar-comentario",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=o=>n.value=o)},null,8,["modelValue"])]),n.value?(_(),h("div",ae,[t(J,{ref_key:"comentarioInputRef",ref:y,modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=o=>v.value=o),placeholder:r.value==="rechazada"?"Describe el motivo del rechazo...":"Agrega un comentario opcional...",rows:3,"show-file-upload":!0,"upload-module":"comentarios","upload-field-id":"evidencia-comentario","onUpdate:archivos":a[2]||(a[2]=o=>g.value=o)},null,8,["modelValue","placeholder"]),a[4]||(a[4]=C("p",{class:"text-xs text-muted-foreground"}," Este comentario aparecerá con el badge del nuevo estado. ",-1))])):N("",!0)]),t(s(G),{class:"gap-2 sm:gap-0"},{default:l(()=>[t(s(x),{variant:"outline",onClick:D,disabled:f.value},{default:l(()=>[...a[5]||(a[5]=[u(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(s(x),{variant:r.value==="rechazada"?"destructive":"default",onClick:B,disabled:f.value},{default:l(()=>[u(p(f.value?"Procesando...":"Confirmar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}});export{ve as _};
