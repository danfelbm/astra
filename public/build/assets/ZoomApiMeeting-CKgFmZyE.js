import{a as w,_ as k}from"./index-DOgIzuc0.js";import{_ as E}from"./AlertTitle.vue_vue_type_script_setup_true_lang-DFmtOPq_.js";import{_ as C}from"./createLucideIcon-CVN7nJ0z.js";import{a as V,b as M,c as T,_ as I,t as h,d as P}from"./index-D8xSMwQO.js";import{_ as N}from"./CardDescription.vue_vue_type_script_setup_true_lang-BdMPxRhD.js";import{d as Y,k as z,c as A,p as F,a as g,o as i,f as c,i as m,j as f,b as s,u as a,e as r,n as K,g as o,t as _,q as S}from"./app-2iTeOa9n.js";import{V as L}from"./video-DDJH7d1B.js";import{R as O}from"./refresh-cw-CXEy99ZP.js";import{L as R}from"./loader-circle-Bus_xNZ7.js";import{l as q}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D5Fr6g0s.js";import{C as Q}from"./circle-check-8vI23kxX.js";import{C as B}from"./clock-Dx_sm8WL.js";import{E as ee}from"./external-link-B5M0JV3X.js";import"./VisuallyHidden-CJ3Oqunl.js";import"./Label.vue_vue_type_script_setup_true_lang-CbiKy8_G.js";import"./index-lxfuibjm.js";const ae={class:"space-y-4"},se={class:"flex items-center gap-2 mb-4"},te={key:0,class:"text-center py-8"},re={key:2},oe={key:0},ne={class:"text-sm"},ie={key:1},le={class:"text-sm font-mono bg-gray-50 px-2 py-1 rounded"},ue={class:"pt-2"},de={key:0,class:"mb-3"},ce={class:"flex gap-2"},me=Y({__name:"ZoomApiMeeting",props:{asambleaId:{}},setup(D){const v=D,d=z(!1),b=z(!1),l=z(null),u=z(null),{route:x}=window,y=async()=>{try{d.value=!0,l.value=null;const e=await(await fetch(x("api.zoom.registrants.status",v.asambleaId),{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();e.success?u.value=e:l.value=e.error||"Error obteniendo estado"}catch(t){console.error("Error fetching status:",t),l.value="Error de conexión"}finally{d.value=!1}},G=async()=>{var t,e;try{b.value=!0,l.value=null;const n=await S.post(x("api.zoom.registrants.register"),{asamblea_id:v.asambleaId});n.data.success?await y():l.value=n.data.error||"Error registrando usuario"}catch(n){console.error("Error registering user:",n),(e=(t=n.response)==null?void 0:t.data)!=null&&e.error?l.value=n.response.data.error:l.value="Error de conexión"}finally{b.value=!1}},X=async()=>{try{d.value=!0,l.value=null;const e=await(await fetch(x("api.zoom.registrants.destroy",v.asambleaId),{method:"DELETE",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();e.success?await y():l.value=e.error||"Error cancelando registro"}catch(t){console.error("Error canceling registration:",t),l.value="Error de conexión"}finally{d.value=!1}},H=async()=>{var t,e;try{(await S.post(x("asambleas.marcar-asistencia",v.asambleaId))).data.success&&h.success("✅ Asistencia registrada",{description:"Tu asistencia ha sido marcada exitosamente",duration:3e3})}catch(n){console.error("Error marcando asistencia:",n),((t=n.response)==null?void 0:t.status)===400?h.warning("La asamblea no está en curso",{duration:3e3}):((e=n.response)==null?void 0:e.status)===403?h.error("No eres participante de esta asamblea",{duration:3e3}):h.error("Error al registrar asistencia",{description:"Tu asistencia no pudo ser registrada, pero puedes unirte a la reunión",duration:4e3})}},Z=async()=>{var t;await H(),(t=p.value)!=null&&t.zoom_join_url&&window.open(p.value.zoom_join_url,"_blank","noopener,noreferrer")},p=A(()=>{var e;if(!((e=u.value)!=null&&e.existing_registration))return null;const t=u.value.existing_registration;return{...t,statusColor:t.status==="active"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}}),U=A(()=>{var t,e;return((t=u.value)==null?void 0:t.can_register)&&!((e=u.value)!=null&&e.existing_registration)}),W=A(()=>{var n,$,j;const t=(n=u.value)==null?void 0:n.existing_registration,e=((j=($=u.value)==null?void 0:$.asamblea)==null?void 0:j.estado)==="en_curso";return t&&t.zoom_join_url&&e}),J=A(()=>{var t,e;return((e=(t=u.value)==null?void 0:t.asamblea)==null?void 0:e.estado)==="en_curso"});return F(()=>{y()}),(t,e)=>(i(),g("div",ae,[c("div",se,[s(a(L),{class:"h-5 w-5 text-blue-600"}),e[0]||(e[0]=c("h3",{class:"text-lg font-semibold"},"Videoconferencia",-1)),s(a(C),{variant:"ghost",size:"sm",onClick:y,disabled:d.value,class:"ml-auto"},{default:r(()=>[s(a(O),{class:K(["h-4 w-4",{"animate-spin":d.value}])},null,8,["class"])]),_:1},8,["disabled"])]),d.value&&!u.value?(i(),g("div",te,[s(a(R),{class:"h-8 w-8 animate-spin mx-auto mb-2"}),e[1]||(e[1]=c("p",{class:"text-muted-foreground"},"Cargando información...",-1))])):m("",!0),l.value?(i(),f(a(k),{key:1,variant:"destructive"},{default:r(()=>[s(a(q),{class:"h-4 w-4"}),s(a(E),null,{default:r(()=>e[2]||(e[2]=[o("Error")])),_:1}),s(a(w),null,{default:r(()=>[o(_(l.value),1)]),_:1})]),_:1})):m("",!0),u.value&&!d.value?(i(),g("div",re,[p.value?(i(),f(a(I),{key:0,class:"border-green-200"},{default:r(()=>[s(a(V),null,{default:r(()=>[s(a(M),{class:"flex items-center gap-2 text-green-700"},{default:r(()=>[s(a(Q),{class:"h-5 w-5"}),e[3]||(e[3]=o(" Ya estás registrado "))]),_:1}),s(a(N),null,{default:r(()=>e[4]||(e[4]=[o(" Tienes acceso a esta videoconferencia ")])),_:1})]),_:1}),s(a(T),{class:"space-y-4"},{default:r(()=>[p.value.zoom_start_time?(i(),g("div",oe,[e[5]||(e[5]=c("p",{class:"text-sm font-medium text-muted-foreground"},"Hora de inicio",-1)),c("p",ne,_(new Date(p.value.zoom_start_time).toLocaleString("es-ES")),1)])):m("",!0),p.value.zoom_registrant_id?(i(),g("div",ie,[e[6]||(e[6]=c("p",{class:"text-sm font-medium text-muted-foreground"},"Token único de ingreso",-1)),c("p",le,_(p.value.zoom_registrant_id),1)])):m("",!0),c("div",ue,[J.value?m("",!0):(i(),g("div",de,[s(a(k),null,{default:r(()=>[s(a(B),{class:"h-4 w-4"}),s(a(E),null,{default:r(()=>e[7]||(e[7]=[o("Reunión no disponible")])),_:1}),s(a(w),null,{default:r(()=>[o(' La videoconferencia solo está disponible cuando la asamblea está "En Curso". Estado actual: '+_(u.value.asamblea.estado_label),1)]),_:1})]),_:1})])),c("div",ce,[W.value?(i(),f(a(C),{key:0,onClick:Z,class:"flex-1 bg-green-600 hover:bg-green-700 text-white"},{default:r(()=>[s(a(ee),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=o(" Unirse a la Videoconferencia "))]),_:1})):m("",!0),s(a(C),{variant:"outline",onClick:X,disabled:d.value,size:"sm",class:"hidden"},{default:r(()=>[d.value?(i(),f(a(R),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):m("",!0),e[9]||(e[9]=o(" Cancelar "))]),_:1},8,["disabled"])])])]),_:1})]),_:1})):U.value?(i(),f(a(I),{key:1},{default:r(()=>[s(a(V),null,{default:r(()=>[s(a(M),{class:"flex items-center gap-2"},{default:r(()=>[s(a(L),{class:"h-5 w-5"}),e[10]||(e[10]=o(" Generar Acceso Personal "))]),_:1}),s(a(N),null,{default:r(()=>e[11]||(e[11]=[o(" Genera tu link personal para acceder a la videoconferencia ")])),_:1})]),_:1}),s(a(T),null,{default:r(()=>[s(a(C),{onClick:G,disabled:b.value,class:"w-full"},{default:r(()=>[b.value?(i(),f(a(R),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):(i(),f(a(L),{key:1,class:"mr-2 h-4 w-4"})),e[12]||(e[12]=o(" Generar link de ingreso "))]),_:1},8,["disabled"])]),_:1})]),_:1})):(i(),f(a(k),{key:2},{default:r(()=>[s(a(B),{class:"h-4 w-4"}),s(a(E),null,{default:r(()=>e[13]||(e[13]=[o("No disponible")])),_:1}),s(a(w),null,{default:r(()=>[o(_(u.value.reason),1)]),_:1})]),_:1})),s(a(k),{variant:"destructive",class:"mt-4"},{default:r(()=>[s(a(q),{class:"h-4 w-4"}),s(a(E),null,{default:r(()=>e[14]||(e[14]=[o("Advertencia")])),_:1}),s(a(w),null,{default:r(()=>e[15]||(e[15]=[o(" Si compartes tu link de ingreso con alguien más corres el riesgo de no poder participar en la asamblea, pues solo un dispositivo puede estar conectado a la videoconferencia. ")])),_:1})]),_:1})])):m("",!0)]))}}),Re=P(me,[["__scopeId","data-v-2e987eb9"]]);export{Re as default};
