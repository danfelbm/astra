import{_ as ae,C as L}from"./index-CQWxbFbf.js";import{_ as v}from"./createLucideIcon-s5sOHYqj.js";import{_ as oe,c as ne}from"./CardTitle.vue_vue_type_script_setup_true_lang-BTRZ6n-Z.js";import{_ as A}from"./Label.vue_vue_type_script_setup_true_lang-D9qfcfgT.js";import{_ as le,a as ie,b as R,c as b,d as re,e as h}from"./TableHeader.vue_vue_type_script_setup_true_lang-C7J5jmD9.js";import{S as de,U as ue,_ as ce}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dbsa-okf.js";import{d as K,a as p,i as me,o as u,f as s,F as V,r as X,j as G,u as a,W as I,k as _,w as fe,b as t,m as pe,e as o,g as l,P as F,t as i,n as _e}from"./app-CELEraHo.js";import{_ as ve}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-R2w7nro7.js";import{_ as U,a as O,b as B,c as D,d as z,e as H}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D5Ok5Z3Z.js";import{_ as N}from"./Checkbox.vue_vue_type_script_setup_true_lang-CyXZooLA.js";import{M as j}from"./mail-Bz78zmZr.js";import{S as P}from"./send-H6ZBAtJ8.js";import{E as ge}from"./eye-Dlm8BiRN.js";import{M as J}from"./message-square-BTzqJBEg.js";import"./index-B2-9gOJc.js";import"./check-DBj6brRU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DcJpg0p7.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-BarmgKfq.js";import"./VisuallyHidden-qfxc1uTE.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DGsevKjb.js";import"./index-W4JxdBIy.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-Z0Iz-EuH.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Cscsy6Ku.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DFQo21Xz.js";import"./es-DfN3vIXC.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-CtSxIsEx.js";import"./loader-circle-5wnE5zXn.js";import"./trash-2-CtlWLjbx.js";import"./plus-BAx3QMdb.js";import"./search-CBEjtJNs.js";import"./history-CGZnWK2J.js";import"./save-CDBr5p69.js";const xe={key:0,class:"mt-6 flex justify-center"},be={class:"flex items-center gap-2"},he=["innerHTML"],ye=K({__name:"Pagination",props:{links:{}},setup(W){const g=d=>({"pagination.previous":"&laquo; Anterior","pagination.next":"Siguiente &raquo;","&laquo; Previous":"&laquo; Anterior","Next &raquo;":"Siguiente &raquo;",Previous:"Anterior",Next:"Siguiente","...":"..."})[d]||d,M=d=>{d&&I.get(d)};return(d,T)=>d.links&&d.links.length>3?(u(),p("div",xe,[s("div",be,[(u(!0),p(V,null,X(d.links,f=>(u(),p(V,{key:f.label},[f.url?(u(),G(a(v),{key:0,variant:f.active?"default":"outline",size:"sm",onClick:x=>M(f.url),innerHTML:g(f.label)},null,8,["variant","onClick","innerHTML"])):(u(),p("span",{key:1,class:"px-3 py-1 text-sm text-muted-foreground cursor-not-allowed",innerHTML:g(f.label)},null,8,he))],64))),128))])])):me("",!0)}}),we={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ce={class:"flex items-center justify-between"},$e={class:"flex gap-3"},ke={key:0,class:"text-center py-8"},Ee={key:1,class:"rounded-md border"},Se={class:"font-medium"},je={class:"text-sm text-muted-foreground"},Ae={key:0},Ne={class:"text-sm"},Ve={class:"text-xs text-muted-foreground"},Me={key:1,class:"text-sm text-muted-foreground"},Te={class:"text-sm"},Pe={key:0,class:"max-w-xs"},We={class:"text-sm text-blue-800 dark:text-blue-200 truncate"},qe={key:1,class:"text-sm text-muted-foreground"},Le={class:"space-y-6"},Re={class:"bg-orange-50 border border-orange-200 rounded-lg p-4"},Fe={class:"flex items-center gap-2 mb-3"},Ue={class:"grid grid-cols-2 gap-3 text-sm"},Oe={class:"flex justify-between"},Be={class:"font-medium text-orange-900"},De={class:"flex justify-between"},ze={class:"font-medium text-orange-900"},He={class:"flex justify-between"},Je={class:"font-medium text-orange-900"},Ke={class:"flex justify-between"},Xe={class:"font-medium text-red-700"},Ge={class:"space-y-4"},Ie={class:"space-y-3"},Qe={class:"flex items-center space-x-3"},Ye={class:"flex items-center gap-2"},Ze={class:"text-sm text-muted-foreground ml-1"},es={class:"flex items-center space-x-3"},ss={class:"flex items-center gap-2"},ts={class:"text-sm text-muted-foreground ml-1"},as={class:"space-y-6"},os={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ns={class:"flex items-center gap-2 mb-3"},ls={class:"grid grid-cols-2 gap-3 text-sm"},is={class:"flex justify-between"},rs={class:"font-medium text-blue-900"},ds={class:"flex justify-between"},us={class:"font-medium text-blue-900"},cs={class:"flex justify-between"},ms={class:"font-medium text-blue-900"},fs={class:"flex justify-between"},ps={class:"font-medium text-red-700"},_s={class:"space-y-4"},vs={class:"space-y-3"},gs={class:"flex items-center space-x-3"},xs={class:"flex items-center gap-2"},bs={class:"text-sm text-muted-foreground ml-1"},hs={class:"flex items-center space-x-3"},ys={class:"flex items-center gap-2"},ws={class:"text-sm text-muted-foreground ml-1"},tt=K({__name:"Index",props:{candidaturas:{},filters:{},filterFieldsConfig:{}},setup(W){const g=W,M=[{title:"Admin",href:"/admin/dashboard"},{title:"Candidaturas",href:"#"}],d=_({estado:g.filters.estado||"null",search:g.filters.search||""});fe(d,r=>{const e=Object.entries(r).reduce((n,[te,q])=>(n[te]=q==="null"?"":q,n),{});I.get("/admin/candidaturas",e,{preserveState:!0,replace:!0})},{deep:!0});const T={fields:g.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por nombre o email...",quickSearchFields:["user.name","user.email"],maxNestingLevel:2,allowSaveFilters:!0,debounceTime:500,autoApply:!1},{route:f}=window,x=_(!1),y=_(!1),w=_(!0),C=_(!0),c=_({total_borradores:0,con_email:0,con_telefono:0,sin_email:0,sin_telefono:0}),$=_(!1),k=_(!1),E=_(!0),S=_(!0),m=_({total_pendientes:0,con_email:0,con_telefono:0,sin_email:0,sin_telefono:0}),Q=r=>new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Y=async()=>{try{const e=await(await fetch(f("admin.candidaturas.estadisticas-borradores"))).json();c.value=e,x.value=!0}catch(r){console.error("Error cargando estadísticas:",r),alert("Error cargando estadísticas de candidaturas en borrador")}},Z=async()=>{try{const e=await(await fetch(f("admin.candidaturas.estadisticas-pendientes"))).json();m.value=e,$.value=!0}catch(r){console.error("Error cargando estadísticas:",r),alert("Error cargando estadísticas de candidaturas pendientes")}},ee=async()=>{var r;if(!E.value&&!S.value){alert("Debes seleccionar al menos un tipo de notificación (email o WhatsApp)");return}k.value=!0;try{const n=await(await fetch(f("admin.candidaturas.enviar-notificaciones"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({incluir_email:E.value,incluir_whatsapp:S.value})})).json();n.success?($.value=!1,alert(`Notificaciones enviadas exitosamente!

• Candidaturas procesadas: ${n.contadores.total_candidaturas}
• Correos programados: ${n.contadores.emails_enviados}
• WhatsApps programados: ${n.contadores.whatsapps_enviados}
• Errores: ${n.contadores.errores}

Los mensajes se están enviando en segundo plano respetando los límites de velocidad configurados.`)):alert(`Error: ${n.message}`)}catch(e){console.error("Error enviando notificaciones:",e),alert("Error enviando notificaciones. Por favor intenta de nuevo.")}finally{k.value=!1}},se=async()=>{var r;if(!w.value&&!C.value){alert("Debes seleccionar al menos un tipo de recordatorio (email o WhatsApp)");return}y.value=!0;try{const n=await(await fetch(f("admin.candidaturas.enviar-recordatorios"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({incluir_email:w.value,incluir_whatsapp:C.value})})).json();n.success?(x.value=!1,alert(`Recordatorios enviados exitosamente!

• Candidaturas procesadas: ${n.contadores.total_candidaturas}
• Correos programados: ${n.contadores.emails_enviados}
• WhatsApps programados: ${n.contadores.whatsapps_enviados}
• Errores: ${n.contadores.errores}

Los mensajes se están enviando en segundo plano respetando los límites de velocidad configurados.`)):alert(`Error: ${n.message}`)}catch(e){console.error("Error enviando recordatorios:",e),alert("Error enviando recordatorios. Por favor intenta de nuevo.")}finally{y.value=!1}};return(r,e)=>(u(),p(V,null,[t(a(pe),{title:"Candidaturas"}),t(ce,{breadcrumbs:M},{default:o(()=>[s("div",we,[s("div",Ce,[e[11]||(e[11]=s("div",null,[s("h1",{class:"text-3xl font-bold"},"Candidaturas"),s("p",{class:"text-muted-foreground"}," Revisa y gestiona los perfiles de candidatura de los usuarios ")],-1)),s("div",$e,[t(a(v),{onClick:Z,variant:"outline",class:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100 hover:border-blue-300"},{default:o(()=>[t(a(j),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=l(" Notificaciones "))]),_:1}),t(a(v),{onClick:Y,variant:"outline",class:"bg-orange-50 border-orange-200 text-orange-700 hover:bg-orange-100 hover:border-orange-300"},{default:o(()=>[t(a(P),{class:"mr-2 h-4 w-4"}),e[9]||(e[9]=l(" Recordatorios "))]),_:1}),t(a(F),{href:"/admin/candidaturas/configuracion"},{default:o(()=>[t(a(v),null,{default:o(()=>[t(a(de),{class:"mr-2 h-4 w-4"}),e[10]||(e[10]=l(" Configuración "))]),_:1})]),_:1})])]),t(ve,{config:T,route:a(f)("admin.candidaturas.index"),"initial-filters":{quickSearch:d.value.search,rootGroup:d.value.advanced_filters?JSON.parse(d.value.advanced_filters):void 0}},null,8,["route","initial-filters"]),t(a(oe),null,{default:o(()=>[t(a(ne),{class:"pt-6"},{default:o(()=>[r.candidaturas.data.length===0?(u(),p("div",ke,[t(a(ue),{class:"mx-auto h-12 w-12 text-muted-foreground"}),e[12]||(e[12]=s("h3",{class:"mt-4 text-lg font-medium"},"No hay candidaturas",-1)),e[13]||(e[13]=s("p",{class:"text-muted-foreground"},"No se encontraron candidaturas con los filtros aplicados.",-1))])):(u(),p("div",Ee,[t(a(le),null,{default:o(()=>[t(a(ie),null,{default:o(()=>[t(a(R),null,{default:o(()=>[t(a(b),null,{default:o(()=>e[14]||(e[14]=[l("Usuario")])),_:1}),t(a(b),null,{default:o(()=>e[15]||(e[15]=[l("Estado")])),_:1}),t(a(b),null,{default:o(()=>e[16]||(e[16]=[l("Datos Completados")])),_:1}),t(a(b),null,{default:o(()=>e[17]||(e[17]=[l("Actualizado")])),_:1}),t(a(b),null,{default:o(()=>e[18]||(e[18]=[l("Comentarios")])),_:1}),t(a(b),{class:"text-right"},{default:o(()=>e[19]||(e[19]=[l("Acciones")])),_:1})]),_:1})]),_:1}),t(a(re),null,{default:o(()=>[(u(!0),p(V,null,X(r.candidaturas.data,n=>(u(),G(a(R),{key:n.id},{default:o(()=>[t(a(h),null,{default:o(()=>[s("div",null,[s("p",Se,i(n.usuario.name),1),s("p",je,i(n.usuario.email),1)])]),_:2},1024),t(a(h),null,{default:o(()=>[t(a(ae),{class:_e(n.estado_color)},{default:o(()=>[l(i(n.estado_label),1)]),_:2},1032,["class"])]),_:2},1024),t(a(h),null,{default:o(()=>[n.total_campos>0?(u(),p("div",Ae,[s("p",Ne,i(n.campos_llenados)+" / "+i(n.total_campos),1),s("p",Ve," ("+i(n.porcentaje_completado)+"%) ",1)])):(u(),p("span",Me,"Sin configuración"))]),_:2},1024),t(a(h),null,{default:o(()=>[s("p",Te,i(Q(n.updated_at)),1)]),_:2},1024),t(a(h),null,{default:o(()=>[n.comentarios_admin?(u(),p("div",Pe,[s("p",We,i(n.comentarios_admin),1)])):(u(),p("span",qe,"-"))]),_:2},1024),t(a(h),{class:"text-right"},{default:o(()=>[t(a(F),{href:`/admin/candidaturas/${n.id}`},{default:o(()=>[t(a(v),{variant:"outline",size:"sm"},{default:o(()=>[t(a(ge),{class:"mr-2 h-4 w-4"}),e[20]||(e[20]=l(" Ver candidatura "))]),_:1})]),_:2},1032,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])),t(ye,{links:r.candidaturas.links},null,8,["links"])]),_:1})]),_:1}),t(a(U),{open:x.value,"onUpdate:open":e[3]||(e[3]=n=>x.value=n)},{default:o(()=>[t(a(O),{class:"sm:max-w-md"},{default:o(()=>[t(a(B),null,{default:o(()=>[t(a(D),{class:"flex items-center gap-2"},{default:o(()=>[t(a(P),{class:"h-5 w-5 text-orange-600"}),e[21]||(e[21]=l(" Enviar Recordatorios Masivos "))]),_:1}),t(a(z),null,{default:o(()=>e[22]||(e[22]=[l(" Envía recordatorios por correo y/o WhatsApp a todas las candidaturas en estado borrador. ")])),_:1})]),_:1}),s("div",Le,[s("div",Re,[s("div",Fe,[t(a(L),{class:"h-5 w-5 text-orange-600"}),e[23]||(e[23]=s("h3",{class:"font-medium text-orange-900"},"Candidaturas en Borrador",-1))]),s("div",Ue,[s("div",Oe,[e[24]||(e[24]=s("span",{class:"text-orange-700"},"Total en borrador:",-1)),s("span",Be,i(c.value.total_borradores),1)]),s("div",De,[e[25]||(e[25]=s("span",{class:"text-orange-700"},"Con email:",-1)),s("span",ze,i(c.value.con_email),1)]),s("div",He,[e[26]||(e[26]=s("span",{class:"text-orange-700"},"Con teléfono:",-1)),s("span",Je,i(c.value.con_telefono),1)]),s("div",Ke,[e[27]||(e[27]=s("span",{class:"text-red-600"},"Sin contacto:",-1)),s("span",Xe,i(Math.max(0,c.value.total_borradores-Math.max(c.value.con_email,c.value.con_telefono))),1)])])]),s("div",Ge,[e[30]||(e[30]=s("h4",{class:"font-medium text-gray-900"},"Selecciona los tipos de recordatorio:",-1)),s("div",Ie,[s("div",Qe,[t(a(N),{id:"include-email",modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=n=>w.value=n),disabled:c.value.con_email===0},null,8,["modelValue","disabled"]),s("div",Ye,[t(a(j),{class:"h-4 w-4 text-blue-600"}),t(a(A),{for:"include-email",class:"flex-1"},{default:o(()=>[e[28]||(e[28]=l(" Correo electrónico ")),s("span",Ze," ("+i(c.value.con_email)+" candidaturas) ",1)]),_:1})])]),s("div",es,[t(a(N),{id:"include-whatsapp",modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=n=>C.value=n),disabled:c.value.con_telefono===0},null,8,["modelValue","disabled"]),s("div",ss,[t(a(J),{class:"h-4 w-4 text-green-600"}),t(a(A),{for:"include-whatsapp",class:"flex-1"},{default:o(()=>[e[29]||(e[29]=l(" WhatsApp ")),s("span",ts," ("+i(c.value.con_telefono)+" candidaturas) ",1)]),_:1})])])])]),e[31]||(e[31]=s("div",{class:"text-xs text-muted-foreground bg-gray-50 border border-gray-200 rounded p-3"},[s("p",{class:"mb-1"},"• Los mensajes se envían respetando los límites de velocidad configurados"),s("p",{class:"mb-1"},"• Emails: 2 por segundo | WhatsApp: 5 por segundo"),s("p",null,"• El proceso se ejecuta en segundo plano")],-1))]),t(a(H),null,{default:o(()=>[t(a(v),{variant:"outline",onClick:e[2]||(e[2]=n=>x.value=!1),disabled:y.value},{default:o(()=>e[32]||(e[32]=[l(" Cancelar ")])),_:1},8,["disabled"]),t(a(v),{onClick:se,disabled:y.value||c.value.total_borradores===0||!w.value&&!C.value,class:"bg-orange-600 hover:bg-orange-700"},{default:o(()=>[t(a(P),{class:"mr-2 h-4 w-4"}),l(" "+i(y.value?"Enviando...":`Enviar Recordatorios (${c.value.total_borradores})`),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(a(U),{open:$.value,"onUpdate:open":e[7]||(e[7]=n=>$.value=n)},{default:o(()=>[t(a(O),{class:"sm:max-w-md"},{default:o(()=>[t(a(B),null,{default:o(()=>[t(a(D),{class:"flex items-center gap-2"},{default:o(()=>[t(a(j),{class:"h-5 w-5 text-blue-600"}),e[33]||(e[33]=l(" Enviar Notificaciones de Estado "))]),_:1}),t(a(z),null,{default:o(()=>e[34]||(e[34]=[l(" Envía notificaciones por correo y/o WhatsApp a todas las candidaturas en estado pendiente de revisión. ")])),_:1})]),_:1}),s("div",as,[s("div",os,[s("div",ns,[t(a(L),{class:"h-5 w-5 text-blue-600"}),e[35]||(e[35]=s("h3",{class:"font-medium text-blue-900"},"Candidaturas Pendientes de Revisión",-1))]),s("div",ls,[s("div",is,[e[36]||(e[36]=s("span",{class:"text-blue-700"},"Total pendientes:",-1)),s("span",rs,i(m.value.total_pendientes),1)]),s("div",ds,[e[37]||(e[37]=s("span",{class:"text-blue-700"},"Con email:",-1)),s("span",us,i(m.value.con_email),1)]),s("div",cs,[e[38]||(e[38]=s("span",{class:"text-blue-700"},"Con teléfono:",-1)),s("span",ms,i(m.value.con_telefono),1)]),s("div",fs,[e[39]||(e[39]=s("span",{class:"text-red-600"},"Sin contacto:",-1)),s("span",ps,i(Math.max(0,m.value.total_pendientes-Math.max(m.value.con_email,m.value.con_telefono))),1)])])]),s("div",_s,[e[42]||(e[42]=s("h4",{class:"font-medium text-gray-900"},"Selecciona los tipos de notificación:",-1)),s("div",vs,[s("div",gs,[t(a(N),{id:"include-email-notif",modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=n=>E.value=n),disabled:m.value.con_email===0},null,8,["modelValue","disabled"]),s("div",xs,[t(a(j),{class:"h-4 w-4 text-blue-600"}),t(a(A),{for:"include-email-notif",class:"flex-1"},{default:o(()=>[e[40]||(e[40]=l(" Correo electrónico ")),s("span",bs," ("+i(m.value.con_email)+" candidaturas) ",1)]),_:1})])]),s("div",hs,[t(a(N),{id:"include-whatsapp-notif",modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=n=>S.value=n),disabled:m.value.con_telefono===0},null,8,["modelValue","disabled"]),s("div",ys,[t(a(J),{class:"h-4 w-4 text-green-600"}),t(a(A),{for:"include-whatsapp-notif",class:"flex-1"},{default:o(()=>[e[41]||(e[41]=l(" WhatsApp ")),s("span",ws," ("+i(m.value.con_telefono)+" candidaturas) ",1)]),_:1})])])])]),e[43]||(e[43]=s("div",{class:"text-xs text-muted-foreground bg-gray-50 border border-gray-200 rounded p-3"},[s("p",{class:"mb-1"},"• Se notificará que la candidatura fue recibida exitosamente"),s("p",{class:"mb-1"},"• Emails: 2 por segundo | WhatsApp: 5 por segundo"),s("p",null,"• El proceso se ejecuta en segundo plano")],-1))]),t(a(H),null,{default:o(()=>[t(a(v),{variant:"outline",onClick:e[6]||(e[6]=n=>$.value=!1),disabled:k.value},{default:o(()=>e[44]||(e[44]=[l(" Cancelar ")])),_:1},8,["disabled"]),t(a(v),{onClick:ee,disabled:k.value||m.value.total_pendientes===0||!E.value&&!S.value,class:"bg-blue-600 hover:bg-blue-700"},{default:o(()=>[t(a(j),{class:"mr-2 h-4 w-4"}),l(" "+i(k.value?"Enviando...":`Enviar Notificaciones (${m.value.total_pendientes})`),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{tt as default};
