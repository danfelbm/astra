import{d as Fe,u as Ie,r as y,c as W,p as ne,W as Ne,o as De,M as je,B as Be,b as P,w as r,g as i,e as t,f as e,v as Re,h as l,j as v,i as f,m as p,t as c,l as Oe,F as K,k as H,s as Q}from"./app-DvZ1-K7a.js";import{_ as Me}from"./AdminLayout.vue_vue_type_script_setup_true_lang-7LKLDY2y.js";import{_ as V,a as C,b as S,c as w}from"./CardTitle.vue_vue_type_script_setup_true_lang-B4HvUgEv.js";import{_ as $}from"./CardDescription.vue_vue_type_script_setup_true_lang-kOJuhc_C.js";import{_ as x}from"./createLucideIcon-P3NRsumo.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-CQKpRggb.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-CGy7mMpA.js";import{_ as de}from"./Textarea.vue_vue_type_script_setup_true_lang-R_FpQUTf.js";import{_ as R,a as O,b as M,c as T,d as h}from"./SelectValue.vue_vue_type_script_setup_true_lang-D6AUpC9n.js";import{_ as Te,a as Le}from"./index-CuszI2x7.js";import{_ as qe,a as Ge,b as N,c as D}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CdUL3rDV.js";import{u as Je}from"./useToast-BAHj3ESL.js";import{u as Xe}from"./useFileUpload-DUEB5bqF.js";import{u as We}from"./useAutoSave-BJmIdz_K.js";import{_ as Y}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-y-90z81r.js";import{_ as Z}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-g5h4dEw5.js";import{_ as Ke}from"./FileUploadField.vue_vue_type_script_setup_true_lang-Dxx8Qlpt.js";import{A as He}from"./arrow-left-DaLVLQU-.js";import{C as Qe}from"./clock-Dgxe2pZn.js";import{C as Ye}from"./circle-check-big-Dsstb7RP.js";import{C as ue}from"./circle-alert-D6RXuwKp.js";import{X as ee}from"./x-BIRThpJP.js";import{U as pe}from"./user-plus-CwKoZvdX.js";import{U as me}from"./users-CokXAxsN.js";import{T as Ze}from"./trash-2-Cp_zTu-L.js";import{S as eo}from"./save-Dt5wmZkP.js";import"./useFlashMessages-CHF7AIXb.js";import"./index-03IpLp0a.js";import"./floating-ui.vue-CJQ0_Vzh.js";import"./index-ChzLLOk6.js";import"./shield-BrPJakgT.js";import"./user-Dsaete2y.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-vb4LIVAP.js";import"./chevron-right-DqS2t5k7.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BNj1aFxp.js";import"./VisuallyHidden-ajYbfbqW.js";import"./index-CoQK2WTM.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-1KPysJx4.js";import"./index-Bbh0mYdX.js";import"./map-pin-DtVXWTwN.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CJO_j-h4.js";import"./chevrons-up-down-B1jhx-SJ.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-D2ytabyO.js";import"./tag-CCJoRlvB.js";import"./target-DBxOcIRA.js";import"./vote-xbSq6Rzs.js";import"./folder-open-BBkkc7EL.js";import"./send-BF9hOsdl.js";import"./file-text-BbQo20m-.js";import"./briefcase-D1pu9Psf.js";import"./calendar-alGpXrBt.js";import"./megaphone-SVYQCwxw.js";import"./user-check-DZe7M9n1.js";import"./clipboard-list-zFyqYedV.js";import"./mail-BoJ57Y88.js";import"./message-square-BGWdqt_z.js";import"./external-link-B0O5hVqR.js";import"./panel-left-DaU6_Ad8.js";import"./index-BD9cFrTB.js";import"./check-D7HNl1Oq.js";import"./index-DHRRjd_B.js";import"./RovingFocusItem-CObpPfE1.js";import"./utils-D9B2IHmG.js";import"./debounce-B952SY0z.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BO90EcIa.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-eMu0uNp3.js";import"./VisuallyHiddenInput-C6XS3QbX.js";import"./circle-u1kXC42q.js";import"./eye-B6hXSfE-.js";import"./download-8aj9iKBN.js";import"./search-Bc6iXQXx.js";import"./loader-circle-BuYOFQXj.js";import"./chevron-left-CzM7x7pJ.js";import"./upload-iGeE8jq4.js";import"./file-BGwHuq4P.js";const oo={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ao={class:"flex items-center justify-between"},to={class:"flex items-center gap-4"},ro={class:"flex items-center gap-2 text-sm text-muted-foreground"},so={key:3},lo={key:4},io={key:5},no={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-blue-600 rounded-full"},uo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},po={key:0,class:"text-red-500 text-sm mt-1"},mo={key:0,class:"text-red-500 text-sm mt-1"},co={key:0,class:"text-red-500 text-sm mt-1"},fo={class:"pt-4 border-t"},_o={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},vo={key:0,class:"text-red-500 text-sm mt-1"},bo={key:0,class:"text-red-500 text-sm mt-1"},go={key:0,class:"text-red-500 text-sm mt-1"},ho={key:0,class:"text-red-500 text-sm mt-1"},yo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},xo={key:0,class:"text-red-500 text-sm mt-1"},Vo={key:0,class:"text-red-500 text-sm mt-1"},Co={class:"pt-4 border-t"},So={class:"space-y-6"},wo={class:"space-y-4"},$o={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between mb-2"},Uo={class:"font-medium"},ko={class:"text-sm text-muted-foreground"},Eo={class:"space-y-4"},Po={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},Ao={class:"font-medium"},zo={class:"text-sm text-muted-foreground"},Fo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},Io={class:"space-y-4"},No={key:0,class:"space-y-2"},Do={class:"flex items-center justify-between"},jo={class:"font-medium"},Bo={class:"text-sm text-muted-foreground"},Ro={class:"flex items-center gap-2 mt-1"},Oo={class:"text-xs bg-primary/10 text-primary px-2 py-1 rounded"},Mo={key:0,class:"text-xs text-muted-foreground"},To={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},Lo={key:0,class:"text-red-500 text-sm mt-1"},qo={class:"pt-4 border-t"},Go={class:"flex justify-between items-center gap-4"},Jo={key:1},Xo={class:"flex gap-4"},_t=Fe({__name:"Create",props:{proyecto:{},proyectos:{},camposPersonalizados:{},responsable:{default:null},contraparte:{default:null},borrador:{default:void 0}},setup(j){var le;const m=j,g=Je(),{uploadFiles:ce}=Xe(),fe=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:"Crear Contrato",href:"/admin/contratos/create"}],a=Ie({proyecto_id:((le=m.proyecto)==null?void 0:le.id)||"",nombre:"",descripcion:"",fecha_inicio:"",fecha_fin:"",estado:"borrador",tipo:"servicio",monto_total:"",moneda:"USD",responsable_id:"none",contraparte_user_id:null,contraparte_nombre:"",contraparte_identificacion:"",contraparte_email:"",contraparte_telefono:"",participantes:[],archivo_pdf:null,archivos_paths:[],archivos_nombres:[],tipos_archivos:{},observaciones:"",campos_personalizados:{}}),_e=y(""),A=y([]),L=y("informacion"),z=y([]),q=y(!1),G=y(!1),J=y(!1),{route:E}=window,F=y(m.contraparte||null),U=y(m.responsable||null),ve=W(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"testigo",label:"Testigo"},{value:"revisor",label:"Revisor"},{value:"aprobador",label:"Aprobador"},{value:"observador",label:"Observador"}],value:"testigo",required:!0},{name:"notas",label:"Notas (opcional)",type:"text",value:"",required:!1}]),be=W(()=>{const n=a.participantes.map(o=>o.user_id);return a.contraparte_user_id&&n.push(a.contraparte_user_id),n}),ge=W(()=>a.data()),{state:he,isSaving:oe,hasSaved:ae,hasError:B,startWatching:ye,stopAutoSave:te,restoreDraft:xe,clearLocalStorage:re}=We(ge,{url:"/admin/contratos/autosave",resourceIdField:"contrato_id",debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:"contrato_draft_create"}),Ve=[{value:"USD",label:"USD - Dólar Estadounidense"},{value:"EUR",label:"EUR - Euro"},{value:"MXN",label:"MXN - Peso Mexicano"},{value:"COP",label:"COP - Peso Colombiano"},{value:"ARS",label:"ARS - Peso Argentino"},{value:"CLP",label:"CLP - Peso Chileno"},{value:"PEN",label:"PEN - Sol Peruano"}],Ce=n=>{const o=n.target;o.files&&o.files[0]&&(a.archivo_pdf=o.files[0],_e.value=o.files[0].name)},Se=async n=>{try{const o=await ce(n,{module:"contratos",fieldId:"archivos",folder:"contratos",maxSize:10485760}),d=o.map(_=>_.path),s=o.map(_=>_.name),u={};o.forEach(_=>{u[_.path]=_.mime_type}),a.archivos_paths=[...a.archivos_paths,...d],a.archivos_nombres=[...a.archivos_nombres,...s],a.tipos_archivos={...a.tipos_archivos,...u},A.value=[...A.value,...o],g.success(`${o.length} archivo(s) subido(s) exitosamente`)}catch(o){g.error(o.message||"Error al subir archivos")}},we=()=>{const n=[];return a.proyecto_id||n.push("Debe seleccionar un proyecto"),a.nombre.trim()||n.push("El nombre del contrato es obligatorio"),a.fecha_inicio||n.push("La fecha de inicio es obligatoria"),a.fecha_fin&&a.fecha_fin<a.fecha_inicio&&n.push("La fecha de fin debe ser posterior a la fecha de inicio"),m.camposPersonalizados.forEach(o=>{o.es_requerido&&!a.campos_personalizados[o.id]&&n.push(`El campo "${o.nombre}" es obligatorio`)}),n},$e=n=>{if(n.userIds.length>0&&(a.contraparte_user_id=n.userIds[0],n.users&&n.users.length>0)){const o=n.users[0];a.contraparte_nombre=o.name,a.contraparte_email=o.email||"",F.value=o}},Ue=n=>{n.userIds.length>0&&(a.responsable_id=n.userIds[0],n.users&&n.users.length>0&&(U.value=n.users[0]))},ke=n=>{n.userIds.forEach((o,d)=>{a.participantes.some(u=>u.user_id===o)||(a.participantes.push({user_id:o,rol:n.extraData.rol||"testigo",notas:n.extraData.notas||""}),n.users&&n.users[d]&&X.value.set(o,n.users[d]))})},Ee=n=>{const o=a.participantes.findIndex(d=>d.user_id===n);o>-1&&a.participantes.splice(o,1)},X=y(new Map),se=n=>X.value.get(n),Pe=()=>{const n=we();if(n.length>0){n.forEach(d=>g.error(d));return}const o=new FormData;Object.keys(a.data()).forEach(d=>{d==="campos_personalizados"?Object.keys(a.campos_personalizados).forEach(s=>{const u=a.campos_personalizados[s];u!=null&&u!==""&&o.append(`campos_personalizados[${s}]`,u)}):d==="participantes"?a.participantes.forEach((s,u)=>{o.append(`participantes[${u}][user_id]`,s.user_id.toString()),o.append(`participantes[${u}][rol]`,s.rol),s.notas&&o.append(`participantes[${u}][notas]`,s.notas)}):d==="archivos_paths"||d==="archivos_nombres"||d==="tipos_archivos"?d==="archivos_paths"&&Array.isArray(a.archivos_paths)&&a.archivos_paths.length>0?o.append("archivos_paths",JSON.stringify(a.archivos_paths)):d==="archivos_nombres"&&Array.isArray(a.archivos_nombres)&&a.archivos_nombres.length>0?o.append("archivos_nombres",JSON.stringify(a.archivos_nombres)):d==="tipos_archivos"&&a.tipos_archivos&&Object.keys(a.tipos_archivos).length>0&&o.append("tipos_archivos",JSON.stringify(a.tipos_archivos)):d==="archivo_pdf"&&a.archivo_pdf?o.append("archivo_pdf",a.archivo_pdf):d==="responsable_id"&&a[d]==="none"||a[d]!==null&&a[d]!==""&&o.append(d,a[d])}),Q.post(E("admin.contratos.store"),o,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{te(),re(),g.success("Contrato creado exitosamente")},onError:d=>{typeof d=="object"&&d!==null?Object.values(d).forEach(s=>{Array.isArray(s)?s.forEach(u=>g.error(String(u))):typeof s=="string"?g.error(s):g.error("Error al crear el contrato")}):g.error("Error al crear el contrato")}})},Ae=()=>{confirm("¿Está seguro de cancelar? Los cambios no guardados se perderán.")&&Q.get(E("admin.contratos.index"))},ze=()=>{confirm("¿Está seguro de descartar el borrador? Esta acción no se puede deshacer.")&&Q.delete(E("admin.contratos.borrador"),{preserveScroll:!1,onFinish:()=>{re()}})};return ne(L,n=>{n==="archivos"&&z.value.length>0&&Ne(()=>{A.value=z.value,z.value=[]})}),ne(A,n=>{a.archivos_paths=n.map(d=>d.path).filter(Boolean),a.archivos_nombres=n.map(d=>d.name).filter(Boolean);const o={};n.forEach(d=>{d.path&&d.mime_type&&(o[d.path]=d.mime_type)}),a.tipos_archivos=o},{deep:!0}),De(()=>{var o,d,s;const n=je();if((o=n.props.flash)!=null&&o.success&&g.success(n.props.flash.success),(d=n.props.flash)!=null&&d.error&&g.error(n.props.flash.error),m.borrador){if(a.proyecto_id=((s=m.borrador.proyecto_id)==null?void 0:s.toString())||"",a.nombre=m.borrador.nombre||"",a.descripcion=m.borrador.descripcion||"",a.fecha_inicio=m.borrador.fecha_inicio||"",a.fecha_fin=m.borrador.fecha_fin||"",a.tipo=m.borrador.tipo||"servicio",a.monto_total=m.borrador.monto_total||"",a.moneda=m.borrador.moneda||"USD",a.responsable_id=m.borrador.responsable_id||"none",a.contraparte_user_id=m.borrador.contraparte_user_id||null,a.contraparte_nombre=m.borrador.contraparte_nombre||"",a.contraparte_identificacion=m.borrador.contraparte_identificacion||"",a.contraparte_email=m.borrador.contraparte_email||"",a.contraparte_telefono=m.borrador.contraparte_telefono||"",a.observaciones=m.borrador.observaciones||"",a.archivos_paths=m.borrador.archivos_paths||[],a.archivos_nombres=m.borrador.archivos_nombres||[],a.tipos_archivos=m.borrador.tipos_archivos||{},a.archivos_paths.length>0){const u=a.archivos_paths.map((_,I)=>({id:`borrador_${I}`,name:a.archivos_nombres[I]||_.split("/").pop()||"archivo",size:0,path:_,url:`/storage/${_}`,mime_type:a.tipos_archivos[_]||"application/octet-stream"}));z.value=u}m.borrador.participantes&&Array.isArray(m.borrador.participantes)&&(a.participantes=m.borrador.participantes.map(u=>{var _,I,ie;return{user_id:((_=u.pivot)==null?void 0:_.user_id)||u.id,rol:((I=u.pivot)==null?void 0:I.rol)||"testigo",notas:((ie=u.pivot)==null?void 0:ie.notas)||""}}),m.borrador.participantes.forEach(u=>{X.value.set(u.id,{id:u.id,name:u.name,email:u.email})})),g.success("Borrador recuperado",{description:`Borrador del servidor cargado (${a.archivos_paths.length} archivo(s), ${a.participantes.length} participante(s))`})}else{const u=xe();u&&u.data&&(Object.assign(a,u.data),g.info("Borrador recuperado",{description:"Se recuperaron tus cambios del navegador"}))}ye()}),Be(()=>{te()}),(n,o)=>(p(),P(Me,{breadcrumbs:fe},{default:r(()=>{var d;return[i("div",oo,[i("div",ao,[i("div",to,[t(e(Re),{href:e(E)("admin.contratos.index")},{default:r(()=>[t(e(x),{variant:"ghost",size:"sm"},{default:r(()=>[t(e(He),{class:"h-4 w-4 mr-2"}),o[27]||(o[27]=l(" Volver ",-1))]),_:1})]),_:1},8,["href"]),o[28]||(o[28]=i("div",null,[i("h1",{class:"text-3xl font-bold"},"Crear Contrato"),i("p",{class:"text-gray-600 mt-1"},"Complete la información para crear un nuevo contrato")],-1))]),i("div",ro,[e(oe)?(p(),P(e(Qe),{key:0,class:"h-4 w-4 animate-spin"})):e(ae)&&!e(B)?(p(),P(e(Ye),{key:1,class:"h-4 w-4 text-green-600"})):e(B)?(p(),P(e(ue),{key:2,class:"h-4 w-4 text-amber-600"})):v("",!0),e(oe)?(p(),f("span",so,"Guardando borrador...")):e(ae)&&!e(B)?(p(),f("span",lo,"Borrador guardado a las "+c((d=e(he).lastSaved)==null?void 0:d.toLocaleTimeString()),1)):e(B)?(p(),f("span",io,"Guardado localmente")):v("",!0)])]),i("form",{onSubmit:Oe(Pe,["prevent"]),class:"space-y-6"},[t(e(qe),{modelValue:L.value,"onUpdate:modelValue":o[23]||(o[23]=s=>L.value=s)},{default:r(()=>[t(e(Ge),{class:"grid w-full grid-cols-6"},{default:r(()=>[t(e(N),{value:"informacion"},{default:r(()=>[...o[29]||(o[29]=[l("Información General",-1)])]),_:1}),t(e(N),{value:"fechas"},{default:r(()=>[...o[30]||(o[30]=[l("Fechas y Estado",-1)])]),_:1}),t(e(N),{value:"financiero"},{default:r(()=>[...o[31]||(o[31]=[l("Información Financiera",-1)])]),_:1}),t(e(N),{value:"contraparte"},{default:r(()=>[...o[32]||(o[32]=[l("Participantes",-1)])]),_:1}),t(e(N),{value:"archivos"},{default:r(()=>[o[33]||(o[33]=l(" Archivos ",-1)),z.value.length>0?(p(),f("span",no,c(z.value.length),1)):v("",!0)]),_:1}),t(e(N),{value:"adicional"},{default:r(()=>[...o[34]||(o[34]=[l("Información Adicional",-1)])]),_:1})]),_:1}),t(e(D),{value:"informacion"},{default:r(()=>[t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[35]||(o[35]=[l("Información General",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[36]||(o[36]=[l("Datos principales del contrato",-1)])]),_:1})]),_:1}),t(e(w),{class:"space-y-4"},{default:r(()=>[i("div",uo,[i("div",null,[t(e(b),{for:"proyecto_id"},{default:r(()=>[...o[37]||(o[37]=[l("Proyecto *",-1)])]),_:1}),t(e(R),{modelValue:e(a).proyecto_id,"onUpdate:modelValue":o[0]||(o[0]=s=>e(a).proyecto_id=s),disabled:!!m.proyecto},{default:r(()=>[t(e(O),null,{default:r(()=>[t(e(M),{placeholder:"Seleccione un proyecto"})]),_:1}),t(e(T),null,{default:r(()=>[(p(!0),f(K,null,H(j.proyectos,s=>(p(),P(e(h),{key:s.id,value:s.id.toString()},{default:r(()=>[l(c(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),e(a).errors.proyecto_id?(p(),f("div",po,c(e(a).errors.proyecto_id),1)):v("",!0)]),i("div",null,[t(e(b),{for:"nombre"},{default:r(()=>[...o[38]||(o[38]=[l("Nombre del Contrato *",-1)])]),_:1}),t(e(k),{id:"nombre",modelValue:e(a).nombre,"onUpdate:modelValue":o[1]||(o[1]=s=>e(a).nombre=s),placeholder:"Ej: Contrato de servicios de consultoría"},null,8,["modelValue"]),e(a).errors.nombre?(p(),f("div",mo,c(e(a).errors.nombre),1)):v("",!0)])]),i("div",null,[t(e(b),{for:"descripcion"},{default:r(()=>[...o[39]||(o[39]=[l("Descripción",-1)])]),_:1}),t(e(de),{id:"descripcion",modelValue:e(a).descripcion,"onUpdate:modelValue":o[2]||(o[2]=s=>e(a).descripcion=s),placeholder:"Descripción detallada del contrato...",rows:"4"},null,8,["modelValue"]),e(a).errors.descripcion?(p(),f("div",co,c(e(a).errors.descripcion),1)):v("",!0)]),i("div",fo,[o[40]||(o[40]=i("h3",{class:"font-medium mb-4"},"Información Complementaria",-1)),t(Y,{campos:j.camposPersonalizados,modelValue:e(a).campos_personalizados,"onUpdate:modelValue":o[3]||(o[3]=s=>e(a).campos_personalizados=s),"show-card":!1,grupo:"informacion"},null,8,["campos","modelValue"])])]),_:1})]),_:1})]),_:1}),t(e(D),{value:"fechas"},{default:r(()=>[t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[41]||(o[41]=[l("Fechas y Estado",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[42]||(o[42]=[l("Configure las fechas y el estado del contrato",-1)])]),_:1})]),_:1}),t(e(w),{class:"space-y-4"},{default:r(()=>[i("div",_o,[i("div",null,[t(e(b),{for:"fecha_inicio"},{default:r(()=>[...o[43]||(o[43]=[l("Fecha de Inicio *",-1)])]),_:1}),t(e(k),{id:"fecha_inicio",type:"date",modelValue:e(a).fecha_inicio,"onUpdate:modelValue":o[4]||(o[4]=s=>e(a).fecha_inicio=s)},null,8,["modelValue"]),e(a).errors.fecha_inicio?(p(),f("div",vo,c(e(a).errors.fecha_inicio),1)):v("",!0)]),i("div",null,[t(e(b),{for:"fecha_fin"},{default:r(()=>[...o[44]||(o[44]=[l("Fecha de Fin",-1)])]),_:1}),t(e(k),{id:"fecha_fin",type:"date",modelValue:e(a).fecha_fin,"onUpdate:modelValue":o[5]||(o[5]=s=>e(a).fecha_fin=s)},null,8,["modelValue"]),e(a).errors.fecha_fin?(p(),f("div",bo,c(e(a).errors.fecha_fin),1)):v("",!0)]),i("div",null,[t(e(b),{for:"estado"},{default:r(()=>[...o[45]||(o[45]=[l("Estado",-1)])]),_:1}),t(e(R),{modelValue:e(a).estado,"onUpdate:modelValue":o[6]||(o[6]=s=>e(a).estado=s)},{default:r(()=>[t(e(O),null,{default:r(()=>[t(e(M))]),_:1}),t(e(T),null,{default:r(()=>[t(e(h),{value:"borrador"},{default:r(()=>[...o[46]||(o[46]=[l("Borrador",-1)])]),_:1}),t(e(h),{value:"activo"},{default:r(()=>[...o[47]||(o[47]=[l("Activo",-1)])]),_:1}),t(e(h),{value:"finalizado"},{default:r(()=>[...o[48]||(o[48]=[l("Finalizado",-1)])]),_:1}),t(e(h),{value:"cancelado"},{default:r(()=>[...o[49]||(o[49]=[l("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(a).errors.estado?(p(),f("div",go,c(e(a).errors.estado),1)):v("",!0)]),i("div",null,[t(e(b),{for:"tipo"},{default:r(()=>[...o[50]||(o[50]=[l("Tipo de Contrato *",-1)])]),_:1}),t(e(R),{modelValue:e(a).tipo,"onUpdate:modelValue":o[7]||(o[7]=s=>e(a).tipo=s)},{default:r(()=>[t(e(O),null,{default:r(()=>[t(e(M))]),_:1}),t(e(T),null,{default:r(()=>[t(e(h),{value:"servicio"},{default:r(()=>[...o[51]||(o[51]=[l("Servicio",-1)])]),_:1}),t(e(h),{value:"obra"},{default:r(()=>[...o[52]||(o[52]=[l("Obra",-1)])]),_:1}),t(e(h),{value:"suministro"},{default:r(()=>[...o[53]||(o[53]=[l("Suministro",-1)])]),_:1}),t(e(h),{value:"consultoria"},{default:r(()=>[...o[54]||(o[54]=[l("Consultoría",-1)])]),_:1}),t(e(h),{value:"otro"},{default:r(()=>[...o[55]||(o[55]=[l("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(a).errors.tipo?(p(),f("div",ho,c(e(a).errors.tipo),1)):v("",!0)])])]),_:1})]),_:1})]),_:1}),t(e(D),{value:"financiero"},{default:r(()=>[t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[56]||(o[56]=[l("Información Financiera",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[57]||(o[57]=[l("Montos y detalles financieros del contrato",-1)])]),_:1})]),_:1}),t(e(w),{class:"space-y-4"},{default:r(()=>[i("div",yo,[i("div",null,[t(e(b),{for:"monto_total"},{default:r(()=>[...o[58]||(o[58]=[l("Monto Total",-1)])]),_:1}),t(e(k),{id:"monto_total",type:"number",step:"0.01",modelValue:e(a).monto_total,"onUpdate:modelValue":o[8]||(o[8]=s=>e(a).monto_total=s),placeholder:"0.00"},null,8,["modelValue"]),e(a).errors.monto_total?(p(),f("div",xo,c(e(a).errors.monto_total),1)):v("",!0)]),i("div",null,[t(e(b),{for:"moneda"},{default:r(()=>[...o[59]||(o[59]=[l("Moneda",-1)])]),_:1}),t(e(R),{modelValue:e(a).moneda,"onUpdate:modelValue":o[9]||(o[9]=s=>e(a).moneda=s)},{default:r(()=>[t(e(O),null,{default:r(()=>[t(e(M))]),_:1}),t(e(T),null,{default:r(()=>[(p(),f(K,null,H(Ve,s=>t(e(h),{key:s.value,value:s.value},{default:r(()=>[l(c(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"]),e(a).errors.moneda?(p(),f("div",Vo,c(e(a).errors.moneda),1)):v("",!0)])]),i("div",Co,[o[60]||(o[60]=i("h3",{class:"font-medium mb-4"},"Campos Financieros Personalizados",-1)),t(Y,{campos:j.camposPersonalizados,modelValue:e(a).campos_personalizados,"onUpdate:modelValue":o[10]||(o[10]=s=>e(a).campos_personalizados=s),"show-card":!1,grupo:"financiero"},null,8,["campos","modelValue"])])]),_:1})]),_:1})]),_:1}),t(e(D),{value:"contraparte"},{default:r(()=>[i("div",So,[t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[61]||(o[61]=[l("Responsable del Contrato",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[62]||(o[62]=[l(" Asigna un usuario responsable de este contrato ",-1)])]),_:1})]),_:1}),t(e(w),null,{default:r(()=>[i("div",wo,[U.value?(p(),f("div",$o,[i("div",null,[i("p",Uo,c(U.value.name),1),i("p",ko,c(U.value.email),1)]),t(e(x),{type:"button",variant:"ghost",size:"sm",onClick:o[11]||(o[11]=s=>{U.value=null,e(a).responsable_id="none"})},{default:r(()=>[t(e(ee),{class:"h-4 w-4"})]),_:1})])):v("",!0),t(e(x),{type:"button",variant:"outline",onClick:o[12]||(o[12]=s=>J.value=!0),class:"w-full"},{default:r(()=>[t(e(pe),{class:"h-4 w-4 mr-2"}),l(" "+c(U.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})])]),_:1})]),_:1}),t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[63]||(o[63]=[l("Contraparte - Usuario del Sistema",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[64]||(o[64]=[l(" Seleccione un usuario del sistema como contraparte del contrato ",-1)])]),_:1})]),_:1}),t(e(w),null,{default:r(()=>[i("div",Eo,[i("div",null,[t(e(b),null,{default:r(()=>[...o[65]||(o[65]=[l("Usuario Contraparte",-1)])]),_:1}),o[66]||(o[66]=i("p",{class:"text-sm text-muted-foreground mb-2"}," Si la contraparte es un usuario registrado en el sistema, selecciónelo aquí ",-1))]),F.value?(p(),f("div",Po,[i("div",null,[i("p",Ao,c(F.value.name),1),i("p",zo,c(F.value.email),1)]),t(e(x),{type:"button",variant:"ghost",size:"sm",onClick:o[13]||(o[13]=s=>{e(a).contraparte_user_id=null,e(a).contraparte_nombre="",e(a).contraparte_email="",F.value=null})},{default:r(()=>[t(e(ee),{class:"h-4 w-4"})]),_:1})])):v("",!0),t(e(x),{type:"button",variant:"outline",onClick:o[14]||(o[14]=s=>q.value=!0),class:"w-full"},{default:r(()=>[t(e(pe),{class:"h-4 w-4 mr-2"}),l(" "+c(F.value?"Cambiar Contraparte":"Seleccionar Contraparte"),1)]),_:1})])]),_:1})]),_:1}),t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[67]||(o[67]=[l("Contraparte - Información Externa",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[68]||(o[68]=[l(" Complete estos campos si la contraparte no es un usuario del sistema ",-1)])]),_:1})]),_:1}),t(e(w),{class:"space-y-4"},{default:r(()=>[e(a).contraparte_user_id?(p(),P(e(Te),{key:0,class:"mb-4"},{default:r(()=>[t(e(ue),{class:"h-4 w-4"}),t(e(Le),null,{default:r(()=>[...o[69]||(o[69]=[l(" Los campos de contraparte externa están deshabilitados porque ya se seleccionó un usuario del sistema. ",-1)])]),_:1})]),_:1})):v("",!0),i("div",Fo,[i("div",null,[t(e(b),{for:"contraparte_nombre"},{default:r(()=>[...o[70]||(o[70]=[l("Nombre de la Contraparte",-1)])]),_:1}),t(e(k),{id:"contraparte_nombre",modelValue:e(a).contraparte_nombre,"onUpdate:modelValue":o[15]||(o[15]=s=>e(a).contraparte_nombre=s),placeholder:"Nombre de la empresa o persona",disabled:!!e(a).contraparte_user_id},null,8,["modelValue","disabled"])]),i("div",null,[t(e(b),{for:"contraparte_identificacion"},{default:r(()=>[...o[71]||(o[71]=[l("Identificación/RUC",-1)])]),_:1}),t(e(k),{id:"contraparte_identificacion",modelValue:e(a).contraparte_identificacion,"onUpdate:modelValue":o[16]||(o[16]=s=>e(a).contraparte_identificacion=s),placeholder:"Número de identificación",disabled:!!e(a).contraparte_user_id},null,8,["modelValue","disabled"])]),i("div",null,[t(e(b),{for:"contraparte_email"},{default:r(()=>[...o[72]||(o[72]=[l("Email de Contacto",-1)])]),_:1}),t(e(k),{id:"contraparte_email",type:"email",modelValue:e(a).contraparte_email,"onUpdate:modelValue":o[17]||(o[17]=s=>e(a).contraparte_email=s),placeholder:"email@ejemplo.com",disabled:!!e(a).contraparte_user_id},null,8,["modelValue","disabled"])]),i("div",null,[t(e(b),{for:"contraparte_telefono"},{default:r(()=>[...o[73]||(o[73]=[l("Teléfono de Contacto",-1)])]),_:1}),t(e(k),{id:"contraparte_telefono",modelValue:e(a).contraparte_telefono,"onUpdate:modelValue":o[18]||(o[18]=s=>e(a).contraparte_telefono=s),placeholder:"+1234567890",disabled:!!e(a).contraparte_user_id},null,8,["modelValue","disabled"])])])]),_:1})]),_:1}),t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[74]||(o[74]=[l("Participantes del Contrato",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[75]||(o[75]=[l(" Agregue usuarios del sistema que participarán en este contrato con diferentes roles ",-1)])]),_:1})]),_:1}),t(e(w),null,{default:r(()=>[i("div",Io,[t(e(x),{type:"button",variant:"outline",onClick:o[19]||(o[19]=s=>G.value=!0),class:"w-full"},{default:r(()=>[t(e(me),{class:"h-4 w-4 mr-2"}),o[76]||(o[76]=l(" Agregar Participantes ",-1))]),_:1}),e(a).participantes.length>0?(p(),f("div",No,[o[77]||(o[77]=i("p",{class:"text-sm font-medium text-muted-foreground"},"Participantes agregados:",-1)),(p(!0),f(K,null,H(e(a).participantes,s=>{var u,_;return p(),f("div",{key:s.user_id,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[i("div",Do,[i("div",null,[i("p",jo,c((u=se(s.user_id))==null?void 0:u.name),1),i("p",Bo,c((_=se(s.user_id))==null?void 0:_.email),1),i("div",Ro,[i("span",Oo,c(s.rol),1),s.notas?(p(),f("span",Mo,c(s.notas),1)):v("",!0)])]),t(e(x),{type:"button",variant:"ghost",size:"sm",onClick:I=>Ee(s.user_id)},{default:r(()=>[t(e(ee),{class:"h-4 w-4"})]),_:1},8,["onClick"])])])}),128))])):(p(),f("div",To,[t(e(me),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),o[78]||(o[78]=i("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))]))])]),_:1})]),_:1})])]),_:1}),t(e(D),{value:"archivos"},{default:r(()=>[t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[79]||(o[79]=[l("Archivos del Contrato",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[80]||(o[80]=[l("Sube múltiples archivos relacionados con el contrato (máximo 10)",-1)])]),_:1})]),_:1}),t(e(w),null,{default:r(()=>[t(Ke,{modelValue:A.value,"onUpdate:modelValue":o[20]||(o[20]=s=>A.value=s),label:"Archivos",description:"Sube archivos del contrato (PDF, imágenes, documentos)",onFilesSelected:Se,multiple:!0,maxFiles:10,maxFileSize:10,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.xls,.xlsx",autoUpload:!1,module:"contratos",fieldId:"archivos"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(e(D),{value:"adicional"},{default:r(()=>[t(e(V),null,{default:r(()=>[t(e(C),null,{default:r(()=>[t(e(S),null,{default:r(()=>[...o[81]||(o[81]=[l("Información Adicional",-1)])]),_:1}),t(e($),null,{default:r(()=>[...o[82]||(o[82]=[l("Observaciones y campos personalizados",-1)])]),_:1})]),_:1}),t(e(w),{class:"space-y-4"},{default:r(()=>[i("div",null,[t(e(b),{for:"observaciones"},{default:r(()=>[...o[83]||(o[83]=[l("Observaciones",-1)])]),_:1}),t(e(de),{id:"observaciones",modelValue:e(a).observaciones,"onUpdate:modelValue":o[21]||(o[21]=s=>e(a).observaciones=s),placeholder:"Notas u observaciones adicionales...",rows:"4"},null,8,["modelValue"]),e(a).errors.observaciones?(p(),f("div",Lo,c(e(a).errors.observaciones),1)):v("",!0)]),i("div",qo,[o[84]||(o[84]=i("h3",{class:"font-medium mb-4"},"Campos Personalizados",-1)),t(Y,{campos:j.camposPersonalizados,modelValue:e(a).campos_personalizados,"onUpdate:modelValue":o[22]||(o[22]=s=>e(a).campos_personalizados=s),"show-card":!1,grupo:"otros"},null,8,["campos","modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",Go,[m.borrador?(p(),P(e(x),{key:0,variant:"destructive",type:"button",onClick:ze,disabled:e(a).processing},{default:r(()=>[t(e(Ze),{class:"h-4 w-4 mr-2"}),o[85]||(o[85]=l(" Descartar Borrador ",-1))]),_:1},8,["disabled"])):(p(),f("div",Jo)),i("div",Xo,[t(e(x),{type:"button",variant:"outline",onClick:Ae,disabled:e(a).processing},{default:r(()=>[...o[86]||(o[86]=[l(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(e(x),{type:"submit",disabled:e(a).processing},{default:r(()=>[t(e(eo),{class:"h-4 w-4 mr-2"}),l(" "+c(e(a).processing?"Guardando...":"Guardar Contrato"),1)]),_:1},8,["disabled"])])])],32)]),i("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:Ce,class:"hidden"},null,544),t(Z,{modelValue:q.value,"onUpdate:modelValue":o[24]||(o[24]=s=>q.value=s),title:"Seleccionar Contraparte",description:"Selecciona el usuario que será la contraparte del contrato","search-endpoint":e(E)("admin.proyectos.search-users"),"excluded-ids":e(a).contraparte_user_id?[e(a).contraparte_user_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Contraparte","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:$e},null,8,["modelValue","search-endpoint","excluded-ids"]),t(Z,{modelValue:G.value,"onUpdate:modelValue":o[25]||(o[25]=s=>G.value=s),title:"Agregar Participantes",description:"Selecciona los usuarios que participarán en este contrato y define su rol","search-endpoint":e(E)("admin.proyectos.search-users"),"excluded-ids":be.value,"extra-fields":ve.value,"submit-button-text":"Agregar Participantes","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:ke},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"]),t(Z,{modelValue:J.value,"onUpdate:modelValue":o[26]||(o[26]=s=>J.value=s),title:"Seleccionar Responsable",description:"Selecciona el usuario que será responsable de este contrato","search-endpoint":e(E)("admin.proyectos.search-users"),"excluded-ids":U.value?[U.value.id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:Ue},null,8,["modelValue","search-endpoint","excluded-ids"])]}),_:1}))}});export{_t as default};
