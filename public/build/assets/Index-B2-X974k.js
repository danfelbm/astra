import{_ as ze}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CiEBtCld.js";import{d as ae,r as S,c as re,D as Ce,i as m,e as r,g as o,j as y,f as t,s as Ee,l as ge,u as e,n as I,b as h,h as n,t as v,w as a,F as U,k as M,o as Ve,a as _e,m as Ue,C as ye,p as je,W as ne}from"./app-BxMQdeji.js";import{_ as B,a as Y,b as Z,c as L}from"./CardTitle.vue_vue_type_script_setup_true_lang-BnCOEwdG.js";import{_ as C}from"./createLucideIcon-C-UWYrfi.js";import{_ as H}from"./Input.vue_vue_type_script_setup_true_lang-BlmtfhYq.js";import{_ as X}from"./Label.vue_vue_type_script_setup_true_lang-Cv61jd0z.js";import{_ as R}from"./index-BV26-s10.js";import{_ as Pe,a as Le,b as te,c as Q,d as Ae,e as T}from"./TableHeader.vue_vue_type_script_setup_true_lang-CXfuZCdx.js";import{C as De,_ as de,a as ue,b as me,c as ce,d as pe}from"./SelectValue.vue_vue_type_script_setup_true_lang-C_cC4TmA.js";import{t as D}from"./index-uuqfgDZR.js";import{_ as He,a as Be,b as Me,c as Re,d as Oe,e as he}from"./index-DlUGQz7I.js";import{_ as Fe,a as Ge,b as We}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-B3HbiEjo.js";import{C as ie}from"./chevron-right-Fu6i2V5H.js";import{C as Se}from"./check-Df8aIUSG.js";import{C as Xe}from"./chevrons-up-down-3z313Cuu.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as Je}from"./pen-BSjBVchq.js";import{T as be}from"./trash-2-CWeupkIm.js";import{u as Ke}from"./useEtiquetaHierarchy-1S6ZSgLQ.js";import{S as Qe}from"./search-BH_bEnIt.js";import{L as Ye}from"./loader-circle-DBrkq7WX.js";import{_ as Ze,a as et,b as xe,c as ke}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-w_SIyey3.js";import{P as fe}from"./plus-Blz5-OLA.js";import{S as se}from"./save-C6yQR3lp.js";import{X as oe}from"./x-CtZ-Yk1L.js";import{L as tt}from"./list-CosSxq9a.js";import{T as at}from"./tree-pine-B2fbiBM2.js";import{T as ve}from"./tag-DPKMgGKR.js";import{S as we}from"./square-pen-CzbKDqjO.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-HaYR--Vk.js";import"./index-DyBffbvj.js";import"./floating-ui.vue-8MwpQwna.js";import"./index-CniBkxSN.js";import"./shield-BWgGyosQ.js";import"./user-y-oKgZ0r.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CwQxj27i.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-XGwxgqGh.js";import"./VisuallyHidden-BU7kxpuH.js";import"./index-gViH2lvq.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Rc0j_Ts0.js";import"./circle-alert----6uGyB.js";import"./map-pin-BSO3mLrr.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-vmsnnBVQ.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-D23-rq2T.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CtZNhcn0.js";import"./users-CvN1Zex9.js";import"./target-DGdssVnK.js";import"./vote-BLA5af_M.js";import"./folder-open-B7m9IzBm.js";import"./send-oS9jU0xl.js";import"./file-text-BnGFyr0l.js";import"./briefcase-WEKIfwBg.js";import"./calendar-DgdSvpAx.js";import"./megaphone-4hd08Cg7.js";import"./user-check-B_HPyobX.js";import"./mail-DqZLMO2Y.js";import"./message-square-DEtIPXL4.js";import"./external-link-B-I99Qkx.js";import"./panel-left-CpkWwX9C.js";import"./index-De6-LhcB.js";import"./nullish-CHIgUVhi.js";import"./useKbd-kRIii9yh.js";import"./utils-CDNySjiA.js";import"./VisuallyHiddenInput-DFI-nItV.js";import"./RovingFocusItem-CUafydao.js";const lt={class:"flex items-center w-full"},st={key:1,class:"w-5"},ot={class:"flex-1 min-w-0"},rt={class:"truncate"},it={key:0,class:"text-xs text-muted-foreground ml-1"},nt={key:0,class:"text-xs text-muted-foreground ml-1"},dt=ae({__name:"EtiquetaTreeItem",props:{etiqueta:{},nivel:{default:0},selectedId:{},excludedId:{},showCategoria:{type:Boolean,default:!1}},emits:["select"],setup(O,{emit:A}){const _=O,N=A,b=S(_.nivel<2),w=re(()=>_.excludedId?_.etiqueta.id===_.excludedId:!1),$=()=>{b.value=!b.value},V=f=>{w.value||N("select",f)};return(f,u)=>{const s=Ce("EtiquetaTreeItem",!0);return r(),m("div",null,[o("div",{class:I(["relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",{"opacity-50":w.value}]),onClick:u[0]||(u[0]=()=>!w.value&&V(f.etiqueta))},[o("div",lt,[o("span",{class:"flex-shrink-0",style:Ee({width:`${f.nivel*20}px`})},null,4),f.etiqueta.children&&f.etiqueta.children.length>0?(r(),m("button",{key:0,onClick:ge($,["stop"]),class:"mr-1 p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ie),{class:I(["h-3 w-3 transition-transform",b.value?"rotate-90":""])},null,8,["class"])])):(r(),m("span",st)),t(e(Se),{class:I(["mr-2 h-4 w-4 flex-shrink-0",f.selectedId===f.etiqueta.id?"opacity-100":"opacity-0"])},null,8,["class"]),o("div",ot,[o("span",rt,[n(v(f.etiqueta.nombre)+" ",1),f.showCategoria&&f.etiqueta.categoria?(r(),m("span",it," ("+v(f.etiqueta.categoria.nombre)+") ",1)):y("",!0)]),f.etiqueta.children&&f.etiqueta.children.length>0?(r(),m("span",nt," ("+v(f.etiqueta.children.length)+") ",1)):y("",!0),f.etiqueta.usos_count>0?(r(),h(e(R),{key:1,variant:"secondary",class:"ml-2 text-xs"},{default:a(()=>[n(v(f.etiqueta.usos_count)+" usos ",1)]),_:1})):y("",!0)])])],2),b.value&&f.etiqueta.children?(r(!0),m(U,{key:0},M(f.etiqueta.children,q=>(r(),h(s,{key:q.id,etiqueta:q,nivel:f.nivel+1,"selected-id":f.selectedId,"excluded-id":f.excludedId,"show-categoria":f.showCategoria,onSelect:V},null,8,["etiqueta","nivel","selected-id","excluded-id","show-categoria"]))),128)):y("",!0)])}}}),ut={class:"etiqueta-hierarchy-selector"},mt={key:0,class:"truncate"},ct={key:0,class:"text-muted-foreground text-xs mr-1"},pt={key:1,class:"text-muted-foreground"},ft={key:0,class:"text-xs text-muted-foreground mt-1"},vt=ae({__name:"EtiquetaHierarchySelector",props:{modelValue:{},label:{default:"Etiqueta Padre"},placeholder:{default:"Seleccionar etiqueta padre..."},allowNull:{type:Boolean,default:!0},excludedId:{},categorias:{},id:{default:"etiqueta-padre"}},emits:["update:modelValue"],setup(O,{emit:A}){const _=O,N=A,b=S(!1),w=S(""),$=S([]),V=S(!1),f=re(()=>_.modelValue&&$.value.find(c=>c.id===_.modelValue)||null),u=re(()=>_.categorias?w.value?_.categorias.filter(c=>q(c.id).some(g=>g.nombre.toLowerCase().includes(w.value.toLowerCase())||g.descripcion&&g.descripcion.toLowerCase().includes(w.value.toLowerCase()))):_.categorias:[]),s=c=>$.value.filter(g=>g.categoria_etiqueta_id===c&&!g.parent_id&&g.id!==_.excludedId),q=c=>$.value.filter(g=>g.categoria_etiqueta_id===c&&g.id!==_.excludedId),J=c=>{const g=[c.nombre];let E=c;for(;E.parent_id;){const P=$.value.find(K=>K.id===E.parent_id);if(!P)break;g.unshift(P.nombre),E=P}return g.join(" / ")},j=async()=>{V.value=!0;try{const c=await _e.get("/admin/etiquetas/para-selector",{params:{excluir_id:_.excludedId}});c.data.success&&($.value=c.data.etiquetas)}catch(c){console.error("Error cargando etiquetas:",c)}finally{V.value=!1}},z=c=>{N("update:modelValue",(c==null?void 0:c.id)||null),b.value=!1};return Ve(()=>{j()}),(c,g)=>(r(),m("div",ut,[t(e(X),{for:c.id},{default:a(()=>[n(v(c.label),1)]),_:1},8,["for"]),t(e(Fe),{open:b.value,"onUpdate:open":g[2]||(g[2]=E=>b.value=E)},{default:a(()=>[t(e(Ge),{asChild:""},{default:a(()=>[t(e(C),{id:c.id,variant:"outline",role:"combobox","aria-expanded":b.value,"aria-label":c.label,class:"w-full justify-between"},{default:a(()=>[f.value?(r(),m("span",mt,[f.value.parent?(r(),m("span",ct,v(f.value.parent.nombre)+" / ",1)):y("",!0),n(" "+v(f.value.nombre),1)])):(r(),m("span",pt,v(c.placeholder),1)),t(e(Xe),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["id","aria-expanded","aria-label"])]),_:1}),t(e(We),{class:"w-[400px] p-0"},{default:a(()=>[t(e(He),null,{default:a(()=>[t(e(Be),{placeholder:"Buscar etiqueta...",modelValue:w.value,"onUpdate:modelValue":g[0]||(g[0]=E=>w.value=E)},null,8,["modelValue"]),t(e(Me),null,{default:a(()=>[t(e(Re),null,{default:a(()=>[...g[3]||(g[3]=[n("No se encontraron etiquetas.",-1)])]),_:1}),c.allowNull?(r(),h(e(he),{key:0},{default:a(()=>[t(e(Oe),{value:"",onSelect:g[1]||(g[1]=E=>z(null))},{default:a(()=>[t(e(Se),{class:I(["mr-2 h-4 w-4",c.modelValue?"opacity-0":"opacity-100"])},null,8,["class"]),g[4]||(g[4]=o("span",{class:"text-muted-foreground"},"Sin etiqueta padre (raíz)",-1))]),_:1})]),_:1})):y("",!0),(r(!0),m(U,null,M(u.value,E=>(r(),h(e(he),{key:E.id,heading:E.nombre},{default:a(()=>[(r(!0),m(U,null,M(s(E.id),P=>(r(),h(dt,{key:P.id,etiqueta:P,nivel:0,"selected-id":c.modelValue,"excluded-id":c.excludedId,onSelect:z},null,8,["etiqueta","selected-id","excluded-id"]))),128))]),_:2},1032,["heading"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),f.value?(r(),m("p",ft," Ruta: "+v(J(f.value)),1)):y("",!0)]))}}),$e=qe(vt,[["__scopeId","data-v-bcdf1be4"]]),gt={class:"tree-node"},_t={key:1,class:"w-5"},bt={class:"flex-1 font-medium"},qt={key:0,class:"text-xs text-muted-foreground ml-1"},yt={class:"flex gap-1"},ht={class:"flex gap-1"},xt={key:0},kt=ae({__name:"EtiquetaTreeNode",props:{etiqueta:{},nivel:{default:0},expandidos:{},dragDropHelpers:{}},emits:["toggle","edit","delete","drop"],setup(O,{emit:A}){const _=O,N=A,b=S(!1),w=s=>{s.dataTransfer.effectAllowed="move",_.dragDropHelpers.handleDragStart(_.etiqueta)},$=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",b.value=!0,_.dragDropHelpers.handleDragOver(s,_.etiqueta)},V=()=>{b.value=!1},f=s=>{s.preventDefault(),s.stopPropagation(),b.value=!1;const q=_.dragDropHelpers.handleDrop(s,_.etiqueta);q&&q.valido&&N("drop",q)},u=()=>{b.value=!1,_.dragDropHelpers.handleDragEnd()};return(s,q)=>{var j;const J=Ce("EtiquetaTreeNode",!0);return r(),m("div",gt,[o("div",{class:I(["flex items-center gap-2 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700","transition-colors cursor-move",b.value?"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-300":""]),style:Ee({paddingLeft:s.nivel*24+"px"}),draggable:"true",onDragstart:w,onDragover:$,onDrop:f,onDragend:u,onDragleave:V},[s.etiqueta.children&&s.etiqueta.children.length>0?(r(),m("button",{key:0,onClick:q[0]||(q[0]=z=>s.$emit("toggle",s.etiqueta.id)),class:"p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ie),{class:I(["h-4 w-4 transition-transform",s.expandidos.has(s.etiqueta.id)?"rotate-90":""])},null,8,["class"])])):(r(),m("span",_t)),(j=s.etiqueta.categoria)!=null&&j.color?(r(),m("div",{key:2,class:I(["w-3 h-3 rounded-full",s.etiqueta.categoria.color])},null,2)):y("",!0),o("span",bt,[n(v(s.etiqueta.nombre)+" ",1),s.etiqueta.categoria?(r(),m("span",qt," ("+v(s.etiqueta.categoria.nombre)+") ",1)):y("",!0)]),o("div",yt,[s.etiqueta.usos_count>0?(r(),h(e(R),{key:0,variant:"secondary",class:"text-xs"},{default:a(()=>[n(v(s.etiqueta.usos_count)+" usos ",1)]),_:1})):y("",!0),s.etiqueta.children&&s.etiqueta.children.length>0?(r(),h(e(R),{key:1,variant:"outline",class:"text-xs"},{default:a(()=>[n(v(s.etiqueta.children.length),1)]),_:1})):y("",!0)]),o("div",ht,[t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7",onClick:q[1]||(q[1]=ge(z=>s.$emit("edit",s.etiqueta),["stop"]))},{default:a(()=>[t(e(Je),{class:"h-3 w-3"})]),_:1}),t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-500 hover:text-red-600",onClick:q[2]||(q[2]=ge(z=>s.$emit("delete",s.etiqueta),["stop"]))},{default:a(()=>[t(e(be),{class:"h-3 w-3"})]),_:1})])],38),s.expandidos.has(s.etiqueta.id)&&s.etiqueta.children?(r(),m("div",xt,[(r(!0),m(U,null,M(s.etiqueta.children,z=>(r(),h(J,{key:z.id,etiqueta:z,nivel:s.nivel+1,expandidos:s.expandidos,"drag-drop-helpers":s.dragDropHelpers,onToggle:q[3]||(q[3]=c=>s.$emit("toggle",c)),onEdit:q[4]||(q[4]=c=>s.$emit("edit",c)),onDelete:q[5]||(q[5]=c=>s.$emit("delete",c)),onDrop:q[6]||(q[6]=c=>s.$emit("drop",c))},null,8,["etiqueta","nivel","expandidos","drag-drop-helpers"]))),128))])):y("",!0)])}}}),wt=qe(kt,[["__scopeId","data-v-b5f23538"]]),$t={class:"etiqueta-tree-view"},Ct={class:"mb-4 flex gap-2 items-center"},Et={class:"ml-auto flex items-center gap-2"},Vt={class:"border rounded-lg p-4 bg-white dark:bg-gray-800"},Dt={key:0,class:"flex justify-center py-8"},St={key:1,class:"text-center py-8 text-muted-foreground"},Tt={key:2,class:"space-y-1"},It={key:0,class:"mt-4 grid grid-cols-4 gap-4"},Nt={class:"text-2xl font-bold"},zt={class:"text-2xl font-bold"},Ut={class:"text-2xl font-bold"},jt={class:"text-2xl font-bold"},Pt=ae({__name:"EtiquetaTreeView",props:{etiquetas:{},categoriaId:{},showStats:{type:Boolean,default:!1}},emits:["edit","delete","moved"],setup(O,{emit:A}){const _=O,N=A,b=S(!1),w=S(""),$=S([]),{etiquetas:V,expandidos:f,estadisticas:u,construirArbol:s,filtrarArbol:q,toggleExpansion:J,expandirTodos:j,colapsarTodos:z,dragDropHelpers:c}=Ke($),g=async()=>{if(_.etiquetas){$.value=s(_.etiquetas);return}b.value=!0;try{const k=await _e.get("/admin/etiquetas/arbol",{params:{categoria_id:_.categoriaId}});k.data.success&&($.value=k.data.arbol)}catch(k){console.error("Error cargando árbol de etiquetas:",k),D.error("Error al cargar las etiquetas")}finally{b.value=!1}},E=re(()=>w.value?q(w.value,V.value):V.value);let P;const K=()=>{clearTimeout(P),P=setTimeout(()=>{},300)},le=async k=>{var x,F;if(k.valido){b.value=!0;try{(await _e.post(`/admin/etiquetas/${k.hijoId}/establecer-padre`,{parent_id:k.padreId})).data.success&&(D.success("Etiqueta movida exitosamente"),N("moved",{etiquetaId:k.hijoId,nuevoPadreId:k.padreId}),await g())}catch(G){D.error(((F=(x=G.response)==null?void 0:x.data)==null?void 0:F.message)||"Error al mover la etiqueta")}finally{b.value=!1}}};return Ue(()=>_.etiquetas,k=>{k&&($.value=s(k))}),Ve(()=>{g()}),(k,x)=>(r(),m("div",$t,[o("div",Ct,[t(e(H),{modelValue:w.value,"onUpdate:modelValue":x[0]||(x[0]=F=>w.value=F),placeholder:"Buscar etiquetas...",class:"max-w-sm",onInput:K},{prefix:a(()=>[t(e(Qe),{class:"h-4 w-4 text-muted-foreground"})]),_:1},8,["modelValue"]),t(e(C),{variant:"outline",size:"sm",onClick:e(j)},{default:a(()=>[t(e(De),{class:"h-4 w-4 mr-1"}),x[3]||(x[3]=n(" Expandir todo ",-1))]),_:1},8,["onClick"]),t(e(C),{variant:"outline",size:"sm",onClick:e(z)},{default:a(()=>[t(e(ie),{class:"h-4 w-4 mr-1"}),x[4]||(x[4]=n(" Colapsar todo ",-1))]),_:1},8,["onClick"]),o("div",Et,[t(e(R),{variant:"secondary"},{default:a(()=>[n(v(e(u).totalNodos)+" etiquetas",1)]),_:1}),t(e(R),{variant:"outline"},{default:a(()=>[n(v(e(u).profundidadMaxima)+" niveles",1)]),_:1})])]),o("div",Vt,[b.value?(r(),m("div",Dt,[t(e(Ye),{class:"h-8 w-8 animate-spin text-muted-foreground"})])):E.value.length===0?(r(),m("div",St," No se encontraron etiquetas ")):(r(),m("div",Tt,[(r(!0),m(U,null,M(E.value,F=>(r(),h(wt,{key:F.id,etiqueta:F,nivel:0,expandidos:e(f),"drag-drop-helpers":e(c),onToggle:e(J),onEdit:x[1]||(x[1]=G=>k.$emit("edit",G)),onDelete:x[2]||(x[2]=G=>k.$emit("delete",G)),onDrop:le},null,8,["etiqueta","expandidos","drag-drop-helpers","onToggle"]))),128))]))]),k.showStats?(r(),m("div",It,[t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[5]||(x[5]=[n("Total",-1)])]),_:1})]),_:1}),t(e(L),null,{default:a(()=>[o("div",Nt,v(e(u).totalNodos),1)]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[6]||(x[6]=[n("Raíces",-1)])]),_:1})]),_:1}),t(e(L),null,{default:a(()=>[o("div",zt,v(e(u).totalRaices),1)]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[7]||(x[7]=[n("Con hijos",-1)])]),_:1})]),_:1}),t(e(L),null,{default:a(()=>[o("div",Ut,v(e(u).totalConHijos),1)]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[8]||(x[8]=[n("Profundidad",-1)])]),_:1})]),_:1}),t(e(L),null,{default:a(()=>[o("div",jt,v(e(u).profundidadMaxima),1)]),_:1})]),_:1})])):y("",!0)]))}}),Lt=qe(Pt,[["__scopeId","data-v-e813d647"]]),At={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ht={class:"flex justify-between items-center"},Bt={key:0,class:"grid grid-cols-3 gap-4"},Mt={class:"text-2xl font-bold"},Rt={class:"text-2xl font-bold"},Ot={class:"text-2xl font-bold"},Ft={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Gt={key:0,class:"text-xs text-red-500 mt-1"},Wt={class:"flex items-center gap-2"},Xt={class:"flex items-center gap-2"},Jt={class:"md:col-span-2"},Kt={class:"flex gap-2 mt-4"},Qt={class:"flex items-center justify-between"},Yt={class:"flex items-center gap-2"},Zt={class:"flex items-center gap-2"},ea={class:"flex justify-end gap-2"},ta={class:"flex items-center gap-2"},aa={class:"flex items-center gap-2"},la={class:"flex items-center gap-2"},sa={class:"flex justify-end gap-2"},oa={class:"p-4 space-y-4"},ra={class:"flex items-center justify-between"},ia={class:"font-medium flex items-center gap-2"},na={class:"grid grid-cols-1 gap-4"},da={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ua={class:"flex gap-2 mt-4"},ma={key:1,class:"space-y-2"},ca={key:0,class:"flex-1"},pa={class:"grid grid-cols-2 gap-4 mb-2"},fa={class:"flex gap-2 items-end"},va={class:"flex-1"},ga={key:1,class:"flex-1 flex items-center justify-between"},_a={class:"flex items-center gap-2"},ba={class:"font-medium"},qa={key:0,class:"text-sm text-gray-500"},ya={key:1,class:"text-xs text-muted-foreground mt-1"},ha={class:"flex gap-2"},xa={key:2,class:"text-center py-8 text-gray-500"},zl=ae({__name:"Index",props:{categorias:{},estadisticas:{},colores:{},iconos:{}},setup(O){const A=O,_=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:"Categorías de Etiquetas",href:"/admin/categorias-etiquetas"}],N=S(null),b=S(!1),w=S(new Set),$=S(null),V=S(null),f=S("table"),u=ye({nombre:"",color:"gray",icono:"Tag",descripcion:"",orden:0}),s=ye({nombre:"",descripcion:"",categoria_etiqueta_id:0,parent_id:null}),q=()=>{b.value=!0,N.value=null,u.reset()},J=d=>{N.value=d.id,b.value=!1,u.nombre=d.nombre,u.color=d.color,u.icono=d.icono||"Tag",u.descripcion=d.descripcion||"",u.orden=d.orden},j=()=>{N.value=null,b.value=!1,u.reset()},z=()=>{u.post("/admin/categorias-etiquetas",{preserveScroll:!0,onSuccess:()=>{D.success("Categoría creada exitosamente"),j()},onError:()=>{D.error("Error al crear la categoría")}})},c=d=>{u.put(`/admin/categorias-etiquetas/${d}`,{preserveScroll:!0,onSuccess:()=>{D.success("Categoría actualizada"),j()},onError:()=>{D.error("Error al actualizar")}})},g=d=>{confirm(`¿Eliminar la categoría "${d.nombre}"? Las etiquetas se reasignarán.`)&&ne.delete(`/admin/categorias-etiquetas/${d.id}`,{preserveScroll:!0,onSuccess:()=>{D.success("Categoría eliminada")}})},E=d=>{ne.patch(`/admin/categorias-etiquetas/${d.id}/toggle-active`,{},{preserveScroll:!0,onSuccess:()=>{D.success(d.activo?"Categoría desactivada":"Categoría activada")}})},P=d=>{const l=w.value;l.has(d)?l.delete(d):l.add(d)},K=d=>{$.value=d,V.value=null,s.reset(),s.categoria_etiqueta_id=d},le=d=>{V.value=d.id,$.value=null,s.nombre=d.nombre,s.descripcion=d.descripcion||"",s.categoria_etiqueta_id=d.categoria_etiqueta_id,s.parent_id=d.parent_id||null},k=()=>{$.value=null,V.value=null,s.reset()},x=()=>{s.post("/admin/etiquetas",{preserveScroll:!0,onSuccess:()=>{D.success("Etiqueta creada exitosamente"),k()},onError:()=>{D.error("Error al crear la etiqueta")}})},F=d=>{s.put(`/admin/etiquetas/${d}`,{preserveScroll:!0,onSuccess:()=>{D.success("Etiqueta actualizada exitosamente"),k()},onError:()=>{D.error("Error al actualizar la etiqueta")}})},G=d=>{confirm("¿Estás seguro de eliminar esta etiqueta?")&&ne.delete(`/admin/etiquetas/${d}`,{preserveScroll:!0,onSuccess:()=>{D.success("Etiqueta eliminada exitosamente")},onError:()=>{D.error("Error al eliminar la etiqueta")}})},ee=d=>({gray:"bg-gray-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",yellow:"bg-yellow-500",lime:"bg-lime-500",green:"bg-green-500",emerald:"bg-emerald-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",blue:"bg-blue-500",indigo:"bg-indigo-500",violet:"bg-violet-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"})[d]||"bg-gray-500",Te=()=>{const d=[];return A.categorias.data.forEach(l=>{l.etiquetas&&l.etiquetas.forEach(i=>{d.push({...i,categoria:{id:l.id,nombre:l.nombre,color:l.color,icono:l.icono,descripcion:l.descripcion,orden:l.orden,activo:l.activo}})})}),d},Ie=d=>{const l=A.categorias.data.find(i=>i.id===d.categoria_etiqueta_id);l&&(w.value.add(l.id),f.value="table",le(d))},Ne=d=>{G(d.id)};return(d,l)=>(r(),m(U,null,[t(e(je),{title:"Categorías de Etiquetas"}),t(ze,{breadcrumbs:_},{default:a(()=>[o("div",At,[o("div",Ht,[l[16]||(l[16]=o("div",null,[o("h1",{class:"text-2xl font-bold"},"Categorías de Etiquetas"),o("p",{class:"text-sm text-muted-foreground mt-1"}," Administra las categorías para organizar las etiquetas de proyectos ")],-1)),b.value?y("",!0):(r(),h(e(C),{key:0,onClick:q},{default:a(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),l[15]||(l[15]=n(" Nueva Categoría ",-1))]),_:1}))]),d.estadisticas?(r(),m("div",Bt,[t(e(B),null,{default:a(()=>[t(e(L),{class:"pt-6"},{default:a(()=>[o("div",Mt,v(d.estadisticas.total_categorias),1),l[17]||(l[17]=o("p",{class:"text-xs text-muted-foreground"},"Categorías totales",-1))]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(L),{class:"pt-6"},{default:a(()=>[o("div",Rt,v(d.estadisticas.categorias_activas),1),l[18]||(l[18]=o("p",{class:"text-xs text-muted-foreground"},"Categorías activas",-1))]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(L),{class:"pt-6"},{default:a(()=>[o("div",Ot,v(d.estadisticas.total_etiquetas),1),l[19]||(l[19]=o("p",{class:"text-xs text-muted-foreground"},"Etiquetas totales",-1))]),_:1})]),_:1})])):y("",!0),b.value?(r(),h(e(B),{key:1},{default:a(()=>[t(e(Y),null,{default:a(()=>[t(e(Z),null,{default:a(()=>[...l[20]||(l[20]=[n("Nueva Categoría",-1)])]),_:1})]),_:1}),t(e(L),null,{default:a(()=>[o("div",Ft,[o("div",null,[t(e(X),null,{default:a(()=>[...l[21]||(l[21]=[n("Nombre *",-1)])]),_:1}),t(e(H),{modelValue:e(u).nombre,"onUpdate:modelValue":l[0]||(l[0]=i=>e(u).nombre=i),placeholder:"Nombre de la categoría",class:I({"border-red-500":e(u).errors.nombre})},null,8,["modelValue","class"]),e(u).errors.nombre?(r(),m("p",Gt,v(e(u).errors.nombre),1)):y("",!0)]),o("div",null,[t(e(X),null,{default:a(()=>[...l[22]||(l[22]=[n("Color",-1)])]),_:1}),t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[1]||(l[1]=i=>e(u).color=i)},{default:a(()=>[t(e(ue),null,{default:a(()=>[o("div",Wt,[o("div",{class:I([ee(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(me),{placeholder:e(u).color},null,8,["placeholder"])])]),_:1}),t(e(ce),null,{default:a(()=>[(r(!0),m(U,null,M(d.colores,i=>(r(),h(e(pe),{key:i,value:i},{default:a(()=>[o("div",Xt,[o("div",{class:I([ee(i),"w-4 h-4 rounded"])},null,2),n(" "+v(i),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",null,[t(e(X),null,{default:a(()=>[...l[23]||(l[23]=[n("Icono",-1)])]),_:1}),t(e(de),{modelValue:e(u).icono,"onUpdate:modelValue":l[2]||(l[2]=i=>e(u).icono=i)},{default:a(()=>[t(e(ue),null,{default:a(()=>[t(e(me),{placeholder:e(u).icono},null,8,["placeholder"])]),_:1}),t(e(ce),null,{default:a(()=>[(r(!0),m(U,null,M(d.iconos,i=>(r(),h(e(pe),{key:i,value:i},{default:a(()=>[n(v(i),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",null,[t(e(X),null,{default:a(()=>[...l[24]||(l[24]=[n("Orden",-1)])]),_:1}),t(e(H),{modelValue:e(u).orden,"onUpdate:modelValue":l[3]||(l[3]=i=>e(u).orden=i),modelModifiers:{number:!0},type:"number",placeholder:"0"},null,8,["modelValue"])]),o("div",Jt,[t(e(X),null,{default:a(()=>[...l[25]||(l[25]=[n("Descripción",-1)])]),_:1}),t(e(H),{modelValue:e(u).descripcion,"onUpdate:modelValue":l[4]||(l[4]=i=>e(u).descripcion=i),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),o("div",Kt,[t(e(C),{onClick:z,disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[26]||(l[26]=n(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:j},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[27]||(l[27]=n(" Cancelar ",-1))]),_:1})])]),_:1})]),_:1})):y("",!0),t(e(Ze),{modelValue:f.value,"onUpdate:modelValue":l[14]||(l[14]=i=>f.value=i)},{default:a(()=>[t(e(B),null,{default:a(()=>[t(e(Y),null,{default:a(()=>[o("div",Qt,[t(e(Z),null,{default:a(()=>[...l[28]||(l[28]=[n("Gestión de Etiquetas",-1)])]),_:1}),t(e(et),null,{default:a(()=>[t(e(xe),{value:"table"},{default:a(()=>[t(e(tt),{class:"h-4 w-4 mr-2"}),l[29]||(l[29]=n(" Vista de Tabla ",-1))]),_:1}),t(e(xe),{value:"tree"},{default:a(()=>[t(e(at),{class:"h-4 w-4 mr-2"}),l[30]||(l[30]=n(" Vista de Árbol ",-1))]),_:1})]),_:1})])]),_:1}),t(e(ke),{value:"table",class:"mt-0"},{default:a(()=>[t(e(L),{class:"p-0"},{default:a(()=>[t(e(Pe),null,{default:a(()=>[t(e(Le),null,{default:a(()=>[t(e(te),null,{default:a(()=>[t(e(Q),null,{default:a(()=>[...l[31]||(l[31]=[n("Nombre",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[32]||(l[32]=[n("Color",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[33]||(l[33]=[n("Etiquetas",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[34]||(l[34]=[n("Orden",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[35]||(l[35]=[n("Estado",-1)])]),_:1}),t(e(Q),{class:"text-right"},{default:a(()=>[...l[36]||(l[36]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(Ae),null,{default:a(()=>[(r(!0),m(U,null,M(d.categorias.data,i=>(r(),m(U,{key:i.id},[N.value===i.id?(r(),h(e(te),{key:0},{default:a(()=>[t(e(T),null,{default:a(()=>[t(e(H),{modelValue:e(u).nombre,"onUpdate:modelValue":l[5]||(l[5]=p=>e(u).nombre=p),class:"w-full"},null,8,["modelValue"])]),_:1}),t(e(T),null,{default:a(()=>[t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[6]||(l[6]=p=>e(u).color=p)},{default:a(()=>[t(e(ue),{class:"w-32"},{default:a(()=>[o("div",Yt,[o("div",{class:I([ee(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(me))])]),_:1}),t(e(ce),null,{default:a(()=>[(r(!0),m(U,null,M(d.colores,p=>(r(),h(e(pe),{key:p,value:p},{default:a(()=>[o("div",Zt,[o("div",{class:I([ee(p),"w-4 h-4 rounded"])},null,2),n(" "+v(p),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e(T),null,{default:a(()=>[n(v(i.etiquetas_count||0),1)]),_:2},1024),t(e(T),null,{default:a(()=>[t(e(H),{modelValue:e(u).orden,"onUpdate:modelValue":l[7]||(l[7]=p=>e(u).orden=p),modelModifiers:{number:!0},type:"number",class:"w-20"},null,8,["modelValue"])]),_:1}),t(e(T),null,{default:a(()=>[t(e(R),{variant:i.activo?"default":"secondary"},{default:a(()=>[n(v(i.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(T),{class:"text-right"},{default:a(()=>[o("div",ea,[t(e(C),{size:"sm",onClick:p=>c(i.id),disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:j},{default:a(()=>[t(e(oe),{class:"h-4 w-4"})]),_:1})])]),_:2},1024)]),_:2},1024)):(r(),h(e(te),{key:1},{default:a(()=>[t(e(T),{class:"font-medium"},{default:a(()=>[o("div",ta,[t(e(ve),{class:"h-4 w-4 text-muted-foreground"}),n(" "+v(i.nombre),1)])]),_:2},1024),t(e(T),null,{default:a(()=>[o("div",aa,[o("div",{class:I([ee(i.color),"w-4 h-4 rounded"])},null,2),n(" "+v(i.color),1)])]),_:2},1024),t(e(T),null,{default:a(()=>[o("div",la,[t(e(C),{variant:"ghost",size:"sm",onClick:p=>P(i.id),class:"p-1"},{default:a(()=>[w.value.has(i.id)?(r(),h(e(De),{key:1,class:"h-4 w-4"})):(r(),h(e(ie),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),t(e(R),{variant:"outline"},{default:a(()=>[n(v(i.etiquetas_count||0)+" etiquetas ",1)]),_:2},1024)])]),_:2},1024),t(e(T),null,{default:a(()=>[n(v(i.orden),1)]),_:2},1024),t(e(T),null,{default:a(()=>[t(e(R),{variant:i.activo?"default":"secondary",class:"cursor-pointer",onClick:p=>E(i)},{default:a(()=>[n(v(i.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant","onClick"])]),_:2},1024),t(e(T),{class:"text-right"},{default:a(()=>[o("div",sa,[t(e(C),{size:"sm",variant:"ghost",onClick:p=>J(i)},{default:a(()=>[t(e(we),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(e(C),{size:"sm",variant:"ghost",onClick:p=>g(i),class:"text-destructive hover:text-destructive"},{default:a(()=>[t(e(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),w.value.has(i.id)?(r(),h(e(te),{key:2,class:"bg-gray-50 dark:bg-gray-900/50"},{default:a(()=>[t(e(T),{colspan:"6",class:"p-0"},{default:a(()=>[o("div",oa,[o("div",ra,[o("h4",ia,[t(e(ve),{class:"h-4 w-4"}),n(" Etiquetas de "+v(i.nombre),1)]),$.value!==i.id?(r(),h(e(C),{key:0,size:"sm",onClick:p=>K(i.id)},{default:a(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),l[37]||(l[37]=n(" Nueva Etiqueta ",-1))]),_:2},1032,["onClick"])):y("",!0)]),$.value===i.id?(r(),h(e(B),{key:0,class:"border-dashed"},{default:a(()=>[t(e(L),{class:"pt-4"},{default:a(()=>[o("div",na,[o("div",da,[o("div",null,[t(e(X),null,{default:a(()=>[...l[38]||(l[38]=[n("Nombre *",-1)])]),_:1}),t(e(H),{modelValue:e(s).nombre,"onUpdate:modelValue":l[8]||(l[8]=p=>e(s).nombre=p),placeholder:"Nombre de la etiqueta",class:I({"border-red-500":e(s).errors.nombre})},null,8,["modelValue","class"])]),o("div",null,[t(e(X),null,{default:a(()=>[...l[39]||(l[39]=[n("Descripción",-1)])]),_:1}),t(e(H),{modelValue:e(s).descripcion,"onUpdate:modelValue":l[9]||(l[9]=p=>e(s).descripcion=p),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),o("div",null,[t($e,{modelValue:e(s).parent_id,"onUpdate:modelValue":l[10]||(l[10]=p=>e(s).parent_id=p),categorias:[i],label:"Etiqueta Padre (Opcional)",placeholder:"Seleccionar etiqueta padre..."},null,8,["modelValue","categorias"])])]),o("div",ua,[t(e(C),{onClick:x,disabled:e(s).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[40]||(l[40]=n(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:k},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[41]||(l[41]=n(" Cancelar ",-1))]),_:1})])]),_:2},1024)]),_:2},1024)):y("",!0),i.etiquetas&&i.etiquetas.length>0?(r(),m("div",ma,[(r(!0),m(U,null,M(i.etiquetas,p=>(r(),m("div",{key:p.id,class:"flex items-center justify-between p-3 border rounded-lg bg-white dark:bg-gray-800"},[V.value===p.id?(r(),m("div",ca,[o("div",pa,[t(e(H),{modelValue:e(s).nombre,"onUpdate:modelValue":l[11]||(l[11]=W=>e(s).nombre=W),placeholder:"Nombre"},null,8,["modelValue"]),t(e(H),{modelValue:e(s).descripcion,"onUpdate:modelValue":l[12]||(l[12]=W=>e(s).descripcion=W),placeholder:"Descripción"},null,8,["modelValue"])]),o("div",fa,[o("div",va,[t($e,{modelValue:e(s).parent_id,"onUpdate:modelValue":l[13]||(l[13]=W=>e(s).parent_id=W),categorias:[i],"excluded-id":p.id,label:"",placeholder:"Etiqueta padre..."},null,8,["modelValue","categorias","excluded-id"])]),t(e(C),{size:"sm",onClick:W=>F(p.id),disabled:e(s).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:k},{default:a(()=>[t(e(oe),{class:"h-4 w-4"})]),_:1})])])):(r(),m("div",ga,[o("div",null,[o("div",_a,[o("span",ba,v(p.nombre),1),p.parent?(r(),h(e(R),{key:0,variant:"outline",class:"text-xs"},{default:a(()=>[n(v(p.parent.nombre),1)]),_:2},1024)):y("",!0),p.tiene_hijos?(r(),h(e(R),{key:1,variant:"secondary",class:"text-xs"},{default:a(()=>[...l[42]||(l[42]=[n(" Tiene hijos ",-1)])]),_:1})):y("",!0)]),p.descripcion?(r(),m("p",qa,v(p.descripcion),1)):y("",!0),p.ruta_completa&&p.parent?(r(),m("p",ya," Ruta: "+v(p.ruta_completa),1)):y("",!0)]),o("div",ha,[t(e(C),{size:"sm",variant:"outline",onClick:W=>le(p)},{default:a(()=>[t(e(we),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(e(C),{size:"sm",variant:"outline",onClick:W=>G(p.id)},{default:a(()=>[t(e(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])]))]))),128))])):$.value!==i.id?(r(),m("div",xa,[t(e(ve),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),l[44]||(l[44]=o("p",null,"No hay etiquetas en esta categoría",-1)),t(e(C),{variant:"outline",size:"sm",class:"mt-2",onClick:p=>K(i.id)},{default:a(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),l[43]||(l[43]=n(" Crear primera etiqueta ",-1))]),_:2},1032,["onClick"])])):y("",!0)])]),_:2},1024)]),_:2},1024)):y("",!0)],64))),128)),d.categorias.data.length===0?(r(),h(e(te),{key:0},{default:a(()=>[t(e(T),{colspan:"6",class:"text-center text-muted-foreground py-8"},{default:a(()=>[...l[45]||(l[45]=[n(" No hay categorías creadas. Crea una nueva para empezar. ",-1)])]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ke),{value:"tree",class:"mt-0"},{default:a(()=>[t(e(L),null,{default:a(()=>[t(Lt,{etiquetas:Te(),"show-stats":!0,onEdit:Ie,onDelete:Ne},null,8,["etiquetas"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{zl as default};
