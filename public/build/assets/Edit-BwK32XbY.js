import{d as Ne,u as Ie,r as V,c as O,o as Re,B as De,b as y,w as a,g as n,e as t,i as f,j as v,f as o,v as je,h as l,t as c,m,l as Te,F as H,k as K,s as R}from"./app-C3mLbtbl.js";import{_ as Oe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DcHK92zp.js";import{_ as h,a as S,b as E,c as w}from"./CardTitle.vue_vue_type_script_setup_true_lang-ChdQIG_3.js";import{_ as $}from"./CardDescription.vue_vue_type_script_setup_true_lang-DRzH_vnf.js";import{_ as b}from"./createLucideIcon-Fg4HAD8C.js";import{_ as A}from"./Input.vue_vue_type_script_setup_true_lang-gOL_tRnO.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-qck6u1Er.js";import{_ as ie}from"./Textarea.vue_vue_type_script_setup_true_lang-DneN6s98.js";import{_ as M,a as B,b as L,c as q,d as C}from"./SelectValue.vue_vue_type_script_setup_true_lang-ChlTSLUD.js";import{_ as ne,a as de}from"./index-C97JEAye.js";import{_ as Me,a as Be,b as N,c as I}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Rr8qSmiO.js";import{u as Le}from"./useToast-BI4h2_K6.js";import{u as qe}from"./useFileUpload-DnxtkEr6.js";import{u as Ge}from"./useAutoSave-BAk7sYYv.js";import{_ as Q}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-CQZY9lxN.js";import{_ as Y}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-B6_kFvTi.js";import{_ as Je}from"./FileUploadField.vue_vue_type_script_setup_true_lang-1mlkWCbh.js";import{A as Xe}from"./arrow-left-CwgHHlmU.js";import{T as We}from"./trash-2-Cwgmxb8m.js";import{C as He}from"./clock-3iU64J8L.js";import{C as Ke}from"./circle-check-big-8529voGw.js";import{C as Z}from"./circle-alert-D64nIqcV.js";import{X as ee}from"./x-CvgOZU9_.js";import{U as ue}from"./user-plus-BO1-1PGt.js";import{U as me}from"./users-C9p1-wqA.js";import{S as Qe}from"./save-CuNcfW_S.js";import"./useFlashMessages-T89Xb5yQ.js";import"./index-tdrIkLxE.js";import"./floating-ui.vue-Of5a-2Dr.js";import"./index-EnwG2xL-.js";import"./shield-BXO7VxbX.js";import"./user-DFwa4P4X.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CXzxU74a.js";import"./chevron-right-DlACQWqE.js";import"./house-iCYf5ahZ.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-S8KaGR0w.js";import"./VisuallyHidden-Dlk0rI-c.js";import"./index-CtbUxWfh.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Dv94PMQ6.js";import"./index-BQZR7OpG.js";import"./map-pin-DjnJzEd5.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-C9HhJkQy.js";import"./chevrons-up-down-_BawIr54.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CqBhVR6I.js";import"./target-BGDGzl1c.js";import"./vote-GgYznGhe.js";import"./folder-open-D4Qh6OxT.js";import"./send-B3ZRKDyM.js";import"./file-text-DaT6SJFG.js";import"./briefcase-DJl5Grs_.js";import"./calendar-CW1YarPm.js";import"./megaphone-vAMHhOdv.js";import"./user-check-CLiKDc7T.js";import"./clipboard-list-BUEzxWnI.js";import"./mail-BRTyQP6z.js";import"./message-square-p2a_5caY.js";import"./external-link-AvdV4Nu1.js";import"./panel-left-DogZeznY.js";import"./index-BOkZYM-F.js";import"./check-DGd4o1wk.js";import"./index-DtdWmmNh.js";import"./RovingFocusItem-D6q4T7DB.js";import"./utils-DbSqIIwO.js";import"./debounce-Db32tAPw.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DwgHpKzB.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-tICpcQrN.js";import"./VisuallyHiddenInput-CyQnicEP.js";import"./circle-D3Zg91N2.js";import"./eye-CrHxT1Ec.js";import"./download-BBJZlnhg.js";import"./search-DoKYiImP.js";import"./loader-circle-AhG2FUwl.js";import"./chevron-left-C2zf4vEF.js";import"./upload-BmyYfRK1.js";import"./file-bvfnJMhW.js";const Ye={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ze={class:"flex items-center justify-between"},eo={class:"flex items-center gap-4"},oo={class:"text-gray-600 mt-1"},to={class:"flex gap-2"},ao={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},so={key:3},ro={key:4},lo={key:5},io={class:"flex gap-2"},no={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},uo={key:0,class:"text-red-500 text-sm mt-1"},mo={key:0,class:"text-red-500 text-sm mt-1"},po={key:0,class:"text-red-500 text-sm mt-1"},co={class:"pt-4 border-t"},fo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},vo={key:0,class:"text-red-500 text-sm mt-1"},_o={key:0,class:"text-red-500 text-sm mt-1"},bo={key:0,class:"text-red-500 text-sm mt-1"},go={key:0,class:"text-red-500 text-sm mt-1"},xo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},yo={key:0,class:"text-red-500 text-sm mt-1"},Co={key:0,class:"text-red-500 text-sm mt-1"},Vo={class:"pt-4 border-t"},ho={class:"space-y-6"},So={class:"space-y-4"},Eo={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between mb-2"},wo={class:"font-medium"},ko={class:"text-sm text-muted-foreground"},Uo={class:"space-y-4"},$o={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},zo={class:"font-medium"},Po={class:"text-sm text-muted-foreground"},Ao={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},Fo={class:"space-y-4"},No={key:0,class:"space-y-2"},Io={class:"flex items-center justify-between"},Ro={class:"font-medium"},Do={class:"text-sm text-muted-foreground"},jo={class:"flex items-center gap-2 mt-1"},To={class:"text-xs bg-primary/10 text-primary px-2 py-1 rounded"},Oo={key:0,class:"text-xs text-muted-foreground"},Mo={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},Bo={key:0,class:"text-red-500 text-sm mt-1"},Lo={class:"pt-4 border-t"},qo={key:0,class:"flex justify-end gap-4"},ca=Ne({__name:"Edit",props:{contrato:{},proyectos:{},camposPersonalizados:{},valoresCampos:{}},setup(z){var re,le;const d=z,x=Le(),{uploadFiles:pe}=qe(),ce=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:d.contrato.nombre,href:`/admin/contratos/${d.contrato.id}`},{title:"Editar",href:`/admin/contratos/${d.contrato.id}/edit`}],fe=()=>!d.contrato.participantes||d.contrato.participantes.length===0?[]:d.contrato.participantes.map(i=>{var e,u,r;return{user_id:((e=i.pivot)==null?void 0:e.user_id)||i.user_id||i.id,rol:((u=i.pivot)==null?void 0:u.rol)||i.rol||"participante",notas:((r=i.pivot)==null?void 0:r.notas)||i.notas||""}}),s=Ie({proyecto_id:d.contrato.proyecto_id.toString(),nombre:d.contrato.nombre,descripcion:d.contrato.descripcion||"",fecha_inicio:d.contrato.fecha_inicio,fecha_fin:d.contrato.fecha_fin||"",estado:d.contrato.estado,tipo:d.contrato.tipo,monto_total:((re=d.contrato.monto_total)==null?void 0:re.toString())||"",moneda:d.contrato.moneda,responsable_id:((le=d.contrato.responsable_id)==null?void 0:le.toString())||"none",contraparte_user_id:d.contrato.contraparte_user_id||null,contraparte_nombre:d.contrato.contraparte_nombre||"",contraparte_identificacion:d.contrato.contraparte_identificacion||"",contraparte_email:d.contrato.contraparte_email||"",contraparte_telefono:d.contrato.contraparte_telefono||"",participantes:fe(),archivo_pdf:null,archivos_paths:d.contrato.archivos_paths||[],archivos_nombres:d.contrato.archivos_nombres||[],tipos_archivos:d.contrato.tipos_archivos||{},observaciones:d.contrato.observaciones||"",campos_personalizados:d.valoresCampos||{},_method:"PUT"}),ve=V(d.contrato.archivo_pdf?"Archivo actual: "+d.contrato.archivo_pdf.split("/").pop():""),D=V((d.contrato.archivos_paths||[]).map((i,e)=>{var u,r;return{id:`existing_${e}`,name:((u=d.contrato.archivos_nombres)==null?void 0:u[e])||i.split("/").pop()||"archivo",size:0,path:i,url:`/storage/${i}`,mime_type:((r=d.contrato.tipos_archivos)==null?void 0:r[i])||"application/octet-stream",uploaded_at:d.contrato.updated_at}})),oe=V("informacion");V(!1);const G=V(!1),J=V(!1),X=V(!1),{route:k}=window,_e=[{value:"USD",label:"USD - D칩lar Estadounidense"},{value:"EUR",label:"EUR - Euro"},{value:"MXN",label:"MXN - Peso Mexicano"},{value:"COP",label:"COP - Peso Colombiano"},{value:"ARS",label:"ARS - Peso Argentino"},{value:"CLP",label:"CLP - Peso Chileno"},{value:"PEN",label:"PEN - Sol Peruano"}],F=V(d.contrato.contraparteUser||null),P=V(d.contrato.responsable||null),be=O(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"testigo",label:"Testigo"},{value:"revisor",label:"Revisor"},{value:"aprobador",label:"Aprobador"},{value:"observador",label:"Observador"}],value:"testigo",required:!0},{name:"notas",label:"Notas (opcional)",type:"text",value:"",required:!1}]),ge=O(()=>{const i=s.participantes.map(e=>e.user_id);return s.contraparte_user_id&&i.push(s.contraparte_user_id),i}),xe=i=>{if(i.userIds.length>0&&(s.contraparte_user_id=i.userIds[0],i.users&&i.users.length>0)){const e=i.users[0];F.value=e,s.contraparte_nombre=e.name,s.contraparte_email=e.email||""}},ye=i=>{i.userIds.length>0&&(s.responsable_id=i.userIds[0],i.users&&i.users.length>0&&(P.value=i.users[0]))},W=V(new Map);d.contrato.participantes&&d.contrato.participantes.length>0&&d.contrato.participantes.forEach(i=>{W.value.set(i.id,{id:i.id,name:i.name,email:i.email})});const Ce=i=>{i.userIds.forEach((e,u)=>{s.participantes.some(_=>_.user_id===e)||(s.participantes.push({user_id:e,rol:i.extraData.rol||"testigo",notas:i.extraData.notas||""}),i.users&&i.users[u]&&W.value.set(e,i.users[u]))})},Ve=i=>{const e=s.participantes.findIndex(u=>u.user_id===i);e>-1&&s.participantes.splice(e,1)},te=i=>W.value.get(i),p=O(()=>d.contrato.estado!=="finalizado"&&d.contrato.estado!=="cancelado"),he=O(()=>s.data()),{state:Se,isSaving:ae,hasSaved:se,hasError:j,startWatching:Ee,stopAutoSave:we}=Ge(he,{url:`/admin/contratos/${d.contrato.id}/autosave`,debounceTime:3e3,showNotifications:!0,useLocalStorage:!1}),ke=i=>{const e=i.target;e.files&&e.files[0]&&(s.archivo_pdf=e.files[0],ve.value="Nuevo archivo: "+e.files[0].name)},Ue=async i=>{try{const e=await pe(i,{module:"contratos",fieldId:"archivos",folder:"contratos",maxSize:10485760}),u=e.map(U=>U.path),r=e.map(U=>U.name),_={};e.forEach(U=>{_[U.path]=U.mime_type}),s.archivos_paths=[...s.archivos_paths,...u],s.archivos_nombres=[...s.archivos_nombres,...r],s.tipos_archivos={...s.tipos_archivos,..._},D.value=[...D.value,...e],x.success(`${e.length} archivo(s) agregado(s) exitosamente`)}catch(e){x.error(e.message||"Error al subir archivos")}},$e=()=>{const i=[];return s.proyecto_id||i.push("Debe seleccionar un proyecto"),s.nombre.trim()||i.push("El nombre del contrato es obligatorio"),s.fecha_inicio||i.push("La fecha de inicio es obligatoria"),s.fecha_fin&&s.fecha_fin<s.fecha_inicio&&i.push("La fecha de fin debe ser posterior a la fecha de inicio"),d.camposPersonalizados.forEach(e=>{e.es_requerido&&!s.campos_personalizados[e.id]&&i.push(`El campo "${e.nombre}" es obligatorio`)}),i},ze=()=>{const i=$e();if(i.length>0){i.forEach(u=>x.error(u));return}const e=new FormData;Object.keys(s.data()).forEach(u=>{u==="campos_personalizados"?Object.keys(s.campos_personalizados).forEach(r=>{const _=s.campos_personalizados[r];_!=null&&_!==""&&e.append(`campos_personalizados[${r}]`,_)}):u==="participantes"?s.participantes.forEach((r,_)=>{e.append(`participantes[${_}][user_id]`,r.user_id.toString()),e.append(`participantes[${_}][rol]`,r.rol),r.notas&&e.append(`participantes[${_}][notas]`,r.notas)}):u==="archivos_paths"||u==="archivos_nombres"||u==="tipos_archivos"?u==="archivos_paths"&&Array.isArray(s.archivos_paths)&&s.archivos_paths.length>0?e.append("archivos_paths",JSON.stringify(s.archivos_paths)):u==="archivos_nombres"&&Array.isArray(s.archivos_nombres)&&s.archivos_nombres.length>0?e.append("archivos_nombres",JSON.stringify(s.archivos_nombres)):u==="tipos_archivos"&&s.tipos_archivos&&Object.keys(s.tipos_archivos).length>0&&e.append("tipos_archivos",JSON.stringify(s.tipos_archivos)):u==="archivo_pdf"&&s.archivo_pdf?e.append("archivo_pdf",s.archivo_pdf):u==="responsable_id"&&s[u]==="none"||u!=="_method"&&s[u]!==null&&s[u]!==""&&e.append(u,s[u])}),e.append("_method","PUT"),R.post(k("admin.contratos.update",d.contrato.id),e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{x.success("Contrato actualizado exitosamente")},onError:u=>{typeof u=="object"&&u!==null?Object.values(u).forEach(r=>{Array.isArray(r)?r.forEach(_=>x.error(String(_))):typeof r=="string"?x.error(r):x.error("Error al actualizar el contrato")}):x.error("Error al actualizar el contrato")}})},Pe=()=>{confirm("쮼st치 seguro de eliminar este contrato? Esta acci칩n no se puede deshacer.")&&R.delete(k("admin.contratos.destroy",d.contrato.id),{onSuccess:()=>{x.success("Contrato eliminado exitosamente")},onError:()=>{x.error("Error al eliminar el contrato")}})},Ae=()=>{confirm("쮻esea duplicar este contrato?")&&R.post(k("admin.contratos.duplicar",d.contrato.id),{},{onSuccess:()=>{x.success("Contrato duplicado exitosamente")},onError:()=>{x.error("Error al duplicar el contrato")}})},T=i=>{R.post(k("admin.contratos.cambiar-estado",d.contrato.id),{estado:i},{onSuccess:()=>{s.estado=i,x.success("Estado actualizado exitosamente")},onError:()=>{x.error("Error al cambiar el estado")}})},Fe=()=>{confirm("쮼st치 seguro de cancelar? Los cambios no guardados se perder치n.")&&R.get(k("admin.contratos.show",d.contrato.id))};return Re(()=>{console.log("游댌 Edit.vue - DEBUG CONTRAPARTE onMounted",{contrato_id:d.contrato.id,contraparte_user_id:d.contrato.contraparte_user_id,contraparteUser:d.contrato.contraparteUser,contraparteUser_existe:!!d.contrato.contraparteUser,contraparteSeleccionada_value:F.value,form_contraparte_user_id:s.contraparte_user_id,form_contraparte_nombre:s.contraparte_nombre}),p.value&&Ee()}),De(()=>{we()}),(i,e)=>(m(),y(Oe,{breadcrumbs:ce},{default:a(()=>{var u;return[n("div",Ye,[n("div",Ze,[n("div",eo,[t(o(je),{href:o(k)("admin.contratos.index")},{default:a(()=>[t(o(b),{variant:"ghost",size:"sm"},{default:a(()=>[t(o(Xe),{class:"h-4 w-4 mr-2"}),e[31]||(e[31]=l(" Volver ",-1))]),_:1})]),_:1},8,["href"]),n("div",null,[e[32]||(e[32]=n("h1",{class:"text-3xl font-bold"},"Editar Contrato",-1)),n("p",oo,"Modificar informaci칩n del contrato #"+c(z.contrato.id),1)])]),n("div",to,[t(o(b),{variant:"outline",onClick:Ae},{default:a(()=>[...e[33]||(e[33]=[l(" Duplicar ",-1)])]),_:1}),t(o(b),{variant:"destructive",onClick:Pe},{default:a(()=>[t(o(We),{class:"h-4 w-4 mr-2"}),e[34]||(e[34]=l(" Eliminar ",-1))]),_:1})])]),p.value?(m(),f("div",ao,[o(ae)?(m(),y(o(He),{key:0,class:"h-4 w-4 animate-spin"})):o(se)&&!o(j)?(m(),y(o(Ke),{key:1,class:"h-4 w-4 text-green-600"})):o(j)?(m(),y(o(Z),{key:2,class:"h-4 w-4 text-amber-600"})):v("",!0),o(ae)?(m(),f("span",so,"Guardando cambios...")):o(se)&&!o(j)?(m(),f("span",ro,"Guardado a las "+c((u=o(Se).lastSaved)==null?void 0:u.toLocaleTimeString()),1)):o(j)?(m(),f("span",lo,"Error al guardar")):v("",!0)])):v("",!0),p.value?v("",!0):(m(),y(o(ne),{key:1,variant:"warning"},{default:a(()=>[t(o(Z),{class:"h-4 w-4"}),t(o(de),null,{default:a(()=>[l(" Este contrato est치 "+c(z.contrato.estado)+" y no puede ser editado. ",1),z.contrato.estado==="finalizado"?(m(),y(o(b),{key:0,variant:"link",size:"sm",onClick:e[0]||(e[0]=r=>T("activo")),class:"ml-2"},{default:a(()=>[...e[35]||(e[35]=[l(" Reactivar ",-1)])]),_:1})):v("",!0)]),_:1})]),_:1})),p.value?(m(),y(o(h),{key:2},{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),{class:"text-lg"},{default:a(()=>[...e[36]||(e[36]=[l("Cambio R치pido de Estado",-1)])]),_:1})]),_:1}),t(o(w),null,{default:a(()=>[n("div",io,[o(s).estado==="borrador"?(m(),y(o(b),{key:0,variant:"outline",size:"sm",onClick:e[1]||(e[1]=r=>T("activo"))},{default:a(()=>[...e[37]||(e[37]=[l(" Activar Contrato ",-1)])]),_:1})):v("",!0),o(s).estado==="activo"?(m(),y(o(b),{key:1,variant:"outline",size:"sm",onClick:e[2]||(e[2]=r=>T("finalizado"))},{default:a(()=>[...e[38]||(e[38]=[l(" Finalizar Contrato ",-1)])]),_:1})):v("",!0),o(s).estado!=="cancelado"?(m(),y(o(b),{key:2,variant:"outline",size:"sm",class:"text-red-600",onClick:e[3]||(e[3]=r=>T("cancelado"))},{default:a(()=>[...e[39]||(e[39]=[l(" Cancelar Contrato ",-1)])]),_:1})):v("",!0)])]),_:1})]),_:1})):v("",!0),n("form",{onSubmit:Te(ze,["prevent"]),class:"space-y-6"},[t(o(Me),{modelValue:oe.value,"onUpdate:modelValue":e[27]||(e[27]=r=>oe.value=r)},{default:a(()=>[t(o(Be),{class:"grid w-full grid-cols-6"},{default:a(()=>[t(o(N),{value:"informacion"},{default:a(()=>[...e[40]||(e[40]=[l("Informaci칩n General",-1)])]),_:1}),t(o(N),{value:"fechas"},{default:a(()=>[...e[41]||(e[41]=[l("Fechas y Estado",-1)])]),_:1}),t(o(N),{value:"financiero"},{default:a(()=>[...e[42]||(e[42]=[l("Informaci칩n Financiera",-1)])]),_:1}),t(o(N),{value:"contraparte"},{default:a(()=>[...e[43]||(e[43]=[l("Participantes",-1)])]),_:1}),t(o(N),{value:"archivos"},{default:a(()=>[...e[44]||(e[44]=[l("Archivos",-1)])]),_:1}),t(o(N),{value:"adicional"},{default:a(()=>[...e[45]||(e[45]=[l("Informaci칩n Adicional",-1)])]),_:1})]),_:1}),t(o(I),{value:"informacion"},{default:a(()=>[t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[46]||(e[46]=[l("Informaci칩n General",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[47]||(e[47]=[l("Datos principales del contrato",-1)])]),_:1})]),_:1}),t(o(w),{class:"space-y-4"},{default:a(()=>[n("div",no,[n("div",null,[t(o(g),{for:"proyecto_id"},{default:a(()=>[...e[48]||(e[48]=[l("Proyecto *",-1)])]),_:1}),t(o(M),{modelValue:o(s).proyecto_id,"onUpdate:modelValue":e[4]||(e[4]=r=>o(s).proyecto_id=r),disabled:!p.value},{default:a(()=>[t(o(B),null,{default:a(()=>[t(o(L),{placeholder:"Seleccione un proyecto"})]),_:1}),t(o(q),null,{default:a(()=>[(m(!0),f(H,null,K(z.proyectos,r=>(m(),y(o(C),{key:r.id,value:r.id.toString()},{default:a(()=>[l(c(r.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),o(s).errors.proyecto_id?(m(),f("div",uo,c(o(s).errors.proyecto_id),1)):v("",!0)]),n("div",null,[t(o(g),{for:"nombre"},{default:a(()=>[...e[49]||(e[49]=[l("Nombre del Contrato *",-1)])]),_:1}),t(o(A),{id:"nombre",modelValue:o(s).nombre,"onUpdate:modelValue":e[5]||(e[5]=r=>o(s).nombre=r),placeholder:"Ej: Contrato de servicios de consultor칤a",disabled:!p.value},null,8,["modelValue","disabled"]),o(s).errors.nombre?(m(),f("div",mo,c(o(s).errors.nombre),1)):v("",!0)])]),n("div",null,[t(o(g),{for:"descripcion"},{default:a(()=>[...e[50]||(e[50]=[l("Descripci칩n",-1)])]),_:1}),t(o(ie),{id:"descripcion",modelValue:o(s).descripcion,"onUpdate:modelValue":e[6]||(e[6]=r=>o(s).descripcion=r),placeholder:"Descripci칩n detallada del contrato...",rows:"4",disabled:!p.value},null,8,["modelValue","disabled"]),o(s).errors.descripcion?(m(),f("div",po,c(o(s).errors.descripcion),1)):v("",!0)]),n("div",co,[e[51]||(e[51]=n("h3",{class:"font-medium mb-4"},"Informaci칩n Complementaria",-1)),t(Q,{campos:z.camposPersonalizados,modelValue:o(s).campos_personalizados,"onUpdate:modelValue":e[7]||(e[7]=r=>o(s).campos_personalizados=r),"show-card":!1,disabled:!p.value,grupo:"informacion"},null,8,["campos","modelValue","disabled"])])]),_:1})]),_:1})]),_:1}),t(o(I),{value:"fechas"},{default:a(()=>[t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[52]||(e[52]=[l("Fechas y Estado",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[53]||(e[53]=[l("Configure las fechas y el estado del contrato",-1)])]),_:1})]),_:1}),t(o(w),{class:"space-y-4"},{default:a(()=>[n("div",fo,[n("div",null,[t(o(g),{for:"fecha_inicio"},{default:a(()=>[...e[54]||(e[54]=[l("Fecha de Inicio *",-1)])]),_:1}),t(o(A),{id:"fecha_inicio",type:"date",modelValue:o(s).fecha_inicio,"onUpdate:modelValue":e[8]||(e[8]=r=>o(s).fecha_inicio=r),disabled:!p.value},null,8,["modelValue","disabled"]),o(s).errors.fecha_inicio?(m(),f("div",vo,c(o(s).errors.fecha_inicio),1)):v("",!0)]),n("div",null,[t(o(g),{for:"fecha_fin"},{default:a(()=>[...e[55]||(e[55]=[l("Fecha de Fin",-1)])]),_:1}),t(o(A),{id:"fecha_fin",type:"date",modelValue:o(s).fecha_fin,"onUpdate:modelValue":e[9]||(e[9]=r=>o(s).fecha_fin=r),disabled:!p.value},null,8,["modelValue","disabled"]),o(s).errors.fecha_fin?(m(),f("div",_o,c(o(s).errors.fecha_fin),1)):v("",!0)]),n("div",null,[t(o(g),{for:"estado"},{default:a(()=>[...e[56]||(e[56]=[l("Estado",-1)])]),_:1}),t(o(M),{modelValue:o(s).estado,"onUpdate:modelValue":e[10]||(e[10]=r=>o(s).estado=r),disabled:!p.value},{default:a(()=>[t(o(B),null,{default:a(()=>[t(o(L))]),_:1}),t(o(q),null,{default:a(()=>[t(o(C),{value:"borrador"},{default:a(()=>[...e[57]||(e[57]=[l("Borrador",-1)])]),_:1}),t(o(C),{value:"activo"},{default:a(()=>[...e[58]||(e[58]=[l("Activo",-1)])]),_:1}),t(o(C),{value:"finalizado"},{default:a(()=>[...e[59]||(e[59]=[l("Finalizado",-1)])]),_:1}),t(o(C),{value:"cancelado"},{default:a(()=>[...e[60]||(e[60]=[l("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(s).errors.estado?(m(),f("div",bo,c(o(s).errors.estado),1)):v("",!0)]),n("div",null,[t(o(g),{for:"tipo"},{default:a(()=>[...e[61]||(e[61]=[l("Tipo de Contrato *",-1)])]),_:1}),t(o(M),{modelValue:o(s).tipo,"onUpdate:modelValue":e[11]||(e[11]=r=>o(s).tipo=r),disabled:!p.value},{default:a(()=>[t(o(B),null,{default:a(()=>[t(o(L))]),_:1}),t(o(q),null,{default:a(()=>[t(o(C),{value:"servicio"},{default:a(()=>[...e[62]||(e[62]=[l("Servicio",-1)])]),_:1}),t(o(C),{value:"obra"},{default:a(()=>[...e[63]||(e[63]=[l("Obra",-1)])]),_:1}),t(o(C),{value:"suministro"},{default:a(()=>[...e[64]||(e[64]=[l("Suministro",-1)])]),_:1}),t(o(C),{value:"consultoria"},{default:a(()=>[...e[65]||(e[65]=[l("Consultor칤a",-1)])]),_:1}),t(o(C),{value:"otro"},{default:a(()=>[...e[66]||(e[66]=[l("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(s).errors.tipo?(m(),f("div",go,c(o(s).errors.tipo),1)):v("",!0)])])]),_:1})]),_:1})]),_:1}),t(o(I),{value:"financiero"},{default:a(()=>[t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[67]||(e[67]=[l("Informaci칩n Financiera",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[68]||(e[68]=[l("Montos y detalles financieros del contrato",-1)])]),_:1})]),_:1}),t(o(w),{class:"space-y-4"},{default:a(()=>[n("div",xo,[n("div",null,[t(o(g),{for:"monto_total"},{default:a(()=>[...e[69]||(e[69]=[l("Monto Total",-1)])]),_:1}),t(o(A),{id:"monto_total",type:"number",step:"0.01",modelValue:o(s).monto_total,"onUpdate:modelValue":e[12]||(e[12]=r=>o(s).monto_total=r),placeholder:"0.00",disabled:!p.value},null,8,["modelValue","disabled"]),o(s).errors.monto_total?(m(),f("div",yo,c(o(s).errors.monto_total),1)):v("",!0)]),n("div",null,[t(o(g),{for:"moneda"},{default:a(()=>[...e[70]||(e[70]=[l("Moneda",-1)])]),_:1}),t(o(M),{modelValue:o(s).moneda,"onUpdate:modelValue":e[13]||(e[13]=r=>o(s).moneda=r),disabled:!p.value},{default:a(()=>[t(o(B),null,{default:a(()=>[t(o(L))]),_:1}),t(o(q),null,{default:a(()=>[(m(),f(H,null,K(_e,r=>t(o(C),{key:r.value,value:r.value},{default:a(()=>[l(c(r.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue","disabled"]),o(s).errors.moneda?(m(),f("div",Co,c(o(s).errors.moneda),1)):v("",!0)])]),n("div",Vo,[e[71]||(e[71]=n("h3",{class:"font-medium mb-4"},"Campos Financieros Personalizados",-1)),t(Q,{campos:z.camposPersonalizados,modelValue:o(s).campos_personalizados,"onUpdate:modelValue":e[14]||(e[14]=r=>o(s).campos_personalizados=r),"show-card":!1,disabled:!p.value,grupo:"financiero"},null,8,["campos","modelValue","disabled"])])]),_:1})]),_:1})]),_:1}),t(o(I),{value:"contraparte"},{default:a(()=>[n("div",ho,[t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[72]||(e[72]=[l("Responsable del Contrato",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[73]||(e[73]=[l(" Asigna un usuario responsable de este contrato ",-1)])]),_:1})]),_:1}),t(o(w),null,{default:a(()=>[n("div",So,[P.value?(m(),f("div",Eo,[n("div",null,[n("p",wo,c(P.value.name),1),n("p",ko,c(P.value.email),1)]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:e[15]||(e[15]=r=>{P.value=null,o(s).responsable_id="none"}),disabled:!p.value},{default:a(()=>[t(o(ee),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):v("",!0),t(o(b),{type:"button",variant:"outline",onClick:e[16]||(e[16]=r=>X.value=!0),class:"w-full",disabled:!p.value},{default:a(()=>[t(o(ue),{class:"h-4 w-4 mr-2"}),l(" "+c(P.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[74]||(e[74]=[l("Contraparte - Usuario del Sistema",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[75]||(e[75]=[l(" Seleccione un usuario del sistema como contraparte del contrato ",-1)])]),_:1})]),_:1}),t(o(w),null,{default:a(()=>[n("div",Uo,[n("div",null,[t(o(g),null,{default:a(()=>[...e[76]||(e[76]=[l("Usuario Contraparte",-1)])]),_:1}),e[77]||(e[77]=n("p",{class:"text-sm text-muted-foreground mb-2"}," Si la contraparte es un usuario registrado en el sistema, selecci칩nelo aqu칤 ",-1))]),F.value?(m(),f("div",$o,[n("div",null,[n("p",zo,c(F.value.name),1),n("p",Po,c(F.value.email),1)]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:e[17]||(e[17]=r=>{o(s).contraparte_user_id=null,F.value.value=null,o(s).contraparte_nombre="",o(s).contraparte_email=""}),disabled:!p.value},{default:a(()=>[t(o(ee),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):v("",!0),t(o(b),{type:"button",variant:"outline",onClick:e[18]||(e[18]=r=>G.value=!0),class:"w-full",disabled:!p.value},{default:a(()=>[t(o(ue),{class:"h-4 w-4 mr-2"}),l(" "+c(F.value?"Cambiar Contraparte":"Seleccionar Contraparte"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[78]||(e[78]=[l("Contraparte - Informaci칩n Externa",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[79]||(e[79]=[l(" Complete estos campos si la contraparte no es un usuario del sistema ",-1)])]),_:1})]),_:1}),t(o(w),{class:"space-y-4"},{default:a(()=>[o(s).contraparte_user_id?(m(),y(o(ne),{key:0,class:"mb-4"},{default:a(()=>[t(o(Z),{class:"h-4 w-4"}),t(o(de),null,{default:a(()=>[...e[80]||(e[80]=[l(" Los campos de contraparte externa est치n deshabilitados porque ya se seleccion칩 un usuario del sistema. ",-1)])]),_:1})]),_:1})):v("",!0),n("div",Ao,[n("div",null,[t(o(g),{for:"contraparte_nombre"},{default:a(()=>[...e[81]||(e[81]=[l("Nombre de la Contraparte",-1)])]),_:1}),t(o(A),{id:"contraparte_nombre",modelValue:o(s).contraparte_nombre,"onUpdate:modelValue":e[19]||(e[19]=r=>o(s).contraparte_nombre=r),placeholder:"Nombre de la empresa o persona",disabled:!p.value||!!o(s).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(g),{for:"contraparte_identificacion"},{default:a(()=>[...e[82]||(e[82]=[l("Identificaci칩n/RUC",-1)])]),_:1}),t(o(A),{id:"contraparte_identificacion",modelValue:o(s).contraparte_identificacion,"onUpdate:modelValue":e[20]||(e[20]=r=>o(s).contraparte_identificacion=r),placeholder:"N칰mero de identificaci칩n",disabled:!p.value||!!o(s).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(g),{for:"contraparte_email"},{default:a(()=>[...e[83]||(e[83]=[l("Email de Contacto",-1)])]),_:1}),t(o(A),{id:"contraparte_email",type:"email",modelValue:o(s).contraparte_email,"onUpdate:modelValue":e[21]||(e[21]=r=>o(s).contraparte_email=r),placeholder:"email@ejemplo.com",disabled:!p.value||!!o(s).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(g),{for:"contraparte_telefono"},{default:a(()=>[...e[84]||(e[84]=[l("Tel칠fono de Contacto",-1)])]),_:1}),t(o(A),{id:"contraparte_telefono",modelValue:o(s).contraparte_telefono,"onUpdate:modelValue":e[22]||(e[22]=r=>o(s).contraparte_telefono=r),placeholder:"+1234567890",disabled:!p.value||!!o(s).contraparte_user_id},null,8,["modelValue","disabled"])])])]),_:1})]),_:1}),t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[85]||(e[85]=[l("Participantes del Contrato",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[86]||(e[86]=[l(" Agregue usuarios del sistema que participar치n en este contrato con diferentes roles ",-1)])]),_:1})]),_:1}),t(o(w),null,{default:a(()=>[n("div",Fo,[t(o(b),{type:"button",variant:"outline",onClick:e[23]||(e[23]=r=>J.value=!0),class:"w-full",disabled:!p.value},{default:a(()=>[t(o(me),{class:"h-4 w-4 mr-2"}),e[87]||(e[87]=l(" Agregar Participantes ",-1))]),_:1},8,["disabled"]),o(s).participantes.length>0?(m(),f("div",No,[e[88]||(e[88]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Participantes agregados:",-1)),(m(!0),f(H,null,K(o(s).participantes,r=>{var _,U;return m(),f("div",{key:r.user_id,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[n("div",Io,[n("div",null,[n("p",Ro,c((_=te(r.user_id))==null?void 0:_.name),1),n("p",Do,c((U=te(r.user_id))==null?void 0:U.email),1),n("div",jo,[n("span",To,c(r.rol),1),r.notas?(m(),f("span",Oo,c(r.notas),1)):v("",!0)])]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:Go=>Ve(r.user_id),disabled:!p.value},{default:a(()=>[t(o(ee),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])])])}),128))])):(m(),f("div",Mo,[t(o(me),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),e[89]||(e[89]=n("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))]))])]),_:1})]),_:1})])]),_:1}),t(o(I),{value:"archivos"},{default:a(()=>[t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[90]||(e[90]=[l("Archivos del Contrato",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[91]||(e[91]=[l("Sube m칰ltiples archivos relacionados con el contrato (m치ximo 10)",-1)])]),_:1})]),_:1}),t(o(w),null,{default:a(()=>[t(Je,{modelValue:D.value,"onUpdate:modelValue":e[24]||(e[24]=r=>D.value=r),label:"Archivos",description:"Agrega archivos adicionales al contrato (PDF, im치genes, documentos)",onFilesSelected:Ue,multiple:!0,maxFiles:10,maxFileSize:10,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.xls,.xlsx",autoUpload:!1,disabled:!p.value,module:"contratos",fieldId:"archivos"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(o(I),{value:"adicional"},{default:a(()=>[t(o(h),null,{default:a(()=>[t(o(S),null,{default:a(()=>[t(o(E),null,{default:a(()=>[...e[92]||(e[92]=[l("Informaci칩n Adicional",-1)])]),_:1}),t(o($),null,{default:a(()=>[...e[93]||(e[93]=[l("Observaciones y campos personalizados",-1)])]),_:1})]),_:1}),t(o(w),{class:"space-y-4"},{default:a(()=>[n("div",null,[t(o(g),{for:"observaciones"},{default:a(()=>[...e[94]||(e[94]=[l("Observaciones",-1)])]),_:1}),t(o(ie),{id:"observaciones",modelValue:o(s).observaciones,"onUpdate:modelValue":e[25]||(e[25]=r=>o(s).observaciones=r),placeholder:"Notas u observaciones adicionales...",rows:"4",disabled:!p.value},null,8,["modelValue","disabled"]),o(s).errors.observaciones?(m(),f("div",Bo,c(o(s).errors.observaciones),1)):v("",!0)]),n("div",Lo,[e[95]||(e[95]=n("h3",{class:"font-medium mb-4"},"Campos Personalizados",-1)),t(Q,{campos:z.camposPersonalizados,modelValue:o(s).campos_personalizados,"onUpdate:modelValue":e[26]||(e[26]=r=>o(s).campos_personalizados=r),"show-card":!1,disabled:!p.value,grupo:"otros"},null,8,["campos","modelValue","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),p.value?(m(),f("div",qo,[t(o(b),{type:"button",variant:"outline",onClick:Fe,disabled:o(s).processing},{default:a(()=>[...e[96]||(e[96]=[l(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(o(b),{type:"submit",disabled:o(s).processing},{default:a(()=>[t(o(Qe),{class:"h-4 w-4 mr-2"}),l(" "+c(o(s).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])):v("",!0)],32)]),n("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:ke,class:"hidden"},null,544),t(Y,{modelValue:G.value,"onUpdate:modelValue":e[28]||(e[28]=r=>G.value=r),title:"Seleccionar Contraparte",description:"Selecciona el usuario que ser치 la contraparte del contrato","search-endpoint":o(k)("admin.proyectos.search-users"),"excluded-ids":o(s).contraparte_user_id?[o(s).contraparte_user_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Contraparte","search-placeholder":"Buscar por nombre, email, documento o tel칠fono...",onSubmit:xe},null,8,["modelValue","search-endpoint","excluded-ids"]),t(Y,{modelValue:J.value,"onUpdate:modelValue":e[29]||(e[29]=r=>J.value=r),title:"Agregar Participantes",description:"Selecciona los usuarios que participar치n en este contrato y define su rol","search-endpoint":o(k)("admin.proyectos.search-users"),"excluded-ids":ge.value,"extra-fields":be.value,"submit-button-text":"Agregar Participantes","search-placeholder":"Buscar por nombre, email, documento o tel칠fono...",onSubmit:Ce},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"]),t(Y,{modelValue:X.value,"onUpdate:modelValue":e[30]||(e[30]=r=>X.value=r),title:"Seleccionar Responsable",description:"Selecciona el usuario que ser치 responsable de este contrato","search-endpoint":o(k)("admin.proyectos.search-users"),"excluded-ids":P.value?[P.value.id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o tel칠fono...",onSubmit:ye},null,8,["modelValue","search-endpoint","excluded-ids"])]}),_:1}))}});export{ca as default};
