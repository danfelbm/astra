import{d as z,C as j,r as G,b as w,e as g,w as l,f as s,g as o,u as e,p as B,h as i,P as F,t as d,l as P,i as c,F as D,k as U,W}from"./app-D8b1iyhG.js";import{_ as I}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CNKKI51X.js";import{_ as f}from"./createLucideIcon-BzCZ4Ux9.js";import{_ as v,a as y,b,c as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-CpubZFQk.js";import{_ as x}from"./CardDescription.vue_vue_type_script_setup_true_lang-kW7TGVkd.js";import{_ as h}from"./Input.vue_vue_type_script_setup_true_lang-DEoN5cyd.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-DXnOW2ZY.js";import{_ as O}from"./Textarea.vue_vue_type_script_setup_true_lang-4luaEOZk.js";import{_ as Q,a as H,b as J,c as K,d as X}from"./SelectValue.vue_vue_type_script_setup_true_lang-BW9QKckn.js";import{_ as Y}from"./Switch.vue_vue_type_script_setup_true_lang-6rg-ThH1.js";import{_ as Z}from"./Checkbox.vue_vue_type_script_setup_true_lang-Sq6Kq3jt.js";import{_ as ee}from"./index-BFz4Rjr1.js";import{_ as te,a as se,b as S,c as C}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-kODy9m7A.js";import{_ as le,a as oe}from"./index-DPm6YMhX.js";import{_ as ie}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-BHRQ6gNL.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-DuaMpcNW.js";import{A as ae}from"./arrow-left-DAvFF-xx.js";import{C as ne}from"./circle-alert-BAiY2yAu.js";import{T as re}from"./target-9B9VxhTw.js";import{F as de}from"./filter-BCXII3Vj.js";import{S as me}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-DfKxWH3N.js";import{U as ue}from"./users-bMGn_vPW.js";import{S as fe}from"./save-DTwqsIAl.js";import"./index-9EknitmW.js";import"./floating-ui.vue-D_44iLrk.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-D6e-kB5n.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CphnuyJe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevron-right-C1p0_YAD.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Clw7uZZX.js";import"./chevrons-up-down-C6uCeRcr.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Cl6UTNVG.js";import"./tag-DOh8ybwv.js";import"./shield-CrMFR-sA.js";import"./vote-BNngkYIu.js";import"./folder-open-DzYKMiH4.js";import"./send-BGQbBVWn.js";import"./file-text-D-NxJb2x.js";import"./briefcase-CLa5E6pc.js";import"./calendar-C2mN7fi8.js";import"./megaphone-DB_W2_ij.js";import"./user-check-CENHsehh.js";import"./clipboard-list-CkSM2h9J.js";import"./mail-C9q7NsOX.js";import"./message-square-C_xQNDn7.js";import"./external-link-CoSv1yei.js";import"./panel-left-CtA1CDY4.js";import"./check-DAlbwhOo.js";import"./index-BPeLIox3.js";import"./index-DFpoRNc9.js";import"./index-_HrGOJG6.js";import"./VisuallyHidden-D42UHKy9.js";import"./nullish-CHIgUVhi.js";import"./VisuallyHiddenInput-Bwl-uNH5.js";import"./RovingFocusItem-DJ7qzBf4.js";import"./utils-DYqR3Zf-.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-D5C9pVNC.js";import"./x-Di3hRZd2.js";import"./DialogTrigger-BMAbB92C.js";import"./useKbd-kRIii9yh.js";import"./chevron-left-7Lb0TR5E.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-YQlb3DeH.js";import"./es-BDPlFIsO.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-TEZr8viT.js";import"./loader-circle-DMbkXxu9.js";import"./trash-2-DvIOqUt1.js";import"./plus-uXDWVO4e.js";import"./search-CjcS3wba.js";import"./history-C-2WoUJA.js";import"./index-yOcDiT7U.js";import"./user-DoEsQuJB.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CPkoHE-3.js";import"./map-pin-DH233x2C.js";const pe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ge={class:"flex items-center justify-between"},_e={class:"flex gap-2"},ce={class:"space-y-2"},ve={class:"space-y-2"},ye={class:"space-y-2"},be={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},$e={class:"flex items-center justify-between"},xe={class:"space-y-0.5"},Se={class:"flex items-center space-x-2"},Ce={class:"space-y-2"},Ve={class:"grid grid-cols-2 gap-2"},ke={class:"flex items-center px-3 py-2 bg-muted rounded-md"},we={class:"text-sm text-muted-foreground"},Fe={class:"grid grid-cols-2 gap-2 mt-2"},De={key:0,class:"space-y-3"},Ue={class:"flex-1"},he={class:"text-xs text-muted-foreground mt-1"},Ee={key:1,class:"text-center py-8 text-muted-foreground"},Le={class:"flex justify-end gap-4"},Yt=z({__name:"Edit",props:{segment:{},roles:{},filterFieldsConfig:{},modelTypes:{},selectedRoles:{}},setup(E){const m=E,L=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:"Editar Segmento",href:"#"}],n=j({name:m.segment.name,description:m.segment.description||"",model_type:m.segment.model_type,filters:m.segment.filters||{},is_dynamic:m.segment.is_dynamic,cache_duration:m.segment.cache_duration,role_ids:m.selectedRoles||[]}),N=G(null),R=a=>{const t=n.role_ids.indexOf(a);t>-1?n.role_ids.splice(t,1):n.role_ids.push(a)},A=a=>{n.filters=a},M=()=>{n.put(`/admin/segments/${m.segment.id}`,{preserveScroll:!0,onSuccess:()=>{}})},T=()=>{confirm(`¿Estás seguro de eliminar el segmento "${m.segment.name}"? Esta acción no se puede deshacer.`)&&W.delete(`/admin/segments/${m.segment.id}`)},q=a=>a<60?`${a} segundos`:a<3600?`${Math.floor(a/60)} minutos`:`${Math.floor(a/3600)} horas`,V=a=>a!=null&&a.last_calculated_at?new Date(a.last_calculated_at).toLocaleString():"Nunca";return(a,t)=>(g(),w(I,{breadcrumbs:L},{default:l(()=>[s(e(B),{title:"Editar Segmento"}),o("div",pe,[o("div",ge,[t[11]||(t[11]=o("div",null,[o("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Segmento"),o("p",{class:"text-muted-foreground"}," Modifica los filtros y configuración del segmento ")],-1)),o("div",_e,[s(e(f),{onClick:T,variant:"destructive",type:"button"},{default:l(()=>[...t[9]||(t[9]=[i(" Eliminar Segmento ",-1)])]),_:1}),s(e(F),{href:a.route("admin.segments.index")},{default:l(()=>[s(e(f),{variant:"outline"},{default:l(()=>[s(e(ae),{class:"mr-2 h-4 w-4"}),t[10]||(t[10]=i(" Volver ",-1))]),_:1})]),_:1},8,["href"])])]),s(e(le),null,{default:l(()=>[s(e(ne),{class:"h-4 w-4"}),s(e(oe),null,{default:l(()=>{var r;return[i(" Este segmento tiene "+d(((r=a.segment.metadata)==null?void 0:r.contacts_count)||0)+" usuarios. Última evaluación: "+d(V(a.segment.metadata)),1)]}),_:1})]),_:1}),o("form",{onSubmit:P(M,["prevent"]),class:"space-y-6"},[s(e(te),{defaultValue:"general",class:"space-y-4"},{default:l(()=>[s(e(se),{class:"grid w-full grid-cols-4"},{default:l(()=>[s(e(S),{value:"general"},{default:l(()=>[s(e(re),{class:"mr-2 h-4 w-4"}),t[12]||(t[12]=i(" General ",-1))]),_:1}),s(e(S),{value:"filters"},{default:l(()=>[s(e(de),{class:"mr-2 h-4 w-4"}),t[13]||(t[13]=i(" Filtros ",-1))]),_:1}),s(e(S),{value:"settings"},{default:l(()=>[s(e(me),{class:"mr-2 h-4 w-4"}),t[14]||(t[14]=i(" Configuración ",-1))]),_:1}),s(e(S),{value:"roles"},{default:l(()=>[s(e(ue),{class:"mr-2 h-4 w-4"}),t[15]||(t[15]=i(" Roles ",-1))]),_:1})]),_:1}),s(e(C),{value:"general"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[16]||(t[16]=[i("Información General",-1)])]),_:1}),s(e(x),null,{default:l(()=>[...t[17]||(t[17]=[i(" Define el nombre y descripción del segmento ",-1)])]),_:1})]),_:1}),s(e($),{class:"space-y-4"},{default:l(()=>{var r;return[o("div",ce,[s(e(p),{htmlFor:"name"},{default:l(()=>[...t[18]||(t[18]=[i("Nombre del Segmento",-1)])]),_:1}),s(e(h),{id:"name",modelValue:e(n).name,"onUpdate:modelValue":t[0]||(t[0]=u=>e(n).name=u),placeholder:"Usuarios por Región Norte"},null,8,["modelValue"]),s(_,{message:e(n).errors.name},null,8,["message"])]),o("div",ve,[s(e(p),{htmlFor:"description"},{default:l(()=>[...t[19]||(t[19]=[i("Descripción",-1)])]),_:1}),s(e(O),{id:"description",modelValue:e(n).description,"onUpdate:modelValue":t[1]||(t[1]=u=>e(n).description=u),placeholder:"Describe el propósito y criterios de este segmento...",rows:"4"},null,8,["modelValue"]),s(_,{message:e(n).errors.description},null,8,["message"])]),o("div",ye,[s(e(p),{htmlFor:"model_type"},{default:l(()=>[...t[20]||(t[20]=[i("Tipo de Modelo",-1)])]),_:1}),s(e(Q),{modelValue:e(n).model_type,"onUpdate:modelValue":t[2]||(t[2]=u=>e(n).model_type=u)},{default:l(()=>[s(e(H),null,{default:l(()=>[s(e(J),{placeholder:"Selecciona el tipo de modelo"})]),_:1}),s(e(K),null,{default:l(()=>[(g(!0),c(D,null,U(a.modelTypes,(u,k)=>(g(),w(e(X),{key:k,value:k},{default:l(()=>[i(d(u),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),t[21]||(t[21]=o("p",{class:"text-xs text-muted-foreground"}," Selecciona el modelo de datos sobre el que aplicar el segmento ",-1)),s(_,{message:e(n).errors.model_type},null,8,["message"])]),o("div",be,[o("p",null,"ID del Segmento: "+d(a.segment.id),1),o("p",null,"Usuarios actuales: "+d(((r=a.segment.metadata)==null?void 0:r.contacts_count)||0),1),o("p",null,"Creado: "+d(new Date(a.segment.created_at).toLocaleDateString()),1),o("p",null,"Última actualización: "+d(new Date(a.segment.updated_at).toLocaleDateString()),1),o("p",null,"Última evaluación: "+d(V(a.segment.metadata)),1)])]}),_:1})]),_:1})]),_:1}),s(e(C),{value:"filters"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[22]||(t[22]=[i("Criterios de Filtrado",-1)])]),_:1}),s(e(x),null,{default:l(()=>[...t[23]||(t[23]=[i(" Modifica los filtros que determinan qué usuarios pertenecen a este segmento ",-1)])]),_:1})]),_:1}),s(e($),null,{default:l(()=>{var r;return[s(ie,{ref_key:"advancedFiltersRef",ref:N,config:{fields:a.filterFieldsConfig,showQuickSearch:!1},route:"",initialFilters:(r=a.segment.filters)!=null&&r.advanced_filters?{rootGroup:a.segment.filters.advanced_filters}:void 0,onApply:A},null,8,["config","initialFilters"]),s(_,{message:e(n).errors.filters},null,8,["message"]),t[24]||(t[24]=o("div",{class:"mt-4 p-4 bg-muted/50 rounded-lg"},[o("p",{class:"text-sm text-muted-foreground"},[o("strong",null,"Nota:"),i(" Los cambios en los filtros actualizarán automáticamente el segmento y recalcularán los usuarios que pertenecen a él. ")])],-1))]}),_:1})]),_:1})]),_:1}),s(e(C),{value:"settings"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[25]||(t[25]=[i("Configuración del Segmento",-1)])]),_:1}),s(e(x),null,{default:l(()=>[...t[26]||(t[26]=[i(" Ajusta el comportamiento y cache del segmento ",-1)])]),_:1})]),_:1}),s(e($),{class:"space-y-6"},{default:l(()=>[o("div",$e,[o("div",xe,[s(e(p),null,{default:l(()=>[...t[27]||(t[27]=[i("Tipo de Segmento",-1)])]),_:1}),t[28]||(t[28]=o("p",{class:"text-sm text-muted-foreground"}," Los segmentos dinámicos se recalculan en tiempo real ",-1))]),o("div",Se,[s(e(p),{htmlFor:"is_dynamic",class:"text-sm"},{default:l(()=>[...t[29]||(t[29]=[i("Dinámico",-1)])]),_:1}),s(e(Y),{id:"is_dynamic",modelValue:e(n).is_dynamic,"onUpdate:modelValue":t[3]||(t[3]=r=>e(n).is_dynamic=r)},null,8,["modelValue"])])]),o("div",Ce,[s(e(p),{htmlFor:"cache_duration"},{default:l(()=>[...t[30]||(t[30]=[i("Duración del Cache (segundos)",-1)])]),_:1}),o("div",Ve,[s(e(h),{id:"cache_duration",modelValue:e(n).cache_duration,"onUpdate:modelValue":t[4]||(t[4]=r=>e(n).cache_duration=r),modelModifiers:{number:!0},type:"number",min:"0",max:"86400"},null,8,["modelValue"]),o("div",ke,[o("span",we,d(q(e(n).cache_duration)),1)])]),t[31]||(t[31]=o("p",{class:"text-xs text-muted-foreground"}," Tiempo que se mantendrán en cache los resultados del segmento (0 = sin cache) ",-1)),s(_,{message:e(n).errors.cache_duration},null,8,["message"])]),o("div",null,[s(e(p),{class:"text-sm font-medium"},{default:l(()=>[...t[32]||(t[32]=[i("Valores Predefinidos",-1)])]),_:1}),o("div",Fe,[s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[5]||(t[5]=r=>e(n).cache_duration=60)},{default:l(()=>[...t[33]||(t[33]=[i(" 1 minuto ",-1)])]),_:1}),s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[6]||(t[6]=r=>e(n).cache_duration=300)},{default:l(()=>[...t[34]||(t[34]=[i(" 5 minutos ",-1)])]),_:1}),s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[7]||(t[7]=r=>e(n).cache_duration=1800)},{default:l(()=>[...t[35]||(t[35]=[i(" 30 minutos ",-1)])]),_:1}),s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[8]||(t[8]=r=>e(n).cache_duration=3600)},{default:l(()=>[...t[36]||(t[36]=[i(" 1 hora ",-1)])]),_:1})])])]),_:1})]),_:1})]),_:1}),s(e(C),{value:"roles"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[37]||(t[37]=[i("Roles Asociados",-1)])]),_:1}),s(e(x),null,{default:l(()=>[...t[38]||(t[38]=[i(" Vincula este segmento con roles específicos para delimitar el alcance de datos ",-1)])]),_:1})]),_:1}),s(e($),null,{default:l(()=>[a.roles.length>0?(g(),c("div",De,[(g(!0),c(D,null,U(a.roles,r=>(g(),c("div",{key:r.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[s(e(Z),{checked:e(n).role_ids.includes(r.id),"onUpdate:checked":u=>R(r.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),o("div",Ue,[s(e(p),{class:"text-sm font-medium cursor-pointer"},{default:l(()=>[i(d(r.display_name),1)]),_:2},1024),o("p",he,d(r.description||"Sin descripción"),1),s(e(ee),{variant:"outline",class:"mt-2"},{default:l(()=>[i(d(r.name),1)]),_:2},1024)])]))),128))])):(g(),c("div",Ee," No hay roles disponibles ")),s(_,{message:e(n).errors.role_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),o("div",Le,[s(e(F),{href:a.route("admin.segments.index")},{default:l(()=>[s(e(f),{type:"button",variant:"outline"},{default:l(()=>[...t[39]||(t[39]=[i(" Cancelar ",-1)])]),_:1})]),_:1},8,["href"]),s(e(f),{type:"submit",disabled:e(n).processing},{default:l(()=>[s(e(fe),{class:"mr-2 h-4 w-4"}),i(" "+d(e(n).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{Yt as default};
