import{d as A,u as U,r as C,c as S,b as k,m as p,w as r,e as s,f as t,q as L,g as l,j as v,i as _,h as u,t as f,l as T,F as I,k as G}from"./app-Tc5FcPos.js";import{_ as O}from"./GeographicSelector.vue_vue_type_script_setup_true_lang-BxXxORQ8.js";import{_ as J,a as K}from"./Layout.vue_vue_type_script_setup_true_lang-pMEd8zw8.js";import{_ as b}from"./InputError.vue_vue_type_script_setup_true_lang-x4tlCNuC.js";import{_ as h,a as q}from"./index-8c7eQXgs.js";import{_ as $}from"./AlertTitle.vue_vue_type_script_setup_true_lang-iNGW6R73.js";import{_ as y}from"./createLucideIcon-H6zLNTbI.js";import{_ as H,a as Q,b as W,c as X}from"./CardTitle.vue_vue_type_script_setup_true_lang-BMrN_h_j.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-INVWSEmQ.js";import{_ as w}from"./Label.vue_vue_type_script_setup_true_lang-BZ0oMeu3.js";import{_ as Y}from"./UserLayout.vue_vue_type_script_setup_true_lang-DjkFSG07.js";import{t as g}from"./index-Diz7G8K9.js";import{M as Z}from"./map-pin-BlDRspux.js";import{C as ee}from"./clock-DuU2ihnB.js";import{M as te}from"./mail-CrUveOYG.js";import{P as se}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-_ZjZfSfF.js";import{F as oe}from"./file-text-CnRiRvkf.js";import{C as M}from"./circle-alert-AjGR6gnE.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-DkcNq_01.js";import"./VisuallyHidden-CXQrF-Ui.js";import"./index-BkyXZ5PZ.js";import"./check-Bpn9XuIe.js";import"./floating-ui.vue-BG3fS9ma.js";import"./Separator.vue_vue_type_script_setup_true_lang-Bp9iICng.js";import"./index-DNeKSjmC.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Dk6p9glA.js";import"./index-CKthGIYI.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BfWiD7tz.js";import"./usePermissions-eRmpAsO2.js";import"./square-check-big-C0NnZTt_.js";import"./user-BlnlQS9T.js";import"./users-Jlbe-ZJc.js";import"./folder-open-BZYYPaTW.js";import"./index-8LKY-cbr.js";import"./x-CVNMc2LC.js";import"./shield-CCpXm5HU.js";import"./chevron-right-DvYMqVHa.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BesWdtCP.js";const ie={class:"flex flex-col space-y-6"},ae={class:"text-sm text-muted-foreground"},le={key:0,class:"mt-2"},re={key:1,class:"mt-2"},ne={key:2,class:"mt-2"},de={class:"mt-1 text-xs opacity-80"},ue={class:"space-y-4"},me={class:"text-sm text-muted-foreground mt-1"},ce={class:"text-sm text-muted-foreground mt-1"},pe={key:0,class:"mb-3 space-y-2"},fe={class:"flex items-center gap-2"},ge={class:"text-sm"},_e={class:"text-xs text-gray-500"},be=["disabled"],ve={class:"flex items-center gap-4"},xe={key:0,class:"text-sm text-muted-foreground"},at=A({__name:"UpdateData",props:{user:{},hasPendingRequest:{type:Boolean},pendingRequest:{}},setup(c){const a=c,D=[{title:"Configuración",href:"/settings/profile"},{title:"Actualización de Datos",href:"/settings/update-data"}],o=U({email:a.user.email||"",telefono:a.user.telefono||"",territorio_id:a.user.territorio_id||void 0,departamento_id:a.user.departamento_id||void 0,municipio_id:a.user.municipio_id||void 0,localidad_id:a.user.localidad_id||void 0,documentos:[]}),x=C(null),m=C([]),N=S(()=>{var e,n,d;const i=[];return(e=a.user.departamento)!=null&&e.nombre&&i.push(a.user.departamento.nombre),(n=a.user.municipio)!=null&&n.nombre&&i.push(a.user.municipio.nombre),(d=a.user.localidad)!=null&&d.nombre&&i.push(a.user.localidad.nombre),i.length>0?i.join(", "):"No definida"}),R=S(()=>{var e,n,d;if(!a.pendingRequest)return"";const i=[];return(e=a.pendingRequest.new_departamento)!=null&&e.nombre&&i.push(a.pendingRequest.new_departamento.nombre),(n=a.pendingRequest.new_municipio)!=null&&n.nombre&&i.push(a.pendingRequest.new_municipio.nombre),(d=a.pendingRequest.new_localidad)!=null&&d.nombre&&i.push(a.pendingRequest.new_localidad.nombre),i.length>0?i.join(", "):"No definida"}),E=i=>{o.territorio_id=i.territorio_id,o.departamento_id=i.departamento_id,o.municipio_id=i.municipio_id,o.localidad_id=i.localidad_id},B=i=>{const e=i.target;if(e.files){const n=Array.from(e.files);if(m.value.length+n.length>3){g.error("Puedes subir máximo 3 documentos");return}for(const d of n)if(d.size>5*1024*1024){g.error(`El archivo ${d.name} supera los 5MB permitidos`);return}m.value=[...m.value,...n],o.documentos=m.value}},F=i=>{m.value.splice(i,1),o.documentos=m.value},P=()=>{if(m.value.length===0){g.error("Debes adjuntar al menos un documento de soporte");return}if(!(o.email!==a.user.email||o.telefono!==a.user.telefono||o.territorio_id!==a.user.territorio_id||o.departamento_id!==a.user.departamento_id||o.municipio_id!==a.user.municipio_id||o.localidad_id!==a.user.localidad_id)){g.error("Debes realizar al menos un cambio en tus datos");return}o.post(route("update-data.update"),{preserveScroll:!0,onSuccess:()=>{g.success("Solicitud enviada correctamente"),m.value=[],x.value&&(x.value.value="")},onError:e=>{e.error?g.error(e.error):g.error("Error al enviar la solicitud")}})},V=()=>{confirm("¿Estás seguro de que deseas cancelar tu solicitud de actualización de datos?")&&o.delete(route("update-data.cancel"),{preserveScroll:!0,onSuccess:()=>{g.success("Solicitud cancelada exitosamente")},onError:()=>{g.error("Error al cancelar la solicitud")}})},j=i=>{if(i===0)return"0 Bytes";const e=1024,n=["Bytes","KB","MB"],d=Math.floor(Math.log(i)/Math.log(e));return Math.round(i/Math.pow(e,d)*100)/100+" "+n[d]};return(i,e)=>(p(),k(Y,{breadcrumbs:D},{default:r(()=>[s(t(L),{title:"Actualización de Datos"}),s(J,null,{default:r(()=>[l("div",ie,[s(K,{title:"Actualización de Datos",description:"Solicita una actualización de tus datos personales. La solicitud será revisada por un administrador."}),s(t(H),null,{default:r(()=>[s(t(Q),null,{default:r(()=>[s(t(W),{class:"text-base flex items-center gap-2"},{default:r(()=>[s(t(Z),{class:"h-4 w-4"}),e[3]||(e[3]=u(" Ubicación Actual ",-1))]),_:1})]),_:1}),s(t(X),null,{default:r(()=>[l("p",ae,f(N.value),1)]),_:1})]),_:1}),c.hasPendingRequest&&c.pendingRequest?(p(),k(t(h),{key:0,class:"border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-950/50"},{default:r(()=>[s(t(ee),{class:"h-4 w-4 text-yellow-600 dark:text-yellow-500"}),s(t($),{class:"text-yellow-800 dark:text-yellow-200"},{default:r(()=>[...e[4]||(e[4]=[u("Solicitud Pendiente",-1)])]),_:1}),s(t(q),{class:"text-yellow-700 dark:text-yellow-300"},{default:r(()=>[e[9]||(e[9]=l("p",null,"Tienes una solicitud de actualización de datos pendiente de aprobación.",-1)),c.pendingRequest.new_email?(p(),_("p",le,[e[5]||(e[5]=l("strong",null,"Nuevo email:",-1)),u(" "+f(c.pendingRequest.new_email),1)])):v("",!0),c.pendingRequest.new_telefono?(p(),_("p",re,[e[6]||(e[6]=l("strong",null,"Nuevo teléfono:",-1)),u(" "+f(c.pendingRequest.new_telefono),1)])):v("",!0),R.value?(p(),_("p",ne,[e[7]||(e[7]=l("strong",null,"Nueva ubicación:",-1)),u(" "+f(R.value),1)])):v("",!0),l("p",de," Enviada el: "+f(new Date(c.pendingRequest.created_at).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})),1),s(t(y),{onClick:V,variant:"outline",size:"sm",class:"mt-3 border-yellow-600 dark:border-yellow-500 text-yellow-700 dark:text-yellow-300 hover:bg-yellow-100 dark:hover:bg-yellow-900/30",disabled:t(o).processing},{default:r(()=>[...e[8]||(e[8]=[u(" Cancelar Solicitud ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})):v("",!0),c.hasPendingRequest?(p(),k(t(h),{key:2,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/50"},{default:r(()=>[s(t(M),{class:"h-4 w-4 text-blue-600 dark:text-blue-400"}),s(t(q),{class:"text-blue-700 dark:text-blue-300"},{default:r(()=>[...e[20]||(e[20]=[u(" No puedes crear una nueva solicitud mientras tengas una pendiente de aprobación. ",-1)])]),_:1})]),_:1})):(p(),_("form",{key:1,onSubmit:T(P,["prevent"]),class:"space-y-6"},[l("div",ue,[l("div",null,[s(t(w),{class:"text-base mb-1 block flex items-center gap-2"},{default:r(()=>[s(t(te),{class:"h-4 w-4"}),e[10]||(e[10]=u(" Correo Electrónico ",-1))]),_:1}),s(t(z),{type:"email",modelValue:t(o).email,"onUpdate:modelValue":e[0]||(e[0]=n=>t(o).email=n),placeholder:"ejemplo@correo.com",disabled:t(o).processing,class:"w-full"},null,8,["modelValue","disabled"]),l("p",me,"Actual: "+f(c.user.email),1),s(b,{class:"mt-2",message:t(o).errors.email},null,8,["message"])]),l("div",null,[s(t(w),{class:"text-base mb-1 block flex items-center gap-2"},{default:r(()=>[s(t(se),{class:"h-4 w-4"}),e[11]||(e[11]=u(" Teléfono ",-1))]),_:1}),s(t(z),{type:"tel",modelValue:t(o).telefono,"onUpdate:modelValue":e[1]||(e[1]=n=>t(o).telefono=n),placeholder:"+57 300 1234567",disabled:t(o).processing,class:"w-full"},null,8,["modelValue","disabled"]),l("p",ce,"Actual: "+f(c.user.telefono||"No registrado"),1),s(b,{class:"mt-2",message:t(o).errors.telefono},null,8,["message"])])]),l("div",null,[s(t(w),{class:"text-base mb-3 block"},{default:r(()=>[...e[12]||(e[12]=[u("Nueva Ubicación de Residencia",-1)])]),_:1}),s(O,{"model-value":{territorio_id:t(o).territorio_id,departamento_id:t(o).departamento_id,municipio_id:t(o).municipio_id,localidad_id:t(o).localidad_id},"onUpdate:modelValue":E,mode:"single","show-card":!1,disabled:t(o).processing},null,8,["model-value","disabled"]),s(b,{class:"mt-2",message:t(o).errors.territorio_id},null,8,["message"]),s(b,{class:"mt-2",message:t(o).errors.departamento_id},null,8,["message"]),s(b,{class:"mt-2",message:t(o).errors.municipio_id},null,8,["message"]),s(b,{class:"mt-2",message:t(o).errors.localidad_id},null,8,["message"])]),l("div",null,[s(t(w),{class:"text-base mb-1 block"},{default:r(()=>[...e[13]||(e[13]=[u(" Documentos de Soporte (Obligatorio) ",-1)])]),_:1}),e[16]||(e[16]=l("p",{class:"text-sm text-muted-foreground mb-3"}," Debes adjuntar al menos 1 documento que respalde tu solicitud (máximo 3). Formatos: PDF, JPG, PNG - Máx 5MB c/u ",-1)),m.value.length>0?(p(),_("div",pe,[(p(!0),_(I,null,G(m.value,(n,d)=>(p(),_("div",{key:d,class:"flex items-center justify-between p-2 bg-gray-50 rounded-lg"},[l("div",fe,[s(t(oe),{class:"h-4 w-4 text-gray-500"}),l("span",ge,f(n.name),1),l("span",_e,"("+f(j(n.size))+")",1)]),s(t(y),{onClick:ye=>F(d),variant:"ghost",size:"sm",type:"button"},{default:r(()=>[...e[14]||(e[14]=[u(" Eliminar ",-1)])]),_:1},8,["onClick"])]))),128))])):v("",!0),l("input",{ref_key:"fileInput",ref:x,type:"file",onChange:B,accept:".pdf,.jpg,.jpeg,.png",multiple:"",class:"hidden",disabled:t(o).processing||m.value.length>=3},null,40,be),s(t(y),{onClick:e[2]||(e[2]=n=>{var d;return(d=x.value)==null?void 0:d.click()}),variant:"outline",type:"button",disabled:t(o).processing||m.value.length>=3},{default:r(()=>[...e[15]||(e[15]=[u(" Seleccionar Documentos ",-1)])]),_:1},8,["disabled"]),s(b,{class:"mt-2",message:t(o).errors.documentos},null,8,["message"])]),s(t(h),null,{default:r(()=>[s(t(M),{class:"h-4 w-4"}),s(t($),null,{default:r(()=>[...e[17]||(e[17]=[u("Información Importante",-1)])]),_:1}),s(t(q),null,{default:r(()=>[...e[18]||(e[18]=[l("ul",{class:"list-disc list-inside space-y-1 mt-2"},[l("li",null,"Tu solicitud será revisada por un administrador"),l("li",null,"Recibirás una notificación por correo cuando sea procesada"),l("li",null,"Los cambios no se aplicarán hasta que sean aprobados"),l("li",null,"Solo puedes tener una solicitud pendiente a la vez")],-1)])]),_:1})]),_:1}),l("div",ve,[s(t(y),{type:"submit",disabled:t(o).processing||m.value.length===0},{default:r(()=>[...e[19]||(e[19]=[u(" Enviar Solicitud ",-1)])]),_:1},8,["disabled"]),t(o).processing?(p(),_("span",xe," Enviando solicitud... ")):v("",!0)])],32))])]),_:1})]),_:1}))}});export{at as default};
