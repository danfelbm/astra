import{r,p as y,c as z}from"./app-0nVG3A7n.js";function J(U={}){const{prefix:e="",initialValues:o={},onChange:j,includeTerritorio:n=!0,includeDepartamento:t=!0,includeMunicipio:l=!0,includeLocalidad:p=!0,endpoints:m={}}=U,a=r({territorio_id:o.territorio_id||null,departamento_id:o.departamento_id||null,municipio_id:o.municipio_id||null,localidad_id:o.localidad_id||null}),b=r([]),_=r([]),f=r([]),v=r([]),C=r(!1),T=r(!1),D=r(!1),P=r(!1),E=r({}),{route:h}=window,d={territorios:m.territorios||h("admin.geographic.territorios"),departamentos:m.departamentos||h("admin.geographic.departamentos"),municipios:m.municipios||h("admin.geographic.municipios"),localidades:m.localidades||h("admin.geographic.localidades")},g=async(i,c={},x,A,L)=>{A.value=!0,E.value[L]="";try{const s=new URL(i);Object.entries(c).forEach(([u,S])=>{S!=null&&s.searchParams.append(u,String(S))});const $=await fetch(s.toString(),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!$.ok)throw new Error(`Error ${$.status}: ${$.statusText}`);const F=await $.json(),q=(Array.isArray(F)?F:F.data||[]).map(u=>({value:u.id,label:u.nombre||u.name,disabled:u.disabled||!1}));return x.value=q,q}catch(s){return console.error(`Error cargando ${L}:`,s),E.value[L]=s instanceof Error?s.message:"Error desconocido",x.value=[],[]}finally{A.value=!1}},V=async()=>{n&&await g(d.territorios,{},b,C,"territorios")},w=async i=>{if(!t)return;if(n&&!i){_.value=[],a.value.departamento_id=null;return}const c=n&&i?{territorio_ids:i}:{};await g(d.departamentos,c,_,T,"departamentos")},M=async i=>{if(!l)return;if(t&&!i){f.value=[],a.value.municipio_id=null;return}const c=t&&i?{departamento_ids:i}:{};await g(d.municipios,c,f,D,"municipios")},O=async i=>{if(!p)return;if(l&&!i){v.value=[],a.value.localidad_id=null;return}const c=l&&i?{municipio_ids:i}:{};await g(d.localidades,c,v,P,"localidades")};y(()=>a.value.territorio_id,i=>{t&&(a.value.departamento_id=null,a.value.municipio_id=null,a.value.localidad_id=null),w(i)}),y(()=>a.value.departamento_id,i=>{l&&(a.value.municipio_id=null,a.value.localidad_id=null),M(i)}),y(()=>a.value.municipio_id,i=>{p&&(a.value.localidad_id=null),O(i)}),y(a,i=>{j&&j(i)},{deep:!0});const X=()=>{const i=[];return n&&i.push({name:`${e}territorio_id`,label:"Territorio",type:"select-cascade",placeholder:"Seleccionar territorio...",cascadeEndpoint:d.territorios,cascadeChildren:t?[`${e}departamento_id`]:[],options:b.value,loadOnMount:!0}),t&&i.push({name:`${e}departamento_id`,label:"Departamento",type:"select-cascade",placeholder:"Seleccionar departamento...",cascadeFrom:n?`${e}territorio_id`:void 0,cascadeEndpoint:d.departamentos,cascadeParam:"territorio_ids",cascadeChildren:l?[`${e}municipio_id`]:[],options:_.value,loadOnMount:!n}),l&&i.push({name:`${e}municipio_id`,label:"Municipio",type:"select-cascade",placeholder:"Seleccionar municipio...",cascadeFrom:t?`${e}departamento_id`:void 0,cascadeEndpoint:d.municipios,cascadeParam:"departamento_ids",cascadeChildren:p?[`${e}localidad_id`]:[],options:f.value,loadOnMount:!t}),p&&i.push({name:`${e}localidad_id`,label:"Localidad",type:"select-cascade",placeholder:"Seleccionar localidad...",cascadeFrom:l?`${e}municipio_id`:void 0,cascadeEndpoint:d.localidades,cascadeParam:"municipio_ids",cascadeChildren:[],options:v.value,loadOnMount:!l}),i},k=()=>{a.value={territorio_id:null,departamento_id:null,municipio_id:null,localidad_id:null}},G=i=>{Object.assign(a.value,i)},H=z(()=>Object.values(a.value).some(i=>i!=null)),R=z(()=>a.value.localidad_id?"localidad":a.value.municipio_id?"municipio":a.value.departamento_id?"departamento":a.value.territorio_id?"territorio":null);return{values:a,territorios:b,departamentos:_,municipios:f,localidades:v,loadingTerritorios:C,loadingDepartamentos:T,loadingMunicipios:D,loadingLocalidades:P,errors:E,loadTerritorios:V,loadDepartamentos:w,loadMunicipios:M,loadLocalidades:O,generateFilterFields:X,clearValues:k,setValues:G,initialize:async()=>{n&&await V(),!n&&t&&await w(),o.territorio_id&&n&&await w(o.territorio_id),o.departamento_id&&t&&await M(o.departamento_id),o.municipio_id&&l&&await O(o.municipio_id)},hasValues:H,selectedLevel:R}}export{J as u};
