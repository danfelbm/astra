import{_ as G}from"./createLucideIcon-DVREvg6J.js";import{_ as R}from"./index-ByRNdMTg.js";import{_ as ee}from"./Label.vue_vue_type_script_setup_true_lang-BjkfVnrt.js";import{_ as te}from"./Input.vue_vue_type_script_setup_true_lang-BGVUfrGL.js";import{_ as ae,a as se,b as le}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-C1E7z6vo.js";import{_ as oe,a as ne,b as M,c as j}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DsrarvIS.js";import{_ as ie,a as re,c as ue,b as de,e as ce,d as me}from"./index-CKmNBLyf.js";import{u as fe}from"./useEtiquetaHierarchy-Cq8kPWpQ.js";import{d as X,c as k,I as pe,i as d,g,j as f,e as n,b as v,l as ge,f as a,n as N,h,t as c,w as u,y as ve,F as $,k as V,m as s,r as C,p as Q,x as Z}from"./app-DMuAIQna.js";import{C as he}from"./chevron-right-B7cHhwdw.js";import{C as J}from"./check-CX6SjPsT.js";import{C as xe}from"./chevrons-up-down-M6ErZWBp.js";import{L as _e}from"./list-C5NGbLN7.js";import{T as be}from"./tree-pine-k_QMuDz2.js";import{P as ye}from"./plus-RVQXooLS.js";import{X as ke}from"./x-BIajvu4a.js";import{G as qe,B as we,P as Ee,Z as Ce,H as $e,S as Ve,a as Se}from"./zap-BA98SX1Q.js";import{L as Te}from"./layers-Dt5UIZ9R.js";import{F as Ie,T as z}from"./tag-BYDdDIVk.js";import{T as Be}from"./trending-up-Lrw8nYgT.js";import{A as Le}from"./award-Dr-7DhCo.js";import{T as Fe}from"./target-C2393p27.js";import{F as Ne}from"./flag-CpsMKP1n.js";import{H as Ue}from"./hash-WSFjPg4R.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const He={key:1,class:"w-4"},Pe={class:"flex-1 text-sm"},De={key:0,class:"text-xs text-muted-foreground ml-1"},Ge={key:0},Me=X({__name:"EtiquetaSelectorTreeItem",props:{etiqueta:{},nivel:{default:0},selectedIds:{},expandidos:{},isSelectable:{}},emits:["toggle-expand","toggle-select"],setup(i,{emit:B}){const l=i,q=B,p=k(()=>l.expandidos.has(l.etiqueta.id)),m=k(()=>l.selectedIds.includes(l.etiqueta.id)),_=k(()=>l.etiqueta.children&&l.etiqueta.children.length>0),w=()=>{q("toggle-expand",l.etiqueta.id)},S=()=>{l.isSelectable(l.etiqueta)&&q("toggle-select",l.etiqueta)};return(x,b)=>{const L=pe("EtiquetaSelectorTreeItem",!0);return s(),d("div",null,[g("div",{class:"flex items-center gap-1 py-1 px-2 hover:bg-accent rounded cursor-pointer select-none",style:ve({paddingLeft:i.nivel*20+8+"px"}),onClick:S},[_.value?(s(),d("button",{key:0,onClick:ge(w,["stop"]),class:"p-0.5 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",type:"button"},[n(a(he),{class:N(["h-3 w-3 transition-transform",p.value?"rotate-90":""])},null,8,["class"])])):(s(),d("span",He)),n(a(J),{class:N(["h-4 w-4 flex-shrink-0",m.value?"opacity-100":"opacity-0"])},null,8,["class"]),g("span",Pe,[h(c(i.etiqueta.nombre)+" ",1),i.etiqueta.categoria?(s(),d("span",De," ("+c(i.etiqueta.categoria.nombre)+") ",1)):f("",!0)]),i.etiqueta.usos_count>0?(s(),v(a(R),{key:2,variant:"secondary",class:"text-xs"},{default:u(()=>[h(c(i.etiqueta.usos_count),1)]),_:1})):f("",!0)],4),p.value&&_.value?(s(),d("div",Ge,[(s(!0),d($,null,V(i.etiqueta.children,T=>(s(),v(L,{key:T.id,etiqueta:T,nivel:i.nivel+1,"selected-ids":i.selectedIds,expandidos:i.expandidos,"is-selectable":i.isSelectable,onToggleExpand:b[0]||(b[0]=E=>x.$emit("toggle-expand",E)),onToggleSelect:b[1]||(b[1]=E=>x.$emit("toggle-select",E))},null,8,["etiqueta","nivel","selected-ids","expandidos","is-selectable"]))),128))])):f("",!0)])}}}),je={class:"space-y-2"},Qe={key:0,class:"flex justify-between items-center"},Ze={class:"text-xs text-muted-foreground"},ze={class:"text-left truncate"},Re={class:"border-b px-3 pt-3"},Xe={class:"p-2 text-sm"},Je={key:1,class:"text-xs text-muted-foreground ml-1"},Ke={key:2,class:"ml-auto text-xs text-muted-foreground"},Oe={class:"p-2"},We={class:"max-h-[300px] overflow-y-auto border rounded-lg p-2"},Ye={key:0,class:"p-4 text-center text-sm text-muted-foreground"},et={key:1},tt={key:1,class:"flex flex-wrap gap-1.5"},at=["onClick","disabled"],st={key:2,class:"text-sm text-muted-foreground"},lt=X({__name:"EtiquetaSelector",props:{modelValue:{},categorias:{},maxEtiquetas:{default:10},placeholder:{default:"Seleccionar etiquetas..."},disabled:{type:Boolean,default:!1},allowCreate:{type:Boolean,default:!1},label:{default:""},description:{default:""}},emits:["update:modelValue","create"],setup(i,{emit:B}){const l=i,q=B,p=C(!1),m=C(""),_=C(""),w=C("list"),S=`etiqueta-selector-${Math.random().toString(36).substr(2,9)}`,x=C([]),{expandidos:b,construirArbol:L,filtrarArbol:T,toggleExpansion:E}=fe(x),K=k(()=>{if(!m.value)return l.categorias;const o=m.value.toLowerCase();return l.categorias.map(e=>{var t;return{...e,etiquetas:((t=e.etiquetas)==null?void 0:t.filter(r=>{var I;return r.nombre.toLowerCase().includes(o)||((I=r.descripcion)==null?void 0:I.toLowerCase().includes(o))}))||[]}}).filter(e=>e.etiquetas.length>0)}),y=k(()=>{const o=[];return l.categorias.forEach(e=>{var t;(t=e.etiquetas)==null||t.forEach(r=>{l.modelValue.includes(r.id)&&o.push({...r,categoria:e})})}),o});function F(o){return l.modelValue.includes(o)}function U(o){return l.disabled?!1:F(o.id)?!0:l.modelValue.length<l.maxEtiquetas}function A(o){const e=o.id;let t=[...l.modelValue];if(F(e))t=t.filter(r=>r!==e);else if(t.length<l.maxEtiquetas)t.push(e);else return;q("update:modelValue",t)}function O(o){const e=l.modelValue.filter(t=>t!==o);q("update:modelValue",e)}function W(){var e;if(!l.allowCreate||!m.value)return;const o=(e=l.categorias[0])==null?void 0:e.id;o&&(q("create",m.value,o),m.value="",p.value=!1)}function H(o){return{Tag:z,Hash:Ue,Bookmark:Se,Flag:Ne,Star:Ve,Heart:$e,Zap:Ce,Target:Fe,Award:Le,TrendingUp:Be,Folder:Ie,Package:Ee,Box:we,Layers:Te,Grid:qe}[o]||z}const Y=k(()=>y.value.length===0?l.placeholder:y.value.length===1?y.value[0].nombre:`${y.value.length} etiquetas seleccionadas`),P=k(()=>_.value?T(_.value,x.value):x.value);Q(p,o=>{o&&w.value==="tree"&&D()}),Q(w,o=>{o==="tree"&&p.value&&D()});function D(){const o=[];l.categorias.forEach(e=>{e.etiquetas&&e.etiquetas.forEach(t=>{o.push({...t,categoria:e})})}),x.value=L(o),x.value.forEach(e=>{e.children&&e.children.length>0&&b.value.add(e.id)})}return(o,e)=>(s(),d("div",je,[i.label?(s(),d("div",Qe,[n(a(ee),{for:S},{default:u(()=>[h(c(i.label),1)]),_:1}),g("span",Ze,c(y.value.length)+" / "+c(i.maxEtiquetas)+" seleccionadas ",1)])):f("",!0),n(a(ae),{open:p.value,"onUpdate:open":e[3]||(e[3]=t=>p.value=t)},{default:u(()=>[n(a(se),{asChild:""},{default:u(()=>[n(a(G),{id:S,variant:"outline",role:"combobox","aria-expanded":p.value,disabled:i.disabled,class:"w-full justify-between"},{default:u(()=>[g("span",ze,c(Y.value),1),n(a(xe),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","disabled"])]),_:1}),n(a(le),{class:"w-full p-0",align:"start"},{default:u(()=>[n(a(oe),{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),class:"w-full"},{default:u(()=>[g("div",Re,[n(a(ne),{class:"grid w-full grid-cols-2"},{default:u(()=>[n(a(M),{value:"list"},{default:u(()=>[n(a(_e),{class:"h-4 w-4 mr-2"}),e[4]||(e[4]=h(" Lista ",-1))]),_:1}),n(a(M),{value:"tree"},{default:u(()=>[n(a(be),{class:"h-4 w-4 mr-2"}),e[5]||(e[5]=h(" Árbol ",-1))]),_:1})]),_:1})]),n(a(j),{value:"list",class:"mt-0"},{default:u(()=>[n(a(ie),null,{default:u(()=>[n(a(re),{placeholder:"Buscar etiqueta...",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t)},null,8,["modelValue"]),n(a(ue),null,{default:u(()=>[g("div",Xe,[e[6]||(e[6]=h(" No se encontraron etiquetas. ",-1)),i.allowCreate&&m.value.length>2?(s(),v(a(G),{key:0,onClick:W,variant:"ghost",size:"sm",class:"w-full mt-1"},{default:u(()=>[n(a(ye),{class:"mr-2 h-3 w-3"}),h(' Crear "'+c(m.value)+'" ',1)]),_:1})):f("",!0)])]),_:1}),n(a(de),null,{default:u(()=>[(s(!0),d($,null,V(K.value,t=>(s(),v(a(ce),{key:t.id,heading:t.nombre},{default:u(()=>[(s(!0),d($,null,V(t.etiquetas,r=>(s(),v(a(me),{key:r.id,value:r,onSelect:I=>A(r),disabled:!U(r),class:"cursor-pointer"},{default:u(()=>[n(a(J),{class:N(["mr-2 h-4 w-4",F(r.id)?"opacity-100":"opacity-0"])},null,8,["class"]),t.icono?(s(),v(Z(H(t.icono)),{key:0,class:"mr-2 h-3 w-3 opacity-60"})):f("",!0),h(" "+c(r.nombre)+" ",1),r.parent?(s(),d("span",Je," ("+c(r.parent.nombre)+") ",1)):f("",!0),r.descripcion?(s(),d("span",Ke,c(r.descripcion),1)):f("",!0)]),_:2},1032,["value","onSelect","disabled"]))),128))]),_:2},1032,["heading"]))),128))]),_:1})]),_:1})]),_:1}),n(a(j),{value:"tree",class:"mt-0"},{default:u(()=>[g("div",Oe,[n(a(te),{placeholder:"Buscar en árbol...",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),class:"mb-2"},null,8,["modelValue"]),g("div",We,[P.value.length===0?(s(),d("div",Ye," No se encontraron etiquetas ")):(s(),d("div",et,[(s(!0),d($,null,V(P.value,t=>(s(),v(Me,{key:t.id,etiqueta:t,nivel:0,"selected-ids":i.modelValue,expandidos:a(b),"is-selectable":U,onToggleExpand:a(E),onToggleSelect:A},null,8,["etiqueta","selected-ids","expandidos","onToggleExpand"]))),128))]))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["open"]),y.value.length>0?(s(),d("div",tt,[(s(!0),d($,null,V(y.value,t=>(s(),v(a(R),{key:t.id,variant:"secondary",class:"pr-1"},{default:u(()=>{var r;return[(r=t.categoria)!=null&&r.icono?(s(),v(Z(H(t.categoria.icono)),{key:0,class:"mr-1 h-3 w-3"})):f("",!0),h(" "+c(t.nombre)+" ",1),g("button",{onClick:I=>O(t.id),disabled:i.disabled,class:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[n(a(ke),{class:"h-3 w-3 hover:opacity-80"})],8,at)]}),_:2},1024))),128))])):f("",!0),i.description?(s(),d("p",st,c(i.description),1)):f("",!0)]))}}),Tt=Ae(lt,[["__scopeId","data-v-5b4760bd"]]);export{Tt as E};
