import{c as F,_ as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-DhL5ChM3.js";import{_ as k}from"./createLucideIcon-DgLLtpTc.js";import{_ as w}from"./Label.vue_vue_type_script_setup_true_lang-BFduy937.js";import{_ as R}from"./index-s_YMJFqv.js";import{_ as O}from"./Textarea.vue_vue_type_script_setup_true_lang-BLahoW9V.js";import{_ as Q,a as X,b as G,c as H,d as J,e as K}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CS3Y7RjP.js";import{_ as W,a as Y,b as Z,c as ee,d as ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-Bt0xndJV.js";import{_ as se,a as le,b as te,c as oe,e as ne,d as ue}from"./index-wZxNlukw.js";import{a as re,b as ie,_ as de}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CxYPgAQ2.js";import{C as ce}from"./chevrons-up-down-Co9lmALi.js";import{X as me}from"./x-arLKReWz.js";import{C as fe}from"./check-N9bkD0I5.js";import{d as L,r as V,c as x,m as T,i as m,e as r,j as $,f as s,w as l,h as v,t as i,u as e,g as u,F as A,k as z,b as C,n as pe}from"./app-CNcf-zdV.js";import{P as _e}from"./plus-B0xw1qKM.js";import{U as ve}from"./users-BCniY5Uo.js";import{S as ye}from"./square-pen-Def0jsxb.js";import{T as be}from"./trash-2-BaR4XxZx.js";const $e={class:"space-y-2"},ge={key:0},he={key:0,class:"text-sm text-muted-foreground"},ke={class:"text-left truncate"},Ve={class:"flex-1"},Ce={class:"font-medium"},we={class:"text-sm text-muted-foreground"},xe={key:1,class:"p-3 bg-muted rounded-lg space-y-1"},Ue={class:"flex justify-between items-start"},Pe={class:"flex-1"},Se={class:"font-medium"},Ne={class:"text-sm text-muted-foreground"},Be={key:2,class:"text-sm text-destructive"},Ae=L({__name:"ContratoUserSelect",props:{modelValue:{default:null},users:{default:()=>[]},label:{},placeholder:{default:"Seleccionar usuario..."},description:{},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},error:{}},emits:["update:modelValue","change"],setup(U,{emit:P}){const p=U,h=P,c=V(!1),f=V(""),y=`user-select-${Math.random().toString(36).substr(2,9)}`,d=x(()=>p.modelValue&&p.users.find(n=>n.id===p.modelValue)||null),g=x(()=>{var n;return((n=d.value)==null?void 0:n.name)||""}),S=x(()=>{if(!f.value)return p.users;const n=f.value.toLowerCase();return p.users.filter(b=>b.name.toLowerCase().includes(n)||b.email.toLowerCase().includes(n))});function N(n){h("update:modelValue",n.id),h("change",n),c.value=!1,f.value=""}function B(){h("update:modelValue",null),h("change",null)}return T(c,n=>{n||(f.value="")}),(n,b)=>(r(),m("div",$e,[n.label?(r(),m("div",ge,[s(e(w),{for:y},{default:l(()=>[v(i(n.label),1)]),_:1}),n.description?(r(),m("p",he,i(n.description),1)):$("",!0)])):$("",!0),s(e(de),{open:c.value,"onUpdate:open":b[1]||(b[1]=_=>c.value=_)},{default:l(()=>[s(e(re),{asChild:""},{default:l(()=>[s(e(k),{id:y,variant:"outline",role:"combobox","aria-expanded":c.value,disabled:n.disabled,class:"w-full justify-between"},{default:l(()=>[u("span",ke,i(g.value||n.placeholder),1),s(e(ce),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","disabled"])]),_:1}),s(e(ie),{class:"w-full p-0",align:"start"},{default:l(()=>[s(e(se),null,{default:l(()=>[s(e(le),{modelValue:f.value,"onUpdate:modelValue":b[0]||(b[0]=_=>f.value=_),placeholder:"Buscar usuario..."},null,8,["modelValue"]),s(e(te),null,{default:l(()=>[s(e(oe),null,{default:l(()=>[...b[2]||(b[2]=[v("No se encontraron usuarios",-1)])]),_:1}),s(e(ne),null,{default:l(()=>[(r(!0),m(A,null,z(S.value,_=>(r(),C(e(ue),{key:_.id,value:_,onSelect:q=>N(_),class:"cursor-pointer"},{default:l(()=>[s(e(fe),{class:pe(["mr-2 h-4 w-4",n.modelValue===_.id?"opacity-100":"opacity-0"])},null,8,["class"]),u("div",Ve,[u("div",Ce,i(_.name),1),u("div",we,i(_.email),1)])]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),d.value?(r(),m("div",xe,[u("div",Ue,[u("div",Pe,[u("p",Se,i(d.value.name),1),u("p",Ne,i(d.value.email),1)]),n.required?$("",!0):(r(),C(e(k),{key:0,type:"button",variant:"ghost",size:"sm",onClick:B,class:"h-auto p-1"},{default:l(()=>[s(e(me),{class:"h-4 w-4"})]),_:1}))])])):$("",!0),n.error?(r(),m("p",Be,i(n.error),1)):$("",!0)]))}}),ze={class:"space-y-4"},qe={class:"flex justify-between items-center"},De={class:"font-medium"},Le={key:0,class:"text-sm text-muted-foreground"},Te={key:0,class:"space-y-2"},je={class:"flex items-start gap-4"},Ee={class:"flex-1 space-y-2"},Ie={class:"flex items-center gap-2"},Fe={class:"font-medium"},Me={class:"text-sm text-muted-foreground"},Re={key:0,class:"text-sm"},Oe={class:"flex gap-2"},Qe={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},Xe={class:"space-y-4"},Ge={class:"space-y-2"},He={class:"space-y-2"},Je={key:0,class:"text-sm text-destructive"},Ke={class:"space-y-2"},pa=L({__name:"ParticipantesManager",props:{modelValue:{default:()=>[]},users:{default:()=>[]},entityType:{default:"contrato"},title:{default:"Participantes"},description:{},disabled:{type:Boolean,default:!1},roles:{default:()=>[{value:"participante",label:"Participante"},{value:"observador",label:"Observador"},{value:"aprobador",label:"Aprobador"}]}},emits:["update:modelValue"],setup(U,{emit:P}){const p=U,h=P,c=V([...p.modelValue]),f=V(!1),y=V(null),d=V({user_id:0,rol:"participante",notas:""}),g=V({}),S=x(()=>{const t=c.value.filter((a,o)=>o!==y.value).map(a=>a.user_id);return p.users.filter(a=>!t.includes(a.id))});function N(t){const a=p.users.find(o=>o.id===t);return(a==null?void 0:a.name)||"Usuario desconocido"}function B(t){const a=p.users.find(o=>o.id===t);return(a==null?void 0:a.email)||""}function n(t){const a=p.roles.find(o=>o.value===t);return(a==null?void 0:a.label)||t}function b(){y.value=null,d.value={user_id:0,rol:"participante",notas:""},g.value={},f.value=!0}function _(t){y.value=t;const a=c.value[t];d.value={...a},g.value={},f.value=!0}function q(t){c.value.splice(t,1),h("update:modelValue",c.value)}function j(){g.value={};let t=!0;return d.value.user_id||(g.value.user_id="Debe seleccionar un usuario",t=!1),d.value.rol||(g.value.rol="Debe seleccionar un rol",t=!1),t}function E(){j()&&(y.value!==null?c.value[y.value]={...d.value}:c.value.push({...d.value}),h("update:modelValue",c.value),f.value=!1)}return T(()=>p.modelValue,t=>{c.value=[...t]},{deep:!0}),(t,a)=>(r(),m("div",ze,[u("div",qe,[u("div",null,[u("h4",De,i(t.title),1),t.description?(r(),m("p",Le,i(t.description),1)):$("",!0)]),t.disabled?$("",!0):(r(),C(e(k),{key:0,type:"button",variant:"outline",size:"sm",onClick:b},{default:l(()=>[s(e(_e),{class:"h-4 w-4 mr-2"}),a[5]||(a[5]=v(" Agregar Participante ",-1))]),_:1}))]),c.value.length>0?(r(),m("div",Te,[(r(!0),m(A,null,z(c.value,(o,D)=>(r(),C(e(M),{key:o.user_id},{default:l(()=>[s(e(F),{class:"p-4"},{default:l(()=>[u("div",je,[u("div",Ee,[u("div",Ie,[u("span",Fe,i(N(o.user_id)),1),s(e(R),{variant:"secondary"},{default:l(()=>[v(i(n(o.rol)),1)]),_:2},1024)]),u("p",Me,i(B(o.user_id)),1),o.notas?(r(),m("p",Re,i(o.notas),1)):$("",!0)]),u("div",Oe,[t.disabled?$("",!0):(r(),C(e(k),{key:0,type:"button",variant:"ghost",size:"sm",onClick:I=>_(D)},{default:l(()=>[s(e(ye),{class:"h-4 w-4"})]),_:2},1032,["onClick"])),t.disabled?$("",!0):(r(),C(e(k),{key:1,type:"button",variant:"ghost",size:"sm",onClick:I=>q(D)},{default:l(()=>[s(e(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"]))])])]),_:2},1024)]),_:2},1024))),128))])):(r(),m("div",Qe,[s(e(ve),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),a[6]||(a[6]=u("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))])),s(e(K),{open:f.value,"onUpdate:open":a[4]||(a[4]=o=>f.value=o)},{default:l(()=>[s(e(Q),null,{default:l(()=>[s(e(X),null,{default:l(()=>[s(e(G),null,{default:l(()=>[v(i(y.value!==null?"Editar Participante":"Agregar Participante"),1)]),_:1}),s(e(H),null,{default:l(()=>[v(" Seleccione un usuario y defina su rol en el "+i(t.entityType)+". ",1)]),_:1})]),_:1}),u("div",Xe,[u("div",Ge,[s(e(w),null,{default:l(()=>[...a[7]||(a[7]=[v("Usuario",-1)])]),_:1}),s(Ae,{modelValue:d.value.user_id,"onUpdate:modelValue":a[0]||(a[0]=o=>d.value.user_id=o),users:S.value,disabled:y.value!==null,placeholder:"Seleccionar usuario...",error:g.value.user_id},null,8,["modelValue","users","disabled","error"])]),u("div",He,[s(e(w),null,{default:l(()=>[...a[8]||(a[8]=[v("Rol",-1)])]),_:1}),s(e(W),{modelValue:d.value.rol,"onUpdate:modelValue":a[1]||(a[1]=o=>d.value.rol=o)},{default:l(()=>[s(e(Y),null,{default:l(()=>[s(e(Z),{placeholder:"Seleccionar rol..."})]),_:1}),s(e(ee),null,{default:l(()=>[(r(!0),m(A,null,z(t.roles,o=>(r(),C(e(ae),{key:o.value,value:o.value},{default:l(()=>[v(i(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),g.value.rol?(r(),m("p",Je,i(g.value.rol),1)):$("",!0)]),u("div",Ke,[s(e(w),null,{default:l(()=>[...a[9]||(a[9]=[v("Notas (opcional)",-1)])]),_:1}),s(e(O),{modelValue:d.value.notas,"onUpdate:modelValue":a[2]||(a[2]=o=>d.value.notas=o),placeholder:"Agregar notas sobre la participaciÃ³n...",class:"min-h-[80px]"},null,8,["modelValue"])])]),s(e(J),null,{default:l(()=>[s(e(k),{type:"button",variant:"outline",onClick:a[3]||(a[3]=o=>f.value=!1)},{default:l(()=>[...a[10]||(a[10]=[v(" Cancelar ",-1)])]),_:1}),s(e(k),{type:"button",onClick:E},{default:l(()=>[v(i(y.value!==null?"Actualizar":"Agregar"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]))}});export{Ae as _,pa as a};
