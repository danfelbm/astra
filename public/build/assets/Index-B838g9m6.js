import{d as U,r as V,b as p,e as l,w as a,g as i,f as s,h as n,i as d,j as f,t as b,u as t,P as q,n as A,F as J,k as K,W as c}from"./app-BFCRP-hu.js";import{_ as Q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DVhxtwsQ.js";import{_ as v}from"./createLucideIcon-B48W5HGR.js";import{_ as C,c as w,a as X,b as Y}from"./CardTitle.vue_vue_type_script_setup_true_lang-C6Pf_Uif.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang-BArk2Dro.js";import{_ as tt}from"./Label.vue_vue_type_script_setup_true_lang-BSsD_nCa.js";import{_ as et}from"./index-C4A356_A.js";import{_ as st,a as ot,b as D,c as x,d as at,e as $}from"./TableHeader.vue_vue_type_script_setup_true_lang-DQXCVN5r.js";import{_ as it,a as rt,b as lt,c as O,e as nt}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bk1MyGsx.js";import{u as mt,O as dt}from"./ObligacionTree-B8hED2qM.js";import{_ as ct}from"./Pagination.vue_vue_type_script_setup_true_lang-C4td7a-z.js";import{t as E}from"./index-D4Jmcyj5.js";import{l as ut}from"./lodash-D--s9_6U.js";import{D as pt}from"./download-CHCWIUuH.js";import{P as ft}from"./plus-DUQ5nN3r.js";import{S as _t}from"./search-DzHipmqi.js";import{T as bt}from"./tree-pine-DJFe6Cey.js";import{L as gt}from"./list-CQPYaV--.js";import{E as vt}from"./ellipsis-vertical-Bk1Cqaiy.js";import{E as ht}from"./eye-s1iMQI4x.js";import{P as yt}from"./pencil-C75Bxf5Y.js";import{T as kt}from"./trash-2-8yxMJPAD.js";import{C as xt}from"./circle-alert-Crqw8R8y.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-IDczqvjz.js";import"./index-BV8EXJV5.js";import"./floating-ui.vue-r1jh_cyr.js";import"./x-CO2t7227.js";import"./index-7Cc0L9l5.js";import"./shield-CJLgSpbM.js";import"./user-B1UdYhgU.js";import"./chevron-right-jEjsThLi.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-it7-95jd.js";import"./VisuallyHidden-DtgZKa-V.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-D4BkPhEO.js";import"./index-D4t36AHs.js";import"./check-50anzA7W.js";import"./nullish-CHIgUVhi.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-dTZ0TTmN.js";import"./map-pin-96AKVoID.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Bn4JBZsL.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Dy-9tXTd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B5X7TeC-.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-C1tM4KQo.js";import"./tag-BD_pJCyF.js";import"./users-D4nlGR3z.js";import"./target-BG-rBVrT.js";import"./vote-CRb2uBrD.js";import"./folder-open-CdHVd2oB.js";import"./send-B06MTMiq.js";import"./file-text-BNtX5jn7.js";import"./briefcase-DvfVQ7DM.js";import"./calendar-_r6_tYhJ.js";import"./megaphone-Dd-rvhjG.js";import"./user-check-CmuxQ_fm.js";import"./clipboard-list-BbsP5NSE.js";import"./mail-C7hV_ozf.js";import"./message-square-2Ae9CC_o.js";import"./external-link-DVqz8Mr1.js";import"./panel-left-BSTwYg9i.js";import"./index-BZv-jeFa.js";import"./Separator.vue_vue_type_script_setup_true_lang-D_n8r-Jx.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-n_9Pe0i3.js";import"./circle-Cc_4kpMQ.js";import"./layers-DFj5lvvO.js";import"./paperclip-BJUUBG1p.js";import"./loader-circle-BlBV89L7.js";const $t={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ct={class:"flex items-center justify-between"},wt={class:"text-3xl font-bold"},Ot={key:0,class:"text-sm text-gray-600"},Et={class:"flex items-center gap-2"},jt={class:"relative"},St={class:"text-2xl font-bold"},Bt={class:"flex items-center justify-between"},Pt={class:"flex items-center gap-2"},Tt={key:0},Vt={key:1},At={class:"text-sm text-gray-600"},Dt={key:0,class:"text-sm"},zt={key:1,class:"text-sm text-gray-400"},Nt={key:0,class:"mt-4 flex justify-center"},It={key:2,class:"text-center py-8 text-gray-500"},Ye=U({__name:"Index",props:{obligaciones:{},estadisticas:{},filters:{},contrato:{},estadisticasResponsables:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canExport:{type:Boolean}},setup(z){var B,P,T;const u=z,N=u.contrato?[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:u.contrato.nombre,href:`/admin/contratos/${u.contrato.id}`},{title:"Obligaciones",href:"#"}]:[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"}],{hasPermission:h}=mt(),_=V("tabla"),y=V({search:((B=u.filters)==null?void 0:B.search)||"",contrato_id:((P=u.filters)==null?void 0:P.contrato_id)||((T=u.contrato)==null?void 0:T.id)||""}),I=()=>{c.get(route("admin.obligaciones.index"),y.value,{preserveState:!0,preserveScroll:!0})},L=ut.debounce(()=>{I()},500),F=()=>{var o;c.visit(route("admin.obligaciones.create",{contrato_id:(o=u.contrato)==null?void 0:o.id}))},W=o=>{c.visit(route("admin.obligaciones.show",o.id))},j=o=>{c.visit(route("admin.obligaciones.edit",o.id))},S=o=>{const e=o.tiene_hijos?`¿Estás seguro de eliminar "${o.titulo}" y todas sus obligaciones hijas?`:`¿Estás seguro de eliminar "${o.titulo}"?`;confirm(e)&&c.delete(route("admin.obligaciones.destroy",o.id),{preserveScroll:!0,onSuccess:()=>{E.success("Obligación eliminada exitosamente")}})},G=o=>{c.post(route("admin.obligaciones.completar",o.id),{},{preserveScroll:!0,onSuccess:()=>{E.success("Obligación marcada como cumplida")}})},H=o=>{c.visit(route("admin.obligaciones.create",{contrato_id:o.contrato_id,parent_id:o.id}))},M=(o,e,k)=>{c.post(route("admin.obligaciones.mover",o.id),{nuevo_parent_id:e,nuevo_orden:k},{preserveScroll:!0,onSuccess:()=>{E.success("Obligación movida exitosamente")}})},R=()=>{window.open(route("admin.obligaciones.exportar",y.value),"_blank")};return(o,e)=>(l(),p(Q,{breadcrumbs:t(N)},{default:a(()=>{var k;return[i("div",$t,[i("div",Ct,[i("div",null,[i("h1",wt,[e[3]||(e[3]=n(" Obligaciones ",-1)),o.contrato?(l(),d("span",Ot," - "+b(o.contrato.nombre),1)):f("",!0)]),e[4]||(e[4]=i("p",{class:"text-gray-600 mt-1"},"Gestiona las obligaciones de los contratos",-1))]),i("div",Et,[o.canExport||t(h)("obligaciones.export")?(l(),p(t(v),{key:0,variant:"outline",size:"sm",onClick:R},{default:a(()=>[s(t(pt),{class:"h-4 w-4 mr-2"}),e[5]||(e[5]=n(" Exportar ",-1))]),_:1})):f("",!0),o.canCreate||t(h)("obligaciones.create")?(l(),p(t(q),{key:1,href:o.route("admin.obligaciones.create",{contrato_id:(k=o.contrato)==null?void 0:k.id})},{default:a(()=>[s(t(v),null,{default:a(()=>[s(t(ft),{class:"h-4 w-4 mr-2"}),e[6]||(e[6]=n(" Nueva Obligación ",-1))]),_:1})]),_:1},8,["href"])):f("",!0)])]),s(t(C),null,{default:a(()=>[s(t(w),{class:"pt-6"},{default:a(()=>[i("div",null,[s(t(tt),{for:"search"},{default:a(()=>[...e[7]||(e[7]=[n("Buscar",-1)])]),_:1}),i("div",jt,[s(t(_t),{class:"absolute left-2 top-2.5 h-4 w-4 text-gray-400"}),s(t(Z),{id:"search",modelValue:y.value.search,"onUpdate:modelValue":e[0]||(e[0]=m=>y.value.search=m),type:"text",placeholder:"Buscar obligaciones por título o descripción...",class:"pl-8",onInput:t(L)},null,8,["modelValue","onInput"])])])]),_:1})]),_:1}),s(t(C),null,{default:a(()=>[s(t(w),{class:"pt-6"},{default:a(()=>{var m,r;return[i("div",St,b(((r=(m=o.obligaciones)==null?void 0:m.data)==null?void 0:r.length)||0),1),e[8]||(e[8]=i("p",{class:"text-sm text-gray-600"},"Total Obligaciones",-1))]}),_:1})]),_:1}),s(t(C),{class:"flex-1"},{default:a(()=>[s(t(X),null,{default:a(()=>[i("div",Bt,[s(t(Y),null,{default:a(()=>[...e[9]||(e[9]=[n("Lista de Obligaciones",-1)])]),_:1}),i("div",Pt,[s(t(v),{variant:"ghost",size:"sm",class:A({"bg-gray-100":_.value==="arbol"}),onClick:e[1]||(e[1]=m=>_.value="arbol")},{default:a(()=>[s(t(bt),{class:"h-4 w-4 mr-1"}),e[10]||(e[10]=n(" Árbol ",-1))]),_:1},8,["class"]),s(t(v),{variant:"ghost",size:"sm",class:A({"bg-gray-100":_.value==="tabla"}),onClick:e[2]||(e[2]=m=>_.value="tabla")},{default:a(()=>[s(t(gt),{class:"h-4 w-4 mr-1"}),e[11]||(e[11]=n(" Tabla ",-1))]),_:1},8,["class"])])])]),_:1}),s(t(w),null,{default:a(()=>{var m;return[_.value==="arbol"&&o.obligaciones.data&&o.obligaciones.data.length>0?(l(),d("div",Tt,[s(dt,{obligaciones:o.obligaciones.data,contratoId:(m=o.contrato)==null?void 0:m.id,editable:!0,onCreate:F,onEdit:j,onDelete:S,onComplete:G,onAddChild:H,onMove:M},null,8,["obligaciones","contratoId"])])):_.value==="tabla"&&o.obligaciones.data&&o.obligaciones.data.length>0?(l(),d("div",Vt,[s(t(st),null,{default:a(()=>[s(t(ot),null,{default:a(()=>[s(t(D),null,{default:a(()=>[s(t(x),null,{default:a(()=>[...e[12]||(e[12]=[n("Título",-1)])]),_:1}),s(t(x),null,{default:a(()=>[...e[13]||(e[13]=[n("Descripción",-1)])]),_:1}),s(t(x),null,{default:a(()=>[...e[14]||(e[14]=[n("Archivos",-1)])]),_:1}),s(t(x),{class:"text-right"},{default:a(()=>[...e[15]||(e[15]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),s(t(at),null,{default:a(()=>[(l(!0),d(J,null,K(o.obligaciones.data,r=>(l(),p(t(D),{key:r.id},{default:a(()=>[s(t($),{class:"font-medium"},{default:a(()=>[i("div",null,[i("span",null,b(r.titulo),1),r.tiene_hijos?(l(),p(t(et),{key:0,variant:"outline",class:"ml-2 text-xs"},{default:a(()=>[n(b(r.total_hijos)+" hijos ",1)]),_:2},1024)):f("",!0)])]),_:2},1024),s(t($),null,{default:a(()=>[i("span",At,b(r.descripcion?r.descripcion.length>100?r.descripcion.substring(0,100)+"...":r.descripcion:"Sin descripción"),1)]),_:2},1024),s(t($),null,{default:a(()=>{var g;return[(g=r.archivos_adjuntos)!=null&&g.length?(l(),d("span",Dt,b(r.archivos_adjuntos.length)+" archivo(s) ",1)):(l(),d("span",zt,"Sin archivos"))]}),_:2},1024),s(t($),{class:"text-right"},{default:a(()=>[s(t(it),null,{default:a(()=>[s(t(rt),{asChild:""},{default:a(()=>[s(t(v),{variant:"ghost",size:"icon",class:"h-8 w-8"},{default:a(()=>[s(t(vt),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(lt),{align:"end"},{default:a(()=>[s(t(O),{onClick:g=>W(r)},{default:a(()=>[s(t(ht),{class:"h-4 w-4 mr-2"}),e[16]||(e[16]=n(" Ver ",-1))]),_:2},1032,["onClick"]),o.canEdit||t(h)("obligaciones.edit")?(l(),p(t(O),{key:0,onClick:g=>j(r)},{default:a(()=>[s(t(yt),{class:"h-4 w-4 mr-2"}),e[17]||(e[17]=n(" Editar ",-1))]),_:2},1032,["onClick"])):f("",!0),s(t(nt)),o.canDelete||t(h)("obligaciones.delete")?(l(),p(t(O),{key:1,class:"text-red-600",onClick:g=>S(r)},{default:a(()=>[s(t(kt),{class:"h-4 w-4 mr-2"}),e[18]||(e[18]=n(" Eliminar ",-1))]),_:2},1032,["onClick"])):f("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o.obligaciones.links?(l(),d("div",Nt,[s(ct,{links:o.obligaciones.links,meta:o.obligaciones.meta},null,8,["links","meta"])])):f("",!0)])):(l(),d("div",It,[s(t(xt),{class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e[19]||(e[19]=i("p",null,"No se encontraron obligaciones",-1)),e[20]||(e[20]=i("p",{class:"text-sm mt-1"},"Crea una nueva obligación para comenzar",-1))]))]}),_:1})]),_:1})])]}),_:1},8,["breadcrumbs"]))}});export{Ye as default};
