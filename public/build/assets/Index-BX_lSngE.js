import{d as G,k as w,j as c,o as d,e as s,b as t,f as n,u as e,m as I,P as x,g as r,a as $,i as y,K as Q,t as i,F as D,r as F,n as X,W as h}from"./app-CELEraHo.js";import{T as J,d as Y,e as Z,f as ee,g as p,_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dbsa-okf.js";import{_ as C}from"./createLucideIcon-s5sOHYqj.js";import{_ as U,a as B,b as L,c as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-BTRZ6n-Z.js";import{_ as se}from"./CardDescription.vue_vue_type_script_setup_true_lang-Z0Iz-EuH.js";import{_ as ae,a as le,b as k,c as m,d as oe,e as f}from"./TableHeader.vue_vue_type_script_setup_true_lang-C7J5jmD9.js";import{_ as S}from"./index-CQWxbFbf.js";import{a as re}from"./Label.vue_vue_type_script_setup_true_lang-D9qfcfgT.js";import{_ as ne,a as ie,b as ue,c as de,d as T}from"./SelectValue.vue_vue_type_script_setup_true_lang-BarmgKfq.js";import{_ as fe}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-R2w7nro7.js";import{P as me}from"./plus-BAx3QMdb.js";import{U as _e}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D5Ok5Z3Z.js";import{E as ce}from"./ellipsis-YKZ0bNNA.js";import{E as pe}from"./eye-Dlm8BiRN.js";import{R as ge}from"./refresh-cw-CU5Mi17l.js";import{T as ve}from"./trash-DKRTgbCz.js";import{S as xe}from"./square-pen-skyYA5OL.js";import{T as $e}from"./trash-2-CtlWLjbx.js";import"./index-B2-9gOJc.js";import"./check-DBj6brRU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DcJpg0p7.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DGsevKjb.js";import"./index-W4JxdBIy.js";import"./VisuallyHidden-qfxc1uTE.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-Cscsy6Ku.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DFQo21Xz.js";import"./es-DfN3vIXC.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-CtSxIsEx.js";import"./loader-circle-5wnE5zXn.js";import"./search-CBEjtJNs.js";import"./history-CGZnWK2J.js";import"./save-CDBr5p69.js";const ye={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},he={class:"flex items-center justify-between"},Ce={class:"flex gap-4"},be={class:"flex-1"},we={class:"w-48"},ke={key:0},Se={class:"flex items-center gap-2"},Te={class:"font-semibold"},Ee={class:"text-xs text-muted-foreground max-w-xs truncate"},Ve={class:"text-xs"},De={class:"flex items-center gap-1"},Fe={class:"text-sm font-medium"},Ue={class:"text-xs text-muted-foreground"},Be={key:0,class:"flex items-center justify-center space-x-2 mt-6"},Le={class:"flex gap-1"},ct=G({__name:"Index",props:{segments:{},filters:{},filterFieldsConfig:{}},setup(N){const _=N,j=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"}],b=w(_.filters.search||""),g=w(_.filters.is_dynamic||"all"),v=w(!1),P=l=>l?"default":"secondary",R=l=>l?"Dinámico":"Estático",A=l=>l.split("\\").pop()||l,z=l=>l!=null&&l.last_calculated_at?new Date(l.last_calculated_at).toLocaleString():"Nunca",K=l=>l<60?`${l}s`:l<3600?`${Math.floor(l/60)}m`:`${Math.floor(l/3600)}h`,E=()=>{const l={search:b.value};g.value!=="all"&&(l.is_dynamic=g.value),h.get("/admin/segments",l,{preserveState:!0,preserveScroll:!0})},q=l=>{confirm(`¿Estás seguro de eliminar el segmento "${l.name}"?`)&&h.delete(`/admin/segments/${l.id}`)},H=async l=>{var a;try{(await(await fetch(`/admin/segments/${l.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""}})).json()).success&&h.reload()}catch(o){console.error("Error evaluating segment:",o)}},O=l=>{h.post(`/admin/segments/${l.id}/clear-cache`)},W=l=>!l.roles||l.roles.length===0;return(l,a)=>(d(),c(te,{breadcrumbs:j},{default:s(()=>[t(e(I),{title:"Segmentos"}),n("div",ye,[n("div",he,[a[4]||(a[4]=n("div",null,[n("h2",{class:"text-2xl font-bold tracking-tight"},"Segmentos de Usuarios"),n("p",{class:"text-muted-foreground"}," Gestiona segmentos dinámicos basados en filtros avanzados ")],-1)),t(e(x),{href:l.route("admin.segments.create")},{default:s(()=>[t(e(C),null,{default:s(()=>[t(e(me),{class:"mr-2 h-4 w-4"}),a[3]||(a[3]=r(" Nuevo Segmento "))]),_:1})]),_:1},8,["href"])]),t(e(U),null,{default:s(()=>[t(e(B),null,{default:s(()=>[t(e(L),{class:"text-base"},{default:s(()=>a[5]||(a[5]=[r("Filtros")])),_:1})]),_:1}),t(e(M),{class:"space-y-4"},{default:s(()=>[n("div",Ce,[n("div",be,[t(e(re),{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=o=>b.value=o),placeholder:"Buscar por nombre o descripción...",onKeyup:Q(E,["enter"])},null,8,["modelValue"])]),n("div",we,[t(e(ne),{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=o=>g.value=o)},{default:s(()=>[t(e(ie),null,{default:s(()=>[t(e(ue),{placeholder:"Tipo de segmento"})]),_:1}),t(e(de),null,{default:s(()=>[t(e(T),{value:"all"},{default:s(()=>a[6]||(a[6]=[r("Todos")])),_:1}),t(e(T),{value:"true"},{default:s(()=>a[7]||(a[7]=[r("Dinámicos")])),_:1}),t(e(T),{value:"false"},{default:s(()=>a[8]||(a[8]=[r("Estáticos")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),t(e(C),{onClick:E,variant:"secondary"},{default:s(()=>a[9]||(a[9]=[r(" Buscar ")])),_:1}),t(e(C),{onClick:a[2]||(a[2]=o=>v.value=!v.value),variant:"outline"},{default:s(()=>[r(i(v.value?"Ocultar":"Mostrar")+" Filtros Avanzados ",1)]),_:1})]),v.value?(d(),$("div",ke,[t(fe,{fieldsConfig:l.filterFieldsConfig,baseUrl:"/admin/segments"},null,8,["fieldsConfig"])])):y("",!0)]),_:1})]),_:1}),t(e(U),null,{default:s(()=>[t(e(B),null,{default:s(()=>[t(e(L),null,{default:s(()=>a[10]||(a[10]=[r("Segmentos Registrados")])),_:1}),t(e(se),null,{default:s(()=>[r(" Total de "+i(_.segments.total)+" segmentos configurados ",1)]),_:1})]),_:1}),t(e(M),null,{default:s(()=>[t(e(ae),null,{default:s(()=>[t(e(le),null,{default:s(()=>[t(e(k),null,{default:s(()=>[t(e(m),null,{default:s(()=>a[11]||(a[11]=[r("Segmento")])),_:1}),t(e(m),null,{default:s(()=>a[12]||(a[12]=[r("Tipo")])),_:1}),t(e(m),null,{default:s(()=>a[13]||(a[13]=[r("Modelo")])),_:1}),t(e(m),null,{default:s(()=>a[14]||(a[14]=[r("Usuarios")])),_:1}),t(e(m),null,{default:s(()=>a[15]||(a[15]=[r("Cache")])),_:1}),t(e(m),null,{default:s(()=>a[16]||(a[16]=[r("Última Evaluación")])),_:1}),t(e(m),null,{default:s(()=>a[17]||(a[17]=[r("Roles")])),_:1}),t(e(m),{class:"text-right"},{default:s(()=>a[18]||(a[18]=[r("Acciones")])),_:1})]),_:1})]),_:1}),t(e(oe),null,{default:s(()=>[(d(!0),$(D,null,F(_.segments.data,o=>(d(),c(e(k),{key:o.id},{default:s(()=>[t(e(f),{class:"font-medium"},{default:s(()=>[n("div",Se,[t(e(J),{class:"h-4 w-4 text-muted-foreground"}),n("div",null,[n("p",Te,i(o.name),1),n("p",Ee,i(o.description||"Sin descripción"),1)])])]),_:2},1024),t(e(f),null,{default:s(()=>[t(e(S),{variant:P(o.is_dynamic)},{default:s(()=>[r(i(R(o.is_dynamic)),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(f),null,{default:s(()=>[n("code",Ve,i(A(o.model_type)),1)]),_:2},1024),t(e(f),null,{default:s(()=>{var u;return[n("div",De,[t(e(_e),{class:"h-4 w-4 text-muted-foreground"}),n("span",Fe,i(((u=o.metadata)==null?void 0:u.contacts_count)||o.user_count||0),1)])]}),_:2},1024),t(e(f),null,{default:s(()=>[t(e(S),{variant:"ghost"},{default:s(()=>[r(i(K(o.cache_duration)),1)]),_:2},1024)]),_:2},1024),t(e(f),null,{default:s(()=>[n("span",Ue,i(z(o.metadata)),1)]),_:2},1024),t(e(f),null,{default:s(()=>[t(e(S),{variant:"outline"},{default:s(()=>{var u,V;return[r(i(((u=o.roles)==null?void 0:u.length)||0)+" rol"+i((((V=o.roles)==null?void 0:V.length)||0)!==1?"es":""),1)]}),_:2},1024)]),_:2},1024),t(e(f),{class:"text-right"},{default:s(()=>[t(e(Y),null,{default:s(()=>[t(e(Z),{asChild:""},{default:s(()=>[t(e(C),{variant:"ghost",size:"icon"},{default:s(()=>[t(e(ce),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(ee),{align:"end"},{default:s(()=>[t(e(x),{href:`/admin/segments/${o.id}`},{default:s(()=>[t(e(p),null,{default:s(()=>[t(e(pe),{class:"mr-2 h-4 w-4"}),a[19]||(a[19]=r(" Ver Usuarios "))]),_:1})]),_:2},1032,["href"]),t(e(p),{onClick:u=>H(o)},{default:s(()=>[t(e(ge),{class:"mr-2 h-4 w-4"}),a[20]||(a[20]=r(" Recalcular "))]),_:2},1032,["onClick"]),t(e(p),{onClick:u=>O(o)},{default:s(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),a[21]||(a[21]=r(" Limpiar Cache "))]),_:2},1032,["onClick"]),t(e(x),{href:`/admin/segments/${o.id}/edit`},{default:s(()=>[t(e(p),null,{default:s(()=>[t(e(xe),{class:"mr-2 h-4 w-4"}),a[22]||(a[22]=r(" Editar "))]),_:1})]),_:2},1032,["href"]),W(o)?(d(),c(e(p),{key:0,onClick:u=>q(o),class:"text-destructive"},{default:s(()=>[t(e($e),{class:"mr-2 h-4 w-4"}),a[23]||(a[23]=r(" Eliminar "))]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),_.segments.data.length===0?(d(),c(e(k),{key:0},{default:s(()=>[t(e(f),{colspan:"8",class:"text-center py-8 text-muted-foreground"},{default:s(()=>a[24]||(a[24]=[r(" No se encontraron segmentos ")])),_:1})]),_:1})):y("",!0)]),_:1})]),_:1}),_.segments.last_page>1?(d(),$("div",Be,[n("nav",Le,[(d(!0),$(D,null,F(_.segments.links,o=>(d(),c(e(x),{key:o.label,href:o.url,class:X(["px-3 py-2 text-sm rounded-md",o.active?"bg-primary text-primary-foreground":"hover:bg-muted",!o.url&&"opacity-50 cursor-not-allowed"]),innerHTML:o.label,disabled:!o.url},null,8,["href","class","innerHTML","disabled"]))),128))])])):y("",!0)]),_:1})]),_:1})])]),_:1}))}});export{ct as default};
