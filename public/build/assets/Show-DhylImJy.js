import{d as ae,C as te,k as g,c as y,w as U,p as se,A as re,a as b,o as u,b as t,f as s,u as e,m as ie,N as le,j as f,i as c,e as i,g as d,t as p,F as j,r as ne,O as ue,W as de}from"./app-glWC7EnT.js";import{_ as z}from"./createLucideIcon-DMT-y44T.js";import{c as F,_ as B,a as M,b as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-CuTiJyz7.js";import{_ as q}from"./CardDescription.vue_vue_type_script_setup_true_lang-WPKY5x_1.js";import{_ as V,a as k}from"./Label.vue_vue_type_script_setup_true_lang-Cg7X4Pss.js";import{_ as I,a as O}from"./index-CGzIjTCG.js";import{_ as me,C as R}from"./index-Cx8EGlDa.js";import{_ as fe}from"./Progress.vue_vue_type_script_setup_true_lang-By_yHcRB.js";import{D as ce}from"./DynamicFormRenderer-5QvxK5op.js";import{u as pe}from"./useAutoSave-1crg0_vz.js";import{t as v}from"./index-Dy9pQMXz.js";import{C as W}from"./circle-check-CqQcRT0R.js";import{L as G}from"./loader-circle-FlzDErbm.js";import{C as ve}from"./clock-CHNcQ_5I.js";import{S as _e}from"./save-CS8oCFpZ.js";import{S as ge}from"./send-DGjr84gz.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VisuallyHidden-D3WwWxoU.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-D4lBSt9f.js";import"./index-9rrtNaQm.js";import"./check-BRWoX9xh.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Cw8X9ae0.js";import"./Textarea.vue_vue_type_script_setup_true_lang-73ZZd1tX.js";import"./plus-CWxoEFkc.js";import"./user-aoq7KmoW.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-B0Mdqu04.js";import"./RovingFocusItem-Fp9QpKRV.js";import"./utils-Bu442AJg.js";import"./VisuallyHiddenInput-D_32xZ5w.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-eixMqzdw.js";import"./useConditionalFields-Dpxm_pTH.js";import"./upload-DJAlslKc.js";import"./eye-olyptqAK.js";import"./download-CUFak5GN.js";import"./grip-vertical-BOWcia90.js";import"./trash-2-CXEwxR1q.js";const he={class:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"},we={class:"bg-white border-b"},xe={class:"container mx-auto px-4 py-6"},ye={class:"max-w-4xl mx-auto"},Ve={class:"text-3xl font-bold text-gray-900"},ke={key:1,class:"text-gray-600 mt-2"},Se={class:"container mx-auto px-4 py-8"},Ce={class:"max-w-4xl mx-auto"},$e={class:"flex items-center justify-between mb-2"},Fe={class:"text-sm text-muted-foreground"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"flex items-center gap-2 text-green-600"},De={class:"list-disc list-inside mt-2"},Te={class:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t shadow-lg z-50"},Le={class:"container mx-auto px-4"},Ae={class:"max-w-4xl mx-auto py-4"},Ne={class:"flex items-center justify-between"},Ue={class:"flex items-center gap-4"},je={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},ze={key:1,class:"flex items-center gap-2 text-sm text-green-600"},Me={class:"hidden md:flex items-center gap-2 text-sm text-muted-foreground"},Pe={class:"flex items-center gap-2"},qe=ae({__name:"Show",props:{formulario:{},respuestaBorrador:{},esVisitante:{type:Boolean}},setup(K){var A,N;const r=K,l=te({respuestas:((A=r.respuestaBorrador)==null?void 0:A.respuestas)||{},nombre_visitante:"",email_visitante:"",telefono_visitante:"",documento_visitante:"",captcha:""}),w=g((()=>{var o;const a={};return(o=r.respuestaBorrador)!=null&&o.respuestas&&Object.assign(a,r.respuestaBorrador.respuestas),r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.forEach(n=>{if(!(n.id in a))switch(n.type){case"checkbox":a[n.id]=!1;break;case"number":a[n.id]=0;break;case"select":case"radio":a[n.id]="";break;default:a[n.id]=""}}),a})());g(0),y(()=>1);const S=y(()=>r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.length>0),m=g(!1),H=g(!0),C=g(null),_=y(()=>{const a=r.formulario.configuracion_campos.length,o=Object.keys(l.respuestas).filter(n=>{const h=l.respuestas[n];return h!==null&&h!==""&&h!==void 0}).length;return a>0?Math.round(o/a*100):0}),{state:E,isSaving:x,hasSaved:D,saveNow:J,startWatching:$,stopWatching:T,clearLocalStorage:Q}=pe(w||g({}),{url:route("api.formularios.autosave"),resourceId:((N=r.respuestaBorrador)==null?void 0:N.id)||null,resourceIdField:"respuesta_id",debounceTime:3e3,showNotifications:!1,useLocalStorage:!0,localStorageKey:`formulario_${r.formulario.slug}_draft`,additionalData:{formulario_id:r.formulario.id}});U(w,a=>{a&&(l.respuestas=a)},{deep:!0}),U(()=>E.value.status,a=>{a==="saved"&&(C.value=E.value.lastSaved)}),se(()=>{r.esVisitante||$(),window.addEventListener("beforeunload",L)}),re(()=>{r.esVisitante||T(),window.removeEventListener("beforeunload",L)});const L=a=>{(x.value||_.value>0&&_.value<100)&&(a.preventDefault(),a.returnValue="¿Estás seguro de que quieres salir? Los cambios no guardados se perderán.")},X=()=>{const a=r.formulario.configuracion_campos||[];for(const o of a)if(o.required&&!l.respuestas[o.id])return v.error(`El campo "${o.title}" es requerido`),!1;if(r.esVisitante){if(!l.nombre_visitante||!l.email_visitante)return v.error("Por favor completa tu nombre y email"),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email_visitante))return v.error("Por favor ingresa un email válido"),!1}return!0},Y=async()=>{if(X()){m.value=!0,r.esVisitante||T();try{const a={...l.data(),formulario_id:r.formulario.id};await de.post(route("formularios.store",r.formulario.slug),a,{preserveScroll:!0,onSuccess:()=>{Q(),v.success("Formulario enviado exitosamente")},onError:o=>{v.error("Error al enviar el formulario"),console.error(o),m.value=!1,r.esVisitante||$()}})}catch{v.error("Error inesperado al enviar el formulario"),m.value=!1,r.esVisitante||$()}}},Z=()=>{r.esVisitante||(J(),v.success("Borrador guardado"))},ee=y(()=>{if(!C.value)return"";const o=Math.floor((new Date().getTime()-C.value.getTime())/1e3);return o<60?"hace unos segundos":o<3600?`hace ${Math.floor(o/60)} minutos`:o<86400?`hace ${Math.floor(o/3600)} horas`:"hace más de un día"}),oe=a=>{w.value=a||{}};return(a,o)=>(u(),b(j,null,[t(e(ie),{title:a.formulario.titulo},null,8,["title"]),s("div",he,[s("div",we,[s("div",xe,[s("div",ye,[a.formulario.categoria?(u(),f(e(me),{key:0,class:"mb-2"},{default:i(()=>[d(p(a.formulario.categoria.nombre),1)]),_:1})):c("",!0),s("h1",Ve,p(a.formulario.titulo),1),a.formulario.descripcion?(u(),b("p",ke,p(a.formulario.descripcion),1)):c("",!0)])])]),s("div",Se,[s("div",Ce,[t(e(B),{class:"mb-6"},{default:i(()=>[t(e(F),{class:"py-4"},{default:i(()=>[s("div",$e,[o[4]||(o[4]=s("span",{class:"text-sm font-medium"},"Progreso del formulario",-1)),s("span",Fe,p(_.value)+"% completado",1)]),t(e(fe),{value:_.value,class:"h-2"},null,8,["value"])]),_:1})]),_:1}),a.esVisitante?(u(),f(e(B),{key:0,class:"mb-6"},{default:i(()=>[t(e(M),null,{default:i(()=>[t(e(P),null,{default:i(()=>o[5]||(o[5]=[d("Información de contacto")])),_:1}),t(e(q),null,{default:i(()=>o[6]||(o[6]=[d(" Por favor proporciona tus datos para poder contactarte ")])),_:1})]),_:1}),t(e(F),{class:"space-y-4"},{default:i(()=>[s("div",Be,[s("div",null,[t(e(V),{htmlFor:"nombre"},{default:i(()=>o[7]||(o[7]=[d("Nombre completo *")])),_:1}),t(e(k),{id:"nombre",modelValue:e(l).nombre_visitante,"onUpdate:modelValue":o[0]||(o[0]=n=>e(l).nombre_visitante=n),placeholder:"Tu nombre completo",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(V),{htmlFor:"email"},{default:i(()=>o[8]||(o[8]=[d("Correo electrónico *")])),_:1}),t(e(k),{id:"email",type:"email",modelValue:e(l).email_visitante,"onUpdate:modelValue":o[1]||(o[1]=n=>e(l).email_visitante=n),placeholder:"tu@email.com",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(V),{htmlFor:"telefono"},{default:i(()=>o[9]||(o[9]=[d("Teléfono")])),_:1}),t(e(k),{id:"telefono",modelValue:e(l).telefono_visitante,"onUpdate:modelValue":o[2]||(o[2]=n=>e(l).telefono_visitante=n),placeholder:"Tu número de teléfono",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(V),{htmlFor:"documento"},{default:i(()=>o[10]||(o[10]=[d("Documento de identidad")])),_:1}),t(e(k),{id:"documento",modelValue:e(l).documento_visitante,"onUpdate:modelValue":o[3]||(o[3]=n=>e(l).documento_visitante=n),placeholder:"Tu número de documento",disabled:m.value},null,8,["modelValue","disabled"])])])]),_:1})]),_:1})):c("",!0),t(e(B),{class:"mb-20"},{default:i(()=>[t(e(M),null,{default:i(()=>[t(e(P),null,{default:i(()=>o[11]||(o[11]=[d("Completa el formulario")])),_:1}),!a.esVisitante&&e(D)?(u(),f(e(q),{key:0},{default:i(()=>[s("div",Ee,[t(e(W),{class:"h-4 w-4"}),d(" Autoguardado "+p(ee.value),1)])]),_:1})):c("",!0)]),_:1}),t(e(F),null,{default:i(()=>[S.value?c("",!0):(u(),f(e(I),{key:0,variant:"destructive",class:"mb-4"},{default:i(()=>[t(e(R),{class:"h-4 w-4"}),t(e(O),null,{default:i(()=>o[12]||(o[12]=[d(" Este formulario no tiene campos configurados. Por favor, contacta al administrador. ")])),_:1})]),_:1})),S.value?(u(),f(ce,{key:1,fields:a.formulario.configuracion_campos||[],"model-value":w.value||{},disabled:m.value,"onUpdate:modelValue":oe},null,8,["fields","model-value","disabled"])):c("",!0)]),_:1})]),_:1}),e(l).errors&&Object.keys(e(l).errors).length>0?(u(),f(e(I),{key:1,class:"mb-6",variant:"destructive"},{default:i(()=>[t(e(R),{class:"h-4 w-4"}),t(e(O),null,{default:i(()=>[s("ul",De,[(u(!0),b(j,null,ne(e(l).errors,(n,h)=>(u(),b("li",{key:h},p(n),1))),128))])]),_:1})]),_:1})):c("",!0)])]),le(s("div",Te,[s("div",Le,[s("div",Ae,[s("div",Ne,[s("div",Ue,[e(x)?(u(),b("div",je,[t(e(G),{class:"h-4 w-4 animate-spin"}),o[13]||(o[13]=d(" Guardando... "))])):e(D)&&!a.esVisitante?(u(),b("div",ze,[t(e(W),{class:"h-4 w-4"}),o[14]||(o[14]=d(" Guardado "))])):c("",!0),s("div",Me,[t(e(ve),{class:"h-4 w-4"}),d(" "+p(_.value)+"% completado ",1)])]),s("div",Pe,[a.esVisitante?c("",!0):(u(),f(e(z),{key:0,variant:"outline",size:"sm",onClick:Z,disabled:e(x)||m.value},{default:i(()=>[t(e(_e),{class:"mr-2 h-4 w-4"}),o[15]||(o[15]=d(" Guardar borrador "))]),_:1},8,["disabled"])),t(e(z),{size:"sm",onClick:Y,disabled:m.value||e(x)||_.value===0||!S.value},{default:i(()=>[m.value?(u(),f(e(G),{key:1,class:"mr-2 h-4 w-4 animate-spin"})):(u(),f(e(ge),{key:0,class:"mr-2 h-4 w-4"})),d(" "+p(m.value?"Enviando...":"Enviar formulario"),1)]),_:1},8,["disabled"])])])])])],512),[[ue,H.value]])])],64))}}),Co=be(qe,[["__scopeId","data-v-6c404af8"]]);export{Co as default};
