import{d as L,c as $,r as j,s as p,p as R,b as C,w as a,g as l,e as o,i as A,j as S,t as d,f as e,v as T,h as f,m as b,F as U,k as G,M as q}from"./app-CJ1MU9dT.js";import{_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CzpcYh0J.js";import{_ as x,a as w,b as E,c as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-B8xlQso1.js";import{_ as k}from"./createLucideIcon-CYpPVXVf.js";import{_ as K}from"./Progress.vue_vue_type_script_setup_true_lang-BeAMd26I.js";import{u as O}from"./useToast-BZ7ui0pc.js";import{l as Q}from"./lodash-BizO0Kfb.js";import{_ as W,a as X}from"./EntregablesFilters.vue_vue_type_script_setup_true_lang-LoWHcVwc.js";import{A as Y}from"./arrow-left-nrcVDK_m.js";import{P as Z}from"./plus-B3a8Lznj.js";import{T as ee}from"./target-Cas04eD-.js";import{C as te}from"./circle-check-QyLFfoTN.js";import{C as oe}from"./clock-DIcITUuP.js";import{C as re}from"./circle-alert-NG0hI2Ig.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-DcP8s330.js";import"./index-6EgTwnJI.js";import"./floating-ui.vue-B1SyT8gY.js";import"./x-Bj1R_lgz.js";import"./Input.vue_vue_type_script_setup_true_lang-DB_-hZqe.js";import"./index-BsJ8FjL0.js";import"./index-7t2CblNg.js";import"./shield-v7ADaAhg.js";import"./user-B1nD-pfZ.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D9hhpD7f.js";import"./chevron-right-CVAVCY58.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DhvwrcqR.js";import"./VisuallyHidden-ozeDILvZ.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-C3ruv6H_.js";import"./check-B59k_ME2.js";import"./Label.vue_vue_type_script_setup_true_lang-CqPPdNPG.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-B0w0pWhB.js";import"./index-V-Kq1BVm.js";import"./map-pin-B7B5DTre.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-C8GGRNWC.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Cdz8sSvm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B9eUtwEd.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-9ynleEu2.js";import"./tag-B7BbKm4V.js";import"./users-6S0iCR_c.js";import"./vote-CWX1gG3J.js";import"./folder-open-c7nJ5W2s.js";import"./send-olpYuiyv.js";import"./file-text-BVOVvTTJ.js";import"./briefcase-BoCCocbY.js";import"./calendar-BamnBOfT.js";import"./megaphone-TAM4y6RH.js";import"./user-check-lXKJJC2y.js";import"./clipboard-list-D016UAse.js";import"./mail-ysmBK8rh.js";import"./message-square-DMcV15lb.js";import"./external-link-BjKTwymI.js";import"./panel-left-ClK1KmNs.js";import"./index-j7j0QxXc.js";import"./index-CSHolk0x.js";import"./TableHeader.vue_vue_type_script_setup_true_lang--avSyMiH.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Bi1SKWdU.js";import"./eye-s5qWvbZ-.js";import"./square-pen-BWrh8WNc.js";import"./trash-2-5LBkkrb5.js";import"./filter-o8afp3EN.js";import"./search-DKQ7eqA-.js";const ae={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},se={class:"flex items-center justify-between"},ie={class:"text-muted-foreground mt-2"},le={class:"flex gap-2"},ne={class:"grid gap-4 md:grid-cols-4"},de={class:"text-2xl font-bold"},me={class:"text-xs text-muted-foreground mt-2"},ce={class:"text-2xl font-bold"},ue={class:"text-xs text-muted-foreground"},pe={class:"text-2xl font-bold"},fe={class:"text-2xl font-bold"},ge={key:0,class:"flex items-center justify-between"},he={class:"text-sm text-muted-foreground"},be={class:"flex gap-2"},kt=L({__name:"Index",props:{proyecto:{},hito:{},entregables:{},filters:{},resumenUsuarios:{},estados:{},prioridades:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canAssign:{type:Boolean}},setup(i){var P,V,B,D;const r=i,{toast:g}=O(),m=$(()=>Array.isArray(r.entregables)?{data:r.entregables,current_page:1,last_page:1,per_page:r.entregables.length,total:r.entregables.length,from:1,to:r.entregables.length}:r.entregables),c=j({search:((P=r.filters)==null?void 0:P.search)||null,estado:((V=r.filters)==null?void 0:V.estado)||null,prioridad:((B=r.filters)==null?void 0:B.prioridad)||null,responsable_id:((D=r.filters)==null?void 0:D.responsable_id)||null,fecha_inicio:null,fecha_fin:null});j([]);const M=$(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:r.proyecto.nombre,href:`/admin/proyectos/${r.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${r.proyecto.id}/hitos`},{title:r.hito.nombre,href:`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}`},{title:"Entregables"}]),N=Q.debounce(()=>{p.get(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables`,{search:c.value.search,estado:c.value.estado,prioridad:c.value.prioridad,responsable_id:c.value.responsable_id,page:1},{preserveState:!0,preserveScroll:!0})},300);R(c,()=>{N()},{deep:!0});const F=s=>{r.canComplete&&p.post(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables/${s.id}/completar`,{notas_completado:`Completado por ${q().props.auth.user.name}`},{onSuccess:()=>{g.success("Entregable marcado como completado")},onError:()=>{g.error("Error al marcar el entregable como completado")}})},z=s=>{r.canDelete&&confirm(`¿Estás seguro de eliminar el entregable "${s.nombre}"?`)&&p.delete(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables/${s.id}`,{onSuccess:()=>{g.success("Entregable eliminado correctamente")},onError:()=>{g.error("Error al eliminar el entregable")}})},H=s=>{r.canEdit&&p.post(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables/${s.id}/actualizar-estado`,{estado:"en_progreso"},{onSuccess:()=>{g.success("Entregable marcado como en progreso")},onError:()=>{g.error("Error al actualizar el estado del entregable")}})},v=s=>{if(!s)return null;const t=new Date,_=new Date(s).getTime()-t.getTime();return Math.ceil(_/(1e3*60*60*24))};$(()=>m.value.data.map(s=>({...s,diasRestantes:v(s.fecha_fin),estaVencido:s.fecha_fin&&v(s.fecha_fin)<0,estaProximoVencer:s.fecha_fin&&v(s.fecha_fin)>=0&&v(s.fecha_fin)<=7})));const u=$(()=>{const s=m.value.data,t=m.value.total,n=s.filter(h=>h.estado==="completado").length,_=s.filter(h=>h.estado==="en_progreso").length,I=s.filter(h=>h.estado==="pendiente").length;return{total:t,completados:n,enProgreso:_,pendientes:I,progreso:t>0?Math.round(n/t*100):0}});return(s,t)=>(b(),C(J,{breadcrumbs:M.value},{default:a(()=>[l("div",ae,[l("div",se,[l("div",null,[t[3]||(t[3]=l("h2",{class:"text-3xl font-bold tracking-tight"},"Entregables del Hito",-1)),l("p",ie,d(i.hito.nombre)+" - "+d(i.proyecto.nombre),1)]),l("div",le,[o(e(T),{href:`/admin/proyectos/${i.proyecto.id}/hitos`,as:"button"},{default:a(()=>[o(e(k),{variant:"outline"},{default:a(()=>[o(e(Y),{class:"mr-2 h-4 w-4"}),t[4]||(t[4]=f(" Volver a Hitos ",-1))]),_:1})]),_:1},8,["href"]),i.canCreate?(b(),C(e(T),{key:0,href:`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables/create`,as:"button"},{default:a(()=>[o(e(k),null,{default:a(()=>[o(e(Z),{class:"mr-2 h-4 w-4"}),t[5]||(t[5]=f(" Nuevo Entregable ",-1))]),_:1})]),_:1},8,["href"])):S("",!0)])]),l("div",ne,[o(e(x),null,{default:a(()=>[o(e(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[o(e(E),{class:"text-sm font-medium"},{default:a(()=>[...t[6]||(t[6]=[f("Total Entregables",-1)])]),_:1}),o(e(ee),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),o(e(y),null,{default:a(()=>[l("div",de,d(u.value.total),1),o(e(K),{value:u.value.progreso,class:"mt-2"},null,8,["value"]),l("p",me,d(u.value.progreso)+"% completado ",1)]),_:1})]),_:1}),o(e(x),null,{default:a(()=>[o(e(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[o(e(E),{class:"text-sm font-medium"},{default:a(()=>[...t[7]||(t[7]=[f("Completados",-1)])]),_:1}),o(e(te),{class:"h-4 w-4 text-green-600"})]),_:1}),o(e(y),null,{default:a(()=>[l("div",ce,d(u.value.completados),1),l("p",ue," de "+d(u.value.total)+" entregables ",1)]),_:1})]),_:1}),o(e(x),null,{default:a(()=>[o(e(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[o(e(E),{class:"text-sm font-medium"},{default:a(()=>[...t[8]||(t[8]=[f("En Progreso",-1)])]),_:1}),o(e(oe),{class:"h-4 w-4 text-blue-600"})]),_:1}),o(e(y),null,{default:a(()=>[l("div",pe,d(u.value.enProgreso),1),t[9]||(t[9]=l("p",{class:"text-xs text-muted-foreground"}," actualmente activos ",-1))]),_:1})]),_:1}),o(e(x),null,{default:a(()=>[o(e(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[o(e(E),{class:"text-sm font-medium"},{default:a(()=>[...t[10]||(t[10]=[f("Pendientes",-1)])]),_:1}),o(e(re),{class:"h-4 w-4 text-orange-600"})]),_:1}),o(e(y),null,{default:a(()=>[l("div",fe,d(u.value.pendientes),1),t[11]||(t[11]=l("p",{class:"text-xs text-muted-foreground"}," por iniciar ",-1))]),_:1})]),_:1})]),o(W,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=n=>c.value=n)},null,8,["modelValue"]),o(e(x),null,{default:a(()=>[o(e(y),{class:"p-0"},{default:a(()=>[o(X,{entregables:m.value.data,"proyecto-id":i.proyecto.id,"hito-id":i.hito.id,"can-edit":i.canEdit,"can-delete":i.canDelete,"can-complete":i.canComplete,onView:t[1]||(t[1]=n=>e(p).visit(`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables/${n.id}`)),onEdit:t[2]||(t[2]=n=>e(p).visit(`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables/${n.id}/edit`)),onComplete:F,onMarkInProgress:H,onDelete:z},null,8,["entregables","proyecto-id","hito-id","can-edit","can-delete","can-complete"])]),_:1})]),_:1}),m.value.last_page>1?(b(),A("div",ge,[l("div",he," Mostrando "+d(m.value.from)+" a "+d(m.value.to)+" de "+d(m.value.total)+" entregables ",1),l("div",be,[(b(!0),A(U,null,G(m.value.last_page,n=>(b(),C(e(k),{key:n,variant:"outline",size:"sm",disabled:n===m.value.current_page,onClick:_=>e(p).get(`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables?page=${n}`)},{default:a(()=>[f(d(n),1)]),_:2},1032,["disabled","onClick"]))),128))])])):S("",!0)])]),_:1},8,["breadcrumbs"]))}});export{kt as default};
