import{d as z,u as j,r as G,b as F,w as l,e as s,g as o,f as e,q as B,h as i,v as D,t as m,l as I,i as v,m as g,F as U,k as h,s as O}from"./app-Cps90vG2.js";import{_ as P}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CRO4CR7J.js";import{_ as p}from"./createLucideIcon-Bgm72SpE.js";import{_ as y,a as x,b,c as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-BGyo0yeJ.js";import{_ as S}from"./CardDescription.vue_vue_type_script_setup_true_lang-C4UwkfkC.js";import{_ as E}from"./Input.vue_vue_type_script_setup_true_lang-DrNZHE03.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-BhEm3-la.js";import{_ as Q}from"./Textarea.vue_vue_type_script_setup_true_lang-N47VfN5F.js";import{_ as H,a as J,b as K,c as W,d as X}from"./SelectValue.vue_vue_type_script_setup_true_lang-BFKDaOuW.js";import{_ as Y}from"./Switch.vue_vue_type_script_setup_true_lang-CWQwiwlH.js";import{_ as Z}from"./Checkbox.vue_vue_type_script_setup_true_lang-DSHEpdNf.js";import{_ as ee}from"./index-DCaFXfvI.js";import{_ as te,a as se,b as k,c as V}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DnD71FHf.js";import{_ as le,a as oe}from"./index-pJUGBGGR.js";import{_ as ie}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-DTYPam6N.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-CtnCin4e.js";import{A as ae}from"./arrow-left-OC4YZDed.js";import{C as ne}from"./circle-alert-DWRzB4qn.js";import{T as re}from"./target-BmLeIdFc.js";import{F as de}from"./filter-Ditsu_yq.js";import{S as me}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-WVtEzzjR.js";import{U as ue}from"./users-DhPw4U0m.js";import{S as fe}from"./save-DeiX6Yqx.js";import"./index-C8esdNXe.js";import"./floating-ui.vue-BvQrjiy0.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-B1u3EtG8.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DYGhjVPm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevron-right-SnT3IiIz.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-736Vx309.js";import"./chevrons-up-down-BhyLWXf2.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-ska8rz1v.js";import"./tag-C6AypVfl.js";import"./shield-oZ6Gn0Zg.js";import"./vote-BqFBh6gp.js";import"./folder-open-Bxf7NdBH.js";import"./send-BVGWuvqd.js";import"./file-text-C2ve5AKf.js";import"./briefcase-_bCdG8-w.js";import"./calendar-ix5cF6z0.js";import"./megaphone-BtrUQ1hy.js";import"./user-check-J5_GqRsJ.js";import"./clipboard-list-AgzzqwtV.js";import"./mail-DkuJfTt6.js";import"./message-square-B5j_iapi.js";import"./external-link-C3J8C0aI.js";import"./panel-left-EiU9s9sA.js";import"./check-sChBcA8x.js";import"./index-Bu3MKtdn.js";import"./index-BoOlVPqa.js";import"./index-BWN4Gq02.js";import"./VisuallyHidden-DcEyuFH6.js";import"./VisuallyHiddenInput-CbRnM4rf.js";import"./RovingFocusItem-Cxzy3vCA.js";import"./utils-DkL8qrEj.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DdRXkgOA.js";import"./x-DubltOEj.js";import"./DialogTrigger-CT6qbhsR.js";import"./useKbd-kRIii9yh.js";import"./chevron-left-BtB9HGed.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Cp1U07k3.js";import"./es-BDPlFIsO.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-6vUycZcE.js";import"./loader-circle-C8oqcVdu.js";import"./trash-2-HQzTGKqd.js";import"./plus-Cdk1dADm.js";import"./search-BaoXjhDI.js";import"./history-D4cS7TDS.js";import"./index-DJ86uzda.js";import"./user-CuQaavI3.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BLVYDUmA.js";import"./map-pin-COMQfJXb.js";const pe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ce={class:"flex items-center justify-between"},ge={class:"flex gap-2"},_e={class:"space-y-2"},ve={class:"space-y-2"},ye={class:"space-y-2"},xe={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},be={class:"flex items-center justify-between"},$e={class:"space-y-0.5"},Se={class:"flex items-center space-x-2"},ke={class:"space-y-2"},Ve={class:"grid grid-cols-2 gap-2"},Ce={class:"flex items-center px-3 py-2 bg-muted rounded-md"},we={class:"text-sm text-muted-foreground"},Fe={class:"grid grid-cols-2 gap-2 mt-2"},De={key:0,class:"space-y-3"},Ue={class:"flex-1"},he={class:"text-xs text-muted-foreground mt-1"},Ee={key:1,class:"text-center py-8 text-muted-foreground"},Le={class:"flex justify-end gap-4"},Xt=z({__name:"Edit",props:{segment:{},roles:{},filterFieldsConfig:{},modelTypes:{},selectedRoles:{}},setup(d){const u=d,L=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:"Editar Segmento",href:"#"}],a=j({name:u.segment.name,description:u.segment.description||"",model_type:u.segment.model_type,filters:u.segment.filters||{},is_dynamic:u.segment.is_dynamic,cache_duration:u.segment.cache_duration,role_ids:u.selectedRoles||[]}),N=G(null),R=r=>{const t=a.role_ids.indexOf(r);t>-1?a.role_ids.splice(t,1):a.role_ids.push(r)},q=r=>{a.filters=r},A=()=>{a.put(`/admin/segments/${u.segment.id}`,{preserveScroll:!0,onSuccess:()=>{}})},M=()=>{confirm(`¿Estás seguro de eliminar el segmento "${u.segment.name}"? Esta acción no se puede deshacer.`)&&O.delete(`/admin/segments/${u.segment.id}`)},T=r=>r<60?`${r} segundos`:r<3600?`${Math.floor(r/60)} minutos`:`${Math.floor(r/3600)} horas`,C=r=>r!=null&&r.last_calculated_at?new Date(r.last_calculated_at).toLocaleString():"Nunca";return(r,t)=>(g(),F(P,{breadcrumbs:L},{default:l(()=>[s(e(B),{title:"Editar Segmento"}),o("div",pe,[o("div",ce,[t[11]||(t[11]=o("div",null,[o("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Segmento"),o("p",{class:"text-muted-foreground"}," Modifica los filtros y configuración del segmento ")],-1)),o("div",ge,[s(e(p),{onClick:M,variant:"destructive",type:"button"},{default:l(()=>[...t[9]||(t[9]=[i(" Eliminar Segmento ",-1)])]),_:1}),s(e(D),{href:r.route("admin.segments.index")},{default:l(()=>[s(e(p),{variant:"outline"},{default:l(()=>[s(e(ae),{class:"mr-2 h-4 w-4"}),t[10]||(t[10]=i(" Volver ",-1))]),_:1})]),_:1},8,["href"])])]),s(e(le),null,{default:l(()=>[s(e(ne),{class:"h-4 w-4"}),s(e(oe),null,{default:l(()=>{var n;return[i(" Este segmento tiene "+m(((n=d.segment.metadata)==null?void 0:n.contacts_count)||0)+" usuarios. Última evaluación: "+m(C(d.segment.metadata)),1)]}),_:1})]),_:1}),o("form",{onSubmit:I(A,["prevent"]),class:"space-y-6"},[s(e(te),{defaultValue:"general",class:"space-y-4"},{default:l(()=>[s(e(se),{class:"grid w-full grid-cols-4"},{default:l(()=>[s(e(k),{value:"general"},{default:l(()=>[s(e(re),{class:"mr-2 h-4 w-4"}),t[12]||(t[12]=i(" General ",-1))]),_:1}),s(e(k),{value:"filters"},{default:l(()=>[s(e(de),{class:"mr-2 h-4 w-4"}),t[13]||(t[13]=i(" Filtros ",-1))]),_:1}),s(e(k),{value:"settings"},{default:l(()=>[s(e(me),{class:"mr-2 h-4 w-4"}),t[14]||(t[14]=i(" Configuración ",-1))]),_:1}),s(e(k),{value:"roles"},{default:l(()=>[s(e(ue),{class:"mr-2 h-4 w-4"}),t[15]||(t[15]=i(" Roles ",-1))]),_:1})]),_:1}),s(e(V),{value:"general"},{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(x),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[16]||(t[16]=[i("Información General",-1)])]),_:1}),s(e(S),null,{default:l(()=>[...t[17]||(t[17]=[i(" Define el nombre y descripción del segmento ",-1)])]),_:1})]),_:1}),s(e($),{class:"space-y-4"},{default:l(()=>{var n;return[o("div",_e,[s(e(c),{htmlFor:"name"},{default:l(()=>[...t[18]||(t[18]=[i("Nombre del Segmento",-1)])]),_:1}),s(e(E),{id:"name",modelValue:e(a).name,"onUpdate:modelValue":t[0]||(t[0]=f=>e(a).name=f),placeholder:"Usuarios por Región Norte"},null,8,["modelValue"]),s(_,{message:e(a).errors.name},null,8,["message"])]),o("div",ve,[s(e(c),{htmlFor:"description"},{default:l(()=>[...t[19]||(t[19]=[i("Descripción",-1)])]),_:1}),s(e(Q),{id:"description",modelValue:e(a).description,"onUpdate:modelValue":t[1]||(t[1]=f=>e(a).description=f),placeholder:"Describe el propósito y criterios de este segmento...",rows:"4"},null,8,["modelValue"]),s(_,{message:e(a).errors.description},null,8,["message"])]),o("div",ye,[s(e(c),{htmlFor:"model_type"},{default:l(()=>[...t[20]||(t[20]=[i("Tipo de Modelo",-1)])]),_:1}),s(e(H),{modelValue:e(a).model_type,"onUpdate:modelValue":t[2]||(t[2]=f=>e(a).model_type=f)},{default:l(()=>[s(e(J),null,{default:l(()=>[s(e(K),{placeholder:"Selecciona el tipo de modelo"})]),_:1}),s(e(W),null,{default:l(()=>[(g(!0),v(U,null,h(d.modelTypes,(f,w)=>(g(),F(e(X),{key:w,value:w},{default:l(()=>[i(m(f),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),t[21]||(t[21]=o("p",{class:"text-xs text-muted-foreground"}," Selecciona el modelo de datos sobre el que aplicar el segmento ",-1)),s(_,{message:e(a).errors.model_type},null,8,["message"])]),o("div",xe,[o("p",null,"ID del Segmento: "+m(d.segment.id),1),o("p",null,"Usuarios actuales: "+m(((n=d.segment.metadata)==null?void 0:n.contacts_count)||0),1),o("p",null,"Creado: "+m(new Date(d.segment.created_at).toLocaleDateString()),1),o("p",null,"Última actualización: "+m(new Date(d.segment.updated_at).toLocaleDateString()),1),o("p",null,"Última evaluación: "+m(C(d.segment.metadata)),1)])]}),_:1})]),_:1})]),_:1}),s(e(V),{value:"filters"},{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(x),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[22]||(t[22]=[i("Criterios de Filtrado",-1)])]),_:1}),s(e(S),null,{default:l(()=>[...t[23]||(t[23]=[i(" Modifica los filtros que determinan qué usuarios pertenecen a este segmento ",-1)])]),_:1})]),_:1}),s(e($),null,{default:l(()=>{var n;return[s(ie,{ref_key:"advancedFiltersRef",ref:N,config:{fields:d.filterFieldsConfig,showQuickSearch:!1},route:"",initialFilters:(n=d.segment.filters)!=null&&n.advanced_filters?{rootGroup:d.segment.filters.advanced_filters}:void 0,onApply:q},null,8,["config","initialFilters"]),s(_,{message:e(a).errors.filters},null,8,["message"]),t[24]||(t[24]=o("div",{class:"mt-4 p-4 bg-muted/50 rounded-lg"},[o("p",{class:"text-sm text-muted-foreground"},[o("strong",null,"Nota:"),i(" Los cambios en los filtros actualizarán automáticamente el segmento y recalcularán los usuarios que pertenecen a él. ")])],-1))]}),_:1})]),_:1})]),_:1}),s(e(V),{value:"settings"},{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(x),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[25]||(t[25]=[i("Configuración del Segmento",-1)])]),_:1}),s(e(S),null,{default:l(()=>[...t[26]||(t[26]=[i(" Ajusta el comportamiento y cache del segmento ",-1)])]),_:1})]),_:1}),s(e($),{class:"space-y-6"},{default:l(()=>[o("div",be,[o("div",$e,[s(e(c),null,{default:l(()=>[...t[27]||(t[27]=[i("Tipo de Segmento",-1)])]),_:1}),t[28]||(t[28]=o("p",{class:"text-sm text-muted-foreground"}," Los segmentos dinámicos se recalculan en tiempo real ",-1))]),o("div",Se,[s(e(c),{htmlFor:"is_dynamic",class:"text-sm"},{default:l(()=>[...t[29]||(t[29]=[i("Dinámico",-1)])]),_:1}),s(e(Y),{id:"is_dynamic",modelValue:e(a).is_dynamic,"onUpdate:modelValue":t[3]||(t[3]=n=>e(a).is_dynamic=n)},null,8,["modelValue"])])]),o("div",ke,[s(e(c),{htmlFor:"cache_duration"},{default:l(()=>[...t[30]||(t[30]=[i("Duración del Cache (segundos)",-1)])]),_:1}),o("div",Ve,[s(e(E),{id:"cache_duration",modelValue:e(a).cache_duration,"onUpdate:modelValue":t[4]||(t[4]=n=>e(a).cache_duration=n),modelModifiers:{number:!0},type:"number",min:"0",max:"86400"},null,8,["modelValue"]),o("div",Ce,[o("span",we,m(T(e(a).cache_duration)),1)])]),t[31]||(t[31]=o("p",{class:"text-xs text-muted-foreground"}," Tiempo que se mantendrán en cache los resultados del segmento (0 = sin cache) ",-1)),s(_,{message:e(a).errors.cache_duration},null,8,["message"])]),o("div",null,[s(e(c),{class:"text-sm font-medium"},{default:l(()=>[...t[32]||(t[32]=[i("Valores Predefinidos",-1)])]),_:1}),o("div",Fe,[s(e(p),{type:"button",variant:"outline",size:"sm",onClick:t[5]||(t[5]=n=>e(a).cache_duration=60)},{default:l(()=>[...t[33]||(t[33]=[i(" 1 minuto ",-1)])]),_:1}),s(e(p),{type:"button",variant:"outline",size:"sm",onClick:t[6]||(t[6]=n=>e(a).cache_duration=300)},{default:l(()=>[...t[34]||(t[34]=[i(" 5 minutos ",-1)])]),_:1}),s(e(p),{type:"button",variant:"outline",size:"sm",onClick:t[7]||(t[7]=n=>e(a).cache_duration=1800)},{default:l(()=>[...t[35]||(t[35]=[i(" 30 minutos ",-1)])]),_:1}),s(e(p),{type:"button",variant:"outline",size:"sm",onClick:t[8]||(t[8]=n=>e(a).cache_duration=3600)},{default:l(()=>[...t[36]||(t[36]=[i(" 1 hora ",-1)])]),_:1})])])]),_:1})]),_:1})]),_:1}),s(e(V),{value:"roles"},{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(x),null,{default:l(()=>[s(e(b),null,{default:l(()=>[...t[37]||(t[37]=[i("Roles Asociados",-1)])]),_:1}),s(e(S),null,{default:l(()=>[...t[38]||(t[38]=[i(" Vincula este segmento con roles específicos para delimitar el alcance de datos ",-1)])]),_:1})]),_:1}),s(e($),null,{default:l(()=>[d.roles.length>0?(g(),v("div",De,[(g(!0),v(U,null,h(d.roles,n=>(g(),v("div",{key:n.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[s(e(Z),{checked:e(a).role_ids.includes(n.id),"onUpdate:checked":f=>R(n.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),o("div",Ue,[s(e(c),{class:"text-sm font-medium cursor-pointer"},{default:l(()=>[i(m(n.display_name),1)]),_:2},1024),o("p",he,m(n.description||"Sin descripción"),1),s(e(ee),{variant:"outline",class:"mt-2"},{default:l(()=>[i(m(n.name),1)]),_:2},1024)])]))),128))])):(g(),v("div",Ee," No hay roles disponibles ")),s(_,{message:e(a).errors.role_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),o("div",Le,[s(e(D),{href:r.route("admin.segments.index")},{default:l(()=>[s(e(p),{type:"button",variant:"outline"},{default:l(()=>[...t[39]||(t[39]=[i(" Cancelar ",-1)])]),_:1})]),_:1},8,["href"]),s(e(p),{type:"submit",disabled:e(a).processing},{default:l(()=>[s(e(fe),{class:"mr-2 h-4 w-4"}),i(" "+m(e(a).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{Xt as default};
