import{_ as ie,a as te,b as oe,c as se}from"./CardTitle.vue_vue_type_script_setup_true_lang-DiDSRsNr.js";import{_ as M}from"./Label.vue_vue_type_script_setup_true_lang-UcaRVaEG.js";import{_ as U,a as D,b as E,c as A,d as L}from"./SelectValue.vue_vue_type_script_setup_true_lang-00hBXGh6.js";import{d as de,k,c as v,bT as re,p as ue,j as h,o as u,l as X,u as t,n as ne,e as s,i as f,b as d,f as Y,g as _,t as c,a as p,r as P,F,J as g}from"./app-8pO39dLK.js";const ce={class:"text-sm text-muted-foreground"},me={class:"w-full"},pe={key:0,class:"text-xs text-muted-foreground mt-1"},_e={key:0,class:"w-full"},ve={key:0,class:"text-xs text-muted-foreground mt-1"},fe={key:1,class:"w-full"},he={key:0,class:"text-xs text-muted-foreground mt-1"},ge={key:2,class:"w-full"},ye={key:0,class:"text-xs text-muted-foreground mt-1"},Se=de({__name:"GeographicSelector",props:{modelValue:{default:()=>({territorios_ids:[],departamentos_ids:[],municipios_ids:[],localidades_ids:[]})},disabled:{type:Boolean,default:!1},title:{default:"Ubicación Geográfica"},description:{default:"Selecciona la ubicación"},mode:{default:"multiple"},showCard:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(Z,{emit:I}){const n=Z,ee=I,q=k([]),x=k([]),C=k([]),j=k([]),m=k(!1),o=v(()=>n.mode==="multiple"),y=v(()=>{var e,a;if(o.value)return((e=n.modelValue)==null?void 0:e.territorios_ids)||[];{const l=(a=n.modelValue)==null?void 0:a.territorio_id;return l?[l]:[]}}),b=v(()=>{var e,a;if(o.value)return((e=n.modelValue)==null?void 0:e.departamentos_ids)||[];{const l=(a=n.modelValue)==null?void 0:a.departamento_id;return l?[l]:[]}}),w=v(()=>{var e,a;if(o.value)return((e=n.modelValue)==null?void 0:e.municipios_ids)||[];{const l=(a=n.modelValue)==null?void 0:a.municipio_id;return l?[l]:[]}}),G=v(()=>{var e,a;if(o.value)return((e=n.modelValue)==null?void 0:e.localidades_ids)||[];{const l=(a=n.modelValue)==null?void 0:a.localidad_id;return l?[l]:[]}}),H=re();v(()=>{var e;return((e=H.props.auth)==null?void 0:e.isAdmin)||!1});const ae=v(()=>{var e;return!!((e=H.props.auth)!=null&&e.user)}),B=v(()=>ae.value?window.location.pathname.startsWith("/admin")?"/admin/geographic":"/api/geographic":"/api/public/geographic"),le=async()=>{try{m.value=!0;const e=await fetch(`${B.value}/territorios`);q.value=await e.json()}catch(e){console.error("Error loading territorios:",e)}finally{m.value=!1}},z=async e=>{if(!e.length){x.value=[];return}try{m.value=!0;const a=await fetch(`${B.value}/departamentos?territorio_ids=${e.join(",")}`);x.value=await a.json()}catch(a){console.error("Error loading departamentos:",a)}finally{m.value=!1}},J=async e=>{if(!e.length){C.value=[];return}try{m.value=!0;const a=await fetch(`${B.value}/municipios?departamento_ids=${e.join(",")}`);C.value=await a.json()}catch(a){console.error("Error loading municipios:",a)}finally{m.value=!1}},W=async e=>{if(!e.length){j.value=[];return}try{m.value=!0;const a=await fetch(`${B.value}/localidades?municipio_ids=${e.join(",")}`);j.value=await a.json()}catch(a){console.error("Error loading localidades:",a)}finally{m.value=!1}},N=(e,a)=>{var V,$,S,i,K,O,Q,R;let l;if(o.value){const r=Array.isArray(e)?e.map(Number).filter(Boolean):e?[Number(e)].filter(Boolean):[];l={territorios_ids:((V=n.modelValue)==null?void 0:V.territorios_ids)||[],departamentos_ids:(($=n.modelValue)==null?void 0:$.departamentos_ids)||[],municipios_ids:((S=n.modelValue)==null?void 0:S.municipios_ids)||[],localidades_ids:((i=n.modelValue)==null?void 0:i.localidades_ids)||[]},a==="territorio"?(l.territorios_ids=r,l.departamentos_ids=[],l.municipios_ids=[],l.localidades_ids=[],g(()=>z(r))):a==="departamento"?(l.departamentos_ids=r,l.municipios_ids=[],l.localidades_ids=[],g(()=>J(r))):a==="municipio"?(l.municipios_ids=r,l.localidades_ids=[],g(()=>W(r))):a==="localidad"&&(l.localidades_ids=r)}else{const r=e?Number(e):void 0;l={territorio_id:(K=n.modelValue)==null?void 0:K.territorio_id,departamento_id:(O=n.modelValue)==null?void 0:O.departamento_id,municipio_id:(Q=n.modelValue)==null?void 0:Q.municipio_id,localidad_id:(R=n.modelValue)==null?void 0:R.localidad_id},a==="territorio"?(l.territorio_id=r,l.departamento_id=void 0,l.municipio_id=void 0,l.localidad_id=void 0,g(()=>z(r?[r]:[]))):a==="departamento"?(l.departamento_id=r,l.municipio_id=void 0,l.localidad_id=void 0,g(()=>J(r?[r]:[]))):a==="municipio"?(l.municipio_id=r,l.localidad_id=void 0,g(()=>W(r?[r]:[]))):a==="localidad"&&(l.localidad_id=r)}ee("update:modelValue",l)};ue(async()=>{await le(),y.value.length&&await z(y.value),b.value.length&&await J(b.value),w.value.length&&await W(w.value)});const T=(e,a,l)=>o.value?`${e} ${e===1?a:l} seleccionado${e===1?"":"s"}`:"";return(e,a)=>(u(),h(X(e.showCard?t(ie):"div"),{class:ne(e.showCard?"border-dashed":"")},{default:s(()=>[e.showCard?(u(),h(t(te),{key:0},{default:s(()=>[d(t(oe),{class:"text-base"},{default:s(()=>[_(c(e.title),1)]),_:1}),Y("p",ce,c(e.description),1)]),_:1})):f("",!0),(u(),h(X(e.showCard?t(se):"div"),{class:"space-y-4"},{default:s(()=>{var l,V,$,S;return[Y("div",me,[d(t(M),null,{default:s(()=>[_("Territorio"+c(o.value?"s":""),1)]),_:1}),d(t(U),{"model-value":o.value?y.value.map(i=>i.toString()):((l=y.value[0])==null?void 0:l.toString())||"","onUpdate:modelValue":a[0]||(a[0]=i=>N(i,"territorio")),multiple:o.value,disabled:e.disabled||m.value},{default:s(()=>[d(t(D),{class:"w-full"},{default:s(()=>[d(t(E),{placeholder:`Seleccionar territorio${o.value?"s":""}...`},null,8,["placeholder"])]),_:1}),d(t(A),null,{default:s(()=>[(u(!0),p(F,null,P(q.value,i=>(u(),h(t(L),{key:i.id,value:i.id.toString()},{default:s(()=>[_(c(i.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(u(),p("p",pe,c(T(y.value.length,"territorio","territorios")),1)):f("",!0)]),x.value.length>0?(u(),p("div",_e,[d(t(M),null,{default:s(()=>[_("Departamento"+c(o.value?"s":""),1)]),_:1}),d(t(U),{"model-value":o.value?b.value.map(i=>i.toString()):((V=b.value[0])==null?void 0:V.toString())||"","onUpdate:modelValue":a[1]||(a[1]=i=>N(i,"departamento")),multiple:o.value,disabled:e.disabled||m.value},{default:s(()=>[d(t(D),{class:"w-full"},{default:s(()=>[d(t(E),{placeholder:`Seleccionar departamento${o.value?"s":""}...`},null,8,["placeholder"])]),_:1}),d(t(A),null,{default:s(()=>[(u(!0),p(F,null,P(x.value,i=>(u(),h(t(L),{key:i.id,value:i.id.toString()},{default:s(()=>[_(c(i.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(u(),p("p",ve,c(T(b.value.length,"departamento","departamentos")),1)):f("",!0)])):f("",!0),C.value.length>0?(u(),p("div",fe,[d(t(M),null,{default:s(()=>[_("Municipio"+c(o.value?"s":""),1)]),_:1}),d(t(U),{"model-value":o.value?w.value.map(i=>i.toString()):(($=w.value[0])==null?void 0:$.toString())||"","onUpdate:modelValue":a[2]||(a[2]=i=>N(i,"municipio")),multiple:o.value,disabled:e.disabled||m.value},{default:s(()=>[d(t(D),{class:"w-full"},{default:s(()=>[d(t(E),{placeholder:`Seleccionar municipio${o.value?"s":""}...`},null,8,["placeholder"])]),_:1}),d(t(A),null,{default:s(()=>[(u(!0),p(F,null,P(C.value,i=>(u(),h(t(L),{key:i.id,value:i.id.toString()},{default:s(()=>[_(c(i.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(u(),p("p",he,c(T(w.value.length,"municipio","municipios")),1)):f("",!0)])):f("",!0),j.value.length>0?(u(),p("div",ge,[d(t(M),null,{default:s(()=>[_("Localidad"+c(o.value?"es":""),1)]),_:1}),d(t(U),{"model-value":o.value?G.value.map(i=>i.toString()):((S=G.value[0])==null?void 0:S.toString())||"","onUpdate:modelValue":a[3]||(a[3]=i=>N(i,"localidad")),multiple:o.value,disabled:e.disabled||m.value},{default:s(()=>[d(t(D),{class:"w-full"},{default:s(()=>[d(t(E),{placeholder:`Seleccionar localidad${o.value?"es":""}...`},null,8,["placeholder"])]),_:1}),d(t(A),null,{default:s(()=>[(u(!0),p(F,null,P(j.value,i=>(u(),h(t(L),{key:i.id,value:i.id.toString()},{default:s(()=>[_(c(i.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(u(),p("p",ye,c(T(G.value.length,"localidad","localidades")),1)):f("",!0)])):f("",!0)]}),_:1}))]),_:1},8,["class"]))}});export{Se as _};
