import{d as $,C as w,k as O,c as b,a as F,o as G,b as i,u as s,m as k,e as n,f as a,t as c,g as m,n as N,h as E,F as R,W as S}from"./app-DLtGX5Qt.js";import{_ as I}from"./index-Dd_mJrj8.js";import{_ as T}from"./createLucideIcon-Dkyf0ol9.js";import{_ as D,c as A,a as P,b as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-Co41z9Fi.js";import{_ as q,a as B,b as U,c as L,d as j,e as J,f as K,g as W}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-CQDVdWvI.js";import{_ as X}from"./UserLayout.vue_vue_type_script_setup_true_lang-CVAl5jRq.js";import{D as H}from"./DynamicFormRenderer-DOx6T1zn.js";import{A as Z}from"./arrow-left-r7U85gMs.js";import{C as Q}from"./clock-Buu8HuKc.js";import{T as Y}from"./triangle-alert-8nZo_B1S.js";import{V}from"./vote-DqjfNPob.js";import"./index-BvT5vxZ2.js";import"./VisuallyHidden-BoG3gtOX.js";import"./Input.vue_vue_type_script_setup_true_lang-7ZEMGRmn.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CKkCSvH1.js";import"./PopperContent-BKTEdvgV.js";import"./floating-ui.vue-BR3vkAxW.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-D0xGkYSt.js";import"./check-CY0rU9Op.js";import"./nullish-CHIgUVhi.js";import"./x-DatQfog6.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-CTQpPgri.js";import"./index-kXO2DGBO.js";import"./index-C9obqnHf.js";import"./shield-CfmIBwYY.js";import"./user-B2Cpm2T0.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BXSN56bN.js";import"./Label.vue_vue_type_script_setup_true_lang-DlQMMs8Q.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DUV-Q_i-.js";import"./index-VOVChzYe.js";import"./circle-alert-ChcOZlmI.js";import"./map-pin-kb9yj2dv.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BS5YH57z.js";import"./square-check-big-CT5inqd1.js";import"./file-text-Ct1bDYn7.js";import"./users-DveyALIl.js";import"./index-B-3bJqdI.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-DbFs4sm5.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DH1J2n-h.js";import"./Textarea.vue_vue_type_script_setup_true_lang-DtUs5ME7.js";import"./plus-CHaJlVBC.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Bx5720yk.js";import"./RovingFocusItem-Cbt3xgLf.js";import"./utils-DVLoAl8m.js";import"./VisuallyHiddenInput-CHYLy1Te.js";import"./useConditionalFields-BKrdimkp.js";import"./upload-BEjliTVL.js";import"./eye-Dy-0bWIb.js";import"./download-lb8wF7as.js";import"./calendar-Qt9nf8nq.js";import"./grip-vertical-rECENfqJ.js";import"./trash-2-CpfCCf4k.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oo={class:"flex h-full flex-1 flex-col gap-6 rounded-xl p-4"},eo={class:"flex items-center justify-between"},to={class:"text-3xl font-bold"},so={class:"text-muted-foreground"},io={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ao={class:"flex items-center gap-2"},no={class:"flex items-center gap-2 text-sm text-muted-foreground"},ro={class:"flex items-center gap-2 text-sm"},lo={class:"mt-4 pt-4 border-t"},co={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},mo={class:"text-muted-foreground"},uo={class:"mt-1"},po={class:"text-muted-foreground"},fo={class:"mt-1 font-semibold text-primary"},go={class:"text-xs text-muted-foreground ml-1"},vo={class:"flex justify-end pt-6 border-t"},_e=$({__name:"Votar",props:{votacion:{},candidatosElegibles:{}},setup(y){const r=y,x=[{title:"Dashboard",href:"/miembro/dashboard"},{title:"Mis Votaciones",href:"/miembro/votaciones"},{title:"Votar",href:"#"}],l=w((()=>{const t={};return r.votacion.formulario_config.forEach(o=>{o.type==="checkbox"?t[o.id]=[]:o.type==="convocatoria"?t[o.id]=void 0:t[o.id]=""}),{respuestas:t}})()),d=O(!1),h=()=>{var o;console.log("=== INICIANDO ENVÍO DE VOTO ==="),console.log("Timestamp:",new Date().toISOString()),console.log("Votación ID:",r.votacion.id),console.log("Form data:",JSON.stringify(l.respuestas,null,2)),console.log("Form errors antes de envío:",l.errors),console.log("Form processing state:",l.processing),console.log("Route generada:",route("user.votaciones.store",{votacion:r.votacion.id})),console.log("Dialog open state:",d.value);const t=window.event;t&&(console.log("Event detected:",t.type),t.preventDefault&&(t.preventDefault(),console.log("preventDefault called on event")));try{console.log("Enviando POST request..."),l.post(route("user.votaciones.store",{votacion:r.votacion.id}),{preserveScroll:!0,preserveState:!1,onStart:()=>{console.log("Request started"),console.log("Form processing:",l.processing)},onProgress:e=>{console.log("Upload progress:",e)},onSuccess:e=>{console.log("=== VOTO ENVIADO EXITOSAMENTE ==="),console.log("Response page:",e),console.log("Props after success:",e.props)},onError:e=>{console.error("=== ERROR AL ENVIAR VOTO ==="),console.error("Errores de validación:",e),console.error("Form errors después:",l.errors),console.error("Form data en error:",l.respuestas),alert(`Error al enviar voto: ${JSON.stringify(e)}`)},onFinish:()=>{console.log("Request finished"),console.log("Form processing final:",l.processing),console.log("Dialog state final:",d.value)},onCancel:()=>{console.log("Request was cancelled")}}),console.log("POST request initiated")}catch(e){console.error("=== EXCEPCIÓN CAPTURADA ==="),console.error("Error type:",(o=e==null?void 0:e.constructor)==null?void 0:o.name),console.error("Error message:",e==null?void 0:e.message),console.error("Error stack:",e==null?void 0:e.stack),console.error("Full error:",e),alert(`Excepción al enviar voto: ${(e==null?void 0:e.message)||"Error desconocido"}`)}console.log("submitVote function completed")},C=()=>{S.get(route("user.votaciones.index"))},v=t=>({"America/Bogota":"GMT-5","America/Mexico_City":"GMT-6","America/Lima":"GMT-5","America/Argentina/Buenos_Aires":"GMT-3","America/Santiago":"GMT-3","America/Caracas":"GMT-4","America/La_Paz":"GMT-4","America/Guayaquil":"GMT-5","America/Asuncion":"GMT-3","America/Montevideo":"GMT-3","America/Panama":"GMT-5","America/Costa_Rica":"GMT-6","America/Guatemala":"GMT-6","America/Havana":"GMT-5","America/Santo_Domingo":"GMT-4"})[t]||t,f=(t,o=!0)=>{const e=t.includes("local")?t:t===r.votacion.fecha_inicio&&r.votacion.fecha_inicio_local?r.votacion.fecha_inicio_local:t===r.votacion.fecha_fin&&r.votacion.fecha_fin_local?r.votacion.fecha_fin_local:t,u=new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(o&&r.votacion.timezone){const p=v(r.votacion.timezone);return`${u} (${p})`}return u},g=b(()=>{const t=new Date,e=new Date(r.votacion.fecha_fin_local||r.votacion.fecha_fin).getTime()-t.getTime();if(e<=0)return"Expirada";const u=Math.floor(e/(1e3*60*60)),p=Math.floor(e%(1e3*60*60)/(1e3*60));if(u>24){const _=Math.floor(u/24);return`${_} día${_>1?"s":""}`}else return u>0?`${u}h ${p}m`:`${p}m`}),M=b(()=>r.votacion.formulario_config.every(t=>{const o=l.respuestas[t.id];return t.type==="convocatoria"?o!==void 0:t.required?t.type==="checkbox"?Array.isArray(o)&&o.length>0:o&&o.toString().trim()!=="":!0}));return(t,o)=>(G(),F(R,null,[i(s(k),{title:`Votar: ${t.votacion.titulo}`},null,8,["title"]),i(X,{breadcrumbs:x},{default:n(()=>[a("div",oo,[a("div",eo,[a("div",null,[a("h1",to,c(t.votacion.titulo),1),a("p",so,c(t.votacion.descripcion),1)]),i(s(T),{variant:"outline",onClick:C},{default:n(()=>[i(s(Z),{class:"mr-2 h-4 w-4"}),o[8]||(o[8]=m(" Volver ",-1))]),_:1})]),i(s(D),null,{default:n(()=>[i(s(A),{class:"pt-6"},{default:n(()=>[a("div",io,[a("div",ao,[i(s(I),{variant:"outline"},{default:n(()=>[m(c(t.votacion.categoria.nombre),1)]),_:1})]),a("div",no,[i(s(Q),{class:"h-4 w-4"}),m(" Termina: "+c(f(t.votacion.fecha_fin)),1)]),a("div",ro,[i(s(Y),{class:"h-4 w-4 text-orange-600"}),a("span",{class:N(g.value==="Expirada"?"text-red-600":"text-orange-600")},c(g.value==="Expirada"?"Votación expirada":`Tiempo restante: ${g.value}`),3)])]),a("div",lo,[a("div",co,[a("div",mo,[o[9]||(o[9]=a("span",{class:"font-medium"},"Periodo de votación:",-1)),a("div",uo," Inicio: "+c(f(t.votacion.fecha_inicio)),1),a("div",null," Fin: "+c(f(t.votacion.fecha_fin)),1)]),a("div",po,[o[10]||(o[10]=a("span",{class:"font-medium"},"Zona horaria:",-1)),a("div",fo,[m(c(v(t.votacion.timezone))+" ",1),a("span",go,"("+c(t.votacion.timezone)+")",1)])])])])]),_:1})]),_:1}),i(s(D),null,{default:n(()=>[i(s(P),null,{default:n(()=>[i(s(z),{class:"flex items-center gap-2"},{default:n(()=>[i(s(V),{class:"h-5 w-5"}),o[11]||(o[11]=m(" Formulario de Votación ",-1))]),_:1})]),_:1}),i(s(A),null,{default:n(()=>[a("form",{onSubmit:o[1]||(o[1]=E(e=>{console.log("=== FORM SUBMIT EVENT ==="),console.log("Event type:",e.type),console.log("Default prevented by Vue"),console.log("Opening dialog..."),d.value=!0,console.log("Dialog opened:",d.value)},["prevent"])),class:"space-y-6"},[i(H,{fields:t.votacion.formulario_config,modelValue:s(l).respuestas,"onUpdate:modelValue":o[0]||(o[0]=e=>s(l).respuestas=e),"candidatos-elegibles":t.candidatosElegibles||{},errors:s(l).errors,disabled:s(l).processing,title:"",description:"",context:"votacion"},null,8,["fields","modelValue","candidatos-elegibles","errors","disabled"]),a("div",vo,[i(s(T),{type:"submit",disabled:!M.value||s(l).processing,class:"min-w-32"},{default:n(()=>[i(s(V),{class:"mr-2 h-4 w-4"}),m(" "+c(s(l).processing?"Enviando...":"Enviar Voto"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),i(s(q),{open:d.value,"onUpdate:open":[o[6]||(o[6]=e=>d.value=e),o[7]||(o[7]=e=>{console.log("Dialog state changed to:",e)})]},{default:n(()=>[i(s(B),{onEscapeKeyDown:o[4]||(o[4]=e=>{console.log("Escape key pressed in dialog")}),onPointerDownOutside:o[5]||(o[5]=e=>{console.log("Clicked outside dialog")})},{default:n(()=>[i(s(U),null,{default:n(()=>[i(s(L),null,{default:n(()=>[...o[12]||(o[12]=[m("¿Confirmar voto?",-1)])]),_:1}),i(s(j),null,{default:n(()=>[...o[13]||(o[13]=[m(" Una vez enviado tu voto, no podrás modificarlo. ¿Estás seguro de que quieres proceder? ",-1)])]),_:1})]),_:1}),i(s(J),null,{default:n(()=>[i(s(K),{onClick:o[2]||(o[2]=()=>{console.log("Cancel button clicked"),d.value=!1})},{default:n(()=>[...o[14]||(o[14]=[m("Cancelar",-1)])]),_:1}),i(s(W),{onClick:o[3]||(o[3]=E(e=>{console.log("=== CONFIRM BUTTON CLICKED ==="),console.log("Event:",e),console.log("Preventing default action"),e.preventDefault(),e.stopPropagation(),console.log("Calling submitVote..."),h(),console.log("submitVote called, closing dialog"),d.value=!1},["prevent"])),class:"bg-primary"},{default:n(()=>[...o[15]||(o[15]=[m(" Confirmar Voto ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{_e as default};
