import{d as ae,C as te,k as g,c as y,w as N,p as re,A as se,a as b,o as u,b as t,f as r,u as e,m as ie,M as le,j as f,i as c,e as i,g as d,t as p,F as j,r as ne,Q as ue,W as de}from"./app-uqgoC9P3.js";import{_ as M}from"./createLucideIcon-DYYZ8d8j.js";import{c as F,_ as B,a as z,b as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-DYxclH40.js";import{_ as q}from"./CardDescription.vue_vue_type_script_setup_true_lang-DtaWd4Ev.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-BUQ8h4mk.js";import{_ as k}from"./Label.vue_vue_type_script_setup_true_lang-C0Y6AGVd.js";import{_ as I,a as R}from"./index-C7SbJWMd.js";import{_ as me}from"./index-Ch-ylojk.js";import{_ as fe}from"./Progress.vue_vue_type_script_setup_true_lang-DLeRnWnx.js";import{D as ce}from"./DynamicFormRenderer-6Ce0xEIi.js";import{u as pe}from"./useAutoSave-CewnDYnZ.js";import{t as v}from"./index-JMjM76-u.js";import{C as W}from"./circle-check-B19Csebw.js";import{C as G}from"./circle-alert-D1W5s3bu.js";import{L as O}from"./loader-circle-DT3sWtG_.js";import{C as ve}from"./clock-Xir7CfmS.js";import{S as _e}from"./save-BjI1ry-M.js";import{S as ge}from"./send-DtqRGMRz.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-3PJFboPx.js";import"./VisuallyHidden-D4UYEJiU.js";import"./nullish-CHIgUVhi.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-pqHpkWWC.js";import"./index-BwwIHVWL.js";import"./floating-ui.vue-9q4rJ5MR.js";import"./check-DIu3_Sq6.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-WmfZ5qRR.js";import"./PopperContent-bQryVTkf.js";import"./Textarea.vue_vue_type_script_setup_true_lang-X9kLRArE.js";import"./plus-DA0fGvSy.js";import"./user-CjmsF3u4.js";import"./file-text-E2I6sKSt.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Dhz-N00G.js";import"./RovingFocusItem-DHriXEq5.js";import"./utils-BxRIveoW.js";import"./VisuallyHiddenInput-DaG3v3Va.js";import"./users-sB3os_bH.js";import"./useConditionalFields-4W4E_0E0.js";import"./upload-CuuYaseO.js";import"./eye-CG1F308a.js";import"./download-_FkkBxqq.js";import"./x-CVrJT_FT.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-D7Yoy2IF.js";import"./calendar-ChB8nT0z.js";import"./grip-vertical-Dkqk6v0b.js";import"./trash-2-BRDtwBGY.js";const he={class:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"},we={class:"bg-white border-b"},xe={class:"container mx-auto px-4 py-6"},ye={class:"max-w-4xl mx-auto"},Ve={class:"text-3xl font-bold text-gray-900"},ke={key:1,class:"text-gray-600 mt-2"},Se={class:"container mx-auto px-4 py-8"},Ce={class:"max-w-4xl mx-auto"},$e={class:"flex items-center justify-between mb-2"},Fe={class:"text-sm text-muted-foreground"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"flex items-center gap-2 text-green-600"},De={class:"list-disc list-inside mt-2"},Te={class:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t shadow-lg z-50"},Le={class:"container mx-auto px-4"},Ae={class:"max-w-4xl mx-auto py-4"},Ue={class:"flex items-center justify-between"},Ne={class:"flex items-center gap-4"},je={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},Me={key:1,class:"flex items-center gap-2 text-sm text-green-600"},ze={class:"hidden md:flex items-center gap-2 text-sm text-muted-foreground"},Pe={class:"flex items-center gap-2"},qe=ae({__name:"Show",props:{formulario:{},respuestaBorrador:{},esVisitante:{type:Boolean}},setup(K){var A,U;const s=K,l=te({respuestas:((A=s.respuestaBorrador)==null?void 0:A.respuestas)||{},nombre_visitante:"",email_visitante:"",telefono_visitante:"",documento_visitante:"",captcha:""}),w=g((()=>{var o;const a={};return(o=s.respuestaBorrador)!=null&&o.respuestas&&Object.assign(a,s.respuestaBorrador.respuestas),s.formulario.configuracion_campos&&Array.isArray(s.formulario.configuracion_campos)&&s.formulario.configuracion_campos.forEach(n=>{if(!(n.id in a))switch(n.type){case"checkbox":a[n.id]=!1;break;case"number":a[n.id]=0;break;case"select":case"radio":a[n.id]="";break;default:a[n.id]=""}}),a})());g(0),y(()=>1);const S=y(()=>s.formulario.configuracion_campos&&Array.isArray(s.formulario.configuracion_campos)&&s.formulario.configuracion_campos.length>0),m=g(!1),Q=g(!0),C=g(null),_=y(()=>{const a=s.formulario.configuracion_campos.length,o=Object.keys(l.respuestas).filter(n=>{const h=l.respuestas[n];return h!==null&&h!==""&&h!==void 0}).length;return a>0?Math.round(o/a*100):0}),{state:E,isSaving:x,hasSaved:D,saveNow:H,startWatching:$,stopWatching:T,clearLocalStorage:J}=pe(w||g({}),{url:route("api.formularios.autosave"),resourceId:((U=s.respuestaBorrador)==null?void 0:U.id)||null,resourceIdField:"respuesta_id",debounceTime:3e3,showNotifications:!1,useLocalStorage:!0,localStorageKey:`formulario_${s.formulario.slug}_draft`,additionalData:{formulario_id:s.formulario.id}});N(w,a=>{a&&(l.respuestas=a)},{deep:!0}),N(()=>E.value.status,a=>{a==="saved"&&(C.value=E.value.lastSaved)}),re(()=>{s.esVisitante||$(),window.addEventListener("beforeunload",L)}),se(()=>{s.esVisitante||T(),window.removeEventListener("beforeunload",L)});const L=a=>{(x.value||_.value>0&&_.value<100)&&(a.preventDefault(),a.returnValue="¿Estás seguro de que quieres salir? Los cambios no guardados se perderán.")},X=()=>{const a=s.formulario.configuracion_campos||[];for(const o of a)if(o.required&&!l.respuestas[o.id])return v.error(`El campo "${o.title}" es requerido`),!1;if(s.esVisitante){if(!l.nombre_visitante||!l.email_visitante)return v.error("Por favor completa tu nombre y email"),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email_visitante))return v.error("Por favor ingresa un email válido"),!1}return!0},Y=async()=>{if(X()){m.value=!0,s.esVisitante||T();try{const a={...l.data(),formulario_id:s.formulario.id};await de.post(route("formularios.store",s.formulario.slug),a,{preserveScroll:!0,onSuccess:()=>{J(),v.success("Formulario enviado exitosamente")},onError:o=>{v.error("Error al enviar el formulario"),console.error(o),m.value=!1,s.esVisitante||$()}})}catch{v.error("Error inesperado al enviar el formulario"),m.value=!1,s.esVisitante||$()}}},Z=()=>{s.esVisitante||(H(),v.success("Borrador guardado"))},ee=y(()=>{if(!C.value)return"";const o=Math.floor((new Date().getTime()-C.value.getTime())/1e3);return o<60?"hace unos segundos":o<3600?`hace ${Math.floor(o/60)} minutos`:o<86400?`hace ${Math.floor(o/3600)} horas`:"hace más de un día"}),oe=a=>{w.value=a||{}};return(a,o)=>(u(),b(j,null,[t(e(ie),{title:a.formulario.titulo},null,8,["title"]),r("div",he,[r("div",we,[r("div",xe,[r("div",ye,[a.formulario.categoria?(u(),f(e(me),{key:0,class:"mb-2"},{default:i(()=>[d(p(a.formulario.categoria.nombre),1)]),_:1})):c("",!0),r("h1",Ve,p(a.formulario.titulo),1),a.formulario.descripcion?(u(),b("p",ke,p(a.formulario.descripcion),1)):c("",!0)])])]),r("div",Se,[r("div",Ce,[t(e(B),{class:"mb-6"},{default:i(()=>[t(e(F),{class:"py-4"},{default:i(()=>[r("div",$e,[o[4]||(o[4]=r("span",{class:"text-sm font-medium"},"Progreso del formulario",-1)),r("span",Fe,p(_.value)+"% completado",1)]),t(e(fe),{value:_.value,class:"h-2"},null,8,["value"])]),_:1})]),_:1}),a.esVisitante?(u(),f(e(B),{key:0,class:"mb-6"},{default:i(()=>[t(e(z),null,{default:i(()=>[t(e(P),null,{default:i(()=>[...o[5]||(o[5]=[d("Información de contacto",-1)])]),_:1}),t(e(q),null,{default:i(()=>[...o[6]||(o[6]=[d(" Por favor proporciona tus datos para poder contactarte ",-1)])]),_:1})]),_:1}),t(e(F),{class:"space-y-4"},{default:i(()=>[r("div",Be,[r("div",null,[t(e(k),{htmlFor:"nombre"},{default:i(()=>[...o[7]||(o[7]=[d("Nombre completo *",-1)])]),_:1}),t(e(V),{id:"nombre",modelValue:e(l).nombre_visitante,"onUpdate:modelValue":o[0]||(o[0]=n=>e(l).nombre_visitante=n),placeholder:"Tu nombre completo",disabled:m.value},null,8,["modelValue","disabled"])]),r("div",null,[t(e(k),{htmlFor:"email"},{default:i(()=>[...o[8]||(o[8]=[d("Correo electrónico *",-1)])]),_:1}),t(e(V),{id:"email",type:"email",modelValue:e(l).email_visitante,"onUpdate:modelValue":o[1]||(o[1]=n=>e(l).email_visitante=n),placeholder:"tu@email.com",disabled:m.value},null,8,["modelValue","disabled"])]),r("div",null,[t(e(k),{htmlFor:"telefono"},{default:i(()=>[...o[9]||(o[9]=[d("Teléfono",-1)])]),_:1}),t(e(V),{id:"telefono",modelValue:e(l).telefono_visitante,"onUpdate:modelValue":o[2]||(o[2]=n=>e(l).telefono_visitante=n),placeholder:"Tu número de teléfono",disabled:m.value},null,8,["modelValue","disabled"])]),r("div",null,[t(e(k),{htmlFor:"documento"},{default:i(()=>[...o[10]||(o[10]=[d("Documento de identidad",-1)])]),_:1}),t(e(V),{id:"documento",modelValue:e(l).documento_visitante,"onUpdate:modelValue":o[3]||(o[3]=n=>e(l).documento_visitante=n),placeholder:"Tu número de documento",disabled:m.value},null,8,["modelValue","disabled"])])])]),_:1})]),_:1})):c("",!0),t(e(B),{class:"mb-20"},{default:i(()=>[t(e(z),null,{default:i(()=>[t(e(P),null,{default:i(()=>[...o[11]||(o[11]=[d("Completa el formulario",-1)])]),_:1}),!a.esVisitante&&e(D)?(u(),f(e(q),{key:0},{default:i(()=>[r("div",Ee,[t(e(W),{class:"h-4 w-4"}),d(" Autoguardado "+p(ee.value),1)])]),_:1})):c("",!0)]),_:1}),t(e(F),null,{default:i(()=>[S.value?c("",!0):(u(),f(e(I),{key:0,variant:"destructive",class:"mb-4"},{default:i(()=>[t(e(G),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>[...o[12]||(o[12]=[d(" Este formulario no tiene campos configurados. Por favor, contacta al administrador. ",-1)])]),_:1})]),_:1})),S.value?(u(),f(ce,{key:1,fields:a.formulario.configuracion_campos||[],"model-value":w.value||{},disabled:m.value,"onUpdate:modelValue":oe},null,8,["fields","model-value","disabled"])):c("",!0)]),_:1})]),_:1}),e(l).errors&&Object.keys(e(l).errors).length>0?(u(),f(e(I),{key:1,class:"mb-6",variant:"destructive"},{default:i(()=>[t(e(G),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>[r("ul",De,[(u(!0),b(j,null,ne(e(l).errors,(n,h)=>(u(),b("li",{key:h},p(n),1))),128))])]),_:1})]),_:1})):c("",!0)])]),le(r("div",Te,[r("div",Le,[r("div",Ae,[r("div",Ue,[r("div",Ne,[e(x)?(u(),b("div",je,[t(e(O),{class:"h-4 w-4 animate-spin"}),o[13]||(o[13]=d(" Guardando... ",-1))])):e(D)&&!a.esVisitante?(u(),b("div",Me,[t(e(W),{class:"h-4 w-4"}),o[14]||(o[14]=d(" Guardado ",-1))])):c("",!0),r("div",ze,[t(e(ve),{class:"h-4 w-4"}),d(" "+p(_.value)+"% completado ",1)])]),r("div",Pe,[a.esVisitante?c("",!0):(u(),f(e(M),{key:0,variant:"outline",size:"sm",onClick:Z,disabled:e(x)||m.value},{default:i(()=>[t(e(_e),{class:"mr-2 h-4 w-4"}),o[15]||(o[15]=d(" Guardar borrador ",-1))]),_:1},8,["disabled"])),t(e(M),{size:"sm",onClick:Y,disabled:m.value||e(x)||_.value===0||!S.value},{default:i(()=>[m.value?(u(),f(e(O),{key:1,class:"mr-2 h-4 w-4 animate-spin"})):(u(),f(e(ge),{key:0,class:"mr-2 h-4 w-4"})),d(" "+p(m.value?"Enviando...":"Enviar formulario"),1)]),_:1},8,["disabled"])])])])])],512),[[ue,Q.value]])])],64))}}),No=be(qe,[["__scopeId","data-v-0c793f21"]]);export{No as default};
