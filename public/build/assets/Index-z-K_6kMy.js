import{d as ge,c as F,r as y,W as j,m as xe,b as f,e as i,w as a,g as r,f as t,i as c,j as p,t as d,u as e,P as R,h as n,F as A,k as U,q as he,G as ye}from"./app-p-SM0Ops.js";import{_ as be}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dz6BU1WZ.js";import{_ as b,a as P,b as S,c as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-DozlB1PY.js";import{c as $e,_ as k}from"./createLucideIcon-MIg_mF3D.js";import{_ as ke}from"./Input.vue_vue_type_script_setup_true_lang-K4vq7am0.js";import{_ as J}from"./index-CYyE4abP.js";import{_ as we,a as Ce,b as I,c as g,d as Ee,e as _}from"./TableHeader.vue_vue_type_script_setup_true_lang-BRMd8scN.js";import{_ as K,a as Q,b as X,c as Y,d as M,k as Ve,C as Pe}from"./SelectValue.vue_vue_type_script_setup_true_lang-DmzPrX3Z.js";import{_ as Se,a as De,b as Te,d as Be,e as Z,c as L}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-IihS8Mqq.js";import{_ as ee}from"./Checkbox.vue_vue_type_script_setup_true_lang-BVSuq_A7.js";import{_ as Fe}from"./Progress.vue_vue_type_script_setup_true_lang-BXlQYfAy.js";import{_ as je,a as Ae,b as Ue}from"./index-B8ZQ7oBZ.js";import{u as Me}from"./useToast-BD-4-pnA.js";import{l as Ne}from"./lodash-DeH_ma9Y.js";import{A as Re}from"./arrow-left-CfoQiZQI.js";import{P as Ie}from"./plus-BIpQAtiE.js";import{T as Le}from"./target-BcAOpLLG.js";import{C as te}from"./circle-check-DwpByXNT.js";import{C as qe}from"./clock-Dq08RDBb.js";import{C as q}from"./circle-alert-B1uyACGR.js";import{F as He}from"./filter-BbJeWGRV.js";import{S as ze}from"./search-nFjyMy1p.js";import{C as Ge}from"./calendar-BUpz3t_q.js";import{U as Oe}from"./users-CkPSsqjA.js";import{E as We}from"./ellipsis-B23Fgsj6.js";import{S as Je}from"./square-pen-BWVg_XIm.js";import{T as Ke}from"./trash-2-DCkletDg.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-V1RlDTXZ.js";import"./index-CV2_GSGp.js";import"./floating-ui.vue-BUomiQTN.js";import"./x-DIIigy9X.js";import"./shield-DhBDny61.js";import"./user-DA3oYWTo.js";import"./chevron-right-BbAT6tF1.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BGm8qVny.js";import"./VisuallyHidden-xAPYqC-I.js";import"./index-v7Q0x2oQ.js";import"./Label.vue_vue_type_script_setup_true_lang-DP74BK5K.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-RRitD80w.js";import"./index-BhJRJLQS.js";import"./map-pin-Bfx6LXpH.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DUTBsYNH.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CR-w-QPj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-DBABEqEn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DSG5kKOT.js";import"./tag-CxhrnRvl.js";import"./vote-CVUS9BZZ.js";import"./folder-open-CCLrFQyu.js";import"./send-DdhYBIuO.js";import"./file-text-jtWGolJY.js";import"./briefcase-BnY2GosT.js";import"./megaphone-5qsXSNwm.js";import"./user-check-BjIqumpS.js";import"./mail-DTHbsAgc.js";import"./message-square-DNZUf9k0.js";import"./external-link-CtMP5nJn.js";import"./panel-left-LG19zA78.js";import"./check-BZs3ZfEg.js";import"./index-B7vJyW42.js";import"./nullish-CHIgUVhi.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=$e("CircleDotIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),Xe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ye={class:"flex items-center justify-between"},Ze={class:"text-muted-foreground mt-2"},et={class:"flex gap-2"},tt={class:"grid gap-4 md:grid-cols-4"},st={class:"text-2xl font-bold"},at={class:"text-xs text-muted-foreground mt-2"},ot={class:"text-2xl font-bold"},lt={class:"text-xs text-muted-foreground"},rt={class:"text-2xl font-bold"},nt={class:"text-2xl font-bold"},it={class:"flex items-center justify-between"},dt={class:"grid gap-4 md:grid-cols-4"},ut={class:"relative"},mt={class:"font-medium"},ft={key:0,class:"text-sm text-muted-foreground"},ct={key:1,class:"flex items-center gap-1 mt-1"},pt={class:"text-xs text-red-600"},_t={key:2,class:"flex items-center gap-1 mt-1"},vt={class:"text-xs text-orange-600"},gt={key:0,class:"flex items-center gap-2"},xt={class:"text-sm"},ht={key:1,class:"text-sm text-muted-foreground"},yt={class:"flex items-center gap-1"},bt={class:"text-sm"},$t={key:0,class:"flex items-center gap-1"},kt={class:"text-sm"},wt={key:1,class:"text-sm text-muted-foreground"},Ct={key:0,class:"flex items-center justify-between"},Et={class:"text-sm text-muted-foreground"},Vt={class:"flex gap-2"},As=ge({__name:"Index",props:{proyecto:{},hito:{},entregables:{},filters:{},resumenUsuarios:{},estados:{},prioridades:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canAssign:{type:Boolean}},setup(se){var H,z,G,O,W;const u=se,{toast:D}=Me(),m=F(()=>Array.isArray(u.entregables)?{data:u.entregables,current_page:1,last_page:1,per_page:u.entregables.length,total:u.entregables.length,from:1,to:u.entregables.length}:u.entregables),w=y(((H=u.filters)==null?void 0:H.search)||""),C=y(((z=u.filters)==null?void 0:z.estado)||""),E=y(((G=u.filters)==null?void 0:G.prioridad)||""),N=y(((W=(O=u.filters)==null?void 0:O.responsable_id)==null?void 0:W.toString())||""),v=y([]),T=y(!1),ae=F(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:u.proyecto.nombre,href:`/admin/proyectos/${u.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${u.proyecto.id}/hitos`},{title:u.hito.nombre,href:`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}`},{title:"Entregables"}]),oe=Ne.debounce(()=>{j.get(`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}/entregables`,{search:w.value,estado:C.value,prioridad:E.value,responsable_id:N.value,page:1},{preserveState:!0,preserveScroll:!0})},300);xe([w,C,E,N],()=>{oe()});const le=()=>{w.value="",C.value="",E.value="",N.value=""},re=()=>{v.value.length===m.value.data.length?v.value=[]:v.value=m.value.data.map(o=>o.id)},ne=o=>v.value.includes(o),ie=o=>{const s=v.value.indexOf(o);s>-1?v.value.splice(s,1):v.value.push(o)},de=o=>{u.canComplete&&j.post(`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}/entregables/${o.id}/completar`,{notas_completado:`Completado por ${ye().props.auth.user.name}`},{onSuccess:()=>{D.success("Entregable marcado como completado")},onError:()=>{D.error("Error al marcar el entregable como completado")}})},ue=o=>{u.canDelete&&confirm(`¿Estás seguro de eliminar el entregable "${o.nombre}"?`)&&j.delete(`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}/entregables/${o.id}`,{onSuccess:()=>{D.success("Entregable eliminado correctamente")},onError:()=>{D.error("Error al eliminar el entregable")}})},me=o=>({pendiente:"secondary",en_progreso:"default",completado:"success",cancelado:"destructive"})[o]||"secondary",fe=o=>({baja:"outline",media:"default",alta:"destructive"})[o]||"outline",ce=o=>o==="alta"?Ve:o==="baja"?Pe:Qe,pe=o=>o?new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-",B=o=>{if(!o)return null;const s=new Date,h=new Date(o).getTime()-s.getTime();return Math.ceil(h/(1e3*60*60*24))},_e=F(()=>m.value.data.map(o=>({...o,diasRestantes:B(o.fecha_fin),estaVencido:o.fecha_fin&&B(o.fecha_fin)<0,estaProximoVencer:o.fecha_fin&&B(o.fecha_fin)>=0&&B(o.fecha_fin)<=7}))),x=F(()=>{const o=m.value.data,s=m.value.total,l=o.filter(V=>V.estado==="completado").length,h=o.filter(V=>V.estado==="en_progreso").length,ve=o.filter(V=>V.estado==="pendiente").length;return{total:s,completados:l,enProgreso:h,pendientes:ve,progreso:s>0?Math.round(l/s*100):0}});return(o,s)=>(i(),f(be,{breadcrumbs:ae.value},{default:a(()=>[r("div",Xe,[r("div",Ye,[r("div",null,[s[4]||(s[4]=r("h2",{class:"text-3xl font-bold tracking-tight"},"Entregables del Hito",-1)),r("p",Ze,d(o.hito.nombre)+" - "+d(o.proyecto.nombre),1)]),r("div",et,[t(e(R),{href:`/admin/proyectos/${o.proyecto.id}/hitos`,as:"button"},{default:a(()=>[t(e(k),{variant:"outline"},{default:a(()=>[t(e(Re),{class:"mr-2 h-4 w-4"}),s[5]||(s[5]=n(" Volver a Hitos ",-1))]),_:1})]),_:1},8,["href"]),o.canCreate?(i(),f(e(R),{key:0,href:`/admin/proyectos/${o.proyecto.id}/hitos/${o.hito.id}/entregables/create`,as:"button"},{default:a(()=>[t(e(k),null,{default:a(()=>[t(e(Ie),{class:"mr-2 h-4 w-4"}),s[6]||(s[6]=n(" Nuevo Entregable ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])]),r("div",tt,[t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[7]||(s[7]=[n("Total Entregables",-1)])]),_:1}),t(e(Le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e($),null,{default:a(()=>[r("div",st,d(x.value.total),1),t(e(Fe),{value:x.value.progreso,class:"mt-2"},null,8,["value"]),r("p",at,d(x.value.progreso)+"% completado ",1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[8]||(s[8]=[n("Completados",-1)])]),_:1}),t(e(te),{class:"h-4 w-4 text-green-600"})]),_:1}),t(e($),null,{default:a(()=>[r("div",ot,d(x.value.completados),1),r("p",lt," de "+d(x.value.total)+" entregables ",1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[9]||(s[9]=[n("En Progreso",-1)])]),_:1}),t(e(qe),{class:"h-4 w-4 text-blue-600"})]),_:1}),t(e($),null,{default:a(()=>[r("div",rt,d(x.value.enProgreso),1),s[10]||(s[10]=r("p",{class:"text-xs text-muted-foreground"}," actualmente activos ",-1))]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[11]||(s[11]=[n("Pendientes",-1)])]),_:1}),t(e(q),{class:"h-4 w-4 text-orange-600"})]),_:1}),t(e($),null,{default:a(()=>[r("div",nt,d(x.value.pendientes),1),s[12]||(s[12]=r("p",{class:"text-xs text-muted-foreground"}," por iniciar ",-1))]),_:1})]),_:1})]),t(e(b),null,{default:a(()=>[t(e(P),null,{default:a(()=>[r("div",it,[t(e(S),null,{default:a(()=>[...s[13]||(s[13]=[n("Entregables",-1)])]),_:1}),t(e(k),{variant:"outline",size:"sm",onClick:s[0]||(s[0]=l=>T.value=!T.value)},{default:a(()=>[t(e(He),{class:"mr-2 h-4 w-4"}),n(" "+d(T.value?"Ocultar":"Mostrar")+" Filtros ",1)]),_:1})])]),_:1}),T.value?(i(),f(e($),{key:0,class:"space-y-4"},{default:a(()=>[r("div",dt,[r("div",null,[s[14]||(s[14]=r("label",{class:"text-sm font-medium"},"Buscar",-1)),r("div",ut,[t(e(ze),{class:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),t(e(ke),{modelValue:w.value,"onUpdate:modelValue":s[1]||(s[1]=l=>w.value=l),placeholder:"Buscar entregable...",class:"pl-8"},null,8,["modelValue"])])]),r("div",null,[s[16]||(s[16]=r("label",{class:"text-sm font-medium"},"Estado",-1)),t(e(K),{modelValue:C.value,"onUpdate:modelValue":s[2]||(s[2]=l=>C.value=l)},{default:a(()=>[t(e(Q),null,{default:a(()=>[t(e(X),{placeholder:"Todos los estados"})]),_:1}),t(e(Y),null,{default:a(()=>[t(e(M),{value:""},{default:a(()=>[...s[15]||(s[15]=[n("Todos los estados",-1)])]),_:1}),(i(!0),c(A,null,U(o.estados,l=>(i(),f(e(M),{key:l.value,value:l.value},{default:a(()=>[n(d(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),r("div",null,[s[18]||(s[18]=r("label",{class:"text-sm font-medium"},"Prioridad",-1)),t(e(K),{modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=l=>E.value=l)},{default:a(()=>[t(e(Q),null,{default:a(()=>[t(e(X),{placeholder:"Todas las prioridades"})]),_:1}),t(e(Y),null,{default:a(()=>[t(e(M),{value:""},{default:a(()=>[...s[17]||(s[17]=[n("Todas las prioridades",-1)])]),_:1}),(i(!0),c(A,null,U(o.prioridades,l=>(i(),f(e(M),{key:l.value,value:l.value},{default:a(()=>[n(d(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),r("div",null,[s[20]||(s[20]=r("label",{class:"text-sm font-medium"}," ",-1)),t(e(k),{onClick:le,variant:"outline",class:"w-full"},{default:a(()=>[...s[19]||(s[19]=[n(" Limpiar Filtros ",-1)])]),_:1})])])]),_:1})):p("",!0)]),_:1}),t(e(b),null,{default:a(()=>[t(e($),{class:"p-0"},{default:a(()=>[t(e(we),null,{default:a(()=>[t(e(Ce),null,{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(g),{class:"w-[40px]"},{default:a(()=>[t(e(ee),{checked:v.value.length===m.value.data.length&&m.value.data.length>0,"onUpdate:checked":re},null,8,["checked"])]),_:1}),t(e(g),null,{default:a(()=>[...s[21]||(s[21]=[n("Entregable",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[22]||(s[22]=[n("Responsable",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[23]||(s[23]=[n("Estado",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[24]||(s[24]=[n("Prioridad",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[25]||(s[25]=[n("Fecha Fin",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[26]||(s[26]=[n("Colaboradores",-1)])]),_:1}),t(e(g),{class:"text-right"},{default:a(()=>[...s[27]||(s[27]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(Ee),null,{default:a(()=>[(i(!0),c(A,null,U(_e.value,l=>(i(),f(e(I),{key:l.id},{default:a(()=>[t(e(_),null,{default:a(()=>[t(e(ee),{checked:ne(l.id),"onUpdate:checked":()=>ie(l.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024),t(e(_),null,{default:a(()=>[r("div",null,[r("p",mt,d(l.nombre),1),l.descripcion?(i(),c("p",ft,d(l.descripcion),1)):p("",!0),l.estaVencido?(i(),c("div",ct,[t(e(q),{class:"h-3 w-3 text-red-600"}),r("span",pt,"Vencido hace "+d(Math.abs(l.diasRestantes))+" días",1)])):l.estaProximoVencer?(i(),c("div",_t,[t(e(q),{class:"h-3 w-3 text-orange-600"}),r("span",vt,"Vence en "+d(l.diasRestantes)+" días",1)])):p("",!0)])]),_:2},1024),t(e(_),null,{default:a(()=>[l.responsable?(i(),c("div",gt,[t(e(je),{class:"h-8 w-8"},{default:a(()=>[l.responsable.avatar?(i(),f(e(Ae),{key:0,src:l.responsable.avatar},null,8,["src"])):p("",!0),t(e(Ue),null,{default:a(()=>[n(d(l.responsable.name.substring(0,2).toUpperCase()),1)]),_:2},1024)]),_:2},1024),r("span",xt,d(l.responsable.name),1)])):(i(),c("span",ht,"Sin asignar"))]),_:2},1024),t(e(_),null,{default:a(()=>[t(e(J),{variant:me(l.estado)},{default:a(()=>[n(d(l.estado_label),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(_),null,{default:a(()=>[t(e(J),{variant:fe(l.prioridad)},{default:a(()=>[(i(),f(he(ce(l.prioridad)),{class:"mr-1 h-3 w-3"})),n(" "+d(l.prioridad_label),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(_),null,{default:a(()=>[r("div",yt,[t(e(Ge),{class:"h-4 w-4 text-muted-foreground"}),r("span",bt,d(pe(l.fecha_fin)),1)])]),_:2},1024),t(e(_),null,{default:a(()=>[l.usuarios&&l.usuarios.length>0?(i(),c("div",$t,[t(e(Oe),{class:"h-4 w-4 text-muted-foreground"}),r("span",kt,d(l.usuarios.length),1)])):(i(),c("span",wt,"-"))]),_:2},1024),t(e(_),{class:"text-right"},{default:a(()=>[t(e(Se),null,{default:a(()=>[t(e(De),{"as-child":""},{default:a(()=>[t(e(k),{variant:"ghost",class:"h-8 w-8 p-0"},{default:a(()=>[s[28]||(s[28]=r("span",{class:"sr-only"},"Abrir menú",-1)),t(e(We),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(Te),{align:"end"},{default:a(()=>[t(e(Be),null,{default:a(()=>[...s[29]||(s[29]=[n("Acciones",-1)])]),_:1}),t(e(Z)),o.canEdit?(i(),f(e(R),{key:0,href:`/admin/proyectos/${o.proyecto.id}/hitos/${o.hito.id}/entregables/${l.id}/edit`,as:"button",class:"w-full"},{default:a(()=>[t(e(L),null,{default:a(()=>[t(e(Je),{class:"mr-2 h-4 w-4"}),s[30]||(s[30]=n(" Editar ",-1))]),_:1})]),_:2},1032,["href"])):p("",!0),o.canComplete&&l.estado!=="completado"?(i(),f(e(L),{key:1,onClick:h=>de(l)},{default:a(()=>[t(e(te),{class:"mr-2 h-4 w-4"}),s[31]||(s[31]=n(" Marcar como completado ",-1))]),_:2},1032,["onClick"])):p("",!0),o.canDelete?(i(),f(e(Z),{key:2})):p("",!0),o.canDelete?(i(),f(e(L),{key:3,onClick:h=>ue(l),class:"text-red-600"},{default:a(()=>[t(e(Ke),{class:"mr-2 h-4 w-4"}),s[32]||(s[32]=n(" Eliminar ",-1))]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),m.value.data.length===0?(i(),f(e(I),{key:0},{default:a(()=>[t(e(_),{colspan:"8",class:"text-center py-8"},{default:a(()=>[...s[33]||(s[33]=[r("p",{class:"text-muted-foreground"},"No se encontraron entregables",-1)])]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),m.value.last_page>1?(i(),c("div",Ct,[r("div",Et," Mostrando "+d(m.value.from)+" a "+d(m.value.to)+" de "+d(m.value.total)+" entregables ",1),r("div",Vt,[(i(!0),c(A,null,U(m.value.last_page,l=>(i(),f(e(k),{key:l,variant:"outline",size:"sm",disabled:l===m.value.current_page,onClick:h=>e(j).get(`/admin/proyectos/${o.proyecto.id}/hitos/${o.hito.id}/entregables?page=${l}`)},{default:a(()=>[n(d(l),1)]),_:2},1032,["disabled","onClick"]))),128))])])):p("",!0)])]),_:1},8,["breadcrumbs"]))}});export{As as default};
