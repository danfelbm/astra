import{d as be,i as u,e as n,f as a,j as f,u as o,w as i,h as d,t as c,F as S,k as F,b as V,c as j,C as je,r as y,m as M,o as Ae,p as Ee,g as r,L as ze,q as Ie,n as ue,W as B}from"./app-CNcf-zdV.js";import{_ as Ue}from"./index-s_YMJFqv.js";import{_ as b}from"./createLucideIcon-DgLLtpTc.js";import{_ as A,c as E,a as N,b as T}from"./CardTitle.vue_vue_type_script_setup_true_lang-DhL5ChM3.js";import{_ as ce}from"./Checkbox.vue_vue_type_script_setup_true_lang-BDqsklM1.js";import{_ as me}from"./Input.vue_vue_type_script_setup_true_lang-CXr4ucc6.js";import{_ as x}from"./Label.vue_vue_type_script_setup_true_lang-BFduy937.js";import{_ as Y,a as ee,b as oe,c as te,d as ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-Bt0xndJV.js";import{_ as Be,a as Fe,b as J,c as K}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-PuWmj34h.js";import{_ as fe}from"./Textarea.vue_vue_type_script_setup_true_lang-BLahoW9V.js";import{_ as H}from"./DateTimePicker.vue_vue_type_script_setup_true_lang-CVmxyLJH.js";import{_ as Pe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DTy3l80b.js";import{L as De,_ as Le,D as qe}from"./DynamicFormBuilder-DAJQTkEJ.js";import{_ as Me}from"./CsvImportWizard.vue_vue_type_script_setup_true_lang-BJVK5VTQ.js";import{_ as Ne}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-CYVGcAe5.js";import{d as Te}from"./debounce-BMmXVQ06.js";import{C as He}from"./circle-alert-BWYDLxj9.js";import{U as pe}from"./upload-BXITFokJ.js";import{P as ve}from"./plus-B0xw1qKM.js";import{H as _e}from"./history-B-BObha7.js";import{S as Re}from"./search-DXa90Ror.js";import{L as Ge}from"./loader-circle-DT0CjkEL.js";import{T as Oe}from"./trash-2-BaR4XxZx.js";import{C as We}from"./chevron-left-CxQtTkVA.js";import{C as Ze}from"./chevron-right-CoIj8tGl.js";import{C as Qe}from"./circle-x-Dhjrtdk5.js";import{C as Xe}from"./circle-check-big-CiofKZcV.js";import{C as ge}from"./clock-Bv_E-7na.js";import"./index-BfcJxwg-.js";import"./index-C53AKuaZ.js";import"./floating-ui.vue-g3wBdaGy.js";import"./check-N9bkD0I5.js";import"./VisuallyHidden-BMJ7uEAj.js";import"./nullish-CHIgUVhi.js";import"./RovingFocusItem-KgjJr8lb.js";import"./utils-D1nKU7ku.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-D8koaehi.js";import"./x-arLKReWz.js";import"./index-DoUjDw3v.js";import"./shield-Ds2U7D9u.js";import"./user-DzTPpMzP.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BBJrNP3L.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CS3Y7RjP.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-D-RM_gVc.js";import"./index-UZehIf0x.js";import"./map-pin-CODmF8A6.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-CPZLV3U1.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CQwxGvmo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-Co9lmALi.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Bowse19S.js";import"./target-Bzh15SE9.js";import"./users-BCniY5Uo.js";import"./vote-DWrrItDX.js";import"./folder-open-Bl1zn-Xz.js";import"./send-Cs3Svvwv.js";import"./file-text-VjUXoo3d.js";import"./briefcase-BxQurTMk.js";import"./calendar-DAAYlVnm.js";import"./megaphone-DSquqsX_.js";import"./user-check-t0y4Vuir.js";import"./mail-CzyXkW1x.js";import"./message-square-vVP8zyj_.js";import"./external-link-DknYr06I.js";import"./panel-left-C37rxO5h.js";import"./index-DraxJDKZ.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Cu2pXtyO.js";import"./VisuallyHiddenInput-DQv9Xmp3.js";import"./circle-DT2yxC1F.js";import"./grip-vertical-DNH1M1QZ.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-C68I3fFy.js";import"./eye-DkPQI3fu.js";import"./git-branch-BEZKwTBX.js";import"./square-pen-Def0jsxb.js";import"./copy-CuJiGPes.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-B2B-X4-8.js";import"./index-BXNWrcHO.js";const Je={key:0,class:"text-red-500"},Ke={key:0,class:"text-sm text-destructive mt-1"},Ye={key:1,class:"text-xs text-muted-foreground mt-1"},eo=be({__name:"TimezoneSelector",props:{modelValue:{},disabled:{type:Boolean,default:!1},label:{default:"Zona Horaria"},placeholder:{default:"Seleccionar zona horaria"},description:{default:"Las fechas de apertura y cierre se aplicarán según esta zona horaria"},required:{type:Boolean,default:!1},error:{}},emits:["update:modelValue"],setup(se,{emit:m}){const p=m,R=v=>{p("update:modelValue",v)};return(v,G)=>(n(),u("div",null,[a(o(x),null,{default:i(()=>[d(c(v.label)+" ",1),v.required?(n(),u("span",Je,"*")):f("",!0)]),_:1}),a(o(Y),{"model-value":v.modelValue,"onUpdate:modelValue":R,disabled:v.disabled},{default:i(()=>[a(o(ee),null,{default:i(()=>[a(o(oe),{placeholder:v.placeholder},null,8,["placeholder"])]),_:1}),a(o(te),null,{default:i(()=>[(n(!0),u(S,null,F(o(De),t=>(n(),V(o(ae),{key:t.value,value:t.value},{default:i(()=>[d(c(t.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"]),v.error?(n(),u("p",Ke,c(v.error),1)):v.description?(n(),u("p",Ye,c(v.description),1)):f("",!0)]))}}),oo={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},to={class:"flex items-center justify-between"},ao={class:"text-3xl font-bold"},so={class:"text-muted-foreground"},io={class:"relative min-h-[70vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border"},lo={class:"grid gap-6 md:grid-cols-2"},ro={class:"space-y-4"},no={key:0,class:"text-sm text-destructive mt-1"},uo={key:0,class:"text-sm text-destructive mt-1"},co={key:0,class:"text-sm text-destructive mt-1"},mo={class:"space-y-4"},fo={key:0,class:"text-sm text-destructive mt-1"},po={key:0,class:"text-sm text-destructive mt-1"},vo={key:1,class:"text-sm text-destructive mt-1"},_o={class:"flex items-center space-x-2"},go={key:0,class:"space-y-2"},bo={class:"flex items-center space-x-2 mt-4"},xo={key:0,class:"text-sm text-destructive mt-1"},yo={key:0},Vo={key:0,class:"text-sm text-destructive mt-1"},ho={class:"flex justify-between"},ko={class:"flex gap-2"},wo={class:"flex justify-between"},Co={class:"flex gap-2"},$o={class:"flex items-center space-x-2 text-yellow-700"},So={class:"space-y-4"},jo={class:"flex items-center gap-2"},Ao={key:0,class:"text-center py-6 text-muted-foreground"},Eo={key:1,class:"space-y-3"},zo=["onClick"],Io={class:"flex items-center gap-3"},Uo={class:"font-medium text-sm"},Bo={class:"text-xs text-muted-foreground"},Fo={class:"flex items-center gap-2"},Po={key:0,class:"text-xs text-muted-foreground"},Do={key:0},Lo={key:1,class:"text-xs text-muted-foreground"},qo={class:"relative"},Mo={key:0,class:"flex items-center justify-center py-8"},No={key:1,class:"text-center py-8 text-muted-foreground"},To={key:0},Ho={key:1},Ro={key:2},Go={class:"space-y-2 max-h-96 overflow-y-auto"},Oo={class:"flex-1 min-w-0"},Wo={class:"font-medium truncate"},Zo={class:"flex items-center gap-4 text-sm text-muted-foreground"},Qo={class:"truncate"},Xo={key:0},Jo={key:1},Ko={key:0,class:"flex items-center justify-between pt-4 border-t"},Yo={class:"text-sm text-muted-foreground"},et={class:"flex gap-2"},ot={class:"flex justify-between"},Ca=be({__name:"Form",props:{categorias:{},votacion:{},cargos:{},periodosElectorales:{},convocatorias:{},canManageVoters:{type:Boolean}},setup(se){var ne,de;const m=se,p=j(()=>!!m.votacion),R=j(()=>{var l;return p.value&&((l=m.votacion)==null?void 0:l.estado)==="borrador"&&m.canManageVoters}),v=[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"},{title:p.value?"Editar":"Crear",href:"#"}],G=()=>{if(!m.votacion)return{titulo:"",descripcion:"",categoria_id:"",fecha_inicio:null,fecha_fin:null,estado:"borrador",resultados_publicos:!1,allow_tokens_download:!1,fecha_publicacion_resultados:null,limite_censo:null,mensaje_limite_censo:"",formulario_config:[],timezone:"America/Bogota",territorios_ids:[],departamentos_ids:[],municipios_ids:[],localidades_ids:[]};const l=m.votacion;return{titulo:l.titulo||"",descripcion:l.descripcion||"",categoria_id:l.categoria_id?String(l.categoria_id):"",fecha_inicio:l.fecha_inicio||null,fecha_fin:l.fecha_fin||null,estado:l.estado||"borrador",resultados_publicos:!!l.resultados_publicos,allow_tokens_download:!!l.allow_tokens_download,fecha_publicacion_resultados:l.fecha_publicacion_resultados||null,limite_censo:l.limite_censo||null,mensaje_limite_censo:l.mensaje_limite_censo||"",formulario_config:l.formulario_config||[],timezone:l.timezone||"America/Bogota",territorios_ids:l.territorios_ids||[],departamentos_ids:l.departamentos_ids||[],municipios_ids:l.municipios_ids||[],localidades_ids:l.localidades_ids||[]}},t=je(G()),k=y("basicos"),xe=[{value:"borrador",label:"Borrador"},{value:"activa",label:"Activa"},{value:"finalizada",label:"Finalizada"}],ie=j({get:()=>({territorios_ids:t.territorios_ids||[],departamentos_ids:t.departamentos_ids||[],municipios_ids:t.municipios_ids||[],localidades_ids:t.localidades_ids||[]}),set:l=>{t.territorios_ids=l.territorios_ids,t.departamentos_ids=l.departamentos_ids,t.municipios_ids=l.municipios_ids,t.localidades_ids=l.localidades_ids}}),le=j(()=>!t.fecha_fin||!t.fecha_inicio?"":t.fecha_fin<=t.fecha_inicio?"La fecha de fin debe ser posterior a la fecha de inicio":""),O=()=>{if(!z.value){k.value="basicos",alert('Por favor completa todos los campos requeridos en la pestaña "Datos Básicos" antes de crear la votación.');return}if(t.formulario_config.length===0){alert("Por favor agrega al menos un campo al formulario antes de crear la votación.");return}p.value?t.put(`/admin/votaciones/${m.votacion.id}`,{onError:l=>{const e=Object.values(l)[0];e&&alert(`Error: ${Array.isArray(e)?e[0]:e}`)}}):t.post("/admin/votaciones",{onError:l=>{const e=Object.values(l)[0];e&&alert(`Error: ${Array.isArray(e)?e[0]:e}`)}})},z=j(()=>t.titulo&&t.categoria_id&&t.fecha_inicio&&t.fecha_fin&&t.timezone);j(()=>z.value&&t.formulario_config.length>0);const $=y(((ne=m.votacion)==null?void 0:ne.votantes)||[]),w=y(((de=m.votacion)==null?void 0:de.votantes_total)||0),_=y(1),W=y(50),Z=y(!1),h=y(""),Q=y(1),I=y(!1),P=y(!1),D=y([]),re=async()=>{var l;if(!(!p.value||!((l=m.votacion)!=null&&l.id)))try{const e=await fetch(`/admin/votaciones/${m.votacion.id}/imports/recent`);if(e.ok){const g=await e.json();D.value=g}}catch(e){console.error("Error loading recent imports:",e)}},ye=l=>{B.get(`/admin/imports/${l}`)},Ve=()=>{var l;(l=m.votacion)!=null&&l.id&&B.get(`/admin/votaciones/${m.votacion.id}/imports`)},L=l=>{switch(l){case"pending":return{icon:ge,label:"Pendiente",class:"text-yellow-600"};case"processing":return{icon:ge,label:"Procesando",class:"text-blue-600"};case"completed":return{icon:Xe,label:"Completada",class:"text-green-600"};case"failed":return{icon:Qe,label:"Fallida",class:"text-red-600"}}},he=l=>new Date(l).toLocaleString("es-ES",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=async(l=1,e="")=>{var g;if((g=m.votacion)!=null&&g.id){Z.value=!0;try{const s=new URLSearchParams({page:l.toString(),per_page:W.value.toString(),...e&&{query:e}}),q=await(await fetch(`/admin/votaciones/${m.votacion.id}/assigned-voters?${s}`)).json();$.value=q.data||[],w.value=q.total||0,_.value=q.current_page||1,Q.value=q.last_page||1}catch(s){console.error("Error cargando votantes:",s)}finally{Z.value=!1}}},ke=Te(()=>{_.value=1,U(1,h.value)},300),X=l=>{_.value=l,U(l,h.value)};M(h,()=>{ke()}),M(()=>k.value,l=>{var e;l==="votantes"&&((e=m.votacion)!=null&&e.id)&&w.value>0&&($.value.length===0||$.value.length<w.value&&$.value.length<=50)&&U()});const we=l=>{var e;!l.userIds||l.userIds.length===0||!p.value||!((e=m.votacion)!=null&&e.id)||B.post(`/admin/votaciones/${m.votacion.id}/votantes`,{votante_ids:l.userIds.map(g=>g.toString())},{preserveScroll:!0,onSuccess:()=>{w.value+=l.userIds.length,U(_.value,h.value),P.value=!1},onError:g=>{console.error("Error adding votantes:",g),alert("Error al agregar votantes")}})},Ce=l=>{var e;!p.value||!((e=m.votacion)!=null&&e.id)||B.delete(`/admin/votaciones/${m.votacion.id}/votantes`,{data:{votante_id:l},preserveScroll:!0,onSuccess:()=>{w.value-=1,$.value.length===1&&_.value>1?X(_.value-1):U(_.value,h.value)},onError:g=>{console.error("Error removing votante:",g),alert("Error al remover votante")}})},$e=l=>{I.value=!1,re(),B.get(`/admin/imports/${l}`)},Se=()=>{I.value=!1};return M(()=>m.votacion,l=>{if(l){const e=G();t.titulo=e.titulo,t.descripcion=e.descripcion,t.categoria_id=e.categoria_id,t.fecha_inicio=e.fecha_inicio,t.fecha_fin=e.fecha_fin,t.estado=e.estado,t.resultados_publicos=e.resultados_publicos,t.allow_tokens_download=e.allow_tokens_download,t.fecha_publicacion_resultados=e.fecha_publicacion_resultados,t.formulario_config=e.formulario_config,t.timezone=e.timezone,p.value&&re()}},{immediate:!0,deep:!0}),M(()=>t.resultados_publicos,l=>{console.log("resultados_publicos changed to:",l)},{immediate:!0}),Ae(()=>{}),(l,e)=>(n(),u(S,null,[a(o(Ee),{title:p.value?"Editar Votación":"Nueva Votación"},null,8,["title"]),a(Pe,{breadcrumbs:v},{default:i(()=>{var g;return[r("div",oo,[r("div",to,[r("div",null,[r("h1",ao,c(p.value?"Editar Votación":"Nueva Votación"),1),r("p",so,c(p.value?"Modifica los datos de la votación":"Crea una nueva votación paso a paso"),1)])]),r("div",io,[a(o(A),{class:"border-0 shadow-none h-full"},{default:i(()=>[a(o(E),{class:"p-6"},{default:i(()=>[a(o(Be),{modelValue:k.value,"onUpdate:modelValue":e[23]||(e[23]=s=>k.value=s),class:"w-full"},{default:i(()=>[a(o(Fe),{class:"grid w-full grid-cols-3"},{default:i(()=>[a(o(J),{value:"basicos"},{default:i(()=>[...e[25]||(e[25]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"1"),d(" Datos Básicos ")],-1)])]),_:1}),a(o(J),{value:"formulario",disabled:!p.value&&!z.value},{default:i(()=>[...e[26]||(e[26]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"2"),d(" Formulario ")],-1)])]),_:1},8,["disabled"]),a(o(J),{value:"votantes",disabled:!p.value},{default:i(()=>[...e[27]||(e[27]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"3"),d(" Votantes ")],-1)])]),_:1},8,["disabled"])]),_:1}),a(o(K),{value:"basicos",class:"space-y-6"},{default:i(()=>[r("div",lo,[r("div",ro,[r("div",null,[a(o(x),{for:"titulo"},{default:i(()=>[...e[28]||(e[28]=[d("Título *",-1)])]),_:1}),a(o(me),{id:"titulo",modelValue:o(t).titulo,"onUpdate:modelValue":e[0]||(e[0]=s=>o(t).titulo=s),placeholder:"Nombre de la votación",error:o(t).errors.titulo},null,8,["modelValue","error"]),o(t).errors.titulo?(n(),u("p",no,c(o(t).errors.titulo),1)):f("",!0)]),r("div",null,[a(o(x),{for:"descripcion"},{default:i(()=>[...e[29]||(e[29]=[d("Descripción",-1)])]),_:1}),a(o(fe),{id:"descripcion",modelValue:o(t).descripcion,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).descripcion=s),placeholder:"Descripción detallada de la votación",rows:"4"},null,8,["modelValue"]),o(t).errors.descripcion?(n(),u("p",uo,c(o(t).errors.descripcion),1)):f("",!0)]),r("div",null,[a(o(x),{for:"categoria"},{default:i(()=>[...e[30]||(e[30]=[d("Categoría *",-1)])]),_:1}),a(o(Y),{modelValue:o(t).categoria_id,"onUpdate:modelValue":e[2]||(e[2]=s=>o(t).categoria_id=s)},{default:i(()=>[a(o(ee),null,{default:i(()=>[a(o(oe),{placeholder:"Seleccionar categoría"})]),_:1}),a(o(te),null,{default:i(()=>[(n(!0),u(S,null,F(l.categorias,s=>(n(),V(o(ae),{key:s.id,value:s.id.toString()},{default:i(()=>[d(c(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),o(t).errors.categoria_id?(n(),u("p",co,c(o(t).errors.categoria_id),1)):f("",!0)]),a(Le,{modelValue:ie.value,"onUpdate:modelValue":e[3]||(e[3]=s=>ie.value=s)},null,8,["modelValue"])]),r("div",mo,[r("div",null,[a(o(x),{for:"fecha_inicio"},{default:i(()=>[...e[31]||(e[31]=[d("Fecha y Hora de Inicio *",-1)])]),_:1}),a(o(H),{modelValue:o(t).fecha_inicio,"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).fecha_inicio=s),placeholder:"Seleccionar fecha y hora de inicio"},null,8,["modelValue"]),o(t).errors.fecha_inicio?(n(),u("p",fo,c(o(t).errors.fecha_inicio),1)):f("",!0)]),r("div",null,[a(o(x),{for:"fecha_fin"},{default:i(()=>[...e[32]||(e[32]=[d("Fecha y Hora de Fin *",-1)])]),_:1}),a(o(H),{modelValue:o(t).fecha_fin,"onUpdate:modelValue":e[5]||(e[5]=s=>o(t).fecha_fin=s),placeholder:"Seleccionar fecha y hora de fin"},null,8,["modelValue"]),le.value?(n(),u("p",po,c(le.value),1)):f("",!0),o(t).errors.fecha_fin?(n(),u("p",vo,c(o(t).errors.fecha_fin),1)):f("",!0)]),r("div",null,[a(o(x),{for:"estado"},{default:i(()=>[...e[33]||(e[33]=[d("Estado",-1)])]),_:1}),a(o(Y),{modelValue:o(t).estado,"onUpdate:modelValue":e[6]||(e[6]=s=>o(t).estado=s)},{default:i(()=>[a(o(ee),null,{default:i(()=>[a(o(oe))]),_:1}),a(o(te),null,{default:i(()=>[(n(),u(S,null,F(xe,s=>a(o(ae),{key:s.value,value:s.value},{default:i(()=>[d(c(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])]),a(eo,{modelValue:o(t).timezone,"onUpdate:modelValue":e[7]||(e[7]=s=>o(t).timezone=s),required:"",error:o(t).errors.timezone},null,8,["modelValue","error"]),r("div",_o,[a(o(ce),{id:"resultados_publicos",checked:o(t).resultados_publicos,"onUpdate:checked":e[8]||(e[8]=s=>o(t).resultados_publicos=s)},null,8,["checked"]),a(o(x),{for:"resultados_publicos"},{default:i(()=>[...e[34]||(e[34]=[d(" Resultados públicos ",-1)])]),_:1})]),a(ze,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:i(()=>[o(t).resultados_publicos?(n(),u("div",go,[a(o(x),{for:"fecha_publicacion_resultados"},{default:i(()=>[...e[35]||(e[35]=[d(" Fecha de publicación de resultados (opcional) ",-1)])]),_:1}),a(o(H),{id:"fecha_publicacion_resultados",modelValue:o(t).fecha_publicacion_resultados,"onUpdate:modelValue":e[9]||(e[9]=s=>o(t).fecha_publicacion_resultados=s),placeholder:"Dejar vacío para publicar al finalizar la votación"},null,8,["modelValue"]),e[37]||(e[37]=r("p",{class:"text-xs text-muted-foreground"}," Si se especifica una fecha, los resultados serán visibles desde esa fecha. Si se deja vacío, los resultados solo serán visibles después de que termine la votación. ",-1)),r("div",bo,[a(o(ce),{id:"allow_tokens_download",checked:o(t).allow_tokens_download,"onUpdate:checked":e[10]||(e[10]=s=>o(t).allow_tokens_download=s)},null,8,["checked"]),a(o(x),{for:"allow_tokens_download"},{default:i(()=>[...e[36]||(e[36]=[d(" Permitir descarga de tokens en CSV ",-1)])]),_:1})]),e[38]||(e[38]=r("p",{class:"text-xs text-muted-foreground ml-6"}," Permite a los usuarios descargar todos los tokens de verificación en formato CSV para análisis externos. ",-1))])):f("",!0)]),_:1}),r("div",null,[a(o(x),{for:"limite_censo"},{default:i(()=>[...e[39]||(e[39]=[d("Límite del Censo (opcional)",-1)])]),_:1}),a(o(H),{id:"limite_censo",modelValue:o(t).limite_censo,"onUpdate:modelValue":e[11]||(e[11]=s=>o(t).limite_censo=s),placeholder:"Seleccionar fecha límite del censo"},null,8,["modelValue"]),e[40]||(e[40]=r("p",{class:"text-xs text-muted-foreground"}," Fecha de referencia para determinar disponibilidad de la votación según criterios externos como fecha de inscripción. ",-1)),o(t).errors.limite_censo?(n(),u("p",xo,c(o(t).errors.limite_censo),1)):f("",!0)]),o(t).limite_censo?(n(),u("div",yo,[a(o(x),{for:"mensaje_limite_censo"},{default:i(()=>[...e[41]||(e[41]=[d(" Mensaje de notificación sobre límite de censo (opcional) ",-1)])]),_:1}),a(o(fe),{id:"mensaje_limite_censo",modelValue:o(t).mensaje_limite_censo,"onUpdate:modelValue":e[12]||(e[12]=s=>o(t).mensaje_limite_censo=s),placeholder:"Mensaje a mostrar cuando un usuario no cumple con el límite del censo",rows:"3",class:"mt-1"},null,8,["modelValue"]),e[42]||(e[42]=r("p",{class:"text-xs text-muted-foreground mt-1"}," Este mensaje se mostrará si un usuario intenta registrarse pero su fecha de inscripción es posterior al límite del censo configurado. ",-1)),o(t).errors.mensaje_limite_censo?(n(),u("p",Vo,c(o(t).errors.mensaje_limite_censo),1)):f("",!0)])):f("",!0)])]),r("div",ho,[e[44]||(e[44]=r("div",null,null,-1)),r("div",ko,[p.value?(n(),V(o(b),{key:0,onClick:O,disabled:o(t).processing||!z.value,variant:"default"},{default:i(()=>[d(c(o(t).processing?"Actualizando...":"Actualizar Votación"),1)]),_:1},8,["disabled"])):f("",!0),a(o(b),{onClick:e[13]||(e[13]=s=>k.value="formulario"),disabled:!z.value,variant:"outline"},{default:i(()=>[...e[43]||(e[43]=[d(" Siguiente: Configurar Formulario ",-1)])]),_:1},8,["disabled"])])])]),_:1}),a(o(K),{value:"formulario",class:"space-y-6"},{default:i(()=>{var s;return[a(qe,{modelValue:o(t).formulario_config,"onUpdate:modelValue":e[14]||(e[14]=C=>o(t).formulario_config=C),title:"Constructor de Formulario",description:"Agrega los campos que aparecerán en la votación","show-perfil-candidatura-config":!0,"show-convocatoria-config":!0,cargos:((s=m.cargos)==null?void 0:s.filter(C=>C.es_cargo))||[],"periodos-electorales":m.periodosElectorales||[],convocatorias:m.convocatorias||[],context:"votacion"},null,8,["modelValue","cargos","periodos-electorales","convocatorias"]),r("div",wo,[a(o(b),{variant:"outline",onClick:e[15]||(e[15]=C=>k.value="basicos")},{default:i(()=>[...e[45]||(e[45]=[d(" Anterior ",-1)])]),_:1}),r("div",Co,[R.value&&m.canManageVoters?(n(),V(o(b),{key:0,variant:"outline",onClick:e[16]||(e[16]=C=>k.value="votantes"),disabled:o(t).formulario_config.length===0},{default:i(()=>[...e[46]||(e[46]=[d(" Siguiente: Gestionar Votantes ",-1)])]),_:1},8,["disabled"])):f("",!0),a(o(b),{onClick:O,disabled:o(t).processing||o(t).formulario_config.length===0},{default:i(()=>[d(c(o(t).processing?"Guardando...":p.value?"Actualizar":"Crear")+" Votación ",1)]),_:1},8,["disabled"])])])]}),_:1}),a(o(K),{value:"votantes",class:"space-y-6"},{default:i(()=>[e[65]||(e[65]=r("div",null,[r("h3",{class:"text-lg font-semibold"},"Gestión de Votantes"),r("p",{class:"text-sm text-muted-foreground"}," Asigna los usuarios que podrán participar en esta votación ")],-1)),m.canManageVoters?f("",!0):(n(),V(o(A),{key:0,class:"border-yellow-200 bg-yellow-50"},{default:i(()=>[a(o(E),{class:"pt-6"},{default:i(()=>[r("div",$o,[a(o(He),{class:"h-5 w-5"}),e[47]||(e[47]=r("p",{class:"font-semibold"},"Sin permisos para manejar censo electoral",-1))]),e[48]||(e[48]=r("p",{class:"mt-2 text-sm text-gray-600"}," No tienes los permisos necesarios para gestionar el censo electoral de esta votación. Contacta a un administrador si necesitas acceso a esta funcionalidad. ",-1))]),_:1})]),_:1})),m.canManageVoters?(n(),u(S,{key:1},[I.value?f("",!0):(n(),V(o(A),{key:0},{default:i(()=>[a(o(N),null,{default:i(()=>[a(o(T),{class:"flex items-center gap-2"},{default:i(()=>[a(o(pe),{class:"h-5 w-5"}),e[49]||(e[49]=d(" Importar Votantes ",-1))]),_:1})]),_:1}),a(o(E),null,{default:i(()=>[r("div",So,[e[51]||(e[51]=r("p",{class:"text-sm text-muted-foreground"}," Importa votantes desde un archivo CSV con mapeo dinámico de campos. Los usuarios importados serán asignados automáticamente a esta votación. ",-1)),e[52]||(e[52]=r("p",{class:"text-sm text-blue-600"},[r("a",{href:"/ejemplo-usuarios.csv",download:"",class:"underline"}," 📥 Descargar plantilla CSV de ejemplo ")],-1)),a(o(b),{variant:"outline",onClick:e[17]||(e[17]=s=>I.value=!0)},{default:i(()=>[a(o(pe),{class:"mr-2 h-4 w-4"}),e[50]||(e[50]=d(" Iniciar Importación ",-1))]),_:1})])]),_:1})]),_:1})),I.value&&p.value&&l.votacion?(n(),V(Me,{key:1,mode:"votacion","votacion-id":l.votacion.id,"votacion-titulo":l.votacion.titulo,"redirect-on-success":!1,onSuccess:$e,onCancel:Se},null,8,["votacion-id","votacion-titulo"])):f("",!0),p.value?(n(),V(o(A),{key:2},{default:i(()=>[a(o(N),null,{default:i(()=>[a(o(T),{class:"flex items-center gap-2"},{default:i(()=>[a(o(ve),{class:"h-5 w-5"}),e[53]||(e[53]=d(" Agregar Votantes ",-1))]),_:1})]),_:1}),a(o(E),null,{default:i(()=>[a(o(b),{onClick:e[18]||(e[18]=s=>P.value=!0),class:"w-full",variant:"outline"},{default:i(()=>[a(o(ve),{class:"h-4 w-4 mr-2"}),e[54]||(e[54]=d(" Buscar y Añadir Votantes ",-1))]),_:1}),e[55]||(e[55]=r("p",{class:"text-sm text-muted-foreground mt-2"}," Busca usuarios por nombre, email, documento o teléfono ",-1))]),_:1})]),_:1})):f("",!0),p.value?(n(),V(o(A),{key:3},{default:i(()=>[a(o(N),null,{default:i(()=>[a(o(T),{class:"flex items-center justify-between"},{default:i(()=>[r("span",jo,[a(o(_e),{class:"h-5 w-5"}),e[56]||(e[56]=d(" Historial de Importaciones ",-1))]),D.value.length>0?(n(),V(o(b),{key:0,variant:"outline",size:"sm",onClick:Ve},{default:i(()=>[...e[57]||(e[57]=[d(" Ver Todas ",-1)])]),_:1})):f("",!0)]),_:1})]),_:1}),a(o(E),null,{default:i(()=>[D.value.length===0?(n(),u("div",Ao,[a(o(_e),{class:"mx-auto h-8 w-8 mb-2"}),e[58]||(e[58]=r("p",null,"No hay importaciones registradas",-1)),e[59]||(e[59]=r("p",{class:"text-sm"},"Las importaciones aparecerán aquí una vez que subas archivos CSV",-1))])):(n(),u("div",Eo,[(n(!0),u(S,null,F(D.value,s=>(n(),u("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:C=>ye(s.id)},[r("div",Io,[(n(),V(Ie(L(s.status).icon),{class:ue(["h-4 w-4",L(s.status).class])},null,8,["class"])),r("div",null,[r("p",Uo,c(s.original_filename),1),r("p",Bo," Por "+c(s.created_by.name)+" • "+c(he(s.created_at)),1)])]),r("div",Fo,[a(o(Ue),{variant:"outline",class:ue(L(s.status).class)},{default:i(()=>[d(c(L(s.status).label),1)]),_:2},1032,["class"]),s.status==="completed"?(n(),u("div",Po,[d(c(s.successful_rows)+" exitosos ",1),s.failed_rows>0?(n(),u("span",Do,", "+c(s.failed_rows)+" errores",1)):f("",!0)])):s.status==="processing"?(n(),u("div",Lo,c(s.progress_percentage)+"% ",1)):f("",!0)])],8,zo))),128))]))]),_:1})]),_:1})):f("",!0),a(o(A),null,{default:i(()=>[a(o(N),null,{default:i(()=>[a(o(T),null,{default:i(()=>[d("Votantes Asignados ("+c(w.value)+")",1)]),_:1})]),_:1}),a(o(E),{class:"space-y-4"},{default:i(()=>[r("div",qo,[a(o(Re),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a(o(me),{modelValue:h.value,"onUpdate:modelValue":e[19]||(e[19]=s=>h.value=s),type:"text",placeholder:"Buscar por nombre, email, documento o teléfono...",class:"pl-10"},null,8,["modelValue"])]),Z.value?(n(),u("div",Mo,[a(o(Ge),{class:"h-8 w-8 animate-spin text-muted-foreground"}),e[60]||(e[60]=r("span",{class:"ml-2 text-muted-foreground"},"Cargando votantes...",-1))])):$.value.length===0?(n(),u("div",No,[h.value?(n(),u("p",To,'No se encontraron votantes que coincidan con "'+c(h.value)+'"',1)):(n(),u("p",Ho,"No hay votantes asignados a esta votación")),e[61]||(e[61]=r("p",{class:"text-sm"},"Importa un archivo CSV o agrega votantes manualmente",-1))])):(n(),u("div",Ro,[r("div",Go,[(n(!0),u(S,null,F($.value,s=>(n(),u("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50"},[r("div",Oo,[r("p",Wo,c(s.name),1),r("div",Zo,[r("span",Qo,c(s.email),1),s.documento_identidad?(n(),u("span",Xo,"Doc: "+c(s.documento_identidad),1)):f("",!0),s.telefono?(n(),u("span",Jo,"Tel: "+c(s.telefono),1)):f("",!0)])]),a(o(b),{variant:"ghost",size:"sm",onClick:C=>Ce(s.id)},{default:i(()=>[a(o(Oe),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"])]))),128))]),Q.value>1?(n(),u("div",Ko,[r("div",Yo," Mostrando "+c((_.value-1)*W.value+1)+" - "+c(Math.min(_.value*W.value,w.value))+" de "+c(w.value)+" votantes ",1),r("div",et,[a(o(b),{variant:"outline",size:"sm",disabled:_.value===1,onClick:e[20]||(e[20]=s=>X(_.value-1))},{default:i(()=>[a(o(We),{class:"h-4 w-4"}),e[62]||(e[62]=d(" Anterior ",-1))]),_:1},8,["disabled"]),a(o(b),{variant:"outline",size:"sm",disabled:_.value===Q.value,onClick:e[21]||(e[21]=s=>X(_.value+1))},{default:i(()=>[e[63]||(e[63]=d(" Siguiente ",-1)),a(o(Ze),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])):f("",!0)]))]),_:1})]),_:1}),r("div",ot,[a(o(b),{variant:"outline",onClick:e[22]||(e[22]=s=>k.value="formulario")},{default:i(()=>[...e[64]||(e[64]=[d(" Anterior ",-1)])]),_:1}),a(o(b),{onClick:O,disabled:o(t).processing},{default:i(()=>[d(c(o(t).processing?"Guardando...":"Actualizar")+" Votación ",1)]),_:1},8,["disabled"])])],64)):f("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),a(Ne,{modelValue:P.value,"onUpdate:modelValue":e[24]||(e[24]=s=>P.value=s),title:"Añadir Votantes",description:"Selecciona los usuarios que deseas añadir como votantes de esta votación","search-endpoint":`/admin/votaciones/${(g=m.votacion)==null?void 0:g.id}/search-users`,"search-placeholder":"Buscar por nombre, email, documento o teléfono...","submit-button-text":"Añadir Votantes","empty-message":"Escribe para buscar usuarios disponibles","no-results-message":"No se encontraron usuarios con esa búsqueda",onSubmit:we},null,8,["modelValue","search-endpoint"])]}),_:1})],64))}});export{Ca as default};
