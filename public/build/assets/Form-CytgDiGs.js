import{d as Ge,k as G,c as U,w as te,s as Je,a as p,o as u,j as I,i as V,e as f,b as s,u as e,g as x,f as n,t as b,F as W,r as H,bT as Qe,n as P,C as Ze,v as et,m as tt,h as at,at as rt,J as it,bK as st}from"./app-CirNizQj.js";import{_ as de}from"./AppLogo.vue_vue_type_script_setup_true_lang-NRMucCFh.js";import{_ as ae,a as re}from"./CardContent.vue_vue_type_script_setup_true_lang-BJBpkIUo.js";import{_ as ie,a as De}from"./CardTitle.vue_vue_type_script_setup_true_lang-BtS_RhrN.js";import{_ as ot}from"./Checkbox.vue_vue_type_script_setup_true_lang-CzlHtlVi.js";import{_ as le}from"./Input.vue_vue_type_script_setup_true_lang-C4ZIs3_M.js";import{_ as Q}from"./Label.vue_vue_type_script_setup_true_lang-DzIkTKwR.js";import{_ as dt,a as lt,b as nt,c as ut,d as ct}from"./SelectValue.vue_vue_type_script_setup_true_lang-DIL0h1pW.js";import{_ as ft}from"./Textarea.vue_vue_type_script_setup_true_lang-BAsz9LTl.js";import{u as mt,a as _t,_ as pt,b as gt,c as vt,d as bt}from"./useConditionalFields-B7vwDF6_.js";import{a as Ne,C as Be,U as yt,u as J,_ as ht,v as xt}from"./AppLayout.vue_vue_type_script_setup_true_lang-BmAYuZlb.js";import{_ as Le}from"./CardDescription.vue_vue_type_script_setup_true_lang-BHiYMF1G.js";import{_ as $t,a as Pe}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-6gJNNZw2.js";import{a as ne,_ as ue}from"./index-C_Vfu70v.js";import{_ as ce}from"./AlertTitle.vue_vue_type_script_setup_true_lang-Ci9k-WWR.js";import{C as K}from"./circle-alert-C3Ir2rY_.js";import{M as ee}from"./map-pin-DRpw-byl.js";import{A as St}from"./arrow-left-BFXu7obA.js";import{C as ze}from"./clock-BcXlQKvV.js";import{C as kt}from"./circle-check-big-QTePR7PN.js";import{U as Ct}from"./user-DMZ2rBV0.js";import{S as wt}from"./save-Dc-iv6Fc.js";import"./index-BnDWf2ZJ.js";import"./index-DSiUnYxm.js";import"./useForwardExpose-DR3OS9Yu.js";import"./usePrimitiveElement-BltmeUoo.js";import"./createContext-Cdt0UC3Z.js";import"./Collection-CYfMil3H.js";import"./useNonce--lBE5Vxj.js";import"./chevron-up-BK4TsHD8.js";import"./handleAndDispatchCustomEvent-CYpUamdb.js";import"./nullish-CHIgUVhi.js";import"./useFormControl-CmjSmtz9.js";import"./VisuallyHidden-D2B7K860.js";import"./upload-Dz7n1rcg.js";import"./eye-DaCvvVbZ.js";import"./download-md1hhqND.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-C66u1wgV.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-gF6ncS_G.js";import"./plus-DEMewaKQ.js";import"./grip-vertical-YC_DFDn1.js";import"./trash-2-lLUg6m_b.js";import"./RovingFocusItem-D8xxWxa9.js";import"./VisuallyHiddenInput-aEnWb_Al.js";const Et={class:"space-y-4"},Vt={key:1,class:"text-center py-8"},Tt={key:3,class:"space-y-6"},At={key:0},jt={class:"text-sm font-medium text-muted-foreground mb-3"},Ut={class:"space-y-3"},Ot={class:"flex items-start gap-3"},It={class:"flex-1"},Ft={class:"flex items-center justify-between"},qt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Dt={class:"flex items-center gap-2 text-muted-foreground"},Nt={class:"flex items-center gap-2 text-muted-foreground"},Bt={class:"flex items-center gap-2 text-muted-foreground"},Lt={key:0,class:"flex items-center gap-2 text-muted-foreground"},Pt={class:"mt-3 text-xs text-muted-foreground"},zt={key:1},Mt={class:"text-sm font-medium text-muted-foreground mb-3"},Rt={class:"space-y-3"},Wt={class:"flex items-start gap-3"},Gt={class:"flex-1"},Jt={class:"flex items-center justify-between"},Kt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Yt={class:"flex items-center gap-2 text-muted-foreground"},Ht={class:"flex items-center gap-2 text-muted-foreground"},Xt={class:"flex items-center gap-2 text-muted-foreground"},Qt={class:"mt-3 text-xs text-muted-foreground"},Zt={key:5,class:"mt-4 p-3 bg-muted/50 rounded-lg"},ea={class:"text-sm text-muted-foreground"},ta=Ge({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(r,{emit:o}){const k=r,T=o,S=G([]),A=G(!1),E=G(null),a=G(k.modelValue),y=async()=>{A.value=!0,E.value=null;try{const h=await Qe.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:k.filtrarPorUbicacion,incluir_futuras:!0}});S.value=h.data}catch(h){E.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",h)}finally{A.value=!1}},w=U(()=>{const h={abiertas:[],futuras:[]};return S.value.forEach(g=>{g.estado_temporal==="abierta"?h.abiertas.push(g):g.estado_temporal==="futura"&&h.futuras.push(g)}),h}),D=U(()=>S.value.find(h=>h.id===a.value));te(a,h=>{T("update:modelValue",h)}),te(()=>k.modelValue,h=>{a.value=h});const O=h=>new Date(h).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=h=>{switch(h){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},N=h=>{switch(h){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Je(()=>{y()}),(h,g)=>(u(),p("div",Et,[h.showPostulacionWarning&&a.value?(u(),I(e(ue),{key:0,class:"border-blue-200 bg-blue-50"},{default:f(()=>[s(e(K),{class:"h-4 w-4 text-blue-600"}),s(e(ce),{class:"text-blue-800"},{default:f(()=>g[1]||(g[1]=[x("Postulación Automática")])),_:1}),s(e(ne),{class:"text-blue-700"},{default:f(()=>g[2]||(g[2]=[x(' Al enviar este formulario de candidatura, se creará automáticamente una postulación a la convocatoria seleccionada, la cual quedará en estado "Enviada" para revisión administrativa. ')])),_:1})]),_:1})):V("",!0),A.value?(u(),p("div",Vt,g[3]||(g[3]=[n("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),n("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):E.value?(u(),I(e(ue),{key:2,variant:"destructive"},{default:f(()=>[s(e(K),{class:"h-4 w-4"}),s(e(ce),null,{default:f(()=>g[4]||(g[4]=[x("Error")])),_:1}),s(e(ne),null,{default:f(()=>[x(b(E.value),1)]),_:1})]),_:1})):S.value.length>0?(u(),p("div",Tt,[s(e($t),{modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=c=>a.value=c),disabled:h.disabled},{default:f(()=>[w.value.abiertas.length>0?(u(),p("div",At,[n("h4",jt," Convocatorias Abiertas ("+b(w.value.abiertas.length)+") ",1),n("div",Ut,[(u(!0),p(W,null,H(w.value.abiertas,c=>(u(),I(e(ae),{key:c.id,class:P(["cursor-pointer hover:shadow-md transition-shadow",{"ring-2 ring-primary":a.value===c.id}])},{default:f(()=>[s(e(ie),{class:"pb-3"},{default:f(()=>[n("div",Ot,[s(e(Pe),{value:c.id.toString(),id:`conv-${c.id}`},null,8,["value","id"]),n("div",It,[n("div",Ft,[s(e(Q),{for:`conv-${c.id}`,class:"text-base font-semibold cursor-pointer"},{default:f(()=>[x(b(c.nombre),1)]),_:2},1032,["for"]),s(e(Ne),{class:P(F(c.estado_temporal))},{default:f(()=>[x(b(N(c.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(Le),{class:"mt-1"},{default:f(()=>[x(b(c.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(re),{class:"pt-0"},{default:f(()=>[n("div",qt,[n("div",Dt,[s(e(ee),{class:"h-4 w-4"}),n("span",null,b(c.cargo.nombre),1)]),n("div",Nt,[s(e(Be),{class:"h-4 w-4"}),n("span",null,b(c.periodo_electoral.nombre),1)]),n("div",Bt,[s(e(ee),{class:"h-4 w-4"}),n("span",null,b(c.ubicacion),1)]),c.numero_postulaciones!==void 0?(u(),p("div",Lt,[s(e(yt),{class:"h-4 w-4"}),n("span",null,b(c.numero_postulaciones)+" postulaciones",1)])):V("",!0)]),n("div",Pt,[g[5]||(g[5]=n("span",{class:"font-medium"},"Cierre:",-1)),x(" "+b(O(c.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0),w.value.futuras.length>0?(u(),p("div",zt,[n("h4",Mt," Próximas Convocatorias ("+b(w.value.futuras.length)+") ",1),n("div",Rt,[(u(!0),p(W,null,H(w.value.futuras,c=>(u(),I(e(ae),{key:c.id,class:P(["cursor-pointer hover:shadow-md transition-shadow opacity-90",{"ring-2 ring-primary":a.value===c.id}])},{default:f(()=>[s(e(ie),{class:"pb-3"},{default:f(()=>[n("div",Wt,[s(e(Pe),{value:c.id.toString(),id:`conv-${c.id}`},null,8,["value","id"]),n("div",Gt,[n("div",Jt,[s(e(Q),{for:`conv-${c.id}`,class:"text-base font-semibold cursor-pointer"},{default:f(()=>[x(b(c.nombre),1)]),_:2},1032,["for"]),s(e(Ne),{class:P(F(c.estado_temporal))},{default:f(()=>[x(b(N(c.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(Le),{class:"mt-1"},{default:f(()=>[x(b(c.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(re),{class:"pt-0"},{default:f(()=>[n("div",Kt,[n("div",Yt,[s(e(ee),{class:"h-4 w-4"}),n("span",null,b(c.cargo.nombre),1)]),n("div",Ht,[s(e(Be),{class:"h-4 w-4"}),n("span",null,b(c.periodo_electoral.nombre),1)]),n("div",Xt,[s(e(ee),{class:"h-4 w-4"}),n("span",null,b(c.ubicacion),1)])]),n("div",Qt,[g[6]||(g[6]=n("span",{class:"font-medium"},"Apertura:",-1)),x(" "+b(O(c.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),I(e(ue),{key:4},{default:f(()=>[s(e(K),{class:"h-4 w-4"}),s(e(ce),null,{default:f(()=>g[7]||(g[7]=[x("Sin convocatorias disponibles")])),_:1}),s(e(ne),null,{default:f(()=>g[8]||(g[8]=[x(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),D.value&&!h.disabled?(u(),p("div",Zt,[g[9]||(g[9]=n("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),n("p",ea,b(D.value.nombre),1)])):V("",!0)]))}});var aa=typeof global=="object"&&global&&global.Object===Object&&global,ra=typeof self=="object"&&self&&self.Object===Object&&self,Ke=aa||ra||Function("return this")(),se=Ke.Symbol,Ye=Object.prototype,ia=Ye.hasOwnProperty,sa=Ye.toString,X=se?se.toStringTag:void 0;function oa(r){var o=ia.call(r,X),k=r[X];try{r[X]=void 0;var T=!0}catch{}var S=sa.call(r);return T&&(o?r[X]=k:delete r[X]),S}var da=Object.prototype,la=da.toString;function na(r){return la.call(r)}var ua="[object Null]",ca="[object Undefined]",Me=se?se.toStringTag:void 0;function fa(r){return r==null?r===void 0?ca:ua:Me&&Me in Object(r)?oa(r):na(r)}function ma(r){return r!=null&&typeof r=="object"}var _a="[object Symbol]";function pa(r){return typeof r=="symbol"||ma(r)&&fa(r)==_a}var ga=/\s/;function va(r){for(var o=r.length;o--&&ga.test(r.charAt(o)););return o}var ba=/^\s+/;function ya(r){return r&&r.slice(0,va(r)+1).replace(ba,"")}function me(r){var o=typeof r;return r!=null&&(o=="object"||o=="function")}var Re=NaN,ha=/^[-+]0x[0-9a-f]+$/i,xa=/^0b[01]+$/i,$a=/^0o[0-7]+$/i,Sa=parseInt;function We(r){if(typeof r=="number")return r;if(pa(r))return Re;if(me(r)){var o=typeof r.valueOf=="function"?r.valueOf():r;r=me(o)?o+"":o}if(typeof r!="string")return r===0?r:+r;r=ya(r);var k=xa.test(r);return k||$a.test(r)?Sa(r.slice(2),k?2:8):ha.test(r)?Re:+r}var fe=function(){return Ke.Date.now()},ka="Expected a function",Ca=Math.max,wa=Math.min;function Ea(r,o,k){var T,S,A,E,a,y,w=0,D=!1,O=!1,F=!0;if(typeof r!="function")throw new TypeError(ka);o=We(o)||0,me(k)&&(D=!!k.leading,O="maxWait"in k,A=O?Ca(We(k.maxWait)||0,o):A,F="trailing"in k?!!k.trailing:F);function N(_){var C=T,j=S;return T=S=void 0,w=_,E=r.apply(j,C),E}function h(_){return w=_,a=setTimeout(B,o),D?N(_):E}function g(_){var C=_-y,j=_-w,q=o-C;return O?wa(q,A-j):q}function c(_){var C=_-y,j=_-w;return y===void 0||C>=o||C<0||O&&j>=A}function B(){var _=fe();if(c(_))return Y(_);a=setTimeout(B,g(_))}function Y(_){return a=void 0,F&&T?N(_):(T=S=void 0,E)}function z(){a!==void 0&&clearTimeout(a),w=0,T=y=S=a=void 0}function L(){return a===void 0?E:Y(fe())}function M(){var _=fe(),C=c(_);if(T=arguments,S=this,y=_,C){if(a===void 0)return h(y);if(O)return clearTimeout(a),a=setTimeout(B,o),N(y)}return a===void 0&&(a=setTimeout(B,o)),E}return M.cancel=z,M.flush=L,M}function Va(r,o){const{url:k,candidaturaId:T=null,debounceTime:S=3e3,showNotifications:A=!0,useLocalStorage:E=!0,localStorageKey:a="candidatura_draft"}=o,y=G({status:"idle",lastSaved:null,lastError:null,candidaturaId:T}),w=U(()=>y.value.status==="saving"),D=U(()=>y.value.lastSaved!==null),O=U(()=>y.value.status==="error"),F=()=>{if(E)try{const _={formulario_data:r.value,timestamp:new Date().toISOString(),candidaturaId:y.value.candidaturaId};localStorage.setItem(a,JSON.stringify(_))}catch(_){console.error("Error guardando en localStorage:",_)}},N=()=>{if(!E)return null;try{const _=localStorage.getItem(a);if(_){const C=JSON.parse(_),j=new Date(C.timestamp);if((Date.now()-j.getTime())/(1e3*60*60)<24)return C;localStorage.removeItem(a)}}catch(_){console.error("Error cargando desde localStorage:",_)}return null},h=()=>{E&&localStorage.removeItem(a)},g=async()=>{var _;if(y.value.status!=="saving"&&!(!r.value||Object.keys(r.value).length===0)){y.value.status="saving",y.value.lastError=null;try{const C=y.value.candidaturaId?k.replace("autosave",`${y.value.candidaturaId}/autosave`):k,j=await fetch(C,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((_=document.querySelector('meta[name="csrf-token"]'))==null?void 0:_.getAttribute("content"))||"",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:r.value})});if(!j.ok)throw new Error(`Error ${j.status}: ${j.statusText}`);const q=await j.json();if(q.success)y.value.status="saved",y.value.lastSaved=new Date,!y.value.candidaturaId&&q.candidatura_id&&(y.value.candidaturaId=q.candidatura_id),F(),A&&J.success("Cambios guardados",{description:`Autoguardado a las ${q.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(q.message||"Error al guardar")}catch(C){y.value.status="error",y.value.lastError=C instanceof Error?C.message:"Error desconocido",F(),A&&J.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",C)}}},c=Ea(g,S),B=()=>(c.cancel(),g()),Y=()=>te(r,()=>{y.value.status!=="error"&&c()},{deep:!0}),z=()=>{c.cancel()},L=()=>{z(),y.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:T},h()},M=()=>{const _=N();return _&&_.formulario_data?(A&&J.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),_):null};return{state:U(()=>y.value),isSaving:w,hasSaved:D,hasError:O,saveNow:B,startWatching:Y,stopAutoSave:z,reset:L,restoreDraft:M,clearLocalStorage:h}}const Ta={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Aa={class:"flex items-center justify-between"},ja={class:"text-3xl font-bold"},Ua={class:"text-muted-foreground"},Oa={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Ia={key:0,class:"flex items-center gap-1.5"},Fa={key:1,class:"flex items-center gap-1.5"},qa={key:2,class:"flex items-center gap-1.5 text-amber-600"},Da={key:3,class:"flex items-center gap-1.5"},Na={class:"text-blue-700 dark:text-blue-300"},Ba={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},La={class:"flex items-start gap-3"},Pa={class:"text-sm text-blue-800"},za={key:0,class:"mt-1 text-blue-600"},Ma={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},Ra={class:"flex items-start gap-3"},Wa={key:0,class:"text-red-500"},Ga={key:0,class:"text-sm text-muted-foreground"},Ja={key:6,class:"space-y-2"},Ka=["id","name","value","onUpdate:modelValue"],Ya={key:7,class:"space-y-2"},Ha={key:8},Xa={key:9},Qa={key:0,class:"text-red-500 text-sm mt-1"},Za={key:10},er={key:11},tr={key:12},ar={key:13,class:"text-sm text-destructive"},rr={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},ir={class:"text-red-800 text-sm"},sr={class:"flex justify-between pt-6"},or=Ge({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(r){var _e,pe;const o=r,k=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:o.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:T}=mt(),S=G({}),A=U(()=>{var $;if(!o.is_editing||!(($=o.candidatura)!=null&&$.formulario_data))return!1;const d=Object.keys(o.candidatura.formulario_data),l=o.configuracion_campos.map(t=>t.id),i=d.some(t=>!l.includes(t)),v=o.configuracion_campos.some(t=>t.required&&!o.candidatura.formulario_data[t.id]);return i||v}),a=Ze((()=>{var l;const d={};return o.configuracion_campos.forEach(i=>{i.type==="checkbox"?d[i.id]=[]:i.type==="file"?d[i.id]=[]:i.type==="convocatoria"?d[i.id]=void 0:i.type==="disclaimer"?d[i.id]=null:i.type==="repeater"?d[i.id]=[]:i.type==="datepicker"?d[i.id]=null:d[i.id]=""}),(l=o.candidatura)!=null&&l.formulario_data&&(Object.assign(d,o.candidatura.formulario_data),o.configuracion_campos.forEach(i=>{i.type==="file"&&d[i.id]&&(Array.isArray(d[i.id])||(d[i.id]=[d[i.id]]))})),{formulario_data:d}})()),y=G(o.configuracion_campos),w=U(()=>a.formulario_data),{visibleFields:D,clearHiddenFieldValues:O}=_t(y,w);te(D,()=>{O()});const{state:F,isSaving:N,hasSaved:h,hasError:g,startWatching:c,stopAutoSave:B,restoreDraft:Y,clearLocalStorage:z}=Va(w,{url:"/candidaturas/autosave",candidaturaId:((_e=o.candidatura)==null?void 0:_e.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((pe=o.candidatura)==null?void 0:pe.id)||"new"}`});let L=null;Je(()=>{const d=["borrador","rechazado"];if(!o.candidatura||d.includes(o.candidatura.estado)){if(!o.is_editing){const i=Y();i&&i.formulario_data&&(J.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{z(),a.reset(),J.success("Borrador descartado")}},duration:5e3}),Object.assign(a.formulario_data,i.formulario_data))}L=c()}}),et(()=>{L&&L(),B()});const M=U(()=>{const d=j.value.map(i=>{var t;if(!i.required)return{campo:i.id,valid:!0};const v=a.formulario_data[i.id];let $=!1;if(i.type==="checkbox")$=Array.isArray(v)&&v.length>0;else if(i.type==="file")(Array.isArray(v)&&v.length>0||S.value[i.id]&&S.value[i.id].length>0)&&($=!0);else if(i.type==="convocatoria")$=v!=null&&v!=="";else if(i.type==="disclaimer")$=v&&v.accepted===!0;else if(i.type==="repeater"){const Z=((t=i.repeaterConfig)==null?void 0:t.minItems)||0;$=Array.isArray(v)&&v.length>=Z}else i.type==="datepicker"?$=v!=null&&v!=="":$=v&&v.toString().trim()!=="";return!$&&i.required&&console.log(`Campo inválido: ${i.id} (tipo: ${i.type})`,{value:v,pendingFiles:S.value[i.id],required:i.required}),{campo:i.id,valid:$}}),l=d.every(i=>i.valid);return console.log("Validación del formulario:",{allValid:l,results:d}),l}),_=U(()=>o.is_editing?"Editar Candidatura":"Crear Candidatura"),C=U(()=>{var d,l;return a.processing?"Guardando...":o.is_editing?((d=o.candidatura)==null?void 0:d.estado)==="rechazado"?"Reenviar Candidatura":((l=o.candidatura)==null?void 0:l.estado)==="aprobado"?"Solicitar Revisión":"Actualizar Candidatura":"Crear Candidatura"}),j=U(()=>{var l;let d=[...D.value];return o.is_editing&&o.candidatura&&["pendiente","aprobado"].includes(o.candidatura.estado)&&(d=d.filter(v=>v.type!=="convocatoria")),o.is_editing&&((l=o.candidatura)==null?void 0:l.estado)==="aprobado"&&(d=d.filter(i=>i.editable===!0)),d}),q=U(()=>{var i;if(!o.is_editing||!o.candidatura)return!1;let d=!1;if(["pendiente","aprobado"].includes(o.candidatura.estado)&&(d=o.configuracion_campos.some(v=>v.type==="convocatoria")),((i=o.candidatura)==null?void 0:i.estado)==="aprobado"){const v=o.configuracion_campos.some($=>!$.editable&&$.type!=="convocatoria");return d||v}return d}),He=(d,l)=>{S.value[d]=l,a.formulario_data[d]=[...a.formulario_data[d]||[]]},Xe=async()=>{for(const[l,i]of Object.entries(S.value))if(i&&i.length>0)try{const v=await T(i,{module:"candidaturas",fieldId:l});a.formulario_data[l]=v.map($=>$.path),S.value[l]=[]}catch(v){console.error("Error al subir archivos:",v);return}const d={...a.formulario_data};o.configuracion_campos.forEach(l=>{const i=d[l.id];l.required||(i===""||i===void 0||Array.isArray(i)&&i.length===0&&l.type!=="checkbox"&&l.type!=="file")&&(d[l.id]=null)}),a.formulario_data=d,B(),o.is_editing?a.put(`/candidaturas/${o.candidatura.id}`,{onSuccess:()=>{z(),J.success("Candidatura actualizada exitosamente")},onError:l=>{console.error("Errores de validación:",l),(!o.candidatura||["borrador","rechazado"].includes(o.candidatura.estado))&&(L=c())}}):a.post("/candidaturas",{onSuccess:()=>{z(),J.success("Candidatura creada exitosamente")},onError:l=>{console.error("Errores de validación:",l),L=c()}})},R=d=>!!a.errors[`formulario_data.${d}`];return(d,l)=>(u(),p(W,null,[s(e(tt),{title:_.value},null,8,["title"]),s(ht,{breadcrumbs:k},{default:f(()=>{var i,v;return[n("div",Ta,[n("div",Aa,[n("div",null,[n("h1",ja,b(_.value),1),n("p",Ua,b(d.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),s(e(de),{variant:"outline",onClick:l[0]||(l[0]=$=>d.$inertia.visit("/candidaturas"))},{default:f(()=>[s(e(St),{class:"mr-2 h-4 w-4"}),l[2]||(l[2]=x(" Volver "))]),_:1})]),!d.candidatura||["borrador","rechazado"].includes(d.candidatura.estado)?(u(),p("div",Oa,[e(N)?(u(),p("div",Ia,[s(e(ze),{class:"h-4 w-4 animate-spin"}),l[3]||(l[3]=n("span",null,"Guardando automáticamente...",-1))])):e(h)&&!e(g)?(u(),p("div",Fa,[s(e(kt),{class:"h-4 w-4 text-green-600"}),n("span",null,"Guardado automáticamente a las "+b((i=e(F).lastSaved)==null?void 0:i.toLocaleTimeString()),1)])):e(g)?(u(),p("div",qa,[s(e(K),{class:"h-4 w-4"}),l[4]||(l[4]=n("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),p("div",Da,[s(e(ze),{class:"h-4 w-4"}),l[5]||(l[5]=n("span",null,"Autoguardado activado",-1))]))])):V("",!0),d.is_editing&&((v=d.candidatura)!=null&&v.comentarios_admin)?(u(),I(e(ae),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:f(()=>[s(e(ie),null,{default:f(()=>[s(e(De),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:f(()=>[s(e(K),{class:"h-5 w-5"}),l[6]||(l[6]=x(" Comentarios de la comisión "))]),_:1})]),_:1}),s(e(re),null,{default:f(()=>[n("p",Na,b(d.candidatura.comentarios_admin),1)]),_:1})]),_:1})):V("",!0),s(e(ae),null,{default:f(()=>[s(e(ie),null,{default:f(()=>[s(e(De),{class:"flex items-center gap-2"},{default:f(()=>[s(e(Ct),{class:"h-5 w-5"}),l[7]||(l[7]=x(" Información de Candidatura "))]),_:1})]),_:1}),s(e(re),null,{default:f(()=>{var $;return[n("form",{onSubmit:at(Xe,["prevent"]),class:"space-y-6"},[d.is_editing&&(($=d.candidatura)==null?void 0:$.estado)==="aprobado"?(u(),p("div",Ba,[n("div",La,[s(e(K),{class:"h-5 w-5 text-blue-600 mt-0.5"}),n("div",Pa,[l[8]||(l[8]=n("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),l[9]||(l[9]=n("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),q.value?(u(),p("p",za," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):V("",!0)])])])):V("",!0),A.value?(u(),p("div",Ma,[n("div",Ra,[s(e(K),{class:"h-5 w-5 text-amber-600 mt-0.5"}),l[10]||(l[10]=n("div",{class:"text-sm text-amber-800"},[n("p",{class:"font-medium"},"Formulario Actualizado"),n("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):V("",!0),s(rt,{name:"fade-field",tag:"div",class:"space-y-6"},{default:f(()=>[(u(!0),p(W,null,H(j.value,t=>{var Z,ge,ve,be,ye,he,xe,$e,Se,ke,Ce,we,Ee,Ve,Te,Ae,je,Ue,Oe,Ie,Fe;return u(),p("div",{key:t.id,class:"space-y-2"},[s(e(Q),{for:t.id,class:"flex items-center gap-1"},{default:f(()=>[x(b(t.title)+" ",1),t.required?(u(),p("span",Wa,"*")):V("",!0)]),_:2},1032,["for"]),t.description?(u(),p("p",Ga,b(t.description),1)):V("",!0),t.type==="text"||t.type==="email"?(u(),I(e(le),{key:1,id:t.id,type:t.type,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,placeholder:t.placeholder||"",class:P({"border-destructive":R(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(u(),I(e(ft),{key:2,id:t.id,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,placeholder:t.placeholder||"",rows:4,class:P({"border-destructive":R(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(u(),I(e(le),{key:3,id:t.id,type:"number",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,placeholder:t.placeholder||"",class:P({"border-destructive":R(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(u(),I(e(le),{key:4,id:t.id,type:"date",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,class:P({"border-destructive":R(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(u(),I(e(dt),{key:5,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m},{default:f(()=>[s(e(lt),{class:P({"border-destructive":R(t.id)})},{default:f(()=>[s(e(nt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),s(e(ut),null,{default:f(()=>[(u(!0),p(W,null,H(t.options,m=>(u(),I(e(ct),{key:m,value:m},{default:f(()=>[x(b(m),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(u(),p("div",Ja,[(u(!0),p(W,null,H(t.options,m=>(u(),p("div",{key:m,class:"flex items-center space-x-2"},[it(n("input",{id:`${t.id}_${m}`,name:t.id,type:"radio",value:m,"onUpdate:modelValue":oe=>e(a).formulario_data[t.id]=oe,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Ka),[[st,e(a).formulario_data[t.id]]]),s(e(Q),{for:`${t.id}_${m}`,class:"text-sm font-normal"},{default:f(()=>[x(b(m),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(u(),p("div",Ya,[(u(!0),p(W,null,H(t.options,m=>(u(),p("div",{key:m,class:"flex items-center space-x-2"},[s(e(ot),{id:`${t.id}_${m}`,checked:e(a).formulario_data[t.id].includes(m),"onUpdate:checked":oe=>{if(oe)e(a).formulario_data[t.id].includes(m)||e(a).formulario_data[t.id].push(m);else{const qe=e(a).formulario_data[t.id].indexOf(m);qe>-1&&e(a).formulario_data[t.id].splice(qe,1)}}},null,8,["id","checked","onUpdate:checked"]),s(e(Q),{for:`${t.id}_${m}`,class:"text-sm font-normal"},{default:f(()=>[x(b(m),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(u(),p("div",Ha,[s(pt,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,onFilesSelected:m=>He(t.id,m),label:"",description:"",required:t.required,multiple:((Z=t.fileConfig)==null?void 0:Z.multiple)||!1,"max-files":((ge=t.fileConfig)==null?void 0:ge.maxFiles)||5,"max-file-size":((ve=t.fileConfig)==null?void 0:ve.maxFileSize)||10,accept:((be=t.fileConfig)==null?void 0:be.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(a).errors[`formulario_data.${t.id}`],disabled:e(a).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(u(),p("div",Xa,[s(ta,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,required:t.required,disabled:e(a).processing||d.is_editing&&((ye=d.candidatura)==null?void 0:ye.estado)!=="borrador","filtrar-por-ubicacion":((he=t.convocatoriaConfig)==null?void 0:he.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),R(t.id)?(u(),p("div",Qa,b(e(a).errors[`formulario_data.${t.id}`]),1)):V("",!0)])):t.type==="datepicker"?(u(),p("div",Za,[s(gt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-date":(xe=t.datepickerConfig)==null?void 0:xe.minDate,"max-date":($e=t.datepickerConfig)==null?void 0:$e.maxDate,format:((Se=t.datepickerConfig)==null?void 0:Se.format)||"DD/MM/YYYY","allow-past-dates":((ke=t.datepickerConfig)==null?void 0:ke.allowPastDates)??!0,"allow-future-dates":((Ce=t.datepickerConfig)==null?void 0:Ce.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(u(),p("div",er,[s(vt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"disclaimer-text":((we=t.disclaimerConfig)==null?void 0:we.disclaimerText)||"","modal-title":((Ee=t.disclaimerConfig)==null?void 0:Ee.modalTitle)||"Términos y Condiciones","accept-button-text":((Ve=t.disclaimerConfig)==null?void 0:Ve.acceptButtonText)||"Acepto","decline-button-text":((Te=t.disclaimerConfig)==null?void 0:Te.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(u(),p("div",tr,[s(bt,{"model-value":e(a).formulario_data[t.id]||[],"onUpdate:modelValue":m=>e(a).formulario_data[t.id]=m,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-items":((Ae=t.repeaterConfig)==null?void 0:Ae.minItems)||0,"max-items":((je=t.repeaterConfig)==null?void 0:je.maxItems)||10,"item-name":((Ue=t.repeaterConfig)==null?void 0:Ue.itemName)||"Elemento","add-button-text":((Oe=t.repeaterConfig)==null?void 0:Oe.addButtonText)||"Agregar elemento","remove-button-text":((Ie=t.repeaterConfig)==null?void 0:Ie.removeButtonText)||"Eliminar",fields:((Fe=t.repeaterConfig)==null?void 0:Fe.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):V("",!0),R(t.id)?(u(),p("p",ar,b(e(a).errors[`formulario_data.${t.id}`]),1)):V("",!0)])}),128))]),_:1}),e(a).errors.general?(u(),p("div",rr,[n("p",ir,b(e(a).errors.general),1)])):V("",!0),n("div",sr,[s(e(de),{variant:"outline",type:"button",onClick:l[1]||(l[1]=t=>d.$inertia.visit("/candidaturas"))},{default:f(()=>l[11]||(l[11]=[x(" Cancelar ")])),_:1}),s(e(de),{type:"submit",disabled:!M.value||e(a).processing},{default:f(()=>[s(e(wt),{class:"mr-2 h-4 w-4"}),x(" "+b(C.value),1)]),_:1},8,["disabled"])])],32)]}),_:1})]),_:1})])]}),_:1})],64))}}),Xr=xt(or,[["__scopeId","data-v-82ed97a1"]]);export{Xr as default};
