import{d as Z,C as K,c as x,w as ee,j as k,o as c,e as t,b as l,f as n,u as e,m as se,i as A,g as a,P as L,h as le,t as u,a as f,F as h,r as $,W as te}from"./app-DDSU5uN7.js";import{d as ie,T as oe,_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-C7XcGlX4.js";import{_ as g}from"./createLucideIcon-BfVy0SFr.js";import{_ as S,a as w,b as P,c as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-CfXCxct6.js";import{_ as U}from"./CardDescription.vue_vue_type_script_setup_true_lang-R8khDAHy.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-DloUOX4w.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-B6qLE2NP.js";import{_ as re}from"./Textarea.vue_vue_type_script_setup_true_lang-CNVqZXHh.js";import{_ as j}from"./Checkbox.vue_vue_type_script_setup_true_lang-B1pi0cAi.js";import{C as ne,_ as O}from"./index-BTN_CKnm.js";import{_ as de,a as me,b as C,c as D}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CnGQ_xel.js";import{_ as ue}from"./ScrollArea.vue_vue_type_script_setup_true_lang-C4sLquia.js";import{_ as ce,a as pe}from"./index-BaCJCCFv.js";import{_ as fe}from"./Switch.vue_vue_type_script_setup_true_lang-BX7DVyVl.js";import{_ as v}from"./InputError.vue_vue_type_script_setup_true_lang-Cu-R7MZZ.js";import{A as _e}from"./arrow-left-BDJyv-QG.js";import{L as ve}from"./lock-DycPBc1L.js";import{U as ge}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CtnWlOEt.js";import{S as be}from"./save-D7KdBMYf.js";import"./index-APndk64q.js";import"./check-Cnad2drU.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BUWx5DM7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-B-HIcCfq.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-DhdtXOhv.js";import"./VisuallyHidden-bGJF1x_r.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-D_RAhnKd.js";import"./index-DlY_kZJS.js";import"./calendar-BerL1z25.js";import"./map-pin-4Kefx8iA.js";import"./RovingFocusItem-BFrOkdA9.js";import"./utils-DesyTqqv.js";import"./VisuallyHiddenInput-BpmWuG2w.js";const xe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ye={class:"flex items-center justify-between"},ke={class:"flex gap-2"},he={class:"space-y-2"},$e={class:"space-y-2"},Se={class:"space-y-2"},we={class:"space-y-2"},Pe={class:"flex items-center justify-between"},Ve={class:"space-y-0.5"},Ue={class:"text-xs text-muted-foreground"},je={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},Ce={class:"flex gap-2 mt-4"},De={class:"space-y-6"},Ee={class:"flex items-center space-x-2 pb-2 border-b"},Ae={class:"grid grid-cols-2 gap-3 pl-6"},Re={class:"grid grid-cols-2 gap-4"},Le={key:0,class:"space-y-3"},Me={class:"flex-1"},Oe={class:"text-xs text-muted-foreground mt-1"},Fe={key:1,class:"text-center py-8 text-muted-foreground"},Ge={class:"flex justify-end gap-4"},ys=Z({__name:"Edit",props:{role:{},segments:{},availablePermissions:{},modules:{},selectedSegments:{}},setup(F){const d=F,G=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Editar Rol",href:"#"}],i=K({name:d.role.name,display_name:d.role.display_name,description:d.role.description||"",is_administrative:!!d.role.is_administrative,permissions:d.role.permissions||[],allowed_modules:d.role.allowed_modules||[],segment_ids:d.selectedSegments||[]}),y=x(()=>["super_admin","admin","manager","user","end_customer"].includes(d.role.name)),b=x(()=>i.is_administrative?d.availablePermissions.administrative:d.availablePermissions.frontend),N=x(()=>i.is_administrative?d.modules.administrative:d.modules.frontend),R=r=>{const s=b.value[r];return s?Object.keys(s.permissions).every(m=>i.permissions.includes(m)):!1},z=r=>{const s=b.value[r];if(!s)return!1;const o=Object.keys(s.permissions),m=o.filter(p=>i.permissions.includes(p)).length;return m>0&&m<o.length},B=r=>{const s=i.permissions.indexOf(r);s>-1?i.permissions.splice(s,1):i.permissions.push(r)},T=r=>{const s=b.value[r];if(!s)return;const o=Object.keys(s.permissions);R(r)?i.permissions=i.permissions.filter(p=>!o.includes(p)):o.forEach(p=>{i.permissions.includes(p)||i.permissions.push(p)})},q=r=>{const s=i.allowed_modules.indexOf(r);s>-1?i.allowed_modules.splice(s,1):i.allowed_modules.push(r)},W=r=>{const s=i.segment_ids.indexOf(r);s>-1?i.segment_ids.splice(s,1):i.segment_ids.push(r)},I=()=>{i.put(`/admin/roles/${d.role.id}`,{preserveScroll:!0,onSuccess:()=>{}})},H=()=>{confirm(`¿Estás seguro de eliminar el rol "${d.role.display_name}"? Esta acción no se puede deshacer.`)&&te.delete(`/admin/roles/${d.role.id}`)},J=()=>{const r=[];Object.values(b.value).forEach(s=>{Object.keys(s.permissions).forEach(o=>{r.push(o)})}),i.permissions=r},Q=()=>{i.permissions=[]};ee(()=>i.is_administrative,(r,s)=>{s!==void 0&&r!==s&&(i.permissions=[],i.allowed_modules=[])});const X=x(()=>i.permissions.length),Y=x(()=>!y.value);return(r,s)=>(c(),k(ae,{breadcrumbs:G},{default:t(()=>[l(e(se),{title:"Editar Rol"}),n("div",xe,[n("div",ye,[s[6]||(s[6]=n("div",null,[n("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Rol"),n("p",{class:"text-muted-foreground"}," Modifica los permisos y configuración del rol ")],-1)),n("div",ke,[Y.value?(c(),k(e(g),{key:0,onClick:H,variant:"destructive",type:"button"},{default:t(()=>s[4]||(s[4]=[a(" Eliminar Rol ")])),_:1})):A("",!0),l(e(L),{href:r.route("admin.roles.index")},{default:t(()=>[l(e(g),{variant:"outline"},{default:t(()=>[l(e(_e),{class:"mr-2 h-4 w-4"}),s[5]||(s[5]=a(" Volver "))]),_:1})]),_:1},8,["href"])])]),y.value?(c(),k(e(ce),{key:0},{default:t(()=>[l(e(ne),{class:"h-4 w-4"}),l(e(pe),null,{default:t(()=>s[7]||(s[7]=[a(" Este es un rol del sistema. Algunas configuraciones pueden estar restringidas. ")])),_:1})]),_:1})):A("",!0),n("form",{onSubmit:le(I,["prevent"]),class:"space-y-6"},[l(e(de),{defaultValue:"general",class:"space-y-4"},{default:t(()=>[l(e(me),{class:"grid w-full grid-cols-4"},{default:t(()=>[l(e(C),{value:"general"},{default:t(()=>[l(e(ie),{class:"mr-2 h-4 w-4"}),s[8]||(s[8]=a(" General "))]),_:1}),l(e(C),{value:"permissions"},{default:t(()=>[l(e(ve),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=a(" Permisos "))]),_:1}),l(e(C),{value:"modules"},{default:t(()=>[l(e(ge),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=a(" Módulos "))]),_:1}),l(e(C),{value:"segments"},{default:t(()=>[l(e(oe),{class:"mr-2 h-4 w-4"}),s[11]||(s[11]=a(" Segmentos "))]),_:1})]),_:1}),l(e(D),{value:"general"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[12]||(s[12]=[a("Información General")])),_:1}),l(e(U),null,{default:t(()=>s[13]||(s[13]=[a(" Define el nombre y descripción del rol ")])),_:1})]),_:1}),l(e(V),{class:"space-y-4"},{default:t(()=>[n("div",he,[l(e(_),{htmlFor:"name"},{default:t(()=>s[14]||(s[14]=[a("Nombre del Rol (interno)")])),_:1}),l(e(M),{id:"name",modelValue:e(i).name,"onUpdate:modelValue":s[0]||(s[0]=o=>e(i).name=o),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos",disabled:y.value},null,8,["modelValue","disabled"]),s[15]||(s[15]=n("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),l(v,{message:e(i).errors.name},null,8,["message"])]),n("div",$e,[l(e(_),{htmlFor:"display_name"},{default:t(()=>s[16]||(s[16]=[a("Nombre a Mostrar")])),_:1}),l(e(M),{id:"display_name",modelValue:e(i).display_name,"onUpdate:modelValue":s[1]||(s[1]=o=>e(i).display_name=o),placeholder:"Administrador Regional"},null,8,["modelValue"]),l(v,{message:e(i).errors.display_name},null,8,["message"])]),n("div",Se,[l(e(_),{htmlFor:"description"},{default:t(()=>s[17]||(s[17]=[a("Descripción")])),_:1}),l(e(re),{id:"description",modelValue:e(i).description,"onUpdate:modelValue":s[2]||(s[2]=o=>e(i).description=o),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),l(v,{message:e(i).errors.description},null,8,["message"])]),n("div",we,[n("div",Pe,[n("div",Ve,[l(e(_),{htmlFor:"is_administrative"},{default:t(()=>s[18]||(s[18]=[a("Rol Administrativo")])),_:1}),s[19]||(s[19]=n("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),l(e(fe),{id:"is_administrative",modelValue:e(i).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=o=>e(i).is_administrative=o),disabled:y.value},null,8,["modelValue","disabled"])]),l(v,{message:e(i).errors.is_administrative},null,8,["message"]),n("div",Ue," Debug: is_administrative = "+u(e(i).is_administrative)+" ("+u(typeof e(i).is_administrative)+") ",1)]),n("div",je,[n("p",null,"ID del Rol: "+u(r.role.id),1),n("p",null,"Creado: "+u(new Date(r.role.created_at).toLocaleDateString()),1),n("p",null,"Última actualización: "+u(new Date(r.role.updated_at).toLocaleDateString()),1)])]),_:1})]),_:1})]),_:1}),l(e(D),{value:"permissions"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[20]||(s[20]=[a("Matriz de Permisos")])),_:1}),l(e(U),null,{default:t(()=>[a(u(e(i).is_administrative?"Selecciona los permisos administrativos para este rol":"Selecciona los permisos de usuario para este rol"),1)]),_:1}),n("div",Ce,[l(e(g),{type:"button",size:"sm",variant:"outline",onClick:J},{default:t(()=>s[21]||(s[21]=[a(" Seleccionar Todos ")])),_:1}),l(e(g),{type:"button",size:"sm",variant:"outline",onClick:Q},{default:t(()=>s[22]||(s[22]=[a(" Limpiar Todos ")])),_:1}),l(e(O),{variant:"secondary",class:"ml-auto"},{default:t(()=>[a(u(X.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),l(e(V),null,{default:t(()=>[l(e(ue),{class:"h-[500px] pr-4"},{default:t(()=>[n("div",De,[(c(!0),f(h,null,$(b.value,(o,m)=>(c(),f("div",{key:m,class:"space-y-3"},[n("div",Ee,[l(e(j),{checked:R(m),indeterminate:z(m),"onUpdate:checked":p=>T(m)},null,8,["checked","indeterminate","onUpdate:checked"]),l(e(_),{class:"text-sm font-semibold"},{default:t(()=>[a(u(o.label),1)]),_:2},1024)]),n("div",Ae,[(c(!0),f(h,null,$(o.permissions,(p,E)=>(c(),f("div",{key:E,class:"flex items-center space-x-2"},[l(e(j),{checked:e(i).permissions.includes(E),"onUpdate:checked":Ne=>B(E)},null,8,["checked","onUpdate:checked"]),l(e(_),{class:"text-sm font-normal cursor-pointer"},{default:t(()=>[a(u(p),1)]),_:2},1024)]))),128))])]))),128))])]),_:1}),l(v,{message:e(i).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(D),{value:"modules"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[23]||(s[23]=[a("Módulos Permitidos")])),_:1}),l(e(U),null,{default:t(()=>[a(u(e(i).is_administrative?"Selecciona los módulos administrativos a los que tendrá acceso este rol":"Selecciona los módulos del portal público a los que tendrá acceso este rol"),1)]),_:1})]),_:1}),l(e(V),null,{default:t(()=>[n("div",Re,[(c(!0),f(h,null,$(N.value,(o,m)=>(c(),f("div",{key:m,class:"flex items-center space-x-2"},[l(e(j),{checked:e(i).allowed_modules.includes(m),"onUpdate:checked":p=>q(m)},null,8,["checked","onUpdate:checked"]),l(e(_),{class:"text-sm font-normal cursor-pointer"},{default:t(()=>[a(u(o),1)]),_:2},1024)]))),128))]),l(v,{message:e(i).errors.allowed_modules},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(D),{value:"segments"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[24]||(s[24]=[a("Segmentos de Datos")])),_:1}),l(e(U),null,{default:t(()=>s[25]||(s[25]=[a(" Asocia segmentos para limitar el alcance de datos visibles ")])),_:1})]),_:1}),l(e(V),null,{default:t(()=>[r.segments.length>0?(c(),f("div",Le,[(c(!0),f(h,null,$(r.segments,o=>(c(),f("div",{key:o.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[l(e(j),{checked:e(i).segment_ids.includes(o.id),"onUpdate:checked":m=>W(o.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),n("div",Me,[l(e(_),{class:"text-sm font-medium cursor-pointer"},{default:t(()=>[a(u(o.name),1)]),_:2},1024),n("p",Oe,u(o.description||"Sin descripción"),1),o.user_count?(c(),k(e(O),{key:0,variant:"outline",class:"mt-2"},{default:t(()=>[a(u(o.user_count)+" usuarios ",1)]),_:2},1024)):A("",!0)])]))),128))])):(c(),f("div",Fe," No hay segmentos disponibles ")),l(v,{message:e(i).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),n("div",Ge,[l(e(L),{href:r.route("admin.roles.index")},{default:t(()=>[l(e(g),{type:"button",variant:"outline"},{default:t(()=>s[26]||(s[26]=[a(" Cancelar ")])),_:1})]),_:1},8,["href"]),l(e(g),{type:"submit",disabled:e(i).processing},{default:t(()=>[l(e(be),{class:"mr-2 h-4 w-4"}),a(" "+u(e(i).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{ys as default};
