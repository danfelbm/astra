import{d as fe,C as _e,r as g,c as h,b as v,e as d,w as t,g as i,f as a,t as u,u as e,h as n,l as be,j as p,i as m,n as I,F as S,k as U,W as ge}from"./app-Dt2sukkq.js";import{_ as ve}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BAX2dDyG.js";import{_ as V,a as $,b as k,c as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-D3D16Ztn.js";import{_ as B}from"./CardDescription.vue_vue_type_script_setup_true_lang-CpG721w4.js";import{_ as x}from"./createLucideIcon-ADYiFz1p.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-B3JXaiF3.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-DCZhrf2e.js";import{_ as H}from"./Textarea.vue_vue_type_script_setup_true_lang-CU9dUjfW.js";import{_ as O,a as W,b as X,c as J,d as K}from"./SelectValue.vue_vue_type_script_setup_true_lang-XTf0O-lR.js";import{_ as Q}from"./index-DZUQ23bj.js";import{_ as Y,a as Z,b as ee}from"./index-C_zthh-d.js";import{_ as he,a as xe}from"./index-Dgfn2Mhg.js";import{_ as oe}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-BDUwohjA.js";import{_ as ye}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-C9-k9UL2.js";import{u as Ve}from"./useToast-hhFFdGxp.js";import{F as $e}from"./flag-DF2NzOSS.js";import{X as ae}from"./x-BpcUsJXn.js";import{U as se}from"./user-plus-Cvkmfd0W.js";import{C as ke}from"./circle-alert-Bny28mZr.js";import{A as Ce}from"./arrow-left-CcnTTf_x.js";import{S as we}from"./save-CPLxPeAL.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Dk5ovgNn.js";import"./index-DYtBqwXi.js";import"./floating-ui.vue-DhUnkJfc.js";import"./shield-Cyievtug.js";import"./user-Ca0ja34E.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Ch_KWbnG.js";import"./chevron-right-CkT1ue1I.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-V01rVzxA.js";import"./VisuallyHidden-H3fpmsLx.js";import"./index-YHYyGAco.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CwNj20AO.js";import"./index-CTkeagVR.js";import"./map-pin-D1rtVCPc.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-TmplCPgM.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BlnKZeFr.js";import"./chevrons-up-down-CLsbi7q1.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BcP5joWp.js";import"./tag-euMStffd.js";import"./users-ARKz5o5z.js";import"./target-BlHWusLl.js";import"./vote-D-ho2Upj.js";import"./folder-open-BwpEZUDw.js";import"./send-D6GePUDU.js";import"./file-text-CrhgvIVS.js";import"./briefcase-CdnBkwVO.js";import"./calendar-CJYt0g6k.js";import"./megaphone-BWKT3hAA.js";import"./user-check-Cjdi1Rn1.js";import"./clipboard-list-DeVxPgd5.js";import"./mail-Cjqn3QRK.js";import"./message-square-CtTij58U.js";import"./external-link-GRGCmSzE.js";import"./panel-left-CvMlf3oX.js";import"./check-DzU-qwfx.js";import"./index-C5GM-A1h.js";import"./nullish-CHIgUVhi.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-C9CiF85Y.js";import"./search-BkHaPo1l.js";import"./loader-circle-A6_XgNGB.js";import"./chevron-left-DryFAzkJ.js";import"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-BiPVkN8R.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-BTeYrLXJ.js";import"./RovingFocusItem-BUHtT0jY.js";import"./utils-CveDOlSQ.js";import"./VisuallyHiddenInput-CTh2PJwg.js";import"./circle-C6O6G82s.js";const Se={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ue={class:"text-muted-foreground mt-2"},Be={class:"grid gap-4 md:grid-cols-3"},Ee={class:"font-medium"},Ae={class:"font-medium"},De={key:0,class:"text-sm text-red-600 mt-1"},ze={key:0,class:"text-sm text-red-600 mt-1"},Re={class:"grid gap-4 md:grid-cols-2"},je={class:"flex items-center gap-2"},Ie={class:"grid gap-4 md:grid-cols-2"},Fe={key:0,class:"text-sm text-red-600 mt-1"},Pe={key:0,class:"text-sm text-red-600 mt-1"},Te={class:"space-y-2"},qe={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},Le={class:"flex items-center gap-2"},Me={class:"font-medium"},Ge={class:"text-sm text-muted-foreground"},He={key:0,class:"text-sm text-red-600 mt-1"},Oe={class:"flex items-center justify-between mb-2"},We={key:0,class:"space-y-2 mt-3"},Xe={class:"flex items-center gap-2"},Je={class:"font-medium"},Ke={class:"text-sm text-muted-foreground"},Qe={key:1,class:"text-sm text-muted-foreground mt-3"};const Ye={class:"list-disc pl-4"},Ze={class:"flex justify-end gap-2"},eo=fe({__name:"Create",props:{proyecto:{},hito:{},usuarios:{},camposPersonalizados:{},estados:{},prioridades:{},siguienteOrden:{}},setup(te){const c=te,{toast:E}=Ve(),s=_e({nombre:"",descripcion:"",fecha_inicio:"",fecha_fin:"",estado:"pendiente",prioridad:"media",responsable_id:null,usuarios_asignados:[],campos_personalizados:{},orden:c.siguienteOrden||1,notas:""});g(!1);const w=g(null),P=g("colaborador"),A=g(!1),D=g(!1),{route:T}=window,re=h(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:c.proyecto.nombre,href:`/admin/proyectos/${c.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${c.proyecto.id}/hitos`},{title:c.hito.nombre,href:`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}`},{title:"Entregables",href:`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`},{title:"Nuevo Entregable"}]),f=g(null),_=g(new Map);c.usuarios.forEach(l=>_.value.set(l.id,l));const le=h(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"colaborador",label:"Colaborador"},{value:"revisor",label:"Revisor"}],value:"colaborador",required:!0}]),ie=h(()=>{const l=s.usuarios_asignados.map(o=>o.user_id);return s.responsable_id&&l.push(s.responsable_id),l}),ne=l=>{if(l.userIds.length>0){const o=l.userIds[0];s.responsable_id=o,_.value.has(o)?f.value=_.value.get(o)||null:(f.value={id:o,name:`Usuario seleccionado (ID: ${o})`,email:"Se actualizará al guardar"},_.value.set(o,f.value))}},de=l=>{l.userIds.forEach(o=>{s.usuarios_asignados.some(N=>N.user_id===o)||(s.usuarios_asignados.push({user_id:o,rol:l.extraData.rol||"colaborador"}),_.value.has(o)||_.value.set(o,{id:o,name:`Usuario #${o}`,email:"Pendiente de actualizar"}))})},ue=()=>{const l={...s.data(),usuarios:s.usuarios_asignados};delete l.usuarios_asignados,s.transform(()=>l).post(`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`,{onSuccess:()=>{E.success("Entregable creado correctamente")},onError:()=>{E.error("Error al crear el entregable")}})},ce=()=>{ge.get(`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`)},oo=()=>{if(!w.value)return;if(s.usuarios_asignados.some(o=>o.user_id===w.value)){E.warning("Este usuario ya está asignado");return}s.usuarios_asignados.push({user_id:w.value,rol:P.value}),w.value=null,P.value="colaborador"},me=l=>{const o=s.usuarios_asignados.findIndex(r=>r.user_id===l);o>-1&&s.usuarios_asignados.splice(o,1)},y=l=>_.value.has(l)?_.value.get(l):c.usuarios.find(o=>o.id===l),ao=h(()=>{const l=s.usuarios_asignados.map(o=>o.user_id);return s.responsable_id&&l.push(s.responsable_id),c.usuarios.filter(o=>!l.includes(o.id))}),z=h(()=>{const l=[];return s.nombre||l.push("El nombre es requerido"),s.nombre.length>255&&l.push("El nombre no puede exceder 255 caracteres"),s.fecha_inicio&&s.fecha_fin&&new Date(s.fecha_inicio)>new Date(s.fecha_fin)&&l.push("La fecha de inicio no puede ser posterior a la fecha de fin"),s.responsable_id||l.push("Debe asignar un responsable"),l}),pe=h(()=>z.value.length===0&&!s.processing);return(l,o)=>(d(),v(ve,{breadcrumbs:re.value},{default:t(()=>[i("div",Se,[i("div",null,[o[15]||(o[15]=i("h2",{class:"text-3xl font-bold tracking-tight"},"Nuevo Entregable",-1)),i("p",Ue,' Agregar un nuevo entregable al hito "'+u(l.hito.nombre)+'" ',1)]),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),{class:"text-base"},{default:t(()=>[...o[16]||(o[16]=[n("Información del Hito",-1)])]),_:1})]),_:1}),a(e(C),null,{default:t(()=>[i("div",Be,[i("div",null,[o[17]||(o[17]=i("p",{class:"text-sm text-muted-foreground"},"Hito",-1)),i("p",Ee,u(l.hito.nombre),1)]),i("div",null,[o[18]||(o[18]=i("p",{class:"text-sm text-muted-foreground"},"Estado",-1)),a(e(Q),null,{default:t(()=>[n(u(l.hito.estado_label||l.hito.estado),1)]),_:1})]),i("div",null,[o[19]||(o[19]=i("p",{class:"text-sm text-muted-foreground"},"Progreso",-1)),i("p",Ae,u(l.hito.porcentaje_completado||0)+"%",1)])])]),_:1})]),_:1}),i("form",{onSubmit:be(ue,["prevent"]),class:"space-y-6"},[a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[20]||(o[20]=[n("Información Básica",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[21]||(o[21]=[n(" Datos principales del entregable ",-1)])]),_:1})]),_:1}),a(e(C),{class:"space-y-4"},{default:t(()=>[i("div",null,[a(e(b),{for:"nombre",class:"required"},{default:t(()=>[...o[22]||(o[22]=[n(" Nombre del entregable ",-1)])]),_:1}),a(e(F),{id:"nombre",modelValue:e(s).nombre,"onUpdate:modelValue":o[0]||(o[0]=r=>e(s).nombre=r),placeholder:"Ej: Documento de diseño técnico",class:I({"border-red-500":e(s).errors.nombre})},null,8,["modelValue","class"]),e(s).errors.nombre?(d(),m("p",De,u(e(s).errors.nombre),1)):p("",!0)]),i("div",null,[a(e(b),{for:"descripcion"},{default:t(()=>[...o[23]||(o[23]=[n(" Descripción ",-1)])]),_:1}),a(e(H),{id:"descripcion",modelValue:e(s).descripcion,"onUpdate:modelValue":o[1]||(o[1]=r=>e(s).descripcion=r),placeholder:"Describe el entregable y sus objetivos...",rows:"4",class:I({"border-red-500":e(s).errors.descripcion})},null,8,["modelValue","class"]),e(s).errors.descripcion?(d(),m("p",ze,u(e(s).errors.descripcion),1)):p("",!0)]),i("div",Re,[i("div",null,[a(e(b),{for:"estado"},{default:t(()=>[...o[24]||(o[24]=[n(" Estado inicial ",-1)])]),_:1}),a(e(O),{modelValue:e(s).estado,"onUpdate:modelValue":o[2]||(o[2]=r=>e(s).estado=r)},{default:t(()=>[a(e(W),null,{default:t(()=>[a(e(X),{placeholder:"Seleccionar estado"})]),_:1}),a(e(J),null,{default:t(()=>[(d(!0),m(S,null,U(l.estados,r=>(d(),v(e(K),{key:r.value,value:r.value},{default:t(()=>[n(u(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),i("div",null,[a(e(b),{for:"prioridad"},{default:t(()=>[...o[25]||(o[25]=[n(" Prioridad ",-1)])]),_:1}),a(e(O),{modelValue:e(s).prioridad,"onUpdate:modelValue":o[3]||(o[3]=r=>e(s).prioridad=r)},{default:t(()=>[a(e(W),null,{default:t(()=>[a(e(X),{placeholder:"Seleccionar prioridad"})]),_:1}),a(e(J),null,{default:t(()=>[(d(!0),m(S,null,U(l.prioridades,r=>(d(),v(e(K),{key:r.value,value:r.value},{default:t(()=>[i("div",je,[a(e($e),{class:I(["h-4 w-4",{"text-blue-500":r.value==="baja","text-yellow-500":r.value==="media","text-red-500":r.value==="alta"}])},null,8,["class"]),n(" "+u(r.label),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[26]||(o[26]=[n("Fechas",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[27]||(o[27]=[n(" Define el período de ejecución del entregable ",-1)])]),_:1})]),_:1}),a(e(C),{class:"space-y-4"},{default:t(()=>[i("div",Ie,[i("div",null,[a(e(b),{for:"fecha_inicio"},{default:t(()=>[...o[28]||(o[28]=[n(" Fecha de inicio ",-1)])]),_:1}),a(e(F),{id:"fecha_inicio",modelValue:e(s).fecha_inicio,"onUpdate:modelValue":o[4]||(o[4]=r=>e(s).fecha_inicio=r),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_inicio?(d(),m("p",Fe,u(e(s).errors.fecha_inicio),1)):p("",!0)]),i("div",null,[a(e(b),{for:"fecha_fin"},{default:t(()=>[...o[29]||(o[29]=[n(" Fecha de fin ",-1)])]),_:1}),a(e(F),{id:"fecha_fin",modelValue:e(s).fecha_fin,"onUpdate:modelValue":o[5]||(o[5]=r=>e(s).fecha_fin=r),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_fin?(d(),m("p",Pe,u(e(s).errors.fecha_fin),1)):p("",!0)])])]),_:1})]),_:1}),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[30]||(o[30]=[n("Asignación",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[31]||(o[31]=[n(" Asigna un responsable y colaboradores al entregable ",-1)])]),_:1})]),_:1}),a(e(C),{class:"space-y-4"},{default:t(()=>[i("div",null,[a(e(b),{for:"responsable",class:"required"},{default:t(()=>[...o[32]||(o[32]=[n(" Responsable principal ",-1)])]),_:1}),i("div",Te,[f.value?(d(),m("div",qe,[i("div",Le,[a(e(Y),{class:"h-8 w-8"},{default:t(()=>[f.value.avatar?(d(),v(e(Z),{key:0,src:f.value.avatar},null,8,["src"])):p("",!0),a(e(ee),null,{default:t(()=>[n(u(f.value.name.substring(0,2).toUpperCase()),1)]),_:1})]),_:1}),i("div",null,[i("p",Me,u(f.value.name),1),i("p",Ge,u(f.value.email),1)])]),a(e(x),{type:"button",variant:"ghost",size:"sm",onClick:o[6]||(o[6]=r=>e(s).responsable_id=null)},{default:t(()=>[a(e(ae),{class:"h-4 w-4"})]),_:1})])):p("",!0),a(e(x),{type:"button",variant:"outline",onClick:o[7]||(o[7]=r=>A.value=!0),class:"w-full"},{default:t(()=>[a(e(se),{class:"h-4 w-4 mr-2"}),n(" "+u(f.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(s).errors.responsable_id?(d(),m("p",He,u(e(s).errors.responsable_id),1)):p("",!0)]),i("div",null,[i("div",Oe,[a(e(b),null,{default:t(()=>[...o[33]||(o[33]=[n(" Colaboradores adicionales ",-1)])]),_:1}),a(e(x),{type:"button",variant:"outline",size:"sm",onClick:o[8]||(o[8]=r=>D.value=!0)},{default:t(()=>[a(e(se),{class:"mr-2 h-4 w-4"}),o[34]||(o[34]=n(" Agregar colaboradores ",-1))]),_:1})]),e(s).usuarios_asignados.length>0?(d(),m("div",We,[(d(!0),m(S,null,U(e(s).usuarios_asignados,r=>{var N,R;return d(),m("div",{key:r.user_id,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},[i("div",Xe,[a(e(Y),{class:"h-8 w-8"},{default:t(()=>{var j,q;return[(j=y(r.user_id))!=null&&j.avatar?(d(),v(e(Z),{key:0,src:(q=y(r.user_id))==null?void 0:q.avatar},null,8,["src"])):p("",!0),a(e(ee),null,{default:t(()=>{var L,M,G;return[n(u(((G=(M=(L=y(r.user_id))==null?void 0:L.name)==null?void 0:M.substring(0,2))==null?void 0:G.toUpperCase())||"US"),1)]}),_:2},1024)]}),_:2},1024),i("div",null,[i("p",Je,u(((N=y(r.user_id))==null?void 0:N.name)||`Usuario #${r.user_id}`),1),i("p",Ke,u(((R=y(r.user_id))==null?void 0:R.email)||""),1)]),a(e(Q),{variant:"outline"},{default:t(()=>[n(u(r.rol),1)]),_:2},1024)]),a(e(x),{type:"button",variant:"ghost",size:"sm",onClick:j=>me(r.user_id)},{default:t(()=>[a(e(ae),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])}),128))])):(d(),m("div",Qe," No hay colaboradores asignados ")),p("",!0)])]),_:1})]),_:1}),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[40]||(o[40]=[n("Notas adicionales",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[41]||(o[41]=[n(" Información adicional o consideraciones especiales ",-1)])]),_:1})]),_:1}),a(e(C),null,{default:t(()=>[a(e(H),{modelValue:e(s).notas,"onUpdate:modelValue":o[11]||(o[11]=r=>e(s).notas=r),placeholder:"Notas adicionales sobre el entregable...",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),l.camposPersonalizados&&l.camposPersonalizados.length>0?(d(),v(ye,{key:0,campos:l.camposPersonalizados,valores:e(s).campos_personalizados,errors:e(s).errors,onUpdate:o[12]||(o[12]=r=>e(s).campos_personalizados=r)},null,8,["campos","valores","errors"])):p("",!0),z.value.length>0?(d(),v(e(he),{key:1,variant:"destructive"},{default:t(()=>[a(e(ke),{class:"h-4 w-4"}),a(e(xe),null,{default:t(()=>[i("ul",Ye,[(d(!0),m(S,null,U(z.value,r=>(d(),m("li",{key:r},u(r),1))),128))])]),_:1})]),_:1})):p("",!0),i("div",Ze,[a(e(x),{type:"button",variant:"outline",onClick:ce},{default:t(()=>[a(e(Ce),{class:"mr-2 h-4 w-4"}),o[42]||(o[42]=n(" Cancelar ",-1))]),_:1}),a(e(x),{type:"submit",disabled:!pe.value},{default:t(()=>[a(e(we),{class:"mr-2 h-4 w-4"}),n(" "+u(e(s).processing?"Creando...":"Crear Entregable"),1)]),_:1},8,["disabled"])])],32)]),a(oe,{modelValue:A.value,"onUpdate:modelValue":o[13]||(o[13]=r=>A.value=r),title:"Seleccionar Responsable Principal",description:"Selecciona el usuario que será el responsable principal del entregable","search-endpoint":e(T)("admin.proyectos.search-users"),"excluded-ids":e(s).responsable_id?[e(s).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:ne},null,8,["modelValue","search-endpoint","excluded-ids"]),a(oe,{modelValue:D.value,"onUpdate:modelValue":o[14]||(o[14]=r=>D.value=r),title:"Agregar Colaboradores",description:"Selecciona los usuarios que colaborarán en este entregable","search-endpoint":e(T)("admin.proyectos.search-users"),"excluded-ids":ie.value,"extra-fields":le.value,"submit-button-text":"Agregar Colaboradores","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:de},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"])]),_:1},8,["breadcrumbs"]))}}),va=Ne(eo,[["__scopeId","data-v-3f15814d"]]);export{va as default};
