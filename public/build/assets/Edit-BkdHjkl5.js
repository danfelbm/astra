import{d as G,C as X,r as V,i as u,e as m,f as s,u as e,p as J,w as i,g as a,b as v,j as f,P,h as n,t as p,l as K,F as x,k as C}from"./app-BFCRP-hu.js";import{_ as Q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DVhxtwsQ.js";import{_ as $,a as k,b as z,c as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-C6Pf_Uif.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-C5iYxevR.js";import{_ as y}from"./createLucideIcon-B48W5HGR.js";import{_ as h}from"./Input.vue_vue_type_script_setup_true_lang-BArk2Dro.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-BSsD_nCa.js";import{_ as W}from"./Textarea.vue_vue_type_script_setup_true_lang-BvpXtNVw.js";import{_ as U,a as D,b as H,c as M,d as E}from"./SelectValue.vue_vue_type_script_setup_true_lang-D4BkPhEO.js";import{_ as Y}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-DV0xaFzQ.js";import{E as Z}from"./EtiquetaSelector-DXljy2iI.js";import{_ as O}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-DthL8b9_.js";import{t as j}from"./index-D4Jmcyj5.js";import{A as ee}from"./arrow-left-BiabW1KV.js";import{X as oe}from"./x-CO2t7227.js";import{U as se}from"./user-plus-BFKQiVAB.js";import{S as te}from"./save-BGOcn2DT.js";import{T as ie}from"./tag-BD_pJCyF.js";import{f as I,e as R}from"./es-BDPlFIsO.js";import{p as B}from"./parseISO-DFjB8F03.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-IDczqvjz.js";import"./index-BV8EXJV5.js";import"./floating-ui.vue-r1jh_cyr.js";import"./index-7Cc0L9l5.js";import"./shield-CJLgSpbM.js";import"./user-B1UdYhgU.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bk1MyGsx.js";import"./chevron-right-jEjsThLi.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-it7-95jd.js";import"./VisuallyHidden-DtgZKa-V.js";import"./index-D4t36AHs.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-dTZ0TTmN.js";import"./circle-alert-Crqw8R8y.js";import"./map-pin-96AKVoID.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Bn4JBZsL.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-Dy-9tXTd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B5X7TeC-.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-C1tM4KQo.js";import"./users-D4nlGR3z.js";import"./target-BG-rBVrT.js";import"./vote-CRb2uBrD.js";import"./folder-open-CdHVd2oB.js";import"./send-B06MTMiq.js";import"./file-text-BNtX5jn7.js";import"./briefcase-DvfVQ7DM.js";import"./calendar-_r6_tYhJ.js";import"./megaphone-Dd-rvhjG.js";import"./user-check-CmuxQ_fm.js";import"./clipboard-list-BbsP5NSE.js";import"./mail-C7hV_ozf.js";import"./message-square-2Ae9CC_o.js";import"./external-link-DVqz8Mr1.js";import"./panel-left-BSTwYg9i.js";import"./index-C4A356_A.js";import"./check-50anzA7W.js";import"./index-BZv-jeFa.js";import"./nullish-CHIgUVhi.js";import"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-CVnM9dLg.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BPQOfPUO.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-OjjH6Oyn.js";import"./RovingFocusItem-DIFJgx_h.js";import"./utils-DHSP7tfB.js";import"./VisuallyHiddenInput-BsNXVvQm.js";import"./circle-Cc_4kpMQ.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-B4ApdS_d.js";import"./TabsTrigger.vue_vue_type_script_setup_true_lang-KlWRsGd7.js";import"./index-BkDoy_-v.js";import"./search-DzHipmqi.js";import"./useKbd-kRIii9yh.js";import"./useEtiquetaHierarchy-B_CuIAZi.js";import"./list-CQPYaV--.js";import"./tree-pine-DJFe6Cey.js";import"./plus-DUQ5nN3r.js";import"./zap-DWKEr6EP.js";import"./layers-DFj5lvvO.js";import"./trending-up-DtR6o0cj.js";import"./award-wiB2F5Sn.js";import"./flag-KNsaGE_a.js";import"./hash-C6CBAZk_.js";import"./loader-circle-BlBV89L7.js";import"./chevron-left-Bh0KDQsI.js";const re={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ae={class:"flex items-center justify-between"},le={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},de={class:"font-semibold"},ne={class:"font-semibold"},pe={class:"font-semibold"},me={class:"font-semibold"},ue={class:"space-y-2"},fe={key:0,class:"text-sm text-red-500"},ce={class:"space-y-2"},_e={key:0,class:"text-sm text-red-500"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={class:"space-y-2"},ve={key:0,class:"text-sm text-red-500"},he={class:"space-y-2"},ge={key:0,class:"text-sm text-red-500"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={class:"space-y-2"},$e={key:0,class:"text-sm text-red-500"},ke={class:"space-y-2"},ze={class:"space-y-2"},Se={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},we={class:"font-medium"},Ee={class:"text-sm text-muted-foreground"},qe={key:0,class:"text-sm text-red-500"},Pe={key:0,class:"space-y-2"},Ce={key:0,class:"text-sm text-red-500"},Ue={class:"space-y-2"},De={key:0,class:"text-sm text-red-500"},He={class:"flex justify-end gap-2 pt-4"},ps=G({__name:"Edit",props:{hito:{},proyecto:{},responsables:{},hitosDisponibles:{},camposPersonalizados:{},valoresCamposPersonalizados:{},categorias:{},estados:{}},setup(F){var q;const d=F,N=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:d.proyecto.nombre,href:`/admin/proyectos/${d.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${d.proyecto.id}/hitos`},{title:"Editar Hito",href:"#"}],t=X({nombre:d.hito.nombre||"",descripcion:d.hito.descripcion||"",fecha_inicio:d.hito.fecha_inicio||"",fecha_fin:d.hito.fecha_fin||"",estado:d.hito.estado||"pendiente",responsable_id:d.hito.responsable_id||null,parent_id:d.hito.parent_id||null,campos_personalizados:d.valoresCamposPersonalizados||{},etiquetas:((q=d.hito.etiquetas)==null?void 0:q.map(l=>l.id))??[],orden:d.hito.orden||0}),g=V(!1),{route:A}=window,c=V(null),b=V(new Map);if(d.responsables.forEach(l=>b.value.set(l.id,l)),d.hito.responsable)c.value=d.hito.responsable,b.value.set(d.hito.responsable.id,d.hito.responsable);else if(t.responsable_id){const l=d.responsables.find(o=>o.id===t.responsable_id);l&&(c.value=l)}const T=l=>{if(l.userIds.length>0){const o=l.userIds[0];t.responsable_id=o,b.value.has(o)?c.value=b.value.get(o)||null:(c.value={id:o,name:`Usuario seleccionado (ID: ${o})`,email:"Se actualizará al guardar"},b.value.set(o,c.value))}},L=()=>{t.put(`/admin/proyectos/${d.proyecto.id}/hitos/${d.hito.id}`,{onSuccess:()=>{j.success("Hito actualizado exitosamente")},onError:()=>{j.error("Error al actualizar el hito")}})};return(l,o)=>(m(),u(x,null,[s(e(J),{title:`Editar Hito - ${l.hito.nombre}`},null,8,["title"]),s(Q,{breadcrumbs:N},{default:i(()=>[a("div",re,[a("div",ae,[o[13]||(o[13]=a("h1",{class:"text-2xl font-bold"},"Editar Hito",-1)),s(e(P),{href:`/admin/proyectos/${l.proyecto.id}/hitos`},{default:i(()=>[s(e(y),{variant:"outline",size:"sm"},{default:i(()=>[s(e(ee),{class:"h-4 w-4 mr-2"}),o[12]||(o[12]=n(" Volver ",-1))]),_:1})]),_:1},8,["href"])]),s(e($),{class:"mb-4"},{default:i(()=>[s(e(k),null,{default:i(()=>[s(e(z),null,{default:i(()=>[n(p(l.hito.nombre),1)]),_:1}),s(e(w),null,{default:i(()=>[n(" Editando hito del proyecto: "+p(l.proyecto.nombre),1)]),_:1})]),_:1}),s(e(S),null,{default:i(()=>{var r;return[a("div",le,[a("div",null,[o[14]||(o[14]=a("p",{class:"text-muted-foreground"},"Progreso",-1)),a("p",de,p(l.hito.porcentaje_completado||0)+"%",1)]),a("div",null,[o[15]||(o[15]=a("p",{class:"text-muted-foreground"},"Entregables",-1)),a("p",ne,p(((r=l.hito.entregables)==null?void 0:r.length)||0),1)]),a("div",null,[o[16]||(o[16]=a("p",{class:"text-muted-foreground"},"Creado",-1)),a("p",pe,p(e(I)(e(B)(l.hito.created_at),"dd/MM/yyyy",{locale:e(R)})),1)]),a("div",null,[o[17]||(o[17]=a("p",{class:"text-muted-foreground"},"Última actualización",-1)),a("p",me,p(e(I)(e(B)(l.hito.updated_at),"dd/MM/yyyy",{locale:e(R)})),1)])])]}),_:1})]),_:1}),s(e($),null,{default:i(()=>[s(e(k),null,{default:i(()=>[s(e(z),null,{default:i(()=>[...o[18]||(o[18]=[n("Información del Hito",-1)])]),_:1}),s(e(w),null,{default:i(()=>[...o[19]||(o[19]=[n(" Modifica los detalles del hito ",-1)])]),_:1})]),_:1}),s(e(S),null,{default:i(()=>[a("form",{onSubmit:K(L,["prevent"]),class:"space-y-6"},[a("div",ue,[s(e(_),{for:"nombre",required:""},{default:i(()=>[...o[20]||(o[20]=[n("Nombre del Hito",-1)])]),_:1}),s(e(h),{id:"nombre",modelValue:e(t).nombre,"onUpdate:modelValue":o[0]||(o[0]=r=>e(t).nombre=r),type:"text",placeholder:"Ej: Pre-producción",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.nombre?(m(),u("span",fe,p(e(t).errors.nombre),1)):f("",!0)]),a("div",ce,[s(e(_),{for:"descripcion"},{default:i(()=>[...o[21]||(o[21]=[n("Descripción",-1)])]),_:1}),s(e(W),{id:"descripcion",modelValue:e(t).descripcion,"onUpdate:modelValue":o[1]||(o[1]=r=>e(t).descripcion=r),placeholder:"Describe el objetivo y alcance del hito...",disabled:e(t).processing,rows:"3"},null,8,["modelValue","disabled"]),e(t).errors.descripcion?(m(),u("span",_e,p(e(t).errors.descripcion),1)):f("",!0)]),a("div",be,[a("div",ye,[s(e(_),{for:"fecha_inicio"},{default:i(()=>[...o[22]||(o[22]=[n("Fecha de Inicio",-1)])]),_:1}),s(e(h),{id:"fecha_inicio",modelValue:e(t).fecha_inicio,"onUpdate:modelValue":o[2]||(o[2]=r=>e(t).fecha_inicio=r),type:"date",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.fecha_inicio?(m(),u("span",ve,p(e(t).errors.fecha_inicio),1)):f("",!0)]),a("div",he,[s(e(_),{for:"fecha_fin"},{default:i(()=>[...o[23]||(o[23]=[n("Fecha de Fin",-1)])]),_:1}),s(e(h),{id:"fecha_fin",modelValue:e(t).fecha_fin,"onUpdate:modelValue":o[3]||(o[3]=r=>e(t).fecha_fin=r),type:"date",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.fecha_fin?(m(),u("span",ge,p(e(t).errors.fecha_fin),1)):f("",!0)])]),a("div",Ve,[a("div",xe,[s(e(_),{for:"estado"},{default:i(()=>[...o[24]||(o[24]=[n("Estado",-1)])]),_:1}),s(e(U),{modelValue:e(t).estado,"onUpdate:modelValue":o[4]||(o[4]=r=>e(t).estado=r)},{default:i(()=>[s(e(D),null,{default:i(()=>[s(e(H),{placeholder:"Seleccionar estado"})]),_:1}),s(e(M),null,{default:i(()=>[(m(!0),u(x,null,C(l.estados,r=>(m(),v(e(E),{key:r.value,value:r.value},{default:i(()=>[n(p(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(t).errors.estado?(m(),u("span",$e,p(e(t).errors.estado),1)):f("",!0)]),a("div",ke,[s(e(_),{for:"responsable_id"},{default:i(()=>[...o[25]||(o[25]=[n("Responsable",-1)])]),_:1}),a("div",ze,[c.value?(m(),u("div",Se,[a("div",null,[a("p",we,p(c.value.name),1),a("p",Ee,p(c.value.email),1)]),s(e(y),{type:"button",variant:"ghost",size:"sm",onClick:o[5]||(o[5]=r=>{e(t).responsable_id=null,c.value=null})},{default:i(()=>[s(e(oe),{class:"h-4 w-4"})]),_:1})])):f("",!0),s(e(y),{type:"button",variant:"outline",onClick:o[6]||(o[6]=r=>g.value=!0),class:"w-full"},{default:i(()=>[s(e(se),{class:"h-4 w-4 mr-2"}),n(" "+p(c.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(t).errors.responsable_id?(m(),u("span",qe,p(e(t).errors.responsable_id),1)):f("",!0)])]),l.hitosDisponibles&&l.hitosDisponibles.length>0?(m(),u("div",Pe,[s(e(_),{for:"parent_id"},{default:i(()=>[...o[26]||(o[26]=[n("Hito Padre (opcional)",-1)])]),_:1}),s(e(U),{modelValue:e(t).parent_id,"onUpdate:modelValue":o[7]||(o[7]=r=>e(t).parent_id=r)},{default:i(()=>[s(e(D),null,{default:i(()=>[s(e(H),{placeholder:"Sin padre (raíz)"})]),_:1}),s(e(M),null,{default:i(()=>[s(e(E),{value:null},{default:i(()=>[...o[27]||(o[27]=[n("Sin padre (raíz)",-1)])]),_:1}),(m(!0),u(x,null,C(l.hitosDisponibles,r=>(m(),v(e(E),{key:r.id,value:r.id,disabled:r.id===l.hito.id},{default:i(()=>[n(p("—".repeat(r.nivel))+" "+p(r.nombre),1)]),_:2},1032,["value","disabled"]))),128))]),_:1})]),_:1},8,["modelValue"]),o[28]||(o[28]=a("p",{class:"text-sm text-muted-foreground"},"Selecciona un hito padre para crear una jerarquía",-1)),e(t).errors.parent_id?(m(),u("span",Ce,p(e(t).errors.parent_id),1)):f("",!0)])):f("",!0),a("div",Ue,[s(e(_),{for:"orden"},{default:i(()=>[...o[29]||(o[29]=[n("Orden de visualización",-1)])]),_:1}),s(e(h),{id:"orden",modelValue:e(t).orden,"onUpdate:modelValue":o[8]||(o[8]=r=>e(t).orden=r),modelModifiers:{number:!0},type:"number",min:"0",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.orden?(m(),u("span",De,p(e(t).errors.orden),1)):f("",!0),o[30]||(o[30]=a("p",{class:"text-sm text-muted-foreground"}," Define el orden en que aparece este hito en la lista ",-1))]),a("div",He,[s(e(P),{href:`/admin/proyectos/${l.proyecto.id}/hitos`},{default:i(()=>[s(e(y),{type:"button",variant:"outline"},{default:i(()=>[...o[31]||(o[31]=[n("Cancelar",-1)])]),_:1})]),_:1},8,["href"]),s(e(y),{type:"submit",disabled:e(t).processing},{default:i(()=>[s(e(te),{class:"h-4 w-4 mr-2"}),o[32]||(o[32]=n(" Guardar Cambios ",-1))]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),l.camposPersonalizados&&l.camposPersonalizados.length>0?(m(),v(Y,{key:0,campos:l.camposPersonalizados,valores:e(t).campos_personalizados,errors:e(t).errors,onUpdate:o[9]||(o[9]=r=>e(t).campos_personalizados=r)},null,8,["campos","valores","errors"])):f("",!0),l.categorias&&l.categorias.length>0?(m(),v(e($),{key:1},{default:i(()=>[s(e(k),null,{default:i(()=>[s(e(z),{class:"flex items-center gap-2"},{default:i(()=>[s(e(ie),{class:"h-5 w-5"}),o[33]||(o[33]=n(" Etiquetas ",-1))]),_:1}),s(e(w),null,{default:i(()=>[...o[34]||(o[34]=[n(" Asigna etiquetas para categorizar y organizar este hito ",-1)])]),_:1})]),_:1}),s(e(S),null,{default:i(()=>[s(Z,{modelValue:e(t).etiquetas,"onUpdate:modelValue":o[10]||(o[10]=r=>e(t).etiquetas=r),categorias:l.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas para el hito...",description:"Puedes asignar hasta 10 etiquetas"},null,8,["modelValue","categorias"])]),_:1})]),_:1})):f("",!0)]),s(O,{modelValue:g.value,"onUpdate:modelValue":o[11]||(o[11]=r=>g.value=r),title:"Seleccionar Responsable del Hito",description:"Selecciona el usuario que será responsable de este hito","search-endpoint":e(A)("admin.proyectos.search-users"),"excluded-ids":e(t).responsable_id?[e(t).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:T},null,8,["modelValue","search-endpoint","excluded-ids"])]),_:1})],64))}});export{ps as default};
