import{d as Y,r as z,c as J,i as v,F as S,e as s,f as e,w as t,b as f,j as m,h as d,k as T,g as u,m as n,l as ie,t as _,x as de,y as re}from"./app-GR0lRfG3.js";import{_ as ue,a as ce,b as N,c as b,d as fe,e as $}from"./TableHeader.vue_vue_type_script_setup_true_lang-B5uBx6Zb.js";import{_ as K}from"./Checkbox.vue_vue_type_script_setup_true_lang-BdXJTAua.js";import{c as me,_ as h}from"./createLucideIcon-BHOwJslc.js";import{_ as R}from"./index-CCcLjm2Z.js";import{_ as ve,a as pe,b as _e}from"./index-Drc1VJqQ.js";import{_ as ge}from"./StatusChangeModal.vue_vue_type_script_setup_true_lang-ad2jbkk5.js";import{C as Q}from"./circle-alert-CHl1qw9T.js";import{E as xe}from"./eye-CM3rkcHT.js";import{S as he}from"./square-pen-CAejkQqC.js";import{C as ke}from"./clock-D6DjsNnz.js";import{C as ye}from"./circle-check-C9KJXJeU.js";import{T as Ce}from"./trash-2-BBPGb23q.js";import{C as $e}from"./calendar-DB3c2-8x.js";import{U as we}from"./users-Okp9AxCW.js";import{e as be,C as Ee,_ as q,a as O,b as H,c as X,d as F}from"./SelectValue.vue_vue_type_script_setup_true_lang-CfKpdVFq.js";import{a as Ve,b as De,c as Fe,_ as Se}from"./CardTitle.vue_vue_type_script_setup_true_lang-d36i2cEu.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-CRMaLyBq.js";import{_ as G}from"./Input.vue_vue_type_script_setup_true_lang-BjjFC2UB.js";import{F as W}from"./filter-D70EybLf.js";import{X as D}from"./x-DbT4zcPL.js";import{S as Be}from"./search-CEFtEu-p.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=me("CircleDotIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),Te={class:"font-medium"},Pe={key:0,class:"text-sm text-muted-foreground"},Ie={key:1,class:"flex items-center gap-1 mt-1"},Ue={class:"text-xs text-red-600"},je={key:2,class:"flex items-center gap-1 mt-1"},Le={class:"text-xs text-orange-600"},Re={class:"flex gap-1 mt-2"},Me={key:0,class:"flex items-center gap-2"},Ae={class:"text-sm"},Ne={key:1,class:"text-sm text-muted-foreground"},qe={class:"flex items-center gap-1"},Oe={class:"text-sm"},He={key:0,class:"flex items-center gap-1"},Xe={class:"text-sm"},Ge={key:1,class:"text-sm text-muted-foreground"},Je={key:0,class:"flex flex-wrap gap-1"},Ke={key:1,class:"text-sm text-muted-foreground"},Ps=Y({__name:"EntregablesTable",props:{entregables:{},proyectoId:{},hitoId:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},showCheckbox:{type:Boolean,default:!0}},emits:["view","edit","delete","complete","mark-in-progress","selection-change"],setup(p,{emit:M}){const B=p,y=M,c=z([]),E=z(!1),k=z(null),g=z("pendiente"),w=z(!1),P=J(()=>B.entregables.map(l=>({...l,diasRestantes:j(l.fecha_fin),estaVencido:l.fecha_fin&&j(l.fecha_fin)<0,estaProximoVencer:l.fecha_fin&&j(l.fecha_fin)>=0&&j(l.fecha_fin)<=7}))),I=()=>{c.value.length===B.entregables.length?c.value=[]:c.value=B.entregables.map(l=>l.id),y("selection-change",c.value)},x=l=>c.value.includes(l),a=l=>{const i=c.value.indexOf(l);i>-1?c.value.splice(i,1):c.value.push(l),y("selection-change",c.value)},U=l=>({pendiente:"secondary",en_progreso:"default",completado:"success",cancelado:"destructive"})[l]||"secondary",r=l=>({baja:"outline",media:"default",alta:"destructive"})[l]||"outline",Z=l=>l==="alta"?be:l==="baja"?Ee:ze,ee=l=>l?new Date(l).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-",j=l=>{if(!l)return null;const i=new Date,L=new Date(l).getTime()-i.getTime();return Math.ceil(L/(1e3*60*60*24))},se=l=>{y("view",l)},te=l=>{y("edit",l)},ae=l=>{k.value=l,g.value="completado",E.value=!0},le=l=>{y("delete",l)},oe=l=>{k.value=l,g.value="en_progreso",E.value=!0},ne=l=>{k.value&&(g.value==="completado"?y("complete",k.value,l):g.value==="en_progreso"&&y("mark-in-progress",k.value,l),E.value=!1,k.value=null)};return(l,i)=>{var A,L;return n(),v(S,null,[s(e(ue),null,{default:t(()=>[s(e(ce),null,{default:t(()=>[s(e(N),null,{default:t(()=>[p.showCheckbox?(n(),f(e(b),{key:0,class:"w-[40px]"},{default:t(()=>[s(e(K),{checked:c.value.length===p.entregables.length&&p.entregables.length>0,"onUpdate:checked":I},null,8,["checked"])]),_:1})):m("",!0),s(e(b),null,{default:t(()=>[...i[2]||(i[2]=[d("Entregable",-1)])]),_:1}),s(e(b),null,{default:t(()=>[...i[3]||(i[3]=[d("Responsable",-1)])]),_:1}),s(e(b),null,{default:t(()=>[...i[4]||(i[4]=[d("Estado",-1)])]),_:1}),s(e(b),null,{default:t(()=>[...i[5]||(i[5]=[d("Prioridad",-1)])]),_:1}),s(e(b),null,{default:t(()=>[...i[6]||(i[6]=[d("Fecha Fin",-1)])]),_:1}),s(e(b),null,{default:t(()=>[...i[7]||(i[7]=[d("Colaboradores",-1)])]),_:1}),s(e(b),null,{default:t(()=>[...i[8]||(i[8]=[d("Etiquetas",-1)])]),_:1})]),_:1})]),_:1}),s(e(fe),null,{default:t(()=>[(n(!0),v(S,null,T(P.value,o=>(n(),f(e(N),{key:o.id,class:"hover:bg-muted/50"},{default:t(()=>[p.showCheckbox?(n(),f(e($),{key:0,onClick:i[0]||(i[0]=ie(()=>{},["stop"]))},{default:t(()=>[s(e(K),{checked:x(o.id),"onUpdate:checked":()=>a(o.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024)):m("",!0),s(e($),null,{default:t(()=>[u("div",null,[u("p",Te,_(o.nombre),1),o.descripcion?(n(),v("p",Pe,_(o.descripcion),1)):m("",!0),o.estaVencido?(n(),v("div",Ie,[s(e(Q),{class:"h-3 w-3 text-red-600"}),u("span",Ue,"Vencido hace "+_(Math.abs(o.diasRestantes))+" días",1)])):o.estaProximoVencer?(n(),v("div",je,[s(e(Q),{class:"h-3 w-3 text-orange-600"}),u("span",Le,"Vence en "+_(o.diasRestantes)+" días",1)])):m("",!0),u("div",Re,[s(e(h),{variant:"ghost",size:"sm",class:"h-7 px-2 text-xs",onClick:C=>se(o)},{default:t(()=>[s(e(xe),{class:"mr-1 h-3 w-3"}),i[9]||(i[9]=d(" Ver ",-1))]),_:1},8,["onClick"]),p.canEdit?(n(),f(e(h),{key:0,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs",onClick:C=>te(o)},{default:t(()=>[s(e(he),{class:"mr-1 h-3 w-3"}),i[10]||(i[10]=d(" Editar ",-1))]),_:1},8,["onClick"])):m("",!0),p.canEdit&&o.estado==="pendiente"?(n(),f(e(h),{key:1,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-blue-600 hover:text-blue-700",onClick:C=>oe(o)},{default:t(()=>[s(e(ke),{class:"mr-1 h-3 w-3"}),i[11]||(i[11]=d(" En Progreso ",-1))]),_:1},8,["onClick"])):m("",!0),p.canComplete&&o.estado!=="completado"?(n(),f(e(h),{key:2,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-green-600 hover:text-green-700",onClick:C=>ae(o)},{default:t(()=>[s(e(ye),{class:"mr-1 h-3 w-3"}),i[12]||(i[12]=d(" Completar ",-1))]),_:1},8,["onClick"])):m("",!0),p.canDelete?(n(),f(e(h),{key:3,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-red-600 hover:text-red-700",onClick:C=>le(o)},{default:t(()=>[s(e(Ce),{class:"mr-1 h-3 w-3"}),i[13]||(i[13]=d(" Eliminar ",-1))]),_:1},8,["onClick"])):m("",!0)])])]),_:2},1024),s(e($),null,{default:t(()=>[o.responsable?(n(),v("div",Me,[s(e(ve),{class:"h-8 w-8"},{default:t(()=>[o.responsable.avatar?(n(),f(e(pe),{key:0,src:o.responsable.avatar},null,8,["src"])):m("",!0),s(e(_e),null,{default:t(()=>[d(_(o.responsable.name.substring(0,2).toUpperCase()),1)]),_:2},1024)]),_:2},1024),u("span",Ae,_(o.responsable.name),1)])):(n(),v("span",Ne,"Sin asignar"))]),_:2},1024),s(e($),null,{default:t(()=>[s(e(R),{variant:U(o.estado)},{default:t(()=>[d(_(o.estado_label),1)]),_:2},1032,["variant"])]),_:2},1024),s(e($),null,{default:t(()=>[s(e(R),{variant:r(o.prioridad)},{default:t(()=>[(n(),f(de(Z(o.prioridad)),{class:"mr-1 h-3 w-3"})),d(" "+_(o.prioridad_label),1)]),_:2},1032,["variant"])]),_:2},1024),s(e($),null,{default:t(()=>[u("div",qe,[s(e($e),{class:"h-4 w-4 text-muted-foreground"}),u("span",Oe,_(ee(o.fecha_fin)),1)])]),_:2},1024),s(e($),null,{default:t(()=>[o.usuarios&&o.usuarios.length>0?(n(),v("div",He,[s(e(we),{class:"h-4 w-4 text-muted-foreground"}),u("span",Xe,_(o.usuarios.length),1)])):(n(),v("span",Ge,"-"))]),_:2},1024),s(e($),null,{default:t(()=>[o.etiquetas&&o.etiquetas.length>0?(n(),v("div",Je,[(n(!0),v(S,null,T(o.etiquetas.slice(0,2),C=>(n(),f(e(R),{key:C.id,variant:"outline",class:"text-xs",style:re({borderColor:C.color||"#94a3b8",color:C.color||"#64748b"})},{default:t(()=>[d(_(C.nombre),1)]),_:2},1032,["style"]))),128)),o.etiquetas.length>2?(n(),f(e(R),{key:0,variant:"outline",class:"text-xs"},{default:t(()=>[d(" +"+_(o.etiquetas.length-2),1)]),_:2},1024)):m("",!0)])):(n(),v("span",Ke,"-"))]),_:2},1024)]),_:2},1024))),128)),p.entregables.length===0?(n(),f(e(N),{key:0},{default:t(()=>[s(e($),{colspan:p.showCheckbox?8:7,class:"text-center py-8"},{default:t(()=>[...i[14]||(i[14]=[u("p",{class:"text-muted-foreground"},"No se encontraron entregables",-1)])]),_:1},8,["colspan"])]),_:1})):m("",!0)]),_:1})]),_:1}),s(ge,{open:E.value,"onUpdate:open":i[1]||(i[1]=o=>E.value=o),"entregable-nombre":(A=k.value)==null?void 0:A.nombre,"estado-actual":(L=k.value)==null?void 0:L.estado,"nuevo-estado":g.value,loading:w.value,onConfirm:ne},null,8,["open","entregable-nombre","estado-actual","nuevo-estado","loading"])],64)}}}),Qe={class:"flex items-center justify-between"},We={class:"flex items-center gap-2"},Ye={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ze={class:"space-y-2"},es={class:"relative"},ss={class:"space-y-2"},ts={class:"flex gap-2"},as={class:"space-y-2"},ls={class:"flex gap-2"},os={key:0,class:"space-y-2"},ns={class:"flex gap-2"},is={class:"space-y-2 md:col-span-2"},ds={class:"grid grid-cols-2 gap-2"},rs={key:1,class:"space-y-4"},us={class:"flex items-center justify-between"},cs={class:"flex items-center gap-2"},Is=Y({__name:"EntregablesFilters",props:{modelValue:{},usuarios:{default:()=>[]},showCard:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(p,{emit:M}){const B=p,y=M,c=J({get:()=>B.modelValue,set:x=>y("update:modelValue",x)}),E=[{value:"pendiente",label:"Pendiente"},{value:"en_progreso",label:"En Progreso"},{value:"completado",label:"Completado"},{value:"cancelado",label:"Cancelado"}],k=[{value:"baja",label:"Baja"},{value:"media",label:"Media"},{value:"alta",label:"Alta"}],g=(x,a)=>{c.value={...c.value,[x]:a}},w=x=>{g(x,null)},P=()=>{c.value={search:null,estado:null,prioridad:null,responsable_id:null,fecha_inicio:null,fecha_fin:null}},I=J(()=>Object.values(c.value).some(x=>x!=null&&x!==""));return(x,a)=>p.showCard?(n(),f(e(Se),{key:0},{default:t(()=>[s(e(Ve),{class:"pb-3"},{default:t(()=>[u("div",Qe,[u("div",We,[s(e(W),{class:"h-4 w-4"}),s(e(De),{class:"text-base"},{default:t(()=>[...a[11]||(a[11]=[d("Filtros de Entregables",-1)])]),_:1})]),I.value?(n(),f(e(h),{key:0,variant:"ghost",size:"sm",onClick:P},{default:t(()=>[s(e(D),{class:"h-4 w-4 mr-1"}),a[12]||(a[12]=d(" Limpiar ",-1))]),_:1})):m("",!0)])]),_:1}),s(e(Fe),null,{default:t(()=>{var U;return[u("div",Ye,[u("div",Ze,[s(e(V),{for:"search"},{default:t(()=>[...a[13]||(a[13]=[d("Buscar",-1)])]),_:1}),u("div",es,[s(e(Be),{class:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),s(e(G),{id:"search",value:c.value.search||"",onInput:a[0]||(a[0]=r=>g("search",r.target.value)),placeholder:"Buscar entregable...",class:"pl-8"},null,8,["value"])]),c.value.search?(n(),f(e(h),{key:0,variant:"ghost",size:"icon",class:"absolute right-2 top-8 h-6 w-6",onClick:a[1]||(a[1]=r=>w("search"))},{default:t(()=>[s(e(D),{class:"h-3 w-3"})]),_:1})):m("",!0)]),u("div",ss,[s(e(V),{for:"estado"},{default:t(()=>[...a[14]||(a[14]=[d("Estado",-1)])]),_:1}),u("div",ts,[s(e(q),{"model-value":c.value.estado||"null","onUpdate:modelValue":a[2]||(a[2]=r=>g("estado",r==="null"?null:r))},{default:t(()=>[s(e(O),{id:"estado"},{default:t(()=>[s(e(H),{placeholder:"Todos los estados"})]),_:1}),s(e(X),null,{default:t(()=>[s(e(F),{value:"null"},{default:t(()=>[...a[15]||(a[15]=[d("Todos los estados",-1)])]),_:1}),(n(),v(S,null,T(E,r=>s(e(F),{key:r.value,value:r.value},{default:t(()=>[d(_(r.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value"]),c.value.estado?(n(),f(e(h),{key:0,variant:"ghost",size:"icon",onClick:a[3]||(a[3]=r=>w("estado"))},{default:t(()=>[s(e(D),{class:"h-4 w-4"})]),_:1})):m("",!0)])]),u("div",as,[s(e(V),{for:"prioridad"},{default:t(()=>[...a[16]||(a[16]=[d("Prioridad",-1)])]),_:1}),u("div",ls,[s(e(q),{"model-value":c.value.prioridad||"null","onUpdate:modelValue":a[4]||(a[4]=r=>g("prioridad",r==="null"?null:r))},{default:t(()=>[s(e(O),{id:"prioridad"},{default:t(()=>[s(e(H),{placeholder:"Todas las prioridades"})]),_:1}),s(e(X),null,{default:t(()=>[s(e(F),{value:"null"},{default:t(()=>[...a[17]||(a[17]=[d("Todas las prioridades",-1)])]),_:1}),(n(),v(S,null,T(k,r=>s(e(F),{key:r.value,value:r.value},{default:t(()=>[d(_(r.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value"]),c.value.prioridad?(n(),f(e(h),{key:0,variant:"ghost",size:"icon",onClick:a[5]||(a[5]=r=>w("prioridad"))},{default:t(()=>[s(e(D),{class:"h-4 w-4"})]),_:1})):m("",!0)])]),p.usuarios.length>0?(n(),v("div",os,[s(e(V),{for:"responsable"},{default:t(()=>[...a[18]||(a[18]=[d("Responsable",-1)])]),_:1}),u("div",ns,[s(e(q),{"model-value":((U=c.value.responsable_id)==null?void 0:U.toString())||"null","onUpdate:modelValue":a[6]||(a[6]=r=>g("responsable_id",r==="null"?null:parseInt(r)))},{default:t(()=>[s(e(O),{id:"responsable"},{default:t(()=>[s(e(H),{placeholder:"Todos los responsables"})]),_:1}),s(e(X),null,{default:t(()=>[s(e(F),{value:"null"},{default:t(()=>[...a[19]||(a[19]=[d("Todos los responsables",-1)])]),_:1}),(n(!0),v(S,null,T(p.usuarios,r=>(n(),f(e(F),{key:r.id,value:r.id.toString()},{default:t(()=>[d(_(r.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),c.value.responsable_id?(n(),f(e(h),{key:0,variant:"ghost",size:"icon",onClick:a[7]||(a[7]=r=>w("responsable_id"))},{default:t(()=>[s(e(D),{class:"h-4 w-4"})]),_:1})):m("",!0)])])):m("",!0),u("div",is,[s(e(V),null,{default:t(()=>[...a[20]||(a[20]=[d("Rango de Fechas",-1)])]),_:1}),u("div",ds,[u("div",null,[s(e(V),{class:"text-xs text-muted-foreground"},{default:t(()=>[...a[21]||(a[21]=[d("Desde",-1)])]),_:1}),s(e(G),{type:"date",value:c.value.fecha_inicio||"",onInput:a[8]||(a[8]=r=>g("fecha_inicio",r.target.value)),class:"mt-1"},null,8,["value"])]),u("div",null,[s(e(V),{class:"text-xs text-muted-foreground"},{default:t(()=>[...a[22]||(a[22]=[d("Hasta",-1)])]),_:1}),s(e(G),{type:"date",value:c.value.fecha_fin||"",onInput:a[9]||(a[9]=r=>g("fecha_fin",r.target.value)),class:"mt-1"},null,8,["value"])])]),c.value.fecha_inicio||c.value.fecha_fin?(n(),f(e(h),{key:0,variant:"ghost",size:"sm",onClick:a[10]||(a[10]=r=>{w("fecha_inicio"),w("fecha_fin")}),class:"w-full mt-1"},{default:t(()=>[s(e(D),{class:"h-4 w-4 mr-1"}),a[23]||(a[23]=d(" Limpiar fechas ",-1))]),_:1})):m("",!0)])])]}),_:1})]),_:1})):(n(),v("div",rs,[u("div",us,[u("div",cs,[s(e(W),{class:"h-4 w-4"}),a[24]||(a[24]=u("h3",{class:"text-sm font-medium"},"Filtros",-1))]),I.value?(n(),f(e(h),{key:0,variant:"ghost",size:"sm",onClick:P},{default:t(()=>[s(e(D),{class:"h-4 w-4 mr-1"}),a[25]||(a[25]=d(" Limpiar ",-1))]),_:1})):m("",!0)]),a[26]||(a[26]=u("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},null,-1))]))}});export{Is as _,Ps as a};
