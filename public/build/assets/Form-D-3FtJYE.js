import{d as Qe,k as H,c as O,w as oe,s as Ze,a as m,o as u,j as I,i as j,f as l,e as c,b as r,u as e,g as k,t as b,F as Y,r as Q,bT as st,n as J,C as it,v as ot,m as dt,h as nt,Z as lt,bQ as ut,bG as ct,U as ft,Y as mt}from"./app-BCzWwluV.js";import{_ as te}from"./AppLogo.vue_vue_type_script_setup_true_lang-s0jfAUiz.js";import{r as Z,_ as de,a as ne,j as Be,c as le,M as ie,C as Le,U as gt,af as U,b as Pe,d as _t,e as pt,f as bt,g as vt,h as yt,ag as ht,i as xt,ah as kt}from"./AppLayout.vue_vue_type_script_setup_true_lang-B_fIltFu.js";import{_ as St}from"./Checkbox.vue_vue_type_script_setup_true_lang-C67fgu97.js";import{_ as re,a as fe}from"./Label.vue_vue_type_script_setup_true_lang-BJ5uU6vo.js";import{_ as wt}from"./Textarea.vue_vue_type_script_setup_true_lang-C4PN4lSN.js";import{u as $t,a as Ct,_ as Et,b as Tt,c as Vt,d as At}from"./useConditionalFields-lJLQJaOf.js";import{_ as Re}from"./CardDescription.vue_vue_type_script_setup_true_lang-EBp0xX2-.js";import{_ as jt,a as ze}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-DhgENJRM.js";import{a as Me,_ as Ge}from"./index-C78USbw1.js";import{_ as We}from"./AlertTitle.vue_vue_type_script_setup_true_lang-wJh-zzBL.js";import{A as Ye}from"./arrow-left-C3tCYPMC.js";import{C as me}from"./clock-M9yqKPWw.js";import{C as Je}from"./circle-check-big-BrlKc7hH.js";import{U as Ut}from"./user-CwyVRZ6C.js";import{S as Ot}from"./save-ChFWgEAc.js";import"./index-B4xNbB9Q.js";import"./VisuallyHidden-BE_vDfXM.js";import"./upload-Dx71dh7m.js";import"./eye-BjquJmUW.js";import"./download-CwYeHOmR.js";import"./plus-CU2Vw5Rt.js";import"./grip-vertical-BMor_Fk0.js";import"./trash-2-DeDb0nUa.js";import"./RovingFocusItem-DafuIS5c.js";import"./VisuallyHiddenInput-CO1UpIit.js";const Ft={class:"space-y-4"},qt={key:0,class:"text-center py-8"},It={key:2,class:"space-y-6"},Nt={key:0},Dt={class:"text-sm font-medium text-muted-foreground mb-3"},Bt={class:"space-y-3"},Lt={class:"flex items-start gap-3"},Pt={class:"flex-1"},Rt={class:"flex items-center justify-between"},zt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Mt={class:"flex items-center gap-2 text-muted-foreground"},Gt={class:"flex items-center gap-2 text-muted-foreground"},Wt={class:"flex items-center gap-2 text-muted-foreground"},Yt={key:0,class:"flex items-center gap-2 text-muted-foreground"},Jt={class:"mt-3 text-xs text-muted-foreground"},Kt={key:1},Ht={class:"text-sm font-medium text-muted-foreground mb-3"},Xt={class:"space-y-3"},Qt={class:"flex items-start gap-3"},Zt={class:"flex-1"},ea={class:"flex items-center justify-between"},ta={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},aa={class:"flex items-center gap-2 text-muted-foreground"},ra={class:"flex items-center gap-2 text-muted-foreground"},sa={class:"flex items-center gap-2 text-muted-foreground"},ia={class:"mt-3 text-xs text-muted-foreground"},oa={key:4,class:"mt-4 p-3 bg-muted/50 rounded-lg"},da={class:"text-sm text-muted-foreground"},na=Qe({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(i,{emit:o}){const $=i,V=o,w=H([]),E=H(!1),A=H(null),a=H($.modelValue),v=async()=>{E.value=!0,A.value=null;try{const h=await st.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:$.filtrarPorUbicacion,incluir_futuras:!0}});w.value=h.data}catch(h){A.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",h)}finally{E.value=!1}},T=O(()=>{const h={abiertas:[],futuras:[]};return w.value.forEach(y=>{y.estado_temporal==="abierta"?h.abiertas.push(y):y.estado_temporal==="futura"&&h.futuras.push(y)}),h}),M=O(()=>w.value.find(h=>h.id===a.value));oe(a,h=>{V("update:modelValue",h)}),oe(()=>$.modelValue,h=>{a.value=h});const N=h=>new Date(h).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=h=>{switch(h){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},F=h=>{switch(h){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Ze(()=>{v()}),(h,y)=>(u(),m("div",Ft,[E.value?(u(),m("div",qt,y[1]||(y[1]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),l("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):A.value?(u(),I(e(Ge),{key:1,variant:"destructive"},{default:c(()=>[r(e(Z),{class:"h-4 w-4"}),r(e(We),null,{default:c(()=>y[2]||(y[2]=[k("Error")])),_:1}),r(e(Me),null,{default:c(()=>[k(b(A.value),1)]),_:1})]),_:1})):w.value.length>0?(u(),m("div",It,[r(e(jt),{modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=g=>a.value=g),disabled:h.disabled},{default:c(()=>[T.value.abiertas.length>0?(u(),m("div",Nt,[l("h4",Dt," Convocatorias Abiertas ("+b(T.value.abiertas.length)+") ",1),l("div",Bt,[(u(!0),m(Y,null,Q(T.value.abiertas,g=>(u(),I(e(de),{key:g.id,class:J(["cursor-pointer hover:shadow-md transition-shadow",{"ring-2 ring-primary":a.value===g.id}])},{default:c(()=>[r(e(ne),{class:"pb-3"},{default:c(()=>[l("div",Lt,[r(e(ze),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),l("div",Pt,[l("div",Rt,[r(e(re),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[k(b(g.nombre),1)]),_:2},1032,["for"]),r(e(Be),{class:J(L(g.estado_temporal))},{default:c(()=>[k(b(F(g.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(Re),{class:"mt-1"},{default:c(()=>[k(b(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(le),{class:"pt-0"},{default:c(()=>[l("div",zt,[l("div",Mt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.cargo.nombre),1)]),l("div",Gt,[r(e(Le),{class:"h-4 w-4"}),l("span",null,b(g.periodo_electoral.nombre),1)]),l("div",Wt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.ubicacion),1)]),g.numero_postulaciones!==void 0?(u(),m("div",Yt,[r(e(gt),{class:"h-4 w-4"}),l("span",null,b(g.numero_postulaciones)+" postulaciones",1)])):j("",!0)]),l("div",Jt,[y[3]||(y[3]=l("span",{class:"font-medium"},"Cierre:",-1)),k(" "+b(N(g.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):j("",!0),T.value.futuras.length>0?(u(),m("div",Kt,[l("h4",Ht," Próximas Convocatorias ("+b(T.value.futuras.length)+") ",1),l("div",Xt,[(u(!0),m(Y,null,Q(T.value.futuras,g=>(u(),I(e(de),{key:g.id,class:J(["cursor-pointer hover:shadow-md transition-shadow opacity-90",{"ring-2 ring-primary":a.value===g.id}])},{default:c(()=>[r(e(ne),{class:"pb-3"},{default:c(()=>[l("div",Qt,[r(e(ze),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),l("div",Zt,[l("div",ea,[r(e(re),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[k(b(g.nombre),1)]),_:2},1032,["for"]),r(e(Be),{class:J(L(g.estado_temporal))},{default:c(()=>[k(b(F(g.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(Re),{class:"mt-1"},{default:c(()=>[k(b(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(le),{class:"pt-0"},{default:c(()=>[l("div",ta,[l("div",aa,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.cargo.nombre),1)]),l("div",ra,[r(e(Le),{class:"h-4 w-4"}),l("span",null,b(g.periodo_electoral.nombre),1)]),l("div",sa,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.ubicacion),1)])]),l("div",ia,[y[4]||(y[4]=l("span",{class:"font-medium"},"Apertura:",-1)),k(" "+b(N(g.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):j("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),I(e(Ge),{key:3},{default:c(()=>[r(e(Z),{class:"h-4 w-4"}),r(e(We),null,{default:c(()=>y[5]||(y[5]=[k("Sin convocatorias disponibles")])),_:1}),r(e(Me),null,{default:c(()=>y[6]||(y[6]=[k(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),M.value&&!h.disabled?(u(),m("div",oa,[y[7]||(y[7]=l("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),l("p",da,b(M.value.nombre),1)])):j("",!0)]))}});var la=typeof global=="object"&&global&&global.Object===Object&&global,ua=typeof self=="object"&&self&&self.Object===Object&&self,et=la||ua||Function("return this")(),ue=et.Symbol,tt=Object.prototype,ca=tt.hasOwnProperty,fa=tt.toString,ae=ue?ue.toStringTag:void 0;function ma(i){var o=ca.call(i,ae),$=i[ae];try{i[ae]=void 0;var V=!0}catch{}var w=fa.call(i);return V&&(o?i[ae]=$:delete i[ae]),w}var ga=Object.prototype,_a=ga.toString;function pa(i){return _a.call(i)}var ba="[object Null]",va="[object Undefined]",Ke=ue?ue.toStringTag:void 0;function ya(i){return i==null?i===void 0?va:ba:Ke&&Ke in Object(i)?ma(i):pa(i)}function ha(i){return i!=null&&typeof i=="object"}var xa="[object Symbol]";function ka(i){return typeof i=="symbol"||ha(i)&&ya(i)==xa}var Sa=/\s/;function wa(i){for(var o=i.length;o--&&Sa.test(i.charAt(o)););return o}var $a=/^\s+/;function Ca(i){return i&&i.slice(0,wa(i)+1).replace($a,"")}function _e(i){var o=typeof i;return i!=null&&(o=="object"||o=="function")}var He=NaN,Ea=/^[-+]0x[0-9a-f]+$/i,Ta=/^0b[01]+$/i,Va=/^0o[0-7]+$/i,Aa=parseInt;function Xe(i){if(typeof i=="number")return i;if(ka(i))return He;if(_e(i)){var o=typeof i.valueOf=="function"?i.valueOf():i;i=_e(o)?o+"":o}if(typeof i!="string")return i===0?i:+i;i=Ca(i);var $=Ta.test(i);return $||Va.test(i)?Aa(i.slice(2),$?2:8):Ea.test(i)?He:+i}var ge=function(){return et.Date.now()},ja="Expected a function",Ua=Math.max,Oa=Math.min;function Fa(i,o,$){var V,w,E,A,a,v,T=0,M=!1,N=!1,L=!0;if(typeof i!="function")throw new TypeError(ja);o=Xe(o)||0,_e($)&&(M=!!$.leading,N="maxWait"in $,E=N?Ua(Xe($.maxWait)||0,o):E,L="trailing"in $?!!$.trailing:L);function F(S){var B=V,p=w;return V=w=void 0,T=S,A=i.apply(p,B),A}function h(S){return T=S,a=setTimeout(P,o),M?F(S):A}function y(S){var B=S-v,p=S-T,C=o-B;return N?Oa(C,E-p):C}function g(S){var B=S-v,p=S-T;return v===void 0||B>=o||B<0||N&&p>=E}function P(){var S=ge();if(g(S))return W(S);a=setTimeout(P,y(S))}function W(S){return a=void 0,L&&V?F(S):(V=w=void 0,A)}function ee(){a!==void 0&&clearTimeout(a),T=0,V=v=w=a=void 0}function K(){return a===void 0?A:W(ge())}function D(){var S=ge(),B=g(S);if(V=arguments,w=this,v=S,B){if(a===void 0)return h(v);if(N)return clearTimeout(a),a=setTimeout(P,o),F(v)}return a===void 0&&(a=setTimeout(P,o)),A}return D.cancel=ee,D.flush=K,D}function qa(i,o){const{url:$,candidaturaId:V=null,debounceTime:w=3e3,showNotifications:E=!0,useLocalStorage:A=!0,localStorageKey:a="candidatura_draft"}=o,v=H({status:"idle",lastSaved:null,lastError:null,candidaturaId:V}),T=O(()=>v.value.status==="saving"),M=O(()=>v.value.lastSaved!==null),N=O(()=>v.value.status==="error"),L=()=>{if(A)try{const p={formulario_data:i.value,timestamp:new Date().toISOString(),candidaturaId:v.value.candidaturaId};localStorage.setItem(a,JSON.stringify(p))}catch(p){console.error("Error guardando en localStorage:",p)}},F=()=>{if(!A)return null;try{const p=localStorage.getItem(a);if(p){const C=JSON.parse(p),R=new Date(C.timestamp);if((Date.now()-R.getTime())/(1e3*60*60)<24)return C;localStorage.removeItem(a)}}catch(p){console.error("Error cargando desde localStorage:",p)}return null},h=()=>{A&&localStorage.removeItem(a)},y=async()=>{try{const p=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(p.ok){const C=await p.text(),q=new DOMParser().parseFromString(C,"text/html").querySelector('meta[name="csrf-token"]');if(q){const X=q.getAttribute("content"),G=document.querySelector('meta[name="csrf-token"]');if(G&&X)return G.setAttribute("content",X),X}}}catch(p){console.error("Error renovando token CSRF:",p)}return null},g=async(p,C,R=0)=>{const z=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":C,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:i.value})});if(z.status===419&&R<1){const q=await y();if(q)return E&&U.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),g(p,q,R+1)}return z},P=async()=>{var p;if(v.value.status!=="saving"&&!(!i.value||Object.keys(i.value).length===0)){v.value.status="saving",v.value.lastError=null;try{const C=v.value.candidaturaId?$.replace("autosave",`${v.value.candidaturaId}/autosave`):$,R=((p=document.querySelector('meta[name="csrf-token"]'))==null?void 0:p.getAttribute("content"))||"";if(!R)throw new Error("Token CSRF no encontrado");const z=await g(C,R);if(!z.ok)throw new Error(`Error ${z.status}: ${z.statusText}`);const q=await z.json();if(q.success)v.value.status="saved",v.value.lastSaved=new Date,!v.value.candidaturaId&&q.candidatura_id&&(v.value.candidaturaId=q.candidatura_id),L(),E&&U.success("Cambios guardados",{description:`Autoguardado a las ${q.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(q.message||"Error al guardar")}catch(C){v.value.status="error",v.value.lastError=C instanceof Error?C.message:"Error desconocido",L(),C instanceof Error&&C.message.includes("419")?E&&U.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):E&&U.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",C)}}},W=Fa(P,w),ee=()=>(W.cancel(),P()),K=()=>oe(i,()=>{v.value.status!=="error"&&W()},{deep:!0}),D=()=>{W.cancel()},S=()=>{D(),v.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:V},h()},B=()=>{const p=F();return p&&p.formulario_data?(E&&U.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),p):null};return{state:O(()=>v.value),isSaving:T,hasSaved:M,hasError:N,saveNow:ee,startWatching:K,stopAutoSave:D,reset:S,restoreDraft:B,clearLocalStorage:h}}const Ia={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 pb-24"},Na={class:"flex items-center justify-between"},Da={class:"text-3xl font-bold"},Ba={class:"text-muted-foreground"},La={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Pa={key:0,class:"flex items-center gap-1.5"},Ra={key:1,class:"flex items-center gap-1.5"},za={key:2,class:"flex items-center gap-1.5 text-amber-600"},Ma={key:3,class:"flex items-center gap-1.5"},Ga={class:"text-blue-700 dark:text-blue-300"},Wa={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Ya={class:"flex items-start gap-3"},Ja={class:"text-sm text-blue-800"},Ka={key:0,class:"mt-1 text-blue-600"},Ha={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},Xa={class:"flex items-start gap-3"},Qa={key:0,class:"text-red-500"},Za={key:0,class:"text-sm text-muted-foreground"},er={key:6,class:"space-y-2"},tr=["id","name","value","onUpdate:modelValue"],ar={key:7,class:"space-y-2"},rr={key:8},sr={key:9},ir={key:0,class:"text-red-500 text-sm mt-1"},or={key:10},dr={key:11},nr={key:12},lr={key:13,class:"text-sm text-destructive"},ur={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},cr={class:"text-red-800 text-sm"},fr={key:0,class:"fixed bottom-0 left-0 right-0 z-50 px-4 pb-4"},mr={class:"mx-auto max-w-7xl"},gr={class:"backdrop-blur-lg bg-tertiary-60 dark:bg-gray-900/80 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl shadow-2xl p-4"},_r={class:"flex items-center justify-between gap-4"},pr={class:"flex items-center gap-2"},br={class:"flex items-center gap-3"},vr=Qe({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(i){var pe,be;const o=i,$=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:o.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:V}=$t(),w=H({}),E=O(()=>{var x;if(!o.is_editing||!((x=o.candidatura)!=null&&x.formulario_data))return!1;const n=Object.keys(o.candidatura.formulario_data),s=o.configuracion_campos.map(t=>t.id),d=n.some(t=>!s.includes(t)),_=o.configuracion_campos.some(t=>t.required&&!o.candidatura.formulario_data[t.id]);return d||_}),a=it((()=>{var s;const n={};return o.configuracion_campos.forEach(d=>{d.type==="checkbox"?n[d.id]=[]:d.type==="file"?n[d.id]=[]:d.type==="convocatoria"?n[d.id]=void 0:d.type==="disclaimer"?n[d.id]=null:d.type==="repeater"?n[d.id]=[]:d.type==="datepicker"?n[d.id]=null:n[d.id]=""}),(s=o.candidatura)!=null&&s.formulario_data&&(Object.assign(n,o.candidatura.formulario_data),o.configuracion_campos.forEach(d=>{d.type==="file"&&n[d.id]&&(Array.isArray(n[d.id])||(n[d.id]=[n[d.id]]))})),{formulario_data:n}})()),v=H(o.configuracion_campos),T=O(()=>a.formulario_data),{visibleFields:M,clearHiddenFieldValues:N}=Ct(v,T);oe(M,()=>{N()});const{state:L,isSaving:F,hasSaved:h,hasError:y,saveNow:g,startWatching:P,stopAutoSave:W,restoreDraft:ee,clearLocalStorage:K}=qa(T,{url:"/candidaturas/autosave",candidaturaId:((pe=o.candidatura)==null?void 0:pe.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((be=o.candidatura)==null?void 0:be.id)||"new"}`});let D=null;Ze(()=>{const n=["borrador","rechazado"];if(!o.candidatura||n.includes(o.candidatura.estado)){if(!o.is_editing){const d=ee();d&&d.formulario_data&&(U.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{K(),a.reset(),U.success("Borrador descartado")}},duration:5e3}),Object.assign(a.formulario_data,d.formulario_data))}D=P()}}),ot(()=>{D&&D(),W()});const S=async()=>{if(F.value){U.warning("Ya se está guardando...");return}await g(),y.value||U.success("Borrador guardado manualmente")},B=O(()=>R.value.map(d=>{var t;if(!d.required)return{campo:d.id,valid:!0};const _=a.formulario_data[d.id];let x=!1;if(d.type==="checkbox")x=Array.isArray(_)&&_.length>0;else if(d.type==="file")(Array.isArray(_)&&_.length>0||w.value[d.id]&&w.value[d.id].length>0)&&(x=!0);else if(d.type==="convocatoria")x=_!=null&&_!=="";else if(d.type==="disclaimer")x=_&&_.accepted===!0;else if(d.type==="repeater"){const se=((t=d.repeaterConfig)==null?void 0:t.minItems)||0;x=Array.isArray(_)&&_.length>=se}else d.type==="datepicker"?x=_!=null&&_!=="":x=_&&_.toString().trim()!=="";return!x&&d.required,{campo:d.id,valid:x}}).every(d=>d.valid)),p=O(()=>o.is_editing?"Editar Candidatura":"Crear Candidatura"),C=O(()=>{var n,s;return a.processing?"Guardando...":o.is_editing?((n=o.candidatura)==null?void 0:n.estado)==="rechazado"?"Reenviar Candidatura":((s=o.candidatura)==null?void 0:s.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),R=O(()=>{var s;let n=[...M.value];return o.is_editing&&o.candidatura&&["pendiente","aprobado"].includes(o.candidatura.estado)&&(n=n.filter(_=>_.type!=="convocatoria")),o.is_editing&&((s=o.candidatura)==null?void 0:s.estado)==="aprobado"&&(n=n.filter(d=>d.editable===!0)),n}),z=O(()=>{var d;if(!o.is_editing||!o.candidatura)return!1;let n=!1;if(["pendiente","aprobado"].includes(o.candidatura.estado)&&(n=o.configuracion_campos.some(_=>_.type==="convocatoria")),((d=o.candidatura)==null?void 0:d.estado)==="aprobado"){const _=o.configuracion_campos.some(x=>!x.editable&&x.type!=="convocatoria");return n||_}return n}),q=async(n,s)=>{if(w.value[n]=s,s&&s.length>0)try{U.info("Subiendo archivos...",{duration:2e3});const _=(await V(s,{module:"candidaturas",fieldId:n})).map(x=>x.path);Array.isArray(a.formulario_data[n]),a.formulario_data[n]=_,w.value[n]=[],U.success("Archivos subidos correctamente",{duration:2e3})}catch(d){console.error("Error al subir archivos:",d),U.error("Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else a.formulario_data[n]=[]},X=async()=>{for(const[s,d]of Object.entries(w.value))if(d&&d.length>0)try{U.info("Subiendo archivos pendientes...",{duration:2e3});const _=await V(d,{module:"candidaturas",fieldId:s});a.formulario_data[s]=_.map(x=>x.path),w.value[s]=[]}catch(_){console.error("Error al subir archivos:",_),U.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const n={...a.formulario_data};o.configuracion_campos.forEach(s=>{const d=n[s.id];s.required||(d===""||d===void 0||Array.isArray(d)&&d.length===0&&s.type!=="checkbox"&&s.type!=="file")&&(n[s.id]=null)}),a.formulario_data=n,W(),o.is_editing?a.put(`/candidaturas/${o.candidatura.id}`,{onSuccess:()=>{K(),U.success("Candidatura actualizada exitosamente")},onError:s=>{console.error("Errores de validación:",s),(!o.candidatura||["borrador","rechazado"].includes(o.candidatura.estado))&&(D=P())}}):a.post("/candidaturas",{onSuccess:()=>{K(),U.success("Candidatura creada exitosamente")},onError:s=>{console.error("Errores de validación:",s),D=P()}})},G=n=>!!a.errors[`formulario_data.${n}`],at=O(()=>!o.candidatura||["borrador","rechazado"].includes(o.candidatura.estado)),rt=()=>{const n=document.querySelector('[data-sidebar="trigger"]');n&&n.click()};return(n,s)=>(u(),m(Y,null,[r(e(dt),{title:p.value},null,8,["title"]),r(xt,{breadcrumbs:$},{default:c(()=>{var d,_;return[l("div",Ia,[l("div",Na,[l("div",null,[l("h1",Da,b(p.value),1),l("p",Ba,b(n.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),r(e(te),{variant:"outline",onClick:s[0]||(s[0]=x=>n.$inertia.visit("/candidaturas"))},{default:c(()=>[r(e(Ye),{class:"mr-2 h-4 w-4"}),s[2]||(s[2]=k(" Volver "))]),_:1})]),!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)?(u(),m("div",La,[e(F)?(u(),m("div",Pa,[r(e(me),{class:"h-4 w-4 animate-spin"}),s[3]||(s[3]=l("span",null,"Guardando automáticamente...",-1))])):e(h)&&!e(y)?(u(),m("div",Ra,[r(e(Je),{class:"h-4 w-4 text-green-600"}),l("span",null,"Guardado automáticamente a las "+b((d=e(L).lastSaved)==null?void 0:d.toLocaleTimeString()),1)])):e(y)?(u(),m("div",za,[r(e(Z),{class:"h-4 w-4"}),s[4]||(s[4]=l("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),m("div",Ma,[r(e(me),{class:"h-4 w-4"}),s[5]||(s[5]=l("span",null,"Autoguardado activado",-1))]))])):j("",!0),n.is_editing&&((_=n.candidatura)!=null&&_.comentarios_admin)?(u(),I(e(de),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:c(()=>[r(e(ne),null,{default:c(()=>[r(e(Pe),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:c(()=>[r(e(Z),{class:"h-5 w-5"}),s[6]||(s[6]=k(" Comentarios de la comisión "))]),_:1})]),_:1}),r(e(le),null,{default:c(()=>[l("p",Ga,b(n.candidatura.comentarios_admin),1)]),_:1})]),_:1})):j("",!0),r(e(de),null,{default:c(()=>[r(e(ne),null,{default:c(()=>[r(e(Pe),{class:"flex items-center gap-2"},{default:c(()=>[r(e(Ut),{class:"h-5 w-5"}),s[7]||(s[7]=k(" Información de Candidatura "))]),_:1})]),_:1}),r(e(le),null,{default:c(()=>{var x;return[l("form",{onSubmit:nt(X,["prevent"]),class:"space-y-6"},[n.is_editing&&((x=n.candidatura)==null?void 0:x.estado)==="aprobado"?(u(),m("div",Wa,[l("div",Ya,[r(e(Z),{class:"h-5 w-5 text-blue-600 mt-0.5"}),l("div",Ja,[s[8]||(s[8]=l("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),s[9]||(s[9]=l("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),z.value?(u(),m("p",Ka," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):j("",!0)])])])):j("",!0),E.value?(u(),m("div",Ha,[l("div",Xa,[r(e(Z),{class:"h-5 w-5 text-amber-600 mt-0.5"}),s[10]||(s[10]=l("div",{class:"text-sm text-amber-800"},[l("p",{class:"font-medium"},"Formulario Actualizado"),l("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):j("",!0),r(lt,{name:"fade-field",tag:"div",class:"space-y-6"},{default:c(()=>[(u(!0),m(Y,null,Q(R.value,t=>{var se,ve,ye,he,xe,ke,Se,we,$e,Ce,Ee,Te,Ve,Ae,je,Ue,Oe,Fe,qe,Ie,Ne;return u(),m("div",{key:t.id,class:"space-y-2"},[r(e(re),{for:t.id,class:"flex items-center gap-1"},{default:c(()=>[k(b(t.title)+" ",1),t.required?(u(),m("span",Qa,"*")):j("",!0)]),_:2},1032,["for"]),t.description?(u(),m("p",Za,b(t.description),1)):j("",!0),t.type==="text"||t.type==="email"?(u(),I(e(fe),{key:1,id:t.id,type:t.type,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:J({"border-destructive":G(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(u(),I(e(wt),{key:2,id:t.id,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",rows:4,class:J({"border-destructive":G(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(u(),I(e(fe),{key:3,id:t.id,type:"number",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:J({"border-destructive":G(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(u(),I(e(fe),{key:4,id:t.id,type:"date",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,class:J({"border-destructive":G(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(u(),I(e(_t),{key:5,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f},{default:c(()=>[r(e(pt),{class:J({"border-destructive":G(t.id)})},{default:c(()=>[r(e(bt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),r(e(vt),null,{default:c(()=>[(u(!0),m(Y,null,Q(t.options,f=>(u(),I(e(yt),{key:f,value:f},{default:c(()=>[k(b(f),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(u(),m("div",er,[(u(!0),m(Y,null,Q(t.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[ut(l("input",{id:`${t.id}_${f}`,name:t.id,type:"radio",value:f,"onUpdate:modelValue":ce=>e(a).formulario_data[t.id]=ce,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,tr),[[ct,e(a).formulario_data[t.id]]]),r(e(re),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[k(b(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(u(),m("div",ar,[(u(!0),m(Y,null,Q(t.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[r(e(St),{id:`${t.id}_${f}`,checked:e(a).formulario_data[t.id].includes(f),"onUpdate:checked":ce=>{if(ce)e(a).formulario_data[t.id].includes(f)||e(a).formulario_data[t.id].push(f);else{const De=e(a).formulario_data[t.id].indexOf(f);De>-1&&e(a).formulario_data[t.id].splice(De,1)}}},null,8,["id","checked","onUpdate:checked"]),r(e(re),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[k(b(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(u(),m("div",rr,[r(Et,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,onFilesSelected:f=>q(t.id,f),label:"",description:"",required:t.required,multiple:((se=t.fileConfig)==null?void 0:se.multiple)||!1,"max-files":((ve=t.fileConfig)==null?void 0:ve.maxFiles)||5,"max-file-size":((ye=t.fileConfig)==null?void 0:ye.maxFileSize)||10,accept:((he=t.fileConfig)==null?void 0:he.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(a).errors[`formulario_data.${t.id}`],disabled:e(a).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(u(),m("div",sr,[r(na,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,required:t.required,disabled:e(a).processing||n.is_editing&&((xe=n.candidatura)==null?void 0:xe.estado)!=="borrador","filtrar-por-ubicacion":((ke=t.convocatoriaConfig)==null?void 0:ke.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),G(t.id)?(u(),m("div",ir,b(e(a).errors[`formulario_data.${t.id}`]),1)):j("",!0)])):t.type==="datepicker"?(u(),m("div",or,[r(Tt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-date":(Se=t.datepickerConfig)==null?void 0:Se.minDate,"max-date":(we=t.datepickerConfig)==null?void 0:we.maxDate,format:(($e=t.datepickerConfig)==null?void 0:$e.format)||"DD/MM/YYYY","allow-past-dates":((Ce=t.datepickerConfig)==null?void 0:Ce.allowPastDates)??!0,"allow-future-dates":((Ee=t.datepickerConfig)==null?void 0:Ee.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(u(),m("div",dr,[r(Vt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"disclaimer-text":((Te=t.disclaimerConfig)==null?void 0:Te.disclaimerText)||"","modal-title":((Ve=t.disclaimerConfig)==null?void 0:Ve.modalTitle)||"Términos y Condiciones","accept-button-text":((Ae=t.disclaimerConfig)==null?void 0:Ae.acceptButtonText)||"Acepto","decline-button-text":((je=t.disclaimerConfig)==null?void 0:je.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(u(),m("div",nr,[r(At,{"model-value":e(a).formulario_data[t.id]||[],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-items":((Ue=t.repeaterConfig)==null?void 0:Ue.minItems)||0,"max-items":((Oe=t.repeaterConfig)==null?void 0:Oe.maxItems)||10,"item-name":((Fe=t.repeaterConfig)==null?void 0:Fe.itemName)||"Elemento","add-button-text":((qe=t.repeaterConfig)==null?void 0:qe.addButtonText)||"Agregar elemento","remove-button-text":((Ie=t.repeaterConfig)==null?void 0:Ie.removeButtonText)||"Eliminar",fields:((Ne=t.repeaterConfig)==null?void 0:Ne.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):j("",!0),G(t.id)?(u(),m("p",lr,b(e(a).errors[`formulario_data.${t.id}`]),1)):j("",!0)])}),128))]),_:1}),e(a).errors.general?(u(),m("div",ur,[l("p",cr,b(e(a).errors.general),1)])):j("",!0),s[11]||(s[11]=l("div",{class:"h-4"},null,-1))],32)]}),_:1})]),_:1})]),(u(),I(ft,{to:"body"},[r(mt,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-4 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-4 opacity-0"},{default:c(()=>[(u(),m("div",fr,[l("div",mr,[l("div",gr,[l("div",_r,[l("div",pr,[r(e(te),{variant:"outline",type:"button",onClick:rt,class:"backdrop-blur-sm"},{default:c(()=>[r(e(ht),{class:"h-4 w-4"}),s[12]||(s[12]=k(" Ocultar sidebar "))]),_:1}),r(e(te),{variant:"outline",type:"button",onClick:s[1]||(s[1]=x=>n.$inertia.visit("/candidaturas")),class:"backdrop-blur-sm"},{default:c(()=>[r(e(Ye),{class:"mr-2 h-4 w-4"}),s[13]||(s[13]=k(" Cancelar "))]),_:1})]),l("div",br,[at.value?(u(),I(e(te),{key:0,onClick:S,disabled:e(F),variant:"outline",class:"backdrop-blur-sm"},{default:c(()=>[e(F)?(u(),m(Y,{key:0},[r(e(me),{class:"mr-2 h-4 w-4 animate-spin"}),s[14]||(s[14]=k(" Guardando... "))],64)):(u(),m(Y,{key:1},[r(e(Ot),{class:"mr-2 h-4 w-4"}),s[15]||(s[15]=k(" Guardar borrador "))],64))]),_:1},8,["disabled"])):j("",!0),r(e(te),{onClick:X,disabled:!B.value||e(a).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400"},{default:c(()=>[r(e(Je),{class:"mr-2 h-4 w-4"}),k(" "+b(C.value),1)]),_:1},8,["disabled"])])])])])]))]),_:1})]))]}),_:1})],64))}}),Gr=kt(vr,[["__scopeId","data-v-6a9bf1ff"]]);export{Gr as default};
