import{d as I,r as k,b as f,w as s,e,g as n,f as t,q as Q,j as _,m as i,v as y,h as o,i as $,A as X,t as d,F as B,k as F,n as J,s as h}from"./app-DvrHxm-A.js";import{_ as W}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dzj5c9-q.js";import{_ as C}from"./createLucideIcon-C9SNFSBj.js";import{_ as U,a as L,b as M,c as N}from"./CardTitle.vue_vue_type_script_setup_true_lang-DMIs0XFP.js";import{_ as Y}from"./CardDescription.vue_vue_type_script_setup_true_lang-BiVaE_lk.js";import{_ as Z,a as tt,b as w,c,d as et,e as p}from"./TableHeader.vue_vue_type_script_setup_true_lang-BWqWMxO6.js";import{_ as S}from"./index-fBOGNOl1.js";import{_ as st}from"./Input.vue_vue_type_script_setup_true_lang-Brldm4hc.js";import{_ as at,a as lt,b as rt,c as ot,d as T}from"./SelectValue.vue_vue_type_script_setup_true_lang-WMyc99vm.js";import{_ as nt}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-BIuzc9l_.js";import{b as it,c as ut,d as dt,g}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Beu1EXTj.js";import{P as mt}from"./plus-ht-a-3Mo.js";import{T as ft}from"./target-CJ8YoB3s.js";import{U as pt}from"./users-RWV-6XWO.js";import{E as _t}from"./ellipsis-Dl6YxcYA.js";import{E as ct}from"./eye-G5n6j-F0.js";import{R as gt}from"./refresh-cw-R9jCzqRK.js";import{T as vt}from"./trash-BnYL7Riw.js";import{S as xt}from"./square-pen-CuYWTOhv.js";import{T as yt}from"./trash-2-0hXXyiOB.js";import"./useFlashMessages-CHloRx3R.js";import"./index-BLDMSd0k.js";import"./floating-ui.vue-Cf7FBWFK.js";import"./x-NXrdhfCU.js";import"./index-BW7-Zy45.js";import"./shield-BbDYIPbs.js";import"./user-CnCAmwg9.js";import"./chevron-right-m0_abZes.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CZkE-gea.js";import"./VisuallyHidden-DsBEBkn1.js";import"./index-DxNcCC-q.js";import"./Label.vue_vue_type_script_setup_true_lang-DO_0a9LA.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang--qJKglHx.js";import"./index-DgnEweSZ.js";import"./circle-alert-MTeQVoNG.js";import"./map-pin-vSY5kVk7.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-TQq5mQR5.js";import"./chevrons-up-down-DP5H385v.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-y-25SQ4W.js";import"./tag-NFwqbqe3.js";import"./vote-N73-qYuX.js";import"./folder-open-6TjxLcK8.js";import"./send-BgrB1uCa.js";import"./file-text-BaRiPrEZ.js";import"./briefcase-0oCEXVio.js";import"./calendar-LPftFaUR.js";import"./megaphone-CjEeNjq7.js";import"./user-check-tcc16dFR.js";import"./clipboard-list-CitBJiId.js";import"./mail-B5jeg0pD.js";import"./message-square-C1oG1Soh.js";import"./external-link-IkNiKorY.js";import"./panel-left-6VkgvZCp.js";import"./check-u3RvEb0M.js";import"./index-CkGx2BsQ.js";import"./DialogTrigger-BO_JSHr6.js";import"./useKbd-kRIii9yh.js";import"./chevron-left-15RGaFnI.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-D6y8VaPk.js";import"./es-BDPlFIsO.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-BzFmv5wM.js";import"./loader-circle-CZL8Kmhy.js";import"./search-BVcAX9Sq.js";import"./filter-C1HYN6rf.js";import"./history-v4ykfXm4.js";import"./save-BqZVDW-i.js";const $t={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ht={class:"flex items-center justify-between"},Ct={class:"flex gap-4"},bt={class:"flex-1"},kt={class:"w-48"},wt={key:0},St={class:"flex items-center gap-2"},Tt={class:"font-semibold"},Et={class:"text-xs text-muted-foreground max-w-xs truncate"},Vt={class:"text-xs"},Dt={class:"flex items-center gap-1"},Bt={class:"text-sm font-medium"},Ft={class:"text-xs text-muted-foreground"},Ut={key:0,class:"flex items-center justify-center space-x-2 mt-6"},Lt={class:"flex gap-1"},Ie=I({__name:"Index",props:{segments:{},filters:{},filterFieldsConfig:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean}},setup(E){const u=E,j=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"}],b=k(u.filters.search||""),v=k(u.filters.is_dynamic||"all"),x=k(!1),A=r=>r?"default":"secondary",R=r=>r?"Dinámico":"Estático",z=r=>r.split("\\").pop()||r,P=r=>r!=null&&r.last_calculated_at?new Date(r.last_calculated_at).toLocaleString():"Nunca",q=r=>r<60?`${r}s`:r<3600?`${Math.floor(r/60)}m`:`${Math.floor(r/3600)}h`,V=()=>{const r={search:b.value};v.value!=="all"&&(r.is_dynamic=v.value),h.get("/admin/segments",r,{preserveState:!0,preserveScroll:!0})},H=r=>{confirm(`¿Estás seguro de eliminar el segmento "${r.name}"?`)&&h.delete(`/admin/segments/${r.id}`)},K=async r=>{var a;try{(await(await fetch(`/admin/segments/${r.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""}})).json()).success&&h.reload()}catch(l){console.error("Error evaluating segment:",l)}},O=r=>{h.post(`/admin/segments/${r.id}/clear-cache`)},G=r=>u.canDelete?!r.roles||r.roles.length===0:!1;return(r,a)=>(i(),f(W,{breadcrumbs:j},{default:s(()=>[e(t(Q),{title:"Segmentos"}),n("div",$t,[n("div",ht,[a[4]||(a[4]=n("div",null,[n("h2",{class:"text-2xl font-bold tracking-tight"},"Segmentos de Usuarios"),n("p",{class:"text-muted-foreground"}," Gestiona segmentos dinámicos basados en filtros avanzados ")],-1)),u.canCreate?(i(),f(t(y),{key:0,href:r.route("admin.segments.create")},{default:s(()=>[e(t(C),null,{default:s(()=>[e(t(mt),{class:"mr-2 h-4 w-4"}),a[3]||(a[3]=o(" Nuevo Segmento ",-1))]),_:1})]),_:1},8,["href"])):_("",!0)]),e(t(U),null,{default:s(()=>[e(t(L),null,{default:s(()=>[e(t(M),{class:"text-base"},{default:s(()=>[...a[5]||(a[5]=[o("Filtros",-1)])]),_:1})]),_:1}),e(t(N),{class:"space-y-4"},{default:s(()=>[n("div",Ct,[n("div",bt,[e(t(st),{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=l=>b.value=l),placeholder:"Buscar por nombre o descripción...",onKeyup:X(V,["enter"])},null,8,["modelValue"])]),n("div",kt,[e(t(at),{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=l=>v.value=l)},{default:s(()=>[e(t(lt),null,{default:s(()=>[e(t(rt),{placeholder:"Tipo de segmento"})]),_:1}),e(t(ot),null,{default:s(()=>[e(t(T),{value:"all"},{default:s(()=>[...a[6]||(a[6]=[o("Todos",-1)])]),_:1}),e(t(T),{value:"true"},{default:s(()=>[...a[7]||(a[7]=[o("Dinámicos",-1)])]),_:1}),e(t(T),{value:"false"},{default:s(()=>[...a[8]||(a[8]=[o("Estáticos",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e(t(C),{onClick:V,variant:"secondary"},{default:s(()=>[...a[9]||(a[9]=[o(" Buscar ",-1)])]),_:1}),e(t(C),{onClick:a[2]||(a[2]=l=>x.value=!x.value),variant:"outline"},{default:s(()=>[o(d(x.value?"Ocultar":"Mostrar")+" Filtros Avanzados ",1)]),_:1})]),x.value?(i(),$("div",wt,[e(nt,{fieldsConfig:E.filterFieldsConfig,baseUrl:"/admin/segments"},null,8,["fieldsConfig"])])):_("",!0)]),_:1})]),_:1}),e(t(U),null,{default:s(()=>[e(t(L),null,{default:s(()=>[e(t(M),null,{default:s(()=>[...a[10]||(a[10]=[o("Segmentos Registrados",-1)])]),_:1}),e(t(Y),null,{default:s(()=>[o(" Total de "+d(u.segments.total)+" segmentos configurados ",1)]),_:1})]),_:1}),e(t(N),null,{default:s(()=>[e(t(Z),null,{default:s(()=>[e(t(tt),null,{default:s(()=>[e(t(w),null,{default:s(()=>[e(t(c),null,{default:s(()=>[...a[11]||(a[11]=[o("Segmento",-1)])]),_:1}),e(t(c),null,{default:s(()=>[...a[12]||(a[12]=[o("Tipo",-1)])]),_:1}),e(t(c),null,{default:s(()=>[...a[13]||(a[13]=[o("Modelo",-1)])]),_:1}),e(t(c),null,{default:s(()=>[...a[14]||(a[14]=[o("Usuarios",-1)])]),_:1}),e(t(c),null,{default:s(()=>[...a[15]||(a[15]=[o("Cache",-1)])]),_:1}),e(t(c),null,{default:s(()=>[...a[16]||(a[16]=[o("Última Evaluación",-1)])]),_:1}),e(t(c),null,{default:s(()=>[...a[17]||(a[17]=[o("Roles",-1)])]),_:1}),e(t(c),{class:"text-right"},{default:s(()=>[...a[18]||(a[18]=[o("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(et),null,{default:s(()=>[(i(!0),$(B,null,F(u.segments.data,l=>(i(),f(t(w),{key:l.id},{default:s(()=>[e(t(p),{class:"font-medium"},{default:s(()=>[n("div",St,[e(t(ft),{class:"h-4 w-4 text-muted-foreground"}),n("div",null,[n("p",Tt,d(l.name),1),n("p",Et,d(l.description||"Sin descripción"),1)])])]),_:2},1024),e(t(p),null,{default:s(()=>[e(t(S),{variant:A(l.is_dynamic)},{default:s(()=>[o(d(R(l.is_dynamic)),1)]),_:2},1032,["variant"])]),_:2},1024),e(t(p),null,{default:s(()=>[n("code",Vt,d(z(l.model_type)),1)]),_:2},1024),e(t(p),null,{default:s(()=>{var m;return[n("div",Dt,[e(t(pt),{class:"h-4 w-4 text-muted-foreground"}),n("span",Bt,d(((m=l.metadata)==null?void 0:m.contacts_count)||l.user_count||0),1)])]}),_:2},1024),e(t(p),null,{default:s(()=>[e(t(S),{variant:"ghost"},{default:s(()=>[o(d(q(l.cache_duration)),1)]),_:2},1024)]),_:2},1024),e(t(p),null,{default:s(()=>[n("span",Ft,d(P(l.metadata)),1)]),_:2},1024),e(t(p),null,{default:s(()=>[e(t(S),{variant:"outline"},{default:s(()=>{var m,D;return[o(d(((m=l.roles)==null?void 0:m.length)||0)+" rol"+d((((D=l.roles)==null?void 0:D.length)||0)!==1?"es":""),1)]}),_:2},1024)]),_:2},1024),e(t(p),{class:"text-right"},{default:s(()=>[e(t(it),null,{default:s(()=>[e(t(ut),{asChild:""},{default:s(()=>[e(t(C),{variant:"ghost",size:"icon"},{default:s(()=>[e(t(_t),{class:"h-4 w-4"})]),_:1})]),_:1}),e(t(dt),{align:"end"},{default:s(()=>[e(t(y),{href:`/admin/segments/${l.id}`},{default:s(()=>[e(t(g),null,{default:s(()=>[e(t(ct),{class:"mr-2 h-4 w-4"}),a[19]||(a[19]=o(" Ver Usuarios ",-1))]),_:1})]),_:1},8,["href"]),u.canEdit?(i(),f(t(g),{key:0,onClick:m=>K(l)},{default:s(()=>[e(t(gt),{class:"mr-2 h-4 w-4"}),a[20]||(a[20]=o(" Recalcular ",-1))]),_:1},8,["onClick"])):_("",!0),u.canEdit?(i(),f(t(g),{key:1,onClick:m=>O(l)},{default:s(()=>[e(t(vt),{class:"mr-2 h-4 w-4"}),a[21]||(a[21]=o(" Limpiar Cache ",-1))]),_:1},8,["onClick"])):_("",!0),u.canEdit?(i(),f(t(y),{key:2,href:`/admin/segments/${l.id}/edit`},{default:s(()=>[e(t(g),null,{default:s(()=>[e(t(xt),{class:"mr-2 h-4 w-4"}),a[22]||(a[22]=o(" Editar ",-1))]),_:1})]),_:1},8,["href"])):_("",!0),G(l)?(i(),f(t(g),{key:3,onClick:m=>H(l),class:"text-destructive"},{default:s(()=>[e(t(yt),{class:"mr-2 h-4 w-4"}),a[23]||(a[23]=o(" Eliminar ",-1))]),_:1},8,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),u.segments.data.length===0?(i(),f(t(w),{key:0},{default:s(()=>[e(t(p),{colspan:"8",class:"text-center py-8 text-muted-foreground"},{default:s(()=>[...a[24]||(a[24]=[o(" No se encontraron segmentos ",-1)])]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1}),u.segments.last_page>1?(i(),$("div",Ut,[n("nav",Lt,[(i(!0),$(B,null,F(u.segments.links,l=>(i(),f(t(y),{key:l.label,href:l.url,class:J(["px-3 py-2 text-sm rounded-md",l.active?"bg-primary text-primary-foreground":"hover:bg-muted",!l.url&&"opacity-50 cursor-not-allowed"]),innerHTML:l.label,disabled:!l.url},null,8,["href","class","innerHTML","disabled"]))),128))])])):_("",!0)]),_:1})]),_:1})])]),_:1}))}});export{Ie as default};
