import{d as Ne,r as N,c as V,p as te,i as _,e as a,g as o,b as h,j as x,w as l,f as e,h as i,t as f,n as k,F as Q,k as K,x as Ee,m,u as We,q as Ie,l as Ge,s as Oe,a as Re}from"./app-C_gfZV1-.js";import{_ as j}from"./createLucideIcon-LCCin2D0.js";import{a as A,b as D,c as S,_ as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-DJGHSV9E.js";import{_ as U}from"./CardDescription.vue_vue_type_script_setup_true_lang-snRPFac0.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-zbeD4SIO.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-D52F8Xuc.js";import{_ as Qe}from"./Textarea.vue_vue_type_script_setup_true_lang-D99VE0oX.js";import{_ as Ue,a as Pe,b as Me,c as je,d as qe}from"./SelectValue.vue_vue_type_script_setup_true_lang-B06pPlTQ.js";import{_ as q,a as T}from"./index-DnAcItF_.js";import{_ as le,a as M}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-BsYvKVyx.js";import{_ as Ke}from"./AdminLayout.vue_vue_type_script_setup_true_lang-xsUNqOtS.js";import{_ as Te}from"./index-BEm2U-W2.js";import{M as ee}from"./map-pin-CFmCsfgg.js";import{S as ae}from"./shield-DX6Okc01.js";import{F as H}from"./filter-BVL-96Pb.js";import{C as Le}from"./calendar-DmhhJ7lO.js";import{S as He}from"./search-BGddqwBu.js";import{C as Je}from"./circle-check-CsnRUP1_.js";import{U as B}from"./users-DN6ncwuy.js";import{I as J}from"./info-BzfiHu6m.js";import{C as Be}from"./circle-alert-tGPsKrGX.js";import{_ as Xe}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-DLpnB7Bw.js";import{t as C}from"./index-uVxstrj-.js";import{d as Ye}from"./debounce-BRgnKmwk.js";import{A as Ze}from"./arrow-left-D-oe4XDp.js";import{S as ea}from"./save-hrmyjHUW.js";import{M as aa}from"./mail-DyDM1W6C.js";import{M as ta}from"./message-square-DZGHN4nb.js";import{S as la}from"./send-C-W1urrX.js";import"./index-D-cJwBhy.js";import"./VisuallyHidden-CBr7fGPU.js";import"./check-Cjp661W1.js";import"./floating-ui.vue-DnmkEKBW.js";import"./RovingFocusItem-3ZqmeKrb.js";import"./utils-CXuFeNy8.js";import"./VisuallyHiddenInput-CmqEUXbn.js";import"./circle-CTaxPOJV.js";import"./useFlashMessages-B6jZS7Rs.js";import"./index-K6MveLEE.js";import"./x-CJ_HHczB.js";import"./index-CWrHDAM0.js";import"./user-BAvGAMJ6.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DU8wuQJI.js";import"./chevron-right-BvME8AG8.js";import"./house-ByErwb8W.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BdJ-M5gr.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BM9w-b1r.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-oA0L8KJf.js";import"./chevrons-up-down-BEHVMB6i.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-B44PLq6Y.js";import"./target-Bg0MFnT-.js";import"./vote-CNKyCWNb.js";import"./folder-open-COOgyORL.js";import"./file-text-C1k3zoJT.js";import"./briefcase-DVx28f_Z.js";import"./megaphone-BDO6ruUm.js";import"./user-check-CuEsssqc.js";import"./clipboard-list-9G7Lxp_9.js";import"./external-link-IFKhxjHc.js";import"./panel-left-Ct_Nf-3R.js";import"./index-BxHOhP--.js";import"./DialogTrigger-7FHHSX0D.js";import"./useKbd-kRIii9yh.js";import"./chevron-left-C8LyDS0h.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-D4W8U1oD.js";import"./es-SykclP7y.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-HhgXvbNE.js";import"./loader-circle-DeOzt58P.js";import"./trash-2-CurzGGDH.js";import"./plus-Dz2uDOJl.js";import"./history-GNfGKq2-.js";const sa={class:"space-y-4"},oa={class:"flex justify-between items-center"},na={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},ia={class:"flex items-center gap-2"},ra={class:"flex items-center gap-2"},da={class:"flex items-center gap-2"},ua={class:"flex items-center gap-2"},ma={class:"flex flex-col md:flex-row gap-4"},pa={class:"flex-1"},ca={class:"relative"},fa={class:"flex gap-2"},_a={class:"space-y-2 max-h-96 overflow-y-auto p-2"},ga={class:"flex items-start justify-between"},va={class:"flex-1"},xa={class:"flex items-center gap-2"},ba={class:"font-medium"},ya={key:0,class:"text-sm text-muted-foreground mt-1"},ka={class:"text-right"},wa={class:"text-2xl font-bold"},ha={key:0,class:"text-center py-8 text-muted-foreground"},$a={class:"space-y-3"},Ca={class:"font-medium flex items-center gap-2"},Va={key:0,class:"text-sm text-muted-foreground mt-1"},Sa={class:"flex items-center justify-between p-3 bg-muted rounded-md"},za={class:"text-2xl font-bold"},Fa=Ne({__name:"SegmentSelector",props:{modelValue:{default:null},segments:{},required:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(F,{emit:c}){const b=F,W=c,s=N(b.modelValue),E=N(""),v=N("all"),w=V(()=>b.segments.find(u=>u.id===s.value)||null),y=V(()=>{let u=b.segments;if(E.value){const n=E.value.toLowerCase();u=u.filter(p=>{var L;return p.nombre.toLowerCase().includes(n)||((L=p.descripcion)==null?void 0:L.toLowerCase().includes(n))})}return v.value!=="all"&&(u=u.filter(n=>n.tipo===v.value)),u}),$=V(()=>{const u={total:b.segments.length,geografico:0,rol:0,personalizado:0,dinamico:0,totalUsuarios:0};return b.segments.forEach(n=>{u[n.tipo]++,u.totalUsuarios+=n.count||0}),u}),X=u=>{s.value=u;const n=b.segments.find(p=>p.id===u)||null;W("update:modelValue",u),W("change",n)},I=u=>({geografico:ee,rol:ae,personalizado:H,dinamico:Le})[u]||B,G=u=>({geografico:"text-blue-600",rol:"text-purple-600",personalizado:"text-green-600",dinamico:"text-orange-600"})[u]||"text-gray-600",Y=u=>({geografico:"Geográfico",rol:"Por Rol",personalizado:"Personalizado",dinamico:"Dinámico"})[u]||u,O=u=>u?u>=1e6?`${(u/1e6).toFixed(1)}M`:u>=1e3?`${(u/1e3).toFixed(1)}K`:u.toLocaleString():"0";return te(()=>b.modelValue,u=>{s.value=u}),(u,n)=>(m(),_("div",sa,[a(e(z),null,{default:l(()=>[a(e(A),null,{default:l(()=>[o("div",oa,[a(e(D),{class:"text-base"},{default:l(()=>[...n[6]||(n[6]=[i("Seleccionar Segmento",-1)])]),_:1}),a(e(Te),{variant:"outline"},{default:l(()=>[i(f($.value.total)+" segmentos disponibles ",1)]),_:1})])]),_:1}),a(e(S),null,{default:l(()=>[o("div",na,[o("div",ia,[a(e(ee),{class:"w-4 h-4 text-blue-600"}),o("span",null,f($.value.geografico)+" Geográficos",1)]),o("div",ra,[a(e(ae),{class:"w-4 h-4 text-purple-600"}),o("span",null,f($.value.rol)+" Por Rol",1)]),o("div",da,[a(e(H),{class:"w-4 h-4 text-green-600"}),o("span",null,f($.value.personalizado)+" Personalizados",1)]),o("div",ua,[a(e(Le),{class:"w-4 h-4 text-orange-600"}),o("span",null,f($.value.dinamico)+" Dinámicos",1)])])]),_:1})]),_:1}),o("div",ma,[o("div",pa,[o("div",ca,[a(e(He),{class:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),a(e(P),{modelValue:E.value,"onUpdate:modelValue":n[0]||(n[0]=p=>E.value=p),placeholder:"Buscar segmento...",class:"pl-8"},null,8,["modelValue"])])]),o("div",fa,[a(e(j),{variant:"outline",size:"sm",class:k({"bg-accent":v.value==="all"}),onClick:n[1]||(n[1]=p=>v.value="all")},{default:l(()=>[...n[7]||(n[7]=[i(" Todos ",-1)])]),_:1},8,["class"]),a(e(j),{variant:"outline",size:"sm",class:k({"bg-accent":v.value==="geografico"}),onClick:n[2]||(n[2]=p=>v.value="geografico")},{default:l(()=>[a(e(ee),{class:"w-4 h-4 mr-1"}),n[8]||(n[8]=i(" Geográfico ",-1))]),_:1},8,["class"]),a(e(j),{variant:"outline",size:"sm",class:k({"bg-accent":v.value==="rol"}),onClick:n[3]||(n[3]=p=>v.value="rol")},{default:l(()=>[a(e(ae),{class:"w-4 h-4 mr-1"}),n[9]||(n[9]=i(" Rol ",-1))]),_:1},8,["class"]),a(e(j),{variant:"outline",size:"sm",class:k({"bg-accent":v.value==="personalizado"}),onClick:n[4]||(n[4]=p=>v.value="personalizado")},{default:l(()=>[a(e(H),{class:"w-4 h-4 mr-1"}),n[10]||(n[10]=i(" Personalizado ",-1))]),_:1},8,["class"])])]),a(e(z),null,{default:l(()=>[a(e(S),{class:"p-2"},{default:l(()=>[a(e(le),{modelValue:s.value,"onUpdate:modelValue":[n[5]||(n[5]=p=>s.value=p),X]},{default:l(()=>[o("div",_a,[(m(!0),_(Q,null,K(y.value,p=>(m(),_("div",{key:p.id,class:k(["flex items-start space-x-3 p-3 rounded-lg border hover:bg-accent cursor-pointer",{"bg-accent border-primary":s.value===p.id}])},[a(e(M),{value:p.id,id:`segment-${p.id}`},null,8,["value","id"]),a(e(g),{for:`segment-${p.id}`,class:"flex-1 cursor-pointer"},{default:l(()=>[o("div",ga,[o("div",va,[o("div",xa,[(m(),h(Ee(I(p.tipo)),{class:k(["w-4 h-4",G(p.tipo)])},null,8,["class"])),o("span",ba,f(p.nombre),1),a(e(Te),{variant:"outline",class:"ml-2"},{default:l(()=>[i(f(Y(p.tipo)),1)]),_:2},1024)]),p.descripcion?(m(),_("p",ya,f(p.descripcion),1)):x("",!0)]),o("div",ka,[o("p",wa,f(O(p.count)),1),n[11]||(n[11]=o("p",{class:"text-xs text-muted-foreground"},"usuarios",-1))])])]),_:2},1032,["for"])],2))),128)),y.value.length===0?(m(),_("div",ha," No se encontraron segmentos ")):x("",!0)])]),_:1},8,["modelValue"])]),_:1})]),_:1}),F.showPreview&&w.value?(m(),h(e(z),{key:0},{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),{class:"text-base flex items-center gap-2"},{default:l(()=>[a(e(Je),{class:"w-4 h-4 text-green-600"}),n[12]||(n[12]=i(" Segmento Seleccionado ",-1))]),_:1})]),_:1}),a(e(S),null,{default:l(()=>[o("div",$a,[o("div",null,[o("h4",Ca,[(m(),h(Ee(I(w.value.tipo)),{class:k(["w-4 h-4",G(w.value.tipo)])},null,8,["class"])),i(" "+f(w.value.nombre),1)]),w.value.descripcion?(m(),_("p",Va,f(w.value.descripcion),1)):x("",!0)]),o("div",Sa,[o("div",null,[n[13]||(n[13]=o("p",{class:"text-sm text-muted-foreground"},"Total de destinatarios",-1)),o("p",za,f(O(w.value.count)),1)]),a(e(B),{class:"w-8 h-8 text-muted-foreground"})]),a(e(q),null,{default:l(()=>[a(e(J),{class:"h-4 w-4"}),a(e(T),null,{default:l(()=>[...n[14]||(n[14]=[i(" Los usuarios de este segmento recibirán la campaña según los criterios definidos. El número de destinatarios puede variar al momento del envío. ",-1)])]),_:1})]),_:1})])]),_:1})]),_:1})):x("",!0),F.required&&!s.value?(m(),h(e(q),{key:1,variant:"warning"},{default:l(()=>[a(e(Be),{class:"h-4 w-4"}),a(e(T),null,{default:l(()=>[...n[15]||(n[15]=[i(" Debes seleccionar un segmento para continuar ",-1)])]),_:1})]),_:1})):x("",!0)]))}}),Aa={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Da={class:"flex justify-between items-center"},Ea={class:"text-3xl font-bold"},Ua={class:"text-muted-foreground mt-1"},Pa={class:"flex gap-2"},Ma={class:"list-disc pl-4"},ja={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qa={class:"flex items-center space-x-2"},Ta={class:"flex items-center space-x-2"},La={class:"flex items-center space-x-2"},Na={class:"flex items-center space-x-2"},Ba={class:"flex items-center space-x-2"},Wa={key:0},Ia={key:0,class:"mt-4 p-3 bg-muted rounded-md"},Ga={class:"flex items-center gap-2 text-sm"},Oa={class:"font-medium"},Ra={key:1,class:"space-y-4"},Qa={key:0,class:"p-3 bg-muted rounded-md"},Ka={class:"flex items-center gap-2 text-sm"},Ha={class:"font-medium"},Ja={key:1,class:"p-3 bg-muted rounded-md"},Xa={class:"font-medium"},Ya={key:0,class:"text-xs text-muted-foreground"},Za={class:"font-medium"},et={key:0,class:"text-xs text-muted-foreground"},at={class:"flex items-center space-x-2"},tt=["aria-checked"],lt={key:0,class:"space-y-2"},st={key:0},ot={key:1,class:"space-y-4"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},it={key:2,class:"space-y-2"},rt={class:"space-y-2"},dt={class:"flex items-center space-x-2"},ut=["aria-checked"],mt={class:"flex items-center space-x-2"},pt=["aria-checked"],Al=Ne({__name:"Create",props:{campana:{},segmentos:{default:()=>[]},plantillasEmail:{default:()=>[]},plantillasWhatsApp:{default:()=>[]},tiposOptions:{default:()=>["email","whatsapp","ambos"]},estadosOptions:{},batchSizeEmailDefault:{},batchSizeWhatsAppDefault:{},whatsAppDelayDefault:{},filterFieldsConfig:{}},setup(F){var se,oe,ne,ie,re,de,ue,me,pe,ce,fe,_e,ge,ve,xe,be,ye,ke,we,he,$e,Ce,Ve,Se,ze;const c=F,b=V(()=>{var d;return!!((d=c.campana)!=null&&d.id)}),W=[{title:"Admin",href:"/admin/dashboard"},{title:"Campañas",href:"/admin/campanas"},{title:b.value?"Editar Campaña":"Nueva Campaña",href:"#"}],s=We({nombre:((se=c.campana)==null?void 0:se.nombre)||"",descripcion:((oe=c.campana)==null?void 0:oe.descripcion)||"",tipo:((ne=c.campana)==null?void 0:ne.tipo)||"email",estado:((ie=c.campana)==null?void 0:ie.estado)||"borrador",segment_id:((re=c.campana)==null?void 0:re.segment_id)||null,audience_mode:((de=c.campana)==null?void 0:de.audience_mode)||"segment",filters:((ue=c.campana)==null?void 0:ue.filters)||{},plantilla_email_id:((me=c.campana)==null?void 0:me.plantilla_email_id)||null,plantilla_whatsapp_id:((pe=c.campana)==null?void 0:pe.plantilla_whatsapp_id)||null,fecha_programada:((ce=c.campana)==null?void 0:ce.fecha_programada)||"",es_programada:!!((fe=c.campana)!=null&&fe.fecha_programada),configuracion:{batch_size_email:((ge=(_e=c.campana)==null?void 0:_e.configuracion)==null?void 0:ge.batch_size_email)||c.batchSizeEmailDefault||50,whatsapp_delay_min:((xe=(ve=c.campana)==null?void 0:ve.configuracion)==null?void 0:xe.whatsapp_delay_min)||((be=c.whatsAppDelayDefault)==null?void 0:be.min)||5,whatsapp_delay_max:((ke=(ye=c.campana)==null?void 0:ye.configuracion)==null?void 0:ke.whatsapp_delay_max)||((we=c.whatsAppDelayDefault)==null?void 0:we.max)||30,enable_tracking:(($e=(he=c.campana)==null?void 0:he.configuracion)==null?void 0:$e.enable_tracking)??!0,enable_pixel_tracking:((Ve=(Ce=c.campana)==null?void 0:Ce.configuracion)==null?void 0:Ve.enable_pixel_tracking)??!0,enable_click_tracking:((ze=(Se=c.campana)==null?void 0:Se.configuracion)==null?void 0:ze.enable_click_tracking)??!0}}),E=V(()=>c.segmentos.find(d=>d.id===s.segment_id)),v=V(()=>s.tipo==="email"||s.tipo==="ambos"),w=V(()=>s.tipo==="whatsapp"||s.tipo==="ambos"),y=N(null),$=N(!1),X=V(()=>({fields:c.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por nombre o email...",quickSearchFields:["name","email"],maxNestingLevel:2,allowSaveFilters:!1,autoApply:!1})),I=async d=>{s.filters=d,s.segment_id=null,await G()},G=Ye(async()=>{var r,R,Fe,Ae,De;const d=s.filters;if(!(((R=(r=d==null?void 0:d.advanced_filters)==null?void 0:r.conditions)==null?void 0:R.length)>0||((Ae=(Fe=d==null?void 0:d.advanced_filters)==null?void 0:Fe.groups)==null?void 0:Ae.length)>0||((De=d==null?void 0:d.conditions)==null?void 0:De.length)>0)){y.value=null;return}$.value=!0;try{const Z=await Re.post("/admin/campanas/count-users",{filters:d});y.value=Z.data.count}catch(Z){console.error("Error contando usuarios:",Z),y.value=null,C.error("Error al contar usuarios")}finally{$.value=!1}},500),Y=()=>{s.filters={},y.value=null};te(()=>s.audience_mode,d=>{d==="segment"?(s.filters={},y.value=null):s.segment_id=null}),te(()=>s.tipo,d=>{d==="email"?s.plantilla_whatsapp_id=null:d==="whatsapp"&&(s.plantilla_email_id=null)});const O=()=>{var d;if(s.audience_mode==="segment"){if(!s.segment_id){C.error("Debes seleccionar un segmento");return}}else if(s.audience_mode==="manual"&&(!y.value||y.value<=0)){C.error("Debes definir filtros que generen al menos un destinatario");return}if(v.value&&!s.plantilla_email_id){C.error("Debes seleccionar una plantilla de email");return}if(w.value&&!s.plantilla_whatsapp_id){C.error("Debes seleccionar una plantilla de WhatsApp");return}b.value?s.put(`/admin/campanas/${(d=c.campana)==null?void 0:d.id}`,{onSuccess:()=>{C.success("Campaña actualizada exitosamente")},onError:()=>{C.error("Error al actualizar la campaña")}}):s.post("/admin/campanas",{onSuccess:()=>{C.success("Campaña creada exitosamente")},onError:()=>{C.error("Error al crear la campaña")}})},u=V(()=>{const d=s.nombre&&!s.processing&&(v.value?s.plantilla_email_id:!0)&&(w.value?s.plantilla_whatsapp_id:!0);return s.audience_mode==="segment"?d&&s.segment_id:d&&y.value&&y.value>0}),n=d=>{s.es_programada=d,d||(s.fecha_programada="")},p=d=>{s.configuracion.enable_pixel_tracking=d},L=d=>{s.configuracion.enable_click_tracking=d};return(d,t)=>(m(),h(Ke,{breadcrumbs:W},{default:l(()=>[a(e(Ie),{title:b.value?"Editar Campaña":"Nueva Campaña"},null,8,["title"]),o("div",Aa,[o("form",{onSubmit:Ge(O,["prevent"]),class:"space-y-6"},[o("div",Da,[o("div",null,[o("h1",Ea,f(b.value?"Editar Campaña":"Nueva Campaña"),1),o("p",Ua,f(b.value?"Modifica los detalles de la campaña":"Configura y programa tu campaña de comunicación"),1)]),o("div",Pa,[a(e(j),{type:"button",variant:"outline",onClick:t[0]||(t[0]=r=>e(Oe).visit("/admin/campanas"))},{default:l(()=>[a(e(Ze),{class:"w-4 h-4 mr-2"}),t[18]||(t[18]=i(" Cancelar ",-1))]),_:1}),a(e(j),{type:"submit",disabled:!u.value},{default:l(()=>[a(e(ea),{class:"w-4 h-4 mr-2"}),i(" "+f(b.value?"Actualizar":"Guardar")+" Campaña ",1)]),_:1},8,["disabled"])])]),Object.keys(e(s).errors).length>0?(m(),h(e(q),{key:0,variant:"destructive"},{default:l(()=>[a(e(Be),{class:"h-4 w-4"}),a(e(T),null,{default:l(()=>[o("ul",Ma,[(m(!0),_(Q,null,K(e(s).errors,(r,R)=>(m(),_("li",{key:R},f(r),1))),128))])]),_:1})]),_:1})):x("",!0),a(e(z),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[19]||(t[19]=[i("Información Básica",-1)])]),_:1}),a(e(U),null,{default:l(()=>[...t[20]||(t[20]=[i(" Define el nombre y tipo de campaña ",-1)])]),_:1})]),_:1}),a(e(S),{class:"space-y-4"},{default:l(()=>[o("div",ja,[o("div",null,[a(e(g),{htmlFor:"nombre"},{default:l(()=>[...t[21]||(t[21]=[i(" Nombre de la Campaña ",-1),o("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(P),{id:"nombre",modelValue:e(s).nombre,"onUpdate:modelValue":t[1]||(t[1]=r=>e(s).nombre=r),placeholder:"Ej: Recordatorio Asamblea General",error:e(s).errors.nombre},null,8,["modelValue","error"])]),o("div",null,[a(e(g),null,{default:l(()=>[...t[22]||(t[22]=[i("Tipo de Campaña ",-1),o("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(le),{modelValue:e(s).tipo,"onUpdate:modelValue":t[2]||(t[2]=r=>e(s).tipo=r),class:"flex flex-wrap gap-4 mt-2"},{default:l(()=>[o("div",qa,[a(e(M),{value:"email",id:"tipo-email"}),a(e(g),{htmlFor:"tipo-email",class:"flex items-center gap-1 cursor-pointer"},{default:l(()=>[a(e(aa),{class:"w-4 h-4"}),t[23]||(t[23]=i(" Email ",-1))]),_:1})]),o("div",Ta,[a(e(M),{value:"whatsapp",id:"tipo-whatsapp"}),a(e(g),{htmlFor:"tipo-whatsapp",class:"flex items-center gap-1 cursor-pointer"},{default:l(()=>[a(e(ta),{class:"w-4 h-4"}),t[24]||(t[24]=i(" WhatsApp ",-1))]),_:1})]),o("div",La,[a(e(M),{value:"ambos",id:"tipo-ambos"}),a(e(g),{htmlFor:"tipo-ambos",class:"flex items-center gap-1 cursor-pointer"},{default:l(()=>[a(e(la),{class:"w-4 h-4"}),t[25]||(t[25]=i(" Ambos ",-1))]),_:1})])]),_:1},8,["modelValue"])])]),o("div",null,[a(e(g),{htmlFor:"descripcion"},{default:l(()=>[...t[26]||(t[26]=[i("Descripción",-1)])]),_:1}),a(e(Qe),{id:"descripcion",modelValue:e(s).descripcion,"onUpdate:modelValue":t[3]||(t[3]=r=>e(s).descripcion=r),placeholder:"Describe el objetivo de esta campaña...",rows:"3"},null,8,["modelValue"])])]),_:1})]),_:1}),a(e(z),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[27]||(t[27]=[i("Audiencia",-1)])]),_:1}),a(e(U),null,{default:l(()=>[...t[28]||(t[28]=[i(" Define quiénes recibirán esta campaña ",-1)])]),_:1})]),_:1}),a(e(S),{class:"space-y-4"},{default:l(()=>[a(e(le),{modelValue:e(s).audience_mode,"onUpdate:modelValue":t[4]||(t[4]=r=>e(s).audience_mode=r),class:"flex gap-4"},{default:l(()=>[o("div",Na,[a(e(M),{value:"segment",id:"mode-segment"}),a(e(g),{htmlFor:"mode-segment",class:"flex items-center gap-1 cursor-pointer"},{default:l(()=>[a(e(B),{class:"w-4 h-4"}),t[29]||(t[29]=i(" Usar segmento existente ",-1))]),_:1})]),o("div",Ba,[a(e(M),{value:"manual",id:"mode-manual"}),a(e(g),{htmlFor:"mode-manual",class:"flex items-center gap-1 cursor-pointer"},{default:l(()=>[a(e(H),{class:"w-4 h-4"}),t[30]||(t[30]=i(" Filtros manuales ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(s).audience_mode==="segment"?(m(),_("div",Wa,[a(Fa,{modelValue:e(s).segment_id,"onUpdate:modelValue":t[5]||(t[5]=r=>e(s).segment_id=r),segments:F.segmentos},null,8,["modelValue","segments"]),E.value?(m(),_("div",Ia,[o("div",Ga,[a(e(B),{class:"w-4 h-4"}),o("span",Oa,f(E.value.count)+" usuarios",1),t[31]||(t[31]=o("span",{class:"text-muted-foreground"},"recibirán esta campaña",-1))])])):x("",!0)])):(m(),_("div",Ra,[a(e(q),null,{default:l(()=>[a(e(J),{class:"h-4 w-4"}),a(e(T),null,{default:l(()=>[...t[32]||(t[32]=[i(" Define filtros para seleccionar usuarios específicos sin crear un segmento permanente. ",-1)])]),_:1})]),_:1}),a(Xe,{config:X.value,onApply:I,onClear:Y},null,8,["config"]),y.value!==null?(m(),_("div",Qa,[o("div",Ka,[a(e(B),{class:"w-4 h-4"}),o("span",Ha,f(y.value)+" usuarios",1),t[33]||(t[33]=o("span",{class:"text-muted-foreground"},"recibirán esta campaña",-1))])])):$.value?(m(),_("div",Ja,[...t[34]||(t[34]=[o("div",{class:"flex items-center gap-2 text-sm text-muted-foreground"},[o("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),i(" Calculando usuarios... ")],-1)])])):x("",!0)]))]),_:1})]),_:1}),v.value?(m(),h(e(z),{key:1},{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[35]||(t[35]=[i("Plantilla de Email",-1)])]),_:1}),a(e(U),null,{default:l(()=>[...t[36]||(t[36]=[i(" Selecciona la plantilla de email a utilizar ",-1)])]),_:1})]),_:1}),a(e(S),null,{default:l(()=>[a(e(Ue),{modelValue:e(s).plantilla_email_id,"onUpdate:modelValue":t[6]||(t[6]=r=>e(s).plantilla_email_id=r)},{default:l(()=>[a(e(Pe),null,{default:l(()=>[a(e(Me),{placeholder:"Selecciona una plantilla"})]),_:1}),a(e(je),null,{default:l(()=>[(m(!0),_(Q,null,K(F.plantillasEmail,r=>(m(),h(e(qe),{key:r.id,value:r.id.toString()},{default:l(()=>[o("div",null,[o("div",Xa,f(r.nombre),1),r.asunto?(m(),_("div",Ya," Asunto: "+f(r.asunto),1)):x("",!0)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):x("",!0),w.value?(m(),h(e(z),{key:2},{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[37]||(t[37]=[i("Plantilla de WhatsApp",-1)])]),_:1}),a(e(U),null,{default:l(()=>[...t[38]||(t[38]=[i(" Selecciona la plantilla de WhatsApp a utilizar ",-1)])]),_:1})]),_:1}),a(e(S),null,{default:l(()=>[a(e(Ue),{modelValue:e(s).plantilla_whatsapp_id,"onUpdate:modelValue":t[7]||(t[7]=r=>e(s).plantilla_whatsapp_id=r)},{default:l(()=>[a(e(Pe),null,{default:l(()=>[a(e(Me),{placeholder:"Selecciona una plantilla"})]),_:1}),a(e(je),null,{default:l(()=>[(m(!0),_(Q,null,K(F.plantillasWhatsApp,r=>(m(),h(e(qe),{key:r.id,value:r.id.toString()},{default:l(()=>[o("div",null,[o("div",Za,f(r.nombre),1),r.descripcion?(m(),_("div",et,f(r.descripcion),1)):x("",!0)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):x("",!0),a(e(z),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[39]||(t[39]=[i("Programación",-1)])]),_:1}),a(e(U),null,{default:l(()=>[...t[40]||(t[40]=[i(" Define cuándo se enviará la campaña ",-1)])]),_:1})]),_:1}),a(e(S),{class:"space-y-4"},{default:l(()=>[o("div",at,[o("button",{type:"button",onClick:t[8]||(t[8]=r=>n(!e(s).es_programada)),class:k(["inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] cursor-pointer",e(s).es_programada?"bg-primary":"bg-input"]),"aria-checked":e(s).es_programada,role:"switch"},[o("span",{class:k(["pointer-events-none block size-4 rounded-full bg-background ring-0 transition-transform",e(s).es_programada?"translate-x-[calc(100%-2px)]":"translate-x-0"])},null,2)],10,tt),a(e(g),{onClick:t[9]||(t[9]=r=>n(!e(s).es_programada)),class:"cursor-pointer"},{default:l(()=>[...t[41]||(t[41]=[i("Programar envío",-1)])]),_:1})]),e(s).es_programada?(m(),_("div",lt,[a(e(g),{htmlFor:"fecha_programada"},{default:l(()=>[...t[42]||(t[42]=[i(" Fecha y hora de envío ",-1),o("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(P),{id:"fecha_programada",type:"datetime-local",modelValue:e(s).fecha_programada,"onUpdate:modelValue":t[10]||(t[10]=r=>e(s).fecha_programada=r),min:new Date().toISOString().slice(0,16),class:"w-full",required:""},null,8,["modelValue","min"]),t[43]||(t[43]=o("p",{class:"text-xs text-muted-foreground"}," La campaña se enviará automáticamente en la fecha y hora seleccionada ",-1))])):x("",!0)]),_:1})]),_:1}),a(e(z),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[44]||(t[44]=[i("Configuración Avanzada",-1)])]),_:1}),a(e(U),null,{default:l(()=>[...t[45]||(t[45]=[i(" Ajusta los parámetros de envío y tracking ",-1)])]),_:1})]),_:1}),a(e(S),{class:"space-y-4"},{default:l(()=>[v.value?(m(),_("div",st,[a(e(g),{htmlFor:"batch_size_email"},{default:l(()=>[...t[46]||(t[46]=[i(" Tamaño de lote (Email) ",-1)])]),_:1}),a(e(P),{id:"batch_size_email",type:"number",modelValue:e(s).configuracion.batch_size_email,"onUpdate:modelValue":t[11]||(t[11]=r=>e(s).configuracion.batch_size_email=r),modelModifiers:{number:!0},min:"1",max:"100",class:"max-w-xs"},null,8,["modelValue"]),t[47]||(t[47]=o("p",{class:"text-xs text-muted-foreground mt-1"}," Emails enviados por lote (máximo 100, recomendado: 50) ",-1))])):x("",!0),w.value?(m(),_("div",ot,[a(e(q),null,{default:l(()=>[a(e(J),{class:"h-4 w-4"}),a(e(T),null,{default:l(()=>[...t[48]||(t[48]=[i(" Los mensajes de WhatsApp se envían uno a uno con intervalos de tiempo aleatorios para evitar bloqueos de la API. ",-1)])]),_:1})]),_:1}),o("div",nt,[o("div",null,[a(e(g),{htmlFor:"whatsapp_delay_min"},{default:l(()=>[...t[49]||(t[49]=[i(" Intervalo mínimo (segundos) ",-1)])]),_:1}),a(e(P),{id:"whatsapp_delay_min",type:"number",modelValue:e(s).configuracion.whatsapp_delay_min,"onUpdate:modelValue":t[12]||(t[12]=r=>e(s).configuracion.whatsapp_delay_min=r),modelModifiers:{number:!0},min:"5",max:"120"},null,8,["modelValue"]),t[50]||(t[50]=o("p",{class:"text-xs text-muted-foreground mt-1"}," Mínimo 5 segundos entre mensajes ",-1))]),o("div",null,[a(e(g),{htmlFor:"whatsapp_delay_max"},{default:l(()=>[...t[51]||(t[51]=[i(" Intervalo máximo (segundos) ",-1)])]),_:1}),a(e(P),{id:"whatsapp_delay_max",type:"number",modelValue:e(s).configuracion.whatsapp_delay_max,"onUpdate:modelValue":t[13]||(t[13]=r=>e(s).configuracion.whatsapp_delay_max=r),modelModifiers:{number:!0},min:"5",max:"120"},null,8,["modelValue"]),t[52]||(t[52]=o("p",{class:"text-xs text-muted-foreground mt-1"}," Máximo 120 segundos entre mensajes ",-1))])])])):x("",!0),v.value?(m(),_("div",it,[a(e(g),null,{default:l(()=>[...t[53]||(t[53]=[i("Opciones de Tracking",-1)])]),_:1}),o("div",rt,[o("div",dt,[o("button",{type:"button",onClick:t[14]||(t[14]=r=>p(!e(s).configuracion.enable_pixel_tracking)),class:k(["inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] cursor-pointer",e(s).configuracion.enable_pixel_tracking?"bg-primary":"bg-input"]),"aria-checked":e(s).configuracion.enable_pixel_tracking,role:"switch"},[o("span",{class:k(["pointer-events-none block size-4 rounded-full bg-background ring-0 transition-transform",e(s).configuracion.enable_pixel_tracking?"translate-x-[calc(100%-2px)]":"translate-x-0"])},null,2)],10,ut),a(e(g),{class:"font-normal cursor-pointer",onClick:t[15]||(t[15]=r=>p(!e(s).configuracion.enable_pixel_tracking))},{default:l(()=>[...t[54]||(t[54]=[i(" Tracking de apertura (pixel) ",-1)])]),_:1})]),o("div",mt,[o("button",{type:"button",onClick:t[16]||(t[16]=r=>L(!e(s).configuracion.enable_click_tracking)),class:k(["inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] cursor-pointer",e(s).configuracion.enable_click_tracking?"bg-primary":"bg-input"]),"aria-checked":e(s).configuracion.enable_click_tracking,role:"switch"},[o("span",{class:k(["pointer-events-none block size-4 rounded-full bg-background ring-0 transition-transform",e(s).configuracion.enable_click_tracking?"translate-x-[calc(100%-2px)]":"translate-x-0"])},null,2)],10,pt),a(e(g),{class:"font-normal cursor-pointer",onClick:t[17]||(t[17]=r=>L(!e(s).configuracion.enable_click_tracking))},{default:l(()=>[...t[55]||(t[55]=[i(" Tracking de clicks ",-1)])]),_:1})])])])):x("",!0)]),_:1})]),_:1}),a(e(q),null,{default:l(()=>[a(e(J),{class:"h-4 w-4"}),a(e(T),null,{default:l(()=>[...t[56]||(t[56]=[i(" La campaña se guardará en estado ",-1),o("strong",null,"borrador",-1),i(". Podrás revisarla y enviarla desde el listado de campañas. ",-1)])]),_:1})]),_:1})],32)])]),_:1}))}});export{Al as default};
