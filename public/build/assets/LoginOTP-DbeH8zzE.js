import{d as D,r as x,c as T,o as Q,y as X,b as C,e as t,I as H,w as u,i as o,j as w,f as i,u as e,h as l,g as n,t as c,a as L,C as A,p as J,l as M,n as K,F as Y,k as Z}from"./app-Cuh3Sov_.js";import{_ as W}from"./InputError.vue_vue_type_script_setup_true_lang-kjME8Na7.js";import{a as ee,b as te,c as se,_ as ae}from"./CardTitle.vue_vue_type_script_setup_true_lang-BO_pj4R6.js";import{_ as B,a as F}from"./index-BJ9KZ8Sq.js";import{_ as O}from"./AlertTitle.vue_vue_type_script_setup_true_lang-CHcR_UhB.js";import{_ as oe}from"./index-CKwtzZC0.js";import{_ as R}from"./createLucideIcon-zA0T3Uav.js";import{_ as ne}from"./Progress.vue_vue_type_script_setup_true_lang-C63NX-Y6.js";import{_ as z}from"./Skeleton.vue_vue_type_script_setup_true_lang-iry6C3KF.js";import{L as j}from"./loader-circle-Dk-Ur3cS.js";import{C as ie}from"./clock-DYXX5iiW.js";import{C as le}from"./circle-alert-D1JqI4MG.js";import{T as re}from"./timer-CLHV2d_e.js";import{I as de}from"./info-CC11JdG4.js";import{R as ue}from"./refresh-cw-at5C7SCF.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as pe}from"./Input.vue_vue_type_script_setup_true_lang-B9pczU8X.js";import{_ as N}from"./Label.vue_vue_type_script_setup_true_lang-CWld6NAA.js";import{_ as me,a as fe,b as ve}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-D6qcFoXI.js";import{_ as _e}from"./AuthLayout.vue_vue_type_script_setup_true_lang-CGG1xYYR.js";import{M as he}from"./mail-CH_htvL0.js";import"./index-C_dJ9DUh.js";import"./VisuallyHidden-CFxslfO1.js";import"./nullish-CHIgUVhi.js";import"./useArrowNavigation-B5rxJs06.js";import"./VisuallyHiddenInput-BN4v02eS.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Ccv6A-0f.js";const ge={key:0,class:"mt-4"},ye={key:0,class:"space-y-3"},be={key:1,class:"space-y-4"},xe={key:0,class:"space-y-2"},ke={class:"flex items-center justify-between"},we={class:"text-sm text-muted-foreground"},Ce={key:1,class:"space-y-2"},$e={key:2,class:"space-y-2"},Ie={class:"flex items-center justify-between"},Ee={class:"text-sm font-medium"},Re={class:"flex items-center gap-2 text-xs text-muted-foreground"},Te={key:3,class:"mt-4 pt-4 border-t"},Se={key:2,class:"text-center py-4"},Ve=D({__name:"OTPQueueStatus",props:{type:{},identifier:{},autoRefresh:{type:Boolean,default:!0},refreshInterval:{default:5e3},showRateLimitInfo:{type:Boolean,default:!0}},emits:["statusUpdate","error"],setup(P,{emit:p}){const f=P,_=p,m=x(!1),h=x(!1),s=x(null),b=x(5),v=x(null),g=x(null),y=T(()=>{if(!s.value||s.value.total_ahead===0)return 100;const k=s.value.position+10,r=k-s.value.position;return Math.min(100,Math.round(r/k*100))}),S=T(()=>f.type==="email"?2:5),$=async()=>{var k;m.value=!0;try{const r=await L.get(`/api/queue/otp/position/${encodeURIComponent(f.identifier)}`,{params:{type:f.type}});r.data.success&&(s.value=r.data.data,h.value=!0,_("statusUpdate",s.value),s.value.position===0&&V())}catch(r){if(((k=r.response)==null?void 0:k.status)===404)try{const d=await L.get("/api/queue/otp/estimate",{params:{type:f.type}});d.data.success&&(s.value=d.data.data,h.value=!0,_("statusUpdate",s.value))}catch(d){console.error("Error obteniendo estimación:",d),_("error",d)}else console.error("Error verificando estado:",r),_("error",r)}finally{m.value=!1}},I=()=>{f.autoRefresh&&(v.value=window.setInterval(()=>{$(),U()},f.refreshInterval),g.value=window.setInterval(()=>{b.value=Math.max(0,b.value-1)},1e3))},V=()=>{v.value&&(clearInterval(v.value),v.value=null),g.value&&(clearInterval(g.value),g.value=null)},U=()=>{b.value=Math.floor(f.refreshInterval/1e3)};return Q(()=>{$(),I()}),X(()=>{V()}),(k,r)=>(t(),C(H,{name:"fade"},{default:u(()=>[h.value?(t(),o("div",ge,[i(e(ae),null,{default:u(()=>[i(e(ee),null,{default:u(()=>[i(e(te),{class:"flex items-center gap-2"},{default:u(()=>[m.value?(t(),C(e(j),{key:0,class:"h-4 w-4 animate-spin"})):(t(),C(e(ie),{key:1,class:"h-4 w-4"})),r[0]||(r[0]=l(" Estado de envío de tu código ",-1))]),_:1})]),_:1}),i(e(se),null,{default:u(()=>[m.value?(t(),o("div",ye,[i(e(z),{class:"h-4 w-full"}),i(e(z),{class:"h-4 w-3/4"})])):s.value?(t(),o("div",be,[s.value.position>1?(t(),o("div",xe,[n("div",ke,[r[1]||(r[1]=n("span",{class:"text-sm text-muted-foreground"},"Posición en cola",-1)),i(e(oe),{variant:"secondary"},{default:u(()=>[l(c(s.value.position),1)]),_:1})]),i(e(ne),{value:y.value,class:"h-2"},null,8,["value"]),n("p",we,c(s.value.total_ahead)+" personas delante de ti ",1)])):s.value.position===1?(t(),o("div",Ce,[i(e(B),null,{default:u(()=>[i(e(le),{class:"h-4 w-4"}),i(e(O),null,{default:u(()=>[...r[2]||(r[2]=[l("Procesando tu solicitud",-1)])]),_:1}),i(e(F),null,{default:u(()=>[...r[3]||(r[3]=[l(" Tu código está siendo enviado en este momento... ",-1)])]),_:1})]),_:1})])):w("",!0),s.value.estimated_seconds>0?(t(),o("div",$e,[n("div",Ie,[r[4]||(r[4]=n("span",{class:"text-sm text-muted-foreground"},"Tiempo estimado",-1)),n("span",Ee,c(s.value.estimated_time),1)]),n("div",Re,[i(e(re),{class:"h-3 w-3"}),n("span",null,"Actualizando en "+c(b.value)+"s",1)])])):w("",!0),k.showRateLimitInfo?(t(),o("div",Te,[i(e(B),{variant:"info"},{default:u(()=>[i(e(de),{class:"h-4 w-4"}),i(e(O),null,{default:u(()=>[...r[5]||(r[5]=[l("¿Por qué la espera?",-1)])]),_:1}),i(e(F),null,{default:u(()=>[l(" Para garantizar la entrega confiable de mensajes, procesamos "+c(S.value)+" "+c(k.type==="email"?"correos":"mensajes")+" por segundo. Esto nos ayuda a mantener un servicio estable para todos. ",1)]),_:1})]),_:1})])):w("",!0)])):(t(),o("div",Se,[r[7]||(r[7]=n("p",{class:"text-sm text-muted-foreground"}," No se pudo obtener el estado de la cola ",-1)),i(e(R),{onClick:$,variant:"ghost",size:"sm",class:"mt-2"},{default:u(()=>[i(e(ue),{class:"h-3 w-3 mr-2"}),r[6]||(r[6]=l(" Reintentar ",-1))]),_:1})]))]),_:1})]),_:1})])):w("",!0)]),_:1}))}}),q=ce(Ve,[["__scopeId","data-v-4203e165"]]),je={key:0,class:"mb-4 text-center text-muted-foreground"},Pe={key:0},Ue={key:0},Ae={key:1},qe={key:2},Le={key:3},Me={key:1},We={key:1,class:"mb-4 text-center text-muted-foreground"},Be={key:0},Fe={key:1},Oe={key:2},ze={key:2,class:"mb-4 text-center text-sm font-medium text-green-600"},Ne={class:"grid gap-6"},De={class:"grid gap-2"},Qe={class:"relative"},Xe={class:"grid gap-6"},Ge={class:"text-center"},He={class:"text-sm text-muted-foreground"},Je={key:0},Ke={key:0},Ye={class:"font-medium"},Ze={key:1},et={class:"font-medium"},tt={key:2},st={class:"font-medium"},at={key:1},ot={key:0},nt={class:"font-medium"},it={key:1},lt={class:"font-medium"},rt={class:"font-medium"},dt={key:2},ut={class:"font-medium"},ct={class:"font-medium"},pt={key:0},mt={key:1},ft={class:"grid gap-2"},vt={class:"flex justify-center"},_t={class:"flex flex-col gap-3"},ht={class:"flex flex-col gap-2 text-center"},gt={class:"mt-6 text-center text-xs text-muted-foreground"},yt={key:0},bt={key:1},Gt=D({__name:"LoginOTP",props:{status:{},authConfig:{},censoredEmail:{},otpCredential:{},otpChannel:{},whatsappEnabled:{type:Boolean},intendedUrl:{}},setup(P){const p=P,f=x(p.censoredEmail?"otp":"credential"),_=x(p.censoredEmail||""),m=T(()=>p.authConfig||{login_type:"email",input_type:"email",placeholder:"correo@ejemplo.com",pattern:null,label:"Correo Electrónico"}),h=A({credential:""}),s=A({credential:p.otpCredential||"",otp_code:[]}),b=A({credential:"",otp_code:""}),v=x(!1),g=x(0),y=x(null),S=T(()=>g.value===0),$=T(()=>g.value>0?`Reenviar en ${g.value}s`:"Reenviar código"),I=(d=60)=>{g.value=d,y.value&&clearInterval(y.value),y.value=window.setInterval(()=>{g.value--,g.value<=0&&(clearInterval(y.value),y.value=null)},1e3)},V=()=>{v.value=!0,h.post(route("auth.request-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),f.value="otp",s.credential=h.credential,s.clearErrors(),I(60)},onError:()=>{},onFinish:()=>{v.value=!1}})},U=()=>{const d=s.otp_code.join("");b.credential=s.credential,b.otp_code=d,b.post(route("auth.verify-otp"),{onSuccess:()=>{},onError:()=>{s.otp_code=[]}})},k=()=>{S.value&&(v.value=!0,s.post(route("auth.resend-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),I(60)},onFinish:()=>{v.value=!1}}))},r=()=>{f.value="credential",s.reset(),y.value&&(clearInterval(y.value),y.value=null),g.value=0};return Q(()=>{f.value==="otp"&&I(60);const d=localStorage.getItem("intendedUrl");d&&!p.intendedUrl&&fetch("/login?intended="+encodeURIComponent(d),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{localStorage.removeItem("intendedUrl")})}),X(()=>{y.value&&clearInterval(y.value)}),(d,a)=>(t(),C(_e,{title:f.value==="credential"?"Iniciar Sesión":"Verificar Código"},{default:u(()=>[i(e(J),{title:"Iniciar Sesión"}),f.value==="credential"?(t(),o("div",je,[m.value.login_type==="documento"?(t(),o("p",Pe,[a[2]||(a[2]=l(" Ingresa tu documento de identidad para recibir el código de verificación ",-1)),d.whatsappEnabled?p.otpChannel==="whatsapp"?(t(),o("strong",Ae,"vía WhatsApp")):p.otpChannel==="both"?(t(),o("strong",qe,"vía correo electrónico y WhatsApp")):(t(),o("strong",Le,"vía correo electrónico")):(t(),o("strong",Ue,"vía correo electrónico"))])):(t(),o("p",Me," Ingresa tu "+c(m.value.label.toLowerCase())+" para recibir el código de verificación ",1))])):(t(),o("div",We,[p.otpChannel==="whatsapp"?(t(),o("p",Be,[...a[3]||(a[3]=[l(" Ingresa el código de 6 dígitos enviado a tu ",-1),n("strong",null,"WhatsApp",-1)])])):p.otpChannel==="both"?(t(),o("p",Fe,[...a[4]||(a[4]=[l(" Ingresa el código de 6 dígitos enviado a tu ",-1),n("strong",null,"correo y WhatsApp",-1)])])):(t(),o("p",Oe,[...a[5]||(a[5]=[l(" Ingresa el código de 6 dígitos enviado a tu ",-1),n("strong",null,"correo",-1)])]))])),d.status?(t(),o("div",ze,c(d.status),1)):w("",!0),f.value==="credential"?(t(),o("form",{key:3,onSubmit:M(V,["prevent"]),class:"flex flex-col gap-6"},[n("div",Ne,[n("div",De,[i(e(N),{for:"credential"},{default:u(()=>[l(c(m.value.label),1)]),_:1}),n("div",Qe,[m.value.login_type==="email"?(t(),C(e(he),{key:0,class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})):w("",!0),i(e(pe),{id:"credential",type:m.value.input_type,required:"",autofocus:"",tabindex:"1",autocomplete:m.value.login_type==="email"?"email":"off",inputmode:m.value.login_type==="documento"?"numeric":void 0,modelValue:e(h).credential,"onUpdate:modelValue":a[0]||(a[0]=E=>e(h).credential=E),placeholder:m.value.placeholder,pattern:m.value.pattern,class:K({"pl-10":m.value.login_type==="email"})},null,8,["type","autocomplete","inputmode","modelValue","placeholder","pattern","class"])]),i(W,{message:e(h).errors.credential},null,8,["message"])]),i(e(R),{type:"submit",class:"mt-4 w-full",tabindex:"2",disabled:e(h).processing||v.value},{default:u(()=>[e(h).processing||v.value?(t(),C(e(j),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):w("",!0),l(" "+c(e(h).processing||v.value?"Enviando...":"Enviar Código"),1)]),_:1},8,["disabled"])])],32)):(t(),o("form",{key:4,onSubmit:M(U,["prevent"]),class:"flex flex-col gap-6"},[n("div",Xe,[n("div",Ge,[n("p",He,[m.value.login_type==="email"?(t(),o("span",Je,[p.otpChannel==="whatsapp"?(t(),o("span",Ke,[a[6]||(a[6]=l(" Código enviado por WhatsApp al número asociado con ",-1)),n("span",Ye,c(_.value||e(s).credential),1)])):p.otpChannel==="both"?(t(),o("span",Ze,[a[7]||(a[7]=l(" Código enviado al email ",-1)),n("span",et,c(_.value||e(s).credential),1),a[8]||(a[8]=l(" y WhatsApp ",-1))])):(t(),o("span",tt,[a[9]||(a[9]=l(" Código enviado al email ",-1)),n("span",st,c(_.value||e(s).credential),1)]))])):(t(),o("span",at,[p.otpChannel==="whatsapp"?(t(),o("span",ot,[a[10]||(a[10]=l(" Código enviado por WhatsApp al número asociado con el documento ",-1)),n("span",nt,c(e(s).credential),1)])):p.otpChannel==="both"?(t(),o("span",it,[a[11]||(a[11]=l(" Código enviado al email ",-1)),n("span",lt,c(_.value),1),a[12]||(a[12]=l(" y WhatsApp asociados al documento ",-1)),n("span",rt,c(e(s).credential),1)])):(t(),o("span",dt,[a[13]||(a[13]=l(" Código enviado al email ",-1)),n("span",ut,c(_.value),1),a[14]||(a[14]=l(" asociado al documento ",-1)),n("span",ct,c(e(s).credential),1)]))]))])]),p.otpChannel==="both"?(t(),o("div",pt,[i(q,{type:"email",identifier:_.value||e(s).credential,"show-rate-limit-info":!0},null,8,["identifier"]),i(q,{type:"whatsapp",identifier:e(s).credential,"show-rate-limit-info":!0},null,8,["identifier"])])):(t(),o("div",mt,[i(q,{type:p.otpChannel==="whatsapp"?"whatsapp":"email",identifier:p.otpChannel==="whatsapp"?e(s).credential:_.value||e(s).credential,"show-rate-limit-info":!0},null,8,["type","identifier"])])),n("div",ft,[i(e(N),{class:"text-center"},{default:u(()=>[...a[15]||(a[15]=[l("Código de Verificación",-1)])]),_:1}),n("div",vt,[i(e(me),{modelValue:e(s).otp_code,"onUpdate:modelValue":a[1]||(a[1]=E=>e(s).otp_code=E),length:6,type:"text",placeholder:"0",class:"gap-2"},{default:u(()=>[i(e(fe),null,{default:u(()=>[(t(),o(Y,null,Z(6,(E,G)=>i(e(ve),{key:E,index:G,class:"h-12 w-12 text-lg font-medium",inputmode:"numeric"},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue"])]),i(W,{message:e(s).errors.otp_code},null,8,["message"])]),n("div",_t,[i(e(R),{type:"submit",class:"w-full",disabled:e(b).processing||e(s).otp_code.join("").length!==6},{default:u(()=>[e(b).processing?(t(),C(e(j),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):w("",!0),l(" "+c(e(b).processing?"Verificando...":"Verificar Código"),1)]),_:1},8,["disabled"]),n("div",ht,[i(e(R),{type:"button",variant:"ghost",size:"sm",onClick:k,disabled:!S.value||v.value},{default:u(()=>[v.value?(t(),C(e(j),{key:0,class:"mr-2 h-3 w-3 animate-spin"})):w("",!0),l(" "+c(v.value?"Enviando...":$.value),1)]),_:1},8,["disabled"]),i(e(R),{type:"button",variant:"ghost",size:"sm",onClick:r},{default:u(()=>[l(c(m.value.login_type==="email"?"Cambiar correo electrónico":"Cambiar documento"),1)]),_:1})])])])],32)),n("div",gt,[f.value==="credential"?(t(),o("p",yt," Solo personas registradas como militantes pueden acceder al sistema. ")):(t(),o("p",bt," El código expira en 10 minutos. Si no lo recibes, verifica tu bandeja de spam. ")),a[16]||(a[16]=n("br",null,null,-1)),a[17]||(a[17]=n("p",null,[l(" Si necesitas ayuda escribe a "),n("b",null,"soporte@colombiahumana.co"),l(" para soporte sobre la plataforma. Para inquietudes jurídicas a "),n("b",null,"juridicoelectoral@colombiahumana.co")],-1))])]),_:1},8,["title"]))}});export{Gt as default};
