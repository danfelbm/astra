import{d as ee,r as $,c as q,p as K,i as f,j as _,g as i,b as z,e as t,f as e,w as l,h as x,F as G,k as Q,t as u,l as fe,n as T,m as n,a as ve}from"./app-CmZXEU6r.js";import{a as oe,b as le,c as ie,_ as ne}from"./CardTitle.vue_vue_type_script_setup_true_lang-B1S67cXd.js";import{_ as O}from"./Label.vue_vue_type_script_setup_true_lang-DqIcWBli.js";import{_ as pe}from"./Input.vue_vue_type_script_setup_true_lang-D2njpHVb.js";import{_ as ge}from"./Textarea.vue_vue_type_script_setup_true_lang-DvLkRKKb.js";import{_ as I}from"./createLucideIcon-CnNZrfzB.js";import{_ as xe,a as be,b as he,c as _e,d as re}from"./SelectValue.vue_vue_type_script_setup_true_lang-D5V10iEd.js";import{_ as W}from"./InputError.vue_vue_type_script_setup_true_lang-DjkoakyD.js";import{_ as J}from"./index-BxKCYSwr.js";import{_ as ye,a as $e}from"./index-E4SQY5mg.js";import{U as de}from"./upload-CecxdjGv.js";import{C as ke}from"./circle-alert-D9XfP6Me.js";import{P as we}from"./paperclip-Ba41mm4S.js";import{X as Y}from"./x-BVEqjV7Q.js";import{e as Ce,_ as Se,a as Fe,b as Be,c as Me,d as ze}from"./DialogTitle.vue_vue_type_script_setup_true_lang-E09DhlJW.js";import{_ as Ie}from"./Checkbox.vue_vue_type_script_setup_true_lang-B_oFJ-wf.js";import{_ as Pe,a as Ve,b as Ee}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Bhl0TEBs.js";import{_ as je,a as De,b as Ae,c as Ue,e as Te,d as ue}from"./index-wEk_2PfU.js";import{t as ce}from"./index-B6_LNVRx.js";import{g as Ne,f as Le}from"./contratos-BiUTbrRP.js";import{C as Oe}from"./chevrons-up-down-D1gfH8ue.js";import{C as me}from"./check-Co0UTQtg.js";import{S as qe}from"./search-BUYmF1F5.js";import{L as X}from"./loader-circle-CXSDkxRs.js";import{F as Z}from"./file-text-DK4-w4Jw.js";import{C as Re}from"./chevron-left-DsIYP98f.js";import{C as He}from"./chevron-right-CYROSQyW.js";import{f as Ke,e as Ge}from"./es-BDPlFIsO.js";import{p as Qe}from"./parseISO-DFjB8F03.js";const We={class:"space-y-4"},Xe={key:0,class:"space-y-2"},Je={class:"space-y-2"},Ye={class:"flex items-center gap-3 flex-1 min-w-0"},Ze={class:"min-w-0 flex-1"},et={class:"text-sm font-medium truncate"},tt={key:0,class:"text-xs text-muted-foreground"},at=["multiple","accept","disabled"],st={class:"text-sm font-medium mb-1"},ot={class:"text-xs text-muted-foreground"},lt={class:"text-xs text-muted-foreground mt-1"},it={key:0},nt={key:1,class:"space-y-2"},rt={class:"space-y-2"},dt={class:"flex items-center gap-3 flex-1 min-w-0"},ut={class:"min-w-0 flex-1"},ct={class:"text-sm font-medium truncate"},mt={class:"text-xs text-muted-foreground"},ft={key:3,class:"text-xs text-muted-foreground"},vt={key:0,class:"text-destructive"},pt=ee({__name:"FileAttachmentManager",props:{existingFiles:{default:()=>[]},label:{},description:{},multiple:{type:Boolean,default:!0},maxFiles:{default:10},maxSizeMB:{default:5},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},disabled:{type:Boolean,default:!1},error:{}},emits:["files-added","file-removed"],setup(a,{expose:R,emit:v}){const k=a,m=v,M=$(),y=$(!1),g=$([]),P=$(""),F=q(()=>k.existingFiles||[]),w=q(()=>F.value.length+g.value.length),C=q(()=>w.value<k.maxFiles),V=()=>{var b;!k.disabled&&C.value&&((b=M.value)==null||b.click())},S=b=>{const p=b.target;p.files&&(j(Array.from(p.files)),p.value="")},E=b=>{var h;if(b.preventDefault(),y.value=!1,k.disabled)return;const p=Array.from(((h=b.dataTransfer)==null?void 0:h.files)||[]);j(p)},j=b=>{P.value="";const p=k.maxFiles-w.value;if(b.length>p){P.value=`Solo puedes agregar ${p} archivo(s) más. Límite: ${k.maxFiles}`;return}const h=[],d=[];b.forEach(s=>{var o;const U=k.maxSizeMB*1024*1024;if(s.size>U){d.push(`${s.name}: excede ${k.maxSizeMB}MB`);return}const c=`.${(o=s.name.split(".").pop())==null?void 0:o.toLowerCase()}`;if(!k.accept.split(",").map(L=>L.trim().toLowerCase()).includes(c)){d.push(`${s.name}: formato no permitido`);return}h.push(s)}),d.length>0&&(P.value=d.join(", ")),h.length>0&&(k.multiple?g.value.push(...h):g.value=[h[0]],m("files-added",g.value))},H=b=>{g.value.splice(b,1),m("files-added",g.value)},D=b=>{const p=F.value[b];p&&confirm("¿Estás seguro de eliminar este archivo?")&&m("file-removed",p.ruta)},A=b=>{if(!b)return"0 KB";const p=["B","KB","MB","GB"],h=Math.floor(Math.log(b)/Math.log(1024));return`${(b/Math.pow(1024,h)).toFixed(1)} ${p[h]}`},N=b=>{var p;return((p=b.split(".").pop())==null?void 0:p.toUpperCase())||"FILE"};return R({newFiles:g,clearNewFiles:()=>{g.value=[]}}),K(()=>k.error,b=>{b||(P.value="")}),(b,p)=>(n(),f("div",We,[F.value.length>0?(n(),f("div",Xe,[t(e(O),{class:"text-sm font-medium"},{default:l(()=>[...p[2]||(p[2]=[x("Archivos actuales",-1)])]),_:1}),i("div",Je,[(n(!0),f(G,null,Q(F.value,(h,d)=>(n(),f("div",{key:`existing-${d}`,class:"flex items-center justify-between p-3 bg-muted rounded-lg border border-border hover:bg-accent/50 transition-colors"},[i("div",Ye,[t(e(we),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),i("div",Ze,[i("p",et,u(h.nombre_original),1),h.tamaño?(n(),f("p",tt,u(A(h.tamaño)),1)):_("",!0)]),t(e(J),{variant:"outline",class:"flex-shrink-0"},{default:l(()=>[x(u(N(h.nombre_original)),1)]),_:2},1024)]),t(e(I),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10 flex-shrink-0",onClick:s=>D(d),disabled:a.disabled},{default:l(()=>[t(e(Y),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])]))),128))])])):_("",!0),i("div",null,[a.label?(n(),z(e(O),{key:0,class:"text-sm font-medium"},{default:l(()=>[x(u(a.label),1)]),_:1})):_("",!0),i("div",{onDrop:E,onDragover:p[0]||(p[0]=fe(h=>y.value=!0,["prevent"])),onDragleave:p[1]||(p[1]=h=>y.value=!1),onClick:V,class:"relative mt-2"},[i("input",{ref_key:"fileInput",ref:M,type:"file",multiple:a.multiple,accept:a.accept,disabled:a.disabled,class:"hidden",onChange:S},null,40,at),i("div",{class:T(["border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-all",{"border-primary bg-primary/5 ring-2 ring-primary/20":y.value,"border-muted-foreground/25 hover:border-muted-foreground/50 hover:bg-muted/30":!y.value&&!a.disabled,"opacity-50 cursor-not-allowed":a.disabled,"border-destructive":a.error}])},[t(e(de),{class:T(["h-10 w-10 mx-auto mb-3 transition-colors",y.value?"text-primary":"text-muted-foreground"])},null,8,["class"]),i("p",st,u(y.value?"Suelta los archivos aquí":"Haz clic o arrastra archivos aquí"),1),i("p",ot,u(a.description||`Formatos: ${a.accept}`),1),i("p",lt,[x(" Máximo "+u(a.maxSizeMB)+"MB por archivo ",1),a.multiple?(n(),f("span",it," • Hasta "+u(a.maxFiles)+" archivos total",1)):_("",!0)])],2)],32)]),g.value.length>0?(n(),f("div",nt,[t(e(O),{class:"text-sm font-medium"},{default:l(()=>[...p[3]||(p[3]=[x("Archivos a subir",-1)])]),_:1}),i("div",rt,[(n(!0),f(G,null,Q(g.value,(h,d)=>(n(),f("div",{key:`new-${d}`,class:"flex items-center justify-between p-3 bg-accent rounded-lg border border-primary/20"},[i("div",dt,[t(e(de),{class:"h-4 w-4 text-primary flex-shrink-0"}),i("div",ut,[i("p",ct,u(h.name),1),i("p",mt,u(A(h.size)),1)]),t(e(J),{variant:"secondary",class:"flex-shrink-0"},{default:l(()=>[x(u(N(h.name)),1)]),_:2},1024)]),t(e(I),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 hover:bg-destructive/10 flex-shrink-0",onClick:s=>H(d),disabled:a.disabled},{default:l(()=>[t(e(Y),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])]))),128))])])):_("",!0),a.error?(n(),z(e(ye),{key:2,variant:"destructive"},{default:l(()=>[t(e(ke),{class:"h-4 w-4"}),t(e($e),null,{default:l(()=>[x(u(a.error),1)]),_:1})]),_:1})):_("",!0),!a.disabled&&(F.value.length>0||g.value.length>0)?(n(),f("div",ft,[x(u(w.value)+" de "+u(a.maxFiles)+" archivos ",1),w.value>=a.maxFiles?(n(),f("span",vt," (límite alcanzado)")):_("",!0)])):_("",!0)]))}}),gt={class:"space-y-4"},xt={class:"grid gap-4 md:grid-cols-2"},bt={key:0},ht={class:"truncate"},_t={class:"relative"},yt={class:"border rounded-lg"},$t={class:"max-h-96 overflow-y-auto p-4"},kt={key:0,class:"flex items-center justify-center py-8"},wt={key:1,class:"space-y-2"},Ct=["for"],St={class:"font-medium"},Ft={key:0,class:"text-sm text-muted-foreground"},Bt={class:"flex items-center gap-2 mt-1"},Mt={class:"text-xs text-muted-foreground"},zt={class:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground"},It={key:0},Pt={key:0,class:"font-medium"},Vt={key:2,class:"text-center py-8"},Et={class:"text-muted-foreground"},jt={key:0,class:"border-t px-4 py-3"},Dt={class:"flex items-center justify-between"},At={class:"text-sm text-muted-foreground"},Ut={key:0},Tt={class:"flex gap-2"},Nt={class:"flex items-center justify-between w-full"},Lt={class:"text-sm text-muted-foreground"},Ot={key:0,class:"font-medium text-foreground"},qt={key:1},Rt={class:"flex gap-2"},Ht={key:1},Kt=ee({__name:"AddContratosModal",props:{modelValue:{type:Boolean},title:{default:"Seleccionar Contrato"},description:{default:"Selecciona el contrato que deseas utilizar"},searchEndpoint:{},excludedIds:{},proyectos:{},proyectoId:{},estadosPermitidos:{},maxSelection:{},submitButtonText:{default:"Seleccionar"},searchPlaceholder:{default:"Buscar por nombre, proyecto o contraparte..."},emptyMessage:{default:"Escribe para buscar contratos disponibles"},noResultsMessage:{default:"No se encontraron contratos con esa búsqueda"}},emits:["update:modelValue","submit"],setup(a,{emit:R}){const v=a,k=R,m=q({get:()=>v.modelValue,set:c=>k("update:modelValue",c)}),M=$(""),y=$([]),g=$([]),P=$(!1),F=$(!1),w=$(!1),C=$(v.proyectoId||null),V=$(!1),S=$(1),E=$(1),j=$(0),H=q(()=>!C.value||!v.proyectos?null:v.proyectos.find(c=>c.id===C.value)),D=async(c=1)=>{P.value=!0;try{const r={page:c,search:M.value};C.value&&(r.proyecto_id=C.value),v.estadosPermitidos&&v.estadosPermitidos.length>0&&(r.estados=v.estadosPermitidos),v.excludedIds&&v.excludedIds.length>0&&(r.excluded_ids=v.excludedIds);const o=await ve.get(v.searchEndpoint,{params:r});o.data.contratos?(y.value=o.data.contratos||[],S.value=o.data.current_page||1,E.value=o.data.last_page||1,j.value=o.data.total||0):(y.value=o.data.data||[],S.value=o.data.current_page||1,E.value=o.data.last_page||1,j.value=o.data.total||0)}catch(r){console.error("Error buscando contratos:",r),ce.error("Error al buscar contratos",{description:"Por favor intenta nuevamente",duration:3e3}),y.value=[]}finally{P.value=!1}};let A=null;K(M,()=>{A&&clearTimeout(A),A=setTimeout(()=>{m.value&&(S.value=1,D(1))},500)}),K(C,()=>{m.value&&w.value&&(S.value=1,D(1))}),K(m,c=>{c&&!w.value&&(w.value=!0,D(1)),c||(g.value=[],M.value="",y.value=[],S.value=1,w.value=!1,v.proyectoId||(C.value=null))});const N=(c,r)=>{if(r){if(v.maxSelection&&g.value.length>=v.maxSelection){ce.warning(`Máximo ${v.maxSelection} contrato(s) permitido(s)`);return}g.value.includes(c)||g.value.push(c)}else{const o=g.value.indexOf(c);o>-1&&g.value.splice(o,1)}},b=c=>g.value.includes(c),p=c=>{S.value=c,D(c)},h=async()=>{if(g.value.length===0)return;const c=y.value.filter(r=>g.value.includes(r.id));k("submit",{contratoIds:g.value,contratos:c}),m.value=!1},d=c=>{C.value=c,V.value=!1},s=c=>{if(!c)return"-";try{return Ke(Qe(c),"dd MMM yyyy",{locale:Ge})}catch{return c}},U=c=>({borrador:"secondary",activo:"success",finalizado:"default",cancelado:"destructive"})[c]||"secondary";return(c,r)=>(n(),z(e(Ce),{open:m.value,"onUpdate:open":r[6]||(r[6]=o=>m.value=o)},{default:l(()=>[t(e(Se),{class:"max-w-3xl"},{default:l(()=>[t(e(Fe),null,{default:l(()=>[t(e(Be),null,{default:l(()=>[x(u(a.title),1)]),_:1}),t(e(Me),null,{default:l(()=>[x(u(a.description),1)]),_:1})]),_:1}),i("div",gt,[i("div",xt,[a.proyectos&&a.proyectos.length>0&&!a.proyectoId?(n(),f("div",bt,[r[9]||(r[9]=i("label",{class:"text-sm font-medium"},"Filtrar por Proyecto",-1)),t(e(Pe),{open:V.value,"onUpdate:open":r[1]||(r[1]=o=>V.value=o)},{default:l(()=>[t(e(Ve),{asChild:""},{default:l(()=>[t(e(I),{variant:"outline",role:"combobox","aria-expanded":V.value,class:"w-full justify-between"},{default:l(()=>{var o;return[i("span",ht,u(((o=H.value)==null?void 0:o.nombre)||"Todos los proyectos"),1),t(e(Oe),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]}),_:1},8,["aria-expanded"])]),_:1}),t(e(Ee),{class:"w-[300px] p-0"},{default:l(()=>[t(e(je),null,{default:l(()=>[t(e(De),{placeholder:"Buscar proyecto..."}),t(e(Ae),null,{default:l(()=>[t(e(Ue),null,{default:l(()=>[...r[7]||(r[7]=[x("No se encontraron proyectos.",-1)])]),_:1}),t(e(Te),null,{default:l(()=>[t(e(ue),{value:"todos",onSelect:r[0]||(r[0]=o=>d(null))},{default:l(()=>[t(e(me),{class:T(["mr-2 h-4 w-4",C.value?"opacity-0":"opacity-100"])},null,8,["class"]),r[8]||(r[8]=x(" Todos los proyectos ",-1))]),_:1}),(n(!0),f(G,null,Q(a.proyectos,o=>(n(),z(e(ue),{key:o.id,value:o.nombre,onSelect:L=>d(o.id)},{default:l(()=>[t(e(me),{class:T(["mr-2 h-4 w-4",C.value===o.id?"opacity-100":"opacity-0"])},null,8,["class"]),x(" "+u(o.nombre),1)]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])):_("",!0),i("div",{class:T({"md:col-span-2":!a.proyectos||a.proyectos.length===0||a.proyectoId})},[r[10]||(r[10]=i("label",{class:"text-sm font-medium"},"Buscar Contratos",-1)),i("div",_t,[t(e(qe),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t(e(pe),{modelValue:M.value,"onUpdate:modelValue":r[2]||(r[2]=o=>M.value=o),placeholder:a.searchPlaceholder,type:"text",class:"pl-10"},null,8,["modelValue","placeholder"])])],2)]),i("div",yt,[i("div",$t,[P.value?(n(),f("div",kt,[t(e(X),{class:"h-8 w-8 animate-spin text-muted-foreground"}),r[11]||(r[11]=i("span",{class:"ml-2 text-muted-foreground"},"Buscando contratos...",-1))])):y.value.length>0?(n(),f("div",wt,[(n(!0),f(G,null,Q(y.value,o=>(n(),f("div",{key:o.id,class:"flex items-start space-x-3 py-3 px-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded transition-colors border-b last:border-b-0"},[t(e(Ie),{id:`contrato-${o.id}`,checked:b(o.id),"onUpdate:checked":L=>N(o.id,L),class:"mt-1"},null,8,["id","checked","onUpdate:checked"]),i("label",{for:`contrato-${o.id}`,class:"flex-1 cursor-pointer"},[i("div",St,u(o.nombre),1),o.proyecto?(n(),f("div",Ft,u(o.proyecto.nombre),1)):_("",!0),i("div",Bt,[t(e(J),{variant:U(o.estado),class:"text-xs"},{default:l(()=>[x(u(e(Ne)(o.estado)),1)]),_:2},1032,["variant"]),i("span",Mt,u(o.tipo),1)]),i("div",zt,[i("span",null,[x(u(s(o.fecha_inicio))+" ",1),o.fecha_fin?(n(),f("span",It," → "+u(s(o.fecha_fin)),1)):_("",!0)]),o.monto_total?(n(),f("span",Pt,u(e(Le)(o.monto_total,o.moneda)),1)):_("",!0)])],8,Ct)]))),128))])):(n(),f("div",Vt,[t(e(Z),{class:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),i("p",Et,u(M.value||C.value?a.noResultsMessage:a.emptyMessage),1)]))]),E.value>1?(n(),f("div",jt,[i("div",Dt,[i("span",At,[x(" Página "+u(S.value)+" de "+u(E.value)+" ",1),j.value>0?(n(),f("span",Ut," ("+u(j.value)+" contratos disponibles) ",1)):_("",!0)]),i("div",Tt,[t(e(I),{variant:"outline",size:"sm",disabled:S.value===1,onClick:r[3]||(r[3]=o=>p(S.value-1))},{default:l(()=>[t(e(Re),{class:"h-4 w-4"})]),_:1},8,["disabled"]),t(e(I),{variant:"outline",size:"sm",disabled:S.value===E.value,onClick:r[4]||(r[4]=o=>p(S.value+1))},{default:l(()=>[t(e(He),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])])):_("",!0)])]),t(e(ze),null,{default:l(()=>[i("div",Nt,[i("span",Lt,[g.value.length>0?(n(),f("span",Ot,u(g.value.length)+" contrato(s) seleccionado(s) ",1)):(n(),f("span",qt," Selecciona contratos para continuar "))]),i("div",Rt,[t(e(I),{variant:"outline",onClick:r[5]||(r[5]=o=>m.value=!1)},{default:l(()=>[...r[12]||(r[12]=[x(" Cancelar ",-1)])]),_:1}),t(e(I),{onClick:h,disabled:g.value.length===0||F.value},{default:l(()=>[F.value?(n(),z(e(X),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):_("",!0),x(" "+u(a.submitButtonText)+" ",1),g.value.length>0?(n(),f("span",Ht," ("+u(g.value.length)+") ",1)):_("",!0)]),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1},8,["open"]))}}),Gt={key:0},Qt={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between mb-2"},Wt={class:"flex items-center gap-2"},Xt={class:"font-medium"},Jt={key:0,class:"text-sm text-muted-foreground"},Yt={key:1},Zt={key:0,class:"flex items-center gap-2 h-10 px-3 border rounded-md bg-muted/50"},ea={key:3,class:"text-xs text-muted-foreground mt-1"},ta={class:"flex justify-end gap-2"},Ia=ee({__name:"ObligacionForm",props:{obligacion:{},contratoId:{},contratos:{default:()=>[]},proyectos:{default:()=>[]},parentId:{},posiblesPadres:{default:()=>[]},usuarios:{default:()=>[]},loading:{type:Boolean,default:!1},errors:{default:()=>({})}},emits:["submit","cancel"],setup(a,{emit:R}){var D,A,N,b,p,h;const v=a,k=R,m=$({contrato_id:v.contratoId||((D=v.obligacion)==null?void 0:D.contrato_id)||0,parent_id:v.parentId||((A=v.obligacion)==null?void 0:A.parent_id)||null,titulo:((N=v.obligacion)==null?void 0:N.titulo)||"",descripcion:((b=v.obligacion)==null?void 0:b.descripcion)||"",archivos:[],archivos_eliminar:[]}),M=$(!1),y=$((p=v.obligacion)!=null&&p.contrato?{id:v.obligacion.contrato.id,nombre:v.obligacion.contrato.nombre,proyecto:v.obligacion.contrato.proyecto}:((h=v.contratos)==null?void 0:h.find(d=>d.id===m.value.contrato_id))||null),g=d=>{d.contratoIds.length>0&&(m.value.contrato_id=d.contratoIds[0],d.contratos&&d.contratos.length>0&&(y.value=d.contratos[0]),m.value.parent_id=null,V(d.contratoIds[0]))},P=()=>{m.value.contrato_id=0,y.value=null,m.value.parent_id=null,F.value=[]},F=$([]),w=$(!1),C=q(()=>v.contratoId?v.posiblesPadres||[]:F.value),V=async d=>{if(!d){F.value=[];return}w.value=!0;try{const s=await ve.get("/admin/obligaciones/posibles-padres",{params:{contrato_id:d}});s.data.success&&(F.value=s.data.posiblesPadres)}catch(s){console.error("Error cargando posibles padres:",s),F.value=[]}finally{w.value=!1}};K(()=>m.value.contrato_id,d=>{if(!v.contratoId&&d){m.value.parent_id=null;const s=typeof d=="string"?parseInt(d,10):d;s&&!isNaN(s)&&V(s)}});const S=q(()=>{var s;return(((s=v.obligacion)==null?void 0:s.archivos_adjuntos)||[]).filter(U=>{var c;return!((c=m.value.archivos_eliminar)!=null&&c.includes(U.ruta))})}),E=()=>{const d={...m.value};k("submit",d)},j=d=>{m.value.archivos=d},H=d=>{m.value.archivos_eliminar=m.value.archivos_eliminar||[],m.value.archivos_eliminar.includes(d)||m.value.archivos_eliminar.push(d)};return(d,s)=>(n(),f("form",{onSubmit:fe(E,["prevent"]),class:"space-y-4"},[t(e(ne),null,{default:l(()=>[t(e(oe),null,{default:l(()=>[t(e(le),null,{default:l(()=>[...s[6]||(s[6]=[x("Información Básica",-1)])]),_:1})]),_:1}),t(e(ie),{class:"space-y-4"},{default:l(()=>{var U,c,r,o,L,te,ae;return[a.contratoId?_("",!0):(n(),f("div",Gt,[t(e(O),{for:"contrato_id",required:""},{default:l(()=>[...s[7]||(s[7]=[x("Contrato",-1)])]),_:1}),y.value?(n(),f("div",Qt,[i("div",Wt,[t(e(Z),{class:"h-4 w-4 text-muted-foreground"}),i("div",null,[i("p",Xt,u(y.value.nombre),1),y.value.proyecto?(n(),f("p",Jt,u(y.value.proyecto.nombre),1)):_("",!0)])]),t(e(I),{type:"button",variant:"ghost",size:"sm",onClick:P},{default:l(()=>[t(e(Y),{class:"h-4 w-4"})]),_:1})])):_("",!0),t(e(I),{type:"button",variant:"outline",onClick:s[0]||(s[0]=B=>M.value=!0),class:T(["w-full",{"border-red-500":(U=a.errors)==null?void 0:U.contrato_id}])},{default:l(()=>[t(e(Z),{class:"h-4 w-4 mr-2"}),x(" "+u(y.value?"Cambiar Contrato":"Seleccionar Contrato"),1)]),_:1},8,["class"]),(c=a.errors)!=null&&c.contrato_id?(n(),z(W,{key:1,message:a.errors.contrato_id[0]},null,8,["message"])):_("",!0),s[8]||(s[8]=i("p",{class:"text-xs text-muted-foreground mt-1"}," Selecciona el contrato al que pertenecerá esta obligación ",-1)),t(Kt,{modelValue:M.value,"onUpdate:modelValue":s[1]||(s[1]=B=>M.value=B),title:"Seleccionar Contrato",description:"Selecciona el contrato para esta obligación","search-endpoint":"/admin/contratos/search",proyectos:a.proyectos,"excluded-ids":y.value?[y.value.id]:[],"max-selection":1,"submit-button-text":"Seleccionar",onSubmit:g},null,8,["modelValue","proyectos","excluded-ids"])])),i("div",null,[t(e(O),{for:"titulo",required:""},{default:l(()=>[...s[9]||(s[9]=[x("Título",-1)])]),_:1}),t(e(pe),{id:"titulo",modelValue:m.value.titulo,"onUpdate:modelValue":s[2]||(s[2]=B=>m.value.titulo=B),type:"text",placeholder:"Título de la obligación",class:T({"border-red-500":(r=a.errors)==null?void 0:r.titulo})},null,8,["modelValue","class"]),(o=a.errors)!=null&&o.titulo?(n(),z(W,{key:0,message:a.errors.titulo[0]},null,8,["message"])):_("",!0)]),i("div",null,[t(e(O),{for:"descripcion"},{default:l(()=>[...s[10]||(s[10]=[x("Descripción",-1)])]),_:1}),t(e(ge),{id:"descripcion",modelValue:m.value.descripcion,"onUpdate:modelValue":s[3]||(s[3]=B=>m.value.descripcion=B),placeholder:"Descripción detallada de la obligación",rows:3,class:T({"border-red-500":(L=a.errors)==null?void 0:L.descripcion})},null,8,["modelValue","class"]),(te=a.errors)!=null&&te.descripcion?(n(),z(W,{key:0,message:a.errors.descripcion[0]},null,8,["message"])):_("",!0)]),a.contratoId||m.value.contrato_id?(n(),f("div",Yt,[t(e(O),{for:"parent_id"},{default:l(()=>[...s[11]||(s[11]=[x("Obligación Padre",-1)])]),_:1}),w.value?(n(),f("div",Zt,[t(e(X),{class:"h-4 w-4 animate-spin"}),s[12]||(s[12]=i("span",{class:"text-sm text-muted-foreground"},"Cargando obligaciones...",-1))])):(n(),z(e(xe),{key:1,modelValue:m.value.parent_id,"onUpdate:modelValue":s[4]||(s[4]=B=>m.value.parent_id=B),disabled:w.value},{default:l(()=>[t(e(be),{id:"parent_id"},{default:l(()=>[t(e(he),{placeholder:"Seleccionar obligación padre (opcional)"})]),_:1}),t(e(_e),null,{default:l(()=>[t(e(re),{value:null},{default:l(()=>[...s[13]||(s[13]=[x("Sin padre (raíz)",-1)])]),_:1}),(n(!0),f(G,null,Q(C.value,B=>{var se;return n(),z(e(re),{key:B.id,value:B.id,disabled:B.id===((se=a.obligacion)==null?void 0:se.id)},{default:l(()=>[x(u("  ".repeat(B.nivel))+u(B.titulo),1)]),_:2},1032,["value","disabled"])}),128))]),_:1})]),_:1},8,["modelValue","disabled"])),(ae=a.errors)!=null&&ae.parent_id?(n(),z(W,{key:2,message:a.errors.parent_id[0]},null,8,["message"])):_("",!0),!w.value&&C.value.length===0?(n(),f("p",ea," Este contrato no tiene obligaciones existentes. La nueva obligación será raíz. ")):_("",!0)])):_("",!0)]}),_:1})]),_:1}),t(e(ne),null,{default:l(()=>[t(e(oe),null,{default:l(()=>[t(e(le),null,{default:l(()=>[...s[14]||(s[14]=[x("Archivos Adjuntos",-1)])]),_:1})]),_:1}),t(e(ie),null,{default:l(()=>[t(pt,{"existing-files":S.value,description:"Formatos: PDF, Word, Excel, Imágenes",multiple:!0,"max-files":20,"max-size-m-b":5,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",onFilesAdded:j,onFileRemoved:H},null,8,["existing-files"])]),_:1})]),_:1}),i("div",ta,[t(e(I),{type:"button",variant:"outline",onClick:s[5]||(s[5]=U=>d.$emit("cancel")),disabled:a.loading},{default:l(()=>[...s[15]||(s[15]=[x(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(e(I),{type:"submit",disabled:a.loading||!m.value.titulo||!m.value.contrato_id},{default:l(()=>[a.loading?(n(),z(e(X),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):_("",!0),x(" "+u(a.obligacion?"Actualizar":"Crear")+" Obligación ",1)]),_:1},8,["disabled"])])],32))}});export{Ia as _};
