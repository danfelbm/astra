import{d as ge,i as d,e as n,f as t,j as f,u as o,w as i,h as u,t as c,F as S,k as F,b as y,c as j,C as Se,r as x,m as M,o as je,p as Ae,g as r,L as Ee,q as ze,n as ue,W as B}from"./app-C_5cw02Z.js";import{_ as Ie}from"./index-CI62N9Wr.js";import{_ as b}from"./createLucideIcon-C1-ueII9.js";import{_ as A,c as E,a as N,b as T}from"./CardTitle.vue_vue_type_script_setup_true_lang-DAYOzAlV.js";import{_ as Ue}from"./Checkbox.vue_vue_type_script_setup_true_lang-Bq3rKK7L.js";import{_ as ce}from"./Input.vue_vue_type_script_setup_true_lang-C5gUJesf.js";import{_ as h}from"./Label.vue_vue_type_script_setup_true_lang-CYE62A-C.js";import{_ as Y,a as ee,b as oe,c as te,d as ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-DDKkZRCS.js";import{_ as Be,a as Fe,b as J,c as K}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-B4-PGocs.js";import{_ as me}from"./Textarea.vue_vue_type_script_setup_true_lang-Co-3n7Dl.js";import{_ as H}from"./DateTimePicker.vue_vue_type_script_setup_true_lang-BqOONwta.js";import{_ as Le}from"./AdminLayout.vue_vue_type_script_setup_true_lang-ED78Rhc6.js";import{L as qe,a as Pe,_ as De}from"./DynamicFormBuilder.vue_vue_type_script_setup_true_lang-BPI619Yi.js";import{_ as Me}from"./CsvImportWizard.vue_vue_type_script_setup_true_lang-JowKZXp2.js";import{_ as Ne}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-CRzRAfNB.js";import{d as Te}from"./debounce-BMmXVQ06.js";import{C as He}from"./circle-alert-42uxDc8m.js";import{U as fe}from"./upload-FBPo8oAA.js";import{P as pe}from"./plus-BM2d_scV.js";import{H as ve}from"./history-BFASW1nt.js";import{S as Re}from"./search-UL9ahvpd.js";import{L as Ge}from"./loader-circle-BjsIhiQ9.js";import{T as Oe}from"./trash-2-DwnF_sXn.js";import{C as We}from"./chevron-left-BlEhQwAO.js";import{C as Ze}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-N-mClcNL.js";import{C as Qe}from"./circle-x-Bs5NhDX1.js";import{C as Xe}from"./circle-check-big-DRHTTQQU.js";import{C as _e}from"./clock-CdnAZlnY.js";import"./index-CLU4nd9N.js";import"./index-BGaiQCRN.js";import"./floating-ui.vue-CALjbug4.js";import"./check-DptbupV_.js";import"./VisuallyHidden-Cpuq_Xq0.js";import"./nullish-CHIgUVhi.js";import"./RovingFocusItem-Dxsh8ePB.js";import"./utils-Brnn4e8c.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BrCjHdDD.js";import"./x-DatYouJm.js";import"./index-D5B37hcc.js";import"./shield-Ba4Iz-u6.js";import"./user-DdKvwohc.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BcNrNItn.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CoylmcPy.js";import"./index--WSTgxKp.js";import"./map-pin-DuTf_XYk.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-NVyhuAa9.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-KuplsxXb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-aiSBZ2hF.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BdTLjYoj.js";import"./users-DICVxpIs.js";import"./vote-Bvqvzywk.js";import"./file-text-lgOJxEf1.js";import"./calendar-DLVOya8g.js";import"./briefcase-0u9Gc93S.js";import"./megaphone-CzG9SCwz.js";import"./user-check-N1K_MHa5.js";import"./external-link-Cb7x8dfs.js";import"./panel-left-CCAcMCiL.js";import"./index-D-782rW0.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-CkTaSq7Y.js";import"./VisuallyHiddenInput-BFiMIe-Y.js";import"./grip-vertical-vOkWyyQ8.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-BBLfbRtU.js";import"./eye-lwBYEHXE.js";import"./git-branch-DL9sHTje.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-CM9ejLzC.js";import"./index-jHDpEhjN.js";const Je={key:0,class:"text-red-500"},Ke={key:0,class:"text-sm text-destructive mt-1"},Ye={key:1,class:"text-xs text-muted-foreground mt-1"},eo=ge({__name:"TimezoneSelector",props:{modelValue:{},disabled:{type:Boolean,default:!1},label:{default:"Zona Horaria"},placeholder:{default:"Seleccionar zona horaria"},description:{default:"Las fechas de apertura y cierre se aplicarán según esta zona horaria"},required:{type:Boolean,default:!1},error:{}},emits:["update:modelValue"],setup(se,{emit:m}){const p=m,R=v=>{p("update:modelValue",v)};return(v,G)=>(n(),d("div",null,[t(o(h),null,{default:i(()=>[u(c(v.label)+" ",1),v.required?(n(),d("span",Je,"*")):f("",!0)]),_:1}),t(o(Y),{"model-value":v.modelValue,"onUpdate:modelValue":R,disabled:v.disabled},{default:i(()=>[t(o(ee),null,{default:i(()=>[t(o(oe),{placeholder:v.placeholder},null,8,["placeholder"])]),_:1}),t(o(te),null,{default:i(()=>[(n(!0),d(S,null,F(o(qe),a=>(n(),y(o(ae),{key:a.value,value:a.value},{default:i(()=>[u(c(a.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"]),v.error?(n(),d("p",Ke,c(v.error),1)):v.description?(n(),d("p",Ye,c(v.description),1)):f("",!0)]))}}),oo={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},to={class:"flex items-center justify-between"},ao={class:"text-3xl font-bold"},so={class:"text-muted-foreground"},io={class:"relative min-h-[70vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border"},lo={class:"grid gap-6 md:grid-cols-2"},ro={class:"space-y-4"},no={key:0,class:"text-sm text-destructive mt-1"},uo={key:0,class:"text-sm text-destructive mt-1"},co={key:0,class:"text-sm text-destructive mt-1"},mo={class:"space-y-4"},fo={key:0,class:"text-sm text-destructive mt-1"},po={key:0,class:"text-sm text-destructive mt-1"},vo={key:1,class:"text-sm text-destructive mt-1"},_o={class:"flex items-center space-x-2"},go={key:0,class:"space-y-2"},bo={key:0,class:"text-sm text-destructive mt-1"},xo={key:0},yo={key:0,class:"text-sm text-destructive mt-1"},ho={class:"flex justify-between"},Vo={class:"flex gap-2"},ko={class:"flex justify-between"},wo={class:"flex gap-2"},Co={class:"flex items-center space-x-2 text-yellow-700"},$o={class:"space-y-4"},So={class:"flex items-center gap-2"},jo={key:0,class:"text-center py-6 text-muted-foreground"},Ao={key:1,class:"space-y-3"},Eo=["onClick"],zo={class:"flex items-center gap-3"},Io={class:"font-medium text-sm"},Uo={class:"text-xs text-muted-foreground"},Bo={class:"flex items-center gap-2"},Fo={key:0,class:"text-xs text-muted-foreground"},Lo={key:0},qo={key:1,class:"text-xs text-muted-foreground"},Po={class:"relative"},Do={key:0,class:"flex items-center justify-center py-8"},Mo={key:1,class:"text-center py-8 text-muted-foreground"},No={key:0},To={key:1},Ho={key:2},Ro={class:"space-y-2 max-h-96 overflow-y-auto"},Go={class:"flex-1 min-w-0"},Oo={class:"font-medium truncate"},Wo={class:"flex items-center gap-4 text-sm text-muted-foreground"},Zo={class:"truncate"},Qo={key:0},Xo={key:1},Jo={key:0,class:"flex items-center justify-between pt-4 border-t"},Ko={class:"text-sm text-muted-foreground"},Yo={class:"flex gap-2"},et={class:"flex justify-between"},va=ge({__name:"Form",props:{categorias:{},votacion:{},cargos:{},periodosElectorales:{},convocatorias:{},canManageVoters:{type:Boolean}},setup(se){var ne,de;const m=se,p=j(()=>!!m.votacion),R=j(()=>{var l;return p.value&&((l=m.votacion)==null?void 0:l.estado)==="borrador"&&m.canManageVoters}),v=[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"},{title:p.value?"Editar":"Crear",href:"#"}],G=()=>{if(!m.votacion)return{titulo:"",descripcion:"",categoria_id:"",fecha_inicio:null,fecha_fin:null,estado:"borrador",resultados_publicos:!1,fecha_publicacion_resultados:null,limite_censo:null,mensaje_limite_censo:"",formulario_config:[],timezone:"America/Bogota",territorios_ids:[],departamentos_ids:[],municipios_ids:[],localidades_ids:[]};const l=m.votacion;return{titulo:l.titulo||"",descripcion:l.descripcion||"",categoria_id:l.categoria_id?String(l.categoria_id):"",fecha_inicio:l.fecha_inicio||null,fecha_fin:l.fecha_fin||null,estado:l.estado||"borrador",resultados_publicos:!!l.resultados_publicos,fecha_publicacion_resultados:l.fecha_publicacion_resultados||null,limite_censo:l.limite_censo||null,mensaje_limite_censo:l.mensaje_limite_censo||"",formulario_config:l.formulario_config||[],timezone:l.timezone||"America/Bogota",territorios_ids:l.territorios_ids||[],departamentos_ids:l.departamentos_ids||[],municipios_ids:l.municipios_ids||[],localidades_ids:l.localidades_ids||[]}},a=Se(G()),k=x("basicos"),be=[{value:"borrador",label:"Borrador"},{value:"activa",label:"Activa"},{value:"finalizada",label:"Finalizada"}],ie=j({get:()=>({territorios_ids:a.territorios_ids||[],departamentos_ids:a.departamentos_ids||[],municipios_ids:a.municipios_ids||[],localidades_ids:a.localidades_ids||[]}),set:l=>{a.territorios_ids=l.territorios_ids,a.departamentos_ids=l.departamentos_ids,a.municipios_ids=l.municipios_ids,a.localidades_ids=l.localidades_ids}}),le=j(()=>!a.fecha_fin||!a.fecha_inicio?"":a.fecha_fin<=a.fecha_inicio?"La fecha de fin debe ser posterior a la fecha de inicio":""),O=()=>{if(!z.value){k.value="basicos",alert('Por favor completa todos los campos requeridos en la pestaña "Datos Básicos" antes de crear la votación.');return}if(a.formulario_config.length===0){alert("Por favor agrega al menos un campo al formulario antes de crear la votación.");return}p.value?a.put(`/admin/votaciones/${m.votacion.id}`,{onError:l=>{const e=Object.values(l)[0];e&&alert(`Error: ${Array.isArray(e)?e[0]:e}`)}}):a.post("/admin/votaciones",{onError:l=>{const e=Object.values(l)[0];e&&alert(`Error: ${Array.isArray(e)?e[0]:e}`)}})},z=j(()=>a.titulo&&a.categoria_id&&a.fecha_inicio&&a.fecha_fin&&a.timezone);j(()=>z.value&&a.formulario_config.length>0);const $=x(((ne=m.votacion)==null?void 0:ne.votantes)||[]),w=x(((de=m.votacion)==null?void 0:de.votantes_total)||0),_=x(1),W=x(50),Z=x(!1),V=x(""),Q=x(1),I=x(!1),L=x(!1),q=x([]),re=async()=>{var l;if(!(!p.value||!((l=m.votacion)!=null&&l.id)))try{const e=await fetch(`/admin/votaciones/${m.votacion.id}/imports/recent`);if(e.ok){const g=await e.json();q.value=g}}catch(e){console.error("Error loading recent imports:",e)}},xe=l=>{B.get(`/admin/imports/${l}`)},ye=()=>{var l;(l=m.votacion)!=null&&l.id&&B.get(`/admin/votaciones/${m.votacion.id}/imports`)},P=l=>{switch(l){case"pending":return{icon:_e,label:"Pendiente",class:"text-yellow-600"};case"processing":return{icon:_e,label:"Procesando",class:"text-blue-600"};case"completed":return{icon:Xe,label:"Completada",class:"text-green-600"};case"failed":return{icon:Qe,label:"Fallida",class:"text-red-600"}}},he=l=>new Date(l).toLocaleString("es-ES",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=async(l=1,e="")=>{var g;if((g=m.votacion)!=null&&g.id){Z.value=!0;try{const s=new URLSearchParams({page:l.toString(),per_page:W.value.toString(),...e&&{query:e}}),D=await(await fetch(`/admin/votaciones/${m.votacion.id}/assigned-voters?${s}`)).json();$.value=D.data||[],w.value=D.total||0,_.value=D.current_page||1,Q.value=D.last_page||1}catch(s){console.error("Error cargando votantes:",s)}finally{Z.value=!1}}},Ve=Te(()=>{_.value=1,U(1,V.value)},300),X=l=>{_.value=l,U(l,V.value)};M(V,()=>{Ve()}),M(()=>k.value,l=>{var e;l==="votantes"&&((e=m.votacion)!=null&&e.id)&&w.value>0&&($.value.length===0||$.value.length<w.value&&$.value.length<=50)&&U()});const ke=l=>{var e;!l.userIds||l.userIds.length===0||!p.value||!((e=m.votacion)!=null&&e.id)||B.post(`/admin/votaciones/${m.votacion.id}/votantes`,{votante_ids:l.userIds.map(g=>g.toString())},{preserveScroll:!0,onSuccess:()=>{w.value+=l.userIds.length,U(_.value,V.value),L.value=!1},onError:g=>{console.error("Error adding votantes:",g),alert("Error al agregar votantes")}})},we=l=>{var e;!p.value||!((e=m.votacion)!=null&&e.id)||B.delete(`/admin/votaciones/${m.votacion.id}/votantes`,{data:{votante_id:l},preserveScroll:!0,onSuccess:()=>{w.value-=1,$.value.length===1&&_.value>1?X(_.value-1):U(_.value,V.value)},onError:g=>{console.error("Error removing votante:",g),alert("Error al remover votante")}})},Ce=l=>{I.value=!1,re(),B.get(`/admin/imports/${l}`)},$e=()=>{I.value=!1};return M(()=>m.votacion,l=>{if(l){const e=G();a.titulo=e.titulo,a.descripcion=e.descripcion,a.categoria_id=e.categoria_id,a.fecha_inicio=e.fecha_inicio,a.fecha_fin=e.fecha_fin,a.estado=e.estado,a.resultados_publicos=e.resultados_publicos,a.fecha_publicacion_resultados=e.fecha_publicacion_resultados,a.formulario_config=e.formulario_config,a.timezone=e.timezone,p.value&&re()}},{immediate:!0,deep:!0}),M(()=>a.resultados_publicos,l=>{console.log("resultados_publicos changed to:",l)},{immediate:!0}),je(()=>{}),(l,e)=>(n(),d(S,null,[t(o(Ae),{title:p.value?"Editar Votación":"Nueva Votación"},null,8,["title"]),t(Le,{breadcrumbs:v},{default:i(()=>{var g;return[r("div",oo,[r("div",to,[r("div",null,[r("h1",ao,c(p.value?"Editar Votación":"Nueva Votación"),1),r("p",so,c(p.value?"Modifica los datos de la votación":"Crea una nueva votación paso a paso"),1)])]),r("div",io,[t(o(A),{class:"border-0 shadow-none h-full"},{default:i(()=>[t(o(E),{class:"p-6"},{default:i(()=>[t(o(Be),{modelValue:k.value,"onUpdate:modelValue":e[22]||(e[22]=s=>k.value=s),class:"w-full"},{default:i(()=>[t(o(Fe),{class:"grid w-full grid-cols-3"},{default:i(()=>[t(o(J),{value:"basicos"},{default:i(()=>[...e[24]||(e[24]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"1"),u(" Datos Básicos ")],-1)])]),_:1}),t(o(J),{value:"formulario",disabled:!p.value&&!z.value},{default:i(()=>[...e[25]||(e[25]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"2"),u(" Formulario ")],-1)])]),_:1},8,["disabled"]),t(o(J),{value:"votantes",disabled:!p.value},{default:i(()=>[...e[26]||(e[26]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"3"),u(" Votantes ")],-1)])]),_:1},8,["disabled"])]),_:1}),t(o(K),{value:"basicos",class:"space-y-6"},{default:i(()=>[r("div",lo,[r("div",ro,[r("div",null,[t(o(h),{for:"titulo"},{default:i(()=>[...e[27]||(e[27]=[u("Título *",-1)])]),_:1}),t(o(ce),{id:"titulo",modelValue:o(a).titulo,"onUpdate:modelValue":e[0]||(e[0]=s=>o(a).titulo=s),placeholder:"Nombre de la votación",error:o(a).errors.titulo},null,8,["modelValue","error"]),o(a).errors.titulo?(n(),d("p",no,c(o(a).errors.titulo),1)):f("",!0)]),r("div",null,[t(o(h),{for:"descripcion"},{default:i(()=>[...e[28]||(e[28]=[u("Descripción",-1)])]),_:1}),t(o(me),{id:"descripcion",modelValue:o(a).descripcion,"onUpdate:modelValue":e[1]||(e[1]=s=>o(a).descripcion=s),placeholder:"Descripción detallada de la votación",rows:"4"},null,8,["modelValue"]),o(a).errors.descripcion?(n(),d("p",uo,c(o(a).errors.descripcion),1)):f("",!0)]),r("div",null,[t(o(h),{for:"categoria"},{default:i(()=>[...e[29]||(e[29]=[u("Categoría *",-1)])]),_:1}),t(o(Y),{modelValue:o(a).categoria_id,"onUpdate:modelValue":e[2]||(e[2]=s=>o(a).categoria_id=s)},{default:i(()=>[t(o(ee),null,{default:i(()=>[t(o(oe),{placeholder:"Seleccionar categoría"})]),_:1}),t(o(te),null,{default:i(()=>[(n(!0),d(S,null,F(l.categorias,s=>(n(),y(o(ae),{key:s.id,value:s.id.toString()},{default:i(()=>[u(c(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),o(a).errors.categoria_id?(n(),d("p",co,c(o(a).errors.categoria_id),1)):f("",!0)]),t(Pe,{modelValue:ie.value,"onUpdate:modelValue":e[3]||(e[3]=s=>ie.value=s)},null,8,["modelValue"])]),r("div",mo,[r("div",null,[t(o(h),{for:"fecha_inicio"},{default:i(()=>[...e[30]||(e[30]=[u("Fecha y Hora de Inicio *",-1)])]),_:1}),t(o(H),{modelValue:o(a).fecha_inicio,"onUpdate:modelValue":e[4]||(e[4]=s=>o(a).fecha_inicio=s),placeholder:"Seleccionar fecha y hora de inicio"},null,8,["modelValue"]),o(a).errors.fecha_inicio?(n(),d("p",fo,c(o(a).errors.fecha_inicio),1)):f("",!0)]),r("div",null,[t(o(h),{for:"fecha_fin"},{default:i(()=>[...e[31]||(e[31]=[u("Fecha y Hora de Fin *",-1)])]),_:1}),t(o(H),{modelValue:o(a).fecha_fin,"onUpdate:modelValue":e[5]||(e[5]=s=>o(a).fecha_fin=s),placeholder:"Seleccionar fecha y hora de fin"},null,8,["modelValue"]),le.value?(n(),d("p",po,c(le.value),1)):f("",!0),o(a).errors.fecha_fin?(n(),d("p",vo,c(o(a).errors.fecha_fin),1)):f("",!0)]),r("div",null,[t(o(h),{for:"estado"},{default:i(()=>[...e[32]||(e[32]=[u("Estado",-1)])]),_:1}),t(o(Y),{modelValue:o(a).estado,"onUpdate:modelValue":e[6]||(e[6]=s=>o(a).estado=s)},{default:i(()=>[t(o(ee),null,{default:i(()=>[t(o(oe))]),_:1}),t(o(te),null,{default:i(()=>[(n(),d(S,null,F(be,s=>t(o(ae),{key:s.value,value:s.value},{default:i(()=>[u(c(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])]),t(eo,{modelValue:o(a).timezone,"onUpdate:modelValue":e[7]||(e[7]=s=>o(a).timezone=s),required:"",error:o(a).errors.timezone},null,8,["modelValue","error"]),r("div",_o,[t(o(Ue),{id:"resultados_publicos",checked:o(a).resultados_publicos,"onUpdate:checked":e[8]||(e[8]=s=>o(a).resultados_publicos=s)},null,8,["checked"]),t(o(h),{for:"resultados_publicos"},{default:i(()=>[...e[33]||(e[33]=[u(" Resultados públicos ",-1)])]),_:1})]),t(Ee,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:i(()=>[o(a).resultados_publicos?(n(),d("div",go,[t(o(h),{for:"fecha_publicacion_resultados"},{default:i(()=>[...e[34]||(e[34]=[u(" Fecha de publicación de resultados (opcional) ",-1)])]),_:1}),t(o(H),{id:"fecha_publicacion_resultados",modelValue:o(a).fecha_publicacion_resultados,"onUpdate:modelValue":e[9]||(e[9]=s=>o(a).fecha_publicacion_resultados=s),placeholder:"Dejar vacío para publicar al finalizar la votación"},null,8,["modelValue"]),e[35]||(e[35]=r("p",{class:"text-xs text-muted-foreground"}," Si se especifica una fecha, los resultados serán visibles desde esa fecha. Si se deja vacío, los resultados solo serán visibles después de que termine la votación. ",-1))])):f("",!0)]),_:1}),r("div",null,[t(o(h),{for:"limite_censo"},{default:i(()=>[...e[36]||(e[36]=[u("Límite del Censo (opcional)",-1)])]),_:1}),t(o(H),{id:"limite_censo",modelValue:o(a).limite_censo,"onUpdate:modelValue":e[10]||(e[10]=s=>o(a).limite_censo=s),placeholder:"Seleccionar fecha límite del censo"},null,8,["modelValue"]),e[37]||(e[37]=r("p",{class:"text-xs text-muted-foreground"}," Fecha de referencia para determinar disponibilidad de la votación según criterios externos como fecha de inscripción. ",-1)),o(a).errors.limite_censo?(n(),d("p",bo,c(o(a).errors.limite_censo),1)):f("",!0)]),o(a).limite_censo?(n(),d("div",xo,[t(o(h),{for:"mensaje_limite_censo"},{default:i(()=>[...e[38]||(e[38]=[u(" Mensaje de notificación sobre límite de censo (opcional) ",-1)])]),_:1}),t(o(me),{id:"mensaje_limite_censo",modelValue:o(a).mensaje_limite_censo,"onUpdate:modelValue":e[11]||(e[11]=s=>o(a).mensaje_limite_censo=s),placeholder:"Mensaje a mostrar cuando un usuario no cumple con el límite del censo",rows:"3",class:"mt-1"},null,8,["modelValue"]),e[39]||(e[39]=r("p",{class:"text-xs text-muted-foreground mt-1"}," Este mensaje se mostrará si un usuario intenta registrarse pero su fecha de inscripción es posterior al límite del censo configurado. ",-1)),o(a).errors.mensaje_limite_censo?(n(),d("p",yo,c(o(a).errors.mensaje_limite_censo),1)):f("",!0)])):f("",!0)])]),r("div",ho,[e[41]||(e[41]=r("div",null,null,-1)),r("div",Vo,[p.value?(n(),y(o(b),{key:0,onClick:O,disabled:o(a).processing||!z.value,variant:"default"},{default:i(()=>[u(c(o(a).processing?"Actualizando...":"Actualizar Votación"),1)]),_:1},8,["disabled"])):f("",!0),t(o(b),{onClick:e[12]||(e[12]=s=>k.value="formulario"),disabled:!z.value,variant:"outline"},{default:i(()=>[...e[40]||(e[40]=[u(" Siguiente: Configurar Formulario ",-1)])]),_:1},8,["disabled"])])])]),_:1}),t(o(K),{value:"formulario",class:"space-y-6"},{default:i(()=>{var s;return[t(De,{modelValue:o(a).formulario_config,"onUpdate:modelValue":e[13]||(e[13]=C=>o(a).formulario_config=C),title:"Constructor de Formulario",description:"Agrega los campos que aparecerán en la votación","show-perfil-candidatura-config":!0,"show-convocatoria-config":!0,cargos:((s=m.cargos)==null?void 0:s.filter(C=>C.es_cargo))||[],"periodos-electorales":m.periodosElectorales||[],convocatorias:m.convocatorias||[],context:"votacion"},null,8,["modelValue","cargos","periodos-electorales","convocatorias"]),r("div",ko,[t(o(b),{variant:"outline",onClick:e[14]||(e[14]=C=>k.value="basicos")},{default:i(()=>[...e[42]||(e[42]=[u(" Anterior ",-1)])]),_:1}),r("div",wo,[R.value&&m.canManageVoters?(n(),y(o(b),{key:0,variant:"outline",onClick:e[15]||(e[15]=C=>k.value="votantes"),disabled:o(a).formulario_config.length===0},{default:i(()=>[...e[43]||(e[43]=[u(" Siguiente: Gestionar Votantes ",-1)])]),_:1},8,["disabled"])):f("",!0),t(o(b),{onClick:O,disabled:o(a).processing||o(a).formulario_config.length===0},{default:i(()=>[u(c(o(a).processing?"Guardando...":p.value?"Actualizar":"Crear")+" Votación ",1)]),_:1},8,["disabled"])])])]}),_:1}),t(o(K),{value:"votantes",class:"space-y-6"},{default:i(()=>[e[62]||(e[62]=r("div",null,[r("h3",{class:"text-lg font-semibold"},"Gestión de Votantes"),r("p",{class:"text-sm text-muted-foreground"}," Asigna los usuarios que podrán participar en esta votación ")],-1)),m.canManageVoters?f("",!0):(n(),y(o(A),{key:0,class:"border-yellow-200 bg-yellow-50"},{default:i(()=>[t(o(E),{class:"pt-6"},{default:i(()=>[r("div",Co,[t(o(He),{class:"h-5 w-5"}),e[44]||(e[44]=r("p",{class:"font-semibold"},"Sin permisos para manejar censo electoral",-1))]),e[45]||(e[45]=r("p",{class:"mt-2 text-sm text-gray-600"}," No tienes los permisos necesarios para gestionar el censo electoral de esta votación. Contacta a un administrador si necesitas acceso a esta funcionalidad. ",-1))]),_:1})]),_:1})),m.canManageVoters?(n(),d(S,{key:1},[I.value?f("",!0):(n(),y(o(A),{key:0},{default:i(()=>[t(o(N),null,{default:i(()=>[t(o(T),{class:"flex items-center gap-2"},{default:i(()=>[t(o(fe),{class:"h-5 w-5"}),e[46]||(e[46]=u(" Importar Votantes ",-1))]),_:1})]),_:1}),t(o(E),null,{default:i(()=>[r("div",$o,[e[48]||(e[48]=r("p",{class:"text-sm text-muted-foreground"}," Importa votantes desde un archivo CSV con mapeo dinámico de campos. Los usuarios importados serán asignados automáticamente a esta votación. ",-1)),e[49]||(e[49]=r("p",{class:"text-sm text-blue-600"},[r("a",{href:"/ejemplo-usuarios.csv",download:"",class:"underline"}," 📥 Descargar plantilla CSV de ejemplo ")],-1)),t(o(b),{variant:"outline",onClick:e[16]||(e[16]=s=>I.value=!0)},{default:i(()=>[t(o(fe),{class:"mr-2 h-4 w-4"}),e[47]||(e[47]=u(" Iniciar Importación ",-1))]),_:1})])]),_:1})]),_:1})),I.value&&p.value&&l.votacion?(n(),y(Me,{key:1,mode:"votacion","votacion-id":l.votacion.id,"votacion-titulo":l.votacion.titulo,"redirect-on-success":!1,onSuccess:Ce,onCancel:$e},null,8,["votacion-id","votacion-titulo"])):f("",!0),p.value?(n(),y(o(A),{key:2},{default:i(()=>[t(o(N),null,{default:i(()=>[t(o(T),{class:"flex items-center gap-2"},{default:i(()=>[t(o(pe),{class:"h-5 w-5"}),e[50]||(e[50]=u(" Agregar Votantes ",-1))]),_:1})]),_:1}),t(o(E),null,{default:i(()=>[t(o(b),{onClick:e[17]||(e[17]=s=>L.value=!0),class:"w-full",variant:"outline"},{default:i(()=>[t(o(pe),{class:"h-4 w-4 mr-2"}),e[51]||(e[51]=u(" Buscar y Añadir Votantes ",-1))]),_:1}),e[52]||(e[52]=r("p",{class:"text-sm text-muted-foreground mt-2"}," Busca usuarios por nombre, email, documento o teléfono ",-1))]),_:1})]),_:1})):f("",!0),p.value?(n(),y(o(A),{key:3},{default:i(()=>[t(o(N),null,{default:i(()=>[t(o(T),{class:"flex items-center justify-between"},{default:i(()=>[r("span",So,[t(o(ve),{class:"h-5 w-5"}),e[53]||(e[53]=u(" Historial de Importaciones ",-1))]),q.value.length>0?(n(),y(o(b),{key:0,variant:"outline",size:"sm",onClick:ye},{default:i(()=>[...e[54]||(e[54]=[u(" Ver Todas ",-1)])]),_:1})):f("",!0)]),_:1})]),_:1}),t(o(E),null,{default:i(()=>[q.value.length===0?(n(),d("div",jo,[t(o(ve),{class:"mx-auto h-8 w-8 mb-2"}),e[55]||(e[55]=r("p",null,"No hay importaciones registradas",-1)),e[56]||(e[56]=r("p",{class:"text-sm"},"Las importaciones aparecerán aquí una vez que subas archivos CSV",-1))])):(n(),d("div",Ao,[(n(!0),d(S,null,F(q.value,s=>(n(),d("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:C=>xe(s.id)},[r("div",zo,[(n(),y(ze(P(s.status).icon),{class:ue(["h-4 w-4",P(s.status).class])},null,8,["class"])),r("div",null,[r("p",Io,c(s.original_filename),1),r("p",Uo," Por "+c(s.created_by.name)+" • "+c(he(s.created_at)),1)])]),r("div",Bo,[t(o(Ie),{variant:"outline",class:ue(P(s.status).class)},{default:i(()=>[u(c(P(s.status).label),1)]),_:2},1032,["class"]),s.status==="completed"?(n(),d("div",Fo,[u(c(s.successful_rows)+" exitosos ",1),s.failed_rows>0?(n(),d("span",Lo,", "+c(s.failed_rows)+" errores",1)):f("",!0)])):s.status==="processing"?(n(),d("div",qo,c(s.progress_percentage)+"% ",1)):f("",!0)])],8,Eo))),128))]))]),_:1})]),_:1})):f("",!0),t(o(A),null,{default:i(()=>[t(o(N),null,{default:i(()=>[t(o(T),null,{default:i(()=>[u("Votantes Asignados ("+c(w.value)+")",1)]),_:1})]),_:1}),t(o(E),{class:"space-y-4"},{default:i(()=>[r("div",Po,[t(o(Re),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t(o(ce),{modelValue:V.value,"onUpdate:modelValue":e[18]||(e[18]=s=>V.value=s),type:"text",placeholder:"Buscar por nombre, email, documento o teléfono...",class:"pl-10"},null,8,["modelValue"])]),Z.value?(n(),d("div",Do,[t(o(Ge),{class:"h-8 w-8 animate-spin text-muted-foreground"}),e[57]||(e[57]=r("span",{class:"ml-2 text-muted-foreground"},"Cargando votantes...",-1))])):$.value.length===0?(n(),d("div",Mo,[V.value?(n(),d("p",No,'No se encontraron votantes que coincidan con "'+c(V.value)+'"',1)):(n(),d("p",To,"No hay votantes asignados a esta votación")),e[58]||(e[58]=r("p",{class:"text-sm"},"Importa un archivo CSV o agrega votantes manualmente",-1))])):(n(),d("div",Ho,[r("div",Ro,[(n(!0),d(S,null,F($.value,s=>(n(),d("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50"},[r("div",Go,[r("p",Oo,c(s.name),1),r("div",Wo,[r("span",Zo,c(s.email),1),s.documento_identidad?(n(),d("span",Qo,"Doc: "+c(s.documento_identidad),1)):f("",!0),s.telefono?(n(),d("span",Xo,"Tel: "+c(s.telefono),1)):f("",!0)])]),t(o(b),{variant:"ghost",size:"sm",onClick:C=>we(s.id)},{default:i(()=>[t(o(Oe),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"])]))),128))]),Q.value>1?(n(),d("div",Jo,[r("div",Ko," Mostrando "+c((_.value-1)*W.value+1)+" - "+c(Math.min(_.value*W.value,w.value))+" de "+c(w.value)+" votantes ",1),r("div",Yo,[t(o(b),{variant:"outline",size:"sm",disabled:_.value===1,onClick:e[19]||(e[19]=s=>X(_.value-1))},{default:i(()=>[t(o(We),{class:"h-4 w-4"}),e[59]||(e[59]=u(" Anterior ",-1))]),_:1},8,["disabled"]),t(o(b),{variant:"outline",size:"sm",disabled:_.value===Q.value,onClick:e[20]||(e[20]=s=>X(_.value+1))},{default:i(()=>[e[60]||(e[60]=u(" Siguiente ",-1)),t(o(Ze),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])):f("",!0)]))]),_:1})]),_:1}),r("div",et,[t(o(b),{variant:"outline",onClick:e[21]||(e[21]=s=>k.value="formulario")},{default:i(()=>[...e[61]||(e[61]=[u(" Anterior ",-1)])]),_:1}),t(o(b),{onClick:O,disabled:o(a).processing},{default:i(()=>[u(c(o(a).processing?"Guardando...":"Actualizar")+" Votación ",1)]),_:1},8,["disabled"])])],64)):f("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),t(Ne,{modelValue:L.value,"onUpdate:modelValue":e[23]||(e[23]=s=>L.value=s),title:"Añadir Votantes",description:"Selecciona los usuarios que deseas añadir como votantes de esta votación","search-endpoint":`/admin/votaciones/${(g=m.votacion)==null?void 0:g.id}/search-users`,"search-placeholder":"Buscar por nombre, email, documento o teléfono...","submit-button-text":"Añadir Votantes","empty-message":"Escribe para buscar usuarios disponibles","no-results-message":"No se encontraron usuarios con esa búsqueda",onSubmit:ke},null,8,["modelValue","search-endpoint"])]}),_:1})],64))}});export{va as default};
