import{d as re,c as f,k as g,C as ae,w as oe,p as te,a as u,o as c,b as t,u as r,m as ie,e as s,f as l,t as n,g as d,h as se,i as m,n as v,F,r as G,j as R}from"./app-o0VcnfvT.js";import{_ as U}from"./createLucideIcon-DHV2dMd2.js";import{_ as le,a as ne,b as de,c as ce}from"./CardTitle.vue_vue_type_script_setup_true_lang-B83fxqkD.js";import{_ as ue}from"./Checkbox.vue_vue_type_script_setup_true_lang-BeC7HuLp.js";import{_ as me}from"./Input.vue_vue_type_script_setup_true_lang-WPXtkr_n.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-BzEX51rz.js";import{_ as T,a as A,b as j,c as P,d as x}from"./SelectValue.vue_vue_type_script_setup_true_lang-BKOHoo5T.js";import{_ as pe,a as fe,b as H,c as O}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-ByrEHfPa.js";import{_ as _e}from"./Textarea.vue_vue_type_script_setup_true_lang-BiO7vH4G.js";import{_ as J}from"./DateTimePicker.vue_vue_type_script_setup_true_lang-CIVrWGNw.js";import{a as ve,_ as he}from"./DynamicFormBuilder.vue_vue_type_script_setup_true_lang-Cgs8tun_.js";import{_ as ge}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DH_sKY2C.js";import{A as be}from"./arrow-left-DdTyrpmI.js";import{M as xe}from"./megaphone-Dj1OROVd.js";import{S as ye}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BQLGFJn7.js";import{C as K}from"./calendar-DcMtuu5p.js";import{C as Ce}from"./clock-C1fP0aO7.js";import{U as $e}from"./users-C6pYsYmu.js";import"./index-CQK0tQuB.js";import"./floating-ui.vue-B7OURiaf.js";import"./check-K7jA5jiq.js";import"./index-DzXh5xdq.js";import"./VisuallyHidden-CvCQINmH.js";import"./PopperContent-CuoIICBD.js";import"./nullish-CHIgUVhi.js";import"./RovingFocusItem-CT7DNy83.js";import"./utils-BAKO7Pan.js";import"./index-Djr-AE8L.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Dmnh2j6A.js";import"./VisuallyHiddenInput-C-FbGfIN.js";import"./plus-DY78Hq4y.js";import"./grip-vertical-C_h0oCLT.js";import"./trash-2-D5Vn7H2C.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-DsA6hK1m.js";import"./circle-alert-E7ND0NcF.js";import"./eye-BxbWlq06.js";import"./x-Bk6mROj6.js";import"./git-branch-DrF3qNG0.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-wJtPPtPO.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-C4Px9OO6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Bx2c5sC2.js";import"./chevrons-up-down-BjWNjkHI.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-dEcN0GvJ.js";import"./shield-B8n_8DBi.js";import"./vote-TfssO0t8.js";import"./file-text-B3ELD67O.js";import"./briefcase-_GQULPTE.js";import"./user-check-BUfceOdp.js";import"./external-link-CWutwPXI.js";import"./panel-left-DwF_86xt.js";import"./index-K2vy_Ox9.js";import"./index-B9BCn2_n.js";import"./user-CwkVrL5s.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DdTTQIRe.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-C-jvWsF7.js";import"./map-pin-D0bJVCbX.js";const we={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ve={class:"flex items-center justify-between"},De={class:"text-3xl font-bold"},ke={class:"text-muted-foreground"},Ee={class:"grid gap-6 md:grid-cols-2"},Ne={class:"space-y-4"},Se={key:0,class:"text-sm text-destructive mt-1"},Fe={key:0,class:"text-sm text-destructive mt-1"},Ue={key:0,class:"text-sm text-destructive mt-1"},Te={class:"flex items-center space-x-2"},Ae={class:"space-y-4"},je={key:0,class:"text-sm text-destructive mt-1"},Pe={key:1,class:"text-sm text-destructive mt-1"},Me={key:0,class:"text-sm text-destructive mt-1"},qe={key:1,class:"text-sm text-destructive mt-1"},Be={key:2,class:"text-sm text-destructive mt-1"},Ie={key:0,class:"text-sm text-destructive mt-1"},Le={key:0,class:"text-sm text-destructive mt-1"},ze={key:0,class:"p-4 bg-blue-50 rounded-lg border border-blue-200"},Ge={class:"mt-2 space-y-2"},Re={class:"flex items-center gap-2 text-blue-700"},He={class:"font-medium"},Oe={class:"font-medium"},Je={key:0,class:"flex items-center gap-2 text-blue-600"},Ke={key:1,class:"flex items-center gap-2 text-blue-600"},Qe={key:2,class:"flex items-center gap-2 text-blue-600"},We={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg"},Xe={class:"text-red-800 text-sm"},Ye={class:"flex justify-between mt-8"},oa=re({__name:"Form",props:{convocatoria:{}},setup(Q){const y=Q,_=f(()=>!!y.convocatoria),W=[{title:"Admin",href:"/admin/dashboard"},{title:"Convocatorias",href:"/admin/convocatorias"},{title:_.value?"Editar":"Crear",href:"#"}],M=g("general"),D=g([]),C=g([]),k=g(!1),E=g(!1),e=ae((()=>{if(!y.convocatoria)return{nombre:"",descripcion:"",fecha_apertura:null,fecha_cierre:null,cargo_id:null,periodo_electoral_id:null,territorio_id:null,departamento_id:null,municipio_id:null,localidad_id:null,formulario_postulacion:[],estado:"borrador",activo:!0};const o=y.convocatoria;return{nombre:o.nombre||"",descripcion:o.descripcion||"",fecha_apertura:o.fecha_apertura?new Date(o.fecha_apertura):null,fecha_cierre:o.fecha_cierre?new Date(o.fecha_cierre):null,cargo_id:o.cargo_id||null,periodo_electoral_id:o.periodo_electoral_id||null,territorio_id:o.territorio_id||null,departamento_id:o.departamento_id||null,municipio_id:o.municipio_id||null,localidad_id:o.localidad_id||null,formulario_postulacion:o.formulario_postulacion||[],estado:o.estado||"borrador",activo:o.activo}})()),N=g({territorios_ids:e.territorio_id?[e.territorio_id]:[],departamentos_ids:e.departamento_id?[e.departamento_id]:[],municipios_ids:e.municipio_id?[e.municipio_id]:[],localidades_ids:e.localidad_id?[e.localidad_id]:[]});oe(N,o=>{e.territorio_id=o.territorios_ids[0]||null,e.departamento_id=o.departamentos_ids[0]||null,e.municipio_id=o.municipios_ids[0]||null,e.localidad_id=o.localidades_ids[0]||null},{deep:!0}),te(async()=>{await Promise.all([X(),Y()])});const X=async()=>{try{k.value=!0;const o=await fetch("/admin/cargos-for-convocatorias");D.value=await o.json()}catch(o){console.error("Error loading cargos:",o)}finally{k.value=!1}},Y=async()=>{try{E.value=!0;const o=await fetch("/admin/periodos-disponibles");C.value=await o.json()}catch(o){console.error("Error loading periodos:",o)}finally{E.value=!1}},Z=()=>{_.value?e.put(`/admin/convocatorias/${y.convocatoria.id}`,{onError:o=>{console.error("Errores de validación:",o)}}):e.post("/admin/convocatorias",{onError:o=>{console.error("Errores de validación:",o)}})},$=f(()=>{if(!e.fecha_apertura)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura);return isNaN(o.getTime())?"Fecha de apertura inválida":""}),w=f(()=>{if(!e.fecha_cierre||!e.fecha_apertura)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),a=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre);return isNaN(o.getTime())||isNaN(a.getTime())?"Fechas inválidas":a<=o?"La fecha de cierre debe ser posterior a la fecha de apertura":""}),S=f(()=>{if(!e.fecha_apertura||!e.fecha_cierre||!e.periodo_electoral_id)return"";const o=C.value.find(V=>V.id===e.periodo_electoral_id);if(!o)return"";const a=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),i=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre),b=new Date(o.fecha_inicio),h=new Date(o.fecha_fin);return a<b||a>h||i<b||i>h?"Las fechas deben estar dentro del periodo electoral seleccionado":""}),q=f(()=>{if(!e.fecha_apertura||!e.fecha_cierre)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),a=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre);if(isNaN(o.getTime())||isNaN(a.getTime()))return"";const i=Math.ceil((a.getTime()-o.getTime())/(1e3*60*60*24));if(i<0)return"";if(i<1){const z=Math.ceil((a.getTime()-o.getTime())/36e5);return`${z} hora${z!==1?"s":""}`}if(i<30)return`${i} día${i!==1?"s":""}`;const b=Math.floor(i/30),h=i%30;let V=`${b} mes${b!==1?"es":""}`;return h>0&&(V+=` y ${h} día${h!==1?"s":""}`),V}),ee=f(()=>e.nombre.trim().length>0&&e.fecha_apertura&&e.fecha_cierre&&e.cargo_id&&e.periodo_electoral_id&&!$.value&&!w.value&&!S.value),B=o=>{if(!o)return"";const a=o instanceof Date?o:new Date(o);return isNaN(a.getTime())?"":a.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},I=f(()=>e.cargo_id?D.value.find(o=>o.id===e.cargo_id):null),L=f(()=>e.periodo_electoral_id?C.value.find(o=>o.id===e.periodo_electoral_id):null);return(o,a)=>(c(),u(F,null,[t(r(ie),{title:_.value?"Editar Convocatoria":"Nueva Convocatoria"},null,8,["title"]),t(ge,{breadcrumbs:W},{default:s(()=>[l("div",we,[l("div",Ve,[l("div",null,[l("h1",De,n(_.value?"Editar Convocatoria":"Nueva Convocatoria"),1),l("p",ke,n(_.value?"Modifica los datos de la convocatoria electoral":"Crea una nueva convocatoria con formulario de postulación personalizado"),1)]),t(r(U),{variant:"outline",onClick:a[0]||(a[0]=i=>o.$inertia.visit("/admin/convocatorias"))},{default:s(()=>[t(r(be),{class:"mr-2 h-4 w-4"}),a[13]||(a[13]=d(" Volver ",-1))]),_:1})]),t(r(le),null,{default:s(()=>[t(r(ne),null,{default:s(()=>[t(r(de),null,{default:s(()=>[d(n(_.value?"Datos de la Convocatoria":"Información de la Nueva Convocatoria"),1)]),_:1})]),_:1}),t(r(ce),null,{default:s(()=>[l("form",{onSubmit:se(Z,["prevent"])},[t(r(pe),{modelValue:M.value,"onUpdate:modelValue":a[11]||(a[11]=i=>M.value=i),class:"w-full"},{default:s(()=>[t(r(fe),{class:"grid w-full grid-cols-2"},{default:s(()=>[t(r(H),{value:"general",class:"flex items-center gap-2"},{default:s(()=>[t(r(xe),{class:"h-4 w-4"}),a[14]||(a[14]=d(" Información General ",-1))]),_:1}),t(r(H),{value:"formulario",class:"flex items-center gap-2"},{default:s(()=>[t(r(ye),{class:"h-4 w-4"}),a[15]||(a[15]=d(" Formulario de Postulación ",-1))]),_:1})]),_:1}),t(r(O),{value:"general",class:"space-y-6"},{default:s(()=>[l("div",Ee,[l("div",Ne,[l("div",null,[t(r(p),{for:"nombre"},{default:s(()=>[...a[16]||(a[16]=[d("Nombre de la Convocatoria *",-1)])]),_:1}),t(r(me),{id:"nombre",modelValue:r(e).nombre,"onUpdate:modelValue":a[1]||(a[1]=i=>r(e).nombre=i),placeholder:"Ej: Elección Alcalde 2024, Postulación Senado...",class:v({"border-destructive":r(e).errors.nombre})},null,8,["modelValue","class"]),r(e).errors.nombre?(c(),u("p",Se,n(r(e).errors.nombre),1)):m("",!0)]),l("div",null,[t(r(p),{for:"descripcion"},{default:s(()=>[...a[17]||(a[17]=[d("Descripción (opcional)",-1)])]),_:1}),t(r(_e),{id:"descripcion",modelValue:r(e).descripcion,"onUpdate:modelValue":a[2]||(a[2]=i=>r(e).descripcion=i),placeholder:"Descripción detallada de la convocatoria...",rows:"4",class:v({"border-destructive":r(e).errors.descripcion})},null,8,["modelValue","class"]),r(e).errors.descripcion?(c(),u("p",Fe,n(r(e).errors.descripcion),1)):m("",!0)]),l("div",null,[t(r(p),{for:"estado"},{default:s(()=>[...a[18]||(a[18]=[d("Estado *",-1)])]),_:1}),t(r(T),{modelValue:r(e).estado,"onUpdate:modelValue":a[3]||(a[3]=i=>r(e).estado=i)},{default:s(()=>[t(r(A),{class:v({"border-destructive":r(e).errors.estado})},{default:s(()=>[t(r(j),{placeholder:"Seleccionar estado"})]),_:1},8,["class"]),t(r(P),null,{default:s(()=>[t(r(x),{value:"borrador"},{default:s(()=>[...a[19]||(a[19]=[d("Borrador",-1)])]),_:1}),t(r(x),{value:"activa"},{default:s(()=>[...a[20]||(a[20]=[d("Activa",-1)])]),_:1}),t(r(x),{value:"cerrada"},{default:s(()=>[...a[21]||(a[21]=[d("Cerrada",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(e).errors.estado?(c(),u("p",Ue,n(r(e).errors.estado),1)):m("",!0)]),l("div",Te,[t(r(ue),{id:"activo",checked:r(e).activo,"onUpdate:checked":a[4]||(a[4]=i=>r(e).activo=i)},null,8,["checked"]),t(r(p),{for:"activo"},{default:s(()=>[...a[22]||(a[22]=[d(" Convocatoria activa ",-1)])]),_:1})]),a[23]||(a[23]=l("p",{class:"text-xs text-muted-foreground"}," Solo las convocatorias activas pueden recibir postulaciones. ",-1))]),l("div",Ae,[l("div",null,[t(r(p),{for:"fecha_apertura"},{default:s(()=>[...a[24]||(a[24]=[d("Fecha y Hora de Apertura *",-1)])]),_:1}),t(r(J),{id:"fecha_apertura",modelValue:r(e).fecha_apertura,"onUpdate:modelValue":a[5]||(a[5]=i=>r(e).fecha_apertura=i),placeholder:"Seleccionar fecha y hora de apertura",class:v({"border-destructive":r(e).errors.fecha_apertura||$.value})},null,8,["modelValue","class"]),$.value?(c(),u("p",je,n($.value),1)):m("",!0),r(e).errors.fecha_apertura?(c(),u("p",Pe,n(r(e).errors.fecha_apertura),1)):m("",!0)]),l("div",null,[t(r(p),{for:"fecha_cierre"},{default:s(()=>[...a[25]||(a[25]=[d("Fecha y Hora de Cierre *",-1)])]),_:1}),t(r(J),{id:"fecha_cierre",modelValue:r(e).fecha_cierre,"onUpdate:modelValue":a[6]||(a[6]=i=>r(e).fecha_cierre=i),placeholder:"Seleccionar fecha y hora de cierre",class:v({"border-destructive":r(e).errors.fecha_cierre||w.value})},null,8,["modelValue","class"]),w.value?(c(),u("p",Me,n(w.value),1)):m("",!0),r(e).errors.fecha_cierre?(c(),u("p",qe,n(r(e).errors.fecha_cierre),1)):m("",!0),S.value?(c(),u("p",Be,n(S.value),1)):m("",!0)]),l("div",null,[t(r(p),{for:"cargo_id"},{default:s(()=>[...a[26]||(a[26]=[d("Cargo *",-1)])]),_:1}),t(r(T),{modelValue:r(e).cargo_id,"onUpdate:modelValue":a[7]||(a[7]=i=>r(e).cargo_id=i)},{default:s(()=>[t(r(A),{class:v({"border-destructive":r(e).errors.cargo_id})},{default:s(()=>[t(r(j),{placeholder:k.value?"Cargando cargos...":"Seleccionar cargo"},null,8,["placeholder"])]),_:1},8,["class"]),t(r(P),null,{default:s(()=>[(c(!0),u(F,null,G(D.value,i=>(c(),R(r(x),{key:i.id,value:i.id},{default:s(()=>[d(n(i.ruta_jerarquica),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),r(e).errors.cargo_id?(c(),u("p",Ie,n(r(e).errors.cargo_id),1)):m("",!0)]),l("div",null,[t(r(p),{for:"periodo_electoral_id"},{default:s(()=>[...a[27]||(a[27]=[d("Periodo Electoral *",-1)])]),_:1}),t(r(T),{modelValue:r(e).periodo_electoral_id,"onUpdate:modelValue":a[8]||(a[8]=i=>r(e).periodo_electoral_id=i)},{default:s(()=>[t(r(A),{class:v({"border-destructive":r(e).errors.periodo_electoral_id})},{default:s(()=>[t(r(j),{placeholder:E.value?"Cargando periodos...":"Seleccionar periodo"},null,8,["placeholder"])]),_:1},8,["class"]),t(r(P),null,{default:s(()=>[(c(!0),u(F,null,G(C.value,i=>(c(),R(r(x),{key:i.id,value:i.id},{default:s(()=>[d(n(i.nombre)+" ("+n(i.estado_label)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),r(e).errors.periodo_electoral_id?(c(),u("p",Le,n(r(e).errors.periodo_electoral_id),1)):m("",!0)])])]),t(ve,{modelValue:N.value,"onUpdate:modelValue":a[9]||(a[9]=i=>N.value=i),title:"Restricciones Geográficas (Opcional)",description:"Define las regiones donde estará disponible esta convocatoria. Si no seleccionas nada, estará disponible nacionalmente."},null,8,["modelValue"]),r(e).fecha_apertura&&r(e).fecha_cierre?(c(),u("div",ze,[t(r(p),{class:"text-blue-800 font-medium"},{default:s(()=>[...a[28]||(a[28]=[d("Vista previa de la convocatoria:",-1)])]),_:1}),l("div",Ge,[l("div",Re,[t(r(K),{class:"h-4 w-4"}),l("span",He,n(B(r(e).fecha_apertura)),1),a[29]||(a[29]=l("span",{class:"text-blue-500"},"→",-1)),l("span",Oe,n(B(r(e).fecha_cierre)),1)]),q.value?(c(),u("div",Je,[t(r(Ce),{class:"h-4 w-4"}),l("span",null,"Duración: "+n(q.value),1)])):m("",!0),I.value?(c(),u("div",Ke,[t(r($e),{class:"h-4 w-4"}),l("span",null,"Cargo: "+n(I.value.ruta_jerarquica),1)])):m("",!0),L.value?(c(),u("div",Qe,[t(r(K),{class:"h-4 w-4"}),l("span",null,"Periodo: "+n(L.value.nombre),1)])):m("",!0)])])):m("",!0)]),_:1}),t(r(O),{value:"formulario",class:"space-y-6"},{default:s(()=>[t(he,{modelValue:r(e).formulario_postulacion,"onUpdate:modelValue":a[10]||(a[10]=i=>r(e).formulario_postulacion=i),title:"Formulario de Postulación",description:"Define los campos que deberán completar los postulantes. Estos campos se mostrarán además de la información básica requerida."},null,8,["modelValue"]),a[30]||(a[30]=l("div",{class:"p-4 bg-yellow-50 rounded-lg border border-yellow-200"},[l("p",{class:"text-yellow-800 text-sm"},[l("strong",null,"Nota:"),d(' En el futuro, aquí también podrás agregar un campo especial "Perfil de Candidatura" que permitirá a los usuarios vincular sus perfiles de candidatura aprobados a sus postulaciones. ')])],-1))]),_:1})]),_:1},8,["modelValue"]),r(e).errors.delete?(c(),u("div",We,[l("p",Xe,n(r(e).errors.delete),1)])):m("",!0),l("div",Ye,[t(r(U),{variant:"outline",type:"button",onClick:a[12]||(a[12]=i=>o.$inertia.visit("/admin/convocatorias"))},{default:s(()=>[...a[31]||(a[31]=[d(" Cancelar ",-1)])]),_:1}),t(r(U),{type:"submit",disabled:r(e).processing||!ee.value},{default:s(()=>[d(n(r(e).processing?"Guardando...":_.value?"Actualizar":"Crear")+" Convocatoria ",1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})])]),_:1})],64))}});export{oa as default};
