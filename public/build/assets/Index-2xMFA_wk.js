import{d as ie,r as A,c as M,i as b,e as t,w as s,f as e,b as h,j as _,h as i,F as R,k as G,g as l,m as o,l as ve,t as v,x as ge,y as he,s as j,p as _e,v as re}from"./app-BzLc-tQg.js";import{_ as xe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-ChbgdWaI.js";import{_ as H,b as X,a as J,c as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-CPz0xz5d.js";import{c as ye,_ as C}from"./createLucideIcon-nkJGOa1V.js";import{_ as be}from"./Progress.vue_vue_type_script_setup_true_lang-BePWkOZL.js";import{u as $e}from"./useToast-Vwtf1Nw3.js";import{l as ke}from"./lodash-DvIrl_9q.js";import{a as Ce,b as ee,c as T,d as we,e as B,_ as Ee}from"./TableHeader.vue_vue_type_script_setup_true_lang-XASjBCre.js";import{_ as de}from"./Checkbox.vue_vue_type_script_setup_true_lang-yyM7rku3.js";import{_ as W}from"./index-Bo3A_0mn.js";import{_ as Ve,a as De,b as Pe}from"./index-D89T0Fcq.js";import{_ as Se}from"./StatusChangeModal.vue_vue_type_script_setup_true_lang-C5DiwLHq.js";import{C as ne}from"./circle-alert-Dq1mOb6f.js";import{E as Be}from"./eye-Dop9EAD9.js";import{S as Te}from"./square-pen-DH-b2dhS.js";import{C as ce}from"./clock-DnGNqUb-.js";import{C as me}from"./circle-check-qew5K_y-.js";import{T as Fe}from"./trash-2-BppAmH8-.js";import{C as ze}from"./calendar-CB0qFUZA.js";import{U as je}from"./users-Br0fZ1Es.js";import{e as Ie,C as Ue,_ as te,a as se,b as ae,c as le,d as q}from"./SelectValue.vue_vue_type_script_setup_true_lang-Y0Qcgjp4.js";import{_ as I}from"./Label.vue_vue_type_script_setup_true_lang-BjgtvCVB.js";import{_ as oe}from"./Input.vue_vue_type_script_setup_true_lang-DTRfhza_.js";import{F as ue}from"./filter-BwxCceUj.js";import{X as U}from"./x-DdsH7TCU.js";import{S as Ae}from"./search-DfMR9YBk.js";import{A as Me}from"./arrow-left-BhJ8vFq6.js";import{P as Re}from"./plus-DOx7i78g.js";import{T as Le}from"./target-BO3Y90CO.js";import"./useFlashMessages-Dw-HwlHg.js";import"./index-AgVOZ8eP.js";import"./floating-ui.vue-DUxfyQ_L.js";import"./shield-C79KZ0nY.js";import"./user-BFFvCTt8.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BUnuDXd3.js";import"./chevron-right-B34UR9y-.js";import"./house-Daoh9OCb.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-4wm8HRfm.js";import"./VisuallyHidden-S7vDOIVf.js";import"./index-CCSck0_G.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Cxs9XUkx.js";import"./index-CfZGc3PZ.js";import"./map-pin-BRVzjf8X.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CRgP8lbV.js";import"./chevrons-up-down-BUYuGMIZ.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BgR__W4n.js";import"./folder-CRPL3TkO.js";import"./vote-DZJZZbFM.js";import"./folder-open-BtqoHfmN.js";import"./send-DJKvmV2f.js";import"./file-text-3ulixKQ0.js";import"./briefcase-CefY90Al.js";import"./megaphone-DipUhsgN.js";import"./user-check-BWcZQvO1.js";import"./clipboard-list-bjFGyYiu.js";import"./mail-D7ZVZ15V.js";import"./message-square-CoIUUq4D.js";import"./external-link-C60ZUVkZ.js";import"./panel-left-Bouruxsj.js";import"./check-CxiEgnjV.js";import"./index-Bru-vN3Y.js";import"./Switch.vue_vue_type_script_setup_true_lang-DGkXIEvx.js";import"./VisuallyHiddenInput-DTgLH51-.js";import"./ComentarioContextoInput.vue_vue_type_script_setup_true_lang-CtyH08Gj.js";import"./RichTextEditor-ChH2VqK1.js";import"./italic-DAK08LPT.js";import"./list-C-untRxk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FileUploadField.vue_vue_type_script_setup_true_lang-yNlBZELD.js";import"./useFileUpload-T6CHPVnE.js";import"./upload-Cq9TJEmp.js";import"./file-Docyu542.js";import"./download-BE-i-EIw.js";import"./paperclip-yy2gFan3.js";import"./circle-x-D5FFP1Tg.js";import"./circle-check-big-DY7Anyd5.js";import"./loader-circle-Bn2zvo43.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=ye("CircleDotIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),qe={class:"font-medium"},He={key:0,class:"text-sm text-muted-foreground"},Oe={key:1,class:"flex items-center gap-1 mt-1"},Ge={class:"text-xs text-red-600"},Xe={key:2,class:"flex items-center gap-1 mt-1"},Je={class:"text-xs text-orange-600"},Ke={class:"flex gap-1 mt-2"},Qe={key:0,class:"flex items-center gap-2"},We={class:"text-sm"},Ye={key:1,class:"text-sm text-muted-foreground"},Ze={class:"flex items-center gap-1"},et={class:"text-sm"},tt={key:0,class:"flex items-center gap-1"},st={class:"text-sm"},at={key:1,class:"text-sm text-muted-foreground"},lt={key:0,class:"flex flex-wrap gap-1"},ot={key:1,class:"text-sm text-muted-foreground"},nt=ie({__name:"EntregablesTable",props:{entregables:{},proyectoId:{},hitoId:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},showCheckbox:{type:Boolean,default:!0}},emits:["view","edit","delete","complete","mark-in-progress","selection-change"],setup(m,{emit:p}){const w=m,x=p,f=A([]),D=A(!1),E=A(null),k=A("pendiente"),V=A(!1),L=M(()=>w.entregables.map(n=>({...n,diasRestantes:r(n.fecha_fin),estaVencido:n.fecha_fin&&r(n.fecha_fin)<0,estaProximoVencer:n.fecha_fin&&r(n.fecha_fin)>=0&&r(n.fecha_fin)<=7}))),P=()=>{f.value.length===w.entregables.length?f.value=[]:f.value=w.entregables.map(n=>n.id),x("selection-change",f.value)},y=n=>f.value.includes(n),a=n=>{const u=f.value.indexOf(n);u>-1?f.value.splice(u,1):f.value.push(n),x("selection-change",f.value)},F=n=>({pendiente:"secondary",en_progreso:"default",completado:"success",cancelado:"destructive"})[n]||"secondary",c=n=>({baja:"outline",media:"default",alta:"destructive"})[n]||"outline",K=n=>n==="alta"?Ie:n==="baja"?Ue:Ne,g=n=>n?new Date(n).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-",r=n=>{if(!n)return null;const u=new Date,Q=new Date(n).getTime()-u.getTime();return Math.ceil(Q/(1e3*60*60*24))},$=n=>{x("view",n)},N=n=>{x("edit",n)},Y=n=>{E.value=n,k.value="completado",D.value=!0},z=n=>{x("delete",n)},fe=n=>{E.value=n,k.value="en_progreso",D.value=!0},pe=n=>{E.value&&(k.value==="completado"?x("complete",E.value,n):k.value==="en_progreso"&&x("mark-in-progress",E.value,n),D.value=!1,E.value=null)};return(n,u)=>{var Z,Q;return o(),b(R,null,[t(e(Ee),null,{default:s(()=>[t(e(Ce),null,{default:s(()=>[t(e(ee),null,{default:s(()=>[m.showCheckbox?(o(),h(e(T),{key:0,class:"w-[40px]"},{default:s(()=>[t(e(de),{checked:f.value.length===m.entregables.length&&m.entregables.length>0,"onUpdate:checked":P},null,8,["checked"])]),_:1})):_("",!0),t(e(T),null,{default:s(()=>[...u[2]||(u[2]=[i("Entregable",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...u[3]||(u[3]=[i("Responsable",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...u[4]||(u[4]=[i("Estado",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...u[5]||(u[5]=[i("Prioridad",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...u[6]||(u[6]=[i("Fecha Fin",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...u[7]||(u[7]=[i("Colaboradores",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...u[8]||(u[8]=[i("Etiquetas",-1)])]),_:1})]),_:1})]),_:1}),t(e(we),null,{default:s(()=>[(o(!0),b(R,null,G(L.value,d=>(o(),h(e(ee),{key:d.id,class:"hover:bg-muted/50"},{default:s(()=>[m.showCheckbox?(o(),h(e(B),{key:0,onClick:u[0]||(u[0]=ve(()=>{},["stop"]))},{default:s(()=>[t(e(de),{checked:y(d.id),"onUpdate:checked":()=>a(d.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024)):_("",!0),t(e(B),null,{default:s(()=>[l("div",null,[l("p",qe,v(d.nombre),1),d.descripcion?(o(),b("p",He,v(d.descripcion),1)):_("",!0),d.estaVencido?(o(),b("div",Oe,[t(e(ne),{class:"h-3 w-3 text-red-600"}),l("span",Ge,"Vencido hace "+v(Math.abs(d.diasRestantes))+" días",1)])):d.estaProximoVencer?(o(),b("div",Xe,[t(e(ne),{class:"h-3 w-3 text-orange-600"}),l("span",Je,"Vence en "+v(d.diasRestantes)+" días",1)])):_("",!0),l("div",Ke,[t(e(C),{variant:"ghost",size:"sm",class:"h-7 px-2 text-xs",onClick:S=>$(d)},{default:s(()=>[t(e(Be),{class:"mr-1 h-3 w-3"}),u[9]||(u[9]=i(" Ver ",-1))]),_:1},8,["onClick"]),m.canEdit?(o(),h(e(C),{key:0,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs",onClick:S=>N(d)},{default:s(()=>[t(e(Te),{class:"mr-1 h-3 w-3"}),u[10]||(u[10]=i(" Editar ",-1))]),_:1},8,["onClick"])):_("",!0),m.canEdit&&d.estado==="pendiente"?(o(),h(e(C),{key:1,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-blue-600 hover:text-blue-700",onClick:S=>fe(d)},{default:s(()=>[t(e(ce),{class:"mr-1 h-3 w-3"}),u[11]||(u[11]=i(" En Progreso ",-1))]),_:1},8,["onClick"])):_("",!0),m.canComplete&&d.estado!=="completado"?(o(),h(e(C),{key:2,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-green-600 hover:text-green-700",onClick:S=>Y(d)},{default:s(()=>[t(e(me),{class:"mr-1 h-3 w-3"}),u[12]||(u[12]=i(" Completar ",-1))]),_:1},8,["onClick"])):_("",!0),m.canDelete?(o(),h(e(C),{key:3,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-red-600 hover:text-red-700",onClick:S=>z(d)},{default:s(()=>[t(e(Fe),{class:"mr-1 h-3 w-3"}),u[13]||(u[13]=i(" Eliminar ",-1))]),_:1},8,["onClick"])):_("",!0)])])]),_:2},1024),t(e(B),null,{default:s(()=>[d.responsable?(o(),b("div",Qe,[t(e(Ve),{class:"h-8 w-8"},{default:s(()=>[d.responsable.avatar?(o(),h(e(De),{key:0,src:d.responsable.avatar},null,8,["src"])):_("",!0),t(e(Pe),null,{default:s(()=>[i(v(d.responsable.name.substring(0,2).toUpperCase()),1)]),_:2},1024)]),_:2},1024),l("span",We,v(d.responsable.name),1)])):(o(),b("span",Ye,"Sin asignar"))]),_:2},1024),t(e(B),null,{default:s(()=>[t(e(W),{variant:F(d.estado)},{default:s(()=>[i(v(d.estado_label),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(B),null,{default:s(()=>[t(e(W),{variant:c(d.prioridad)},{default:s(()=>[(o(),h(ge(K(d.prioridad)),{class:"mr-1 h-3 w-3"})),i(" "+v(d.prioridad_label),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(B),null,{default:s(()=>[l("div",Ze,[t(e(ze),{class:"h-4 w-4 text-muted-foreground"}),l("span",et,v(g(d.fecha_fin)),1)])]),_:2},1024),t(e(B),null,{default:s(()=>[d.usuarios&&d.usuarios.length>0?(o(),b("div",tt,[t(e(je),{class:"h-4 w-4 text-muted-foreground"}),l("span",st,v(d.usuarios.length),1)])):(o(),b("span",at,"-"))]),_:2},1024),t(e(B),null,{default:s(()=>[d.etiquetas&&d.etiquetas.length>0?(o(),b("div",lt,[(o(!0),b(R,null,G(d.etiquetas.slice(0,2),S=>(o(),h(e(W),{key:S.id,variant:"outline",class:"text-xs",style:he({borderColor:S.color||"#94a3b8",color:S.color||"#64748b"})},{default:s(()=>[i(v(S.nombre),1)]),_:2},1032,["style"]))),128)),d.etiquetas.length>2?(o(),h(e(W),{key:0,variant:"outline",class:"text-xs"},{default:s(()=>[i(" +"+v(d.etiquetas.length-2),1)]),_:2},1024)):_("",!0)])):(o(),b("span",ot,"-"))]),_:2},1024)]),_:2},1024))),128)),m.entregables.length===0?(o(),h(e(ee),{key:0},{default:s(()=>[t(e(B),{colspan:m.showCheckbox?8:7,class:"text-center py-8"},{default:s(()=>[...u[14]||(u[14]=[l("p",{class:"text-muted-foreground"},"No se encontraron entregables",-1)])]),_:1},8,["colspan"])]),_:1})):_("",!0)]),_:1})]),_:1}),t(Se,{open:D.value,"onUpdate:open":u[1]||(u[1]=d=>D.value=d),"entregable-nombre":(Z=E.value)==null?void 0:Z.nombre,"estado-actual":(Q=E.value)==null?void 0:Q.estado,"nuevo-estado":k.value,loading:V.value,onConfirm:pe},null,8,["open","entregable-nombre","estado-actual","nuevo-estado","loading"])],64)}}}),it={class:"flex items-center justify-between"},rt={class:"flex items-center gap-2"},dt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ut={class:"space-y-2"},ct={class:"relative"},mt={class:"space-y-2"},ft={class:"flex gap-2"},pt={class:"space-y-2"},vt={class:"flex gap-2"},gt={key:0,class:"space-y-2"},ht={class:"flex gap-2"},_t={class:"space-y-2 md:col-span-2"},xt={class:"grid grid-cols-2 gap-2"},yt={key:1,class:"space-y-4"},bt={class:"flex items-center justify-between"},$t={class:"flex items-center gap-2"},kt=ie({__name:"EntregablesFilters",props:{modelValue:{},usuarios:{default:()=>[]},showCard:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(m,{emit:p}){const w=m,x=p,f=M({get:()=>w.modelValue,set:y=>x("update:modelValue",y)}),D=[{value:"pendiente",label:"Pendiente"},{value:"en_progreso",label:"En Progreso"},{value:"completado",label:"Completado"},{value:"cancelado",label:"Cancelado"}],E=[{value:"baja",label:"Baja"},{value:"media",label:"Media"},{value:"alta",label:"Alta"}],k=(y,a)=>{f.value={...f.value,[y]:a}},V=y=>{k(y,null)},L=()=>{f.value={search:null,estado:null,prioridad:null,responsable_id:null,fecha_inicio:null,fecha_fin:null}},P=M(()=>Object.values(f.value).some(y=>y!=null&&y!==""));return(y,a)=>m.showCard?(o(),h(e(H),{key:0},{default:s(()=>[t(e(J),{class:"pb-3"},{default:s(()=>[l("div",it,[l("div",rt,[t(e(ue),{class:"h-4 w-4"}),t(e(X),{class:"text-base"},{default:s(()=>[...a[11]||(a[11]=[i("Filtros de Entregables",-1)])]),_:1})]),P.value?(o(),h(e(C),{key:0,variant:"ghost",size:"sm",onClick:L},{default:s(()=>[t(e(U),{class:"h-4 w-4 mr-1"}),a[12]||(a[12]=i(" Limpiar ",-1))]),_:1})):_("",!0)])]),_:1}),t(e(O),null,{default:s(()=>{var F;return[l("div",dt,[l("div",ut,[t(e(I),{for:"search"},{default:s(()=>[...a[13]||(a[13]=[i("Buscar",-1)])]),_:1}),l("div",ct,[t(e(Ae),{class:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),t(e(oe),{id:"search",value:f.value.search||"",onInput:a[0]||(a[0]=c=>k("search",c.target.value)),placeholder:"Buscar entregable...",class:"pl-8"},null,8,["value"])]),f.value.search?(o(),h(e(C),{key:0,variant:"ghost",size:"icon",class:"absolute right-2 top-8 h-6 w-6",onClick:a[1]||(a[1]=c=>V("search"))},{default:s(()=>[t(e(U),{class:"h-3 w-3"})]),_:1})):_("",!0)]),l("div",mt,[t(e(I),{for:"estado"},{default:s(()=>[...a[14]||(a[14]=[i("Estado",-1)])]),_:1}),l("div",ft,[t(e(te),{"model-value":f.value.estado||"null","onUpdate:modelValue":a[2]||(a[2]=c=>k("estado",c==="null"?null:c))},{default:s(()=>[t(e(se),{id:"estado"},{default:s(()=>[t(e(ae),{placeholder:"Todos los estados"})]),_:1}),t(e(le),null,{default:s(()=>[t(e(q),{value:"null"},{default:s(()=>[...a[15]||(a[15]=[i("Todos los estados",-1)])]),_:1}),(o(),b(R,null,G(D,c=>t(e(q),{key:c.value,value:c.value},{default:s(()=>[i(v(c.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value"]),f.value.estado?(o(),h(e(C),{key:0,variant:"ghost",size:"icon",onClick:a[3]||(a[3]=c=>V("estado"))},{default:s(()=>[t(e(U),{class:"h-4 w-4"})]),_:1})):_("",!0)])]),l("div",pt,[t(e(I),{for:"prioridad"},{default:s(()=>[...a[16]||(a[16]=[i("Prioridad",-1)])]),_:1}),l("div",vt,[t(e(te),{"model-value":f.value.prioridad||"null","onUpdate:modelValue":a[4]||(a[4]=c=>k("prioridad",c==="null"?null:c))},{default:s(()=>[t(e(se),{id:"prioridad"},{default:s(()=>[t(e(ae),{placeholder:"Todas las prioridades"})]),_:1}),t(e(le),null,{default:s(()=>[t(e(q),{value:"null"},{default:s(()=>[...a[17]||(a[17]=[i("Todas las prioridades",-1)])]),_:1}),(o(),b(R,null,G(E,c=>t(e(q),{key:c.value,value:c.value},{default:s(()=>[i(v(c.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value"]),f.value.prioridad?(o(),h(e(C),{key:0,variant:"ghost",size:"icon",onClick:a[5]||(a[5]=c=>V("prioridad"))},{default:s(()=>[t(e(U),{class:"h-4 w-4"})]),_:1})):_("",!0)])]),m.usuarios.length>0?(o(),b("div",gt,[t(e(I),{for:"responsable"},{default:s(()=>[...a[18]||(a[18]=[i("Responsable",-1)])]),_:1}),l("div",ht,[t(e(te),{"model-value":((F=f.value.responsable_id)==null?void 0:F.toString())||"null","onUpdate:modelValue":a[6]||(a[6]=c=>k("responsable_id",c==="null"?null:parseInt(c)))},{default:s(()=>[t(e(se),{id:"responsable"},{default:s(()=>[t(e(ae),{placeholder:"Todos los responsables"})]),_:1}),t(e(le),null,{default:s(()=>[t(e(q),{value:"null"},{default:s(()=>[...a[19]||(a[19]=[i("Todos los responsables",-1)])]),_:1}),(o(!0),b(R,null,G(m.usuarios,c=>(o(),h(e(q),{key:c.id,value:c.id.toString()},{default:s(()=>[i(v(c.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),f.value.responsable_id?(o(),h(e(C),{key:0,variant:"ghost",size:"icon",onClick:a[7]||(a[7]=c=>V("responsable_id"))},{default:s(()=>[t(e(U),{class:"h-4 w-4"})]),_:1})):_("",!0)])])):_("",!0),l("div",_t,[t(e(I),null,{default:s(()=>[...a[20]||(a[20]=[i("Rango de Fechas",-1)])]),_:1}),l("div",xt,[l("div",null,[t(e(I),{class:"text-xs text-muted-foreground"},{default:s(()=>[...a[21]||(a[21]=[i("Desde",-1)])]),_:1}),t(e(oe),{type:"date",value:f.value.fecha_inicio||"",onInput:a[8]||(a[8]=c=>k("fecha_inicio",c.target.value)),class:"mt-1"},null,8,["value"])]),l("div",null,[t(e(I),{class:"text-xs text-muted-foreground"},{default:s(()=>[...a[22]||(a[22]=[i("Hasta",-1)])]),_:1}),t(e(oe),{type:"date",value:f.value.fecha_fin||"",onInput:a[9]||(a[9]=c=>k("fecha_fin",c.target.value)),class:"mt-1"},null,8,["value"])])]),f.value.fecha_inicio||f.value.fecha_fin?(o(),h(e(C),{key:0,variant:"ghost",size:"sm",onClick:a[10]||(a[10]=c=>{V("fecha_inicio"),V("fecha_fin")}),class:"w-full mt-1"},{default:s(()=>[t(e(U),{class:"h-4 w-4 mr-1"}),a[23]||(a[23]=i(" Limpiar fechas ",-1))]),_:1})):_("",!0)])])]}),_:1})]),_:1})):(o(),b("div",yt,[l("div",bt,[l("div",$t,[t(e(ue),{class:"h-4 w-4"}),a[24]||(a[24]=l("h3",{class:"text-sm font-medium"},"Filtros",-1))]),P.value?(o(),h(e(C),{key:0,variant:"ghost",size:"sm",onClick:L},{default:s(()=>[t(e(U),{class:"h-4 w-4 mr-1"}),a[25]||(a[25]=i(" Limpiar ",-1))]),_:1})):_("",!0)]),a[26]||(a[26]=l("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},null,-1))]))}}),Ct={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},wt={class:"flex items-center justify-between"},Et={class:"text-muted-foreground mt-2"},Vt={class:"flex gap-2"},Dt={class:"grid gap-4 md:grid-cols-4"},Pt={class:"text-2xl font-bold"},St={class:"text-xs text-muted-foreground mt-2"},Bt={class:"text-2xl font-bold"},Tt={class:"text-xs text-muted-foreground"},Ft={class:"text-2xl font-bold"},zt={class:"text-2xl font-bold"},jt={key:0,class:"flex items-center justify-between"},It={class:"text-sm text-muted-foreground"},Ut={class:"flex gap-2"},ia=ie({__name:"Index",props:{proyecto:{},hito:{},entregables:{},filters:{},resumenUsuarios:{},estados:{},prioridades:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canAssign:{type:Boolean}},setup(m){var a,F,c,K;const p=m,{toast:w}=$e(),x=M(()=>Array.isArray(p.entregables)?{data:p.entregables,current_page:1,last_page:1,per_page:p.entregables.length,total:p.entregables.length,from:1,to:p.entregables.length}:p.entregables),f=A({search:((a=p.filters)==null?void 0:a.search)||null,estado:((F=p.filters)==null?void 0:F.estado)||null,prioridad:((c=p.filters)==null?void 0:c.prioridad)||null,responsable_id:((K=p.filters)==null?void 0:K.responsable_id)||null,fecha_inicio:null,fecha_fin:null});A([]);const D=M(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:p.proyecto.nombre,href:`/admin/proyectos/${p.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${p.proyecto.id}/hitos`},{title:p.hito.nombre,href:`/admin/proyectos/${p.proyecto.id}?tab=hitos&hito=${p.hito.id}&modal=hito`},{title:"Entregables"}]),E=ke.debounce(()=>{j.get(`/admin/proyectos/${p.proyecto.id}/hitos/${p.hito.id}/entregables`,{search:f.value.search,estado:f.value.estado,prioridad:f.value.prioridad,responsable_id:f.value.responsable_id,page:1},{preserveState:!0,preserveScroll:!0})},300);_e(f,()=>{E()},{deep:!0});const k=(g,r)=>{p.canComplete&&j.post(`/admin/proyectos/${p.proyecto.id}/hitos/${p.hito.id}/entregables/${g.id}/completar`,{notas:r},{onSuccess:()=>{w.success("Entregable marcado como completado")},onError:()=>{w.error("Error al marcar el entregable como completado")}})},V=g=>{p.canDelete&&confirm(`¿Estás seguro de eliminar el entregable "${g.nombre}"?`)&&j.delete(`/admin/proyectos/${p.proyecto.id}/hitos/${p.hito.id}/entregables/${g.id}`,{onSuccess:()=>{w.success("Entregable eliminado correctamente")},onError:()=>{w.error("Error al eliminar el entregable")}})},L=(g,r)=>{p.canEdit&&j.post(`/admin/proyectos/${p.proyecto.id}/hitos/${p.hito.id}/entregables/${g.id}/actualizar-estado`,{estado:"en_progreso",observaciones:r},{onSuccess:()=>{w.success("Entregable marcado como en progreso")},onError:()=>{w.error("Error al actualizar el estado del entregable")}})},P=g=>{if(!g)return null;const r=new Date,N=new Date(g).getTime()-r.getTime();return Math.ceil(N/(1e3*60*60*24))};M(()=>x.value.data.map(g=>({...g,diasRestantes:P(g.fecha_fin),estaVencido:g.fecha_fin&&P(g.fecha_fin)<0,estaProximoVencer:g.fecha_fin&&P(g.fecha_fin)>=0&&P(g.fecha_fin)<=7})));const y=M(()=>{const g=x.value.data,r=x.value.total,$=g.filter(z=>z.estado==="completado").length,N=g.filter(z=>z.estado==="en_progreso").length,Y=g.filter(z=>z.estado==="pendiente").length;return{total:r,completados:$,enProgreso:N,pendientes:Y,progreso:r>0?Math.round($/r*100):0}});return(g,r)=>(o(),h(xe,{breadcrumbs:D.value},{default:s(()=>[l("div",Ct,[l("div",wt,[l("div",null,[r[3]||(r[3]=l("h2",{class:"text-3xl font-bold tracking-tight"},"Entregables del Hito",-1)),l("p",Et,v(m.hito.nombre)+" - "+v(m.proyecto.nombre),1)]),l("div",Vt,[t(e(re),{href:`/admin/proyectos/${m.proyecto.id}/hitos`,as:"button"},{default:s(()=>[t(e(C),{variant:"outline"},{default:s(()=>[t(e(Me),{class:"mr-2 h-4 w-4"}),r[4]||(r[4]=i(" Volver a Hitos ",-1))]),_:1})]),_:1},8,["href"]),m.canCreate?(o(),h(e(re),{key:0,href:`/admin/proyectos/${m.proyecto.id}/hitos/${m.hito.id}/entregables/create`,as:"button"},{default:s(()=>[t(e(C),null,{default:s(()=>[t(e(Re),{class:"mr-2 h-4 w-4"}),r[5]||(r[5]=i(" Nuevo Entregable ",-1))]),_:1})]),_:1},8,["href"])):_("",!0)])]),l("div",Dt,[t(e(H),null,{default:s(()=>[t(e(J),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[t(e(X),{class:"text-sm font-medium"},{default:s(()=>[...r[6]||(r[6]=[i("Total Entregables",-1)])]),_:1}),t(e(Le),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(O),null,{default:s(()=>[l("div",Pt,v(y.value.total),1),t(e(be),{value:y.value.progreso,class:"mt-2"},null,8,["value"]),l("p",St,v(y.value.progreso)+"% completado ",1)]),_:1})]),_:1}),t(e(H),null,{default:s(()=>[t(e(J),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[t(e(X),{class:"text-sm font-medium"},{default:s(()=>[...r[7]||(r[7]=[i("Completados",-1)])]),_:1}),t(e(me),{class:"h-4 w-4 text-green-600"})]),_:1}),t(e(O),null,{default:s(()=>[l("div",Bt,v(y.value.completados),1),l("p",Tt," de "+v(y.value.total)+" entregables ",1)]),_:1})]),_:1}),t(e(H),null,{default:s(()=>[t(e(J),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[t(e(X),{class:"text-sm font-medium"},{default:s(()=>[...r[8]||(r[8]=[i("En Progreso",-1)])]),_:1}),t(e(ce),{class:"h-4 w-4 text-blue-600"})]),_:1}),t(e(O),null,{default:s(()=>[l("div",Ft,v(y.value.enProgreso),1),r[9]||(r[9]=l("p",{class:"text-xs text-muted-foreground"}," actualmente activos ",-1))]),_:1})]),_:1}),t(e(H),null,{default:s(()=>[t(e(J),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[t(e(X),{class:"text-sm font-medium"},{default:s(()=>[...r[10]||(r[10]=[i("Pendientes",-1)])]),_:1}),t(e(ne),{class:"h-4 w-4 text-orange-600"})]),_:1}),t(e(O),null,{default:s(()=>[l("div",zt,v(y.value.pendientes),1),r[11]||(r[11]=l("p",{class:"text-xs text-muted-foreground"}," por iniciar ",-1))]),_:1})]),_:1})]),t(kt,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=$=>f.value=$)},null,8,["modelValue"]),t(e(H),null,{default:s(()=>[t(e(O),{class:"p-0"},{default:s(()=>[t(nt,{entregables:x.value.data,"proyecto-id":m.proyecto.id,"hito-id":m.hito.id,"can-edit":m.canEdit,"can-delete":m.canDelete,"can-complete":m.canComplete,onView:r[1]||(r[1]=$=>e(j).visit(`/admin/proyectos/${m.proyecto.id}/hitos/${m.hito.id}/entregables/${$.id}`)),onEdit:r[2]||(r[2]=$=>e(j).visit(`/admin/proyectos/${m.proyecto.id}/hitos/${m.hito.id}/entregables/${$.id}/edit`)),onComplete:k,onMarkInProgress:L,onDelete:V},null,8,["entregables","proyecto-id","hito-id","can-edit","can-delete","can-complete"])]),_:1})]),_:1}),x.value.last_page>1?(o(),b("div",jt,[l("div",It," Mostrando "+v(x.value.from)+" a "+v(x.value.to)+" de "+v(x.value.total)+" entregables ",1),l("div",Ut,[(o(!0),b(R,null,G(x.value.last_page,$=>(o(),h(e(C),{key:$,variant:"outline",size:"sm",disabled:$===x.value.current_page,onClick:N=>e(j).get(`/admin/proyectos/${m.proyecto.id}/hitos/${m.hito.id}/entregables?page=${$}`)},{default:s(()=>[i(v($),1)]),_:2},1032,["disabled","onClick"]))),128))])])):_("",!0)])]),_:1},8,["breadcrumbs"]))}});export{ia as default};
