import{d as M,k as _,c as H,w as U,a as $,o as v,F as Q,r as X,j as E,n as O,u as a,p as Y,O as Z,b as l,e as c,f as m,g as f,i as w,t as C,W as ee}from"./app-CAXHaRzQ.js";import{a as te,b as ae,c as se,_ as oe}from"./CardTitle.vue_vue_type_script_setup_true_lang-Ft95mKZ2.js";import{_ as le}from"./CardDescription.vue_vue_type_script_setup_true_lang-B-SYLEyF.js";import{c as ie,_ as F}from"./createLucideIcon-DqZ8uYlK.js";import{_ as L}from"./Label.vue_vue_type_script_setup_true_lang-BspVZzut.js";import{_ as x,a as z}from"./index-Bfh6wep3.js";import{_ as N}from"./AlertTitle.vue_vue_type_script_setup_true_lang-DxntLStH.js";import{_ as P}from"./index-CXnYeq2h.js";import{_ as re}from"./Input.vue_vue_type_script_setup_true_lang-DBwpLbvr.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{t as q}from"./index-C_rxOBkw.js";import{U as ue}from"./user-BLEsryjw.js";import{C as j}from"./circle-check-big-yZNwVPuV.js";import{T as de}from"./timer-CZ_4G87p.js";import{R as ce}from"./refresh-cw-D_x1rZwJ.js";import{C as me}from"./circle-alert-Btx1czxG.js";import{A as fe}from"./arrow-left-C_ysmLCL.js";import{A as pe}from"./arrow-right-B9f6tN5I.js";import"./index-CFeD25jK.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=ie("ShieldCheckIcon",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ge={class:"flex gap-2"},_e=M({__name:"VerificationCodeInput",props:{modelValue:{default:""},length:{default:6},disabled:{type:Boolean,default:!1},error:{},autoFocus:{type:Boolean,default:!1}},emits:["update:modelValue","complete"],setup(B,{emit:W}){const n=B,R=W,i=_(Array(n.length).fill("")),g=_([]),V=H(()=>i.value.every(t=>t!=="")&&i.value.join("").length===n.length);U(()=>n.modelValue,t=>{if(t)for(i.value=t.split("").slice(0,n.length);i.value.length<n.length;)i.value.push("");else i.value=Array(n.length).fill("")},{immediate:!0}),U(i,t=>{const s=t.join("");R("update:modelValue",s),s.length===n.length&&!s.includes("")&&R("complete",s)},{deep:!0});const I=(t,s)=>{var d,b;const u=s.target,o=u.value;if(!/^\d*$/.test(o)){u.value="",i.value[t]="";return}if(o&&t<n.length-1){const h=g.value[t+1];h&&((b=(d=h.$el)==null?void 0:d.querySelector("input"))==null||b.focus())}},A=(t,s)=>{var o,d,b,h,k,T;const u=s.key;if(u==="Backspace")if(s.preventDefault(),!i.value[t]&&t>0){const y=g.value[t-1];y&&(i.value[t-1]="",(d=(o=y.$el)==null?void 0:o.querySelector("input"))==null||d.focus())}else i.value[t]="";if(u==="ArrowLeft"&&t>0){s.preventDefault();const y=g.value[t-1];(h=(b=y==null?void 0:y.$el)==null?void 0:b.querySelector("input"))==null||h.focus()}if(u==="ArrowRight"&&t<n.length-1){s.preventDefault();const y=g.value[t+1];(T=(k=y==null?void 0:y.$el)==null?void 0:k.querySelector("input"))==null||T.focus()}!/^\d$/.test(u)&&!["Backspace","Delete","Tab","ArrowLeft","ArrowRight"].includes(u)&&s.preventDefault()},D=t=>{var o;t.preventDefault();const u=(((o=t.clipboardData)==null?void 0:o.getData("text"))||"").replace(/\D/g,"").slice(0,n.length);if(u){for(i.value=u.split("");i.value.length<n.length;)i.value.push("");const d=i.value.findLastIndex(h=>h!==""),b=d<n.length-1?d+1:d;setTimeout(()=>{var h,k,T;(T=(k=(h=g.value[b])==null?void 0:h.$el)==null?void 0:k.querySelector("input"))==null||T.focus()},0)}},S=t=>{setTimeout(()=>{var u,o;const s=(o=(u=g.value[t])==null?void 0:u.$el)==null?void 0:o.querySelector("input");s&&s.select()},0)};return n.autoFocus&&setTimeout(()=>{var t,s,u;(u=(s=(t=g.value[0])==null?void 0:t.$el)==null?void 0:s.querySelector("input"))==null||u.focus()},100),(t,s)=>(v(),$("div",ge,[(v(!0),$(Q,null,X(i.value,(u,o)=>(v(),E(a(re),{key:o,ref_for:!0,ref:d=>g.value[o]=d,modelValue:i.value[o],"onUpdate:modelValue":d=>i.value[o]=d,type:"text",inputmode:"numeric",pattern:"[0-9]",maxlength:"1",class:O(["w-12 h-12 text-center text-lg font-semibold",{"border-destructive":t.error,"border-green-500":V.value&&!t.error,"opacity-50":t.disabled}]),disabled:t.disabled,onInput:d=>I(o,d),onKeydown:d=>A(o,d),onPaste:D,onFocus:d=>S(o)},null,8,["modelValue","onUpdate:modelValue","class","disabled","onInput","onKeydown","onFocus"]))),128))]))}}),K=ne(_e,[["__scopeId","data-v-0b241b31"]]),he={class:"max-w-2xl mx-auto"},ye={class:"flex items-center gap-2"},we={class:"mt-2 space-y-1"},be={key:0},ke={class:"space-y-4"},Ce={class:"flex gap-2 mt-1"},$e={key:0,class:"text-sm text-destructive mt-1"},Ve={key:0},Ie={class:"flex gap-2 mt-1"},Ae={key:0,class:"text-sm text-destructive mt-1"},De={key:0,class:"space-y-3"},Te={class:"flex items-center justify-between p-4 bg-muted rounded-lg"},Se={class:"flex items-center gap-2"},Ee={class:"text-sm"},Re={class:"flex justify-between"},Ze=M({__name:"VerificationProcess",props:{user:{},verificationRequestId:{},initialTimeout:{default:10}},emits:["back","verified","timeout"],setup(B,{emit:W}){const n=B,R=W,i=_(""),g=_(""),V=_(!1),I=_(!1),A=_(""),D=_(""),S=_(n.initialTimeout),t=_(!1),s=_(null),u=_(!1),o=_(!1),d=H(()=>{const r=V.value||!n.user.email,e=I.value||!n.user.telefono;return r&&e}),b=r=>{const[e,p]=r.split("@");return`${e.substring(0,2)+"***"}@${p}`},h=r=>`***${r.replace(/\D/g,"").slice(-4)}`,k=()=>{s.value=setInterval(()=>{S.value--,S.value<=0&&(clearInterval(s.value),t.value=!0,R("timeout"))},1e3)},T=async()=>{var r,e;if(i.value.length===6)try{(await axios.post(route("registro.confirmacion.verify-code"),{verification_id:n.verificationRequestId,code:String(i.value),channel:"email"})).data.success&&(V.value=!0,A.value="",q.success("Email verificado",{description:"Tu email ha sido verificado correctamente"}))}catch(p){A.value=((e=(r=p.response)==null?void 0:r.data)==null?void 0:e.message)||"Código inválido"}},y=async()=>{var r,e;if(g.value.length===6)try{(await axios.post(route("registro.confirmacion.verify-code"),{verification_id:n.verificationRequestId,code:String(g.value),channel:"whatsapp"})).data.success&&(I.value=!0,D.value="",q.success("WhatsApp verificado",{description:"Tu WhatsApp ha sido verificado correctamente"}))}catch(p){D.value=((e=(r=p.response)==null?void 0:r.data)==null?void 0:e.message)||"Código inválido"}},G=async()=>{var r,e;o.value=!0;try{await axios.post(route("registro.confirmacion.send-verification"),{verification_id:n.verificationRequestId}),q.info("Códigos reenviados",{description:"Revisa tu email y WhatsApp"}),S.value=n.initialTimeout,t.value=!1,s.value&&clearInterval(s.value),k()}catch(p){q.error("Error al reenviar códigos",{description:((e=(r=p.response)==null?void 0:r.data)==null?void 0:e.message)||"Intenta nuevamente"})}finally{o.value=!1}},J=()=>{u.value=!0,t.value?ee.get(route("registro.confirmacion.update-form")):R("verified",{email:V.value,whatsapp:I.value})};return Y(()=>{k()}),Z(()=>{s.value&&clearInterval(s.value)}),(r,e)=>(v(),$("div",he,[l(a(oe),null,{default:c(()=>[l(a(te),null,{default:c(()=>[l(a(ae),null,{default:c(()=>[m("div",ye,[l(a(ve),{class:"h-5 w-5"}),e[3]||(e[3]=f(" Verificación de Identidad ",-1))])]),_:1}),l(a(le),null,{default:c(()=>[...e[4]||(e[4]=[f(" Hemos enviado códigos de verificación a tu email y WhatsApp ",-1)])]),_:1})]),_:1}),l(a(se),{class:"space-y-6"},{default:c(()=>[l(a(x),null,{default:c(()=>[l(a(ue),{class:"h-4 w-4"}),l(a(N),null,{default:c(()=>[...e[5]||(e[5]=[f("Usuario encontrado",-1)])]),_:1}),l(a(z),null,{default:c(()=>[m("div",we,[m("p",null,[e[6]||(e[6]=m("strong",null,"Nombre:",-1)),f(" "+C(r.user.name),1)]),m("p",null,[e[7]||(e[7]=m("strong",null,"Documento:",-1)),f(" "+C(r.user.documento_identidad),1)]),m("p",null,[e[8]||(e[8]=m("strong",null,"Email:",-1)),f(" "+C(b(r.user.email)),1)]),r.user.telefono?(v(),$("p",be,[e[9]||(e[9]=m("strong",null,"Teléfono:",-1)),f(" "+C(h(r.user.telefono)),1)])):w("",!0)])]),_:1})]),_:1}),m("div",ke,[m("div",null,[l(a(L),null,{default:c(()=>[...e[10]||(e[10]=[f("Código enviado por Email",-1)])]),_:1}),m("div",Ce,[l(K,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=p=>i.value=p),disabled:V.value,error:A.value,onComplete:T},null,8,["modelValue","disabled","error"]),V.value?(v(),E(a(P),{key:0,variant:"success"},{default:c(()=>[l(a(j),{class:"h-3 w-3 mr-1"}),e[11]||(e[11]=f(" Verificado ",-1))]),_:1})):w("",!0)]),A.value?(v(),$("p",$e,C(A.value),1)):w("",!0)]),r.user.telefono?(v(),$("div",Ve,[l(a(L),null,{default:c(()=>[...e[12]||(e[12]=[f("Código enviado por WhatsApp",-1)])]),_:1}),m("div",Ie,[l(K,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=p=>g.value=p),disabled:I.value,error:D.value,onComplete:y},null,8,["modelValue","disabled","error"]),I.value?(v(),E(a(P),{key:0,variant:"success"},{default:c(()=>[l(a(j),{class:"h-3 w-3 mr-1"}),e[13]||(e[13]=f(" Verificado ",-1))]),_:1})):w("",!0)]),D.value?(v(),$("p",Ae,C(D.value),1)):w("",!0)])):w("",!0)]),d.value?w("",!0):(v(),$("div",De,[m("div",Te,[m("div",Se,[l(a(de),{class:"h-4 w-4 text-muted-foreground"}),m("span",Ee,C(t.value?"Tiempo agotado":`Esperando códigos: ${S.value}s`),1)]),t.value?w("",!0):(v(),E(a(F),{key:0,variant:"ghost",size:"sm",onClick:G,disabled:o.value},{default:c(()=>[l(a(ce),{class:O(["h-4 w-4 mr-1",{"animate-spin":o.value}])},null,8,["class"]),e[14]||(e[14]=f(" Reenviar códigos ",-1))]),_:1},8,["disabled"]))]),t.value?(v(),E(a(x),{key:0,variant:"warning"},{default:c(()=>[l(a(me),{class:"h-4 w-4"}),l(a(N),null,{default:c(()=>[...e[15]||(e[15]=[f("¿No recibiste los códigos?",-1)])]),_:1}),l(a(z),null,{default:c(()=>[...e[16]||(e[16]=[f(" Puedes actualizar tu información de contacto para recibir futuras comunicaciones. ",-1)])]),_:1})]),_:1})):w("",!0)])),m("div",Re,[l(a(F),{variant:"outline",onClick:e[2]||(e[2]=p=>r.$emit("back"))},{default:c(()=>[l(a(fe),{class:"h-4 w-4 mr-2"}),e[17]||(e[17]=f(" Volver ",-1))]),_:1}),d.value||t.value?(v(),E(a(F),{key:0,onClick:J,disabled:u.value},{default:c(()=>[f(C(t.value?"Actualizar datos":"Continuar")+" ",1),l(a(pe),{class:"h-4 w-4 ml-2"})]),_:1},8,["disabled"])):w("",!0)])]),_:1})]),_:1})]))}});export{Ze as default};
