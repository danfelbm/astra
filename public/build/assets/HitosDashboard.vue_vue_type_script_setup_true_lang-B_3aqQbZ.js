import{d as J,r as K,c as w,p as O,s as W,i as f,g as a,e as l,b as g,j as u,h as m,f as e,t as c,w as r,v as U,F as j,k as H,n as x,m as i}from"./app-DOAvpdpy.js";import{g as X}from"./Input.vue_vue_type_script_setup_true_lang-DpiZrk6F.js";import{_ as Y,a as Z,b as ee,c as te}from"./CardTitle.vue_vue_type_script_setup_true_lang-CHzHcBJD.js";import{_ as h}from"./createLucideIcon-B8d5bW74.js";import{_ as k}from"./index-BEwAULqp.js";import{_ as P}from"./Progress.vue_vue_type_script_setup_true_lang-DUc7kvfq.js";import{_ as I}from"./ScrollArea.vue_vue_type_script_setup_true_lang-C60H2ZU2.js";import{_ as ae}from"./Separator.vue_vue_type_script_setup_true_lang-DlxX-RUz.js";import{_ as se,a as le,b as oe,c as ne,d as re}from"./SelectValue.vue_vue_type_script_setup_true_lang-BXZrnX9E.js";import{L as C,_ as ie}from"./EntregablesList.vue_vue_type_script_setup_true_lang-CeCdGuPX.js";import{T as z}from"./target-6lEdwcHB.js";import{E as B}from"./external-link-fEEnYwkp.js";import{C as de}from"./calendar-CD2D2UbU.js";import{C as ce}from"./clock-_CclVdPa.js";import{U as ue}from"./user-BCblXEQx.js";import{S as me}from"./square-pen-BlJ2VD3E.js";import{P as M}from"./plus-CaIcTwOd.js";import{T as fe}from"./trash-2-U0flC5IV.js";import{C as ge}from"./chevron-right-CCRsFGH5.js";import{f as pe,e as ve}from"./es-BDPlFIsO.js";const he={class:"flex flex-col md:flex-row h-full min-h-[500px] border rounded-lg overflow-hidden bg-background"},_e={class:"hidden md:flex md:w-72 lg:w-80 flex-col border-r bg-muted/30"},be={class:"p-4 border-b bg-background"},xe={class:"flex items-center justify-between"},ye={class:"font-semibold text-sm text-muted-foreground uppercase tracking-wide flex items-center gap-2"},we={class:"p-2 space-y-1"},ke={key:0,class:"p-4 text-center text-muted-foreground text-sm"},Ce=["data-active","onClick"],$e={class:"flex items-center gap-2"},Ee={class:"font-medium truncate flex-1"},De={class:"flex items-center gap-2 mt-2 ml-4 text-xs text-muted-foreground"},Se={class:"mt-2 ml-4"},Ve={class:"flex-1 flex flex-col min-h-0"},Ue={class:"md:hidden p-4 border-b bg-background sticky top-0 z-10"},je={class:"flex items-center gap-2"},He={class:"text-muted-foreground"},Pe={key:0,class:"flex items-center justify-center h-full min-h-[400px]"},Ie={class:"text-center space-y-3 max-w-sm p-6"},ze={key:1,class:"p-4 md:p-6 space-y-6"},Be={class:"flex items-start justify-between gap-4"},Me={class:"flex-1 min-w-0"},Ne={class:"flex items-center gap-2 mb-1"},Le={key:0,class:"text-sm text-muted-foreground mt-2"},Te={class:"space-y-2"},Fe={class:"flex justify-between items-center text-sm"},Re={class:"font-medium"},Ae={class:"flex flex-wrap gap-4 text-sm"},qe={key:0,class:"flex items-center gap-1.5 text-muted-foreground"},Qe={key:1,class:"flex items-center gap-1.5 text-muted-foreground"},Ge={key:2,class:"flex items-center gap-1.5 text-muted-foreground"},Je={class:"flex flex-wrap gap-2"},Ke={class:"space-y-4"},Oe={class:"flex items-center justify-between"},We={class:"font-semibold flex items-center gap-2"},Xe={key:1,class:"text-center py-8 border rounded-lg bg-muted/30"},xt=J({__name:"HitosDashboard",props:{hitos:{},proyectoId:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canManageDeliverables:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},showViewDetail:{type:Boolean,default:!0},baseUrl:{default:"/admin/proyectos"}},emits:["select-hito","edit-hito","delete-hito","view-hito","add-entregable","complete-entregable","update-entregable-status","edit-entregable"],setup(d,{emit:N}){const b=d,v=N;X("(max-width: 768px)");const _=K((()=>{const t=new URLSearchParams(window.location.search).get("hito");return t?parseInt(t,10):null})()),s=w(()=>b.hitos.find(o=>o.id===_.value)??null),L=w(()=>`${b.baseUrl}/${b.proyectoId}/hitos`),$=w(()=>s.value?`${b.baseUrl}/${b.proyectoId}/hitos/${s.value.id}/entregables`:null);O(_,o=>{if(o){const t=window.location.pathname,p=new URLSearchParams(window.location.search);p.set("hito",String(o));const n=`${t}?${p.toString()}`;W.get(n,{},{preserveState:!0,preserveScroll:!0,replace:!0,only:[]}),v("select-hito",o)}});const E=o=>{_.value=o},T=o=>{const t=parseInt(o,10);isNaN(t)||E(t)},D=o=>o?pe(new Date(o),"dd MMM yyyy",{locale:ve}):"Sin fecha",S=o=>({pendiente:"bg-gray-100 text-gray-800",en_progreso:"bg-blue-100 text-blue-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[o]||"bg-gray-100 text-gray-800",y=o=>({pendiente:"bg-gray-400",en_progreso:"bg-blue-500 animate-pulse",completado:"bg-green-500",cancelado:"bg-red-500"})[o]||"bg-gray-400",F=(o,t,p)=>{v("complete-entregable",o,t,p)},R=(o,t,p,n)=>{v("update-entregable-status",o,t,p,n)},A=o=>{s.value&&v("edit-entregable",o,s.value)},q=()=>{s.value&&v("edit-hito",s.value)},Q=()=>{s.value&&v("delete-hito",s.value)},V=()=>{s.value&&v("add-entregable",s.value)},G=()=>{s.value&&v("view-hito",s.value)};return(o,t)=>{var p;return i(),f("div",he,[a("aside",_e,[a("div",be,[a("div",xe,[a("h2",ye,[l(e(z),{class:"h-4 w-4"}),m(" Hitos ("+c(d.hitos.length)+") ",1)]),d.showViewDetail?(i(),g(e(U),{key:0,href:L.value},{default:r(()=>[l(e(h),{variant:"outline",size:"sm"},{default:r(()=>[l(e(B),{class:"h-3.5 w-3.5 mr-1"}),t[0]||(t[0]=m(" Ver todos ",-1))]),_:1})]),_:1},8,["href"])):u("",!0)])]),l(e(I),{class:"flex-1"},{default:r(()=>[a("div",we,[d.hitos.length===0?(i(),f("div",ke," No hay hitos definidos ")):u("",!0),(i(!0),f(j,null,H(d.hitos,n=>(i(),f("button",{key:n.id,"data-active":_.value===n.id,class:"w-full text-left p-3 rounded-lg transition-colors duration-150 hover:bg-accent hover:text-accent-foreground data-[active=true]:bg-primary/10 data-[active=true]:text-primary data-[active=true]:border-l-2 data-[active=true]:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",onClick:Ze=>E(n.id)},[a("div",$e,[a("div",{class:x([y(n.estado),"w-2 h-2 rounded-full flex-shrink-0"])},null,2),a("span",Ee,c(n.nombre),1),_.value===n.id?(i(),g(e(ge),{key:0,class:"h-4 w-4 flex-shrink-0 text-primary"})):u("",!0)]),a("div",De,[l(e(k),{class:x([S(n.estado),"text-[10px] px-1.5 py-0"])},{default:r(()=>[m(c(n.estado_label||n.estado),1)]),_:2},1032,["class"]),a("span",null,c(n.porcentaje_completado)+"%",1)]),a("div",Se,[l(e(P),{"model-value":n.porcentaje_completado,class:"h-1"},null,8,["model-value"])])],8,Ce))),128))])]),_:1})]),a("main",Ve,[a("div",Ue,[l(e(se),{"model-value":((p=_.value)==null?void 0:p.toString())||"","onUpdate:modelValue":T},{default:r(()=>[l(e(le),{class:"w-full"},{default:r(()=>[l(e(oe),{placeholder:"Selecciona un hito"})]),_:1}),l(e(ne),null,{default:r(()=>[(i(!0),f(j,null,H(d.hitos,n=>(i(),g(e(re),{key:n.id,value:n.id.toString()},{default:r(()=>[a("div",je,[a("div",{class:x([y(n.estado),"w-2 h-2 rounded-full"])},null,2),a("span",null,c(n.nombre),1),a("span",He,"("+c(n.porcentaje_completado)+"%)",1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"])]),l(e(I),{class:"flex-1"},{default:r(()=>[s.value?(i(),f("div",ze,[l(e(Y),null,{default:r(()=>[l(e(Z),{class:"pb-3"},{default:r(()=>[a("div",Be,[a("div",Me,[a("div",Ne,[a("div",{class:x([y(s.value.estado),"w-2.5 h-2.5 rounded-full"])},null,2),l(e(ee),{class:"text-xl truncate"},{default:r(()=>[m(c(s.value.nombre),1)]),_:1})]),s.value.descripcion?(i(),f("p",Le,c(s.value.descripcion),1)):u("",!0)]),l(e(k),{class:x(S(s.value.estado))},{default:r(()=>[m(c(s.value.estado_label||s.value.estado),1)]),_:1},8,["class"])])]),_:1}),l(e(te),{class:"space-y-4"},{default:r(()=>[a("div",Te,[a("div",Fe,[t[3]||(t[3]=a("span",{class:"text-muted-foreground"},"Progreso",-1)),a("span",Re,c(s.value.porcentaje_completado)+"%",1)]),l(e(P),{"model-value":s.value.porcentaje_completado,class:"h-2"},null,8,["model-value"])]),a("div",Ae,[s.value.fecha_inicio?(i(),f("div",qe,[l(e(de),{class:"h-4 w-4"}),a("span",null,"Inicio: "+c(D(s.value.fecha_inicio)),1)])):u("",!0),s.value.fecha_fin?(i(),f("div",Qe,[l(e(ce),{class:"h-4 w-4"}),a("span",null,"Fin: "+c(D(s.value.fecha_fin)),1)])):u("",!0),s.value.responsable?(i(),f("div",Ge,[l(e(ue),{class:"h-4 w-4"}),a("span",null,c(s.value.responsable.name),1)])):u("",!0)]),l(e(ae)),a("div",Je,[d.canEdit?(i(),g(e(h),{key:0,variant:"outline",size:"sm",onClick:q},{default:r(()=>[l(e(me),{class:"h-4 w-4 mr-1.5"}),t[4]||(t[4]=m(" Editar Hito ",-1))]),_:1})):u("",!0),d.canManageDeliverables?(i(),g(e(h),{key:1,variant:"outline",size:"sm",onClick:V},{default:r(()=>[l(e(M),{class:"h-4 w-4 mr-1.5"}),t[5]||(t[5]=m(" AÃ±adir Entregable ",-1))]),_:1})):u("",!0),d.showViewDetail?(i(),g(e(h),{key:2,variant:"ghost",size:"sm",onClick:G},{default:r(()=>[l(e(C),{class:"h-4 w-4 mr-1.5"}),t[6]||(t[6]=m(" Ver Detalle Completo ",-1))]),_:1})):u("",!0),d.canDelete?(i(),g(e(h),{key:3,variant:"ghost",size:"sm",class:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:Q},{default:r(()=>[l(e(fe),{class:"h-4 w-4 mr-1.5"}),t[7]||(t[7]=m(" Eliminar ",-1))]),_:1})):u("",!0)])]),_:1})]),_:1}),a("div",Ke,[a("div",Oe,[a("h3",We,[l(e(C),{class:"h-5 w-5"}),t[8]||(t[8]=m(" Entregables ",-1)),l(e(k),{variant:"secondary",class:"ml-1"},{default:r(()=>{var n;return[m(c(((n=s.value.entregables)==null?void 0:n.length)||0),1)]}),_:1})]),d.showViewDetail&&$.value?(i(),g(e(U),{key:0,href:$.value},{default:r(()=>[l(e(h),{variant:"outline",size:"sm"},{default:r(()=>[l(e(B),{class:"h-3.5 w-3.5 mr-1"}),t[9]||(t[9]=m(" Ver todos ",-1))]),_:1})]),_:1},8,["href"])):u("",!0)]),s.value.entregables&&s.value.entregables.length>0?(i(),g(ie,{key:0,entregables:s.value.entregables,"can-edit":d.canEdit,"can-delete":d.canDelete,"can-complete":d.canComplete,"view-mode":"list",onComplete:F,onUpdateStatus:R,onEdit:A},null,8,["entregables","can-edit","can-delete","can-complete"])):(i(),f("div",Xe,[l(e(C),{class:"h-10 w-10 mx-auto text-muted-foreground/50 mb-3"}),t[11]||(t[11]=a("p",{class:"text-muted-foreground text-sm"},"No hay entregables en este hito",-1)),d.canManageDeliverables?(i(),g(e(h),{key:0,variant:"outline",size:"sm",class:"mt-4",onClick:V},{default:r(()=>[l(e(M),{class:"h-4 w-4 mr-1.5"}),t[10]||(t[10]=m(" Crear primer entregable ",-1))]),_:1})):u("",!0)]))])])):(i(),f("div",Pe,[a("div",Ie,[l(e(z),{class:"h-16 w-16 mx-auto text-muted-foreground/50"}),t[1]||(t[1]=a("h3",{class:"font-medium text-lg"},"Selecciona un hito",-1)),t[2]||(t[2]=a("p",{class:"text-sm text-muted-foreground"}," Elige un hito de la lista para ver sus detalles y entregables ",-1))])]))]),_:1})])])}}});export{xt as _};
