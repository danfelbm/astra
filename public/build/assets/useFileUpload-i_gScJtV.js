import{r as p,a as c}from"./app-yzaaqDxA.js";function z(){const d=p(!1),u=p({}),f=p(new Map),l=()=>{const r=window.location.pathname;return r.startsWith("/admin")?"/admin":r.startsWith("/miembro")?"/miembro":""};return{isUploading:d,uploadProgress:u,uploadErrors:f,uploadFiles:async(r,e)=>{var s,t;d.value=!0,f.value.clear();const a=new FormData;r.forEach(o=>{a.append("files[]",o)}),a.append("module",e.module),a.append("field_id",e.fieldId),e.folder&&a.append("folder",e.folder),e.maxSize&&a.append("max_size",e.maxSize.toString());try{const o=await c.post(`${l()}/api/files/upload`,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:n=>{if(n.total){const i=Math.round(n.loaded*100/n.total);r.forEach(m=>{u.value[m.name]=i,e.onProgress&&e.onProgress(m.name,i)})}}});if(o.data.success)return e.onSuccess&&e.onSuccess(o.data.files),o.data.files;throw new Error(o.data.message||"Error al subir archivos")}catch(o){const n=((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||o.message||"Error desconocido al subir archivos";throw r.forEach(i=>{f.value.set(i.name,n)}),e.onError&&e.onError(o),o}finally{d.value=!1,setTimeout(()=>{u.value={}},2e3)}},deleteFile:async r=>{try{return(await c.delete(`${l()}/api/files/delete`,{data:{path:r}})).data.success}catch(e){return console.error("Error al eliminar archivo:",e),!1}},downloadFile:async(r,e)=>{try{const a=await c.get(`${l()}/api/files/download`,{params:{path:r},responseType:"blob"}),s=window.URL.createObjectURL(new Blob([a.data])),t=document.createElement("a");t.href=s,t.setAttribute("download",e||r.split("/").pop()||"archivo"),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(s)}catch(a){throw console.error("Error al descargar archivo:",a),a}},getFileInfo:async r=>{try{const e=await c.get(`${l()}/api/files/info`,{params:{path:r}});return e.data.success?e.data.file:null}catch(e){return console.error("Error al obtener informaciÃ³n del archivo:",e),null}},validateFileType:(r,e)=>{var t;const a=e.split(",").map(o=>o.trim().toLowerCase()),s="."+((t=r.name.split(".").pop())==null?void 0:t.toLowerCase());return a.some(o=>o===s)},validateFileSize:(r,e)=>{const a=e*1024*1024;return r.size<=a},formatFileSize:r=>{if(r===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(r)/Math.log(e));return Math.round(r/Math.pow(e,s)*100)/100+" "+a[s]}}}export{z as u};
