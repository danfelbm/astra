import{d as M,i as m,e,w as o,f as t,h as d,F as tt,k as et,g as r,m as n,b as g,j as u,y as ot,v as K,t as h,r as A,c as H,s as w,n as G}from"./app-DsXE2pWc.js";import{_ as at}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BJpgPWDW.js";import{c as st,_}from"./createLucideIcon-DouqM7Af.js";import{_ as B,c as z,a as it,b as lt}from"./CardTitle.vue_vue_type_script_setup_true_lang-xy0V8ZYM.js";import{O as nt}from"./ObligacionTree-B9f1QM4H.js";import{_ as Q}from"./index-y46K_9sH.js";import{a as rt,b as X,c as V,d as ct,_ as dt,e as j}from"./TableHeader.vue_vue_type_script_setup_true_lang-B19sEPdQ.js";import{_ as mt,a as ut,b as ft,e as I,d as pt}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DjLWJI2c.js";import{u as W}from"./usePermissions-CA0C1Fxp.js";import{C as vt}from"./circle-alert-BRENL4vk.js";import{E as bt}from"./ellipsis-vertical-CIj1_xfj.js";import{E as gt}from"./eye-irxjha9f.js";import{P as xt}from"./pencil-C0Zo8c6G.js";import{T as ht}from"./trash-2-DYWzh1AW.js";import{_ as _t}from"./Input.vue_vue_type_script_setup_true_lang-CZjvqwkd.js";import{_ as J}from"./Label.vue_vue_type_script_setup_true_lang-BTG0OZau.js";import{_ as yt}from"./AddContratosModal.vue_vue_type_script_setup_true_lang-DYbrZ8k-.js";import{S as kt}from"./search-BN_4pExK.js";import{F as D}from"./file-text-DfLCxJYs.js";import{X as T}from"./x-yKNShXT9.js";import{_ as $t}from"./Pagination.vue_vue_type_script_setup_true_lang-CJu-nDy8.js";import{t as N}from"./index-m72Zk-4d.js";import{l as wt}from"./lodash-DPorlz1U.js";import{D as Ct}from"./download-C7bnvtBJ.js";import{P as St}from"./plus-dUDcGxZl.js";import{T as Ft}from"./tree-pine-aPzpyjPF.js";import{L as Ot}from"./list-BCgqv5bX.js";import"./useFlashMessages-CGfrcOeM.js";import"./index-DAR7lzPI.js";import"./floating-ui.vue-DzTgyoI6.js";import"./index-CeQoWpaA.js";import"./shield-DACf9x8q.js";import"./user-DCuOmdtA.js";import"./chevron-right-B6Xp79RV.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-RKJOy7-G.js";import"./VisuallyHidden-CMJYJfaX.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-D3WTtkQ-.js";import"./index-t5DUeMD0.js";import"./check-D5piUvgk.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CM1CkMqd.js";import"./map-pin-B6p31ase.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-D5oklv-b.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CwKfbOu2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-BPosUKQo.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-hHg2FrHb.js";import"./tag-BkqJ0RJe.js";import"./users-BYEo5yWZ.js";import"./target-JnPkIZyO.js";import"./vote-D7d78Kwy.js";import"./folder-open-CijtWzyH.js";import"./send-CB1yZuS_.js";import"./briefcase-BJhP6bZE.js";import"./calendar-DIP-jwI8.js";import"./megaphone-BvWbwmeA.js";import"./user-check-5cFJ_Y_Z.js";import"./clipboard-list-D4NcI0fM.js";import"./mail-Ch1JxZzN.js";import"./message-square-C7bp91Te.js";import"./external-link-Cmz6L_Z6.js";import"./panel-left-BiPU9AaT.js";import"./index-BUTl1shx.js";import"./Separator.vue_vue_type_script_setup_true_lang-QYNq_sRQ.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-itcAXDd5.js";import"./circle-Q77RbNeT.js";import"./layers-CdEu64lT.js";import"./paperclip-DiDgeU1m.js";import"./loader-circle-mh6hscsc.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-D9hLrHcA.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-C65_02EH.js";import"./index-HQdd8uCJ.js";import"./useKbd-kRIii9yh.js";import"./utils-BNLTfb3r.js";import"./VisuallyHiddenInput-ozqQFXsy.js";import"./contratos-BiUTbrRP.js";import"./chevron-left-B1orQdC5.js";import"./es-BDPlFIsO.js";import"./parseISO-DFjB8F03.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=st("CornerDownRightIcon",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),Vt={key:0},jt={class:"flex items-center"},Bt={class:"text-sm text-gray-600"},zt={key:0,class:"text-sm"},Dt={key:1,class:"text-sm text-gray-400"},Tt={key:1,class:"text-center py-8 text-gray-500"},At=M({__name:"ObligacionTable",props:{obligaciones:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1}},emits:["view","edit","delete"],setup(a,{emit:b}){const y=b,{hasPermission:f}=W();return(x,s)=>(n(),m("div",null,[a.obligaciones&&a.obligaciones.length>0?(n(),m("div",Vt,[e(t(dt),null,{default:o(()=>[e(t(rt),null,{default:o(()=>[e(t(X),null,{default:o(()=>[e(t(V),null,{default:o(()=>[...s[0]||(s[0]=[d("Título",-1)])]),_:1}),e(t(V),null,{default:o(()=>[...s[1]||(s[1]=[d("Descripción",-1)])]),_:1}),e(t(V),null,{default:o(()=>[...s[2]||(s[2]=[d("Archivos",-1)])]),_:1}),e(t(V),{class:"text-right"},{default:o(()=>[...s[3]||(s[3]=[d("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(ct),null,{default:o(()=>[(n(!0),m(tt,null,et(a.obligaciones,i=>(n(),g(t(X),{key:i.id},{default:o(()=>[e(t(j),{class:"font-medium"},{default:o(()=>[r("div",jt,[i.nivel>0?(n(),m("span",{key:0,class:"flex items-center text-muted-foreground mr-2",style:ot({paddingLeft:`${(i.nivel-1)*12}px`})},[e(t(Et),{class:"h-4 w-4"})],4)):u("",!0),r("div",null,[e(t(K),{href:`/admin/obligaciones/${i.id}`,class:"hover:text-blue-600 hover:underline"},{default:o(()=>[d(h(i.titulo),1)]),_:2},1032,["href"]),i.padre?(n(),g(t(Q),{key:0,variant:"secondary",class:"ml-2 text-xs"},{default:o(()=>[...s[4]||(s[4]=[d(" Hija ",-1)])]),_:1})):u("",!0),i.tiene_hijos?(n(),g(t(Q),{key:1,variant:"outline",class:"ml-1 text-xs"},{default:o(()=>[d(h(i.total_hijos)+" hijos ",1)]),_:2},1024)):u("",!0)])])]),_:2},1024),e(t(j),null,{default:o(()=>[r("span",Bt,h(i.descripcion?i.descripcion.length>100?i.descripcion.substring(0,100)+"...":i.descripcion:"Sin descripción"),1)]),_:2},1024),e(t(j),null,{default:o(()=>{var k;return[(k=i.archivos_adjuntos)!=null&&k.length?(n(),m("span",zt,h(i.archivos_adjuntos.length)+" archivo(s) ",1)):(n(),m("span",Dt,"Sin archivos"))]}),_:2},1024),e(t(j),{class:"text-right"},{default:o(()=>[e(t(mt),null,{default:o(()=>[e(t(ut),{asChild:""},{default:o(()=>[e(t(_),{variant:"ghost",size:"icon",class:"h-8 w-8"},{default:o(()=>[e(t(bt),{class:"h-4 w-4"})]),_:1})]),_:1}),e(t(ft),{align:"end"},{default:o(()=>[e(t(I),{onClick:k=>y("view",i)},{default:o(()=>[e(t(gt),{class:"h-4 w-4 mr-2"}),s[5]||(s[5]=d(" Ver ",-1))]),_:1},8,["onClick"]),a.canEdit||t(f)("obligaciones.edit")?(n(),g(t(I),{key:0,onClick:k=>y("edit",i)},{default:o(()=>[e(t(xt),{class:"h-4 w-4 mr-2"}),s[6]||(s[6]=d(" Editar ",-1))]),_:1},8,["onClick"])):u("",!0),e(t(pt)),a.canDelete||t(f)("obligaciones.delete")?(n(),g(t(I),{key:1,class:"text-red-600",onClick:k=>y("delete",i)},{default:o(()=>[e(t(ht),{class:"h-4 w-4 mr-2"}),s[7]||(s[7]=d(" Eliminar ",-1))]),_:1},8,["onClick"])):u("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(n(),m("div",Tt,[e(t(vt),{class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),s[8]||(s[8]=r("p",null,"No se encontraron obligaciones",-1)),s[9]||(s[9]=r("p",{class:"text-sm mt-1"},"Crea una nueva obligación para comenzar",-1))]))]))}}),Lt={class:"flex flex-col sm:flex-row gap-4"},Pt={class:"flex-1"},It={class:"relative"},Nt={key:0,class:"w-full sm:w-auto"},Mt={key:0,class:"flex items-center gap-2 px-3 py-2 bg-muted rounded-lg"},Rt={class:"flex-1 min-w-0"},Ut={class:"font-medium text-sm truncate"},qt={key:0,class:"text-xs text-muted-foreground truncate"},Ht={key:1,class:"flex items-center gap-2 px-3 py-2 bg-muted rounded-lg"},Gt={class:"flex-1 min-w-0"},Qt={class:"font-medium text-sm"},Xt=M({__name:"ObligacionFilters",props:{modelValue:{},proyectos:{default:()=>[]},loading:{type:Boolean,default:!1},showContratoFilter:{type:Boolean,default:!0},contratoSeleccionado:{default:null}},emits:["update:modelValue","update:contratoSeleccionado","filter","clear"],setup(a,{emit:b}){const y=a,f=b,x=A(!1),s=A(y.contratoSeleccionado),i=H({get:()=>y.modelValue,set:p=>f("update:modelValue",p)}),k=H(()=>i.value.search||y.showContratoFilter&&i.value.contrato_id),L=p=>{i.value={...i.value,search:p},f("filter")},P=p=>{p.contratoIds.length>0&&(i.value={...i.value,contrato_id:p.contratoIds[0]},p.contratos&&p.contratos.length>0&&(s.value=p.contratos[0],f("update:contratoSeleccionado",p.contratos[0])),f("filter"))},S=()=>{i.value={...i.value,contrato_id:null},s.value=null,f("update:contratoSeleccionado",null),f("filter")},F=()=>{i.value={search:"",contrato_id:null},s.value=null,f("update:contratoSeleccionado",null),f("clear")};return(p,v)=>(n(),g(t(B),null,{default:o(()=>[e(t(z),{class:"pt-6"},{default:o(()=>[r("div",Lt,[r("div",Pt,[e(t(J),{for:"search",class:"sr-only"},{default:o(()=>[...v[2]||(v[2]=[d("Buscar",-1)])]),_:1}),r("div",It,[e(t(kt),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e(t(_t),{id:"search","model-value":i.value.search,type:"text",placeholder:"Buscar por título o descripción...",class:"pl-10",disabled:a.loading,"onUpdate:modelValue":L},null,8,["model-value","disabled"])])]),a.showContratoFilter?(n(),m("div",Nt,[e(t(J),{for:"contrato_filter",class:"sr-only"},{default:o(()=>[...v[3]||(v[3]=[d("Contrato",-1)])]),_:1}),s.value?(n(),m("div",Mt,[e(t(D),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),r("div",Rt,[r("p",Ut,h(s.value.nombre),1),s.value.proyecto?(n(),m("p",qt,h(s.value.proyecto.nombre),1)):u("",!0)]),e(t(_),{type:"button",variant:"ghost",size:"sm",class:"h-6 w-6 p-0 flex-shrink-0",onClick:S},{default:o(()=>[e(t(T),{class:"h-4 w-4"})]),_:1})])):i.value.contrato_id?(n(),m("div",Ht,[e(t(D),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),r("div",Gt,[r("p",Qt,"Contrato #"+h(i.value.contrato_id),1),v[4]||(v[4]=r("p",{class:"text-xs text-muted-foreground"},"Filtro activo",-1))]),e(t(_),{type:"button",variant:"ghost",size:"sm",class:"h-6 w-6 p-0 flex-shrink-0",onClick:S},{default:o(()=>[e(t(T),{class:"h-4 w-4"})]),_:1})])):(n(),g(t(_),{key:2,type:"button",variant:"outline",onClick:v[0]||(v[0]=O=>x.value=!0),disabled:a.loading,class:"w-full sm:w-auto"},{default:o(()=>[e(t(D),{class:"h-4 w-4 mr-2"}),v[5]||(v[5]=d(" Filtrar por Contrato ",-1))]),_:1},8,["disabled"])),e(yt,{modelValue:x.value,"onUpdate:modelValue":v[1]||(v[1]=O=>x.value=O),title:"Filtrar por Contrato",description:"Selecciona el contrato para filtrar las obligaciones","search-endpoint":"/admin/contratos/search",proyectos:a.proyectos,"excluded-ids":[],"max-selection":1,"submit-button-text":"Aplicar Filtro",onSubmit:P},null,8,["modelValue","proyectos"])])):u("",!0),k.value?(n(),g(t(_),{key:1,variant:"ghost",size:"icon",disabled:a.loading,onClick:F,title:"Limpiar filtros"},{default:o(()=>[e(t(T),{class:"h-4 w-4"})]),_:1},8,["disabled"])):u("",!0)])]),_:1})]),_:1}))}}),Jt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Kt={class:"flex items-center justify-between"},Wt={class:"text-3xl font-bold"},Yt={key:0,class:"text-sm text-gray-600"},Zt={class:"flex items-center gap-2"},te={class:"flex items-center justify-between"},ee={class:"flex items-center gap-2"},oe={class:"text-sm text-blue-800"},ae={class:"font-medium"},se={key:0,class:"text-blue-600"},ie={class:"text-2xl font-bold"},le={class:"flex items-center justify-between"},ne={class:"flex items-center gap-2"},re={key:0},ce={key:1},de={key:0,class:"mt-4 flex justify-center"},Ao=M({__name:"Index",props:{obligaciones:{},estadisticas:{},filters:{},contrato:{},proyectos:{},estadisticasResponsables:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canExport:{type:Boolean}},setup(a){var R,U,q;const b=a,y=b.contrato?[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:b.contrato.nombre,href:`/admin/contratos/${b.contrato.id}`},{title:"Obligaciones",href:"#"}]:[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"}],{hasPermission:f}=W(),x=A("tabla"),s=A({search:((R=b.filters)==null?void 0:R.search)||"",contrato_id:((U=b.filters)==null?void 0:U.contrato_id)||((q=b.contrato)==null?void 0:q.id)||null}),i=wt.debounce(()=>{w.get(route("admin.obligaciones.index"),s.value,{preserveState:!0,preserveScroll:!0})},300),k=()=>{var c;s.value={search:"",contrato_id:((c=b.contrato)==null?void 0:c.id)||null},i()},L=()=>{w.get(route("admin.obligaciones.index"),{search:s.value.search},{preserveState:!1})},P=()=>{var c;w.visit(route("admin.obligaciones.create",{contrato_id:(c=b.contrato)==null?void 0:c.id}))},S=c=>{w.visit(route("admin.obligaciones.show",c.id))},F=c=>{w.visit(route("admin.obligaciones.edit",c.id))},p=c=>{const l=c.tiene_hijos?`¿Estás seguro de eliminar "${c.titulo}" y todas sus obligaciones hijas?`:`¿Estás seguro de eliminar "${c.titulo}"?`;confirm(l)&&w.delete(route("admin.obligaciones.destroy",c.id),{preserveScroll:!0,onSuccess:()=>{N.success("Obligación eliminada exitosamente")}})},v=c=>{w.post(route("admin.obligaciones.completar",c.id),{},{preserveScroll:!0,onSuccess:()=>{N.success("Obligación marcada como cumplida")}})},O=c=>{w.visit(route("admin.obligaciones.create",{contrato_id:c.contrato_id,parent_id:c.id}))},Y=(c,l,E)=>{w.post(route("admin.obligaciones.mover",c.id),{nuevo_parent_id:l,nuevo_orden:E},{preserveScroll:!0,onSuccess:()=>{N.success("Obligación movida exitosamente")}})},Z=()=>{window.open(route("admin.obligaciones.exportar",s.value),"_blank")};return(c,l)=>(n(),g(at,{breadcrumbs:t(y)},{default:o(()=>{var E;return[r("div",Jt,[r("div",Kt,[r("div",null,[r("h1",Wt,[l[3]||(l[3]=d(" Obligaciones ",-1)),a.contrato?(n(),m("span",Yt," - "+h(a.contrato.nombre),1)):u("",!0)]),l[4]||(l[4]=r("p",{class:"text-gray-600 mt-1"},"Gestiona las obligaciones de los contratos",-1))]),r("div",Zt,[a.canExport||t(f)("obligaciones.export")?(n(),g(t(_),{key:0,variant:"outline",size:"sm",onClick:Z},{default:o(()=>[e(t(Ct),{class:"h-4 w-4 mr-2"}),l[5]||(l[5]=d(" Exportar ",-1))]),_:1})):u("",!0),a.canCreate||t(f)("obligaciones.create")?(n(),g(t(K),{key:1,href:c.route("admin.obligaciones.create",{contrato_id:(E=a.contrato)==null?void 0:E.id})},{default:o(()=>[e(t(_),null,{default:o(()=>[e(t(St),{class:"h-4 w-4 mr-2"}),l[6]||(l[6]=d(" Nueva Obligación ",-1))]),_:1})]),_:1},8,["href"])):u("",!0)])]),a.contrato?(n(),g(t(B),{key:0,class:"border-blue-200 bg-blue-50"},{default:o(()=>[e(t(z),{class:"py-3"},{default:o(()=>[r("div",te,[r("div",ee,[e(t(D),{class:"h-4 w-4 text-blue-600"}),r("span",oe,[l[7]||(l[7]=d(" Filtrando por contrato: ",-1)),r("span",ae,h(a.contrato.nombre),1),a.contrato.proyecto?(n(),m("span",se," ("+h(a.contrato.proyecto.nombre)+")",1)):u("",!0)])]),e(t(_),{variant:"ghost",size:"sm",class:"h-8 text-blue-700 hover:text-blue-900 hover:bg-blue-100",onClick:L},{default:o(()=>[e(t(T),{class:"h-4 w-4 mr-1"}),l[8]||(l[8]=d(" Quitar filtro ",-1))]),_:1})])]),_:1})]),_:1})):u("",!0),e(Xt,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=$=>s.value=$),proyectos:a.proyectos||[],"show-contrato-filter":!a.contrato,onFilter:t(i),onClear:k},null,8,["modelValue","proyectos","show-contrato-filter","onFilter"]),e(t(B),null,{default:o(()=>[e(t(z),{class:"pt-6"},{default:o(()=>{var $,C;return[r("div",ie,h(((C=($=a.obligaciones)==null?void 0:$.data)==null?void 0:C.length)||0),1),l[9]||(l[9]=r("p",{class:"text-sm text-gray-600"},"Total Obligaciones",-1))]}),_:1})]),_:1}),e(t(B),{class:"flex-1"},{default:o(()=>[e(t(it),null,{default:o(()=>[r("div",le,[e(t(lt),null,{default:o(()=>[...l[10]||(l[10]=[d("Lista de Obligaciones",-1)])]),_:1}),r("div",ne,[e(t(_),{variant:"ghost",size:"sm",class:G({"bg-gray-100":x.value==="arbol"}),onClick:l[1]||(l[1]=$=>x.value="arbol")},{default:o(()=>[e(t(Ft),{class:"h-4 w-4 mr-1"}),l[11]||(l[11]=d(" Árbol ",-1))]),_:1},8,["class"]),e(t(_),{variant:"ghost",size:"sm",class:G({"bg-gray-100":x.value==="tabla"}),onClick:l[2]||(l[2]=$=>x.value="tabla")},{default:o(()=>[e(t(Ot),{class:"h-4 w-4 mr-1"}),l[12]||(l[12]=d(" Tabla ",-1))]),_:1},8,["class"])])])]),_:1}),e(t(z),null,{default:o(()=>{var $,C;return[x.value==="arbol"&&a.obligaciones.data&&a.obligaciones.data.length>0?(n(),m("div",re,[e(nt,{obligaciones:a.obligaciones.data,contratoId:($=a.contrato)==null?void 0:$.id,editable:!0,onCreate:P,onEdit:F,onDelete:p,onComplete:v,onAddChild:O,onMove:Y},null,8,["obligaciones","contratoId"])])):x.value==="tabla"?(n(),m("div",ce,[e(At,{obligaciones:a.obligaciones.data||[],"can-edit":a.canEdit,"can-delete":a.canDelete,onView:S,onEdit:F,onDelete:p},null,8,["obligaciones","can-edit","can-delete"]),a.obligaciones.links&&((C=a.obligaciones.data)!=null&&C.length)?(n(),m("div",de,[e($t,{links:a.obligaciones.links,meta:a.obligaciones.meta},null,8,["links","meta"])])):u("",!0)])):u("",!0)]}),_:1})]),_:1})])]}),_:1},8,["breadcrumbs"]))}});export{Ao as default};
