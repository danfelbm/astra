import{d as J,r as C,i as c,e as t,f as s,g as d,w as i,u as a,h as o,j as _,b as y,n as S,F as w,k as x,t as g,l as Q}from"./app-BxMQdeji.js";import{a as I,b as D,c as N,_ as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-BnCOEwdG.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-Cv61jd0z.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-BlmtfhYq.js";import{_ as R}from"./Textarea.vue_vue_type_script_setup_true_lang-BmTqlBLA.js";import{_ as k}from"./createLucideIcon-C-UWYrfi.js";import{_ as E}from"./index-BV26-s10.js";import{_ as Y,a as Z,b as ee,c as ae,d as L}from"./SelectValue.vue_vue_type_script_setup_true_lang-C_cC4TmA.js";import{_ as V}from"./InputError.vue_vue_type_script_setup_true_lang-EO9ztuT3.js";import{L as se}from"./loader-circle-DBrkq7WX.js";import{P as le}from"./paperclip-BJwPpZCJ.js";import{X as O}from"./x-CtZ-Yk1L.js";import{U as ie}from"./upload-CVF3WOvj.js";const te={key:0},oe={key:0,class:"mb-4"},re={class:"space-y-2 mt-2"},ne={class:"flex items-center gap-2"},ue={class:"text-sm"},de={key:1,class:"mt-4"},me={class:"space-y-2 mt-2"},ce={class:"flex items-center gap-2"},fe={class:"text-sm"},pe={class:"flex justify-end gap-2"},Ae=J({__name:"ObligacionForm",props:{obligacion:{},contratoId:{},parentId:{},onSubmit:{},onCancel:{},loading:{type:Boolean,default:!1},errors:{default:()=>({})}},emits:["submit","cancel"],setup(T,{emit:K}){var j,z,M;const h=T,q=K,r=C({contrato_id:h.contratoId,parent_id:h.parentId||((j=h.obligacion)==null?void 0:j.parent_id)||null,titulo:((z=h.obligacion)==null?void 0:z.titulo)||"",descripcion:((M=h.obligacion)==null?void 0:M.descripcion)||"",archivos:[],archivos_eliminar:[]}),f=C([]),B=C([]),G=()=>{const l={...r.value,archivos:f.value};q("submit",l)},W=l=>{const e=l.target;if(!e.files)return;const p=Array.from(e.files).filter(n=>n.size>5*1024*1024?(alert(`El archivo ${n.name} excede el tamaño máximo de 5MB`),!1):!0);f.value.push(...p),r.value.archivos=f.value,e.value=""},X=l=>{f.value.splice(l,1),r.value.archivos=f.value},H=l=>{confirm("¿Estás seguro de eliminar este archivo?")&&(r.value.archivos_eliminar=r.value.archivos_eliminar||[],r.value.archivos_eliminar.push(l))},A=l=>{if(!l)return"0 KB";const e=["B","KB","MB","GB"],m=Math.floor(Math.log(l)/Math.log(1024));return`${(l/Math.pow(1024,m)).toFixed(1)} ${e[m]}`};return(l,e)=>(t(),c("form",{onSubmit:Q(G,["prevent"]),class:"space-y-4"},[s(a(P),null,{default:i(()=>[s(a(I),null,{default:i(()=>[s(a(D),null,{default:i(()=>[...e[4]||(e[4]=[o("Información Básica",-1)])]),_:1})]),_:1}),s(a(N),{class:"space-y-4"},{default:i(()=>{var m,p,n,v,$;return[d("div",null,[s(a(b),{for:"titulo",required:""},{default:i(()=>[...e[5]||(e[5]=[o("Título",-1)])]),_:1}),s(a(U),{id:"titulo",modelValue:r.value.titulo,"onUpdate:modelValue":e[0]||(e[0]=u=>r.value.titulo=u),type:"text",placeholder:"Título de la obligación",class:S({"border-red-500":(m=l.errors)==null?void 0:m.titulo})},null,8,["modelValue","class"]),(p=l.errors)!=null&&p.titulo?(t(),y(V,{key:0,message:l.errors.titulo[0]},null,8,["message"])):_("",!0)]),d("div",null,[s(a(b),{for:"descripcion"},{default:i(()=>[...e[6]||(e[6]=[o("Descripción",-1)])]),_:1}),s(a(R),{id:"descripcion",modelValue:r.value.descripcion,"onUpdate:modelValue":e[1]||(e[1]=u=>r.value.descripcion=u),placeholder:"Descripción detallada de la obligación",rows:3,class:S({"border-red-500":(n=l.errors)==null?void 0:n.descripcion})},null,8,["modelValue","class"]),(v=l.errors)!=null&&v.descripcion?(t(),y(V,{key:0,message:l.errors.descripcion[0]},null,8,["message"])):_("",!0)]),B.value.length>0?(t(),c("div",te,[s(a(b),{for:"parent_id"},{default:i(()=>[...e[7]||(e[7]=[o("Obligación Padre",-1)])]),_:1}),s(a(Y),{modelValue:r.value.parent_id,"onUpdate:modelValue":e[2]||(e[2]=u=>r.value.parent_id=u)},{default:i(()=>[s(a(Z),{id:"parent_id"},{default:i(()=>[s(a(ee),{placeholder:"Seleccionar obligación padre (opcional)"})]),_:1}),s(a(ae),null,{default:i(()=>[s(a(L),{value:null},{default:i(()=>[...e[8]||(e[8]=[o("Sin padre (raíz)",-1)])]),_:1}),(t(!0),c(w,null,x(B.value,u=>{var F;return t(),y(a(L),{key:u.id,value:u.id,disabled:u.id===((F=l.obligacion)==null?void 0:F.id)},{default:i(()=>[o(g("  ".repeat(u.nivel))+g(u.titulo),1)]),_:2},1032,["value","disabled"])}),128))]),_:1})]),_:1},8,["modelValue"]),($=l.errors)!=null&&$.parent_id?(t(),y(V,{key:0,message:l.errors.parent_id[0]},null,8,["message"])):_("",!0)])):_("",!0)]}),_:1})]),_:1}),s(a(P),null,{default:i(()=>[s(a(I),null,{default:i(()=>[s(a(D),null,{default:i(()=>[...e[9]||(e[9]=[o("Archivos Adjuntos",-1)])]),_:1})]),_:1}),s(a(N),null,{default:i(()=>{var m,p;return[(p=(m=l.obligacion)==null?void 0:m.archivos_adjuntos)!=null&&p.length?(t(),c("div",oe,[s(a(b),null,{default:i(()=>[...e[10]||(e[10]=[o("Archivos actuales",-1)])]),_:1}),d("div",re,[(t(!0),c(w,null,x(l.obligacion.archivos_adjuntos,(n,v)=>(t(),c("div",{key:v,class:"flex items-center justify-between p-2 bg-gray-50 rounded-lg"},[d("div",ne,[s(a(le),{class:"h-4 w-4 text-gray-500"}),d("span",ue,g(n.nombre_original),1),s(a(E),{variant:"outline",class:"text-xs"},{default:i(()=>[o(g(A(n.tamaño)),1)]),_:2},1024)]),s(a(k),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 text-red-600",onClick:$=>H(n.ruta)},{default:i(()=>[s(a(O),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]))),128))])])):_("",!0),d("div",null,[s(a(b),{for:"archivos"},{default:i(()=>[...e[11]||(e[11]=[o("Agregar nuevos archivos",-1)])]),_:1}),s(a(U),{id:"archivos",type:"file",multiple:"",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",onChange:W,class:"mt-1"}),e[12]||(e[12]=d("p",{class:"text-xs text-gray-500 mt-1"}," Formatos permitidos: PDF, Word, Excel, Imágenes. Máximo 5MB por archivo. ",-1))]),f.value.length>0?(t(),c("div",de,[s(a(b),null,{default:i(()=>[...e[13]||(e[13]=[o("Archivos a subir",-1)])]),_:1}),d("div",me,[(t(!0),c(w,null,x(f.value,(n,v)=>(t(),c("div",{key:v,class:"flex items-center justify-between p-2 bg-blue-50 rounded-lg"},[d("div",ce,[s(a(ie),{class:"h-4 w-4 text-blue-500"}),d("span",fe,g(n.name),1),s(a(E),{variant:"outline",class:"text-xs"},{default:i(()=>[o(g(A(n.size)),1)]),_:2},1024)]),s(a(k),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8",onClick:$=>X(v)},{default:i(()=>[s(a(O),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]))),128))])])):_("",!0)]}),_:1})]),_:1}),d("div",pe,[s(a(k),{type:"button",variant:"outline",onClick:e[3]||(e[3]=m=>l.$emit("cancel")),disabled:l.loading},{default:i(()=>[...e[14]||(e[14]=[o(" Cancelar ",-1)])]),_:1},8,["disabled"]),s(a(k),{type:"submit",disabled:l.loading||!r.value.titulo},{default:i(()=>[l.loading?(t(),y(a(se),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):_("",!0),o(" "+g(l.obligacion?"Actualizar":"Crear")+" Obligación ",1)]),_:1},8,["disabled"])])],32))}});export{Ae as _};
