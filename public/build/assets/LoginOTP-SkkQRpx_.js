import{d as D,k as b,c as T,p as H,O as Q,j as w,o as t,L as G,e as u,a as o,i as C,b as n,u as e,g as l,f as i,t as c,q as L,C as U,m as J,h as M,n as K,F as Y,r as Z}from"./app-CZw07Q93.js";import{_ as W}from"./InputError.vue_vue_type_script_setup_true_lang-DSWNcH0C.js";import{_ as ee}from"./TextLink.vue_vue_type_script_setup_true_lang-CA5GS0F8.js";import{a as te,b as se,c as ae,_ as oe}from"./CardTitle.vue_vue_type_script_setup_true_lang-BFumUwpC.js";import{_ as B,a as O}from"./index-C1lK0tto.js";import{_ as F}from"./AlertTitle.vue_vue_type_script_setup_true_lang-BcOPBB6U.js";import{_ as ne}from"./index-5Kpx2wY0.js";import{_ as R}from"./createLucideIcon-C7u-R01f.js";import{_ as ie}from"./Progress.vue_vue_type_script_setup_true_lang-D1qv7iUT.js";import{_ as z}from"./Skeleton.vue_vue_type_script_setup_true_lang-BNP5gXb2.js";import{L as j}from"./loader-circle-DQOYm3pg.js";import{C as le}from"./clock-B7XkIYej.js";import{C as re}from"./circle-alert-uWMA2z83.js";import{T as de}from"./timer-CHU9w_AG.js";import{I as ue}from"./info-C6nInk1C.js";import{R as ce}from"./refresh-cw-hcMmN_fK.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as me}from"./Input.vue_vue_type_script_setup_true_lang-DCxWTU2m.js";import{_ as N}from"./Label.vue_vue_type_script_setup_true_lang-BGrzXVeU.js";import{_ as fe,a as ve,b as _e}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-CxXvzSAp.js";import{_ as ge}from"./AuthLayout.vue_vue_type_script_setup_true_lang-Db4UlY9S.js";import{M as he}from"./mail-DNbu5yws.js";import"./index-DbmmK8pQ.js";import"./VisuallyHidden-C29Bi-F2.js";import"./nullish-CHIgUVhi.js";import"./VisuallyHiddenInput-BlgdTmEt.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-XREYgAdr.js";const ye={key:0,class:"mt-4"},xe={key:0,class:"space-y-3"},be={key:1,class:"space-y-4"},ke={key:0,class:"space-y-2"},Ce={class:"flex items-center justify-between"},we={class:"text-sm text-muted-foreground"},$e={key:1,class:"space-y-2"},Ie={key:2,class:"space-y-2"},Ee={class:"flex items-center justify-between"},Re={class:"text-sm font-medium"},Te={class:"flex items-center gap-2 text-xs text-muted-foreground"},Se={key:3,class:"mt-4 pt-4 border-t"},Ve={key:2,class:"text-center py-4"},je=D({__name:"OTPQueueStatus",props:{type:{},identifier:{},autoRefresh:{type:Boolean,default:!0},refreshInterval:{default:5e3},showRateLimitInfo:{type:Boolean,default:!0}},emits:["statusUpdate","error"],setup(q,{emit:p}){const f=q,_=p,m=b(!1),g=b(!1),a=b(null),x=b(5),v=b(null),h=b(null),y=T(()=>{if(!a.value||a.value.total_ahead===0)return 100;const k=a.value.position+10,r=k-a.value.position;return Math.min(100,Math.round(r/k*100))}),S=T(()=>f.type==="email"?2:5),$=async()=>{var k;m.value=!0;try{const r=await L.get(`/api/queue/otp/position/${encodeURIComponent(f.identifier)}`,{params:{type:f.type}});r.data.success&&(a.value=r.data.data,g.value=!0,_("statusUpdate",a.value),a.value.position===0&&V())}catch(r){if(((k=r.response)==null?void 0:k.status)===404)try{const d=await L.get("/api/queue/otp/estimate",{params:{type:f.type}});d.data.success&&(a.value=d.data.data,g.value=!0,_("statusUpdate",a.value))}catch(d){console.error("Error obteniendo estimación:",d),_("error",d)}else console.error("Error verificando estado:",r),_("error",r)}finally{m.value=!1}},I=()=>{f.autoRefresh&&(v.value=window.setInterval(()=>{$(),P()},f.refreshInterval),h.value=window.setInterval(()=>{x.value=Math.max(0,x.value-1)},1e3))},V=()=>{v.value&&(clearInterval(v.value),v.value=null),h.value&&(clearInterval(h.value),h.value=null)},P=()=>{x.value=Math.floor(f.refreshInterval/1e3)};return H(()=>{$(),I()}),Q(()=>{V()}),(k,r)=>(t(),w(G,{name:"fade"},{default:u(()=>[g.value?(t(),o("div",ye,[n(e(oe),null,{default:u(()=>[n(e(te),null,{default:u(()=>[n(e(se),{class:"flex items-center gap-2"},{default:u(()=>[m.value?(t(),w(e(j),{key:0,class:"h-4 w-4 animate-spin"})):(t(),w(e(le),{key:1,class:"h-4 w-4"})),r[0]||(r[0]=l(" Estado de envío de tu código ",-1))]),_:1})]),_:1}),n(e(ae),null,{default:u(()=>[m.value?(t(),o("div",xe,[n(e(z),{class:"h-4 w-full"}),n(e(z),{class:"h-4 w-3/4"})])):a.value?(t(),o("div",be,[a.value.position>1?(t(),o("div",ke,[i("div",Ce,[r[1]||(r[1]=i("span",{class:"text-sm text-muted-foreground"},"Posición en cola",-1)),n(e(ne),{variant:"secondary"},{default:u(()=>[l(c(a.value.position),1)]),_:1})]),n(e(ie),{value:y.value,class:"h-2"},null,8,["value"]),i("p",we,c(a.value.total_ahead)+" personas delante de ti ",1)])):a.value.position===1?(t(),o("div",$e,[n(e(B),null,{default:u(()=>[n(e(re),{class:"h-4 w-4"}),n(e(F),null,{default:u(()=>[...r[2]||(r[2]=[l("Procesando tu solicitud",-1)])]),_:1}),n(e(O),null,{default:u(()=>[...r[3]||(r[3]=[l(" Tu código está siendo enviado en este momento... ",-1)])]),_:1})]),_:1})])):C("",!0),a.value.estimated_seconds>0?(t(),o("div",Ie,[i("div",Ee,[r[4]||(r[4]=i("span",{class:"text-sm text-muted-foreground"},"Tiempo estimado",-1)),i("span",Re,c(a.value.estimated_time),1)]),i("div",Te,[n(e(de),{class:"h-3 w-3"}),i("span",null,"Actualizando en "+c(x.value)+"s",1)])])):C("",!0),k.showRateLimitInfo?(t(),o("div",Se,[n(e(B),{variant:"info"},{default:u(()=>[n(e(ue),{class:"h-4 w-4"}),n(e(F),null,{default:u(()=>[...r[5]||(r[5]=[l("¿Por qué la espera?",-1)])]),_:1}),n(e(O),null,{default:u(()=>[l(" Para garantizar la entrega confiable de mensajes, procesamos "+c(S.value)+" "+c(k.type==="email"?"correos":"mensajes")+" por segundo. Esto nos ayuda a mantener un servicio estable para todos. ",1)]),_:1})]),_:1})])):C("",!0)])):(t(),o("div",Ve,[r[7]||(r[7]=i("p",{class:"text-sm text-muted-foreground"}," No se pudo obtener el estado de la cola ",-1)),n(e(R),{onClick:$,variant:"ghost",size:"sm",class:"mt-2"},{default:u(()=>[n(e(ce),{class:"h-3 w-3 mr-2"}),r[6]||(r[6]=l(" Reintentar ",-1))]),_:1})]))]),_:1})]),_:1})])):C("",!0)]),_:1}))}}),A=pe(je,[["__scopeId","data-v-f9ac226f"]]),qe={key:0,class:"mb-4 text-center text-muted-foreground"},Pe={key:0},Ue={key:0},Ae={key:1},Le={key:2},Me={key:3},We={key:1},Be={key:1,class:"mb-4 text-center text-muted-foreground"},Oe={key:0},Fe={key:1},ze={key:2},Ne={key:2,class:"mb-4 text-center text-sm font-medium text-green-600"},De={class:"grid gap-6"},He={class:"grid gap-2"},Qe={class:"relative"},Xe={class:"grid gap-6"},Ge={class:"text-center"},Je={class:"text-sm text-muted-foreground"},Ke={key:0},Ye={key:0},Ze={class:"font-medium"},et={key:1},tt={class:"font-medium"},st={key:2},at={class:"font-medium"},ot={key:1},nt={key:0},it={class:"font-medium"},lt={key:1},rt={class:"font-medium"},dt={class:"font-medium"},ut={key:2},ct={class:"font-medium"},pt={class:"font-medium"},mt={key:0},ft={key:1},vt={class:"grid gap-2"},_t={class:"flex justify-center"},gt={class:"flex flex-col gap-3"},ht={class:"flex flex-col gap-2 text-center"},yt={key:5,class:"mt-6 text-center text-sm text-muted-foreground"},xt={class:"mt-6 text-center text-xs text-muted-foreground"},bt={key:0},kt={key:1},Jt=D({__name:"LoginOTP",props:{status:{},authConfig:{},censoredEmail:{},otpCredential:{},otpChannel:{},whatsappEnabled:{type:Boolean},intendedUrl:{}},setup(q){const p=q,f=b(p.censoredEmail?"otp":"credential"),_=b(p.censoredEmail||""),m=T(()=>p.authConfig||{login_type:"email",input_type:"email",placeholder:"correo@ejemplo.com",pattern:null,label:"Correo Electrónico"}),g=U({credential:""}),a=U({credential:p.otpCredential||"",otp_code:[]}),x=U({credential:"",otp_code:""}),v=b(!1),h=b(0),y=b(null),S=T(()=>h.value===0),$=T(()=>h.value>0?`Reenviar en ${h.value}s`:"Reenviar código"),I=(d=60)=>{h.value=d,y.value&&clearInterval(y.value),y.value=window.setInterval(()=>{h.value--,h.value<=0&&(clearInterval(y.value),y.value=null)},1e3)},V=()=>{v.value=!0,g.post(route("auth.request-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),f.value="otp",a.credential=g.credential,a.clearErrors(),I(60)},onError:()=>{},onFinish:()=>{v.value=!1}})},P=()=>{const d=a.otp_code.join("");x.credential=a.credential,x.otp_code=d,x.post(route("auth.verify-otp"),{onSuccess:()=>{},onError:()=>{a.otp_code=[]}})},k=()=>{S.value&&(v.value=!0,a.post(route("auth.resend-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),I(60)},onFinish:()=>{v.value=!1}}))},r=()=>{f.value="credential",a.reset(),y.value&&(clearInterval(y.value),y.value=null),h.value=0};return H(()=>{f.value==="otp"&&I(60);const d=localStorage.getItem("intendedUrl");d&&!p.intendedUrl&&fetch("/login?intended="+encodeURIComponent(d),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{localStorage.removeItem("intendedUrl")})}),Q(()=>{y.value&&clearInterval(y.value)}),(d,s)=>(t(),w(ge,{title:f.value==="credential"?"Iniciar Sesión":"Verificar Código"},{default:u(()=>[n(e(J),{title:"Iniciar Sesión"}),f.value==="credential"?(t(),o("div",qe,[m.value.login_type==="documento"?(t(),o("p",Pe,[s[2]||(s[2]=l(" Ingresa tu documento de identidad para recibir el código de verificación ",-1)),d.whatsappEnabled?p.otpChannel==="whatsapp"?(t(),o("strong",Ae,"vía WhatsApp")):p.otpChannel==="both"?(t(),o("strong",Le,"vía correo electrónico y WhatsApp")):(t(),o("strong",Me,"vía correo electrónico")):(t(),o("strong",Ue,"vía correo electrónico"))])):(t(),o("p",We," Ingresa tu "+c(m.value.label.toLowerCase())+" para recibir el código de verificación ",1))])):(t(),o("div",Be,[p.otpChannel==="whatsapp"?(t(),o("p",Oe,[...s[3]||(s[3]=[l(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"WhatsApp",-1)])])):p.otpChannel==="both"?(t(),o("p",Fe,[...s[4]||(s[4]=[l(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"correo y WhatsApp",-1)])])):(t(),o("p",ze,[...s[5]||(s[5]=[l(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"correo",-1)])]))])),d.status?(t(),o("div",Ne,c(d.status),1)):C("",!0),f.value==="credential"?(t(),o("form",{key:3,onSubmit:M(V,["prevent"]),class:"flex flex-col gap-6"},[i("div",De,[i("div",He,[n(e(N),{for:"credential"},{default:u(()=>[l(c(m.value.label),1)]),_:1}),i("div",Qe,[m.value.login_type==="email"?(t(),w(e(he),{key:0,class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})):C("",!0),n(e(me),{id:"credential",type:m.value.input_type,required:"",autofocus:"",tabindex:"1",autocomplete:m.value.login_type==="email"?"email":"off",inputmode:m.value.login_type==="documento"?"numeric":void 0,modelValue:e(g).credential,"onUpdate:modelValue":s[0]||(s[0]=E=>e(g).credential=E),placeholder:m.value.placeholder,pattern:m.value.pattern,class:K({"pl-10":m.value.login_type==="email"})},null,8,["type","autocomplete","inputmode","modelValue","placeholder","pattern","class"])]),n(W,{message:e(g).errors.credential},null,8,["message"])]),n(e(R),{type:"submit",class:"mt-4 w-full",tabindex:"2",disabled:e(g).processing||v.value},{default:u(()=>[e(g).processing||v.value?(t(),w(e(j),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):C("",!0),l(" "+c(e(g).processing||v.value?"Enviando...":"Enviar Código"),1)]),_:1},8,["disabled"])])],32)):(t(),o("form",{key:4,onSubmit:M(P,["prevent"]),class:"flex flex-col gap-6"},[i("div",Xe,[i("div",Ge,[i("p",Je,[m.value.login_type==="email"?(t(),o("span",Ke,[p.otpChannel==="whatsapp"?(t(),o("span",Ye,[s[6]||(s[6]=l(" Código enviado por WhatsApp al número asociado con ",-1)),i("span",Ze,c(_.value||e(a).credential),1)])):p.otpChannel==="both"?(t(),o("span",et,[s[7]||(s[7]=l(" Código enviado al email ",-1)),i("span",tt,c(_.value||e(a).credential),1),s[8]||(s[8]=l(" y WhatsApp ",-1))])):(t(),o("span",st,[s[9]||(s[9]=l(" Código enviado al email ",-1)),i("span",at,c(_.value||e(a).credential),1)]))])):(t(),o("span",ot,[p.otpChannel==="whatsapp"?(t(),o("span",nt,[s[10]||(s[10]=l(" Código enviado por WhatsApp al número asociado con el documento ",-1)),i("span",it,c(e(a).credential),1)])):p.otpChannel==="both"?(t(),o("span",lt,[s[11]||(s[11]=l(" Código enviado al email ",-1)),i("span",rt,c(_.value),1),s[12]||(s[12]=l(" y WhatsApp asociados al documento ",-1)),i("span",dt,c(e(a).credential),1)])):(t(),o("span",ut,[s[13]||(s[13]=l(" Código enviado al email ",-1)),i("span",ct,c(_.value),1),s[14]||(s[14]=l(" asociado al documento ",-1)),i("span",pt,c(e(a).credential),1)]))]))])]),p.otpChannel==="both"?(t(),o("div",mt,[n(A,{type:"email",identifier:_.value||e(a).credential,"show-rate-limit-info":!0},null,8,["identifier"]),n(A,{type:"whatsapp",identifier:e(a).credential,"show-rate-limit-info":!0},null,8,["identifier"])])):(t(),o("div",ft,[n(A,{type:p.otpChannel==="whatsapp"?"whatsapp":"email",identifier:p.otpChannel==="whatsapp"?e(a).credential:_.value||e(a).credential,"show-rate-limit-info":!0},null,8,["type","identifier"])])),i("div",vt,[n(e(N),{class:"text-center"},{default:u(()=>[...s[15]||(s[15]=[l("Código de Verificación",-1)])]),_:1}),i("div",_t,[n(e(fe),{modelValue:e(a).otp_code,"onUpdate:modelValue":s[1]||(s[1]=E=>e(a).otp_code=E),length:6,type:"text",placeholder:"0",class:"gap-2"},{default:u(()=>[n(e(ve),null,{default:u(()=>[(t(),o(Y,null,Z(6,(E,X)=>n(e(_e),{key:E,index:X,class:"h-12 w-12 text-lg font-medium",inputmode:"numeric"},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue"])]),n(W,{message:e(a).errors.otp_code},null,8,["message"])]),i("div",gt,[n(e(R),{type:"submit",class:"w-full",disabled:e(x).processing||e(a).otp_code.join("").length!==6},{default:u(()=>[e(x).processing?(t(),w(e(j),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):C("",!0),l(" "+c(e(x).processing?"Verificando...":"Verificar Código"),1)]),_:1},8,["disabled"]),i("div",ht,[n(e(R),{type:"button",variant:"ghost",size:"sm",onClick:k,disabled:!S.value||v.value},{default:u(()=>[v.value?(t(),w(e(j),{key:0,class:"mr-2 h-3 w-3 animate-spin"})):C("",!0),l(" "+c(v.value?"Enviando...":$.value),1)]),_:1},8,["disabled"]),n(e(R),{type:"button",variant:"ghost",size:"sm",onClick:r},{default:u(()=>[l(c(m.value.login_type==="email"?"Cambiar correo electrónico":"Cambiar documento"),1)]),_:1})])])])],32)),f.value==="credential"?(t(),o("div",yt,[s[17]||(s[17]=l(" ¿Deseas ser precandidato por la Colombia Humana pero no eres militante del partido? ",-1)),n(ee,{href:d.route("register"),class:"underline underline-offset-4"},{default:u(()=>[...s[16]||(s[16]=[l("Regístrate aquí",-1)])]),_:1},8,["href"])])):C("",!0),i("div",xt,[f.value==="credential"?(t(),o("p",bt," Solo personas registradas como militantes pueden acceder al sistema. ")):(t(),o("p",kt," El código expira en 10 minutos. Si no lo recibes, verifica tu bandeja de spam. ")),s[18]||(s[18]=i("br",null,null,-1)),s[19]||(s[19]=i("p",null,[l(" Si necesitas ayuda escribe a "),i("b",null,"soporte@colombiahumana.co"),l(" para soporte sobre la plataforma. Para inquietudes jurídicas a "),i("b",null,"juridicoelectoral@colombiahumana.co")],-1))])]),_:1},8,["title"]))}});export{Jt as default};
