import{d as J,u as K,r as g,c as I,o as W,B as X,i as _,e as s,f as o,q as Y,w as i,g as t,b as N,j as M,t as d,h as m,n as b,m as f,y as ee,l as te,a4 as oe,O as ae,F as V,s as G,a as se}from"./app-BFqKuHja.js";import{_ as ie}from"./index-BF1JDgfE.js";import{_ as j}from"./createLucideIcon-tZKQ8FV-.js";import{_ as S,c as D,a as re,b as ne}from"./CardTitle.vue_vue_type_script_setup_true_lang-By0rrIVN.js";import{_ as le,a as ce,b as de,c as me,d as ue,e as ve,f as fe,g as pe}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-B21BfMIt.js";import{_ as ge}from"./UserLayout.vue_vue_type_script_setup_true_lang-p5uSO-eK.js";import{D as _e}from"./DynamicFormRenderer-CFvmmC9b.js";import{t as $}from"./index-D11OkfIY.js";import{A as xe}from"./arrow-left-CIWApkUE.js";import{C as E}from"./clock-CCWUE1Ut.js";import{T as U}from"./triangle-alert-BLD8_4dd.js";import{T as be}from"./timer-ZVGVBujY.js";import{C as he}from"./circle-alert-B3cw7wFG.js";import{V as ye}from"./vote-Xnz8P6lY.js";import{C as we}from"./circle-check-big-8EJmJICF.js";import"./index-F5rpf4iw.js";import"./VisuallyHidden-DP9KERvz.js";import"./Input.vue_vue_type_script_setup_true_lang-BV39iPGt.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DWo8uhvu.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Rq0QpW8I.js";import"./check-C0Px08fC.js";import"./floating-ui.vue-BMPmqikX.js";import"./x-Bmm2Newm.js";import"./useFlashMessages-Rq45FhUU.js";import"./index-C8QA5EYi.js";import"./index-BgOZXF3v.js";import"./shield-97w7M3te.js";import"./user-BAyKQNNj.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-FLlUFPmJ.js";import"./chevron-right-Cw5c0nod.js";import"./house-ChRKKXPV.js";import"./Label.vue_vue_type_script_setup_true_lang-Dqhxdf2C.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BEi-RCnv.js";import"./map-pin-C_udGJei.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CG0Gldao.js";import"./usePermissions-CaKOaUXD.js";import"./square-check-big-DPVSiZVK.js";import"./file-text-BGYDQgob.js";import"./users-CymRd8l_.js";import"./folder-open-BYgWiTs_.js";import"./milestone-BxypAtcB.js";import"./index-BY2HrsFe.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-BnZB2Om1.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CundgcCu.js";import"./Textarea.vue_vue_type_script_setup_true_lang-BRsVeO5i.js";import"./plus-HWvCG-pg.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-BXcwnrVT.js";import"./RovingFocusItem-Dus7TRHC.js";import"./utils-Bif_DOLm.js";import"./VisuallyHiddenInput-DELKLyLV.js";import"./circle-RQlS7lm2.js";import"./FileUploadField.vue_vue_type_script_setup_true_lang-Bw4XKUio.js";import"./useFileUpload-Gi3976OP.js";import"./upload-bOs1OWyJ.js";import"./file-Blbzk7J5.js";import"./eye-pgBp_Zgj.js";import"./download-DZp9zUYc.js";import"./useConditionalFields-DdqVvtvT.js";import"./calendar-TQY1ssum.js";import"./grip-vertical-C-IMZuRi.js";import"./trash-2-DIQRuMTg.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Te={class:"flex h-full flex-1 flex-col gap-3 sm:gap-6 rounded-xl p-2 sm:p-4"},$e={class:"flex items-center justify-between"},Ae={class:"text-3xl font-bold"},ke={class:"text-muted-foreground"},Ce={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Me={class:"flex items-center gap-2"},Ve={class:"flex items-center gap-2 text-sm text-muted-foreground"},Ge={class:"flex items-center gap-2 text-sm"},Se={class:"mt-4 pt-4 border-t"},De={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},Ee={class:"text-muted-foreground"},ze={class:"mt-1"},Be={class:"text-muted-foreground"},Fe={class:"mt-1 font-semibold text-primary"},Ie={class:"text-xs text-muted-foreground ml-1"},Ne={class:"flex items-center justify-between"},je={class:"flex items-center gap-3"},Ue={class:"text-right"},qe={class:"mt-4"},Pe={class:"w-full bg-gray-200 rounded-full h-2 overflow-hidden"},Le={key:0,class:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg"},Re={class:"flex items-center gap-2"},Qe={key:1,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg"},He={class:"flex items-center gap-2"},Oe={key:0,class:"fixed bottom-0 left-0 right-0 z-50 px-2 sm:px-4 pb-2 sm:pb-4"},Ze={class:"mx-auto max-w-7xl"},Je={class:"backdrop-blur-lg bg-white/80 dark:bg-gray-900/80 border border-gray-200/50 dark:border-gray-700/50 rounded-xl sm:rounded-2xl shadow-2xl p-3 sm:p-4"},Ke={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},We={class:"hidden sm:flex items-center gap-4 text-sm text-muted-foreground"},Xe={class:"flex items-center gap-2"},Ye={class:"font-medium"},et={class:"flex justify-center sm:justify-end"},tt={class:"sm:hidden mt-3 text-center"},ot={class:"text-xs text-muted-foreground"},vo=J({__name:"Votar",props:{votacion:{},candidatosElegibles:{}},setup(l){var B;const r=l,q=[{title:"Dashboard",href:"/miembro/dashboard"},{title:"Mis Votaciones",href:"/miembro/votaciones"},{title:"Votar",href:"#"}],v=K((()=>{const a={};return r.votacion.formulario_config.forEach(e=>{e.type==="checkbox"?a[e.id]=[]:e.type==="convocatoria"?a[e.id]=void 0:a[e.id]=""}),{respuestas:a}})()),h=g(!1),u=g(((B=r.votacion.urna_session)==null?void 0:B.remaining_seconds)||0),A=g(!!r.votacion.urna_session),n=g("normal"),y=g(null),w=g(null),P=()=>{v.post(route("user.votaciones.store",{votacion:r.votacion.id}),{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:a=>{console.error("Errores de validación:",a)}})},L=()=>{G.get(route("user.votaciones.index"))},R=a=>{if(a<=0)return"0:00";const e=Math.floor(a/60),c=a%60;return`${e}:${c.toString().padStart(2,"0")}`},k=()=>{if(!r.votacion.urna_session)return;const a=r.votacion.urna_session.warning_time,e=r.votacion.urna_session.critical_time;u.value<=e?n.value="critical":u.value<=a?n.value="warning":n.value="normal"},Q=()=>{y.value||(y.value=window.setInterval(()=>{u.value>0&&(u.value--,k(),u.value===120?$.warning("⏱️ Quedan 2 minutos para completar tu voto"):u.value===60?$.error("⚠️ Queda 1 minuto para completar tu voto"):u.value===0&&($.error("❌ Tu sesión de votación ha expirado"),setTimeout(()=>{G.get(route("user.votaciones.index"))},2e3)))},1e3))},H=async()=>{try{const a=await se.get(route("user.votaciones.check-urna-session",{votacion:r.votacion.id}));a.data.active?(u.value=a.data.remaining_seconds,A.value=!0,k()):(A.value=!1,a.data.expired&&($.error("Tu sesión de votación ha expirado"),setTimeout(()=>{G.get(route("user.votaciones.index"))},2e3)))}catch(a){console.error("Error verificando sesión de urna:",a)}},O=()=>{w.value||(w.value=window.setInterval(()=>{H()},3e4))},z=a=>({"America/Bogota":"GMT-5","America/Mexico_City":"GMT-6","America/Lima":"GMT-5","America/Argentina/Buenos_Aires":"GMT-3","America/Santiago":"GMT-3","America/Caracas":"GMT-4","America/La_Paz":"GMT-4","America/Guayaquil":"GMT-5","America/Asuncion":"GMT-3","America/Montevideo":"GMT-3","America/Panama":"GMT-5","America/Costa_Rica":"GMT-6","America/Guatemala":"GMT-6","America/Havana":"GMT-5","America/Santo_Domingo":"GMT-4"})[a]||a,C=(a,e=!0)=>{const c=a.includes("local")?a:a===r.votacion.fecha_inicio&&r.votacion.fecha_inicio_local?r.votacion.fecha_inicio_local:a===r.votacion.fecha_fin&&r.votacion.fecha_fin_local?r.votacion.fecha_fin_local:a,p=new Date(c).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});if(e&&r.votacion.timezone){const T=z(r.votacion.timezone);return`${p} (${T})`}return p},x=I(()=>{const a=new Date,c=new Date(r.votacion.fecha_fin_local||r.votacion.fecha_fin).getTime()-a.getTime();if(c<=0)return"Expirada";const p=Math.floor(c/(1e3*60*60)),T=Math.floor(c%(1e3*60*60)/(1e3*60));if(p>24){const F=Math.floor(p/24);return`${F} día${F>1?"s":""}`}else return p>0?`${p}h ${T}m`:`${T}m`}),Z=I(()=>r.votacion.formulario_config.every(a=>{const e=v.respuestas[a.id];return a.type==="convocatoria"?e!==void 0:a.required?a.type==="checkbox"?Array.isArray(e)&&e.length>0:e&&e.toString().trim()!=="":!0}));return W(()=>{r.votacion.urna_session&&(k(),Q(),O())}),X(()=>{y.value&&clearInterval(y.value),w.value&&clearInterval(w.value)}),(a,e)=>(f(),_(V,null,[s(o(Y),{title:`Votar: ${l.votacion.titulo}`},null,8,["title"]),s(ge,{breadcrumbs:q},{default:i(()=>[t("div",Te,[t("div",$e,[t("div",null,[t("h1",Ae,d(l.votacion.titulo),1),t("p",ke,d(l.votacion.descripcion),1)]),s(o(j),{variant:"outline",onClick:L},{default:i(()=>[s(o(xe),{class:"mr-2 h-4 w-4"}),e[4]||(e[4]=m(" Volver ",-1))]),_:1})]),s(o(S),null,{default:i(()=>[s(o(D),{class:"pt-6"},{default:i(()=>[t("div",Ce,[t("div",Me,[s(o(ie),{variant:"outline"},{default:i(()=>[m(d(l.votacion.categoria.nombre),1)]),_:1})]),t("div",Ve,[s(o(E),{class:"h-4 w-4"}),m(" Termina: "+d(C(l.votacion.fecha_fin)),1)]),t("div",Ge,[s(o(U),{class:"h-4 w-4 text-orange-600"}),t("span",{class:b(x.value==="Expirada"?"text-red-600":"text-orange-600")},d(x.value==="Expirada"?"Votación expirada":`Tiempo restante: ${x.value}`),3)])]),t("div",Se,[t("div",De,[t("div",Ee,[e[5]||(e[5]=t("span",{class:"font-medium"},"Periodo de votación:",-1)),t("div",ze," Inicio: "+d(C(l.votacion.fecha_inicio)),1),t("div",null," Fin: "+d(C(l.votacion.fecha_fin)),1)]),t("div",Be,[e[6]||(e[6]=t("span",{class:"font-medium"},"Zona horaria:",-1)),t("div",Fe,[m(d(z(l.votacion.timezone))+" ",1),t("span",Ie,"("+d(l.votacion.timezone)+")",1)])])])])]),_:1})]),_:1}),l.votacion.urna_session&&A.value?(f(),N(o(S),{key:0,class:b({"border-orange-500":n.value==="warning","border-red-500 animate-pulse":n.value==="critical"})},{default:i(()=>[s(o(D),{class:"pt-6"},{default:i(()=>[t("div",Ne,[t("div",je,[s(o(be),{class:b({"h-5 w-5":!0,"text-green-600":n.value==="normal","text-orange-600":n.value==="warning","text-red-600":n.value==="critical"})},null,8,["class"]),e[7]||(e[7]=t("div",null,[t("p",{class:"font-semibold"},"Tiempo de sesión de urna"),t("p",{class:"text-sm text-muted-foreground"}," Tu sesión para votar está activa ")],-1))]),t("div",Ue,[t("p",{class:b({"text-3xl font-bold":!0,"text-green-600":n.value==="normal","text-orange-600":n.value==="warning","text-red-600":n.value==="critical"})},d(R(u.value)),3),e[8]||(e[8]=t("p",{class:"text-sm text-muted-foreground"}," minutos restantes ",-1))])]),t("div",qe,[t("div",Pe,[t("div",{class:b({"h-full transition-all duration-1000":!0,"bg-green-600":n.value==="normal","bg-orange-600":n.value==="warning","bg-red-600":n.value==="critical"}),style:ee(`width: ${u.value/(l.votacion.urna_session.remaining_seconds||300)*100}%`)},null,6)])]),n.value==="warning"?(f(),_("div",Le,[t("div",Re,[s(o(he),{class:"h-4 w-4 text-orange-600"}),e[9]||(e[9]=t("p",{class:"text-sm text-orange-800"}," Tu tiempo se está agotando. Por favor, completa tu voto pronto. ",-1))])])):M("",!0),n.value==="critical"?(f(),_("div",Qe,[t("div",He,[s(o(U),{class:"h-4 w-4 text-red-600"}),e[10]||(e[10]=t("p",{class:"text-sm text-red-800 font-semibold"}," ¡ATENCIÓN! Tu sesión está a punto de expirar. Envía tu voto ahora. ",-1))])])):M("",!0)]),_:1})]),_:1},8,["class"])):M("",!0),s(o(S),null,{default:i(()=>[s(o(re),null,{default:i(()=>[s(o(ne),{class:"flex items-center gap-2"},{default:i(()=>[s(o(ye),{class:"h-5 w-5"}),e[11]||(e[11]=m(" Formulario de Votación ",-1))]),_:1})]),_:1}),s(o(D),null,{default:i(()=>[t("form",{onSubmit:e[1]||(e[1]=te(c=>h.value=!0,["prevent"])),class:"space-y-6"},[s(_e,{fields:l.votacion.formulario_config,modelValue:o(v).respuestas,"onUpdate:modelValue":e[0]||(e[0]=c=>o(v).respuestas=c),"candidatos-elegibles":l.candidatosElegibles||{},errors:o(v).errors,disabled:o(v).processing,title:"",description:"",context:"votacion"},null,8,["fields","modelValue","candidatos-elegibles","errors","disabled"]),e[12]||(e[12]=t("div",{class:"h-20"},null,-1))],32)]),_:1})]),_:1}),s(o(le),{open:h.value,"onUpdate:open":e[2]||(e[2]=c=>h.value=c)},{default:i(()=>[s(o(ce),null,{default:i(()=>[s(o(de),null,{default:i(()=>[s(o(me),null,{default:i(()=>[...e[13]||(e[13]=[m("¿Confirmar voto?",-1)])]),_:1}),s(o(ue),null,{default:i(()=>[...e[14]||(e[14]=[m(" Una vez enviado tu voto, no podrás modificarlo. ¿Estás seguro de que quieres proceder? ",-1)])]),_:1})]),_:1}),s(o(ve),null,{default:i(()=>[s(o(fe),null,{default:i(()=>[...e[15]||(e[15]=[m("Cancelar",-1)])]),_:1}),s(o(pe),{onClick:P,class:"bg-primary"},{default:i(()=>[...e[16]||(e[16]=[m(" Confirmar Voto ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),(f(),N(oe,{to:"body"},[s(ae,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-4 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-4 opacity-0"},{default:i(()=>[(f(),_("div",Oe,[t("div",Ze,[t("div",Je,[t("div",Ke,[t("div",We,[t("div",Xe,[s(o(E),{class:"h-4 w-4"}),t("span",null,d(x.value),1)]),e[17]||(e[17]=t("div",{class:"h-4 w-px bg-gray-300 dark:bg-gray-600"},null,-1)),t("span",Ye,d(l.votacion.titulo),1)]),t("div",et,[s(o(j),{onClick:e[3]||(e[3]=c=>h.value=!0),disabled:!Z.value||o(v).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400 min-w-[150px] sm:min-w-[180px]"},{default:i(()=>[o(v).processing?(f(),_(V,{key:0},[s(o(E),{class:"mr-2 h-4 w-4 animate-spin"}),e[18]||(e[18]=m(" Procesando tu voto de forma segura... No cierres esta ventana ",-1))],64)):(f(),_(V,{key:1},[s(o(we),{class:"mr-2 h-4 w-4"}),e[19]||(e[19]=m(" Enviar Voto ",-1))],64))]),_:1},8,["disabled"])])]),t("div",tt,[t("span",ot," Tiempo restante: "+d(x.value),1)])])])]))]),_:1})]))]),_:1})],64))}});export{vo as default};
