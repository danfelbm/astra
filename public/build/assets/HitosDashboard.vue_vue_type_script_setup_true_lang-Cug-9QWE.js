import{r as N,p as he,c as J,d as be,b as P,f as l,w as r,e as o,g as f,x as rt,n as ae,h as S,t as $,i as C,j as _,m as c,F as oe,k as pe,l as Pe,ai as _t,o as ml,B as tn,Y as dt,a1 as an,U as Ka,y as ln,a as ot,v as vl,s as Qa}from"./app-tiBs69RM.js";import{_ as ke,c as Se,a as Ae,b as Oe}from"./CardTitle.vue_vue_type_script_setup_true_lang-G6BIo_UQ.js";import{c as gl,_ as H}from"./createLucideIcon-Hey_p6JF.js";import{_ as ye}from"./index-DW7KobG0.js";import{_ as na}from"./Progress.vue_vue_type_script_setup_true_lang-DnHdcCn_.js";import{_ as Ft}from"./ScrollArea.vue_vue_type_script_setup_true_lang-bsi4MgAk.js";import{_ as nn}from"./Separator.vue_vue_type_script_setup_true_lang-CfpuG2mP.js";import{_ as ut}from"./Input.vue_vue_type_script_setup_true_lang-D33lp28i.js";import{C as Na,_ as Vt,a as Tt,b as Pt,c as At,d as nt}from"./SelectValue.vue_vue_type_script_setup_true_lang-DGLWaf-u.js";import{_ as on,a as sn,b as rn,c as dn,d as un,e as cn,f as fn,g as mn}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BraHpVyq.js";import{n as vn,d as gn,f as je,e as Ye,i as pl}from"./es-SykclP7y.js";import{e as fa,_ as ma,a as va,b as yt,c as Ut,d as ga}from"./DialogTitle.vue_vue_type_script_setup_true_lang-fSFsRtyS.js";import{_ as hl}from"./Switch.vue_vue_type_script_setup_true_lang-CTnOIFJU.js";import{_ as Fa}from"./Label.vue_vue_type_script_setup_true_lang-B6ck6RT6.js";import{_ as pn}from"./ComentarioContextoInput.vue_vue_type_script_setup_true_lang-CJJK2bGy.js";import{C as qt}from"./circle-x-D-bfOhZ3.js";import{C as xt}from"./circle-alert-BGNKGfx_.js";import{C as Me}from"./clock-BxPVjM0C.js";import{C as et}from"./circle-check-big-CWasewnn.js";import{L as wt}from"./loader-circle-BNI9cyPC.js";import{L as hn}from"./list-D6hcLldQ.js";import{L as bn,c as bl}from"./useFlashMessages-DRCu0vyf.js";import{C as yl}from"./chevron-right-fXrswjSG.js";import{F as xl}from"./zap-CmgaMO8-.js";import{C as ct}from"./calendar-Bvxfv_Hl.js";import{U as st}from"./user-ObviW1YQ.js";import{E as Ia}from"./eye-DhZpretq.js";import{S as Va}from"./square-pen-3BdCB5PB.js";import{M as ft}from"./message-square--GZARDsj.js";import{A as mt,b as wl,c as El,_ as yn,a as xn}from"./ActivityLog.vue_vue_type_script_setup_true_lang-Bl01Ygyc.js";import{U as Qt}from"./users-CBD5Kf4w.js";import{T as Cl}from"./trash-2-tyuCEqWb.js";import{F as it}from"./file-text-Dz7hfeXj.js";import{_ as Ua,a as Ha,b as He,c as qe}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CDDlXsy9.js";import{_ as _l,a as kl}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-es55zWw5.js";import{_ as Ta}from"./CardDescription.vue_vue_type_script_setup_true_lang-C_uNl1Le.js";import{_ as Ze}from"./Skeleton.vue_vue_type_script_setup_true_lang-Ew55F5vZ.js";import{_ as Sl}from"./ComentariosPanel.vue_vue_type_script_setup_true_lang-C5rz-tkY.js";import{P as pa}from"./pencil-DMvZ8hzT.js";import{C as wn}from"./check-vF67rYPW.js";import{X as Ht}from"./x-C1oZAMsO.js";import{_ as En}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as $l}from"./Textarea.vue_vue_type_script_setup_true_lang-W4eXJeWz.js";import{p as Et}from"./parseISO-D9CBQlQ_.js";import{_ as Dl,a as Il,b as Vl}from"./index-DcAy0auO.js";import{_ as Tl}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-D9Ov6bvf.js";import{E as Cn}from"./EtiquetaSelector-DFf5CePn.js";import{a as qa,T as Pa}from"./target-RUUlSflp.js";import{_ as _n}from"./Checkbox.vue_vue_type_script_setup_true_lang-BiEnS0fV.js";import{_ as kn,a as Sn}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-DmjWfUhk.js";import{D as $n}from"./download-CtWduEMz.js";import{U as Dn}from"./upload-ByGtfpWn.js";import{u as Pl}from"./useToast-VX5biLNH.js";import{R as Al}from"./refresh-cw-Cbk7baxm.js";import{G as In}from"./git-branch-LwPnFhk2.js";import{H as Ol}from"./hash-Dol__fQv.js";import{E as Ml}from"./external-link-Dn48Z4Wc.js";import{I as ba}from"./image-C-eh7bdi.js";import{S as Za}from"./search-D79nFv7e.js";import{F as Vn}from"./folder-open-LcUD4NSh.js";import{P as Ja}from"./plus-C86gwngZ.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=gl("Columns3Icon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=gl("ListTodoIcon",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);function Pn(e,a,n){const[t,i]=vn(n==null?void 0:n.in,e,a),s=el(t,i),d=Math.abs(gn(t,i));t.setDate(t.getDate()-s*d);const m=+(el(t,i)===-s),g=s*(d-m);return g===0?0:g}function el(e,a){const n=e.getFullYear()-a.getFullYear()||e.getMonth()-a.getMonth()||e.getDate()-a.getDate()||e.getHours()-a.getHours()||e.getMinutes()-a.getMinutes()||e.getSeconds()-a.getSeconds()||e.getMilliseconds()-a.getMilliseconds();return n<0?-1:n>0?1:n}const St={VIEW_MODE:"entregables-view-mode",CONFIRM_ON_DRAG:"entregables-confirm-drag"},Ot={pendiente:{label:"Pendiente",color:"text-gray-800",bgColor:"bg-gray-100",dotColor:"bg-gray-400"},en_progreso:{label:"En Progreso",color:"text-blue-800",bgColor:"bg-blue-100",dotColor:"bg-blue-500"},completado:{label:"Completado",color:"text-green-800",bgColor:"bg-green-100",dotColor:"bg-green-500"},cancelado:{label:"Cancelado",color:"text-red-800",bgColor:"bg-red-100",dotColor:"bg-red-500"}},Zt={baja:{label:"Baja",color:"text-gray-600",bgColor:"bg-gray-100"},media:{label:"Media",color:"text-yellow-800",bgColor:"bg-yellow-100"},alta:{label:"Alta",color:"text-red-800",bgColor:"bg-red-100"}},Aa=["pendiente","en_progreso","completado","cancelado"];function Lt(e,a={}){const{defaultViewMode:n="list",defaultConfirmOnDrag:t=!0}=a,i=N(localStorage.getItem(St.VIEW_MODE)||n),s=N(localStorage.getItem(St.CONFIRM_ON_DRAG)!==null?localStorage.getItem(St.CONFIRM_ON_DRAG)==="true":t);he(i,u=>{localStorage.setItem(St.VIEW_MODE,u)}),he(s,u=>{localStorage.setItem(St.CONFIRM_ON_DRAG,String(u))});const d=J(()=>({pendientes:e.value.filter(u=>u.estado==="pendiente"),en_progreso:e.value.filter(u=>u.estado==="en_progreso"),completados:e.value.filter(u=>u.estado==="completado"),cancelados:e.value.filter(u=>u.estado==="cancelado")}));return{viewMode:i,confirmOnDrag:s,entregablesAgrupados:d,getEstadoConfig:u=>Ot[u]||Ot.pendiente,getPrioridadConfig:u=>Zt[u]||Zt.baja,getEstadoColor:u=>{const y=Ot[u];return y?`${y.bgColor} ${y.color}`:"bg-gray-100 text-gray-800"},getPrioridadColor:u=>{const y=Zt[u];return y?`${y.bgColor} ${y.color}`:"bg-gray-100 text-gray-600"},formatDate:u=>u?je(new Date(u),"dd MMM yyyy",{locale:Ye}):"Sin fecha",formatDateTime:u=>u?je(new Date(u),"dd MMM yyyy 'a las' HH:mm",{locale:Ye}):"-",getDiasRestantes:u=>{if(!u)return null;const y=Math.ceil((new Date(u).getTime()-new Date().getTime())/(1e3*60*60*24));return y<0?`Vencido hace ${Math.abs(y)} días`:y===0?"Vence hoy":y===1?"Vence mañana":`${y} días`},isVencido:(u,y)=>!u||y==="completado"||y==="cancelado"?!1:new Date(u)<new Date}}const An={class:"flex gap-3"},On={class:"flex-1"},Mn={class:"space-y-4 py-4"},zn={class:"flex items-center justify-between"},Bn={key:0,class:"space-y-2"},Rn=be({__name:"StatusChangeModal",props:{open:{type:Boolean,default:!1},entregableNombre:{},estadoActual:{},nuevoEstado:{},loading:{type:Boolean,default:!1}},emits:["update:open","confirm","cancel"],setup(e,{emit:a}){const n=e,t=a,i=N(""),s=N([]),d=N(!1),m=N(null),g=J(()=>({completado:{icon:et,iconClass:"text-green-600",buttonClass:"bg-green-600 hover:bg-green-700",title:"¿Marcar como completado?",description:"El entregable se marcará como completado y se registrará la fecha y hora.",confirmText:"Completar",defaultComentario:!1},en_progreso:{icon:Me,iconClass:"text-blue-600",buttonClass:"bg-blue-600 hover:bg-blue-700",title:"¿Marcar en progreso?",description:"El entregable se marcará como en progreso.",confirmText:"En Progreso",defaultComentario:!1},pendiente:{icon:xt,iconClass:"text-yellow-600",buttonClass:"bg-yellow-600 hover:bg-yellow-700",title:"¿Reabrir entregable?",description:"El entregable volverá a estado pendiente.",confirmText:"Reabrir",defaultComentario:!1},cancelado:{icon:qt,iconClass:"text-red-600",buttonClass:"bg-red-600 hover:bg-red-700",title:"¿Cancelar entregable?",description:"El entregable se marcará como cancelado.",confirmText:"Cancelar Entregable",defaultComentario:!0}})[n.nuevoEstado]),v=J(()=>n.entregableNombre?`${g.value.title.replace("?","")}: "${n.entregableNombre}"?`:g.value.title),p=()=>{var w;i.value="",s.value=[],(w=m.value)==null||w.clear()};he(()=>n.open,w=>{w?d.value=g.value.defaultComentario:(p(),d.value=!1)});const h=()=>{const w=d.value?i.value:"",b=d.value?s.value:[];t("confirm",w,b),n.loading||t("update:open",!1)},I=()=>{t("cancel"),t("update:open",!1)};return(w,b)=>(c(),P(l(fa),{open:e.open,"onUpdate:open":b[3]||(b[3]=u=>t("update:open",u))},{default:r(()=>[o(l(ma),{class:"sm:max-w-lg"},{default:r(()=>[o(l(va),null,{default:r(()=>[f("div",An,[(c(),P(rt(g.value.icon),{class:ae(["h-5 w-5 mt-0.5 flex-shrink-0",g.value.iconClass]),"aria-hidden":"true"},null,8,["class"])),f("div",On,[o(l(yt),null,{default:r(()=>[S($(v.value),1)]),_:1}),o(l(Ut),{class:"mt-2"},{default:r(()=>[S($(g.value.description),1)]),_:1})])])]),_:1}),f("div",Mn,[f("div",zn,[o(l(Fa),{for:"agregar-comentario",class:"text-sm"},{default:r(()=>[...b[4]||(b[4]=[S(" Agregar comentario ",-1)])]),_:1}),o(l(hl),{id:"agregar-comentario",modelValue:d.value,"onUpdate:modelValue":b[0]||(b[0]=u=>d.value=u),disabled:e.loading},null,8,["modelValue","disabled"])]),d.value?(c(),C("div",Bn,[o(pn,{ref_key:"comentarioInputRef",ref:m,modelValue:i.value,"onUpdate:modelValue":b[1]||(b[1]=u=>i.value=u),placeholder:"Agrega un comentario sobre este cambio de estado...",rows:3,"show-file-upload":!0,"upload-module":"comentarios","upload-field-id":"entregable-comentario","onUpdate:archivos":b[2]||(b[2]=u=>s.value=u)},null,8,["modelValue"]),b[5]||(b[5]=f("p",{class:"text-xs text-muted-foreground"}," Este comentario aparecerá con el badge del nuevo estado. ",-1))])):_("",!0)]),o(l(ga),{class:"gap-2 sm:gap-0"},{default:r(()=>[o(l(H),{variant:"outline",onClick:I,disabled:e.loading},{default:r(()=>[...b[6]||(b[6]=[S(" Cancelar ",-1)])]),_:1},8,["disabled"]),o(l(H),{onClick:h,class:ae(g.value.buttonClass),disabled:e.loading},{default:r(()=>[e.loading?(c(),P(l(wt),{key:0,class:"mr-2 h-4 w-4 animate-spin","aria-hidden":"true"})):_("",!0),S(" "+$(g.value.confirmText),1)]),_:1},8,["class","disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),Nn={class:"flex items-center justify-between gap-4 flex-wrap"},Fn={class:"flex gap-1 bg-muted p-1 rounded-lg"},Un={class:"ml-1.5 hidden sm:inline text-xs"},Hn={key:0,class:"flex items-center gap-2"},qn=be({__name:"HitosViewModeToggle",props:{modelValue:{},confirmOnDrag:{type:Boolean}},emits:["update:modelValue","update:confirmOnDrag"],setup(e,{emit:a}){const n=a,t=[{value:"list",icon:hn,label:"Lista"},{value:"tabs",icon:bn,label:"Tabs"},{value:"kanban",icon:Tn,label:"Kanban"}];return(i,s)=>(c(),C("div",Nn,[f("div",Fn,[(c(),C(oe,null,pe(t,d=>o(l(H),{key:d.value,variant:e.modelValue===d.value?"default":"ghost",size:"sm",class:"h-8 px-3",title:d.label,onClick:m=>n("update:modelValue",d.value)},{default:r(()=>[(c(),P(rt(d.icon),{class:"h-4 w-4"})),f("span",Un,$(d.label),1)]),_:2},1032,["variant","title","onClick"])),64))]),e.modelValue==="kanban"?(c(),C("div",Hn,[o(l(hl),{id:"confirm-drag","model-value":e.confirmOnDrag,"onUpdate:modelValue":s[0]||(s[0]=d=>n("update:confirmOnDrag",d))},null,8,["model-value"]),o(l(Fa),{for:"confirm-drag",class:"text-sm text-muted-foreground cursor-pointer"},{default:r(()=>[...s[1]||(s[1]=[S(" Confirmar al arrastrar ",-1)])]),_:1})])):_("",!0)]))}}),Ln={class:"flex items-start gap-2"},jn={class:"flex-1 min-w-0"},Yn={class:"flex items-center gap-2 flex-wrap"},Gn={key:0,class:"mt-1.5 flex items-center gap-2 text-xs text-muted-foreground"},Xn={key:1,class:"flex items-center gap-1 truncate"},Wn={key:0,class:"flex gap-1 mt-2 pt-2 border-t"},Kn={key:0,class:"ml-1"},Qn={key:1,class:"ml-8 mt-3 space-y-3"},Zn={key:0,class:"text-sm text-muted-foreground"},Jn={class:"flex flex-wrap gap-4 text-sm"},eo={class:"flex items-center gap-1 text-muted-foreground"},to={key:0,class:"flex items-center gap-1 text-muted-foreground"},ao={key:1,class:"flex items-center gap-2"},lo={class:"flex gap-1 flex-wrap"},no={key:2,class:"text-sm text-muted-foreground space-y-1"},oo={key:0,class:"flex items-center gap-1"},so={key:1,class:"flex items-center gap-1"},io={key:2,class:"italic mt-2"},ro={key:2,class:"flex flex-wrap items-center gap-1 mt-3 pt-3 border-t"},La=be({__name:"HitosEntregableCard",props:{entregable:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},expanded:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},variant:{default:"default"}},emits:["toggle-expand","view","edit","delete","complete","change-status","show-comentarios","show-actividad"],setup(e,{emit:a}){const n=e,t=a,i=N([]),{getEstadoColor:s,getPrioridadColor:d,formatDate:m,formatDateTime:g,getDiasRestantes:v,isVencido:p}=Lt(i),h=J(()=>Ot[n.entregable.estado]),I=J(()=>Zt[n.entregable.prioridad]),w=J(()=>v(n.entregable.fecha_fin)),b=J(()=>p(n.entregable.fecha_fin,n.entregable.estado)),u=J(()=>n.entregable.estado==="completado"),y=J(()=>n.entregable.estado==="cancelado"),k=J(()=>{switch(n.entregable.estado){case"completado":return et;case"en_progreso":return Me;case"cancelado":return qt;default:return xt}}),O=J(()=>{const L="transition-all duration-150",T={en_progreso:"border-l-4 border-l-blue-500",completado:"border-l-4 border-l-green-500 bg-green-50/30",cancelado:"border-l-4 border-l-red-500 bg-red-50/30"},X=[L];return T[n.entregable.estado]&&X.push(T[n.entregable.estado]),n.draggable&&X.push("cursor-grab active:cursor-grabbing hover:shadow-md"),X.join(" ")});return(L,T)=>(c(),P(l(ke),{class:ae(O.value),"data-id":e.entregable.id,"data-estado":e.entregable.estado},{default:r(()=>[o(l(Se),{class:ae(e.variant==="kanban"?"p-3":"p-4")},{default:r(()=>[f("div",Ln,[e.variant!=="kanban"?(c(),P(l(H),{key:0,variant:"ghost",size:"sm",class:"h-6 w-6 p-0 flex-shrink-0",onClick:T[0]||(T[0]=X=>t("toggle-expand"))},{default:r(()=>[e.expanded?(c(),P(l(Na),{key:1,class:"h-4 w-4"})):(c(),P(l(yl),{key:0,class:"h-4 w-4"}))]),_:1})):_("",!0),e.variant==="kanban"?(c(),P(rt(k.value),{key:1,class:ae(["h-4 w-4 flex-shrink-0 mt-0.5",h.value.color])},null,8,["class"])):_("",!0),f("div",jn,[f("div",Yn,[f("h4",{class:ae(["font-medium truncate",{"line-through text-muted-foreground":u.value,"text-sm":e.variant==="kanban"}])},$(e.entregable.nombre),3),e.variant!=="kanban"?(c(),C(oe,{key:0},[o(l(ye),{class:ae([l(d)(e.entregable.prioridad),"text-[10px] px-1.5"]),variant:"outline"},{default:r(()=>[S($(I.value.label),1)]),_:1},8,["class"]),o(l(ye),{class:ae([l(s)(e.entregable.estado),"text-[10px] px-1.5"])},{default:r(()=>[S($(h.value.label),1)]),_:1},8,["class"])],64)):_("",!0),e.variant==="kanban"&&e.entregable.prioridad==="alta"?(c(),P(l(ye),{key:1,class:"bg-red-100 text-red-800 text-[10px] px-1"},{default:r(()=>[o(l(xl),{class:"h-3 w-3"})]),_:1})):_("",!0)]),e.variant==="kanban"?(c(),C("div",Gn,[e.entregable.fecha_fin?(c(),C("span",{key:0,class:ae(["flex items-center gap-1",{"text-red-600":b.value}])},[o(l(ct),{class:"h-3 w-3"}),S(" "+$(l(m)(e.entregable.fecha_fin)),1)],2)):_("",!0),e.entregable.responsable?(c(),C("span",Xn,[o(l(st),{class:"h-3 w-3"}),S(" "+$(e.entregable.responsable.name),1)])):_("",!0)])):_("",!0)])]),e.variant==="kanban"?(c(),C("div",Wn,[o(l(H),{variant:"outline",size:"sm",class:"flex-1 h-7 text-xs",onClick:T[1]||(T[1]=Pe(X=>t("view"),["stop"]))},{default:r(()=>[o(l(Ia),{class:"h-3 w-3 mr-1"}),T[15]||(T[15]=S(" Ver detalles ",-1))]),_:1}),e.canComplete&&!u.value&&!y.value?(c(),P(l(H),{key:0,variant:"outline",size:"sm",class:"h-7 text-xs",onClick:T[2]||(T[2]=Pe(X=>t("complete"),["stop"]))},{default:r(()=>[o(l(et),{class:"h-3 w-3 mr-1"}),T[16]||(T[16]=S(" Completar ",-1))]),_:1})):_("",!0),e.canEdit&&e.entregable.estado==="pendiente"?(c(),P(l(H),{key:1,variant:"outline",size:"sm",class:"h-7 text-xs",onClick:T[3]||(T[3]=Pe(X=>t("change-status","en_progreso"),["stop"]))},{default:r(()=>[o(l(Me),{class:"h-3 w-3 mr-1"}),T[17]||(T[17]=S(" En progreso ",-1))]),_:1})):_("",!0),e.canEdit?(c(),P(l(H),{key:2,variant:"outline",size:"sm",class:"h-7 text-xs",onClick:T[4]||(T[4]=Pe(X=>t("edit"),["stop"]))},{default:r(()=>[o(l(Va),{class:"h-3 w-3 mr-1"}),T[18]||(T[18]=S(" Editar ",-1))]),_:1})):_("",!0),o(l(H),{variant:"outline",size:"sm",class:"h-7 px-2 text-xs",onClick:T[5]||(T[5]=Pe(X=>t("show-comentarios"),["stop"])),title:"Comentarios"},{default:r(()=>[o(l(ft),{class:"h-3 w-3"}),e.entregable.comentarios_count&&e.entregable.comentarios_count>0?(c(),C("span",Kn,$(e.entregable.comentarios_count),1)):_("",!0)]),_:1}),o(l(H),{variant:"outline",size:"sm",class:"h-7 px-2 text-xs",onClick:T[6]||(T[6]=Pe(X=>t("show-actividad"),["stop"])),title:"Actividad"},{default:r(()=>[o(l(mt),{class:"h-3 w-3"})]),_:1})])):_("",!0),e.expanded&&e.variant!=="kanban"?(c(),C("div",Qn,[e.entregable.descripcion?(c(),C("p",Zn,$(e.entregable.descripcion),1)):_("",!0),f("div",Jn,[f("div",eo,[o(l(ct),{class:"h-4 w-4"}),f("span",null,$(l(m)(e.entregable.fecha_inicio))+" - "+$(l(m)(e.entregable.fecha_fin)),1)]),e.entregable.responsable?(c(),C("div",to,[o(l(st),{class:"h-4 w-4"}),f("span",null,$(e.entregable.responsable.name),1)])):_("",!0),w.value?(c(),C("div",{key:1,class:ae(["flex items-center gap-1",{"text-red-600":b.value}])},[o(l(Me),{class:"h-4 w-4"}),f("span",null,$(w.value),1)],2)):_("",!0)]),e.entregable.usuarios&&e.entregable.usuarios.length>0?(c(),C("div",ao,[o(l(Qt),{class:"h-4 w-4 text-muted-foreground"}),f("div",lo,[(c(!0),C(oe,null,pe(e.entregable.usuarios,X=>(c(),P(l(ye),{key:X.id,variant:"secondary",class:"text-xs"},{default:r(()=>[S($(X.name),1)]),_:2},1024))),128))])])):_("",!0),u.value?(c(),C("div",no,[e.entregable.completado_at?(c(),C("div",oo,[o(l(Me),{class:"h-3 w-3"}),f("span",null,"Completado: "+$(l(g)(e.entregable.completado_at)),1)])):_("",!0),e.entregable.completado_por_usuario?(c(),C("div",so,[o(l(st),{class:"h-3 w-3"}),f("span",null,"Por: "+$(e.entregable.completado_por_usuario.name),1)])):_("",!0),e.entregable.observaciones_estado?(c(),C("p",io,' "'+$(e.entregable.observaciones_estado)+'" ',1)):_("",!0)])):_("",!0)])):_("",!0),e.variant==="default"?(c(),C("div",ro,[o(l(H),{variant:"outline",size:"sm",class:"h-7 text-xs",onClick:T[7]||(T[7]=X=>t("view"))},{default:r(()=>[o(l(Ia),{class:"h-3 w-3 mr-1"}),T[19]||(T[19]=S(" Ver detalles ",-1))]),_:1}),!u.value&&!y.value?(c(),C(oe,{key:0},[e.canComplete?(c(),P(l(H),{key:0,variant:"outline",size:"sm",class:"h-7 text-xs",onClick:T[8]||(T[8]=X=>t("complete"))},{default:r(()=>[o(l(et),{class:"h-3 w-3 mr-1"}),T[20]||(T[20]=S(" Completar ",-1))]),_:1})):_("",!0),e.canEdit&&e.entregable.estado==="pendiente"?(c(),P(l(H),{key:1,variant:"outline",size:"sm",class:"h-7 text-xs",onClick:T[9]||(T[9]=X=>t("change-status","en_progreso"))},{default:r(()=>[o(l(Me),{class:"h-3 w-3 mr-1"}),T[21]||(T[21]=S(" En progreso ",-1))]),_:1})):_("",!0)],64)):u.value?(c(),C(oe,{key:1},[e.canEdit?(c(),P(l(H),{key:0,variant:"outline",size:"sm",class:"h-7 text-xs",onClick:T[10]||(T[10]=X=>t("change-status","pendiente"))},{default:r(()=>[o(l(xt),{class:"h-3 w-3 mr-1"}),T[22]||(T[22]=S(" Reabrir ",-1))]),_:1})):_("",!0)],64)):_("",!0),e.canEdit?(c(),P(l(H),{key:2,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:T[11]||(T[11]=X=>t("edit"))},{default:r(()=>[o(l(Va),{class:"h-3 w-3 mr-1"}),T[23]||(T[23]=S(" Editar ",-1))]),_:1})):_("",!0),o(l(H),{variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:T[12]||(T[12]=X=>t("show-comentarios"))},{default:r(()=>[o(l(ft),{class:"h-3 w-3 mr-1"}),T[24]||(T[24]=S(" Comentarios ",-1)),e.entregable.comentarios_count&&e.entregable.comentarios_count>0?(c(),P(l(ye),{key:0,variant:"secondary",class:"ml-1 text-xs"},{default:r(()=>[S($(e.entregable.comentarios_count),1)]),_:1})):_("",!0)]),_:1}),o(l(H),{variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:T[13]||(T[13]=X=>t("show-actividad"))},{default:r(()=>[o(l(mt),{class:"h-3 w-3 mr-1"}),T[25]||(T[25]=S(" Actividad ",-1))]),_:1}),e.canDelete?(c(),P(l(H),{key:3,variant:"ghost",size:"sm",class:"h-7 text-xs text-red-600 hover:text-red-700 hover:bg-red-50",onClick:T[14]||(T[14]=X=>t("delete"))},{default:r(()=>[o(l(Cl),{class:"h-3 w-3 mr-1"}),T[26]||(T[26]=S(" Eliminar ",-1))]),_:1})):_("",!0)])):_("",!0)]),_:1},8,["class"])]),_:1},8,["class","data-id","data-estado"]))}}),uo={class:"space-y-6"},co={key:0},fo={class:"font-semibold mb-3 flex items-center gap-2"},mo={class:"space-y-2"},vo={key:0,class:"text-center py-8"},go=be({__name:"HitosEntregablesList",props:{entregables:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1}},emits:["view","edit","delete","complete","change-status","show-comentarios","show-actividad"],setup(e,{emit:a}){const n=e,t=a,i=_t(n,"entregables"),{entregablesAgrupados:s}=Lt(i),d=N(new Set),m=I=>{d.value.has(I)?d.value.delete(I):d.value.add(I)},g=I=>d.value.has(I),v=I=>{t("complete",I)},p=(I,w)=>{t("change-status",I,w)},h=[{key:"pendientes",icon:xt,iconClass:"text-yellow-600",label:"Pendientes"},{key:"en_progreso",icon:Me,iconClass:"text-blue-600",label:"En Progreso"},{key:"completados",icon:et,iconClass:"text-green-600",label:"Completados"},{key:"cancelados",icon:qt,iconClass:"text-red-600",label:"Cancelados"}];return(I,w)=>(c(),C("div",uo,[(c(),C(oe,null,pe(h,b=>(c(),C(oe,{key:b.key},[l(s)[b.key].length>0?(c(),C("div",co,[f("h3",fo,[(c(),P(rt(b.icon),{class:ae(["h-5 w-5",b.iconClass])},null,8,["class"])),S(" "+$(b.label)+" ("+$(l(s)[b.key].length)+") ",1)]),f("div",mo,[(c(!0),C(oe,null,pe(l(s)[b.key],u=>(c(),P(La,{key:u.id,entregable:u,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,expanded:g(u.id),variant:"default",onToggleExpand:y=>m(u.id),onView:y=>t("view",u),onEdit:y=>t("edit",u),onDelete:y=>t("delete",u),onComplete:y=>v(u),onChangeStatus:y=>p(u,y),onShowComentarios:y=>t("show-comentarios",u),onShowActividad:y=>t("show-actividad",u)},null,8,["entregable","can-edit","can-delete","can-complete","expanded","onToggleExpand","onView","onEdit","onDelete","onComplete","onChangeStatus","onShowComentarios","onShowActividad"]))),128))])])):_("",!0)],64))),64)),e.entregables.length===0?(c(),C("div",vo,[o(l(it),{class:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),w[0]||(w[0]=f("p",{class:"text-muted-foreground"},"No hay entregables asignados",-1))])):_("",!0)]))}}),po={class:"hidden sm:inline text-xs"},ho={key:0,class:"space-y-2"},bo={key:1,class:"text-center py-8 border rounded-lg bg-muted/30"},yo={class:"text-muted-foreground text-sm"},xo=be({__name:"HitosEntregablesTabs",props:{entregables:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1}},emits:["view","edit","delete","complete","change-status","show-comentarios","show-actividad"],setup(e,{emit:a}){const n=e,t=a,i=_t(n,"entregables"),{entregablesAgrupados:s}=Lt(i),d=N(new Set),m=N("pendiente"),g=b=>{d.value.has(b)?d.value.delete(b):d.value.add(b)},v=b=>d.value.has(b),p={pendiente:{icon:xt,iconClass:"text-yellow-600",label:"Pendientes",key:"pendientes"},en_progreso:{icon:Me,iconClass:"text-blue-600",label:"En Progreso",key:"en_progreso"},completado:{icon:et,iconClass:"text-green-600",label:"Completados",key:"completados"},cancelado:{icon:qt,iconClass:"text-red-600",label:"Cancelados",key:"cancelados"}},h=b=>{t("complete",b)},I=(b,u)=>{t("change-status",b,u)},w=b=>{const u=p[b];return s.value[u.key]};return(b,u)=>(c(),P(l(Ua),{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=y=>m.value=y),class:"w-full"},{default:r(()=>[o(l(Ha),{class:"w-full grid grid-cols-4 h-auto"},{default:r(()=>[(c(!0),C(oe,null,pe(l(Aa),y=>(c(),P(l(He),{key:y,value:y,class:"gap-1.5 py-2 px-2 data-[state=active]:bg-background"},{default:r(()=>[(c(),P(rt(p[y].icon),{class:ae(["h-4 w-4 flex-shrink-0",p[y].iconClass])},null,8,["class"])),f("span",po,$(p[y].label),1),o(l(ye),{variant:"secondary",class:"ml-1 text-xs px-1.5 py-0"},{default:r(()=>[S($(w(y).length),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),(c(!0),C(oe,null,pe(l(Aa),y=>(c(),P(l(qe),{key:y,value:y,class:"mt-4"},{default:r(()=>[w(y).length>0?(c(),C("div",ho,[(c(!0),C(oe,null,pe(w(y),k=>(c(),P(La,{key:k.id,entregable:k,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,expanded:v(k.id),variant:"default",onToggleExpand:O=>g(k.id),onView:O=>t("view",k),onEdit:O=>t("edit",k),onDelete:O=>t("delete",k),onComplete:O=>h(k),onChangeStatus:O=>I(k,O),onShowComentarios:O=>t("show-comentarios",k),onShowActividad:O=>t("show-actividad",k)},null,8,["entregable","can-edit","can-delete","can-complete","expanded","onToggleExpand","onView","onEdit","onDelete","onComplete","onChangeStatus","onShowComentarios","onShowActividad"]))),128))])):(c(),C("div",bo,[(c(),P(rt(p[y].icon),{class:ae(["h-10 w-10 mx-auto mb-3",p[y].iconClass+"/50"])},null,8,["class"])),f("p",yo," No hay entregables "+$(p[y].label.toLowerCase()),1)]))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]))}});/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function tl(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,t)}return n}function Ue(e){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?tl(Object(n),!0).forEach(function(t){wo(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tl(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Jt(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Jt=function(a){return typeof a}:Jt=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Jt(e)}function wo(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function Ge(){return Ge=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},Ge.apply(this,arguments)}function Eo(e,a){if(e==null)return{};var n={},t=Object.keys(e),i,s;for(s=0;s<t.length;s++)i=t[s],!(a.indexOf(i)>=0)&&(n[i]=e[i]);return n}function Co(e,a){if(e==null)return{};var n=Eo(e,a),t,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)t=s[i],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var _o="1.15.6";function Le(e){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(e)}var Xe=Le(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),jt=Le(/Edge/i),al=Le(/firefox/i),Mt=Le(/safari/i)&&!Le(/chrome/i)&&!Le(/android/i),ja=Le(/iP(ad|od|hone)/i),zl=Le(/chrome/i)&&Le(/android/i),Bl={capture:!1,passive:!1};function ne(e,a,n){e.addEventListener(a,n,!Xe&&Bl)}function le(e,a,n){e.removeEventListener(a,n,!Xe&&Bl)}function oa(e,a){if(a){if(a[0]===">"&&(a=a.substring(1)),e)try{if(e.matches)return e.matches(a);if(e.msMatchesSelector)return e.msMatchesSelector(a);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(a)}catch{return!1}return!1}}function Rl(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Re(e,a,n,t){if(e){n=n||document;do{if(a!=null&&(a[0]===">"?e.parentNode===n&&oa(e,a):oa(e,a))||t&&e===n)return e;if(e===n)break}while(e=Rl(e))}return null}var ll=/\s+/g;function De(e,a,n){if(e&&a)if(e.classList)e.classList[n?"add":"remove"](a);else{var t=(" "+e.className+" ").replace(ll," ").replace(" "+a+" "," ");e.className=(t+(n?" "+a:"")).replace(ll," ")}}function Y(e,a,n){var t=e&&e.style;if(t){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),a===void 0?n:n[a];!(a in t)&&a.indexOf("webkit")===-1&&(a="-webkit-"+a),t[a]=n+(typeof n=="string"?"":"px")}}function bt(e,a){var n="";if(typeof e=="string")n=e;else do{var t=Y(e,"transform");t&&t!=="none"&&(n=t+" "+n)}while(!a&&(e=e.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(n)}function Nl(e,a,n){if(e){var t=e.getElementsByTagName(a),i=0,s=t.length;if(n)for(;i<s;i++)n(t[i],i);return t}return[]}function Fe(){var e=document.scrollingElement;return e||document.documentElement}function ge(e,a,n,t,i){if(!(!e.getBoundingClientRect&&e!==window)){var s,d,m,g,v,p,h;if(e!==window&&e.parentNode&&e!==Fe()?(s=e.getBoundingClientRect(),d=s.top,m=s.left,g=s.bottom,v=s.right,p=s.height,h=s.width):(d=0,m=0,g=window.innerHeight,v=window.innerWidth,p=window.innerHeight,h=window.innerWidth),(a||n)&&e!==window&&(i=i||e.parentNode,!Xe))do if(i&&i.getBoundingClientRect&&(Y(i,"transform")!=="none"||n&&Y(i,"position")!=="static")){var I=i.getBoundingClientRect();d-=I.top+parseInt(Y(i,"border-top-width")),m-=I.left+parseInt(Y(i,"border-left-width")),g=d+s.height,v=m+s.width;break}while(i=i.parentNode);if(t&&e!==window){var w=bt(i||e),b=w&&w.a,u=w&&w.d;w&&(d/=u,m/=b,h/=b,p/=u,g=d+p,v=m+h)}return{top:d,left:m,bottom:g,right:v,width:h,height:p}}}function nl(e,a,n){for(var t=Je(e,!0),i=ge(e)[a];t;){var s=ge(t)[n],d=void 0;if(d=i>=s,!d)return t;if(t===Fe())break;t=Je(t,!1)}return!1}function Ct(e,a,n,t){for(var i=0,s=0,d=e.children;s<d.length;){if(d[s].style.display!=="none"&&d[s]!==G.ghost&&(t||d[s]!==G.dragged)&&Re(d[s],n.draggable,e,!1)){if(i===a)return d[s];i++}s++}return null}function Ya(e,a){for(var n=e.lastElementChild;n&&(n===G.ghost||Y(n,"display")==="none"||a&&!oa(n,a));)n=n.previousElementSibling;return n||null}function Te(e,a){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==G.clone&&(!a||oa(e,a))&&n++;return n}function ol(e){var a=0,n=0,t=Fe();if(e)do{var i=bt(e),s=i.a,d=i.d;a+=e.scrollLeft*s,n+=e.scrollTop*d}while(e!==t&&(e=e.parentNode));return[a,n]}function ko(e,a){for(var n in e)if(e.hasOwnProperty(n)){for(var t in a)if(a.hasOwnProperty(t)&&a[t]===e[n][t])return Number(n)}return-1}function Je(e,a){if(!e||!e.getBoundingClientRect)return Fe();var n=e,t=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var i=Y(n);if(n.clientWidth<n.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Fe();if(t||a)return n;t=!0}}while(n=n.parentNode);return Fe()}function So(e,a){if(e&&a)for(var n in a)a.hasOwnProperty(n)&&(e[n]=a[n]);return e}function xa(e,a){return Math.round(e.top)===Math.round(a.top)&&Math.round(e.left)===Math.round(a.left)&&Math.round(e.height)===Math.round(a.height)&&Math.round(e.width)===Math.round(a.width)}var zt;function Fl(e,a){return function(){if(!zt){var n=arguments,t=this;n.length===1?e.call(t,n[0]):e.apply(t,n),zt=setTimeout(function(){zt=void 0},a)}}}function $o(){clearTimeout(zt),zt=void 0}function Ul(e,a,n){e.scrollLeft+=a,e.scrollTop+=n}function Hl(e){var a=window.Polymer,n=window.jQuery||window.Zepto;return a&&a.dom?a.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function ql(e,a,n){var t={};return Array.from(e.children).forEach(function(i){var s,d,m,g;if(!(!Re(i,a.draggable,e,!1)||i.animated||i===n)){var v=ge(i);t.left=Math.min((s=t.left)!==null&&s!==void 0?s:1/0,v.left),t.top=Math.min((d=t.top)!==null&&d!==void 0?d:1/0,v.top),t.right=Math.max((m=t.right)!==null&&m!==void 0?m:-1/0,v.right),t.bottom=Math.max((g=t.bottom)!==null&&g!==void 0?g:-1/0,v.bottom)}}),t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}var $e="Sortable"+new Date().getTime();function Do(){var e=[],a;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var t=[].slice.call(this.el.children);t.forEach(function(i){if(!(Y(i,"display")==="none"||i===G.ghost)){e.push({target:i,rect:ge(i)});var s=Ue({},e[e.length-1].rect);if(i.thisAnimationDuration){var d=bt(i,!0);d&&(s.top-=d.f,s.left-=d.e)}i.fromRect=s}})}},addAnimationState:function(t){e.push(t)},removeAnimationState:function(t){e.splice(ko(e,{target:t}),1)},animateAll:function(t){var i=this;if(!this.options.animation){clearTimeout(a),typeof t=="function"&&t();return}var s=!1,d=0;e.forEach(function(m){var g=0,v=m.target,p=v.fromRect,h=ge(v),I=v.prevFromRect,w=v.prevToRect,b=m.rect,u=bt(v,!0);u&&(h.top-=u.f,h.left-=u.e),v.toRect=h,v.thisAnimationDuration&&xa(I,h)&&!xa(p,h)&&(b.top-h.top)/(b.left-h.left)===(p.top-h.top)/(p.left-h.left)&&(g=Vo(b,I,w,i.options)),xa(h,p)||(v.prevFromRect=p,v.prevToRect=h,g||(g=i.options.animation),i.animate(v,b,h,g)),g&&(s=!0,d=Math.max(d,g),clearTimeout(v.animationResetTimer),v.animationResetTimer=setTimeout(function(){v.animationTime=0,v.prevFromRect=null,v.fromRect=null,v.prevToRect=null,v.thisAnimationDuration=null},g),v.thisAnimationDuration=g)}),clearTimeout(a),s?a=setTimeout(function(){typeof t=="function"&&t()},d):typeof t=="function"&&t(),e=[]},animate:function(t,i,s,d){if(d){Y(t,"transition",""),Y(t,"transform","");var m=bt(this.el),g=m&&m.a,v=m&&m.d,p=(i.left-s.left)/(g||1),h=(i.top-s.top)/(v||1);t.animatingX=!!p,t.animatingY=!!h,Y(t,"transform","translate3d("+p+"px,"+h+"px,0)"),this.forRepaintDummy=Io(t),Y(t,"transition","transform "+d+"ms"+(this.options.easing?" "+this.options.easing:"")),Y(t,"transform","translate3d(0,0,0)"),typeof t.animated=="number"&&clearTimeout(t.animated),t.animated=setTimeout(function(){Y(t,"transition",""),Y(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},d)}}}}function Io(e){return e.offsetWidth}function Vo(e,a,n,t){return Math.sqrt(Math.pow(a.top-e.top,2)+Math.pow(a.left-e.left,2))/Math.sqrt(Math.pow(a.top-n.top,2)+Math.pow(a.left-n.left,2))*t.animation}var vt=[],wa={initializeByDefault:!0},Yt={mount:function(a){for(var n in wa)wa.hasOwnProperty(n)&&!(n in a)&&(a[n]=wa[n]);vt.forEach(function(t){if(t.pluginName===a.pluginName)throw"Sortable: Cannot mount plugin ".concat(a.pluginName," more than once")}),vt.push(a)},pluginEvent:function(a,n,t){var i=this;this.eventCanceled=!1,t.cancel=function(){i.eventCanceled=!0};var s=a+"Global";vt.forEach(function(d){n[d.pluginName]&&(n[d.pluginName][s]&&n[d.pluginName][s](Ue({sortable:n},t)),n.options[d.pluginName]&&n[d.pluginName][a]&&n[d.pluginName][a](Ue({sortable:n},t)))})},initializePlugins:function(a,n,t,i){vt.forEach(function(m){var g=m.pluginName;if(!(!a.options[g]&&!m.initializeByDefault)){var v=new m(a,n,a.options);v.sortable=a,v.options=a.options,a[g]=v,Ge(t,v.defaults)}});for(var s in a.options)if(a.options.hasOwnProperty(s)){var d=this.modifyOption(a,s,a.options[s]);typeof d<"u"&&(a.options[s]=d)}},getEventProperties:function(a,n){var t={};return vt.forEach(function(i){typeof i.eventProperties=="function"&&Ge(t,i.eventProperties.call(n[i.pluginName],a))}),t},modifyOption:function(a,n,t){var i;return vt.forEach(function(s){a[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[n]=="function"&&(i=s.optionListeners[n].call(a[s.pluginName],t))}),i}};function To(e){var a=e.sortable,n=e.rootEl,t=e.name,i=e.targetEl,s=e.cloneEl,d=e.toEl,m=e.fromEl,g=e.oldIndex,v=e.newIndex,p=e.oldDraggableIndex,h=e.newDraggableIndex,I=e.originalEvent,w=e.putSortable,b=e.extraEventProperties;if(a=a||n&&n[$e],!!a){var u,y=a.options,k="on"+t.charAt(0).toUpperCase()+t.substr(1);window.CustomEvent&&!Xe&&!jt?u=new CustomEvent(t,{bubbles:!0,cancelable:!0}):(u=document.createEvent("Event"),u.initEvent(t,!0,!0)),u.to=d||n,u.from=m||n,u.item=i||n,u.clone=s,u.oldIndex=g,u.newIndex=v,u.oldDraggableIndex=p,u.newDraggableIndex=h,u.originalEvent=I,u.pullMode=w?w.lastPutMode:void 0;var O=Ue(Ue({},b),Yt.getEventProperties(t,a));for(var L in O)u[L]=O[L];n&&n.dispatchEvent(u),y[k]&&y[k].call(a,u)}}var Po=["evt"],_e=function(a,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=t.evt,s=Co(t,Po);Yt.pluginEvent.bind(G)(a,n,Ue({dragEl:B,parentEl:me,ghostEl:ee,rootEl:de,nextEl:lt,lastDownEl:ea,cloneEl:fe,cloneHidden:Qe,dragStarted:$t,putSortable:xe,activeSortable:G.active,originalEvent:i,oldIndex:ht,oldDraggableIndex:Bt,newIndex:Ie,newDraggableIndex:Ke,hideGhostForTarget:Gl,unhideGhostForTarget:Xl,cloneNowHidden:function(){Qe=!0},cloneNowShown:function(){Qe=!1},dispatchSortableEvent:function(m){Ce({sortable:n,name:m,originalEvent:i})}},s))};function Ce(e){To(Ue({putSortable:xe,cloneEl:fe,targetEl:B,rootEl:de,oldIndex:ht,oldDraggableIndex:Bt,newIndex:Ie,newDraggableIndex:Ke},e))}var B,me,ee,de,lt,ea,fe,Qe,ht,Ie,Bt,Ke,Gt,xe,pt=!1,sa=!1,ia=[],tt,Be,Ea,Ca,sl,il,$t,gt,Rt,Nt=!1,Xt=!1,ta,Ee,_a=[],Oa=!1,ra=[],ha=typeof document<"u",Wt=ja,rl=jt||Xe?"cssFloat":"float",Ao=ha&&!zl&&!ja&&"draggable"in document.createElement("div"),Ll=(function(){if(ha){if(Xe)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}})(),jl=function(a,n){var t=Y(a),i=parseInt(t.width)-parseInt(t.paddingLeft)-parseInt(t.paddingRight)-parseInt(t.borderLeftWidth)-parseInt(t.borderRightWidth),s=Ct(a,0,n),d=Ct(a,1,n),m=s&&Y(s),g=d&&Y(d),v=m&&parseInt(m.marginLeft)+parseInt(m.marginRight)+ge(s).width,p=g&&parseInt(g.marginLeft)+parseInt(g.marginRight)+ge(d).width;if(t.display==="flex")return t.flexDirection==="column"||t.flexDirection==="column-reverse"?"vertical":"horizontal";if(t.display==="grid")return t.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&m.float&&m.float!=="none"){var h=m.float==="left"?"left":"right";return d&&(g.clear==="both"||g.clear===h)?"vertical":"horizontal"}return s&&(m.display==="block"||m.display==="flex"||m.display==="table"||m.display==="grid"||v>=i&&t[rl]==="none"||d&&t[rl]==="none"&&v+p>i)?"vertical":"horizontal"},Oo=function(a,n,t){var i=t?a.left:a.top,s=t?a.right:a.bottom,d=t?a.width:a.height,m=t?n.left:n.top,g=t?n.right:n.bottom,v=t?n.width:n.height;return i===m||s===g||i+d/2===m+v/2},Mo=function(a,n){var t;return ia.some(function(i){var s=i[$e].options.emptyInsertThreshold;if(!(!s||Ya(i))){var d=ge(i),m=a>=d.left-s&&a<=d.right+s,g=n>=d.top-s&&n<=d.bottom+s;if(m&&g)return t=i}}),t},Yl=function(a){function n(s,d){return function(m,g,v,p){var h=m.options.group.name&&g.options.group.name&&m.options.group.name===g.options.group.name;if(s==null&&(d||h))return!0;if(s==null||s===!1)return!1;if(d&&s==="clone")return s;if(typeof s=="function")return n(s(m,g,v,p),d)(m,g,v,p);var I=(d?m:g).options.group.name;return s===!0||typeof s=="string"&&s===I||s.join&&s.indexOf(I)>-1}}var t={},i=a.group;(!i||Jt(i)!="object")&&(i={name:i}),t.name=i.name,t.checkPull=n(i.pull,!0),t.checkPut=n(i.put),t.revertClone=i.revertClone,a.group=t},Gl=function(){!Ll&&ee&&Y(ee,"display","none")},Xl=function(){!Ll&&ee&&Y(ee,"display","")};ha&&!zl&&document.addEventListener("click",function(e){if(sa)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),sa=!1,!1},!0);var at=function(a){if(B){a=a.touches?a.touches[0]:a;var n=Mo(a.clientX,a.clientY);if(n){var t={};for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i]);t.target=t.rootEl=n,t.preventDefault=void 0,t.stopPropagation=void 0,n[$e]._onDragOver(t)}}},zo=function(a){B&&B.parentNode[$e]._isOutsideThisEl(a.target)};function G(e,a){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=a=Ge({},a),e[$e]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return jl(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(d,m){d.setData("Text",m.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:G.supportPointer!==!1&&"PointerEvent"in window&&(!Mt||ja),emptyInsertThreshold:5};Yt.initializePlugins(this,e,n);for(var t in n)!(t in a)&&(a[t]=n[t]);Yl(a);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=a.forceFallback?!1:Ao,this.nativeDraggable&&(this.options.touchStartThreshold=1),a.supportPointer?ne(e,"pointerdown",this._onTapStart):(ne(e,"mousedown",this._onTapStart),ne(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(ne(e,"dragover",this),ne(e,"dragenter",this)),ia.push(this.el),a.store&&a.store.get&&this.sort(a.store.get(this)||[]),Ge(this,Do())}G.prototype={constructor:G,_isOutsideThisEl:function(a){!this.el.contains(a)&&a!==this.el&&(gt=null)},_getDirection:function(a,n){return typeof this.options.direction=="function"?this.options.direction.call(this,a,n,B):this.options.direction},_onTapStart:function(a){if(a.cancelable){var n=this,t=this.el,i=this.options,s=i.preventOnFilter,d=a.type,m=a.touches&&a.touches[0]||a.pointerType&&a.pointerType==="touch"&&a,g=(m||a).target,v=a.target.shadowRoot&&(a.path&&a.path[0]||a.composedPath&&a.composedPath()[0])||g,p=i.filter;if(Lo(t),!B&&!(/mousedown|pointerdown/.test(d)&&a.button!==0||i.disabled)&&!v.isContentEditable&&!(!this.nativeDraggable&&Mt&&g&&g.tagName.toUpperCase()==="SELECT")&&(g=Re(g,i.draggable,t,!1),!(g&&g.animated)&&ea!==g)){if(ht=Te(g),Bt=Te(g,i.draggable),typeof p=="function"){if(p.call(this,a,g,this)){Ce({sortable:n,rootEl:v,name:"filter",targetEl:g,toEl:t,fromEl:t}),_e("filter",n,{evt:a}),s&&a.preventDefault();return}}else if(p&&(p=p.split(",").some(function(h){if(h=Re(v,h.trim(),t,!1),h)return Ce({sortable:n,rootEl:h,name:"filter",targetEl:g,fromEl:t,toEl:t}),_e("filter",n,{evt:a}),!0}),p)){s&&a.preventDefault();return}i.handle&&!Re(v,i.handle,t,!1)||this._prepareDragStart(a,m,g)}}},_prepareDragStart:function(a,n,t){var i=this,s=i.el,d=i.options,m=s.ownerDocument,g;if(t&&!B&&t.parentNode===s){var v=ge(t);if(de=s,B=t,me=B.parentNode,lt=B.nextSibling,ea=t,Gt=d.group,G.dragged=B,tt={target:B,clientX:(n||a).clientX,clientY:(n||a).clientY},sl=tt.clientX-v.left,il=tt.clientY-v.top,this._lastX=(n||a).clientX,this._lastY=(n||a).clientY,B.style["will-change"]="all",g=function(){if(_e("delayEnded",i,{evt:a}),G.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!al&&i.nativeDraggable&&(B.draggable=!0),i._triggerDragStart(a,n),Ce({sortable:i,name:"choose",originalEvent:a}),De(B,d.chosenClass,!0)},d.ignore.split(",").forEach(function(p){Nl(B,p.trim(),ka)}),ne(m,"dragover",at),ne(m,"mousemove",at),ne(m,"touchmove",at),d.supportPointer?(ne(m,"pointerup",i._onDrop),!this.nativeDraggable&&ne(m,"pointercancel",i._onDrop)):(ne(m,"mouseup",i._onDrop),ne(m,"touchend",i._onDrop),ne(m,"touchcancel",i._onDrop)),al&&this.nativeDraggable&&(this.options.touchStartThreshold=4,B.draggable=!0),_e("delayStart",this,{evt:a}),d.delay&&(!d.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(jt||Xe))){if(G.eventCanceled){this._onDrop();return}d.supportPointer?(ne(m,"pointerup",i._disableDelayedDrag),ne(m,"pointercancel",i._disableDelayedDrag)):(ne(m,"mouseup",i._disableDelayedDrag),ne(m,"touchend",i._disableDelayedDrag),ne(m,"touchcancel",i._disableDelayedDrag)),ne(m,"mousemove",i._delayedDragTouchMoveHandler),ne(m,"touchmove",i._delayedDragTouchMoveHandler),d.supportPointer&&ne(m,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(g,d.delay)}else g()}},_delayedDragTouchMoveHandler:function(a){var n=a.touches?a.touches[0]:a;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){B&&ka(B),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var a=this.el.ownerDocument;le(a,"mouseup",this._disableDelayedDrag),le(a,"touchend",this._disableDelayedDrag),le(a,"touchcancel",this._disableDelayedDrag),le(a,"pointerup",this._disableDelayedDrag),le(a,"pointercancel",this._disableDelayedDrag),le(a,"mousemove",this._delayedDragTouchMoveHandler),le(a,"touchmove",this._delayedDragTouchMoveHandler),le(a,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(a,n){n=n||a.pointerType=="touch"&&a,!this.nativeDraggable||n?this.options.supportPointer?ne(document,"pointermove",this._onTouchMove):n?ne(document,"touchmove",this._onTouchMove):ne(document,"mousemove",this._onTouchMove):(ne(B,"dragend",this),ne(de,"dragstart",this._onDragStart));try{document.selection?aa(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(a,n){if(pt=!1,de&&B){_e("dragStarted",this,{evt:n}),this.nativeDraggable&&ne(document,"dragover",zo);var t=this.options;!a&&De(B,t.dragClass,!1),De(B,t.ghostClass,!0),G.active=this,a&&this._appendGhost(),Ce({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(Be){this._lastX=Be.clientX,this._lastY=Be.clientY,Gl();for(var a=document.elementFromPoint(Be.clientX,Be.clientY),n=a;a&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(Be.clientX,Be.clientY),a!==n);)n=a;if(B.parentNode[$e]._isOutsideThisEl(a),n)do{if(n[$e]){var t=void 0;if(t=n[$e]._onDragOver({clientX:Be.clientX,clientY:Be.clientY,target:a,rootEl:n}),t&&!this.options.dragoverBubble)break}a=n}while(n=Rl(n));Xl()}},_onTouchMove:function(a){if(tt){var n=this.options,t=n.fallbackTolerance,i=n.fallbackOffset,s=a.touches?a.touches[0]:a,d=ee&&bt(ee,!0),m=ee&&d&&d.a,g=ee&&d&&d.d,v=Wt&&Ee&&ol(Ee),p=(s.clientX-tt.clientX+i.x)/(m||1)+(v?v[0]-_a[0]:0)/(m||1),h=(s.clientY-tt.clientY+i.y)/(g||1)+(v?v[1]-_a[1]:0)/(g||1);if(!G.active&&!pt){if(t&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<t)return;this._onDragStart(a,!0)}if(ee){d?(d.e+=p-(Ea||0),d.f+=h-(Ca||0)):d={a:1,b:0,c:0,d:1,e:p,f:h};var I="matrix(".concat(d.a,",").concat(d.b,",").concat(d.c,",").concat(d.d,",").concat(d.e,",").concat(d.f,")");Y(ee,"webkitTransform",I),Y(ee,"mozTransform",I),Y(ee,"msTransform",I),Y(ee,"transform",I),Ea=p,Ca=h,Be=s}a.cancelable&&a.preventDefault()}},_appendGhost:function(){if(!ee){var a=this.options.fallbackOnBody?document.body:de,n=ge(B,!0,Wt,!0,a),t=this.options;if(Wt){for(Ee=a;Y(Ee,"position")==="static"&&Y(Ee,"transform")==="none"&&Ee!==document;)Ee=Ee.parentNode;Ee!==document.body&&Ee!==document.documentElement?(Ee===document&&(Ee=Fe()),n.top+=Ee.scrollTop,n.left+=Ee.scrollLeft):Ee=Fe(),_a=ol(Ee)}ee=B.cloneNode(!0),De(ee,t.ghostClass,!1),De(ee,t.fallbackClass,!0),De(ee,t.dragClass,!0),Y(ee,"transition",""),Y(ee,"transform",""),Y(ee,"box-sizing","border-box"),Y(ee,"margin",0),Y(ee,"top",n.top),Y(ee,"left",n.left),Y(ee,"width",n.width),Y(ee,"height",n.height),Y(ee,"opacity","0.8"),Y(ee,"position",Wt?"absolute":"fixed"),Y(ee,"zIndex","100000"),Y(ee,"pointerEvents","none"),G.ghost=ee,a.appendChild(ee),Y(ee,"transform-origin",sl/parseInt(ee.style.width)*100+"% "+il/parseInt(ee.style.height)*100+"%")}},_onDragStart:function(a,n){var t=this,i=a.dataTransfer,s=t.options;if(_e("dragStart",this,{evt:a}),G.eventCanceled){this._onDrop();return}_e("setupClone",this),G.eventCanceled||(fe=Hl(B),fe.removeAttribute("id"),fe.draggable=!1,fe.style["will-change"]="",this._hideClone(),De(fe,this.options.chosenClass,!1),G.clone=fe),t.cloneId=aa(function(){_e("clone",t),!G.eventCanceled&&(t.options.removeCloneOnHide||de.insertBefore(fe,B),t._hideClone(),Ce({sortable:t,name:"clone"}))}),!n&&De(B,s.dragClass,!0),n?(sa=!0,t._loopId=setInterval(t._emulateDragOver,50)):(le(document,"mouseup",t._onDrop),le(document,"touchend",t._onDrop),le(document,"touchcancel",t._onDrop),i&&(i.effectAllowed="move",s.setData&&s.setData.call(t,i,B)),ne(document,"drop",t),Y(B,"transform","translateZ(0)")),pt=!0,t._dragStartId=aa(t._dragStarted.bind(t,n,a)),ne(document,"selectstart",t),$t=!0,window.getSelection().removeAllRanges(),Mt&&Y(document.body,"user-select","none")},_onDragOver:function(a){var n=this.el,t=a.target,i,s,d,m=this.options,g=m.group,v=G.active,p=Gt===g,h=m.sort,I=xe||v,w,b=this,u=!1;if(Oa)return;function y(Z,j){_e(Z,b,Ue({evt:a,isOwner:p,axis:w?"vertical":"horizontal",revert:d,dragRect:i,targetRect:s,canSort:h,fromSortable:I,target:t,completed:O,onMove:function(W,K){return Kt(de,n,B,i,W,ge(W),a,K)},changed:L},j))}function k(){y("dragOverAnimationCapture"),b.captureAnimationState(),b!==I&&I.captureAnimationState()}function O(Z){return y("dragOverCompleted",{insertion:Z}),Z&&(p?v._hideClone():v._showClone(b),b!==I&&(De(B,xe?xe.options.ghostClass:v.options.ghostClass,!1),De(B,m.ghostClass,!0)),xe!==b&&b!==G.active?xe=b:b===G.active&&xe&&(xe=null),I===b&&(b._ignoreWhileAnimating=t),b.animateAll(function(){y("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==I&&(I.animateAll(),I._ignoreWhileAnimating=null)),(t===B&&!B.animated||t===n&&!t.animated)&&(gt=null),!m.dragoverBubble&&!a.rootEl&&t!==document&&(B.parentNode[$e]._isOutsideThisEl(a.target),!Z&&at(a)),!m.dragoverBubble&&a.stopPropagation&&a.stopPropagation(),u=!0}function L(){Ie=Te(B),Ke=Te(B,m.draggable),Ce({sortable:b,name:"change",toEl:n,newIndex:Ie,newDraggableIndex:Ke,originalEvent:a})}if(a.preventDefault!==void 0&&a.cancelable&&a.preventDefault(),t=Re(t,m.draggable,n,!0),y("dragOver"),G.eventCanceled)return u;if(B.contains(a.target)||t.animated&&t.animatingX&&t.animatingY||b._ignoreWhileAnimating===t)return O(!1);if(sa=!1,v&&!m.disabled&&(p?h||(d=me!==de):xe===this||(this.lastPutMode=Gt.checkPull(this,v,B,a))&&g.checkPut(this,v,B,a))){if(w=this._getDirection(a,t)==="vertical",i=ge(B),y("dragOverValid"),G.eventCanceled)return u;if(d)return me=de,k(),this._hideClone(),y("revert"),G.eventCanceled||(lt?de.insertBefore(B,lt):de.appendChild(B)),O(!0);var T=Ya(n,m.draggable);if(!T||Fo(a,w,this)&&!T.animated){if(T===B)return O(!1);if(T&&n===a.target&&(t=T),t&&(s=ge(t)),Kt(de,n,B,i,t,s,a,!!t)!==!1)return k(),T&&T.nextSibling?n.insertBefore(B,T.nextSibling):n.appendChild(B),me=n,L(),O(!0)}else if(T&&No(a,w,this)){var X=Ct(n,0,m,!0);if(X===B)return O(!1);if(t=X,s=ge(t),Kt(de,n,B,i,t,s,a,!1)!==!1)return k(),n.insertBefore(B,X),me=n,L(),O(!0)}else if(t.parentNode===n){s=ge(t);var ie=0,ue,ce=B.parentNode!==n,F=!Oo(B.animated&&B.toRect||i,t.animated&&t.toRect||s,w),R=w?"top":"left",te=nl(t,"top","top")||nl(B,"top","top"),U=te?te.scrollTop:void 0;gt!==t&&(ue=s[R],Nt=!1,Xt=!F&&m.invertSwap||ce),ie=Uo(a,t,s,w,F?1:m.swapThreshold,m.invertedSwapThreshold==null?m.swapThreshold:m.invertedSwapThreshold,Xt,gt===t);var se;if(ie!==0){var we=Te(B);do we-=ie,se=me.children[we];while(se&&(Y(se,"display")==="none"||se===ee))}if(ie===0||se===t)return O(!1);gt=t,Rt=ie;var re=t.nextElementSibling,M=!1;M=ie===1;var Q=Kt(de,n,B,i,t,s,a,M);if(Q!==!1)return(Q===1||Q===-1)&&(M=Q===1),Oa=!0,setTimeout(Ro,30),k(),M&&!re?n.appendChild(B):t.parentNode.insertBefore(B,M?re:t),te&&Ul(te,0,U-te.scrollTop),me=B.parentNode,ue!==void 0&&!Xt&&(ta=Math.abs(ue-ge(t)[R])),L(),O(!0)}if(n.contains(B))return O(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){le(document,"mousemove",this._onTouchMove),le(document,"touchmove",this._onTouchMove),le(document,"pointermove",this._onTouchMove),le(document,"dragover",at),le(document,"mousemove",at),le(document,"touchmove",at)},_offUpEvents:function(){var a=this.el.ownerDocument;le(a,"mouseup",this._onDrop),le(a,"touchend",this._onDrop),le(a,"pointerup",this._onDrop),le(a,"pointercancel",this._onDrop),le(a,"touchcancel",this._onDrop),le(document,"selectstart",this)},_onDrop:function(a){var n=this.el,t=this.options;if(Ie=Te(B),Ke=Te(B,t.draggable),_e("drop",this,{evt:a}),me=B&&B.parentNode,Ie=Te(B),Ke=Te(B,t.draggable),G.eventCanceled){this._nulling();return}pt=!1,Xt=!1,Nt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ma(this.cloneId),Ma(this._dragStartId),this.nativeDraggable&&(le(document,"drop",this),le(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Mt&&Y(document.body,"user-select",""),Y(B,"transform",""),a&&($t&&(a.cancelable&&a.preventDefault(),!t.dropBubble&&a.stopPropagation()),ee&&ee.parentNode&&ee.parentNode.removeChild(ee),(de===me||xe&&xe.lastPutMode!=="clone")&&fe&&fe.parentNode&&fe.parentNode.removeChild(fe),B&&(this.nativeDraggable&&le(B,"dragend",this),ka(B),B.style["will-change"]="",$t&&!pt&&De(B,xe?xe.options.ghostClass:this.options.ghostClass,!1),De(B,this.options.chosenClass,!1),Ce({sortable:this,name:"unchoose",toEl:me,newIndex:null,newDraggableIndex:null,originalEvent:a}),de!==me?(Ie>=0&&(Ce({rootEl:me,name:"add",toEl:me,fromEl:de,originalEvent:a}),Ce({sortable:this,name:"remove",toEl:me,originalEvent:a}),Ce({rootEl:me,name:"sort",toEl:me,fromEl:de,originalEvent:a}),Ce({sortable:this,name:"sort",toEl:me,originalEvent:a})),xe&&xe.save()):Ie!==ht&&Ie>=0&&(Ce({sortable:this,name:"update",toEl:me,originalEvent:a}),Ce({sortable:this,name:"sort",toEl:me,originalEvent:a})),G.active&&((Ie==null||Ie===-1)&&(Ie=ht,Ke=Bt),Ce({sortable:this,name:"end",toEl:me,originalEvent:a}),this.save()))),this._nulling()},_nulling:function(){_e("nulling",this),de=B=me=ee=lt=fe=ea=Qe=tt=Be=$t=Ie=Ke=ht=Bt=gt=Rt=xe=Gt=G.dragged=G.ghost=G.clone=G.active=null,ra.forEach(function(a){a.checked=!0}),ra.length=Ea=Ca=0},handleEvent:function(a){switch(a.type){case"drop":case"dragend":this._onDrop(a);break;case"dragenter":case"dragover":B&&(this._onDragOver(a),Bo(a));break;case"selectstart":a.preventDefault();break}},toArray:function(){for(var a=[],n,t=this.el.children,i=0,s=t.length,d=this.options;i<s;i++)n=t[i],Re(n,d.draggable,this.el,!1)&&a.push(n.getAttribute(d.dataIdAttr)||qo(n));return a},sort:function(a,n){var t={},i=this.el;this.toArray().forEach(function(s,d){var m=i.children[d];Re(m,this.options.draggable,i,!1)&&(t[s]=m)},this),n&&this.captureAnimationState(),a.forEach(function(s){t[s]&&(i.removeChild(t[s]),i.appendChild(t[s]))}),n&&this.animateAll()},save:function(){var a=this.options.store;a&&a.set&&a.set(this)},closest:function(a,n){return Re(a,n||this.options.draggable,this.el,!1)},option:function(a,n){var t=this.options;if(n===void 0)return t[a];var i=Yt.modifyOption(this,a,n);typeof i<"u"?t[a]=i:t[a]=n,a==="group"&&Yl(t)},destroy:function(){_e("destroy",this);var a=this.el;a[$e]=null,le(a,"mousedown",this._onTapStart),le(a,"touchstart",this._onTapStart),le(a,"pointerdown",this._onTapStart),this.nativeDraggable&&(le(a,"dragover",this),le(a,"dragenter",this)),Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ia.splice(ia.indexOf(this.el),1),this.el=a=null},_hideClone:function(){if(!Qe){if(_e("hideClone",this),G.eventCanceled)return;Y(fe,"display","none"),this.options.removeCloneOnHide&&fe.parentNode&&fe.parentNode.removeChild(fe),Qe=!0}},_showClone:function(a){if(a.lastPutMode!=="clone"){this._hideClone();return}if(Qe){if(_e("showClone",this),G.eventCanceled)return;B.parentNode==de&&!this.options.group.revertClone?de.insertBefore(fe,B):lt?de.insertBefore(fe,lt):de.appendChild(fe),this.options.group.revertClone&&this.animate(B,fe),Y(fe,"display",""),Qe=!1}}};function Bo(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function Kt(e,a,n,t,i,s,d,m){var g,v=e[$e],p=v.options.onMove,h;return window.CustomEvent&&!Xe&&!jt?g=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(g=document.createEvent("Event"),g.initEvent("move",!0,!0)),g.to=a,g.from=e,g.dragged=n,g.draggedRect=t,g.related=i||a,g.relatedRect=s||ge(a),g.willInsertAfter=m,g.originalEvent=d,e.dispatchEvent(g),p&&(h=p.call(v,g,d)),h}function ka(e){e.draggable=!1}function Ro(){Oa=!1}function No(e,a,n){var t=ge(Ct(n.el,0,n.options,!0)),i=ql(n.el,n.options,ee),s=10;return a?e.clientX<i.left-s||e.clientY<t.top&&e.clientX<t.right:e.clientY<i.top-s||e.clientY<t.bottom&&e.clientX<t.left}function Fo(e,a,n){var t=ge(Ya(n.el,n.options.draggable)),i=ql(n.el,n.options,ee),s=10;return a?e.clientX>i.right+s||e.clientY>t.bottom&&e.clientX>t.left:e.clientY>i.bottom+s||e.clientX>t.right&&e.clientY>t.top}function Uo(e,a,n,t,i,s,d,m){var g=t?e.clientY:e.clientX,v=t?n.height:n.width,p=t?n.top:n.left,h=t?n.bottom:n.right,I=!1;if(!d){if(m&&ta<v*i){if(!Nt&&(Rt===1?g>p+v*s/2:g<h-v*s/2)&&(Nt=!0),Nt)I=!0;else if(Rt===1?g<p+ta:g>h-ta)return-Rt}else if(g>p+v*(1-i)/2&&g<h-v*(1-i)/2)return Ho(a)}return I=I||d,I&&(g<p+v*s/2||g>h-v*s/2)?g>p+v/2?1:-1:0}function Ho(e){return Te(B)<Te(e)?1:-1}function qo(e){for(var a=e.tagName+e.className+e.src+e.href+e.textContent,n=a.length,t=0;n--;)t+=a.charCodeAt(n);return t.toString(36)}function Lo(e){ra.length=0;for(var a=e.getElementsByTagName("input"),n=a.length;n--;){var t=a[n];t.checked&&ra.push(t)}}function aa(e){return setTimeout(e,0)}function Ma(e){return clearTimeout(e)}ha&&ne(document,"touchmove",function(e){(G.active||pt)&&e.cancelable&&e.preventDefault()});G.utils={on:ne,off:le,css:Y,find:Nl,is:function(a,n){return!!Re(a,n,a,!1)},extend:So,throttle:Fl,closest:Re,toggleClass:De,clone:Hl,index:Te,nextTick:aa,cancelNextTick:Ma,detectDirection:jl,getChild:Ct,expando:$e};G.get=function(e){return e[$e]};G.mount=function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];a[0].constructor===Array&&(a=a[0]),a.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(G.utils=Ue(Ue({},G.utils),t.utils)),Yt.mount(t)})};G.create=function(e,a){return new G(e,a)};G.version=_o;var ve=[],Dt,za,Ba=!1,Sa,$a,da,It;function jo(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var a in this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this))}return e.prototype={dragStarted:function(n){var t=n.originalEvent;this.sortable.nativeDraggable?ne(document,"dragover",this._handleAutoScroll):this.options.supportPointer?ne(document,"pointermove",this._handleFallbackAutoScroll):t.touches?ne(document,"touchmove",this._handleFallbackAutoScroll):ne(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var t=n.originalEvent;!this.options.dragOverBubble&&!t.rootEl&&this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?le(document,"dragover",this._handleAutoScroll):(le(document,"pointermove",this._handleFallbackAutoScroll),le(document,"touchmove",this._handleFallbackAutoScroll),le(document,"mousemove",this._handleFallbackAutoScroll)),dl(),la(),$o()},nulling:function(){da=za=Dt=Ba=It=Sa=$a=null,ve.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,t){var i=this,s=(n.touches?n.touches[0]:n).clientX,d=(n.touches?n.touches[0]:n).clientY,m=document.elementFromPoint(s,d);if(da=n,t||this.options.forceAutoScrollFallback||jt||Xe||Mt){Da(n,this.options,m,t);var g=Je(m,!0);Ba&&(!It||s!==Sa||d!==$a)&&(It&&dl(),It=setInterval(function(){var v=Je(document.elementFromPoint(s,d),!0);v!==g&&(g=v,la()),Da(n,i.options,v,t)},10),Sa=s,$a=d)}else{if(!this.options.bubbleScroll||Je(m,!0)===Fe()){la();return}Da(n,this.options,Je(m,!1),!1)}}},Ge(e,{pluginName:"scroll",initializeByDefault:!0})}function la(){ve.forEach(function(e){clearInterval(e.pid)}),ve=[]}function dl(){clearInterval(It)}var Da=Fl(function(e,a,n,t){if(a.scroll){var i=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,d=a.scrollSensitivity,m=a.scrollSpeed,g=Fe(),v=!1,p;za!==n&&(za=n,la(),Dt=a.scroll,p=a.scrollFn,Dt===!0&&(Dt=Je(n,!0)));var h=0,I=Dt;do{var w=I,b=ge(w),u=b.top,y=b.bottom,k=b.left,O=b.right,L=b.width,T=b.height,X=void 0,ie=void 0,ue=w.scrollWidth,ce=w.scrollHeight,F=Y(w),R=w.scrollLeft,te=w.scrollTop;w===g?(X=L<ue&&(F.overflowX==="auto"||F.overflowX==="scroll"||F.overflowX==="visible"),ie=T<ce&&(F.overflowY==="auto"||F.overflowY==="scroll"||F.overflowY==="visible")):(X=L<ue&&(F.overflowX==="auto"||F.overflowX==="scroll"),ie=T<ce&&(F.overflowY==="auto"||F.overflowY==="scroll"));var U=X&&(Math.abs(O-i)<=d&&R+L<ue)-(Math.abs(k-i)<=d&&!!R),se=ie&&(Math.abs(y-s)<=d&&te+T<ce)-(Math.abs(u-s)<=d&&!!te);if(!ve[h])for(var we=0;we<=h;we++)ve[we]||(ve[we]={});(ve[h].vx!=U||ve[h].vy!=se||ve[h].el!==w)&&(ve[h].el=w,ve[h].vx=U,ve[h].vy=se,clearInterval(ve[h].pid),(U!=0||se!=0)&&(v=!0,ve[h].pid=setInterval((function(){t&&this.layer===0&&G.active._onTouchMove(da);var re=ve[this.layer].vy?ve[this.layer].vy*m:0,M=ve[this.layer].vx?ve[this.layer].vx*m:0;typeof p=="function"&&p.call(G.dragged.parentNode[$e],M,re,e,da,ve[this.layer].el)!=="continue"||Ul(ve[this.layer].el,M,re)}).bind({layer:h}),24))),h++}while(a.bubbleScroll&&I!==g&&(I=Je(I,!1)));Ba=v}},30),Wl=function(a){var n=a.originalEvent,t=a.putSortable,i=a.dragEl,s=a.activeSortable,d=a.dispatchSortableEvent,m=a.hideGhostForTarget,g=a.unhideGhostForTarget;if(n){var v=t||s;m();var p=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,h=document.elementFromPoint(p.clientX,p.clientY);g(),v&&!v.el.contains(h)&&(d("spill"),this.onSpill({dragEl:i,putSortable:t}))}};function Ga(){}Ga.prototype={startIndex:null,dragStart:function(a){var n=a.oldDraggableIndex;this.startIndex=n},onSpill:function(a){var n=a.dragEl,t=a.putSortable;this.sortable.captureAnimationState(),t&&t.captureAnimationState();var i=Ct(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(n,i):this.sortable.el.appendChild(n),this.sortable.animateAll(),t&&t.animateAll()},drop:Wl};Ge(Ga,{pluginName:"revertOnSpill"});function Xa(){}Xa.prototype={onSpill:function(a){var n=a.dragEl,t=a.putSortable,i=t||this.sortable;i.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),i.animateAll()},drop:Wl};Ge(Xa,{pluginName:"removeOnSpill"});G.mount(new jo);G.mount(Xa,Ga);const Yo=["data-estado"],Go={class:"p-3 border-b bg-background/50 rounded-t-lg"},Xo={class:"flex items-center gap-2"},Wo={class:"font-medium text-sm"},Ko=["data-estado"],Qo={key:0,class:"h-20 border-2 border-dashed border-muted-foreground/20 rounded-lg flex items-center justify-center text-sm text-muted-foreground"},Zo=be({__name:"HitosKanbanColumn",props:{estado:{},entregables:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},canDrag:{type:Boolean,default:!1},isDragOver:{type:Boolean,default:!1}},emits:["view","edit","delete","complete","change-status","show-comentarios","show-actividad"],setup(e,{emit:a}){const n=e,t=a,i=J(()=>Ot[n.estado]),s=J(()=>{switch(n.estado){case"completado":return et;case"en_progreso":return Me;case"cancelado":return qt;default:return xt}}),d=J(()=>{const m="flex flex-col rounded-lg border bg-muted/30 min-h-[300px] transition-colors duration-150",g=n.isDragOver?"border-primary border-dashed bg-primary/5":"border-border";return`${m} ${g}`});return(m,g)=>(c(),C("div",{class:ae(d.value),"data-estado":e.estado},[f("div",Go,[f("div",Xo,[(c(),P(rt(s.value),{class:ae(["h-4 w-4 flex-shrink-0",i.value.color])},null,8,["class"])),f("span",Wo,$(i.value.label),1),o(l(ye),{variant:"secondary",class:"ml-auto text-xs"},{default:r(()=>[S($(e.entregables.length),1)]),_:1})])]),o(l(Ft),{class:"flex-1 p-2"},{default:r(()=>[f("div",{class:"kanban-column-cards space-y-2 min-h-[200px]","data-estado":e.estado},[(c(!0),C(oe,null,pe(e.entregables,v=>(c(),P(La,{key:v.id,entregable:v,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,draggable:e.canDrag,variant:"kanban",onView:p=>t("view",v),onEdit:p=>t("edit",v),onDelete:p=>t("delete",v),onComplete:p=>t("complete",v),onChangeStatus:p=>t("change-status",v,p),onShowComentarios:p=>t("show-comentarios",v),onShowActividad:p=>t("show-actividad",v)},null,8,["entregable","can-edit","can-delete","can-complete","draggable","onView","onEdit","onDelete","onComplete","onChangeStatus","onShowComentarios","onShowActividad"]))),128)),e.entregables.length===0?(c(),C("div",Qo," Sin entregables ")):_("",!0)],8,Ko)]),_:1})],10,Yo))}}),Jo={class:"kanban-container flex gap-4 overflow-x-auto snap-x snap-mandatory pb-4 px-1 min-w-0"},es=be({__name:"HitosEntregablesKanban",props:{entregables:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},canDrag:{type:Boolean,default:!1},confirmOnDrag:{type:Boolean,default:!0}},emits:["view","edit","delete","complete","change-status","drag-change-status","show-comentarios","show-actividad"],setup(e,{emit:a}){const n=e,t=a,i=_t(n,"entregables"),{entregablesAgrupados:s}=Lt(i),d=N(null),m=N([]),g={pendiente:"pendientes",en_progreso:"en_progreso",completado:"completados",cancelado:"cancelados"},v=I=>s.value[g[I]],p=()=>{h(),n.canDrag&&dt(()=>{document.querySelectorAll(".kanban-column-cards").forEach(w=>{const b=G.create(w,{group:"entregables-kanban",animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",delay:100,delayOnTouchOnly:!0,touchStartThreshold:3,onStart:()=>{},onEnd:u=>{const y=parseInt(u.item.dataset.id||"0"),k=u.to.dataset.estado,O=u.from.dataset.estado;if(d.value=null,k===O)return;const L=n.entregables.find(T=>T.id===y);L&&t("drag-change-status",L,k)},onChange:u=>{const y=u.to.dataset.estado;y&&(d.value=y)}});m.value.push(b)})})},h=()=>{m.value.forEach(I=>{I.destroy()}),m.value=[]};return ml(()=>{p()}),tn(()=>{h()}),he(()=>n.entregables,()=>{dt(()=>{p()})},{deep:!0}),(I,w)=>(c(),C("div",Jo,[(c(!0),C(oe,null,pe(l(Aa),b=>(c(),C("div",{key:b,class:"kanban-column flex-shrink-0 w-72 snap-center"},[o(Zo,{estado:b,entregables:v(b),"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,"can-drag":e.canDrag,"is-drag-over":d.value===b,onView:w[0]||(w[0]=u=>t("view",u)),onEdit:w[1]||(w[1]=u=>t("edit",u)),onDelete:w[2]||(w[2]=u=>t("delete",u)),onComplete:w[3]||(w[3]=u=>t("complete",u)),onChangeStatus:w[4]||(w[4]=(u,y)=>t("change-status",u,y)),onShowComentarios:w[5]||(w[5]=u=>t("show-comentarios",u)),onShowActividad:w[6]||(w[6]=u=>t("show-actividad",u))},null,8,["estado","entregables","can-edit","can-delete","can-complete","can-drag","is-drag-over"])]))),128))]))}}),ts={class:"space-y-4 min-w-0"},ul="entregables-confirm-drag",as=be({__name:"HitosEntregablesPanel",props:{entregables:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},initialModalEntregableId:{},initialModalTab:{}},emits:["view","edit","delete","complete","update-status","open-modal","modal-tab-change"],setup(e,{emit:a}){const n=e,t=a,i=_t(n,"entregables"),{viewMode:s}=Lt(i),m=N((()=>{const F=localStorage.getItem(ul);return F===null?!0:F==="true"})()),g=F=>{m.value=F,localStorage.setItem(ul,String(F))},v=N(!1),p=N(null),h=N("pendiente"),I=N(!1),w=N(!1),b=N(null),u=F=>{t("open-modal",F,"comentarios")},y=F=>{t("open-modal",F,"actividad")};ml(()=>{if(n.initialModalEntregableId){const F=n.entregables.find(R=>R.id===n.initialModalEntregableId);F&&t("open-modal",F,n.initialModalTab||"detalles")}});const k=F=>{t("open-modal",F,"detalles")},O=F=>{t("edit",F)},L=F=>{b.value=F,w.value=!0},T=()=>{b.value&&t("delete",b.value),w.value=!1,b.value=null},X=F=>{p.value=F,h.value="completado",v.value=!0},ie=(F,R)=>{p.value=F,h.value=R,v.value=!0},ue=(F,R)=>{m.value?(p.value=F,h.value=R,v.value=!0):t("update-status",F,R,"",[])},ce=(F,R)=>{p.value&&(h.value==="completado"?t("complete",p.value,F,R):t("update-status",p.value,h.value,F,R),v.value=!1,p.value=null)};return(F,R)=>{var te,U;return c(),C("div",ts,[o(qn,{modelValue:l(s),"onUpdate:modelValue":R[0]||(R[0]=se=>an(s)?s.value=se:null),"confirm-on-drag":m.value,"onUpdate:confirmOnDrag":g},null,8,["modelValue","confirm-on-drag"]),l(s)==="list"?(c(),P(go,{key:0,entregables:e.entregables,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,onView:k,onEdit:O,onDelete:L,onComplete:X,onChangeStatus:ie,onShowComentarios:u,onShowActividad:y},null,8,["entregables","can-edit","can-delete","can-complete"])):l(s)==="tabs"?(c(),P(xo,{key:1,entregables:e.entregables,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,onView:k,onEdit:O,onDelete:L,onComplete:X,onChangeStatus:ie,onShowComentarios:u,onShowActividad:y},null,8,["entregables","can-edit","can-delete","can-complete"])):l(s)==="kanban"?(c(),P(es,{key:2,entregables:e.entregables,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,"can-drag":e.canComplete,"confirm-on-drag":m.value,onView:k,onEdit:O,onDelete:L,onComplete:X,onChangeStatus:ie,onDragChangeStatus:ue,onShowComentarios:u,onShowActividad:y},null,8,["entregables","can-edit","can-delete","can-complete","can-drag","confirm-on-drag"])):_("",!0),o(Rn,{open:v.value,"onUpdate:open":R[1]||(R[1]=se=>v.value=se),"entregable-nombre":(te=p.value)==null?void 0:te.nombre,"estado-actual":(U=p.value)==null?void 0:U.estado,"nuevo-estado":h.value,loading:I.value,onConfirm:ce},null,8,["open","entregable-nombre","estado-actual","nuevo-estado","loading"]),o(l(on),{open:w.value,"onUpdate:open":R[2]||(R[2]=se=>w.value=se)},{default:r(()=>[o(l(sn),null,{default:r(()=>[o(l(rn),null,{default:r(()=>[o(l(dn),null,{default:r(()=>[...R[3]||(R[3]=[S("¿Estás seguro?",-1)])]),_:1}),o(l(un),null,{default:r(()=>{var se;return[S(' Esta acción no se puede deshacer. Se eliminará permanentemente el entregable "'+$((se=b.value)==null?void 0:se.nombre)+'". ',1)]}),_:1})]),_:1}),o(l(cn),null,{default:r(()=>[o(l(fn),null,{default:r(()=>[...R[4]||(R[4]=[S("Cancelar",-1)])]),_:1}),o(l(mn),{class:"bg-red-600 hover:bg-red-700",onClick:T},{default:r(()=>[...R[5]||(R[5]=[S(" Eliminar ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])}}}),ls={key:0,class:"flex items-center gap-2"},ns={key:1,class:"flex items-start gap-2"},os={class:"flex-1 min-w-0"},ss={class:"flex items-center gap-1 flex-shrink-0 pt-1"},is=be({__name:"InlineEditWrapper",props:{displayValue:{},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"Sin valor"},showConfirmButton:{type:Boolean,default:!1},wrapperClass:{default:""}},emits:["edit-start","edit-cancel","save"],setup(e,{expose:a,emit:n}){const t=e,i=n,s=N(!1),d=J(()=>t.displayValue===null||t.displayValue===void 0||t.displayValue===""?t.placeholder:t.displayValue),m=J(()=>t.displayValue===null||t.displayValue===void 0||t.displayValue===""),g=()=>{!t.canEdit||t.disabled||t.loading||(s.value=!0,i("edit-start"))},v=()=>{s.value=!1,i("edit-cancel")},p=()=>{i("save")},h=()=>{s.value=!1},I=w=>{w.key==="Escape"&&v()};return a({startEditing:g,cancelEditing:v,closeEditing:h,isEditing:s}),(w,b)=>(c(),C("div",{class:ae(["group inline-edit-wrapper relative",e.wrapperClass]),onKeydown:I},[s.value?(c(),C("div",ns,[f("div",os,[Ka(w.$slots,"edit",{save:p,cancel:v},void 0,!0)]),f("div",ss,[e.showConfirmButton?(c(),P(l(H),{key:0,variant:"ghost",size:"icon",class:"h-6 w-6 text-green-600 hover:text-green-700 hover:bg-green-50",disabled:e.loading,onClick:Pe(p,["stop"]),"aria-label":"Guardar"},{default:r(()=>[e.loading?(c(),P(l(wt),{key:0,class:"h-3.5 w-3.5 animate-spin"})):(c(),P(l(wn),{key:1,class:"h-3.5 w-3.5"}))]),_:1},8,["disabled"])):_("",!0),o(l(H),{variant:"ghost",size:"icon",class:"h-6 w-6 text-muted-foreground hover:text-foreground",disabled:e.loading,onClick:Pe(v,["stop"]),"aria-label":"Cancelar"},{default:r(()=>[o(l(Ht),{class:"h-3.5 w-3.5"})]),_:1},8,["disabled"]),e.loading&&!e.showConfirmButton?(c(),P(l(wt),{key:1,class:"h-4 w-4 animate-spin text-muted-foreground"})):_("",!0)])])):(c(),C("div",ls,[f("span",{class:ae(["flex-1",m.value?"text-muted-foreground italic":""])},[Ka(w.$slots,"display",{},()=>[S($(d.value),1)],!0)],2),e.canEdit&&!e.disabled?(c(),P(l(H),{key:0,variant:"ghost",size:"icon",class:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",disabled:e.loading,onClick:Pe(g,["stop"]),"aria-label":`Editar ${e.label||"campo"}`},{default:r(()=>[o(l(pa),{class:"h-3.5 w-3.5"})]),_:1},8,["disabled","aria-label"])):_("",!0)]))],34))}}),kt=En(is,[["__scopeId","data-v-a4dfbf28"]]),rs={class:"space-y-1"},ds={key:0,class:"text-xs text-red-600"},Kl=be({__name:"InlineEditText",props:{modelValue:{default:""},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"Sin valor"},maxLength:{default:255},required:{type:Boolean,default:!1},minLength:{default:0}},emits:["update:modelValue","save"],setup(e,{expose:a,emit:n}){const t=e,i=n,s=N(null),d=N(null),m=N(t.modelValue||""),g=N(null);he(()=>t.modelValue,y=>{var k;(k=s.value)!=null&&k.isEditing||(m.value=y||"")});const v=()=>(g.value=null,t.required&&!m.value.trim()?(g.value="Este campo es requerido",!1):t.minLength&&m.value.length<t.minLength?(g.value=`Mínimo ${t.minLength} caracteres`,!1):!0),p=()=>{var k;if(!v())return;const y=m.value.trim();y!==(t.modelValue||"")?i("save",y):(k=s.value)==null||k.closeEditing()},h=()=>{m.value=t.modelValue||"",g.value=null,dt(()=>{var k;const y=(k=d.value)==null?void 0:k.$el;y==null||y.focus(),y==null||y.select()})},I=()=>{m.value=t.modelValue||"",g.value=null},w=y=>{y.key==="Enter"&&(y.preventDefault(),p())},b=y=>{const k=y.relatedTarget;k!=null&&k.closest(".inline-edit-wrapper")||p()};return a({closeAfterSave:()=>{var y;(y=s.value)==null||y.closeEditing()}}),(y,k)=>(c(),P(kt,{ref_key:"wrapperRef",ref:s,"display-value":e.modelValue||"","can-edit":e.canEdit,loading:e.loading,disabled:e.disabled,label:e.label,placeholder:e.placeholder,onEditStart:h,onEditCancel:I,onSave:p},{edit:r(()=>[f("div",rs,[o(l(ut),{ref_key:"inputRef",ref:d,modelValue:m.value,"onUpdate:modelValue":k[0]||(k[0]=O=>m.value=O),maxlength:e.maxLength,disabled:e.loading,class:ae([{"border-red-500":g.value},"h-8"]),onKeydown:w,onBlur:b},null,8,["modelValue","maxlength","disabled","class"]),g.value?(c(),C("p",ds,$(g.value),1)):_("",!0)])]),_:1},8,["display-value","can-edit","loading","disabled","label","placeholder"]))}}),us={class:"whitespace-pre-wrap"},Ra=be({__name:"InlineEditTextarea",props:{modelValue:{default:""},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"Sin descripción"},maxLength:{default:5e3},rows:{default:3},truncateDisplay:{default:150}},emits:["update:modelValue","save"],setup(e,{expose:a,emit:n}){const t=e,i=n,s=N(null),d=N(null),m=N(t.modelValue||""),g=J(()=>{const w=t.modelValue||"";return t.truncateDisplay&&w.length>t.truncateDisplay?w.substring(0,t.truncateDisplay)+"...":w});he(()=>t.modelValue,w=>{var b;(b=s.value)!=null&&b.isEditing||(m.value=w||"")});const v=()=>{var b;const w=m.value.trim();w!==(t.modelValue||"")?i("save",w):(b=s.value)==null||b.closeEditing()},p=()=>{m.value=t.modelValue||"",dt(()=>{var b;const w=(b=d.value)==null?void 0:b.$el;w==null||w.focus()})},h=()=>{m.value=t.modelValue||""};return a({closeAfterSave:()=>{var w;(w=s.value)==null||w.closeEditing()}}),(w,b)=>(c(),P(kt,{ref_key:"wrapperRef",ref:s,"display-value":g.value,"can-edit":e.canEdit,loading:e.loading,disabled:e.disabled,label:e.label,placeholder:e.placeholder,"show-confirm-button":!0,onEditStart:p,onEditCancel:h,onSave:v},{display:r(()=>[f("span",us,$(g.value||e.placeholder),1)]),edit:r(()=>[o(l($l),{ref_key:"textareaRef",ref:d,modelValue:m.value,"onUpdate:modelValue":b[0]||(b[0]=u=>m.value=u),maxlength:e.maxLength,rows:e.rows,disabled:e.loading,class:"min-h-[80px] resize-y"},null,8,["modelValue","maxlength","rows","disabled"])]),_:1},8,["display-value","can-edit","loading","disabled","label","placeholder"]))}}),ua=be({__name:"InlineEditDate",props:{modelValue:{default:null},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"Sin fecha"},displayFormat:{default:"dd/MM/yyyy"},minDate:{},maxDate:{}},emits:["update:modelValue","save"],setup(e,{expose:a,emit:n}){const t=e,i=n,s=N(null),d=N(null),m=N(t.modelValue||""),g=J(()=>{if(!t.modelValue)return"";try{const u=Et(t.modelValue);if(pl(u))return je(u,t.displayFormat,{locale:Ye})}catch{}return t.modelValue});he(()=>t.modelValue,u=>{var y;(y=s.value)!=null&&y.isEditing||(m.value=u||"")});const v=()=>{var y;const u=m.value||null;u!==t.modelValue?i("save",u):(y=s.value)==null||y.closeEditing()},p=()=>{m.value=t.modelValue||"",dt(()=>{var y,k;const u=(y=d.value)==null?void 0:y.$el;u==null||u.focus(),(k=u==null?void 0:u.showPicker)==null||k.call(u)})},h=()=>{m.value=t.modelValue||""},I=()=>{v()},w=u=>{const y=u.relatedTarget;y!=null&&y.closest(".inline-edit-wrapper")||v()};return a({closeAfterSave:()=>{var u;(u=s.value)==null||u.closeEditing()}}),(u,y)=>(c(),P(kt,{ref_key:"wrapperRef",ref:s,"display-value":g.value,"can-edit":e.canEdit,loading:e.loading,disabled:e.disabled,label:e.label,placeholder:e.placeholder,onEditStart:p,onEditCancel:h,onSave:v},{edit:r(()=>[o(l(ut),{ref_key:"inputRef",ref:d,modelValue:m.value,"onUpdate:modelValue":y[0]||(y[0]=k=>m.value=k),type:"date",min:e.minDate,max:e.maxDate,disabled:e.loading,class:"h-8 w-auto",onChange:I,onBlur:w},null,8,["modelValue","min","max","disabled"])]),_:1},8,["display-value","can-edit","loading","disabled","label","placeholder"]))}}),cs={key:1,class:"text-muted-foreground italic"},ca=be({__name:"InlineEditSelect",props:{modelValue:{default:null},options:{},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"Seleccionar..."},showBadge:{type:Boolean,default:!1}},emits:["update:modelValue","save"],setup(e,{expose:a,emit:n}){const t=e,i=n,s=N(null),d=N(t.modelValue||""),m=J(()=>t.options.find(b=>b.value===t.modelValue)),g=J(()=>{var b;return((b=m.value)==null?void 0:b.label)||""});he(()=>t.modelValue,b=>{var u;(u=s.value)!=null&&u.isEditing||(d.value=b||"")});const v=()=>{var b;d.value!==t.modelValue?i("save",d.value):(b=s.value)==null||b.closeEditing()},p=()=>{d.value=t.modelValue||""},h=()=>{d.value=t.modelValue||""},I=b=>{d.value=b,v()};return a({closeAfterSave:()=>{var b;(b=s.value)==null||b.closeEditing()}}),(b,u)=>(c(),P(kt,{ref_key:"wrapperRef",ref:s,"display-value":g.value,"can-edit":e.canEdit,loading:e.loading,disabled:e.disabled,label:e.label,placeholder:e.placeholder,onEditStart:p,onEditCancel:h,onSave:v},{display:r(()=>[m.value?(c(),C("span",{key:0,class:ae([e.showBadge&&m.value.color?"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium":"",e.showBadge&&m.value.color?m.value.color:""])},$(m.value.label),3)):(c(),C("span",cs,$(e.placeholder),1))]),edit:r(()=>[o(l(Vt),{"model-value":d.value,disabled:e.loading,"onUpdate:modelValue":I},{default:r(()=>[o(l(Tt),{class:"h-8 w-auto min-w-[150px]"},{default:r(()=>[o(l(Pt),{placeholder:e.placeholder},null,8,["placeholder"])]),_:1}),o(l(At),null,{default:r(()=>[(c(!0),C(oe,null,pe(e.options,y=>(c(),P(l(nt),{key:y.value,value:y.value},{default:r(()=>[f("span",{class:ae([e.showBadge&&y.color?"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium":"",e.showBadge&&y.color?y.color:""])},$(y.label),3)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),_:1},8,["display-value","can-edit","loading","disabled","label","placeholder"]))}}),fs={class:"space-y-1"},ms={key:0,class:"text-xs text-red-600"},Ql=be({__name:"InlineEditNumber",props:{modelValue:{default:null},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"0"},min:{},max:{},step:{default:1}},emits:["update:modelValue","save"],setup(e,{expose:a,emit:n}){var y;const t=e,i=n,s=N(null),d=N(null),m=N(((y=t.modelValue)==null?void 0:y.toString())||""),g=N(null);he(()=>t.modelValue,k=>{var O;(O=s.value)!=null&&O.isEditing||(m.value=(k==null?void 0:k.toString())||"")});const v=()=>{g.value=null;const k=parseFloat(m.value);return m.value&&isNaN(k)?(g.value="Debe ser un número válido",!1):t.min!==void 0&&k<t.min?(g.value=`Mínimo: ${t.min}`,!1):t.max!==void 0&&k>t.max?(g.value=`Máximo: ${t.max}`,!1):!0},p=()=>{var O;if(!v())return;const k=m.value?parseFloat(m.value):null;k!==t.modelValue?i("save",k):(O=s.value)==null||O.closeEditing()},h=()=>{var k;m.value=((k=t.modelValue)==null?void 0:k.toString())||"",g.value=null,dt(()=>{var L;const O=(L=d.value)==null?void 0:L.$el;O==null||O.focus(),O==null||O.select()})},I=()=>{var k;m.value=((k=t.modelValue)==null?void 0:k.toString())||"",g.value=null},w=k=>{k.key==="Enter"&&(k.preventDefault(),p())},b=k=>{const O=k.relatedTarget;O!=null&&O.closest(".inline-edit-wrapper")||p()};return a({closeAfterSave:()=>{var k;(k=s.value)==null||k.closeEditing()}}),(k,O)=>{var L;return c(),P(kt,{ref_key:"wrapperRef",ref:s,"display-value":((L=e.modelValue)==null?void 0:L.toString())||"","can-edit":e.canEdit,loading:e.loading,disabled:e.disabled,label:e.label,placeholder:e.placeholder,onEditStart:h,onEditCancel:I,onSave:p},{edit:r(()=>[f("div",fs,[o(l(ut),{ref_key:"inputRef",ref:d,modelValue:m.value,"onUpdate:modelValue":O[0]||(O[0]=T=>m.value=T),type:"number",min:e.min,max:e.max,step:e.step,disabled:e.loading,class:ae([{"border-red-500":g.value},"h-8 w-24"]),onKeydown:w,onBlur:b},null,8,["modelValue","min","max","step","disabled","class"]),g.value?(c(),C("p",ms,$(g.value),1)):_("",!0)])]),_:1},8,["display-value","can-edit","loading","disabled","label","placeholder"])}}}),vs={class:"group inline-edit-user flex items-center gap-2"},gs={class:"flex items-center gap-2 flex-1 min-w-0"},ps={class:"min-w-0"},hs={class:"text-sm font-medium truncate"},bs={class:"text-xs text-muted-foreground truncate"},ys={key:1,class:"flex items-center gap-2 text-muted-foreground"},xs={class:"text-sm italic"},ws={class:"flex items-center gap-1 flex-shrink-0"},Zl=be({__name:"InlineEditUser",props:{modelValue:{default:null},userId:{default:null},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"Sin responsable"},searchEndpoint:{},excludedIds:{default:()=>[]},modalTitle:{default:"Seleccionar Usuario"},modalDescription:{default:"Busca y selecciona un usuario"},allowClear:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(e,{emit:a}){const n=e,t=a,i=N(!1),s=p=>p.split(" ").map(h=>h[0]).join("").toUpperCase().slice(0,2),d=J(()=>[...n.excludedIds]),m=()=>{!n.canEdit||n.disabled||n.loading||(i.value=!0)},g=p=>{var h;if(p.userIds.length>0){const I=p.userIds[0],w=((h=p.users)==null?void 0:h[0])||{id:I,name:`Usuario #${I}`,email:""};t("save",I,w)}i.value=!1},v=()=>{!n.canEdit||n.disabled||n.loading||t("save",null,null)};return(p,h)=>(c(),C("div",vs,[f("div",gs,[e.modelValue?(c(),C(oe,{key:0},[o(l(Dl),{class:"h-7 w-7 flex-shrink-0"},{default:r(()=>[e.modelValue.avatar?(c(),P(l(Il),{key:0,src:e.modelValue.avatar},null,8,["src"])):_("",!0),o(l(Vl),{class:"text-xs"},{default:r(()=>[S($(s(e.modelValue.name)),1)]),_:1})]),_:1}),f("div",ps,[f("p",hs,$(e.modelValue.name),1),f("p",bs,$(e.modelValue.email),1)])],64)):(c(),C("div",ys,[o(l(st),{class:"h-4 w-4"}),f("span",xs,$(e.placeholder),1)]))]),f("div",ws,[e.loading?(c(),P(l(wt),{key:0,class:"h-4 w-4 animate-spin text-muted-foreground"})):_("",!0),e.canEdit&&!e.disabled&&!e.loading?(c(),P(l(H),{key:1,variant:"ghost",size:"icon",class:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:Pe(m,["stop"]),"aria-label":`Cambiar ${e.label||"usuario"}`},{default:r(()=>[o(l(pa),{class:"h-3.5 w-3.5"})]),_:1},8,["aria-label"])):_("",!0),e.allowClear&&e.modelValue&&e.canEdit&&!e.disabled&&!e.loading?(c(),P(l(H),{key:2,variant:"ghost",size:"icon",class:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-red-600",onClick:Pe(v,["stop"]),"aria-label":"Quitar usuario"},{default:r(()=>[o(l(Ht),{class:"h-3.5 w-3.5"})]),_:1})):_("",!0)]),o(Tl,{modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=I=>i.value=I),title:e.modalTitle,description:e.modalDescription,"search-endpoint":e.searchEndpoint,"excluded-ids":d.value,"max-selection":1,"submit-button-text":"Seleccionar","search-placeholder":"Buscar por nombre, email...",onSubmit:g},null,8,["modelValue","title","description","search-endpoint","excluded-ids"])]))}}),Es={class:"group inline-edit-etiquetas"},Cs={class:"flex items-center gap-2 flex-wrap"},_s={key:1,class:"text-sm text-muted-foreground italic"},ks={class:"py-4"},Jl=be({__name:"InlineEditEtiquetas",props:{modelValue:{default:()=>[]},etiquetas:{default:()=>[]},categorias:{},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},label:{},placeholder:{default:"Sin etiquetas"},maxEtiquetas:{default:10}},emits:["update:modelValue","save"],setup(e,{emit:a}){const n=e,t=a,i=N(!1),s=N([...n.modelValue]),d=()=>{!n.canEdit||n.disabled||n.loading||(s.value=[...n.modelValue],i.value=!0)},m=()=>{(s.value.length!==n.modelValue.length||s.value.some(p=>!n.modelValue.includes(p)))&&t("save",s.value),i.value=!1},g=()=>{s.value=[...n.modelValue],i.value=!1};return(v,p)=>(c(),C("div",Es,[f("div",Cs,[e.etiquetas&&e.etiquetas.length>0?(c(!0),C(oe,{key:0},pe(e.etiquetas,h=>(c(),P(l(ye),{key:h.id,variant:"secondary",style:ln(h.color?{backgroundColor:h.color+"20",color:h.color,borderColor:h.color}:{}),class:"text-xs"},{default:r(()=>[S($(h.nombre),1)]),_:2},1032,["style"]))),128)):(c(),C("span",_s,$(e.placeholder),1)),e.loading?(c(),P(l(wt),{key:2,class:"h-4 w-4 animate-spin text-muted-foreground"})):_("",!0),e.canEdit&&!e.disabled&&!e.loading?(c(),P(l(H),{key:3,variant:"ghost",size:"icon",class:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",onClick:Pe(d,["stop"]),"aria-label":`Editar ${e.label||"etiquetas"}`},{default:r(()=>[o(l(pa),{class:"h-3.5 w-3.5"})]),_:1},8,["aria-label"])):_("",!0)]),o(l(fa),{open:i.value,"onUpdate:open":p[1]||(p[1]=h=>i.value=h)},{default:r(()=>[o(l(ma),{class:"sm:max-w-lg"},{default:r(()=>[o(l(va),null,{default:r(()=>[o(l(yt),{class:"flex items-center gap-2"},{default:r(()=>[o(l(qa),{class:"h-5 w-5"}),p[2]||(p[2]=S(" Editar Etiquetas ",-1))]),_:1})]),_:1}),f("div",ks,[o(Cn,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=h=>s.value=h),categorias:e.categorias,"max-etiquetas":e.maxEtiquetas,placeholder:"Seleccionar etiquetas..."},null,8,["modelValue","categorias","max-etiquetas"])]),o(l(ga),null,{default:r(()=>[o(l(H),{variant:"outline",onClick:g},{default:r(()=>[...p[3]||(p[3]=[S(" Cancelar ",-1)])]),_:1}),o(l(H),{onClick:m,disabled:e.loading},{default:r(()=>[e.loading?(c(),P(l(wt),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):_("",!0),p[4]||(p[4]=S(" Guardar ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}}),Ss={key:0,class:"group flex items-center gap-2"},$s={class:"text-sm"},Ds={key:1,class:"space-y-2"},Is={key:0,class:"flex items-center gap-2 p-2 rounded-lg border bg-muted/50"},Vs={class:"text-sm flex-1 truncate"},Ts={class:"flex items-center gap-1"},Ps={key:1},As={class:"flex items-center gap-2"},Os={key:1,class:"flex items-center"},Ms={key:2},zs={key:0,class:"text-xs text-muted-foreground mt-1"},Bs={key:1,class:"text-xs text-muted-foreground mt-1"},Rs={key:2,class:"text-xs text-muted-foreground mt-1"},en=be({__name:"InlineEditCampoPersonalizado",props:{campo:{},modelValue:{default:null},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","save"],setup(e,{expose:a,emit:n}){const t=e,i=n,s=N(null),d=N(null),m=N(t.modelValue),g=M=>M===!0||M===1||M==="1"||M==="true",v=N(g(t.modelValue)),p=N(!1),h=N(null),I=N(!1),w=J(()=>t.campo.tipo==="file"&&typeof t.modelValue=="string"&&t.modelValue?t.modelValue:null),b=J(()=>t.campo.opciones?t.campo.opciones.map(M=>typeof M=="string"?{value:M,label:M}:M):[]),u=J(()=>{switch(t.campo.tipo){case"email":return"email";case"url":return"url";case"phone":return"tel";case"number":return"number";case"date":return"date";default:return"text"}}),y=J(()=>{const M=t.modelValue;if(M==null||M==="")return"";switch(t.campo.tipo){case"checkbox":return g(M)?"Sí":"No";case"date":try{const Z=Et(M);if(pl(Z))return je(Z,"dd/MM/yyyy",{locale:Ye})}catch{}return M;case"select":case"radio":const Q=b.value.find(Z=>Z.value===M);return(Q==null?void 0:Q.label)||M;default:return String(M)}});he(()=>t.modelValue,M=>{var Q,Z;I.value?(I.value=!1,(Q=s.value)==null||Q.closeEditing(),m.value=M):(Z=s.value)!=null&&Z.isEditing||(m.value=M),t.campo.tipo==="checkbox"&&(v.value=g(M)),t.campo.tipo==="file"&&h.value&&typeof M=="string"&&M&&(h.value=null,p.value=!1)}),he(()=>t.loading,(M,Q)=>{var Z;Q&&!M&&I.value&&(I.value=!1,(Z=s.value)==null||Z.closeEditing())});const k=()=>{var M;m.value!==t.modelValue?(I.value=!0,i("save",t.campo.id,m.value)):(M=s.value)==null||M.closeEditing()},O=()=>{m.value=t.modelValue,dt(()=>{var Q;const M=(Q=d.value)==null?void 0:Q.$el;M&&(M.focus(),M instanceof HTMLInputElement&&t.campo.tipo==="text"&&M.select())})},L=()=>{m.value=t.modelValue},T=M=>{M.key==="Enter"&&t.campo.tipo!=="textarea"&&(M.preventDefault(),k())},X=M=>{const Q=M.relatedTarget;Q!=null&&Q.closest(".inline-edit-wrapper")||k()},ie=M=>{v.value=M,m.value=M,i("save",t.campo.id,M)},ue=M=>{m.value=M,k()},ce=M=>{m.value=M,k()},F=()=>{w.value&&window.open(`/storage/campos-personalizados/${w.value}`,"_blank")},R=()=>{if(w.value){const M=document.createElement("a");M.href=`/storage/campos-personalizados/${w.value}`,M.download=w.value,M.click()}},te=()=>{p.value=!1,h.value=null},U=M=>{const Q=M.target;Q.files&&Q.files[0]&&(h.value=Q.files[0])},se=()=>{h.value&&(I.value=!0,i("save",t.campo.id,h.value))},we=()=>{var M;(M=s.value)==null||M.closeEditing()},re=J(()=>t.campo.tipo==="textarea");return a({closeAfterSave:we}),(M,Q)=>e.campo.tipo==="checkbox"?(c(),C("div",Ss,[o(l(_n),{checked:v.value,disabled:!e.canEdit||e.disabled||e.loading,"onUpdate:checked":ie},null,8,["checked","disabled"]),f("span",$s,$(v.value?"Sí":"No"),1)])):e.campo.tipo==="file"?(c(),C("div",Ds,[w.value&&!p.value?(c(),C("div",Is,[o(l(it),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),f("span",Vs,$(w.value),1),f("div",Ts,[o(l(H),{type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0",onClick:F,title:"Ver archivo"},{default:r(()=>[o(l(Ia),{class:"h-3.5 w-3.5"})]),_:1}),o(l(H),{type:"button",variant:"ghost",size:"sm",class:"h-7 w-7 p-0",onClick:R,title:"Descargar archivo"},{default:r(()=>[o(l($n),{class:"h-3.5 w-3.5"})]),_:1}),e.canEdit&&!e.disabled&&!e.loading?(c(),P(l(H),{key:0,type:"button",variant:"outline",size:"sm",class:"h-7 text-xs",onClick:Q[0]||(Q[0]=Z=>p.value=!0)},{default:r(()=>[...Q[3]||(Q[3]=[S(" Reemplazar ",-1)])]),_:1})):_("",!0)])])):_("",!0),!w.value||p.value?(c(),C("div",Ps,[f("div",As,[o(l(ut),{type:"file",disabled:!e.canEdit||e.disabled||e.loading,class:"flex-1 h-8 text-sm",onChange:U},null,8,["disabled"]),h.value?(c(),P(l(H),{key:0,type:"button",variant:"default",size:"sm",class:"h-8",disabled:e.loading,onClick:se},{default:r(()=>[e.loading?_("",!0):(c(),P(l(Dn),{key:0,class:"h-4 w-4 mr-1"})),e.loading?(c(),C("span",Os,[...Q[4]||(Q[4]=[f("svg",{class:"animate-spin h-4 w-4 mr-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[f("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),f("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),S(" Subiendo... ",-1)])])):(c(),C("span",Ms,"Subir"))]),_:1},8,["disabled"])):_("",!0),p.value&&!h.value&&!e.loading?(c(),P(l(H),{key:1,type:"button",variant:"ghost",size:"sm",class:"h-8 w-8 p-0",onClick:te,title:"Cancelar"},{default:r(()=>[o(l(Ht),{class:"h-4 w-4"})]),_:1})):_("",!0)]),h.value?(c(),C("p",zs," Archivo seleccionado: "+$(h.value.name),1)):p.value?(c(),C("p",Bs," Selecciona un nuevo archivo para reemplazar el actual ")):w.value?_("",!0):(c(),C("p",Rs," Selecciona un archivo para adjuntar "))])):_("",!0)])):(c(),P(kt,{key:2,ref_key:"wrapperRef",ref:s,"display-value":y.value,"can-edit":e.canEdit,loading:e.loading,disabled:e.disabled,label:e.campo.nombre,placeholder:`Sin ${e.campo.nombre.toLowerCase()}`,"show-confirm-button":re.value,onEditStart:O,onEditCancel:L,onSave:k},{edit:r(()=>[e.campo.tipo==="select"?(c(),P(l(Vt),{key:0,"model-value":m.value||"",disabled:e.loading,"onUpdate:modelValue":ue},{default:r(()=>[o(l(Tt),{class:"h-8 w-auto min-w-[150px]"},{default:r(()=>[o(l(Pt),{placeholder:"Seleccionar..."})]),_:1}),o(l(At),null,{default:r(()=>[(c(!0),C(oe,null,pe(b.value,Z=>(c(),P(l(nt),{key:Z.value,value:Z.value},{default:r(()=>[S($(Z.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])):e.campo.tipo==="radio"?(c(),P(l(kn),{key:1,"model-value":m.value||"",disabled:e.loading,class:"flex flex-col gap-2","onUpdate:modelValue":ce},{default:r(()=>[(c(!0),C(oe,null,pe(b.value,Z=>(c(),C("div",{key:Z.value,class:"flex items-center space-x-2"},[o(l(Sn),{value:Z.value,id:`campo-${e.campo.id}-${Z.value}`},null,8,["value","id"]),o(l(Fa),{for:`campo-${e.campo.id}-${Z.value}`,class:"text-sm font-normal cursor-pointer"},{default:r(()=>[S($(Z.label),1)]),_:2},1032,["for"])]))),128))]),_:1},8,["model-value","disabled"])):e.campo.tipo==="textarea"?(c(),P(l($l),{key:2,ref_key:"inputRef",ref:d,modelValue:m.value,"onUpdate:modelValue":Q[1]||(Q[1]=Z=>m.value=Z),disabled:e.loading,rows:"3",class:"min-h-[80px] resize-y"},null,8,["modelValue","disabled"])):(c(),P(l(ut),{key:3,ref_key:"inputRef",ref:d,modelValue:m.value,"onUpdate:modelValue":Q[2]||(Q[2]=Z=>m.value=Z),type:u.value,disabled:e.loading,class:"h-8",onKeydown:T,onBlur:X},null,8,["modelValue","type","disabled"]))]),_:1},8,["display-value","can-edit","loading","disabled","label","placeholder","show-confirm-button"]))}}),cl={hito:null,estadisticas:null,actividades:[],usuariosActividades:[],usuariosEntregables:[],camposPersonalizados:[],valoresCamposPersonalizados:{},estados:[],hitosDisponibles:[],categorias:[],searchUsersEndpoint:"",canEdit:!1,canDelete:!1,canManageEntregables:!1,canComplete:!1};function Ns(e){const a=N({...cl}),n=N(!1),t=N(null),i=async()=>{var d,m;if(!e.value){s();return}n.value=!0,t.value=null;try{const g=`/api/proyectos/hitos/${e.value}/detalles`,v=await ot.get(g);a.value={hito:v.data.hito||null,estadisticas:v.data.estadisticas||null,actividades:v.data.actividades||[],usuariosActividades:v.data.usuariosActividades||[],usuariosEntregables:v.data.usuariosEntregables||[],camposPersonalizados:v.data.camposPersonalizados||[],valoresCamposPersonalizados:v.data.valoresCamposPersonalizados||{},estados:v.data.estados||[],hitosDisponibles:v.data.hitosDisponibles||[],categorias:v.data.categorias||[],searchUsersEndpoint:v.data.searchUsersEndpoint||"",canEdit:v.data.canEdit||!1,canDelete:v.data.canDelete||!1,canManageEntregables:v.data.canManageEntregables||!1,canComplete:v.data.canComplete||!1}}catch(g){console.error("Error al cargar detalles del hito:",g),t.value=((m=(d=g.response)==null?void 0:d.data)==null?void 0:m.message)||"Error al cargar detalles del hito",s()}finally{n.value=!1}},s=()=>{a.value={...cl}};return{data:a,loading:n,error:t,cargar:i,reset:s}}function Fs(e,a={}){const n=Pl(),t=N(null),i=N(null),s=async(p,h,I)=>{var w,b,u,y,k;if(!e.value)return i.value="No hay hito seleccionado",!1;t.value=p,i.value=null;try{if(h instanceof File){const L=new FormData;L.append("field",p),L.append("value",h),L.append("_method","PATCH");const T=await ot.post(`/api/proyectos/hitos/${e.value}/campo`,L);if(T.data.success)return n.success(I?`${I} actualizado`:"Campo actualizado"),(w=a.onSuccess)==null||w.call(a,p,h,T.data),!0;throw new Error(T.data.message||"Error al actualizar")}const O=await ot.patch(`/api/proyectos/hitos/${e.value}/campo`,{field:p,value:h});if(O.data.success)return n.success(I?`${I} actualizado`:"Campo actualizado"),(b=a.onSuccess)==null||b.call(a,p,h,O.data),!0;throw new Error(O.data.message||"Error al actualizar")}catch(O){const L=((y=(u=O.response)==null?void 0:u.data)==null?void 0:y.message)||O.message||"Error al actualizar el campo";return i.value=L,n.error(L),(k=a.onError)==null||k.call(a,p,O),!1}finally{t.value=null}};return{loadingField:t,error:i,updateField:s,updateResponsable:async p=>s("responsable_id",p,"Responsable"),updatePadre:async p=>s("parent_id",p,"Hito padre"),updateEtiquetas:async p=>s("etiquetas",p,"Etiquetas"),updateCampoPersonalizado:async(p,h)=>s(`campo_personalizado_${p}`,h,"Campo personalizado")}}function Us(e,a={}){const n=Pl(),t=N(null),i=N(null),s=async(h,I,w)=>{var b,u,y,k,O;if(!e.value)return i.value="No hay entregable seleccionado",!1;t.value=h,i.value=null;try{if(I instanceof File){const T=new FormData;T.append("field",h),T.append("value",I),T.append("_method","PATCH");const X=await ot.post(`/api/proyectos/entregables/${e.value}/campo`,T);if(X.data.success)return n.success(w?`${w} actualizado`:"Campo actualizado"),(b=a.onSuccess)==null||b.call(a,h,I,X.data),!0;throw new Error(X.data.message||"Error al actualizar")}const L=await ot.patch(`/api/proyectos/entregables/${e.value}/campo`,{field:h,value:I});if(L.data.success)return n.success(w?`${w} actualizado`:"Campo actualizado"),(u=a.onSuccess)==null||u.call(a,h,I,L.data),!0;throw new Error(L.data.message||"Error al actualizar")}catch(L){const T=((k=(y=L.response)==null?void 0:y.data)==null?void 0:k.message)||L.message||"Error al actualizar el campo";return i.value=T,n.error(T),(O=a.onError)==null||O.call(a,h,L),!1}finally{t.value=null}};return{loadingField:t,error:i,updateField:s,updateResponsable:async h=>s("responsable_id",h,"Responsable"),updateColaboradores:async h=>s("usuarios",h,"Colaboradores"),updateEtiquetas:async h=>s("etiquetas",h,"Etiquetas"),updateCampoPersonalizado:async(h,I)=>s(`campo_personalizado_${h}`,I,"Campo personalizado"),updateEstado:async(h,I)=>{var w,b,u,y;if(!e.value)return i.value="No hay entregable seleccionado",!1;t.value="estado",i.value=null;try{const k=await ot.patch(`/api/proyectos/entregables/${e.value}/campo`,{field:"estado",value:h,observaciones:I});if(k.data.success)return n.success("Estado actualizado"),(w=a.onSuccess)==null||w.call(a,"estado",h,k.data),!0;throw new Error(k.data.message||"Error al actualizar")}catch(k){const O=((u=(b=k.response)==null?void 0:b.data)==null?void 0:u.message)||k.message||"Error al actualizar el estado";return i.value=O,n.error(O),(y=a.onError)==null||y.call(a,"estado",k),!1}finally{t.value=null}}}}const Hs={class:"flex items-center gap-2 sm:gap-4"},qs={class:"flex-1 min-w-0"},Ls={class:"truncate"},js={class:"relative"},Ys={key:0,class:"absolute inset-0 bg-gradient-to-b from-transparent via-background/50 to-background pointer-events-none"},Gs={class:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full justify-center py-1"},Xs={class:"flex flex-wrap gap-3 sm:gap-4 mt-2 sm:mt-3 text-xs sm:text-sm text-muted-foreground"},Ws={class:"flex items-center gap-1.5"},Ks={key:0,class:"flex items-center gap-1"},Qs={key:1,class:"flex items-center gap-1"},Zs={class:"flex-1 min-h-0 overflow-hidden flex flex-col"},Js={class:"px-3 py-3 sm:px-6 sm:py-4"},ei={key:0,class:"space-y-4"},ti={class:"grid gap-4 md:grid-cols-2"},ai={class:"flex items-center gap-1.5 text-sm"},li={key:0},ni={class:"grid grid-cols-2 sm:grid-cols-4 gap-2"},oi={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-2 text-center"},si={class:"text-lg font-semibold"},ii={class:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-2 text-center"},ri={class:"text-lg font-semibold text-blue-700 dark:text-blue-400"},di={class:"bg-green-50 dark:bg-green-900/30 rounded-lg p-2 text-center"},ui={class:"text-lg font-semibold text-green-700 dark:text-green-400"},ci={class:"bg-red-50 dark:bg-red-900/30 rounded-lg p-2 text-center"},fi={class:"text-lg font-semibold text-red-700 dark:text-red-400"},mi={class:"flex items-center gap-2"},vi={class:"grid gap-4 md:grid-cols-2"},gi={class:"text-sm font-medium text-muted-foreground mb-1"},pi={class:"flex items-center gap-2"},hi={key:0},bi={class:"text-sm"},yi={key:1},xi={class:"flex items-center gap-1.5 text-sm"},wi={class:"grid gap-3 md:grid-cols-2 text-sm"},Ei={class:"flex items-center justify-between w-full gap-2"},Ci={class:"flex gap-1.5 sm:gap-2"},_i=be({__name:"HitoDetallesModal",props:{open:{type:Boolean},hitoId:{},proyectoId:{},initialTab:{default:"detalles"},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1}},emits:["update:open","update:tab","edit-hito","refresh"],setup(e,{emit:a}){const n=e,t=a,i=_t(n,"hitoId"),{data:s,loading:d,error:m,cargar:g}=Ns(i),{loadingField:v,updateField:p,updateResponsable:h,updatePadre:I,updateEtiquetas:w,updateCampoPersonalizado:b}=Fs(i,{onSuccess:async()=>{await g()}}),u=J(()=>n.canEdit||s.value.canEdit),y=N({}),k=async(j,V,W)=>{var Ve,We;await p(j,V,W)&&((We=(Ve=y.value[j])==null?void 0:Ve.closeAfterSave)==null||We.call(Ve))},O=async j=>{await h(j)},L=async j=>{const V=j?parseInt(j):null;await I(V)},T=async j=>{await w(j)},X=async(j,V)=>{await b(j,V)},ie=["detalles","comentarios","actividad"],ue=N(ie.includes(n.initialTab)?n.initialTab:"detalles"),ce=N(!1),F=N({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null});he(()=>n.open,async j=>{j&&n.hitoId&&(await g(),ue.value=ie.includes(n.initialTab)?n.initialTab:"detalles")},{immediate:!0}),he(()=>n.initialTab,j=>{n.open&&j&&ie.includes(j)&&(ue.value=j)}),he(ue,j=>{t("update:tab",j)});const R=J(()=>s.value.hito),te=J(()=>s.value.estadisticas),U=J(()=>{let j=s.value.actividades||[];return F.value.usuario_id&&(j=j.filter(V=>{var W;return((W=V.causer)==null?void 0:W.id)===F.value.usuario_id})),F.value.tipo_entidad&&(j=j.filter(V=>V.subject_type===F.value.tipo_entidad)),F.value.tipo_accion&&(j=j.filter(V=>V.event===F.value.tipo_accion)),(F.value.fecha_inicio||F.value.fecha_fin)&&(j=j.filter(V=>{const W=new Date(V.created_at);if(F.value.fecha_inicio){const K=new Date(F.value.fecha_inicio);if(W<K)return!1}if(F.value.fecha_fin){const K=new Date(F.value.fecha_fin);if(K.setHours(23,59,59,999),W>K)return!1}return!0})),j}),se=j=>({pendiente:"bg-gray-100 text-gray-800",en_progreso:"bg-blue-100 text-blue-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[j]||"bg-gray-100 text-gray-800",we=j=>j?je(Et(j),"dd MMM yyyy",{locale:Ye}):"No definida",re=j=>j?je(Et(j),"dd MMM yyyy 'a las' HH:mm",{locale:Ye}):"No definida",M=J(()=>!n.proyectoId||!n.hitoId?null:`/admin/proyectos/${n.proyectoId}/hitos/${n.hitoId}`),Q=()=>{t("update:open",!1)},Z=async()=>{await g(),t("refresh")};return(j,V)=>(c(),P(l(fa),{open:e.open,"onUpdate:open":V[11]||(V[11]=W=>t("update:open",W))},{default:r(()=>[o(l(ma),{class:"w-full sm:w-[95vw] max-w-full sm:!max-w-5xl h-[100dvh] sm:h-auto sm:max-h-[90vh] rounded-none sm:rounded-lg flex flex-col p-0 gap-0 overflow-hidden"},{default:r(()=>[o(l(va),{class:"flex-shrink-0 px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4 border-b"},{default:r(()=>[l(d)&&!R.value?(c(),C(oe,{key:0},[o(l(Ze),{class:"h-7 w-3/4 mb-2"}),o(l(Ze),{class:"h-4 w-1/2"})],64)):l(m)?(c(),C(oe,{key:1},[o(l(yt),{class:"text-destructive"},{default:r(()=>[...V[12]||(V[12]=[S("Error al cargar",-1)])]),_:1}),o(l(Ut),null,{default:r(()=>[S($(l(m)),1)]),_:1})],64)):R.value?(c(),C(oe,{key:2},[f("div",Hs,[f("div",qs,[o(l(yt),{class:"text-lg sm:text-xl flex items-center gap-2"},{default:r(()=>[o(l(Pa),{class:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),f("span",Ls,$(R.value.nombre),1)]),_:1})]),o(l(ye),{class:ae([se(R.value.estado),"flex-shrink-0 text-xs"])},{default:r(()=>[S($(R.value.estado_label||R.value.estado),1)]),_:1},8,["class"]),o(l(H),{variant:"ghost",size:"sm",class:"flex-shrink-0 h-8 w-8 p-0",onClick:Z,disabled:l(d),title:"Actualizar"},{default:r(()=>[o(l(Al),{class:ae(["h-4 w-4",{"animate-spin":l(d)}])},null,8,["class"])]),_:1},8,["disabled"])]),o(l(Ut),{class:"mt-1 text-xs sm:text-sm"},{default:r(()=>{var W;return[S(" Proyecto: "+$((W=R.value.proyecto)==null?void 0:W.nombre),1)]}),_:1}),o(l(_l),{open:ce.value,"onUpdate:open":V[0]||(V[0]=W=>ce.value=W),class:"sm:!block"},{default:r(()=>[o(l(bl),{class:"sm:hidden w-full mt-2"},{default:r(()=>[f("div",js,[ce.value?_("",!0):(c(),C("div",Ys)),f("button",Gs,[f("span",null,$(ce.value?"Ocultar detalles":"Ver detalles"),1),o(l(Na),{class:ae(["h-3 w-3 transition-transform duration-200",{"rotate-180":ce.value}])},null,8,["class"])])])]),_:1}),o(l(kl),{class:"sm:!block"},{default:r(()=>{var W;return[f("div",Xs,[f("div",Ws,[o(l(na),{"model-value":R.value.porcentaje_completado,class:"w-16 sm:w-20 h-2"},null,8,["model-value"]),f("span",null,$(R.value.porcentaje_completado)+"%",1)]),R.value.fecha_fin?(c(),C("div",Ks,[o(l(Me),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),f("span",{class:ae({"text-red-600":(W=te.value)==null?void 0:W.esta_vencido})},$(we(R.value.fecha_fin)),3)])):_("",!0),R.value.responsable?(c(),C("div",Qs,[o(l(st),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),f("span",null,$(R.value.responsable.name),1)])):_("",!0)])]}),_:1})]),_:1},8,["open"])],64)):_("",!0)]),_:1}),f("div",Zs,[o(l(Ua),{modelValue:ue.value,"onUpdate:modelValue":V[10]||(V[10]=W=>ue.value=W),class:"flex-1 min-h-0 flex flex-col"},{default:r(()=>[o(l(Ha),{class:"flex-shrink-0 mx-4 sm:mx-6 mt-3 sm:mt-4 justify-start"},{default:r(()=>{var W;return[o(l(He),{value:"detalles",label:"Detalles",icon:l(it)},{default:r(()=>[o(l(it),{class:"h-4 w-4 mr-1.5"}),V[13]||(V[13]=S(" Detalles ",-1))]),_:1},8,["icon"]),o(l(He),{value:"comentarios",label:"Comentarios",icon:l(ft),badge:(W=R.value)==null?void 0:W.total_comentarios},{default:r(()=>{var K;return[o(l(ft),{class:"h-4 w-4 mr-1.5"}),V[14]||(V[14]=S(" Comentarios ",-1)),(K=R.value)!=null&&K.total_comentarios?(c(),P(l(ye),{key:0,variant:"secondary",class:"ml-1.5 h-5 px-1.5 text-xs"},{default:r(()=>[S($(R.value.total_comentarios),1)]),_:1})):_("",!0)]}),_:1},8,["icon","badge"]),o(l(He),{value:"actividad",label:"Actividad",icon:l(mt)},{default:r(()=>[o(l(mt),{class:"h-4 w-4 mr-1.5"}),V[15]||(V[15]=S(" Actividad ",-1))]),_:1},8,["icon"])]}),_:1}),o(l(Ft),{class:"flex-1 min-h-0 overflow-y-auto"},{default:r(()=>[f("div",Js,[l(d)&&!R.value?(c(),C("div",ei,[o(l(Ze),{class:"h-32 w-full"}),o(l(Ze),{class:"h-32 w-full"})])):_("",!0),o(l(qe),{value:"detalles",class:"mt-0 space-y-4"},{default:r(()=>[R.value?(c(),C(oe,{key:0},[o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[o(l(Oe),{class:"text-base"},{default:r(()=>[...V[16]||(V[16]=[S("Información General",-1)])]),_:1})]),_:1}),o(l(Se),{class:"space-y-4"},{default:r(()=>{var W;return[f("div",null,[V[17]||(V[17]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Nombre",-1)),o(l(Kl),{ref:K=>y.value.nombre=K,"model-value":R.value.nombre,"can-edit":u.value,loading:l(v)==="nombre",label:"nombre",placeholder:"Sin nombre",required:"",onSave:V[1]||(V[1]=K=>k("nombre",K,"Nombre"))},null,8,["model-value","can-edit","loading"])]),f("div",null,[V[18]||(V[18]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Descripción",-1)),o(l(Ra),{ref:K=>y.value.descripcion=K,"model-value":R.value.descripcion,"can-edit":u.value,loading:l(v)==="descripcion",label:"descripción",placeholder:"Sin descripción",onSave:V[2]||(V[2]=K=>k("descripcion",K,"Descripción"))},null,8,["model-value","can-edit","loading"])]),f("div",null,[V[19]||(V[19]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Estado",-1)),o(l(ca),{ref:K=>y.value.estado=K,"model-value":R.value.estado,options:l(s).estados||[],"can-edit":u.value,loading:l(v)==="estado",label:"estado","show-badge":"",onSave:V[3]||(V[3]=K=>k("estado",K,"Estado"))},null,8,["model-value","options","can-edit","loading"])]),f("div",ti,[f("div",null,[V[20]||(V[20]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Fecha de Inicio",-1)),f("div",ai,[o(l(ct),{class:"h-4 w-4 flex-shrink-0"}),o(l(ua),{ref:K=>y.value.fecha_inicio=K,"model-value":R.value.fecha_inicio,"can-edit":u.value,loading:l(v)==="fecha_inicio",label:"fecha de inicio",onSave:V[4]||(V[4]=K=>k("fecha_inicio",K,"Fecha de inicio"))},null,8,["model-value","can-edit","loading"])])]),f("div",null,[V[21]||(V[21]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Fecha de Fin",-1)),f("div",{class:ae(["flex items-center gap-1.5 text-sm",{"text-red-600":(W=te.value)==null?void 0:W.esta_vencido}])},[o(l(ct),{class:"h-4 w-4 flex-shrink-0"}),o(l(ua),{ref:K=>y.value.fecha_fin=K,"model-value":R.value.fecha_fin,"can-edit":u.value,loading:l(v)==="fecha_fin",label:"fecha de fin","min-date":R.value.fecha_inicio,onSave:V[5]||(V[5]=K=>k("fecha_fin",K,"Fecha de fin"))},null,8,["model-value","can-edit","loading","min-date"])],2)])]),f("div",null,[V[22]||(V[22]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Responsable",-1)),o(l(Zl),{"model-value":R.value.responsable,"can-edit":u.value,loading:l(v)==="responsable_id",label:"responsable","search-endpoint":l(s).searchUsersEndpoint||"/admin/proyectos/search-users","modal-title":"Seleccionar Responsable","modal-description":"Busca y selecciona el responsable del hito",onSave:V[6]||(V[6]=K=>O(K))},null,8,["model-value","can-edit","loading","search-endpoint"])]),te.value?(c(),C("div",li,[V[27]||(V[27]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Resumen de Entregables",-1)),f("div",ni,[f("div",oi,[f("div",si,$(te.value.entregables_pendientes),1),V[23]||(V[23]=f("div",{class:"text-xs text-muted-foreground"},"Pendientes",-1))]),f("div",ii,[f("div",ri,$(te.value.entregables_en_progreso),1),V[24]||(V[24]=f("div",{class:"text-xs text-muted-foreground"},"En Progreso",-1))]),f("div",di,[f("div",ui,$(te.value.entregables_completados),1),V[25]||(V[25]=f("div",{class:"text-xs text-muted-foreground"},"Completados",-1))]),f("div",ci,[f("div",fi,$(te.value.entregables_cancelados),1),V[26]||(V[26]=f("div",{class:"text-xs text-muted-foreground"},"Cancelados",-1))])])])):_("",!0)]}),_:1})]),_:1}),o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[f("div",mi,[o(l(qa),{class:"h-4 w-4"}),o(l(Oe),{class:"text-base"},{default:r(()=>[...V[28]||(V[28]=[S("Etiquetas",-1)])]),_:1})])]),_:1}),o(l(Se),null,{default:r(()=>{var W;return[o(l(Jl),{"model-value":((W=R.value.etiquetas)==null?void 0:W.map(K=>K.id))||[],etiquetas:R.value.etiquetas||[],categorias:l(s).categorias||[],"can-edit":u.value,loading:l(v)==="etiquetas",label:"etiquetas",onSave:T},null,8,["model-value","etiquetas","categorias","can-edit","loading"])]}),_:1})]),_:1}),l(s).camposPersonalizados&&l(s).camposPersonalizados.length>0?(c(),P(l(ke),{key:0},{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[o(l(Oe),{class:"text-base"},{default:r(()=>[...V[29]||(V[29]=[S("Campos Personalizados",-1)])]),_:1}),o(l(Ta),null,{default:r(()=>[...V[30]||(V[30]=[S("Información adicional del hito",-1)])]),_:1})]),_:1}),o(l(Se),null,{default:r(()=>[f("div",vi,[(c(!0),C(oe,null,pe(l(s).camposPersonalizados,W=>(c(),C("div",{key:W.id},[f("h4",gi,$(W.nombre),1),o(l(en),{campo:W,"model-value":l(s).valoresCamposPersonalizados[W.id],"can-edit":u.value,loading:l(v)===`campo_personalizado_${W.id}`,onSave:V[7]||(V[7]=(K,Ve)=>X(K,Ve))},null,8,["campo","model-value","can-edit","loading"])]))),128))])]),_:1})]),_:1})):_("",!0),o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[f("div",pi,[o(l(In),{class:"h-4 w-4"}),o(l(Oe),{class:"text-base"},{default:r(()=>[...V[31]||(V[31]=[S("Jerarquía y Orden",-1)])]),_:1})])]),_:1}),o(l(Se),{class:"space-y-4"},{default:r(()=>{var W;return[f("div",null,[V[32]||(V[32]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Hito Padre",-1)),o(l(ca),{ref:K=>y.value.parent_id=K,"model-value":((W=R.value.parent_id)==null?void 0:W.toString())||"",options:[{value:"",label:"(Sin padre - Nivel raíz)"},...l(s).hitosDisponibles||[]],"can-edit":u.value,loading:l(v)==="parent_id",label:"hito padre",placeholder:"Sin hito padre",onSave:L},null,8,["model-value","options","can-edit","loading"])]),R.value.ruta_completa?(c(),C("div",hi,[V[33]||(V[33]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Ruta Completa",-1)),f("p",bi,$(R.value.ruta_completa),1)])):_("",!0),R.value.nivel!==void 0?(c(),C("div",yi,[V[34]||(V[34]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Nivel",-1)),o(l(ye),{variant:"outline"},{default:r(()=>[S("Nivel "+$(R.value.nivel),1)]),_:1})])):_("",!0),f("div",null,[V[35]||(V[35]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Orden de Visualización",-1)),f("div",xi,[o(l(Ol),{class:"h-4 w-4 flex-shrink-0"}),o(l(Ql),{ref:K=>y.value.orden=K,"model-value":R.value.orden,"can-edit":u.value,loading:l(v)==="orden",label:"orden",placeholder:"1",min:1,onSave:V[8]||(V[8]=K=>k("orden",K,"Orden"))},null,8,["model-value","can-edit","loading"])])])]}),_:1})]),_:1}),o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[o(l(Oe),{class:"text-base"},{default:r(()=>[...V[36]||(V[36]=[S("Información del Sistema",-1)])]),_:1})]),_:1}),o(l(Se),null,{default:r(()=>[f("div",wi,[f("div",null,[V[37]||(V[37]=f("span",{class:"text-muted-foreground"},"Creado: ",-1)),S(" "+$(re(R.value.created_at)),1)]),f("div",null,[V[38]||(V[38]=f("span",{class:"text-muted-foreground"},"Actualizado: ",-1)),S(" "+$(re(R.value.updated_at)),1)])])]),_:1})]),_:1})],64)):_("",!0)]),_:1}),o(l(qe),{value:"comentarios",class:"mt-0"},{default:r(()=>[e.hitoId?(c(),P(Sl,{key:0,"commentable-type":"hitos","commentable-id":e.hitoId,"can-create":e.canEdit||l(s).canEdit,embedded:""},null,8,["commentable-id","can-create"])):_("",!0)]),_:1}),o(l(qe),{value:"actividad",class:"mt-0 space-y-4"},{default:r(()=>[l(s).actividades&&l(s).actividades.length>0?(c(),P(wl,{key:0,modelValue:F.value,"onUpdate:modelValue":V[9]||(V[9]=W=>F.value=W),usuarios:l(s).usuariosActividades,"context-level":"hito"},null,8,["modelValue","usuarios"])):_("",!0),o(El,{activities:U.value,title:"Historial de Actividad",description:"Registro de cambios del hito y sus entregables","empty-message":"No hay actividad registrada","show-card":!1},null,8,["activities"])]),_:1})])]),_:1})]),_:1},8,["modelValue"])]),o(l(ga),{class:"flex-shrink-0 px-3 py-3 sm:px-6 sm:py-4 border-t bg-muted/30"},{default:r(()=>[f("div",Ei,[f("div",Ci,[M.value?(c(),P(l(vl),{key:0,href:M.value},{default:r(()=>[o(l(H),{variant:"outline",size:"sm",class:"text-xs sm:text-sm px-2 sm:px-3"},{default:r(()=>[o(l(Ml),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-1.5"}),V[39]||(V[39]=f("span",{class:"hidden sm:inline"},"Abrir página completa",-1))]),_:1})]),_:1},8,["href"])):_("",!0)]),o(l(H),{variant:"ghost",size:"sm",class:"text-xs sm:text-sm",onClick:Q},{default:r(()=>[...V[40]||(V[40]=[S(" Cerrar ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1},8,["open"]))}}),fl={entregable:null,proyecto:null,hito:null,usuariosAsignados:[],actividades:[],usuariosActividades:[],camposPersonalizados:[],valoresCamposPersonalizados:{},contratosRelacionados:[],estados:[],prioridades:[],categorias:[],searchUsersEndpoint:"",canEdit:!1,canDelete:!1,canComplete:!1};function ki(e){const a=N({...fl}),n=N(!1),t=N(null),i=async()=>{var d,m;if(!e.value){s();return}n.value=!0,t.value=null;try{const g=`/api/proyectos/entregables/${e.value}/detalles`,v=await ot.get(g);a.value={entregable:v.data.entregable||null,proyecto:v.data.proyecto||null,hito:v.data.hito||null,usuariosAsignados:v.data.usuariosAsignados||[],actividades:v.data.actividades||[],usuariosActividades:v.data.usuariosActividades||[],camposPersonalizados:v.data.camposPersonalizados||[],valoresCamposPersonalizados:v.data.valoresCamposPersonalizados||{},contratosRelacionados:v.data.contratosRelacionados||[],estados:v.data.estados||[],prioridades:v.data.prioridades||[],categorias:v.data.categorias||[],searchUsersEndpoint:v.data.searchUsersEndpoint||"",canEdit:v.data.canEdit||!1,canDelete:v.data.canDelete||!1,canComplete:v.data.canComplete||!1}}catch(g){console.error("Error al cargar detalles del entregable:",g),t.value=((m=(d=g.response)==null?void 0:d.data)==null?void 0:m.message)||"Error al cargar detalles del entregable",s()}finally{n.value=!1}},s=()=>{a.value={...fl}};return{data:a,loading:n,error:t,cargar:i,reset:s}}const Si={class:"flex items-center gap-2 sm:gap-4"},$i={class:"flex-1 min-w-0"},Di={class:"truncate"},Ii={class:"relative"},Vi={key:0,class:"absolute inset-0 bg-gradient-to-b from-transparent via-background/50 to-background pointer-events-none"},Ti={class:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full justify-center py-1"},Pi={class:"flex flex-wrap gap-3 sm:gap-4 mt-2 sm:mt-3 text-xs sm:text-sm text-muted-foreground"},Ai={class:"flex items-center gap-1.5"},Oi={class:"capitalize"},Mi={class:"flex items-center gap-1.5"},zi={key:1,class:"flex items-center gap-1"},Bi={class:"flex-1 min-h-0 overflow-hidden flex flex-col"},Ri={class:"px-3 py-3 sm:px-6 sm:py-4"},Ni={key:0,class:"space-y-4"},Fi={class:"grid gap-4 md:grid-cols-2"},Ui={class:"grid gap-4 md:grid-cols-2"},Hi={class:"flex items-center gap-1.5 text-sm"},qi={class:"flex items-center gap-1.5 text-sm"},Li={key:0,class:"bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg p-3"},ji={class:"flex items-center gap-2 text-green-700 dark:text-green-400 mb-2"},Yi={class:"text-sm text-green-600 dark:text-green-500 space-y-1"},Gi={key:0},Xi={key:1},Wi={key:2,class:"italic mt-2"},Ki={class:"flex items-center gap-2"},Qi={class:"grid gap-4 md:grid-cols-2"},Zi={class:"text-sm font-medium text-muted-foreground mb-1"},Ji={class:"grid gap-3 md:grid-cols-2 text-sm"},er={class:"flex items-center justify-between"},tr={key:0,class:"space-y-2"},ar={class:"flex items-center gap-3"},lr={class:"font-medium text-sm"},nr={class:"text-xs text-muted-foreground"},or={key:1,class:"text-center py-4"},sr={class:"flex items-center justify-between w-full gap-2"},ir={class:"flex gap-1.5 sm:gap-2"},rr=be({__name:"EntregableDetallesModal",props:{open:{type:Boolean},entregableId:{},proyectoId:{},hitoId:{},initialTab:{default:"detalles"},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1}},emits:["update:open","update:tab","edit-entregable","refresh"],setup(e,{emit:a}){const n=e,t=a,i=_t(n,"entregableId"),{data:s,loading:d,error:m,cargar:g}=ki(i),{loadingField:v,updateField:p,updateResponsable:h,updateColaboradores:I,updateEtiquetas:w,updateCampoPersonalizado:b}=Us(i,{onSuccess:async()=>{await g()}}),u=J(()=>n.canEdit||s.value.canEdit),y=N({}),k=N(!1),O=async(z,x,D)=>{var ze,Ne;await p(z,x,D)&&((Ne=(ze=y.value[z])==null?void 0:ze.closeAfterSave)==null||Ne.call(ze))},L=async z=>{await h(z)},T=async z=>{await w(z)},X=async(z,x)=>{await b(z,x)},ie=async z=>{const x=z.userIds.map(D=>{var A;return{user_id:D,rol:((A=z.extraData)==null?void 0:A[`${D}_rol`])||"colaborador"}});await I(x),k.value=!1},ue=["detalles","equipo","evidencias","comentarios","actividad"],ce=N(ue.includes(n.initialTab)?n.initialTab:"detalles"),F=N(!1),R=N({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),te=N({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null});he(()=>n.open,async z=>{z&&n.entregableId&&(await g(),ce.value=ue.includes(n.initialTab)?n.initialTab:"detalles")},{immediate:!0}),he(()=>n.initialTab,z=>{n.open&&z&&ue.includes(z)&&(ce.value=z)}),he(ce,z=>{t("update:tab",z)});const U=J(()=>s.value.entregable),se=J(()=>s.value.proyecto),we=J(()=>s.value.hito),re=J(()=>{var z;return(z=U.value)!=null&&z.fecha_fin?Pn(new Date(U.value.fecha_fin),new Date):null}),M=J(()=>!U.value||U.value.estado==="completado"||U.value.estado==="cancelado"?!1:re.value!==null&&re.value<0),Q=J(()=>{var x;let z=((x=U.value)==null?void 0:x.evidencias)||[];return R.value.contrato_id&&(z=z.filter(D=>{var A;return((A=D.obligacion)==null?void 0:A.contrato_id)===R.value.contrato_id})),R.value.tipo&&(z=z.filter(D=>D.tipo_evidencia===R.value.tipo)),R.value.estado&&(z=z.filter(D=>D.estado===R.value.estado)),R.value.usuario_id&&(z=z.filter(D=>{var A;return((A=D.usuario)==null?void 0:A.id)===R.value.usuario_id})),z}),Z=J(()=>{const z={};return Q.value.forEach(x=>{var D;if((D=x.obligacion)!=null&&D.contrato){const A=x.obligacion.contrato.id;z[A]||(z[A]={contrato:x.obligacion.contrato,evidencias:[]}),z[A].evidencias.push({...x,obligacion_titulo:x.obligacion.titulo})}}),Object.values(z)}),j=J(()=>{let z=s.value.actividades||[];return te.value.usuario_id&&(z=z.filter(x=>{var D;return((D=x.causer)==null?void 0:D.id)===te.value.usuario_id})),te.value.tipo_accion&&(z=z.filter(x=>x.event===te.value.tipo_accion)),(te.value.fecha_inicio||te.value.fecha_fin)&&(z=z.filter(x=>{const D=new Date(x.created_at);if(te.value.fecha_inicio){const A=new Date(te.value.fecha_inicio);if(D<A)return!1}if(te.value.fecha_fin){const A=new Date(te.value.fecha_fin);if(A.setHours(23,59,59,999),D>A)return!1}return!0})),z}),V=z=>({pendiente:"bg-gray-100 text-gray-800",en_progreso:"bg-blue-100 text-blue-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[z]||"bg-gray-100 text-gray-800",W=z=>({baja:"text-gray-500",media:"text-yellow-500",alta:"text-red-500"})[z]||"",K=z=>z?je(Et(z),"dd MMM yyyy",{locale:Ye}):"No definida",Ve=z=>z?je(Et(z),"dd MMM yyyy 'a las' HH:mm",{locale:Ye}):"No definida",We=J(()=>{var D,A;const z=n.proyectoId||((D=se.value)==null?void 0:D.id),x=n.hitoId||((A=we.value)==null?void 0:A.id);return!z||!x||!n.entregableId?null:`/admin/proyectos/${z}/hitos/${x}/entregables/${n.entregableId}`}),q=()=>{t("update:open",!1)},E=async()=>{await g(),t("refresh")};return(z,x)=>(c(),P(l(fa),{open:e.open,"onUpdate:open":x[17]||(x[17]=D=>t("update:open",D))},{default:r(()=>[o(l(ma),{class:"w-full sm:w-[95vw] max-w-full sm:!max-w-5xl h-[100dvh] sm:h-auto sm:max-h-[90vh] rounded-none sm:rounded-lg flex flex-col p-0 gap-0 overflow-hidden"},{default:r(()=>[o(l(va),{class:"flex-shrink-0 px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4 border-b"},{default:r(()=>[l(d)&&!U.value?(c(),C(oe,{key:0},[o(l(Ze),{class:"h-7 w-3/4 mb-2"}),o(l(Ze),{class:"h-4 w-1/2"})],64)):l(m)?(c(),C(oe,{key:1},[o(l(yt),{class:"text-destructive"},{default:r(()=>[...x[18]||(x[18]=[S("Error al cargar",-1)])]),_:1}),o(l(Ut),null,{default:r(()=>[S($(l(m)),1)]),_:1})],64)):U.value?(c(),C(oe,{key:2},[f("div",Si,[f("div",$i,[o(l(yt),{class:"text-lg sm:text-xl flex items-center gap-2"},{default:r(()=>[o(l(it),{class:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),f("span",Di,$(U.value.nombre),1)]),_:1})]),o(l(ye),{class:ae([V(U.value.estado),"flex-shrink-0 text-xs"])},{default:r(()=>[S($(U.value.estado_label||U.value.estado),1)]),_:1},8,["class"]),o(l(H),{variant:"ghost",size:"sm",class:"flex-shrink-0 h-8 w-8 p-0",onClick:E,disabled:l(d),title:"Actualizar"},{default:r(()=>[o(l(Al),{class:ae(["h-4 w-4",{"animate-spin":l(d)}])},null,8,["class"])]),_:1},8,["disabled"])]),o(l(Ut),{class:"mt-1 text-xs sm:text-sm"},{default:r(()=>{var D,A;return[S(" Hito: "+$((D=we.value)==null?void 0:D.nombre)+" · Proyecto: "+$((A=se.value)==null?void 0:A.nombre),1)]}),_:1}),o(l(_l),{open:F.value,"onUpdate:open":x[0]||(x[0]=D=>F.value=D),class:"sm:!block"},{default:r(()=>[o(l(bl),{class:"sm:hidden w-full mt-2"},{default:r(()=>[f("div",Ii,[F.value?_("",!0):(c(),C("div",Vi)),f("button",Ti,[f("span",null,$(F.value?"Ocultar detalles":"Ver detalles"),1),o(l(Na),{class:ae(["h-3 w-3 transition-transform duration-200",{"rotate-180":F.value}])},null,8,["class"])])])]),_:1}),o(l(kl),{class:"sm:!block"},{default:r(()=>[f("div",Pi,[f("div",Ai,[o(l(xl),{class:ae(["h-3.5 w-3.5 sm:h-4 sm:w-4",W(U.value.prioridad)])},null,8,["class"]),f("span",Oi,$(U.value.prioridad),1)]),f("div",Mi,[o(l(na),{"model-value":U.value.porcentaje_completado||0,class:"w-14 sm:w-16 h-2"},null,8,["model-value"]),f("span",null,$(U.value.porcentaje_completado||0)+"%",1)]),re.value!==null?(c(),C("div",{key:0,class:ae(["flex items-center gap-1",{"text-red-600":M.value}])},[o(l(Me),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),f("span",null,$(M.value?`Vencido hace ${Math.abs(re.value)} días`:re.value===0?"Vence hoy":`${re.value} días`),1)],2)):_("",!0),U.value.responsable?(c(),C("div",zi,[o(l(st),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),f("span",null,$(U.value.responsable.name),1)])):_("",!0)])]),_:1})]),_:1},8,["open"])],64)):_("",!0)]),_:1}),f("div",Bi,[o(l(Ua),{modelValue:ce.value,"onUpdate:modelValue":x[16]||(x[16]=D=>ce.value=D),class:"flex-1 min-h-0 flex flex-col"},{default:r(()=>[o(l(Ha),{class:"flex-shrink-0 mx-4 sm:mx-6 mt-3 sm:mt-4 justify-start"},{default:r(()=>{var D,A,ze;return[o(l(He),{value:"detalles",label:"Detalles",icon:l(it)},{default:r(()=>[o(l(it),{class:"h-4 w-4 mr-1.5"}),x[19]||(x[19]=S(" Detalles ",-1))]),_:1},8,["icon"]),o(l(He),{value:"equipo",label:"Equipo",icon:l(Qt)},{default:r(()=>[o(l(Qt),{class:"h-4 w-4 mr-1.5"}),x[20]||(x[20]=S(" Equipo ",-1))]),_:1},8,["icon"]),o(l(He),{value:"evidencias",label:"Evidencias",icon:l(ba),badge:(A=(D=U.value)==null?void 0:D.evidencias)==null?void 0:A.length},{default:r(()=>{var Ne,Wa;return[o(l(ba),{class:"h-4 w-4 mr-1.5"}),x[21]||(x[21]=S(" Evidencias ",-1)),(Wa=(Ne=U.value)==null?void 0:Ne.evidencias)!=null&&Wa.length?(c(),P(l(ye),{key:0,variant:"secondary",class:"ml-1.5 h-5 px-1.5 text-xs"},{default:r(()=>[S($(U.value.evidencias.length),1)]),_:1})):_("",!0)]}),_:1},8,["icon","badge"]),o(l(He),{value:"comentarios",label:"Comentarios",icon:l(ft),badge:(ze=U.value)==null?void 0:ze.total_comentarios},{default:r(()=>{var Ne;return[o(l(ft),{class:"h-4 w-4 mr-1.5"}),x[22]||(x[22]=S(" Comentarios ",-1)),(Ne=U.value)!=null&&Ne.total_comentarios?(c(),P(l(ye),{key:0,variant:"secondary",class:"ml-1.5 h-5 px-1.5 text-xs"},{default:r(()=>[S($(U.value.total_comentarios),1)]),_:1})):_("",!0)]}),_:1},8,["icon","badge"]),o(l(He),{value:"actividad",label:"Actividad",icon:l(mt)},{default:r(()=>[o(l(mt),{class:"h-4 w-4 mr-1.5"}),x[23]||(x[23]=S(" Actividad ",-1))]),_:1},8,["icon"])]}),_:1}),o(l(Ft),{class:"flex-1 min-h-0 overflow-y-auto"},{default:r(()=>{var D;return[f("div",Ri,[l(d)&&!U.value?(c(),C("div",Ni,[o(l(Ze),{class:"h-32 w-full"}),o(l(Ze),{class:"h-32 w-full"})])):_("",!0),o(l(qe),{value:"detalles",class:"mt-0 space-y-4"},{default:r(()=>[U.value?(c(),C(oe,{key:0},[o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[o(l(Oe),{class:"text-base"},{default:r(()=>[...x[24]||(x[24]=[S("Información General",-1)])]),_:1})]),_:1}),o(l(Se),{class:"space-y-4"},{default:r(()=>[f("div",null,[x[25]||(x[25]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Nombre",-1)),o(l(Kl),{ref:A=>y.value.nombre=A,"model-value":U.value.nombre,"can-edit":u.value,loading:l(v)==="nombre",label:"nombre",placeholder:"Sin nombre",required:"",onSave:x[1]||(x[1]=A=>O("nombre",A,"Nombre"))},null,8,["model-value","can-edit","loading"])]),f("div",null,[x[26]||(x[26]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Descripción",-1)),o(l(Ra),{ref:A=>y.value.descripcion=A,"model-value":U.value.descripcion,"can-edit":u.value,loading:l(v)==="descripcion",label:"descripción",placeholder:"Sin descripción",onSave:x[2]||(x[2]=A=>O("descripcion",A,"Descripción"))},null,8,["model-value","can-edit","loading"])]),f("div",Fi,[f("div",null,[x[27]||(x[27]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Estado",-1)),o(l(ca),{ref:A=>y.value.estado=A,"model-value":U.value.estado,options:l(s).estados||[],"can-edit":u.value,loading:l(v)==="estado",label:"estado","show-badge":"",onSave:x[3]||(x[3]=A=>O("estado",A,"Estado"))},null,8,["model-value","options","can-edit","loading"])]),f("div",null,[x[28]||(x[28]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Prioridad",-1)),o(l(ca),{ref:A=>y.value.prioridad=A,"model-value":U.value.prioridad,options:l(s).prioridades||[],"can-edit":u.value,loading:l(v)==="prioridad",label:"prioridad","show-badge":"",onSave:x[4]||(x[4]=A=>O("prioridad",A,"Prioridad"))},null,8,["model-value","options","can-edit","loading"])])]),f("div",Ui,[f("div",null,[x[29]||(x[29]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Fecha de Inicio",-1)),f("div",Hi,[o(l(ct),{class:"h-4 w-4 flex-shrink-0"}),o(l(ua),{ref:A=>y.value.fecha_inicio=A,"model-value":U.value.fecha_inicio,"can-edit":u.value,loading:l(v)==="fecha_inicio",label:"fecha de inicio",onSave:x[5]||(x[5]=A=>O("fecha_inicio",A,"Fecha de inicio"))},null,8,["model-value","can-edit","loading"])])]),f("div",null,[x[30]||(x[30]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Fecha de Fin",-1)),f("div",{class:ae(["flex items-center gap-1.5 text-sm",{"text-red-600":M.value}])},[o(l(ct),{class:"h-4 w-4 flex-shrink-0"}),o(l(ua),{ref:A=>y.value.fecha_fin=A,"model-value":U.value.fecha_fin,"can-edit":u.value,loading:l(v)==="fecha_fin",label:"fecha de fin","min-date":U.value.fecha_inicio,onSave:x[6]||(x[6]=A=>O("fecha_fin",A,"Fecha de fin"))},null,8,["model-value","can-edit","loading","min-date"])],2)])]),f("div",null,[x[31]||(x[31]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Notas",-1)),o(l(Ra),{ref:A=>y.value.notas=A,"model-value":U.value.notas,"can-edit":u.value,loading:l(v)==="notas",label:"notas",placeholder:"Sin notas adicionales",onSave:x[7]||(x[7]=A=>O("notas",A,"Notas"))},null,8,["model-value","can-edit","loading"])]),f("div",null,[x[32]||(x[32]=f("h4",{class:"text-sm font-medium text-muted-foreground mb-1"},"Orden de Visualización",-1)),f("div",qi,[o(l(Ol),{class:"h-4 w-4 flex-shrink-0"}),o(l(Ql),{ref:A=>y.value.orden=A,"model-value":U.value.orden,"can-edit":u.value,loading:l(v)==="orden",label:"orden",placeholder:"1",min:1,onSave:x[8]||(x[8]=A=>O("orden",A,"Orden"))},null,8,["model-value","can-edit","loading"])])]),U.value.estado==="completado"?(c(),C("div",Li,[f("div",ji,[o(l(et),{class:"h-5 w-5"}),x[33]||(x[33]=f("span",{class:"font-medium"},"Completado",-1))]),f("div",Yi,[U.value.completado_at?(c(),C("div",Gi," Fecha: "+$(Ve(U.value.completado_at)),1)):_("",!0),U.value.completado_por_usuario?(c(),C("div",Xi," Por: "+$(U.value.completado_por_usuario.name),1)):_("",!0),U.value.observaciones_estado?(c(),C("div",Wi,' "'+$(U.value.observaciones_estado)+'" ',1)):_("",!0)])])):_("",!0)]),_:1})]),_:1}),o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[f("div",Ki,[o(l(qa),{class:"h-4 w-4"}),o(l(Oe),{class:"text-base"},{default:r(()=>[...x[34]||(x[34]=[S("Etiquetas",-1)])]),_:1})])]),_:1}),o(l(Se),null,{default:r(()=>{var A;return[o(l(Jl),{"model-value":((A=U.value.etiquetas)==null?void 0:A.map(ze=>ze.id))||[],etiquetas:U.value.etiquetas||[],categorias:l(s).categorias||[],"can-edit":u.value,loading:l(v)==="etiquetas",label:"etiquetas",onSave:T},null,8,["model-value","etiquetas","categorias","can-edit","loading"])]}),_:1})]),_:1}),l(s).camposPersonalizados&&l(s).camposPersonalizados.length>0?(c(),P(l(ke),{key:0},{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[o(l(Oe),{class:"text-base"},{default:r(()=>[...x[35]||(x[35]=[S("Campos Personalizados",-1)])]),_:1}),o(l(Ta),null,{default:r(()=>[...x[36]||(x[36]=[S("Información adicional del entregable",-1)])]),_:1})]),_:1}),o(l(Se),null,{default:r(()=>[f("div",Qi,[(c(!0),C(oe,null,pe(l(s).camposPersonalizados,A=>(c(),C("div",{key:A.id},[f("h4",Zi,$(A.nombre),1),o(l(en),{campo:A,"model-value":l(s).valoresCamposPersonalizados[A.id],"can-edit":u.value,loading:l(v)===`campo_personalizado_${A.id}`,onSave:x[9]||(x[9]=(ze,Ne)=>X(ze,Ne))},null,8,["campo","model-value","can-edit","loading"])]))),128))])]),_:1})]),_:1})):_("",!0),o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[o(l(Oe),{class:"text-base"},{default:r(()=>[...x[37]||(x[37]=[S("Información del Sistema",-1)])]),_:1})]),_:1}),o(l(Se),null,{default:r(()=>[f("div",Ji,[f("div",null,[x[38]||(x[38]=f("span",{class:"text-muted-foreground"},"Creado: ",-1)),S(" "+$(Ve(U.value.created_at)),1)]),f("div",null,[x[39]||(x[39]=f("span",{class:"text-muted-foreground"},"Actualizado: ",-1)),S(" "+$(Ve(U.value.updated_at)),1)]),f("div",null,[x[40]||(x[40]=f("span",{class:"text-muted-foreground"},"Orden: ",-1)),S(" "+$(U.value.orden),1)])])]),_:1})]),_:1})],64)):_("",!0)]),_:1}),o(l(qe),{value:"equipo",class:"mt-0 space-y-4"},{default:r(()=>[U.value?(c(),C(oe,{key:0},[o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[o(l(Oe),{class:"text-base"},{default:r(()=>[...x[41]||(x[41]=[S("Responsable Principal",-1)])]),_:1})]),_:1}),o(l(Se),null,{default:r(()=>[o(l(Zl),{"model-value":U.value.responsable,"can-edit":u.value,loading:l(v)==="responsable_id",label:"responsable","search-endpoint":l(s).searchUsersEndpoint||"/admin/proyectos/search-users","modal-title":"Seleccionar Responsable Principal","modal-description":"Busca y selecciona el responsable principal del entregable",onSave:x[10]||(x[10]=A=>L(A))},null,8,["model-value","can-edit","loading","search-endpoint"])]),_:1})]),_:1}),o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[f("div",er,[f("div",null,[o(l(Oe),{class:"text-base"},{default:r(()=>[...x[42]||(x[42]=[S("Colaboradores",-1)])]),_:1}),o(l(Ta),null,{default:r(()=>{var A;return[S($(((A=l(s).usuariosAsignados)==null?void 0:A.length)||0)+" usuarios asignados",1)]}),_:1})]),u.value?(c(),P(l(H),{key:0,variant:"outline",size:"sm",onClick:x[11]||(x[11]=A=>k.value=!0)},{default:r(()=>[o(l(pa),{class:"h-4 w-4 mr-1.5"}),x[43]||(x[43]=S(" Editar ",-1))]),_:1})):_("",!0)])]),_:1}),o(l(Se),null,{default:r(()=>[l(s).usuariosAsignados&&l(s).usuariosAsignados.length>0?(c(),C("div",tr,[(c(!0),C(oe,null,pe(l(s).usuariosAsignados,A=>(c(),C("div",{key:A.user_id,class:"flex items-center justify-between p-3 bg-muted rounded-lg"},[f("div",ar,[o(l(Dl),{class:"h-8 w-8"},{default:r(()=>[A.user.avatar?(c(),P(l(Il),{key:0,src:A.user.avatar},null,8,["src"])):_("",!0),o(l(Vl),null,{default:r(()=>[S($(A.user.name.substring(0,2).toUpperCase()),1)]),_:2},1024)]),_:2},1024),f("div",null,[f("p",lr,$(A.user.name),1),f("p",nr,$(A.user.email),1)])]),o(l(ye),{variant:"outline",class:"capitalize"},{default:r(()=>[S($(A.rol),1)]),_:2},1024)]))),128))])):(c(),C("div",or,[x[45]||(x[45]=f("p",{class:"text-muted-foreground mb-2"},"No hay colaboradores asignados",-1)),u.value?(c(),P(l(H),{key:0,variant:"outline",size:"sm",onClick:x[12]||(x[12]=A=>k.value=!0)},{default:r(()=>[o(l(Qt),{class:"h-4 w-4 mr-1.5"}),x[44]||(x[44]=S(" Agregar colaboradores ",-1))]),_:1})):_("",!0)]))]),_:1})]),_:1})],64)):_("",!0)]),_:1}),o(Tl,{open:k.value,"onUpdate:open":x[13]||(x[13]=A=>k.value=A),title:"Gestionar Colaboradores",description:"Busca y selecciona los colaboradores del entregable","selected-users":((D=l(s).usuariosAsignados)==null?void 0:D.map(A=>A.user_id))||[],"search-endpoint":l(s).searchUsersEndpoint||"/admin/proyectos/search-users",loading:l(v)==="usuarios",onSubmit:ie},null,8,["open","selected-users","search-endpoint","loading"]),o(l(qe),{value:"evidencias",class:"mt-0 space-y-4"},{default:r(()=>[U.value?(c(),C(oe,{key:0},[U.value.evidencias&&U.value.evidencias.length>0?(c(),P(yn,{key:0,modelValue:R.value,"onUpdate:modelValue":x[14]||(x[14]=A=>R.value=A),contratos:l(s).contratosRelacionados,evidencias:U.value.evidencias},null,8,["modelValue","contratos","evidencias"])):_("",!0),U.value.evidencias&&U.value.evidencias.length>0?(c(),P(xn,{key:1,mode:"grouped","evidencias-agrupadas":Z.value,"format-date":K},null,8,["evidencias-agrupadas"])):(c(),P(l(ke),{key:2},{default:r(()=>[o(l(Se),{class:"text-center py-8"},{default:r(()=>[o(l(ba),{class:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),x[46]||(x[46]=f("p",{class:"text-muted-foreground"},"No hay evidencias asociadas a este entregable",-1))]),_:1})]),_:1}))],64)):_("",!0)]),_:1}),o(l(qe),{value:"comentarios",class:"mt-0"},{default:r(()=>[e.entregableId?(c(),P(Sl,{key:0,"commentable-type":"entregables","commentable-id":e.entregableId,"can-create":e.canEdit||l(s).canEdit,embedded:""},null,8,["commentable-id","can-create"])):_("",!0)]),_:1}),o(l(qe),{value:"actividad",class:"mt-0 space-y-4"},{default:r(()=>[l(s).actividades&&l(s).actividades.length>0?(c(),P(wl,{key:0,modelValue:te.value,"onUpdate:modelValue":x[15]||(x[15]=A=>te.value=A),usuarios:l(s).usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):_("",!0),o(El,{activities:j.value,title:"Historial de Actividad",description:"Registro de cambios del entregable","empty-message":"No hay actividad registrada","show-card":!1},null,8,["activities"])]),_:1})])]}),_:1})]),_:1},8,["modelValue"])]),o(l(ga),{class:"flex-shrink-0 px-3 py-3 sm:px-6 sm:py-4 border-t bg-muted/30"},{default:r(()=>[f("div",sr,[f("div",ir,[We.value?(c(),P(l(vl),{key:0,href:We.value},{default:r(()=>[o(l(H),{variant:"outline",size:"sm",class:"text-xs sm:text-sm px-2 sm:px-3"},{default:r(()=>[o(l(Ml),{class:"h-3.5 w-3.5 sm:h-4 sm:w-4 sm:mr-1.5"}),x[47]||(x[47]=f("span",{class:"hidden sm:inline"},"Abrir página completa",-1))]),_:1})]),_:1},8,["href"])):_("",!0)]),o(l(H),{variant:"ghost",size:"sm",class:"text-xs sm:text-sm",onClick:q},{default:r(()=>[...x[48]||(x[48]=[S(" Cerrar ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1},8,["open"]))}}),dr={class:"flex flex-col md:flex-row h-full min-h-[500px] overflow-hidden bg-background"},ur={class:"hidden md:flex md:w-72 lg:w-80 flex-col border-r bg-muted/30"},cr={class:"p-4 border-b bg-background"},fr={class:"flex items-center justify-between"},mr={class:"font-semibold text-sm text-muted-foreground uppercase tracking-wide flex items-center gap-2"},vr={key:0,class:"mt-3"},gr={key:0,class:"p-3 space-y-3 border-b bg-background/50"},pr={class:"relative"},hr={class:"flex flex-wrap gap-1"},br={class:"p-2 space-y-1"},yr={key:0,class:"p-4 text-center text-muted-foreground text-sm"},xr=["data-active","onClick"],wr={class:"flex items-center gap-2"},Er={class:"font-medium truncate flex-1"},Cr={key:0,class:"mt-1 ml-4 text-xs text-muted-foreground truncate"},_r={class:"flex items-center gap-2 mt-2 ml-4 text-xs text-muted-foreground"},kr={class:"mt-2 ml-4"},Sr={class:"flex-1 flex flex-col min-h-0 min-w-0"},$r={class:"md:hidden mb-2 border-b bg-background sticky top-0 z-10 space-y-2"},Dr={class:"flex items-center gap-2"},Ir={class:"flex flex-col"},Vr={key:0,class:"text-xs text-muted-foreground"},Tr={class:"text-muted-foreground"},Pr={key:1,class:"space-y-2"},Ar={class:"relative"},Or={class:"flex flex-wrap gap-1"},Mr={key:0,class:"flex items-center justify-center h-full min-h-[400px]"},zr={class:"text-center space-y-3 max-w-sm p-6"},Br={key:1,class:"p-0 md:p-6 space-y-6 overflow-x-hidden"},Rr={class:"flex items-start justify-between gap-4"},Nr={class:"flex-1 min-w-0"},Fr={class:"flex items-center gap-2 mb-1"},Ur={key:0,class:"flex items-center gap-1.5 text-sm text-muted-foreground mt-1"},Hr={key:1,class:"text-sm text-muted-foreground mt-2"},qr={class:"space-y-2"},Lr={class:"flex justify-between items-center text-sm"},jr={class:"font-medium"},Yr={class:"flex flex-wrap gap-4 text-sm"},Gr={key:0,class:"flex items-center gap-1.5 text-muted-foreground"},Xr={key:1,class:"flex items-center gap-1.5 text-muted-foreground"},Wr={key:2,class:"flex items-center gap-1.5 text-muted-foreground"},Kr={class:"flex flex-wrap gap-2"},Qr={class:"space-y-4 min-w-0"},Zr={class:"flex items-center justify-between"},Jr={class:"font-semibold flex items-center gap-2"},ed={key:1,class:"text-center py-8 border rounded-lg bg-muted/30"},ru=be({__name:"HitosDashboard",props:{hitos:{},proyectoId:{},proyectos:{},selectedProyectoId:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},canManageDeliverables:{type:Boolean,default:!1},canComplete:{type:Boolean,default:!1},showViewDetail:{type:Boolean,default:!0},showProyectoInHito:{type:Boolean,default:!1},showFilters:{type:Boolean,default:!1},baseUrl:{default:"/admin/proyectos"}},emits:["select-hito","edit-hito","delete-hito","view-hito","add-entregable","view-entregable","complete-entregable","update-entregable-status","edit-entregable","delete-entregable","filter-proyecto"],setup(e,{emit:a}){var We;const n=e,t=a,i=N(((We=n.selectedProyectoId)==null?void 0:We.toString())||"_all"),s=N(""),d=N(null),m=J(()=>{if(i.value==="_all")return n.hitos;const q=parseInt(i.value,10);return n.hitos.filter(E=>E.proyecto_id===q)}),g=J(()=>{let q=m.value;if(s.value){const E=s.value.toLowerCase();q=q.filter(z=>{var x;return z.nombre.toLowerCase().includes(E)||((x=z.descripcion)==null?void 0:x.toLowerCase().includes(E))})}return d.value&&(q=q.filter(E=>E.estado===d.value)),q}),v=()=>{s.value="",d.value=null},p=q=>{i.value=q,w.value=null;const E=q!=="_all"?parseInt(q,10):null;t("filter-proyecto",E)},h=()=>{const E=new URLSearchParams(window.location.search).get("hito");return E?parseInt(E,10):null},I=()=>{const q=new URLSearchParams(window.location.search),E=q.get("modal"),z=q.get("modal_tab")||"detalles";return E==="hito"?{type:"hito",tab:z}:E!=null&&E.startsWith("entregable_")?{type:"entregable",entregableId:parseInt(E.replace("entregable_",""),10),tab:z}:{type:null,tab:"detalles"}},w=N(h()),b=I(),u=J(()=>g.value.find(q=>q.id===w.value)??null),y=J(()=>n.proyectoId?n.proyectoId:u.value?u.value.proyecto_id:null);he(w,q=>{if(q){const E=window.location.pathname,z=new URLSearchParams(window.location.search);z.set("hito",String(q));const x=`${E}?${z.toString()}`;Qa.get(x,{},{preserveState:!0,preserveScroll:!0,replace:!0,only:[]}),t("select-hito",q)}});const k=q=>{w.value=q},O=q=>{const E=parseInt(q,10);isNaN(E)||k(E)},L=q=>q?je(new Date(q),"dd MMM yyyy",{locale:Ye}):"Sin fecha",T=q=>({pendiente:"bg-gray-100 text-gray-800",en_progreso:"bg-blue-100 text-blue-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[q]||"bg-gray-100 text-gray-800",X=q=>({pendiente:"bg-gray-400",en_progreso:"bg-blue-500 animate-pulse",completado:"bg-green-500",cancelado:"bg-red-500"})[q]||"bg-gray-400",ie=q=>{u.value&&t("view-entregable",q,u.value)},ue=(q,E,z)=>{t("complete-entregable",q,E,z)},ce=(q,E,z,x)=>{t("update-entregable-status",q,E,z,x)},F=q=>{u.value&&(Z.value=q.id,j.value="detalles",Q.value=!0)},R=q=>{u.value&&t("delete-entregable",q,u.value)},te=()=>{u.value&&(M.value="detalles",re.value=!0)},U=()=>{u.value&&t("delete-hito",u.value)},se=()=>{u.value&&t("add-entregable",u.value)},we=()=>{u.value&&(M.value="detalles",re.value=!0)},re=N(b.type==="hito"),M=N(b.type==="hito"?b.tab:"detalles"),Q=N(b.type==="entregable"),Z=N(b.entregableId||null),j=N(b.type==="entregable"?b.tab:"detalles"),V=(q,E,z)=>{const x=window.location.pathname,D=new URLSearchParams(window.location.search);q==="hito"?(D.set("modal","hito"),z&&D.set("modal_tab",z)):q==="entregable"&&E?(D.set("modal",`entregable_${E}`),z&&D.set("modal_tab",z)):(D.delete("modal"),D.delete("modal_tab"),D.delete("pagina"));const A=`${x}?${D.toString()}`;Qa.get(A,{},{preserveState:!0,preserveScroll:!0,replace:!0,only:[]})};he([re,M],([q,E])=>{q?V("hito",void 0,E):new URLSearchParams(window.location.search).get("modal")==="hito"&&V(null)}),he([Q,j],([q,E])=>{if(q&&Z.value)V("entregable",Z.value,E);else{const x=new URLSearchParams(window.location.search).get("modal");x!=null&&x.startsWith("entregable_")&&V(null)}});const W=(q,E="detalles")=>{Z.value=q.id,j.value=E,Q.value=!0},K=()=>{M.value="comentarios",re.value=!0},Ve=()=>{M.value="actividad",re.value=!0};return(q,E)=>{var z,x;return c(),C("div",dr,[f("aside",ur,[f("div",cr,[f("div",fr,[f("h2",mr,[o(l(Pa),{class:"h-4 w-4"}),S(" Hitos ("+$(g.value.length)+") ",1)])]),e.proyectos&&e.proyectos.length>0?(c(),C("div",vr,[o(l(Vt),{"model-value":i.value,"onUpdate:modelValue":p},{default:r(()=>[o(l(Tt),{class:"w-full h-9 text-sm"},{default:r(()=>[o(l(Pt),{placeholder:"Todos los proyectos"})]),_:1}),o(l(At),null,{default:r(()=>[o(l(nt),{value:"_all"},{default:r(()=>[...E[18]||(E[18]=[S("Todos los proyectos",-1)])]),_:1}),(c(!0),C(oe,null,pe(e.proyectos,D=>(c(),P(l(nt),{key:D.id,value:D.id.toString()},{default:r(()=>[S($(D.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"])])):_("",!0)]),e.showFilters?(c(),C("div",gr,[f("div",pr,[o(l(Za),{class:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),o(l(ut),{modelValue:s.value,"onUpdate:modelValue":E[0]||(E[0]=D=>s.value=D),placeholder:"Buscar hitos...",class:"pl-8 h-9 text-sm"},null,8,["modelValue"]),s.value?(c(),P(l(H),{key:0,variant:"ghost",size:"icon",class:"absolute right-1 top-1 h-7 w-7",onClick:E[1]||(E[1]=D=>s.value="")},{default:r(()=>[o(l(Ht),{class:"h-3.5 w-3.5"})]),_:1})):_("",!0)]),f("div",hr,[o(l(H),{size:"sm",variant:d.value?"outline":"default",class:"h-7 text-xs px-2.5",onClick:E[2]||(E[2]=D=>d.value=null)},{default:r(()=>[...E[19]||(E[19]=[S(" Todos ",-1)])]),_:1},8,["variant"]),o(l(H),{size:"sm",variant:d.value==="pendiente"?"default":"outline",class:"h-7 text-xs px-2.5",onClick:E[3]||(E[3]=D=>d.value="pendiente")},{default:r(()=>[...E[20]||(E[20]=[S(" Pendientes ",-1)])]),_:1},8,["variant"]),o(l(H),{size:"sm",variant:d.value==="en_progreso"?"default":"outline",class:"h-7 text-xs px-2.5",onClick:E[4]||(E[4]=D=>d.value="en_progreso")},{default:r(()=>[...E[21]||(E[21]=[S(" En Progreso ",-1)])]),_:1},8,["variant"]),o(l(H),{size:"sm",variant:d.value==="completado"?"default":"outline",class:"h-7 text-xs px-2.5",onClick:E[5]||(E[5]=D=>d.value="completado")},{default:r(()=>[...E[22]||(E[22]=[S(" Completados ",-1)])]),_:1},8,["variant"])]),s.value||d.value?(c(),P(l(H),{key:0,variant:"ghost",size:"sm",class:"w-full h-7 text-xs",onClick:v},{default:r(()=>[o(l(Ht),{class:"h-3.5 w-3.5 mr-1"}),E[23]||(E[23]=S(" Limpiar filtros ",-1))]),_:1})):_("",!0)])):_("",!0),o(l(Ft),{class:"flex-1"},{default:r(()=>[f("div",br,[g.value.length===0?(c(),C("div",yr,$(s.value||d.value?"No se encontraron hitos con los filtros aplicados":"No hay hitos definidos"),1)):_("",!0),(c(!0),C(oe,null,pe(g.value,D=>(c(),C("button",{key:D.id,"data-active":w.value===D.id,class:"w-full text-left p-3 rounded-lg transition-colors duration-150 hover:bg-accent hover:text-accent-foreground data-[active=true]:bg-primary/10 data-[active=true]:text-primary data-[active=true]:border-l-2 data-[active=true]:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",onClick:A=>k(D.id)},[f("div",wr,[f("div",{class:ae([X(D.estado),"w-2 h-2 rounded-full flex-shrink-0"])},null,2),f("span",Er,$(D.nombre),1),w.value===D.id?(c(),P(l(yl),{key:0,class:"h-4 w-4 flex-shrink-0 text-primary"})):_("",!0)]),e.showProyectoInHito&&D.proyecto?(c(),C("div",Cr,$(D.proyecto.nombre),1)):_("",!0),f("div",_r,[o(l(ye),{class:ae([T(D.estado),"text-[10px] px-1.5 py-0"])},{default:r(()=>[S($(D.estado_label||D.estado),1)]),_:2},1032,["class"]),f("span",null,$(D.porcentaje_completado)+"%",1)]),f("div",kr,[o(l(na),{"model-value":D.porcentaje_completado,class:"h-1"},null,8,["model-value"])])],8,xr))),128))])]),_:1})]),f("main",Sr,[f("div",$r,[e.proyectos&&e.proyectos.length>0?(c(),P(l(Vt),{key:0,"model-value":i.value,"onUpdate:modelValue":p},{default:r(()=>[o(l(Tt),{class:"w-full h-9 text-sm"},{default:r(()=>[o(l(Pt),{placeholder:"Todos los proyectos"})]),_:1}),o(l(At),null,{default:r(()=>[o(l(nt),{value:"_all"},{default:r(()=>[...E[24]||(E[24]=[S("Todos los proyectos",-1)])]),_:1}),(c(!0),C(oe,null,pe(e.proyectos,D=>(c(),P(l(nt),{key:D.id,value:D.id.toString()},{default:r(()=>[S($(D.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"])):_("",!0),o(l(Vt),{"model-value":((z=w.value)==null?void 0:z.toString())||"","onUpdate:modelValue":O},{default:r(()=>[o(l(Tt),{class:"w-full"},{default:r(()=>[o(l(Pt),{placeholder:"Selecciona un hito"})]),_:1}),o(l(At),null,{default:r(()=>[(c(!0),C(oe,null,pe(g.value,D=>(c(),P(l(nt),{key:D.id,value:D.id.toString()},{default:r(()=>[f("div",Dr,[f("div",{class:ae([X(D.estado),"w-2 h-2 rounded-full"])},null,2),f("div",Ir,[f("span",null,$(D.nombre),1),e.showProyectoInHito&&D.proyecto?(c(),C("span",Vr,$(D.proyecto.nombre),1)):_("",!0)]),f("span",Tr,"("+$(D.porcentaje_completado)+"%)",1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),e.showFilters?(c(),C("div",Pr,[f("div",Ar,[o(l(Za),{class:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),o(l(ut),{modelValue:s.value,"onUpdate:modelValue":E[6]||(E[6]=D=>s.value=D),placeholder:"Buscar hitos...",class:"pl-8 h-9 text-sm"},null,8,["modelValue"])]),f("div",Or,[o(l(H),{size:"sm",variant:d.value?"outline":"default",class:"h-7 text-xs px-2",onClick:E[7]||(E[7]=D=>d.value=null)},{default:r(()=>[...E[25]||(E[25]=[S(" Todos ",-1)])]),_:1},8,["variant"]),o(l(H),{size:"sm",variant:d.value==="pendiente"?"default":"outline",class:"h-7 text-xs px-2",onClick:E[8]||(E[8]=D=>d.value="pendiente")},{default:r(()=>[...E[26]||(E[26]=[S(" Pendientes ",-1)])]),_:1},8,["variant"]),o(l(H),{size:"sm",variant:d.value==="en_progreso"?"default":"outline",class:"h-7 text-xs px-2",onClick:E[9]||(E[9]=D=>d.value="en_progreso")},{default:r(()=>[...E[27]||(E[27]=[S(" En Progreso ",-1)])]),_:1},8,["variant"]),o(l(H),{size:"sm",variant:d.value==="completado"?"default":"outline",class:"h-7 text-xs px-2",onClick:E[10]||(E[10]=D=>d.value="completado")},{default:r(()=>[...E[28]||(E[28]=[S(" Completados ",-1)])]),_:1},8,["variant"])])])):_("",!0)]),o(l(Ft),{class:"flex-1"},{default:r(()=>[u.value?(c(),C("div",Br,[o(l(ke),null,{default:r(()=>[o(l(Ae),{class:"pb-3"},{default:r(()=>[f("div",Rr,[f("div",Nr,[f("div",Fr,[f("div",{class:ae([X(u.value.estado),"w-2.5 h-2.5 rounded-full"])},null,2),o(l(Oe),{class:"text-xl truncate"},{default:r(()=>[S($(u.value.nombre),1)]),_:1})]),e.showProyectoInHito&&u.value.proyecto?(c(),C("div",Ur,[o(l(Vn),{class:"h-4 w-4"}),f("span",null,$(u.value.proyecto.nombre),1)])):_("",!0),u.value.descripcion?(c(),C("p",Hr,$(u.value.descripcion),1)):_("",!0)]),o(l(ye),{class:ae(T(u.value.estado))},{default:r(()=>[S($(u.value.estado_label||u.value.estado),1)]),_:1},8,["class"])])]),_:1}),o(l(Se),{class:"space-y-4"},{default:r(()=>[f("div",qr,[f("div",Lr,[E[31]||(E[31]=f("span",{class:"text-muted-foreground"},"Progreso",-1)),f("span",jr,$(u.value.porcentaje_completado)+"%",1)]),o(l(na),{"model-value":u.value.porcentaje_completado,class:"h-2"},null,8,["model-value"])]),f("div",Yr,[u.value.fecha_inicio?(c(),C("div",Gr,[o(l(ct),{class:"h-4 w-4"}),f("span",null,"Inicio: "+$(L(u.value.fecha_inicio)),1)])):_("",!0),u.value.fecha_fin?(c(),C("div",Xr,[o(l(Me),{class:"h-4 w-4"}),f("span",null,"Fin: "+$(L(u.value.fecha_fin)),1)])):_("",!0),u.value.responsable?(c(),C("div",Wr,[o(l(st),{class:"h-4 w-4"}),f("span",null,$(u.value.responsable.name),1)])):_("",!0)]),o(l(nn)),f("div",Kr,[e.canEdit?(c(),P(l(H),{key:0,variant:"outline",size:"sm",onClick:te},{default:r(()=>[o(l(Va),{class:"h-4 w-4 mr-1.5"}),E[32]||(E[32]=S(" Editar Hito ",-1))]),_:1})):_("",!0),e.canManageDeliverables?(c(),P(l(H),{key:1,variant:"outline",size:"sm",onClick:se},{default:r(()=>[o(l(Ja),{class:"h-4 w-4 mr-1.5"}),E[33]||(E[33]=S(" Añadir Entregable ",-1))]),_:1})):_("",!0),e.showViewDetail?(c(),P(l(H),{key:2,variant:"ghost",size:"sm",onClick:we},{default:r(()=>[o(l(ya),{class:"h-4 w-4 mr-1.5"}),E[34]||(E[34]=S(" Ver detalles ",-1))]),_:1})):_("",!0),o(l(H),{variant:"ghost",size:"sm",onClick:K},{default:r(()=>[o(l(ft),{class:"h-4 w-4 mr-1.5"}),E[35]||(E[35]=S(" Comentarios ",-1)),u.value.comentarios_count&&u.value.comentarios_count>0?(c(),P(l(ye),{key:0,variant:"secondary",class:"ml-1.5 text-xs"},{default:r(()=>[S($(u.value.comentarios_count),1)]),_:1})):_("",!0)]),_:1}),o(l(H),{variant:"ghost",size:"sm",onClick:Ve},{default:r(()=>[o(l(mt),{class:"h-4 w-4 mr-1.5"}),E[36]||(E[36]=S(" Actividad ",-1))]),_:1}),e.canDelete?(c(),P(l(H),{key:3,variant:"ghost",size:"sm",class:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:U},{default:r(()=>[o(l(Cl),{class:"h-4 w-4 mr-1.5"}),E[37]||(E[37]=S(" Eliminar ",-1))]),_:1})):_("",!0)])]),_:1})]),_:1}),f("div",Qr,[f("div",Zr,[f("h3",Jr,[o(l(ya),{class:"h-5 w-5"}),E[38]||(E[38]=S(" Entregables ",-1)),o(l(ye),{variant:"secondary",class:"ml-1"},{default:r(()=>{var D;return[S($(((D=u.value.entregables)==null?void 0:D.length)||0),1)]}),_:1})])]),u.value.entregables&&u.value.entregables.length>0?(c(),P(l(as),{key:0,entregables:u.value.entregables,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-complete":e.canComplete,"initial-modal-entregable-id":l(b).type==="entregable"?l(b).entregableId:void 0,"initial-modal-tab":l(b).type==="entregable"?l(b).tab:void 0,onView:ie,onComplete:ue,onUpdateStatus:ce,onEdit:F,onDelete:R,onOpenModal:W,onModalTabChange:E[11]||(E[11]=(D,A)=>{Z.value=D,j.value=A})},null,8,["entregables","can-edit","can-delete","can-complete","initial-modal-entregable-id","initial-modal-tab"])):(c(),C("div",ed,[o(l(ya),{class:"h-10 w-10 mx-auto text-muted-foreground/50 mb-3"}),E[40]||(E[40]=f("p",{class:"text-muted-foreground text-sm"},"No hay entregables en este hito",-1)),e.canManageDeliverables?(c(),P(l(H),{key:0,variant:"outline",size:"sm",class:"mt-4",onClick:se},{default:r(()=>[o(l(Ja),{class:"h-4 w-4 mr-1.5"}),E[39]||(E[39]=S(" Crear primer entregable ",-1))]),_:1})):_("",!0)]))])])):(c(),C("div",Mr,[f("div",zr,[o(l(Pa),{class:"h-16 w-16 mx-auto text-muted-foreground/50"}),E[29]||(E[29]=f("h3",{class:"font-medium text-lg"},"Selecciona un hito",-1)),E[30]||(E[30]=f("p",{class:"text-sm text-muted-foreground"}," Elige un hito de la lista para ver sus detalles y entregables ",-1))])]))]),_:1})]),u.value?(c(),P(_i,{key:0,open:re.value,"onUpdate:open":E[12]||(E[12]=D=>re.value=D),"hito-id":u.value.id,"proyecto-id":y.value||0,"initial-tab":M.value,"can-edit":e.canEdit,"can-delete":e.canDelete,"can-manage-entregables":e.canManageDeliverables,"onUpdate:tab":E[13]||(E[13]=D=>M.value=D),onEditHito:te,onViewEntregable:ie,onEditEntregable:F,onAddEntregable:se},null,8,["open","hito-id","proyecto-id","initial-tab","can-edit","can-delete","can-manage-entregables"])):_("",!0),Z.value?(c(),P(rr,{key:1,open:Q.value,"onUpdate:open":[E[14]||(E[14]=D=>Q.value=D),E[17]||(E[17]=D=>{D||(Z.value=null)})],"entregable-id":Z.value,"proyecto-id":y.value,"hito-id":(x=u.value)==null?void 0:x.id,"initial-tab":j.value,"can-edit":e.canEdit,"can-delete":e.canDelete,"onUpdate:tab":E[15]||(E[15]=D=>j.value=D),onEditEntregable:E[16]||(E[16]=()=>u.value&&F({id:Z.value}))},null,8,["open","entregable-id","proyecto-id","hito-id","initial-tab","can-edit","can-delete"])):_("",!0)])}}});export{ru as _};
