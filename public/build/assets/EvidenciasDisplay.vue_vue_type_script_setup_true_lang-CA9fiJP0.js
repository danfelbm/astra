import{c as M,_ as z}from"./createLucideIcon-CkqZGnyd.js";import{d as H,r as y,c as D,i as b,F as V,b as m,j as $,e as t,f as a,w as s,k as j,g as i,h as n,t as u,s as A,m as c,v as N,l as X,n as J}from"./app-H5iGr2tD.js";import{c as S,_ as q}from"./CardTitle.vue_vue_type_script_setup_true_lang-Ciw19BiC.js";import{_ as B}from"./index-CVi_6vMd.js";import{_ as K,a as Q,b as L,c as _,d as W,e as v}from"./TableHeader.vue_vue_type_script_setup_true_lang-VUbk_Dvo.js";import{_ as Y,a as Z,b as ee,c as ae,d as te}from"./AccordionContent.vue_vue_type_script_setup_true_lang-BaA9_cu_.js";import{e as se,_ as oe,a as le,b as re,c as ne,d as ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CX-gld0c.js";import{_ as de}from"./Textarea.vue_vue_type_script_setup_true_lang-7_IS8bGL.js";import{_ as ue}from"./Label.vue_vue_type_script_setup_true_lang-C-7cI9mo.js";import{t as P}from"./index-3G2vCCyX.js";import{I as R}from"./image-BlwBd4ab.js";import{F as ce}from"./file-text-y9clDDO_.js";import{E as fe}from"./external-link-C9mSBcmb.js";import{E as me}from"./eye-DzK8e2UU.js";import{D as _e}from"./download-D8zzSkOx.js";import{C as ve}from"./circle-check-big-w6DVH82n.js";import{C as pe}from"./circle-x-OqKxHXdc.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=M("BanIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=M("CirclePauseIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=M("MilestoneIcon",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M4 6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h13a2 2 0 0 0 1.152-.365l3.424-2.317a1 1 0 0 0 0-1.635l-3.424-2.318A2 2 0 0 0 17 6z",key:"1btarq"}]]),ye={key:1,class:"mt-4"},be={class:"flex items-center justify-between w-full pr-4"},he={class:"flex items-center gap-3"},xe={class:"text-left"},ge={class:"font-semibold"},ke={class:"text-sm text-gray-500"},$e={class:"flex items-center gap-3"},Ee={class:"text-sm text-gray-600"},we={class:"text-sm"},Ce={class:"flex items-center justify-end gap-2"},ze=["href"],Ve={class:"text-center"},De={class:"text-center"},Be={class:"space-y-4 py-4"},We=H({__name:"EvidenciasDisplay",props:{contratos:{default:()=>[]},proyectoId:{},modo:{},puedeGestionarEstado:{type:Boolean,default:!1},formatDate:{}},setup(p){const h=p,d=y({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),x=y(!1),E=y(null),f=y(null),g=y(""),k=y(!1),w=D(()=>{const o=[];return h.contratos&&h.contratos.forEach(e=>{e.obligaciones&&e.obligaciones.forEach(l=>{l.evidencias&&l.evidencias.forEach(r=>{o.push({...r,contrato_id:e.id,contrato_numero:e.numero_contrato,contrato_nombre:e.nombre,obligacion_titulo:l.titulo,_contrato:e})})})}),o}),U=D(()=>{let o=w.value;return d.value.contrato_id&&(o=o.filter(e=>e.contrato_id===d.value.contrato_id)),d.value.tipo&&(o=o.filter(e=>e.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(e=>e.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(e=>{var l;return((l=e.usuario)==null?void 0:l.id)===d.value.usuario_id})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(e=>{const l=new Date(e.created_at);if(d.value.fecha_inicio){const r=new Date(d.value.fecha_inicio);if(l<r)return!1}if(d.value.fecha_fin){const r=new Date(d.value.fecha_fin);if(r.setHours(23,59,59,999),l>r)return!1}return!0})),o}),F=D(()=>{const o={};return U.value.forEach(e=>{o[e.contrato_id]||(o[e.contrato_id]={contrato:e._contrato,evidencias:[]}),o[e.contrato_id].evidencias.push(e)}),Object.values(o)}),O=o=>h.modo==="admin"?`/admin/contratos/${o}`:`/miembro/mis-contratos/${o}`,T=(o,e)=>h.modo==="admin"?`/admin/contratos/${o}/evidencias/${e}`:`/miembro/mis-contratos/${o}/evidencias/${e}`,I=(o,e)=>{E.value=o,f.value=e,g.value="",x.value=!0},G=async()=>{if(!E.value||!f.value)return;k.value=!0;const o=`/api/proyectos/${h.proyectoId}/evidencias/${E.value.id}/${f.value}`;A.post(o,{observaciones:g.value||null},{preserveScroll:!0,onSuccess:()=>{P.success(f.value==="aprobar"?"Evidencia aprobada exitosamente":"Evidencia rechazada"),x.value=!1,E.value=null,f.value=null,g.value="",A.reload({only:["proyecto"]})},onError:e=>{P.error("Error al cambiar el estado de la evidencia"),console.error(e)},onFinish:()=>{k.value=!1}})};return(o,e)=>(c(),b(V,null,[w.value.length>0?(c(),m(Y,{key:0,modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),contratos:p.contratos||[],evidencias:w.value},null,8,["modelValue","contratos","evidencias"])):$("",!0),F.value.length>0?(c(),b("div",ye,[t(a(Z),{type:"multiple",class:"space-y-4",collapsible:""},{default:s(()=>[(c(!0),b(V,null,j(F.value,l=>(c(),m(a(ee),{key:l.contrato.id,value:`contrato-${l.contrato.id}`,class:"border rounded-lg bg-card"},{default:s(()=>[t(a(ae),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:s(()=>[i("div",be,[i("div",he,[t(a(ce),{class:"h-5 w-5 text-gray-500"}),i("div",xe,[i("div",ge,u(l.contrato.nombre),1),i("div",ke,u(l.contrato.numero_contrato||"Sin número"),1)])]),i("div",$e,[t(a(B),{variant:"secondary"},{default:s(()=>[n(u(l.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),t(a(N),{href:O(l.contrato.id),onClick:e[1]||(e[1]=X(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:s(()=>[e[5]||(e[5]=n(" Ver contrato ",-1)),t(a(fe),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),t(a(te),{class:"px-4 pb-4"},{default:s(()=>[t(a(K),null,{default:s(()=>[t(a(Q),null,{default:s(()=>[t(a(L),null,{default:s(()=>[t(a(_),null,{default:s(()=>[...e[6]||(e[6]=[n("Tipo",-1)])]),_:1}),t(a(_),null,{default:s(()=>[...e[7]||(e[7]=[n("Obligación",-1)])]),_:1}),t(a(_),null,{default:s(()=>[...e[8]||(e[8]=[n("Descripción",-1)])]),_:1}),p.modo==="admin"?(c(),m(a(_),{key:0},{default:s(()=>[...e[9]||(e[9]=[n("Usuario",-1)])]),_:1})):$("",!0),t(a(_),null,{default:s(()=>[...e[10]||(e[10]=[n("Estado",-1)])]),_:1}),t(a(_),null,{default:s(()=>[...e[11]||(e[11]=[n("Fecha",-1)])]),_:1}),t(a(_),{class:"text-right"},{default:s(()=>[...e[12]||(e[12]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(a(W),null,{default:s(()=>[(c(!0),b(V,null,j(l.evidencias,r=>(c(),m(a(L),{key:r.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:s(()=>[t(a(v),null,{default:s(()=>[t(a(B),{variant:"outline"},{default:s(()=>[n(u(r.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(a(v),null,{default:s(()=>[n(u(r.obligacion_titulo),1)]),_:2},1024),t(a(v),null,{default:s(()=>[i("span",Ee,u(r.descripcion||"-"),1)]),_:2},1024),p.modo==="admin"?(c(),m(a(v),{key:0},{default:s(()=>{var C;return[i("span",we,u(((C=r.usuario)==null?void 0:C.name)||"-"),1)]}),_:2},1024)):$("",!0),t(a(v),null,{default:s(()=>[t(a(B),{class:J({"bg-yellow-100 text-yellow-800":r.estado==="pendiente","bg-green-100 text-green-800":r.estado==="aprobada","bg-red-100 text-red-800":r.estado==="rechazada"})},{default:s(()=>[n(u(r.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(a(v),null,{default:s(()=>[n(u(p.formatDate(r.created_at)),1)]),_:2},1024),t(a(v),{class:"text-right"},{default:s(()=>[i("div",Ce,[t(a(N),{href:T(r.contrato_id,r.id),class:"inline-flex items-center text-blue-600 hover:text-blue-800"},{default:s(()=>[t(a(me),{class:"h-4 w-4"})]),_:1},8,["href"]),r.archivo_url?(c(),b("a",{key:0,href:r.archivo_url,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800"},[t(a(_e),{class:"h-4 w-4"})],8,ze)):$("",!0),p.puedeGestionarEstado&&r.estado==="pendiente"?(c(),b(V,{key:1},[t(a(z),{size:"sm",variant:"ghost",onClick:C=>I(r,"aprobar"),class:"h-8 w-8 p-0 text-green-600 hover:text-green-800 hover:bg-green-50"},{default:s(()=>[t(a(ve),{class:"h-4 w-4"})]),_:1},8,["onClick"]),t(a(z),{size:"sm",variant:"ghost",onClick:C=>I(r,"rechazar"),class:"h-8 w-8 p-0 text-red-600 hover:text-red-800 hover:bg-red-50"},{default:s(()=>[t(a(pe),{class:"h-4 w-4"})]),_:1},8,["onClick"])],64)):$("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):w.value.length===0?(c(),m(a(q),{key:2,class:"mt-4"},{default:s(()=>[t(a(S),{class:"py-8"},{default:s(()=>[i("div",Ve,[t(a(R),{class:"mx-auto h-12 w-12 text-gray-400"}),e[13]||(e[13]=i("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias cargadas",-1)),e[14]||(e[14]=i("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(c(),m(a(q),{key:3,class:"mt-4"},{default:s(()=>[t(a(S),{class:"py-8"},{default:s(()=>[i("div",De,[t(a(R),{class:"mx-auto h-12 w-12 text-gray-400"}),e[15]||(e[15]=i("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),e[16]||(e[16]=i("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1})),t(a(se),{open:x.value,"onUpdate:open":e[4]||(e[4]=l=>x.value=l)},{default:s(()=>[t(a(oe),null,{default:s(()=>[t(a(le),null,{default:s(()=>[t(a(re),null,{default:s(()=>[n(u(f.value==="aprobar"?"Aprobar Evidencia":"Rechazar Evidencia"),1)]),_:1}),t(a(ne),null,{default:s(()=>[n(u(f.value==="aprobar"?"Estás a punto de aprobar esta evidencia. Puedes agregar observaciones opcionales.":"Estás a punto de rechazar esta evidencia. Es recomendable agregar el motivo del rechazo."),1)]),_:1})]),_:1}),i("div",Be,[i("div",null,[t(a(ue),{for:"observaciones"},{default:s(()=>[n(" Observaciones "+u(f.value==="rechazar"?"(recomendado)":"(opcional)"),1)]),_:1}),t(a(de),{id:"observaciones",modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),placeholder:f.value==="rechazar"?"Explica el motivo del rechazo...":"Agrega comentarios adicionales...",rows:"4",class:"mt-2"},null,8,["modelValue","placeholder"])])]),t(a(ie),null,{default:s(()=>[t(a(z),{variant:"outline",onClick:e[3]||(e[3]=l=>x.value=!1),disabled:k.value},{default:s(()=>[...e[17]||(e[17]=[n(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(a(z),{variant:f.value==="aprobar"?"default":"destructive",onClick:G,disabled:k.value},{default:s(()=>[n(u(k.value?"Procesando...":f.value==="aprobar"?"Aprobar":"Rechazar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])],64))}});export{Je as B,Ke as C,Qe as M,We as _};
