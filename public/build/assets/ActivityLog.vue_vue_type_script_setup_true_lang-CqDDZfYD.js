import{a as N,b as U,c as R,_ as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-dY01waGI.js";import{_ as k}from"./Label.vue_vue_type_script_setup_true_lang-DwX3btDZ.js";import{_ as x}from"./createLucideIcon-CLjpYl3h.js";import{_ as j,a as A,b as E,c as T,d as w}from"./SelectValue.vue_vue_type_script_setup_true_lang-CYbO_2jR.js";import{_ as J,a as K,b as Q}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BOS33qD2.js";import{F as L}from"./filter-B46y4Zef.js";import{X as M}from"./x-DmyeVJVz.js";import{C as W}from"./calendar-YnA3hBxk.js";import{d as X,c as z,b as g,i as c,w as a,e as s,f as e,g as i,j as y,h as u,F as C,k as H,t as r,m as l}from"./app-B5elfBm_.js";import{f as q,e as G}from"./es-BDPlFIsO.js";import{_ as S,a as B,b as I}from"./index-CS1r2MQv.js";import{_ as Y}from"./CardDescription.vue_vue_type_script_setup_true_lang-16bYJnim.js";import{p as Z}from"./parseISO-DFjB8F03.js";const ee={class:"flex items-center justify-between"},te={class:"flex items-center gap-2"},se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ae={key:0,class:"space-y-2"},le={class:"flex gap-2"},oe={key:1,class:"space-y-2"},ie={class:"flex gap-2"},ne={class:"space-y-2"},de={class:"flex gap-2"},ue={class:"space-y-2"},re={class:"flex gap-2"},ce={key:0,class:"text-sm"},fe={key:1,class:"text-muted-foreground"},me={class:"p-3 space-y-2"},_e=["value"],pe=["value"],ve={key:1,class:"space-y-4"},ge={class:"flex items-center justify-between"},ye={class:"flex items-center gap-2"},We=X({__name:"ActivityFilters",props:{modelValue:{},usuarios:{default:()=>[]},contextLevel:{default:"proyecto"},showCard:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(m,{emit:F}){const $=m,V=F,o=z({get:()=>$.modelValue,set:f=>V("update:modelValue",f)}),h=z(()=>{const f=[];return $.contextLevel==="proyecto"?f.push({value:"Modules\\Proyectos\\Models\\Proyecto",label:"Proyecto"},{value:"Modules\\Proyectos\\Models\\Hito",label:"Hito"},{value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}):$.contextLevel==="hito"?f.push({value:"Modules\\Proyectos\\Models\\Hito",label:"Hito"},{value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}):f.push({value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}),f}),d=[{value:"created",label:"Creado"},{value:"updated",label:"Actualizado"},{value:"deleted",label:"Eliminado"},{value:"restored",label:"Restaurado"},{value:"custom",label:"Acción personalizada"}],_=(f,t)=>{o.value={...o.value,[f]:t}},p=f=>{_(f,null)},v=()=>{o.value={usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}},b=z(()=>Object.values(o.value).some(f=>f!=null)),D=f=>{if(!f)return"";try{return q(new Date(f),"d 'de' MMM yyyy",{locale:G})}catch{return f}};return(f,t)=>m.showCard?(l(),g(e(O),{key:0},{default:a(()=>[s(e(N),{class:"pb-3"},{default:a(()=>[i("div",ee,[i("div",te,[s(e(L),{class:"h-4 w-4"}),s(e(U),{class:"text-base"},{default:a(()=>[...t[9]||(t[9]=[u("Filtros de Actividad",-1)])]),_:1})]),b.value?(l(),g(e(x),{key:0,variant:"ghost",size:"sm",onClick:v},{default:a(()=>[s(e(M),{class:"h-4 w-4 mr-1"}),t[10]||(t[10]=u(" Limpiar ",-1))]),_:1})):y("",!0)])]),_:1}),s(e(R),null,{default:a(()=>{var P;return[i("div",se,[m.usuarios.length>0?(l(),c("div",ae,[s(e(k),{for:"usuario"},{default:a(()=>[...t[11]||(t[11]=[u("Usuario",-1)])]),_:1}),i("div",le,[s(e(j),{"model-value":(P=o.value.usuario_id)==null?void 0:P.toString(),"onUpdate:modelValue":t[0]||(t[0]=n=>_("usuario_id",n?parseInt(n):null))},{default:a(()=>[s(e(A),{id:"usuario"},{default:a(()=>[s(e(E),{placeholder:"Todos los usuarios"})]),_:1}),s(e(T),null,{default:a(()=>[s(e(w),{value:"null"},{default:a(()=>[...t[12]||(t[12]=[u("Todos los usuarios",-1)])]),_:1}),(l(!0),c(C,null,H(m.usuarios,n=>(l(),g(e(w),{key:n.id,value:n.id.toString()},{default:a(()=>[u(r(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),o.value.usuario_id?(l(),g(e(x),{key:0,variant:"ghost",size:"icon",onClick:t[1]||(t[1]=n=>p("usuario_id"))},{default:a(()=>[s(e(M),{class:"h-4 w-4"})]),_:1})):y("",!0)])])):y("",!0),h.value.length>1?(l(),c("div",oe,[s(e(k),{for:"tipo-entidad"},{default:a(()=>[...t[13]||(t[13]=[u("Tipo de Entidad",-1)])]),_:1}),i("div",ie,[s(e(j),{"model-value":o.value.tipo_entidad||"null","onUpdate:modelValue":t[2]||(t[2]=n=>_("tipo_entidad",n==="null"?null:n))},{default:a(()=>[s(e(A),{id:"tipo-entidad"},{default:a(()=>[s(e(E),{placeholder:"Todas las entidades"})]),_:1}),s(e(T),null,{default:a(()=>[s(e(w),{value:"null"},{default:a(()=>[...t[14]||(t[14]=[u("Todas las entidades",-1)])]),_:1}),(l(!0),c(C,null,H(h.value,n=>(l(),g(e(w),{key:n.value,value:n.value},{default:a(()=>[u(r(n.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),o.value.tipo_entidad?(l(),g(e(x),{key:0,variant:"ghost",size:"icon",onClick:t[3]||(t[3]=n=>p("tipo_entidad"))},{default:a(()=>[s(e(M),{class:"h-4 w-4"})]),_:1})):y("",!0)])])):y("",!0),i("div",ne,[s(e(k),{for:"tipo-accion"},{default:a(()=>[...t[15]||(t[15]=[u("Tipo de Acción",-1)])]),_:1}),i("div",de,[s(e(j),{"model-value":o.value.tipo_accion||"null","onUpdate:modelValue":t[4]||(t[4]=n=>_("tipo_accion",n==="null"?null:n))},{default:a(()=>[s(e(A),{id:"tipo-accion"},{default:a(()=>[s(e(E),{placeholder:"Todas las acciones"})]),_:1}),s(e(T),null,{default:a(()=>[s(e(w),{value:"null"},{default:a(()=>[...t[16]||(t[16]=[u("Todas las acciones",-1)])]),_:1}),(l(),c(C,null,H(d,n=>s(e(w),{key:n.value,value:n.value},{default:a(()=>[u(r(n.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value"]),o.value.tipo_accion?(l(),g(e(x),{key:0,variant:"ghost",size:"icon",onClick:t[5]||(t[5]=n=>p("tipo_accion"))},{default:a(()=>[s(e(M),{class:"h-4 w-4"})]),_:1})):y("",!0)])]),i("div",ue,[s(e(k),null,{default:a(()=>[...t[17]||(t[17]=[u("Rango de Fechas",-1)])]),_:1}),i("div",re,[s(e(J),null,{default:a(()=>[s(e(K),{"as-child":""},{default:a(()=>[s(e(x),{variant:"outline",class:"w-full justify-start text-left font-normal"},{default:a(()=>[s(e(W),{class:"mr-2 h-4 w-4"}),o.value.fecha_inicio||o.value.fecha_fin?(l(),c("span",ce,r(o.value.fecha_inicio?D(o.value.fecha_inicio):"...")+" - "+r(o.value.fecha_fin?D(o.value.fecha_fin):"..."),1)):(l(),c("span",fe,"Seleccionar rango"))]),_:1})]),_:1}),s(e(Q),{class:"w-auto p-0",align:"start"},{default:a(()=>[i("div",me,[i("div",null,[s(e(k),{class:"text-xs"},{default:a(()=>[...t[18]||(t[18]=[u("Desde",-1)])]),_:1}),i("input",{type:"date",value:o.value.fecha_inicio||"",onInput:t[6]||(t[6]=n=>_("fecha_inicio",n.target.value)),class:"w-full mt-1 px-3 py-2 border rounded-md text-sm"},null,40,_e)]),i("div",null,[s(e(k),{class:"text-xs"},{default:a(()=>[...t[19]||(t[19]=[u("Hasta",-1)])]),_:1}),i("input",{type:"date",value:o.value.fecha_fin||"",onInput:t[7]||(t[7]=n=>_("fecha_fin",n.target.value)),class:"w-full mt-1 px-3 py-2 border rounded-md text-sm"},null,40,pe)])])]),_:1})]),_:1}),o.value.fecha_inicio||o.value.fecha_fin?(l(),g(e(x),{key:0,variant:"ghost",size:"icon",onClick:t[8]||(t[8]=n=>{p("fecha_inicio"),p("fecha_fin")})},{default:a(()=>[s(e(M),{class:"h-4 w-4"})]),_:1})):y("",!0)])])])]}),_:1})]),_:1})):(l(),c("div",ve,[i("div",ge,[i("div",ye,[s(e(L),{class:"h-4 w-4"}),t[20]||(t[20]=i("h3",{class:"text-sm font-medium"},"Filtros",-1))]),b.value?(l(),g(e(x),{key:0,variant:"ghost",size:"sm",onClick:v},{default:a(()=>[s(e(M),{class:"h-4 w-4 mr-1"}),t[21]||(t[21]=u(" Limpiar ",-1))]),_:1})):y("",!0)]),t[22]||(t[22]=i("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},null,-1))]))}}),he={key:0,class:"space-y-4"},xe={class:"flex-1 min-w-0"},$e={class:"text-sm"},be={class:"font-medium"},ke={class:"flex items-center gap-2 mt-1"},we={class:"text-xs text-muted-foreground"},Me={key:0,class:"text-xs text-muted-foreground"},Ce={key:1,class:"text-center py-8"},He={class:"text-sm text-muted-foreground"},Fe={key:1},Ve={key:0,class:"space-y-4"},je={class:"flex-1 min-w-0"},Ae={class:"text-sm"},Ee={class:"font-medium"},Te={class:"flex items-center gap-2 mt-1"},ze={class:"text-xs text-muted-foreground"},De={key:0,class:"text-xs text-muted-foreground"},Pe={key:1,class:"text-center py-8"},Le={class:"text-sm text-muted-foreground"},Ye=X({__name:"ActivityLog",props:{activities:{},title:{default:"Historial de Actividad"},description:{default:"Registro completo de cambios y eventos"},emptyMessage:{default:"No hay actividad registrada"},showCard:{type:Boolean,default:!0}},setup(m){const F=o=>{try{const h=Z(o),_=new Date().getTime()-h.getTime(),p=Math.floor(_/6e4),v=Math.floor(_/36e5),b=Math.floor(_/864e5);return p<1?"Hace un momento":p<60?`Hace ${p} ${p===1?"minuto":"minutos"}`:v<24?`Hace ${v} ${v===1?"hora":"horas"}`:b<7?`Hace ${b} ${b===1?"día":"días"}`:q(h,"d 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:G})}catch{return o}},$=o=>o?o.split(" ").map(h=>h[0]).join("").toUpperCase().slice(0,2):"SI",V=o=>{if(!o)return"";const h=o.split("\\");return h[h.length-1]};return(o,h)=>m.showCard?(l(),g(e(O),{key:0},{default:a(()=>[s(e(N),null,{default:a(()=>[s(e(U),null,{default:a(()=>[u(r(m.title),1)]),_:1}),s(e(Y),null,{default:a(()=>[u(r(m.description),1)]),_:1})]),_:1}),s(e(R),null,{default:a(()=>[m.activities&&m.activities.length>0?(l(),c("div",he,[(l(!0),c(C,null,H(m.activities,d=>{var _;return l(),c("div",{key:d.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[s(e(S),{class:"h-8 w-8 flex-shrink-0"},{default:a(()=>{var p;return[(p=d.causer)!=null&&p.avatar?(l(),g(e(B),{key:0,src:d.causer.avatar},null,8,["src"])):y("",!0),s(e(I),null,{default:a(()=>{var v;return[u(r($(((v=d.causer)==null?void 0:v.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),i("div",xe,[i("p",$e,[i("span",be,r(((_=d.causer)==null?void 0:_.name)||"Sistema"),1),u(" "+r(d.description),1)]),i("div",ke,[i("p",we,r(F(d.created_at)),1),d.subject_type?(l(),c("span",Me," • "+r(V(d.subject_type)),1)):y("",!0)])])])}),128))])):(l(),c("div",Ce,[i("p",He,r(m.emptyMessage),1)]))]),_:1})]),_:1})):(l(),c("div",Fe,[m.activities&&m.activities.length>0?(l(),c("div",Ve,[(l(!0),c(C,null,H(m.activities,d=>{var _;return l(),c("div",{key:d.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[s(e(S),{class:"h-8 w-8 flex-shrink-0"},{default:a(()=>{var p;return[(p=d.causer)!=null&&p.avatar?(l(),g(e(B),{key:0,src:d.causer.avatar},null,8,["src"])):y("",!0),s(e(I),null,{default:a(()=>{var v;return[u(r($(((v=d.causer)==null?void 0:v.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),i("div",je,[i("p",Ae,[i("span",Ee,r(((_=d.causer)==null?void 0:_.name)||"Sistema"),1),u(" "+r(d.description),1)]),i("div",Te,[i("p",ze,r(F(d.created_at)),1),d.subject_type?(l(),c("span",De," • "+r(V(d.subject_type)),1)):y("",!0)])])])}),128))])):(l(),c("div",Pe,[i("p",Le,r(m.emptyMessage),1)]))]))}});export{We as _,Ye as a};
