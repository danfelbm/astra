import{_ as O,a as Q,b as G,c as H,d as J,e as K}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BeE7juvx.js";import{_ as U}from"./createLucideIcon-B1k9xl0j.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-CV2X9-dW.js";import{_ as W}from"./Checkbox.vue_vue_type_script_setup_true_lang-jS18uQiG.js";import{_ as X,a as Y,b as Z,c as ee,d as ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-CcYNmYVt.js";import{d as se,c as te,r as p,m as I,b as $,e as o,w as c,f as n,u as s,g as l,h as y,t as d,n as le,i,F as P,k as T,j as b,a as N}from"./app-CP1YmMoZ.js";import{t as w}from"./index-S3BBeh0J.js";import{S as oe}from"./search-dyCwx1IB.js";import{L as j}from"./loader-circle-C7osYouZ.js";import{U as ne}from"./users-B5sI-BuP.js";import{C as ue}from"./chevron-left-DCaRm1vB.js";import{C as de}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BQUhOSPN.js";const ie={class:"space-y-4"},re={class:"text-sm font-medium"},ce={class:"relative"},me={class:"border rounded-lg"},ve={class:"max-h-96 overflow-y-auto p-4"},pe={key:0,class:"flex items-center justify-center py-8"},fe={key:1,class:"space-y-2"},_e=["for"],he={class:"font-medium"},ge={class:"text-sm text-muted-foreground space-y-1"},xe={class:"flex gap-3"},ye={key:0},be={key:1},ke={key:2,class:"text-center py-8"},$e={class:"text-muted-foreground"},Ve={key:0,class:"border-t px-4 py-3"},Ue={class:"flex items-center justify-between"},we={class:"text-sm text-muted-foreground"},Ce={key:0},Ee={class:"flex gap-2"},Se={class:"flex items-center justify-between w-full"},Be={class:"text-sm text-muted-foreground"},Fe={key:0,class:"font-medium text-foreground"},Pe={key:1},Te={class:"flex gap-2"},Me={key:1},He=se({__name:"AddUsersModal",props:{modelValue:{type:Boolean},title:{default:"Añadir Usuarios"},description:{default:"Selecciona los usuarios que deseas añadir"},searchEndpoint:{},addEndpoint:{},excludedIds:{},extraFields:{},maxSelection:{},submitButtonText:{default:"Añadir"},searchPlaceholder:{default:"Buscar por nombre, email, documento o teléfono..."},emptyMessage:{default:"Escribe para buscar usuarios disponibles"},noResultsMessage:{default:"No se encontraron usuarios con esa búsqueda"}},emits:["update:modelValue","submit"],setup(z,{emit:D}){const m=z,C=D,_=te({get:()=>m.modelValue,set:a=>C("update:modelValue",a)}),g=p(""),h=p([]),u=p([]),E=p(!1),V=p(!1),S=p(!1),v=p(1),x=p(1),k=p(0),f=p({});m.extraFields&&m.extraFields.forEach(a=>{f.value[a.name]=a.value});const B=async(a=1)=>{E.value=!0;try{const t={page:a,search:g.value};m.excludedIds&&m.excludedIds.length>0&&(t.excluded_ids=m.excludedIds);const e=await N.get(m.searchEndpoint,{params:t});if(e.data.participantes_disponibles){const r=e.data.participantes_disponibles;h.value=r.data||[],v.value=r.current_page||1,x.value=r.last_page||1,k.value=r.total||0}else e.data.users?(h.value=e.data.users||[],v.value=e.data.current_page||1,x.value=e.data.last_page||1,k.value=e.data.total||0):(h.value=e.data.data||[],v.value=e.data.current_page||1,x.value=e.data.last_page||1,k.value=e.data.total||0)}catch(t){console.error("Error buscando usuarios:",t),w.error("Error al buscar usuarios",{description:"Por favor intenta nuevamente",duration:3e3}),h.value=[]}finally{E.value=!1}};let F=null;I(g,()=>{F&&clearTimeout(F),F=setTimeout(()=>{_.value&&(v.value=1,B(1))},500)}),I(_,a=>{a&&!S.value&&(S.value=!0,B(1)),a||(u.value=[],g.value="",h.value=[],v.value=1,S.value=!1)});const L=(a,t)=>{if(t){if(m.maxSelection&&u.value.length>=m.maxSelection){w.warning(`Máximo ${m.maxSelection} usuarios permitidos`);return}u.value.includes(a)||u.value.push(a)}else{const e=u.value.indexOf(a);e>-1&&u.value.splice(e,1)}},A=a=>u.value.includes(a),M=a=>{v.value=a,B(a)},R=async()=>{if(u.value.length!==0)if(m.addEndpoint){V.value=!0;try{const a={user_ids:u.value,...f.value};await N.post(m.addEndpoint,a),w.success(`${u.value.length} usuario(s) añadido(s) exitosamente`,{duration:2e3}),_.value=!1,C("submit",{userIds:u.value,extraData:f.value})}catch(a){console.error("Error añadiendo usuarios:",a),w.error("Error al añadir usuarios",{description:"Por favor intenta nuevamente",duration:3e3})}finally{V.value=!1}}else C("submit",{userIds:u.value,extraData:f.value}),_.value=!1};return(a,t)=>(o(),$(s(K),{open:_.value,"onUpdate:open":t[4]||(t[4]=e=>_.value=e)},{default:c(()=>[n(s(O),{class:"max-w-2xl"},{default:c(()=>[n(s(Q),null,{default:c(()=>[n(s(G),null,{default:c(()=>[y(d(a.title),1)]),_:1}),n(s(H),null,{default:c(()=>[y(d(a.description),1)]),_:1})]),_:1}),l("div",ie,[l("div",{class:le(["grid gap-4",a.extraFields&&a.extraFields.length>0?"md:grid-cols-2":""])},[(o(!0),i(P,null,T(a.extraFields,e=>(o(),i("div",{key:e.name},[l("label",re,d(e.label),1),e.type==="select"?(o(),$(s(X),{key:0,modelValue:f.value[e.name],"onUpdate:modelValue":r=>f.value[e.name]=r},{default:c(()=>[n(s(Y),null,{default:c(()=>[n(s(Z))]),_:1}),n(s(ee),null,{default:c(()=>[(o(!0),i(P,null,T(e.options,r=>(o(),$(s(ae),{key:r.value,value:r.value},{default:c(()=>[y(d(r.label),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):(o(),$(s(q),{key:1,modelValue:f.value[e.name],"onUpdate:modelValue":r=>f.value[e.name]=r,type:e.type,required:e.required},null,8,["modelValue","onUpdate:modelValue","type","required"]))]))),128)),l("div",null,[t[5]||(t[5]=l("label",{class:"text-sm font-medium"},"Buscar Usuarios",-1)),l("div",ce,[n(s(oe),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),n(s(q),{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),placeholder:a.searchPlaceholder,type:"text",class:"pl-10"},null,8,["modelValue","placeholder"])])])],2),l("div",me,[l("div",ve,[E.value?(o(),i("div",pe,[n(s(j),{class:"h-8 w-8 animate-spin text-muted-foreground"}),t[6]||(t[6]=l("span",{class:"ml-2 text-muted-foreground"},"Buscando usuarios...",-1))])):h.value.length>0?(o(),i("div",fe,[(o(!0),i(P,null,T(h.value,e=>(o(),i("div",{key:e.id,class:"flex items-start space-x-3 py-2 hover:bg-gray-50 rounded px-2"},[n(s(W),{id:`user-${e.id}`,checked:A(e.id),"onUpdate:checked":r=>L(e.id,r),class:"mt-1"},null,8,["id","checked","onUpdate:checked"]),l("label",{for:`user-${e.id}`,class:"flex-1 cursor-pointer"},[l("div",he,d(e.name),1),l("div",ge,[l("div",null,d(e.email),1),l("div",xe,[e.documento_identidad?(o(),i("span",ye," Doc: "+d(e.documento_identidad),1)):b("",!0),e.telefono?(o(),i("span",be," Tel: "+d(e.telefono),1)):b("",!0)])])],8,_e)]))),128))])):(o(),i("div",ke,[n(s(ne),{class:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),l("p",$e,d(g.value?a.noResultsMessage:a.emptyMessage),1)]))]),x.value>1?(o(),i("div",Ve,[l("div",Ue,[l("span",we,[y(" Página "+d(v.value)+" de "+d(x.value)+" ",1),k.value>0?(o(),i("span",Ce," ("+d(k.value)+" usuarios disponibles) ",1)):b("",!0)]),l("div",Ee,[n(s(U),{variant:"outline",size:"sm",disabled:v.value===1,onClick:t[1]||(t[1]=e=>M(v.value-1))},{default:c(()=>[n(s(ue),{class:"h-4 w-4"})]),_:1},8,["disabled"]),n(s(U),{variant:"outline",size:"sm",disabled:v.value===x.value,onClick:t[2]||(t[2]=e=>M(v.value+1))},{default:c(()=>[n(s(de),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])])):b("",!0)])]),n(s(J),null,{default:c(()=>[l("div",Se,[l("span",Be,[u.value.length>0?(o(),i("span",Fe,d(u.value.length)+" usuario(s) seleccionado(s) ",1)):(o(),i("span",Pe," Selecciona usuarios para continuar "))]),l("div",Te,[n(s(U),{variant:"outline",onClick:t[3]||(t[3]=e=>_.value=!1)},{default:c(()=>[...t[7]||(t[7]=[y(" Cancelar ",-1)])]),_:1}),n(s(U),{onClick:R,disabled:u.value.length===0||V.value},{default:c(()=>[V.value?(o(),$(s(j),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):b("",!0),y(" "+d(a.submitButtonText)+" ",1),u.value.length>0?(o(),i("span",Me," ("+d(u.value.length)+") ",1)):b("",!0)]),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{He as _};
