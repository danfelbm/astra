import{d as Xe,k as H,c as q,w as oe,s as Qe,a as m,o as u,j as B,i as V,e as c,b as r,u as e,g as x,f as l,t as b,F as Y,r as Q,bT as aa,n as J,C as ta,v as ra,m as sa,h as ia,Z as oa,bQ as da,bG as na,Y as la}from"./app-CQ5Hqy3G.js";import{_ as se}from"./AppLogo.vue_vue_type_script_setup_true_lang-DO2zxUhg.js";import{r as X,_ as de,a as ne,j as ze,c as le,M as ie,C as Re,U as ua,af as U,b as Me,d as ca,e as fa,f as ma,g as ga,h as _a,i as pa,ag as va}from"./AppLayout.vue_vue_type_script_setup_true_lang-BdUd6Ihc.js";import{_ as ba}from"./Checkbox.vue_vue_type_script_setup_true_lang-Djh33fvS.js";import{_ as te,a as fe}from"./Label.vue_vue_type_script_setup_true_lang-nTjvYCo7.js";import{_ as ya}from"./Textarea.vue_vue_type_script_setup_true_lang-BFdsSVDb.js";import{u as ha,a as xa,_ as ka,b as Sa,c as wa,d as $a}from"./useConditionalFields-CdxqfOLo.js";import{_ as Ge}from"./CardDescription.vue_vue_type_script_setup_true_lang-BrU6Rg_e.js";import{_ as Ca,a as We}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-C1AbhAkk.js";import{a as me,_ as ge}from"./index-B_TYsn6a.js";import{_ as _e}from"./AlertTitle.vue_vue_type_script_setup_true_lang-Doo9hqvW.js";import{A as Ea}from"./arrow-left-C58VVzG9.js";import{C as pe}from"./clock-VhpxDtUn.js";import{C as Ta}from"./circle-check-big-B_sesdYY.js";import{U as Va}from"./user-CYmcZ6-_.js";import{S as Ye}from"./save-Cn4sDobY.js";import"./index-DmV6TRR9.js";import"./VisuallyHidden-QrAUFbwX.js";import"./upload-DuA1V8XZ.js";import"./eye-D9z8abqM.js";import"./download-DoTgB9wQ.js";import"./plus-BPmDrOGQ.js";import"./grip-vertical-DJH9KJsq.js";import"./trash-2-DPuznKm9.js";import"./RovingFocusItem-DOLA1N6v.js";import"./VisuallyHiddenInput-BUKG21q6.js";const Aa={class:"space-y-4"},ja={key:1,class:"text-center py-8"},Ua={key:3,class:"space-y-6"},Oa={key:0},Fa={class:"text-sm font-medium text-muted-foreground mb-3"},qa={class:"space-y-3"},Ia={class:"flex items-start gap-3"},Na={class:"flex-1"},Da={class:"flex items-center justify-between"},Ba={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Pa={class:"flex items-center gap-2 text-muted-foreground"},La={class:"flex items-center gap-2 text-muted-foreground"},za={class:"flex items-center gap-2 text-muted-foreground"},Ra={key:0,class:"flex items-center gap-2 text-muted-foreground"},Ma={class:"mt-3 text-xs text-muted-foreground"},Ga={key:1},Wa={class:"text-sm font-medium text-muted-foreground mb-3"},Ya={class:"space-y-3"},Ja={class:"flex items-start gap-3"},Ka={class:"flex-1"},Ha={class:"flex items-center justify-between"},Xa={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Qa={class:"flex items-center gap-2 text-muted-foreground"},Za={class:"flex items-center gap-2 text-muted-foreground"},et={class:"flex items-center gap-2 text-muted-foreground"},at={class:"mt-3 text-xs text-muted-foreground"},tt={key:5,class:"mt-4 p-3 bg-muted/50 rounded-lg"},rt={class:"text-sm text-muted-foreground"},st=Xe({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(s,{emit:i}){const $=s,A=i,w=H([]),E=H(!1),j=H(null),t=H($.modelValue),y=async()=>{E.value=!0,j.value=null;try{const h=await aa.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:$.filtrarPorUbicacion,incluir_futuras:!0}});w.value=h.data}catch(h){j.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",h)}finally{E.value=!1}},T=q(()=>{const h={abiertas:[],futuras:[]};return w.value.forEach(_=>{_.estado_temporal==="abierta"?h.abiertas.push(_):_.estado_temporal==="futura"&&h.futuras.push(_)}),h}),M=q(()=>w.value.find(h=>h.id===t.value));oe(t,h=>{A("update:modelValue",h)}),oe(()=>$.modelValue,h=>{t.value=h});const I=h=>new Date(h).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=h=>{switch(h){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},O=h=>{switch(h){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Qe(()=>{y()}),(h,_)=>(u(),m("div",Aa,[h.showPostulacionWarning&&t.value?(u(),B(e(ge),{key:0,class:"border-blue-200 bg-blue-50"},{default:c(()=>[r(e(X),{class:"h-4 w-4 text-blue-600"}),r(e(_e),{class:"text-blue-800"},{default:c(()=>_[1]||(_[1]=[x("Postulación Automática")])),_:1}),r(e(me),{class:"text-blue-700"},{default:c(()=>_[2]||(_[2]=[x(' Al enviar este formulario de candidatura, se creará automáticamente una postulación a la convocatoria seleccionada, la cual quedará en estado "Enviada" para revisión administrativa. ')])),_:1})]),_:1})):V("",!0),E.value?(u(),m("div",ja,_[3]||(_[3]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),l("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):j.value?(u(),B(e(ge),{key:2,variant:"destructive"},{default:c(()=>[r(e(X),{class:"h-4 w-4"}),r(e(_e),null,{default:c(()=>_[4]||(_[4]=[x("Error")])),_:1}),r(e(me),null,{default:c(()=>[x(b(j.value),1)]),_:1})]),_:1})):w.value.length>0?(u(),m("div",Ua,[r(e(Ca),{modelValue:t.value,"onUpdate:modelValue":_[0]||(_[0]=g=>t.value=g),disabled:h.disabled},{default:c(()=>[T.value.abiertas.length>0?(u(),m("div",Oa,[l("h4",Fa," Convocatorias Abiertas ("+b(T.value.abiertas.length)+") ",1),l("div",qa,[(u(!0),m(Y,null,Q(T.value.abiertas,g=>(u(),B(e(de),{key:g.id,class:J(["cursor-pointer hover:shadow-md transition-shadow",{"ring-2 ring-primary":t.value===g.id}])},{default:c(()=>[r(e(ne),{class:"pb-3"},{default:c(()=>[l("div",Ia,[r(e(We),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),l("div",Na,[l("div",Da,[r(e(te),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[x(b(g.nombre),1)]),_:2},1032,["for"]),r(e(ze),{class:J(P(g.estado_temporal))},{default:c(()=>[x(b(O(g.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(Ge),{class:"mt-1"},{default:c(()=>[x(b(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(le),{class:"pt-0"},{default:c(()=>[l("div",Ba,[l("div",Pa,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.cargo.nombre),1)]),l("div",La,[r(e(Re),{class:"h-4 w-4"}),l("span",null,b(g.periodo_electoral.nombre),1)]),l("div",za,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.ubicacion),1)]),g.numero_postulaciones!==void 0?(u(),m("div",Ra,[r(e(ua),{class:"h-4 w-4"}),l("span",null,b(g.numero_postulaciones)+" postulaciones",1)])):V("",!0)]),l("div",Ma,[_[5]||(_[5]=l("span",{class:"font-medium"},"Cierre:",-1)),x(" "+b(I(g.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0),T.value.futuras.length>0?(u(),m("div",Ga,[l("h4",Wa," Próximas Convocatorias ("+b(T.value.futuras.length)+") ",1),l("div",Ya,[(u(!0),m(Y,null,Q(T.value.futuras,g=>(u(),B(e(de),{key:g.id,class:J(["cursor-pointer hover:shadow-md transition-shadow opacity-90",{"ring-2 ring-primary":t.value===g.id}])},{default:c(()=>[r(e(ne),{class:"pb-3"},{default:c(()=>[l("div",Ja,[r(e(We),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),l("div",Ka,[l("div",Ha,[r(e(te),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[x(b(g.nombre),1)]),_:2},1032,["for"]),r(e(ze),{class:J(P(g.estado_temporal))},{default:c(()=>[x(b(O(g.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(Ge),{class:"mt-1"},{default:c(()=>[x(b(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(le),{class:"pt-0"},{default:c(()=>[l("div",Xa,[l("div",Qa,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.cargo.nombre),1)]),l("div",Za,[r(e(Re),{class:"h-4 w-4"}),l("span",null,b(g.periodo_electoral.nombre),1)]),l("div",et,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(g.ubicacion),1)])]),l("div",at,[_[6]||(_[6]=l("span",{class:"font-medium"},"Apertura:",-1)),x(" "+b(I(g.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),B(e(ge),{key:4},{default:c(()=>[r(e(X),{class:"h-4 w-4"}),r(e(_e),null,{default:c(()=>_[7]||(_[7]=[x("Sin convocatorias disponibles")])),_:1}),r(e(me),null,{default:c(()=>_[8]||(_[8]=[x(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),M.value&&!h.disabled?(u(),m("div",tt,[_[9]||(_[9]=l("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),l("p",rt,b(M.value.nombre),1)])):V("",!0)]))}});var it=typeof global=="object"&&global&&global.Object===Object&&global,ot=typeof self=="object"&&self&&self.Object===Object&&self,Ze=it||ot||Function("return this")(),ue=Ze.Symbol,ea=Object.prototype,dt=ea.hasOwnProperty,nt=ea.toString,ae=ue?ue.toStringTag:void 0;function lt(s){var i=dt.call(s,ae),$=s[ae];try{s[ae]=void 0;var A=!0}catch{}var w=nt.call(s);return A&&(i?s[ae]=$:delete s[ae]),w}var ut=Object.prototype,ct=ut.toString;function ft(s){return ct.call(s)}var mt="[object Null]",gt="[object Undefined]",Je=ue?ue.toStringTag:void 0;function _t(s){return s==null?s===void 0?gt:mt:Je&&Je in Object(s)?lt(s):ft(s)}function pt(s){return s!=null&&typeof s=="object"}var vt="[object Symbol]";function bt(s){return typeof s=="symbol"||pt(s)&&_t(s)==vt}var yt=/\s/;function ht(s){for(var i=s.length;i--&&yt.test(s.charAt(i)););return i}var xt=/^\s+/;function kt(s){return s&&s.slice(0,ht(s)+1).replace(xt,"")}function be(s){var i=typeof s;return s!=null&&(i=="object"||i=="function")}var Ke=NaN,St=/^[-+]0x[0-9a-f]+$/i,wt=/^0b[01]+$/i,$t=/^0o[0-7]+$/i,Ct=parseInt;function He(s){if(typeof s=="number")return s;if(bt(s))return Ke;if(be(s)){var i=typeof s.valueOf=="function"?s.valueOf():s;s=be(i)?i+"":i}if(typeof s!="string")return s===0?s:+s;s=kt(s);var $=wt.test(s);return $||$t.test(s)?Ct(s.slice(2),$?2:8):St.test(s)?Ke:+s}var ve=function(){return Ze.Date.now()},Et="Expected a function",Tt=Math.max,Vt=Math.min;function At(s,i,$){var A,w,E,j,t,y,T=0,M=!1,I=!1,P=!0;if(typeof s!="function")throw new TypeError(Et);i=He(i)||0,be($)&&(M=!!$.leading,I="maxWait"in $,E=I?Tt(He($.maxWait)||0,i):E,P="trailing"in $?!!$.trailing:P);function O(S){var D=A,v=w;return A=w=void 0,T=S,j=s.apply(v,D),j}function h(S){return T=S,t=setTimeout(L,i),M?O(S):j}function _(S){var D=S-y,v=S-T,C=i-D;return I?Vt(C,E-v):C}function g(S){var D=S-y,v=S-T;return y===void 0||D>=i||D<0||I&&v>=E}function L(){var S=ve();if(g(S))return W(S);t=setTimeout(L,_(S))}function W(S){return t=void 0,P&&A?O(S):(A=w=void 0,j)}function Z(){t!==void 0&&clearTimeout(t),T=0,A=y=w=t=void 0}function K(){return t===void 0?j:W(ve())}function N(){var S=ve(),D=g(S);if(A=arguments,w=this,y=S,D){if(t===void 0)return h(y);if(I)return clearTimeout(t),t=setTimeout(L,i),O(y)}return t===void 0&&(t=setTimeout(L,i)),j}return N.cancel=Z,N.flush=K,N}function jt(s,i){const{url:$,candidaturaId:A=null,debounceTime:w=3e3,showNotifications:E=!0,useLocalStorage:j=!0,localStorageKey:t="candidatura_draft"}=i,y=H({status:"idle",lastSaved:null,lastError:null,candidaturaId:A}),T=q(()=>y.value.status==="saving"),M=q(()=>y.value.lastSaved!==null),I=q(()=>y.value.status==="error"),P=()=>{if(j)try{const v={formulario_data:s.value,timestamp:new Date().toISOString(),candidaturaId:y.value.candidaturaId};localStorage.setItem(t,JSON.stringify(v))}catch(v){console.error("Error guardando en localStorage:",v)}},O=()=>{if(!j)return null;try{const v=localStorage.getItem(t);if(v){const C=JSON.parse(v),z=new Date(C.timestamp);if((Date.now()-z.getTime())/(1e3*60*60)<24)return C;localStorage.removeItem(t)}}catch(v){console.error("Error cargando desde localStorage:",v)}return null},h=()=>{j&&localStorage.removeItem(t)},_=async()=>{try{const v=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(v.ok){const C=await v.text(),F=new DOMParser().parseFromString(C,"text/html").querySelector('meta[name="csrf-token"]');if(F){const ee=F.getAttribute("content"),G=document.querySelector('meta[name="csrf-token"]');if(G&&ee)return G.setAttribute("content",ee),ee}}}catch(v){console.error("Error renovando token CSRF:",v)}return null},g=async(v,C,z=0)=>{const R=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":C,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:s.value})});if(R.status===419&&z<1){const F=await _();if(F)return E&&U.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),g(v,F,z+1)}return R},L=async()=>{var v;if(y.value.status!=="saving"&&!(!s.value||Object.keys(s.value).length===0)){y.value.status="saving",y.value.lastError=null;try{const C=y.value.candidaturaId?$.replace("autosave",`${y.value.candidaturaId}/autosave`):$,z=((v=document.querySelector('meta[name="csrf-token"]'))==null?void 0:v.getAttribute("content"))||"";if(!z)throw new Error("Token CSRF no encontrado");const R=await g(C,z);if(!R.ok)throw new Error(`Error ${R.status}: ${R.statusText}`);const F=await R.json();if(F.success)y.value.status="saved",y.value.lastSaved=new Date,!y.value.candidaturaId&&F.candidatura_id&&(y.value.candidaturaId=F.candidatura_id),P(),E&&U.success("Cambios guardados",{description:`Autoguardado a las ${F.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(F.message||"Error al guardar")}catch(C){y.value.status="error",y.value.lastError=C instanceof Error?C.message:"Error desconocido",P(),C instanceof Error&&C.message.includes("419")?E&&U.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):E&&U.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",C)}}},W=At(L,w),Z=()=>(W.cancel(),L()),K=()=>oe(s,()=>{y.value.status!=="error"&&W()},{deep:!0}),N=()=>{W.cancel()},S=()=>{N(),y.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:A},h()},D=()=>{const v=O();return v&&v.formulario_data?(E&&U.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),v):null};return{state:q(()=>y.value),isSaving:T,hasSaved:M,hasError:I,saveNow:Z,startWatching:K,stopAutoSave:N,reset:S,restoreDraft:D,clearLocalStorage:h}}const Ut={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ot={class:"flex items-center justify-between"},Ft={class:"text-3xl font-bold"},qt={class:"text-muted-foreground"},It={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Nt={key:0,class:"flex items-center gap-1.5"},Dt={key:1,class:"flex items-center gap-1.5"},Bt={key:2,class:"flex items-center gap-1.5 text-amber-600"},Pt={key:3,class:"flex items-center gap-1.5"},Lt={class:"text-blue-700 dark:text-blue-300"},zt={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Rt={class:"flex items-start gap-3"},Mt={class:"text-sm text-blue-800"},Gt={key:0,class:"mt-1 text-blue-600"},Wt={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},Yt={class:"flex items-start gap-3"},Jt={key:0,class:"text-red-500"},Kt={key:0,class:"text-sm text-muted-foreground"},Ht={key:6,class:"space-y-2"},Xt=["id","name","value","onUpdate:modelValue"],Qt={key:7,class:"space-y-2"},Zt={key:8},er={key:9},ar={key:0,class:"text-red-500 text-sm mt-1"},tr={key:10},rr={key:11},sr={key:12},ir={key:13,class:"text-sm text-destructive"},or={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},dr={class:"text-red-800 text-sm"},nr={class:"flex justify-between pt-6"},lr={key:0,class:"fixed bottom-12 right-80 z-50"},ur=Xe({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(s){var ye,he;const i=s,$=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:i.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:A}=ha(),w=H({}),E=q(()=>{var k;if(!i.is_editing||!((k=i.candidatura)!=null&&k.formulario_data))return!1;const n=Object.keys(i.candidatura.formulario_data),d=i.configuracion_campos.map(a=>a.id),o=n.some(a=>!d.includes(a)),p=i.configuracion_campos.some(a=>a.required&&!i.candidatura.formulario_data[a.id]);return o||p}),t=ta((()=>{var d;const n={};return i.configuracion_campos.forEach(o=>{o.type==="checkbox"?n[o.id]=[]:o.type==="file"?n[o.id]=[]:o.type==="convocatoria"?n[o.id]=void 0:o.type==="disclaimer"?n[o.id]=null:o.type==="repeater"?n[o.id]=[]:o.type==="datepicker"?n[o.id]=null:n[o.id]=""}),(d=i.candidatura)!=null&&d.formulario_data&&(Object.assign(n,i.candidatura.formulario_data),i.configuracion_campos.forEach(o=>{o.type==="file"&&n[o.id]&&(Array.isArray(n[o.id])||(n[o.id]=[n[o.id]]))})),{formulario_data:n}})()),y=H(i.configuracion_campos),T=q(()=>t.formulario_data),{visibleFields:M,clearHiddenFieldValues:I}=xa(y,T);oe(M,()=>{I()});const{state:P,isSaving:O,hasSaved:h,hasError:_,saveNow:g,startWatching:L,stopAutoSave:W,restoreDraft:Z,clearLocalStorage:K}=jt(T,{url:"/candidaturas/autosave",candidaturaId:((ye=i.candidatura)==null?void 0:ye.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((he=i.candidatura)==null?void 0:he.id)||"new"}`});let N=null;Qe(()=>{const n=["borrador","rechazado"];if(!i.candidatura||n.includes(i.candidatura.estado)){if(!i.is_editing){const o=Z();o&&o.formulario_data&&(U.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{K(),t.reset(),U.success("Borrador descartado")}},duration:5e3}),Object.assign(t.formulario_data,o.formulario_data))}N=L()}}),ra(()=>{N&&N(),W()});const S=async()=>{if(O.value){U.warning("Ya se está guardando...");return}await g(),_.value||U.success("Borrador guardado manualmente")},D=q(()=>z.value.map(o=>{var a;if(!o.required)return{campo:o.id,valid:!0};const p=t.formulario_data[o.id];let k=!1;if(o.type==="checkbox")k=Array.isArray(p)&&p.length>0;else if(o.type==="file")(Array.isArray(p)&&p.length>0||w.value[o.id]&&w.value[o.id].length>0)&&(k=!0);else if(o.type==="convocatoria")k=p!=null&&p!=="";else if(o.type==="disclaimer")k=p&&p.accepted===!0;else if(o.type==="repeater"){const re=((a=o.repeaterConfig)==null?void 0:a.minItems)||0;k=Array.isArray(p)&&p.length>=re}else o.type==="datepicker"?k=p!=null&&p!=="":k=p&&p.toString().trim()!=="";return!k&&o.required,{campo:o.id,valid:k}}).every(o=>o.valid)),v=q(()=>i.is_editing?"Editar Candidatura":"Crear Candidatura"),C=q(()=>{var n,d;return t.processing?"Guardando...":i.is_editing?((n=i.candidatura)==null?void 0:n.estado)==="rechazado"?"Reenviar Candidatura":((d=i.candidatura)==null?void 0:d.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),z=q(()=>{var d;let n=[...M.value];return i.is_editing&&i.candidatura&&["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=n.filter(p=>p.type!=="convocatoria")),i.is_editing&&((d=i.candidatura)==null?void 0:d.estado)==="aprobado"&&(n=n.filter(o=>o.editable===!0)),n}),R=q(()=>{var o;if(!i.is_editing||!i.candidatura)return!1;let n=!1;if(["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=i.configuracion_campos.some(p=>p.type==="convocatoria")),((o=i.candidatura)==null?void 0:o.estado)==="aprobado"){const p=i.configuracion_campos.some(k=>!k.editable&&k.type!=="convocatoria");return n||p}return n}),F=async(n,d)=>{if(w.value[n]=d,d&&d.length>0)try{U.info("Subiendo archivos...",{duration:2e3});const p=(await A(d,{module:"candidaturas",fieldId:n})).map(k=>k.path);Array.isArray(t.formulario_data[n]),t.formulario_data[n]=p,w.value[n]=[],U.success("Archivos subidos correctamente",{duration:2e3})}catch(o){console.error("Error al subir archivos:",o),U.error("Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else t.formulario_data[n]=[]},ee=async()=>{for(const[d,o]of Object.entries(w.value))if(o&&o.length>0)try{U.info("Subiendo archivos pendientes...",{duration:2e3});const p=await A(o,{module:"candidaturas",fieldId:d});t.formulario_data[d]=p.map(k=>k.path),w.value[d]=[]}catch(p){console.error("Error al subir archivos:",p),U.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const n={...t.formulario_data};i.configuracion_campos.forEach(d=>{const o=n[d.id];d.required||(o===""||o===void 0||Array.isArray(o)&&o.length===0&&d.type!=="checkbox"&&d.type!=="file")&&(n[d.id]=null)}),t.formulario_data=n,W(),i.is_editing?t.put(`/candidaturas/${i.candidatura.id}`,{onSuccess:()=>{K(),U.success("Candidatura actualizada exitosamente")},onError:d=>{console.error("Errores de validación:",d),(!i.candidatura||["borrador","rechazado"].includes(i.candidatura.estado))&&(N=L())}}):t.post("/candidaturas",{onSuccess:()=>{K(),U.success("Candidatura creada exitosamente")},onError:d=>{console.error("Errores de validación:",d),N=L()}})},G=n=>!!t.errors[`formulario_data.${n}`];return(n,d)=>(u(),m(Y,null,[r(e(sa),{title:v.value},null,8,["title"]),r(pa,{breadcrumbs:$},{default:c(()=>{var o,p;return[l("div",Ut,[l("div",Ot,[l("div",null,[l("h1",Ft,b(v.value),1),l("p",qt,b(n.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),r(e(se),{variant:"outline",onClick:d[0]||(d[0]=k=>n.$inertia.visit("/candidaturas"))},{default:c(()=>[r(e(Ea),{class:"mr-2 h-4 w-4"}),d[2]||(d[2]=x(" Volver "))]),_:1})]),!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)?(u(),m("div",It,[e(O)?(u(),m("div",Nt,[r(e(pe),{class:"h-4 w-4 animate-spin"}),d[3]||(d[3]=l("span",null,"Guardando automáticamente...",-1))])):e(h)&&!e(_)?(u(),m("div",Dt,[r(e(Ta),{class:"h-4 w-4 text-green-600"}),l("span",null,"Guardado automáticamente a las "+b((o=e(P).lastSaved)==null?void 0:o.toLocaleTimeString()),1)])):e(_)?(u(),m("div",Bt,[r(e(X),{class:"h-4 w-4"}),d[4]||(d[4]=l("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),m("div",Pt,[r(e(pe),{class:"h-4 w-4"}),d[5]||(d[5]=l("span",null,"Autoguardado activado",-1))]))])):V("",!0),n.is_editing&&((p=n.candidatura)!=null&&p.comentarios_admin)?(u(),B(e(de),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:c(()=>[r(e(ne),null,{default:c(()=>[r(e(Me),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:c(()=>[r(e(X),{class:"h-5 w-5"}),d[6]||(d[6]=x(" Comentarios de la comisión "))]),_:1})]),_:1}),r(e(le),null,{default:c(()=>[l("p",Lt,b(n.candidatura.comentarios_admin),1)]),_:1})]),_:1})):V("",!0),r(e(de),null,{default:c(()=>[r(e(ne),null,{default:c(()=>[r(e(Me),{class:"flex items-center gap-2"},{default:c(()=>[r(e(Va),{class:"h-5 w-5"}),d[7]||(d[7]=x(" Información de Candidatura "))]),_:1})]),_:1}),r(e(le),null,{default:c(()=>{var k;return[l("form",{onSubmit:ia(ee,["prevent"]),class:"space-y-6"},[n.is_editing&&((k=n.candidatura)==null?void 0:k.estado)==="aprobado"?(u(),m("div",zt,[l("div",Rt,[r(e(X),{class:"h-5 w-5 text-blue-600 mt-0.5"}),l("div",Mt,[d[8]||(d[8]=l("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),d[9]||(d[9]=l("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),R.value?(u(),m("p",Gt," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):V("",!0)])])])):V("",!0),E.value?(u(),m("div",Wt,[l("div",Yt,[r(e(X),{class:"h-5 w-5 text-amber-600 mt-0.5"}),d[10]||(d[10]=l("div",{class:"text-sm text-amber-800"},[l("p",{class:"font-medium"},"Formulario Actualizado"),l("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):V("",!0),r(oa,{name:"fade-field",tag:"div",class:"space-y-6"},{default:c(()=>[(u(!0),m(Y,null,Q(z.value,a=>{var re,xe,ke,Se,we,$e,Ce,Ee,Te,Ve,Ae,je,Ue,Oe,Fe,qe,Ie,Ne,De,Be,Pe;return u(),m("div",{key:a.id,class:"space-y-2"},[r(e(te),{for:a.id,class:"flex items-center gap-1"},{default:c(()=>[x(b(a.title)+" ",1),a.required?(u(),m("span",Jt,"*")):V("",!0)]),_:2},1032,["for"]),a.description?(u(),m("p",Kt,b(a.description),1)):V("",!0),a.type==="text"||a.type==="email"?(u(),B(e(fe),{key:1,id:a.id,type:a.type,modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,placeholder:a.placeholder||"",class:J({"border-destructive":G(a.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="textarea"?(u(),B(e(ya),{key:2,id:a.id,modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,placeholder:a.placeholder||"",rows:4,class:J({"border-destructive":G(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="number"?(u(),B(e(fe),{key:3,id:a.id,type:"number",modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,placeholder:a.placeholder||"",class:J({"border-destructive":G(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="date"?(u(),B(e(fe),{key:4,id:a.id,type:"date",modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,class:J({"border-destructive":G(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):a.type==="select"?(u(),B(e(ca),{key:5,modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f},{default:c(()=>[r(e(fa),{class:J({"border-destructive":G(a.id)})},{default:c(()=>[r(e(ma),{placeholder:a.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),r(e(ga),null,{default:c(()=>[(u(!0),m(Y,null,Q(a.options,f=>(u(),B(e(_a),{key:f,value:f},{default:c(()=>[x(b(f),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):a.type==="radio"?(u(),m("div",Ht,[(u(!0),m(Y,null,Q(a.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[da(l("input",{id:`${a.id}_${f}`,name:a.id,type:"radio",value:f,"onUpdate:modelValue":ce=>e(t).formulario_data[a.id]=ce,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Xt),[[na,e(t).formulario_data[a.id]]]),r(e(te),{for:`${a.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[x(b(f),1)]),_:2},1032,["for"])]))),128))])):a.type==="checkbox"?(u(),m("div",Qt,[(u(!0),m(Y,null,Q(a.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[r(e(ba),{id:`${a.id}_${f}`,checked:e(t).formulario_data[a.id].includes(f),"onUpdate:checked":ce=>{if(ce)e(t).formulario_data[a.id].includes(f)||e(t).formulario_data[a.id].push(f);else{const Le=e(t).formulario_data[a.id].indexOf(f);Le>-1&&e(t).formulario_data[a.id].splice(Le,1)}}},null,8,["id","checked","onUpdate:checked"]),r(e(te),{for:`${a.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[x(b(f),1)]),_:2},1032,["for"])]))),128))])):a.type==="file"?(u(),m("div",Zt,[r(ka,{modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,onFilesSelected:f=>F(a.id,f),label:"",description:"",required:a.required,multiple:((re=a.fileConfig)==null?void 0:re.multiple)||!1,"max-files":((xe=a.fileConfig)==null?void 0:xe.maxFiles)||5,"max-file-size":((ke=a.fileConfig)==null?void 0:ke.maxFileSize)||10,accept:((Se=a.fileConfig)==null?void 0:Se.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(t).errors[`formulario_data.${a.id}`],disabled:e(t).processing,module:"candidaturas","field-id":a.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):a.type==="convocatoria"?(u(),m("div",er,[r(st,{modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,required:a.required,disabled:e(t).processing||n.is_editing&&((we=n.candidatura)==null?void 0:we.estado)!=="borrador","filtrar-por-ubicacion":(($e=a.convocatoriaConfig)==null?void 0:$e.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),G(a.id)?(u(),m("div",ar,b(e(t).errors[`formulario_data.${a.id}`]),1)):V("",!0)])):a.type==="datepicker"?(u(),m("div",tr,[r(Sa,{"model-value":e(t).formulario_data[a.id]||null,"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(t).processing,error:e(t).errors[`formulario_data.${a.id}`],"min-date":(Ce=a.datepickerConfig)==null?void 0:Ce.minDate,"max-date":(Ee=a.datepickerConfig)==null?void 0:Ee.maxDate,format:((Te=a.datepickerConfig)==null?void 0:Te.format)||"DD/MM/YYYY","allow-past-dates":((Ve=a.datepickerConfig)==null?void 0:Ve.allowPastDates)??!0,"allow-future-dates":((Ae=a.datepickerConfig)==null?void 0:Ae.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):a.type==="disclaimer"?(u(),m("div",rr,[r(wa,{"model-value":e(t).formulario_data[a.id]||null,"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(t).processing,error:e(t).errors[`formulario_data.${a.id}`],"disclaimer-text":((je=a.disclaimerConfig)==null?void 0:je.disclaimerText)||"","modal-title":((Ue=a.disclaimerConfig)==null?void 0:Ue.modalTitle)||"Términos y Condiciones","accept-button-text":((Oe=a.disclaimerConfig)==null?void 0:Oe.acceptButtonText)||"Acepto","decline-button-text":((Fe=a.disclaimerConfig)==null?void 0:Fe.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):a.type==="repeater"?(u(),m("div",sr,[r($a,{"model-value":e(t).formulario_data[a.id]||[],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(t).processing,error:e(t).errors[`formulario_data.${a.id}`],"min-items":((qe=a.repeaterConfig)==null?void 0:qe.minItems)||0,"max-items":((Ie=a.repeaterConfig)==null?void 0:Ie.maxItems)||10,"item-name":((Ne=a.repeaterConfig)==null?void 0:Ne.itemName)||"Elemento","add-button-text":((De=a.repeaterConfig)==null?void 0:De.addButtonText)||"Agregar elemento","remove-button-text":((Be=a.repeaterConfig)==null?void 0:Be.removeButtonText)||"Eliminar",fields:((Pe=a.repeaterConfig)==null?void 0:Pe.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):V("",!0),G(a.id)?(u(),m("p",ir,b(e(t).errors[`formulario_data.${a.id}`]),1)):V("",!0)])}),128))]),_:1}),e(t).errors.general?(u(),m("div",or,[l("p",dr,b(e(t).errors.general),1)])):V("",!0),l("div",nr,[r(e(se),{variant:"outline",type:"button",onClick:d[1]||(d[1]=a=>n.$inertia.visit("/candidaturas"))},{default:c(()=>d[11]||(d[11]=[x(" Cancelar ")])),_:1}),r(e(se),{type:"submit",disabled:!D.value||e(t).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400"},{default:c(()=>[r(e(Ye),{class:"mr-2 h-4 w-4"}),x(" "+b(C.value),1)]),_:1},8,["disabled"])])],32)]}),_:1})]),_:1})]),r(la,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:c(()=>[(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&!e(t).processing?(u(),m("div",lr,[r(e(se),{onClick:S,disabled:e(O),size:"lg",class:"shadow-lg hover:shadow-xl transition-shadow duration-200"},{default:c(()=>[e(O)?(u(),m(Y,{key:0},[r(e(pe),{class:"mr-2 h-5 w-5 animate-spin"}),d[12]||(d[12]=x(" Guardando... "))],64)):(u(),m(Y,{key:1},[r(e(Ye),{class:"mr-2 h-5 w-5"}),d[13]||(d[13]=x(" Guardar como borrador "))],64))]),_:1},8,["disabled"])])):V("",!0)]),_:1})]}),_:1})],64))}}),Nr=va(ur,[["__scopeId","data-v-9e52d48f"]]);export{Nr as default};
