import{d as se,r as R,c as V,p as Ne,i as f,e as a,g as l,b as A,j as h,w as s,f as e,h as n,t as v,n as S,F as K,k as H,x as qe,m as d,l as Te,u as Qe,q as Xe,s as Ke,a as He}from"./app-CIcuE56E.js";import{c as Je,_ as W}from"./createLucideIcon-CdUYcD1o.js";import{a as j,b as G,c as L,_ as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-CgX-NJiS.js";import{_ as O}from"./CardDescription.vue_vue_type_script_setup_true_lang-udy3EAmF.js";import{_ as I}from"./Input.vue_vue_type_script_setup_true_lang-CShnW6nj.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-DGMiBXqo.js";import{_ as Ye}from"./Textarea.vue_vue_type_script_setup_true_lang-C_t06qt3.js";import{_ as Le,a as Pe,b as je,c as Ge,d as We}from"./SelectValue.vue_vue_type_script_setup_true_lang-QHc75ruE.js";import{_ as N,a as T}from"./index-BPxTTh7P.js";import{_ as Y,a as q}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-BTTfD_xV.js";import{_ as Ze}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bb0ye_G3.js";import{_ as te}from"./index-DIn4rQoT.js";import{M as ee}from"./map-pin-DqREaWj1.js";import{S as ae}from"./shield-Dg0q3WaS.js";import{F as Z}from"./filter-B-f_uU_O.js";import{C as Me}from"./calendar-Cdg04Wl4.js";import{S as Be}from"./search-ZYOM1TGp.js";import{C as ea}from"./circle-check-Dzjjlq9P.js";import{U as M}from"./users-Dv4PfADe.js";import{I as X}from"./info-nbZLEkW9.js";import{C as Oe}from"./circle-alert-BiONDbyf.js";import{_ as aa}from"./Checkbox.vue_vue_type_script_setup_true_lang-IGtSXI8P.js";import{_ as ta,a as sa,b as la}from"./index-Di5fzw_s.js";import{_ as oa}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CFknFn9m.js";import{S as na}from"./square-check-big-C8sFbRnr.js";import{M as J}from"./message-square-Dba9Lr_A.js";import{_ as ia}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-MvPL-YlB.js";import{t as E}from"./index-DnC0IMNf.js";import{d as ra}from"./debounce-DVi05qcH.js";import{A as da}from"./arrow-left-CAuPKZLX.js";import{S as ua}from"./save-D19uNPNZ.js";import{M as ma}from"./mail-D33S6t7r.js";import{S as Ie}from"./send-bqREL6SY.js";import"./index-BgKm2T5e.js";import"./VisuallyHidden-CcTCNgEU.js";import"./check-B-Ov-yXN.js";import"./floating-ui.vue-C48tOG4J.js";import"./RovingFocusItem-C546Q2e5.js";import"./utils-DOVV_t7k.js";import"./VisuallyHiddenInput-BpHYR3dd.js";import"./circle-CHmERKrU.js";import"./useFlashMessages-DpsFm_CL.js";import"./index-B250FkFy.js";import"./x-CNguRlJ0.js";import"./user-B9sngBaC.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Df-DDrQV.js";import"./chevron-right-BWaDAISw.js";import"./house-Y887tQEu.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BovPigfo.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CvyX2iUF.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-DjXyH0DH.js";import"./chevrons-up-down-Djh8iZFY.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BdwzZaIx.js";import"./target-CRr5y7c4.js";import"./vote-DYetLuDy.js";import"./folder-open-Dk8PHrIL.js";import"./file-text-CXFkIWfL.js";import"./briefcase-fuXoLsil.js";import"./megaphone-Dt877yPb.js";import"./user-check-BKKK32tP.js";import"./clipboard-list-DU9F4t3E.js";import"./external-link-Dm5egPSa.js";import"./panel-left-C_XXmozK.js";import"./index-DQp1kWgI.js";import"./DialogTrigger-kD3_O5p5.js";import"./useKbd-kRIii9yh.js";import"./chevron-left-CKi_AKG4.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DHsq5noR.js";import"./es-SykclP7y.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-BNTQYPIy.js";import"./loader-circle-CzrLm2jS.js";import"./trash-2-_hiDJNZK.js";import"./plus-Dq_E_Oy4.js";import"./history-DHwW84SY.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Je("SquareXIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ca={class:"space-y-4"},fa={class:"flex justify-between items-center"},_a={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},ga={class:"flex items-center gap-2"},va={class:"flex items-center gap-2"},xa={class:"flex items-center gap-2"},ba={class:"flex items-center gap-2"},wa={class:"flex flex-col md:flex-row gap-4"},ha={class:"flex-1"},ya={class:"relative"},ka={class:"flex gap-2"},$a={class:"space-y-2 max-h-96 overflow-y-auto p-2"},Ca={class:"flex items-start justify-between"},Va={class:"flex-1"},Sa={class:"flex items-center gap-2"},Aa={class:"font-medium"},za={key:0,class:"text-sm text-muted-foreground mt-1"},Fa={class:"text-right"},Da={class:"text-2xl font-bold"},Ua={key:0,class:"text-center py-8 text-muted-foreground"},Ea={class:"space-y-3"},qa={class:"font-medium flex items-center gap-2"},La={key:0,class:"text-sm text-muted-foreground mt-1"},Pa={class:"flex items-center justify-between p-3 bg-muted rounded-md"},ja={class:"text-2xl font-bold"},Ga=se({__name:"SegmentSelector",props:{modelValue:{default:null},segments:{},required:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(z,{emit:c}){const y=z,B=c,o=R(y.modelValue),$=R(""),x=R("all"),k=V(()=>y.segments.find(u=>u.id===o.value)||null),D=V(()=>{let u=y.segments;if($.value){const r=$.value.toLowerCase();u=u.filter(g=>{var Q;return g.nombre.toLowerCase().includes(r)||((Q=g.descripcion)==null?void 0:Q.toLowerCase().includes(r))})}return x.value!=="all"&&(u=u.filter(r=>r.tipo===x.value)),u}),F=V(()=>{const u={total:y.segments.length,geografico:0,rol:0,personalizado:0,dinamico:0,totalUsuarios:0};return y.segments.forEach(r=>{u[r.tipo]++,u.totalUsuarios+=r.count||0}),u}),C=u=>{o.value=u;const r=y.segments.find(g=>g.id===u)||null;B("update:modelValue",u),B("change",r)},U=u=>({geografico:ee,rol:ae,personalizado:Z,dinamico:Me})[u]||M,w=u=>({geografico:"text-blue-600",rol:"text-purple-600",personalizado:"text-green-600",dinamico:"text-orange-600"})[u]||"text-gray-600",p=u=>({geografico:"Geográfico",rol:"Por Rol",personalizado:"Personalizado",dinamico:"Dinámico"})[u]||u,_=u=>u?u>=1e6?`${(u/1e6).toFixed(1)}M`:u>=1e3?`${(u/1e3).toFixed(1)}K`:u.toLocaleString():"0";return Ne(()=>y.modelValue,u=>{o.value=u}),(u,r)=>(d(),f("div",ca,[a(e(P),null,{default:s(()=>[a(e(j),null,{default:s(()=>[l("div",fa,[a(e(G),{class:"text-base"},{default:s(()=>[...r[6]||(r[6]=[n("Seleccionar Segmento",-1)])]),_:1}),a(e(te),{variant:"outline"},{default:s(()=>[n(v(F.value.total)+" segmentos disponibles ",1)]),_:1})])]),_:1}),a(e(L),null,{default:s(()=>[l("div",_a,[l("div",ga,[a(e(ee),{class:"w-4 h-4 text-blue-600"}),l("span",null,v(F.value.geografico)+" Geográficos",1)]),l("div",va,[a(e(ae),{class:"w-4 h-4 text-purple-600"}),l("span",null,v(F.value.rol)+" Por Rol",1)]),l("div",xa,[a(e(Z),{class:"w-4 h-4 text-green-600"}),l("span",null,v(F.value.personalizado)+" Personalizados",1)]),l("div",ba,[a(e(Me),{class:"w-4 h-4 text-orange-600"}),l("span",null,v(F.value.dinamico)+" Dinámicos",1)])])]),_:1})]),_:1}),l("div",wa,[l("div",ha,[l("div",ya,[a(e(Be),{class:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),a(e(I),{modelValue:$.value,"onUpdate:modelValue":r[0]||(r[0]=g=>$.value=g),placeholder:"Buscar segmento...",class:"pl-8"},null,8,["modelValue"])])]),l("div",ka,[a(e(W),{variant:"outline",size:"sm",class:S({"bg-accent":x.value==="all"}),onClick:r[1]||(r[1]=g=>x.value="all")},{default:s(()=>[...r[7]||(r[7]=[n(" Todos ",-1)])]),_:1},8,["class"]),a(e(W),{variant:"outline",size:"sm",class:S({"bg-accent":x.value==="geografico"}),onClick:r[2]||(r[2]=g=>x.value="geografico")},{default:s(()=>[a(e(ee),{class:"w-4 h-4 mr-1"}),r[8]||(r[8]=n(" Geográfico ",-1))]),_:1},8,["class"]),a(e(W),{variant:"outline",size:"sm",class:S({"bg-accent":x.value==="rol"}),onClick:r[3]||(r[3]=g=>x.value="rol")},{default:s(()=>[a(e(ae),{class:"w-4 h-4 mr-1"}),r[9]||(r[9]=n(" Rol ",-1))]),_:1},8,["class"]),a(e(W),{variant:"outline",size:"sm",class:S({"bg-accent":x.value==="personalizado"}),onClick:r[4]||(r[4]=g=>x.value="personalizado")},{default:s(()=>[a(e(Z),{class:"w-4 h-4 mr-1"}),r[10]||(r[10]=n(" Personalizado ",-1))]),_:1},8,["class"])])]),a(e(P),null,{default:s(()=>[a(e(L),{class:"p-2"},{default:s(()=>[a(e(Y),{modelValue:o.value,"onUpdate:modelValue":[r[5]||(r[5]=g=>o.value=g),C]},{default:s(()=>[l("div",$a,[(d(!0),f(K,null,H(D.value,g=>(d(),f("div",{key:g.id,class:S(["flex items-start space-x-3 p-3 rounded-lg border hover:bg-accent cursor-pointer",{"bg-accent border-primary":o.value===g.id}])},[a(e(q),{value:g.id,id:`segment-${g.id}`},null,8,["value","id"]),a(e(b),{for:`segment-${g.id}`,class:"flex-1 cursor-pointer"},{default:s(()=>[l("div",Ca,[l("div",Va,[l("div",Sa,[(d(),A(qe(U(g.tipo)),{class:S(["w-4 h-4",w(g.tipo)])},null,8,["class"])),l("span",Aa,v(g.nombre),1),a(e(te),{variant:"outline",class:"ml-2"},{default:s(()=>[n(v(p(g.tipo)),1)]),_:2},1024)]),g.descripcion?(d(),f("p",za,v(g.descripcion),1)):h("",!0)]),l("div",Fa,[l("p",Da,v(_(g.count)),1),r[11]||(r[11]=l("p",{class:"text-xs text-muted-foreground"},"usuarios",-1))])])]),_:2},1032,["for"])],2))),128)),D.value.length===0?(d(),f("div",Ua," No se encontraron segmentos ")):h("",!0)])]),_:1},8,["modelValue"])]),_:1})]),_:1}),z.showPreview&&k.value?(d(),A(e(P),{key:0},{default:s(()=>[a(e(j),null,{default:s(()=>[a(e(G),{class:"text-base flex items-center gap-2"},{default:s(()=>[a(e(ea),{class:"w-4 h-4 text-green-600"}),r[12]||(r[12]=n(" Segmento Seleccionado ",-1))]),_:1})]),_:1}),a(e(L),null,{default:s(()=>[l("div",Ea,[l("div",null,[l("h4",qa,[(d(),A(qe(U(k.value.tipo)),{class:S(["w-4 h-4",w(k.value.tipo)])},null,8,["class"])),n(" "+v(k.value.nombre),1)]),k.value.descripcion?(d(),f("p",La,v(k.value.descripcion),1)):h("",!0)]),l("div",Pa,[l("div",null,[r[13]||(r[13]=l("p",{class:"text-sm text-muted-foreground"},"Total de destinatarios",-1)),l("p",ja,v(_(k.value.count)),1)]),a(e(M),{class:"w-8 h-8 text-muted-foreground"})]),a(e(N),null,{default:s(()=>[a(e(X),{class:"h-4 w-4"}),a(e(T),null,{default:s(()=>[...r[14]||(r[14]=[n(" Los usuarios de este segmento recibirán la campaña según los criterios definidos. El número de destinatarios puede variar al momento del envío. ",-1)])]),_:1})]),_:1})])]),_:1})]),_:1})):h("",!0),z.required&&!o.value?(d(),A(e(N),{key:1,variant:"warning"},{default:s(()=>[a(e(Oe),{class:"h-4 w-4"}),a(e(T),null,{default:s(()=>[...r[15]||(r[15]=[n(" Debes seleccionar un segmento para continuar ",-1)])]),_:1})]),_:1})):h("",!0)]))}}),Wa={class:"space-y-4"},Ma={class:"flex flex-col sm:flex-row gap-2"},Ia={class:"relative flex-1"},Na={class:"flex gap-2"},Ta={key:0,class:"p-3 bg-muted rounded-md"},Ba={class:"flex items-center gap-2 text-sm"},Oa={class:"font-medium"},Ra={class:"font-medium"},Qa={class:"p-2 space-y-1"},Xa=["onClick"],Ka={class:"flex-1 min-w-0"},Ha={class:"flex items-center gap-2"},Ja={class:"font-medium truncate"},Ya={class:"flex items-center gap-2 text-sm text-muted-foreground"},Za={key:0,class:"text-center py-8 text-muted-foreground"},et={key:0},at={key:1},tt=se({__name:"WhatsAppGroupSelector",props:{grupos:{default:()=>[]},modelValue:{default:()=>[]}},emits:["update:modelValue"],setup(z,{emit:c}){const y=z,B=c,o=R(""),$=V({get:()=>y.modelValue,set:w=>B("update:modelValue",w)}),x=V(()=>{if(!o.value.trim())return y.grupos;const w=o.value.toLowerCase();return y.grupos.filter(p=>{var _;return p.nombre.toLowerCase().includes(w)||p.group_jid.toLowerCase().includes(w)||(((_=p.descripcion)==null?void 0:_.toLowerCase().includes(w))??!1)})}),k=w=>$.value.includes(w),D=w=>{const p=[...$.value],_=p.indexOf(w);_===-1?p.push(w):p.splice(_,1),$.value=p},F=()=>{const w=x.value.map(_=>_.id),p=[...new Set([...$.value,...w])];$.value=p},C=()=>{$.value=[]},U=V(()=>{const w=$.value.length;if(w===0)return null;const _=y.grupos.filter(u=>$.value.includes(u.id)).reduce((u,r)=>u+r.participantes_count,0);return{grupos:w,participantes:_}});return(w,p)=>(d(),f("div",Wa,[l("div",Ma,[l("div",Ia,[a(e(Be),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a(e(I),{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=_=>o.value=_),placeholder:"Buscar grupos...",class:"pl-10"},null,8,["modelValue"])]),l("div",Na,[a(e(W),{type:"button",variant:"outline",size:"sm",onClick:F},{default:s(()=>[a(e(na),{class:"h-4 w-4 mr-1"}),p[2]||(p[2]=n(" Todos ",-1))]),_:1}),a(e(W),{type:"button",variant:"outline",size:"sm",onClick:C},{default:s(()=>[a(e(pa),{class:"h-4 w-4 mr-1"}),p[3]||(p[3]=n(" Ninguno ",-1))]),_:1})])]),U.value?(d(),f("div",Ta,[l("div",Ba,[a(e(J),{class:"h-4 w-4"}),l("span",Oa,v(U.value.grupos)+" grupo(s)",1),p[4]||(p[4]=l("span",{class:"text-muted-foreground"},"seleccionados",-1)),p[5]||(p[5]=l("span",{class:"text-muted-foreground"},"·",-1)),a(e(M),{class:"h-4 w-4"}),l("span",Ra,v(U.value.participantes.toLocaleString()),1),p[6]||(p[6]=l("span",{class:"text-muted-foreground"},"participantes totales",-1))])])):h("",!0),a(e(oa),{class:"h-[300px] border rounded-md"},{default:s(()=>[l("div",Qa,[(d(!0),f(K,null,H(x.value,_=>(d(),f("div",{key:_.id,class:S(["flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors",k(_.id)?"bg-primary/10 border border-primary/20":"hover:bg-muted"]),onClick:u=>D(_.id)},[a(e(aa),{checked:k(_.id),"onUpdate:checked":u=>D(_.id),onClick:p[1]||(p[1]=Te(()=>{},["stop"]))},null,8,["checked","onUpdate:checked"]),a(e(ta),{class:"h-10 w-10"},{default:s(()=>[a(e(sa),{src:_.avatar_url||void 0},null,8,["src"]),a(e(la),null,{default:s(()=>[a(e(J),{class:"h-5 w-5"})]),_:1})]),_:2},1024),l("div",Ka,[l("div",Ha,[l("span",Ja,v(_.nombre),1),a(e(te),{variant:_.tipo==="comunidad"?"default":"secondary",class:"text-xs"},{default:s(()=>[n(v(_.tipo==="comunidad"?"COMUNIDAD":"GRUPO"),1)]),_:2},1032,["variant"])]),l("div",Ya,[a(e(M),{class:"h-3 w-3"}),l("span",null,v(_.participantes_count.toLocaleString())+" participantes",1)])])],10,Xa))),128)),x.value.length===0?(d(),f("div",Za,[a(e(J),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),o.value?(d(),f("p",et,"No se encontraron grupos que coincidan")):(d(),f("p",at,"No hay grupos disponibles"))])):h("",!0)])]),_:1}),p[7]||(p[7]=l("p",{class:"text-xs text-muted-foreground"}," Selecciona los grupos de WhatsApp a los que deseas enviar la campaña. Los mensajes a grupos no soportan personalización con variables. ",-1))]))}}),st={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},lt={class:"flex justify-between items-center"},ot={class:"text-3xl font-bold"},nt={class:"text-muted-foreground mt-1"},it={class:"flex gap-2"},rt={class:"list-disc pl-4"},dt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ut={class:"flex items-center space-x-2"},mt={class:"flex items-center space-x-2"},pt={class:"flex items-center space-x-2"},ct={class:"flex items-center space-x-2"},ft={class:"flex items-center space-x-2"},_t={key:0},gt={key:0,class:"mt-4 p-3 bg-muted rounded-md"},vt={class:"flex items-center gap-2 text-sm"},xt={class:"font-medium"},bt={key:1,class:"space-y-4"},wt={key:0,class:"p-3 bg-muted rounded-md"},ht={class:"flex items-center gap-2 text-sm"},yt={class:"font-medium"},kt={key:1,class:"p-3 bg-muted rounded-md"},$t={class:"font-medium"},Ct={key:0,class:"text-xs text-muted-foreground"},Vt={class:"space-y-2"},St={class:"flex items-center space-x-2"},At={class:"flex items-center space-x-2"},zt={class:"flex items-center space-x-2"},Ft={key:0,class:"space-y-2"},Dt={class:"space-y-2"},Ut={class:"font-medium"},Et={key:0,class:"text-xs text-muted-foreground"},qt={class:"flex items-center space-x-2"},Lt=["aria-checked"],Pt={key:0,class:"space-y-2"},jt={key:0},Gt={key:1,class:"space-y-4"},Wt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mt={key:2,class:"space-y-2"},It={class:"space-y-2"},Nt={class:"flex items-center space-x-2"},Tt=["aria-checked"],Bt={class:"flex items-center space-x-2"},Ot=["aria-checked"],pl=se({__name:"Create",props:{campana:{},segmentos:{default:()=>[]},plantillasEmail:{default:()=>[]},plantillasWhatsApp:{default:()=>[]},tiposOptions:{default:()=>["email","whatsapp","ambos"]},estadosOptions:{},whatsappModesOptions:{default:()=>({individual:"Contactos Individuales",grupos:"Grupos de WhatsApp",mixto:"Contactos y Grupos"})},whatsappGrupos:{default:()=>[]},batchSizeEmailDefault:{},batchSizeWhatsAppDefault:{},whatsAppDelayDefault:{},filterFieldsConfig:{}},setup(z){var ne,ie,re,de,ue,me,pe,ce,fe,_e,ge,ve,xe,be,we,he,ye,ke,$e,Ce,Ve,Se,Ae,ze,Fe,De,Ue,Ee;const c=z,y=V(()=>{var m;return!!((m=c.campana)!=null&&m.id)}),B=[{title:"Admin",href:"/admin/dashboard"},{title:"Campañas",href:"/admin/campanas"},{title:y.value?"Editar Campaña":"Nueva Campaña",href:"#"}],o=Qe({nombre:((ne=c.campana)==null?void 0:ne.nombre)||"",descripcion:((ie=c.campana)==null?void 0:ie.descripcion)||"",tipo:((re=c.campana)==null?void 0:re.tipo)||"email",whatsapp_mode:((de=c.campana)==null?void 0:de.whatsapp_mode)||"individual",estado:((ue=c.campana)==null?void 0:ue.estado)||"borrador",segment_id:((me=c.campana)==null?void 0:me.segment_id)||null,audience_mode:((pe=c.campana)==null?void 0:pe.audience_mode)||"segment",filters:((ce=c.campana)==null?void 0:ce.filters)||{},plantilla_email_id:((fe=c.campana)==null?void 0:fe.plantilla_email_id)||null,plantilla_whatsapp_id:((_e=c.campana)==null?void 0:_e.plantilla_whatsapp_id)||null,whatsapp_group_ids:((ve=(ge=c.campana)==null?void 0:ge.whatsapp_groups)==null?void 0:ve.map(m=>m.id))||[],fecha_programada:((xe=c.campana)==null?void 0:xe.fecha_programada)||"",es_programada:!!((be=c.campana)!=null&&be.fecha_programada),configuracion:{batch_size_email:((he=(we=c.campana)==null?void 0:we.configuracion)==null?void 0:he.batch_size_email)||c.batchSizeEmailDefault||50,whatsapp_delay_min:((ke=(ye=c.campana)==null?void 0:ye.configuracion)==null?void 0:ke.whatsapp_delay_min)||(($e=c.whatsAppDelayDefault)==null?void 0:$e.min)||5,whatsapp_delay_max:((Ve=(Ce=c.campana)==null?void 0:Ce.configuracion)==null?void 0:Ve.whatsapp_delay_max)||((Se=c.whatsAppDelayDefault)==null?void 0:Se.max)||30,enable_tracking:((ze=(Ae=c.campana)==null?void 0:Ae.configuracion)==null?void 0:ze.enable_tracking)??!0,enable_pixel_tracking:((De=(Fe=c.campana)==null?void 0:Fe.configuracion)==null?void 0:De.enable_pixel_tracking)??!0,enable_click_tracking:((Ee=(Ue=c.campana)==null?void 0:Ue.configuracion)==null?void 0:Ee.enable_click_tracking)??!0}}),$=V(()=>c.segmentos.find(m=>m.id===o.segment_id)),x=V(()=>o.tipo==="email"||o.tipo==="ambos"),k=V(()=>o.tipo==="whatsapp"||o.tipo==="ambos"),D=V(()=>k.value&&(o.whatsapp_mode==="grupos"||o.whatsapp_mode==="mixto")),F=V(()=>k.value&&(o.whatsapp_mode==="individual"||o.whatsapp_mode==="mixto")),C=R(null),U=R(!1),w=V(()=>({fields:c.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por nombre o email...",quickSearchFields:["name","email"],maxNestingLevel:2,allowSaveFilters:!1,autoApply:!1})),p=async m=>{o.filters=m,o.segment_id=null,await _()},_=ra(async()=>{const m=o.filters;if(!(!!(m!=null&&m.advanced_filters)||!!(m!=null&&m.search))){C.value=null;return}U.value=!0;try{const i=await He.post("/admin/campanas/count-users",{filters:m});C.value=i.data.count}catch(i){console.error("Error contando usuarios:",i),C.value=null,E.error("Error al contar usuarios")}finally{U.value=!1}},500),u=()=>{o.filters={},C.value=null};Ne(()=>o.tipo,m=>{m==="email"?o.plantilla_whatsapp_id=null:m==="whatsapp"&&(o.plantilla_email_id=null)});const r=()=>{var m;if(F.value||x.value){if(o.audience_mode==="segment"){if(!o.segment_id){E.error("Debes seleccionar un segmento");return}}else if(o.audience_mode==="manual"&&(!C.value||C.value<=0)){E.error("Debes definir filtros que generen al menos un destinatario");return}}if(x.value&&!o.plantilla_email_id){E.error("Debes seleccionar una plantilla de email");return}if(k.value&&!o.plantilla_whatsapp_id){E.error("Debes seleccionar una plantilla de WhatsApp");return}if(D.value&&o.whatsapp_group_ids.length===0){E.error("Debes seleccionar al menos un grupo de WhatsApp");return}y.value?o.put(`/admin/campanas/${(m=c.campana)==null?void 0:m.id}`,{onSuccess:()=>{E.success("Campaña actualizada exitosamente")},onError:()=>{E.error("Error al actualizar la campaña")}}):o.post("/admin/campanas",{onSuccess:()=>{E.success("Campaña creada exitosamente")},onError:()=>{E.error("Error al crear la campaña")}})},g=V(()=>{const m=o.nombre&&!o.processing&&(x.value?o.plantilla_email_id:!0)&&(k.value?o.plantilla_whatsapp_id:!0),t=!D.value||o.whatsapp_group_ids.length>0;return F.value||x.value?o.audience_mode==="segment"?m&&t&&o.segment_id:m&&t&&C.value&&C.value>0:m&&t}),Q=m=>{o.es_programada=m,m||(o.fecha_programada="")},le=m=>{o.configuracion.enable_pixel_tracking=m},oe=m=>{o.configuracion.enable_click_tracking=m};return(m,t)=>(d(),A(Ze,{breadcrumbs:B},{default:s(()=>[a(e(Xe),{title:y.value?"Editar Campaña":"Nueva Campaña"},null,8,["title"]),l("div",st,[l("form",{onSubmit:Te(r,["prevent"]),class:"space-y-6"},[l("div",lt,[l("div",null,[l("h1",ot,v(y.value?"Editar Campaña":"Nueva Campaña"),1),l("p",nt,v(y.value?"Modifica los detalles de la campaña":"Configura y programa tu campaña de comunicación"),1)]),l("div",it,[a(e(W),{type:"button",variant:"outline",onClick:t[0]||(t[0]=i=>e(Ke).visit("/admin/campanas"))},{default:s(()=>[a(e(da),{class:"w-4 h-4 mr-2"}),t[20]||(t[20]=n(" Cancelar ",-1))]),_:1}),a(e(W),{type:"submit",disabled:!g.value},{default:s(()=>[a(e(ua),{class:"w-4 h-4 mr-2"}),n(" "+v(y.value?"Actualizar":"Guardar")+" Campaña ",1)]),_:1},8,["disabled"])])]),Object.keys(e(o).errors).length>0?(d(),A(e(N),{key:0,variant:"destructive"},{default:s(()=>[a(e(Oe),{class:"h-4 w-4"}),a(e(T),null,{default:s(()=>[l("ul",rt,[(d(!0),f(K,null,H(e(o).errors,(i,Re)=>(d(),f("li",{key:Re},v(i),1))),128))])]),_:1})]),_:1})):h("",!0),a(e(P),null,{default:s(()=>[a(e(j),null,{default:s(()=>[a(e(G),null,{default:s(()=>[...t[21]||(t[21]=[n("Información Básica",-1)])]),_:1}),a(e(O),null,{default:s(()=>[...t[22]||(t[22]=[n(" Define el nombre y tipo de campaña ",-1)])]),_:1})]),_:1}),a(e(L),{class:"space-y-4"},{default:s(()=>[l("div",dt,[l("div",null,[a(e(b),{htmlFor:"nombre"},{default:s(()=>[...t[23]||(t[23]=[n(" Nombre de la Campaña ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(I),{id:"nombre",modelValue:e(o).nombre,"onUpdate:modelValue":t[1]||(t[1]=i=>e(o).nombre=i),placeholder:"Ej: Recordatorio Asamblea General",error:e(o).errors.nombre},null,8,["modelValue","error"])]),l("div",null,[a(e(b),null,{default:s(()=>[...t[24]||(t[24]=[n("Tipo de Campaña ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(Y),{modelValue:e(o).tipo,"onUpdate:modelValue":t[2]||(t[2]=i=>e(o).tipo=i),class:"flex flex-wrap gap-4 mt-2"},{default:s(()=>[l("div",ut,[a(e(q),{value:"email",id:"tipo-email"}),a(e(b),{htmlFor:"tipo-email",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(ma),{class:"w-4 h-4"}),t[25]||(t[25]=n(" Email ",-1))]),_:1})]),l("div",mt,[a(e(q),{value:"whatsapp",id:"tipo-whatsapp"}),a(e(b),{htmlFor:"tipo-whatsapp",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(J),{class:"w-4 h-4"}),t[26]||(t[26]=n(" WhatsApp ",-1))]),_:1})]),l("div",pt,[a(e(q),{value:"ambos",id:"tipo-ambos"}),a(e(b),{htmlFor:"tipo-ambos",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(Ie),{class:"w-4 h-4"}),t[27]||(t[27]=n(" Ambos ",-1))]),_:1})])]),_:1},8,["modelValue"])])]),l("div",null,[a(e(b),{htmlFor:"descripcion"},{default:s(()=>[...t[28]||(t[28]=[n("Descripción",-1)])]),_:1}),a(e(Ye),{id:"descripcion",modelValue:e(o).descripcion,"onUpdate:modelValue":t[3]||(t[3]=i=>e(o).descripcion=i),placeholder:"Describe el objetivo de esta campaña...",rows:"3"},null,8,["modelValue"])])]),_:1})]),_:1}),x.value||F.value?(d(),A(e(P),{key:1},{default:s(()=>[a(e(j),null,{default:s(()=>[a(e(G),null,{default:s(()=>[...t[29]||(t[29]=[n("Audiencia",-1)])]),_:1}),a(e(O),null,{default:s(()=>[...t[30]||(t[30]=[n(" Define quiénes recibirán esta campaña ",-1)])]),_:1})]),_:1}),a(e(L),{class:"space-y-4"},{default:s(()=>[a(e(Y),{modelValue:e(o).audience_mode,"onUpdate:modelValue":t[4]||(t[4]=i=>e(o).audience_mode=i),class:"flex gap-4"},{default:s(()=>[l("div",ct,[a(e(q),{value:"segment",id:"mode-segment"}),a(e(b),{htmlFor:"mode-segment",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(M),{class:"w-4 h-4"}),t[31]||(t[31]=n(" Usar segmento existente ",-1))]),_:1})]),l("div",ft,[a(e(q),{value:"manual",id:"mode-manual"}),a(e(b),{htmlFor:"mode-manual",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(Z),{class:"w-4 h-4"}),t[32]||(t[32]=n(" Filtros manuales ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(o).audience_mode==="segment"?(d(),f("div",_t,[a(Ga,{modelValue:e(o).segment_id,"onUpdate:modelValue":t[5]||(t[5]=i=>e(o).segment_id=i),segments:z.segmentos},null,8,["modelValue","segments"]),$.value?(d(),f("div",gt,[l("div",vt,[a(e(M),{class:"w-4 h-4"}),l("span",xt,v($.value.count)+" usuarios",1),t[33]||(t[33]=l("span",{class:"text-muted-foreground"},"recibirán esta campaña",-1))])])):h("",!0)])):(d(),f("div",bt,[a(e(N),null,{default:s(()=>[a(e(X),{class:"h-4 w-4"}),a(e(T),null,{default:s(()=>[...t[34]||(t[34]=[n(" Define filtros para seleccionar usuarios específicos sin crear un segmento permanente. ",-1)])]),_:1})]),_:1}),a(ia,{config:w.value,"hide-topbar":!0,onApply:p,onClear:u},null,8,["config"]),C.value!==null?(d(),f("div",wt,[l("div",ht,[a(e(M),{class:"w-4 h-4"}),l("span",yt,v(C.value)+" usuarios",1),t[35]||(t[35]=l("span",{class:"text-muted-foreground"},"recibirán esta campaña",-1))])])):U.value?(d(),f("div",kt,[...t[36]||(t[36]=[l("div",{class:"flex items-center gap-2 text-sm text-muted-foreground"},[l("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),n(" Calculando usuarios... ")],-1)])])):h("",!0)]))]),_:1})]),_:1})):h("",!0),x.value?(d(),A(e(P),{key:2},{default:s(()=>[a(e(j),null,{default:s(()=>[a(e(G),null,{default:s(()=>[...t[37]||(t[37]=[n("Plantilla de Email",-1)])]),_:1}),a(e(O),null,{default:s(()=>[...t[38]||(t[38]=[n(" Selecciona la plantilla de email a utilizar ",-1)])]),_:1})]),_:1}),a(e(L),null,{default:s(()=>[a(e(Le),{modelValue:e(o).plantilla_email_id,"onUpdate:modelValue":t[6]||(t[6]=i=>e(o).plantilla_email_id=i)},{default:s(()=>[a(e(Pe),null,{default:s(()=>[a(e(je),{placeholder:"Selecciona una plantilla"})]),_:1}),a(e(Ge),null,{default:s(()=>[(d(!0),f(K,null,H(z.plantillasEmail,i=>(d(),A(e(We),{key:i.id,value:i.id.toString()},{default:s(()=>[l("div",null,[l("div",$t,v(i.nombre),1),i.asunto?(d(),f("div",Ct," Asunto: "+v(i.asunto),1)):h("",!0)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):h("",!0),k.value?(d(),A(e(P),{key:3},{default:s(()=>[a(e(j),null,{default:s(()=>[a(e(G),null,{default:s(()=>[...t[39]||(t[39]=[n("Configuración de WhatsApp",-1)])]),_:1}),a(e(O),null,{default:s(()=>[...t[40]||(t[40]=[n(" Define el modo y la plantilla de WhatsApp ",-1)])]),_:1})]),_:1}),a(e(L),{class:"space-y-4"},{default:s(()=>[l("div",Vt,[a(e(b),null,{default:s(()=>[...t[41]||(t[41]=[n("Tipo de Audiencia WhatsApp",-1)])]),_:1}),a(e(Y),{modelValue:e(o).whatsapp_mode,"onUpdate:modelValue":t[7]||(t[7]=i=>e(o).whatsapp_mode=i),class:"flex flex-wrap gap-4"},{default:s(()=>[l("div",St,[a(e(q),{value:"individual",id:"whatsapp-mode-individual"}),a(e(b),{htmlFor:"whatsapp-mode-individual",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(M),{class:"w-4 h-4"}),t[42]||(t[42]=n(" Contactos Individuales ",-1))]),_:1})]),l("div",At,[a(e(q),{value:"grupos",id:"whatsapp-mode-grupos"}),a(e(b),{htmlFor:"whatsapp-mode-grupos",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(J),{class:"w-4 h-4"}),t[43]||(t[43]=n(" Grupos ",-1))]),_:1})]),l("div",zt,[a(e(q),{value:"mixto",id:"whatsapp-mode-mixto"}),a(e(b),{htmlFor:"whatsapp-mode-mixto",class:"flex items-center gap-1 cursor-pointer"},{default:s(()=>[a(e(Ie),{class:"w-4 h-4"}),t[44]||(t[44]=n(" Contactos y Grupos ",-1))]),_:1})])]),_:1},8,["modelValue"])]),D.value?(d(),f("div",Ft,[a(e(b),null,{default:s(()=>[...t[45]||(t[45]=[n("Grupos de WhatsApp",-1)])]),_:1}),a(tt,{modelValue:e(o).whatsapp_group_ids,"onUpdate:modelValue":t[8]||(t[8]=i=>e(o).whatsapp_group_ids=i),grupos:z.whatsappGrupos},null,8,["modelValue","grupos"])])):h("",!0),D.value?(d(),A(e(N),{key:1},{default:s(()=>[a(e(X),{class:"h-4 w-4"}),a(e(T),null,{default:s(()=>[...t[46]||(t[46]=[n(" Los mensajes a grupos no soportan variables de personalización (ej: nombre del usuario). El mensaje se enviará tal cual está definido en la plantilla. ",-1)])]),_:1})]),_:1})):h("",!0),l("div",Dt,[a(e(b),null,{default:s(()=>[...t[47]||(t[47]=[n("Plantilla de WhatsApp",-1)])]),_:1}),a(e(Le),{modelValue:e(o).plantilla_whatsapp_id,"onUpdate:modelValue":t[9]||(t[9]=i=>e(o).plantilla_whatsapp_id=i)},{default:s(()=>[a(e(Pe),null,{default:s(()=>[a(e(je),{placeholder:"Selecciona una plantilla"})]),_:1}),a(e(Ge),null,{default:s(()=>[(d(!0),f(K,null,H(z.plantillasWhatsApp,i=>(d(),A(e(We),{key:i.id,value:i.id.toString()},{default:s(()=>[l("div",null,[l("div",Ut,v(i.nombre),1),i.descripcion?(d(),f("div",Et,v(i.descripcion),1)):h("",!0)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})):h("",!0),a(e(P),null,{default:s(()=>[a(e(j),null,{default:s(()=>[a(e(G),null,{default:s(()=>[...t[48]||(t[48]=[n("Programación",-1)])]),_:1}),a(e(O),null,{default:s(()=>[...t[49]||(t[49]=[n(" Define cuándo se enviará la campaña ",-1)])]),_:1})]),_:1}),a(e(L),{class:"space-y-4"},{default:s(()=>[l("div",qt,[l("button",{type:"button",onClick:t[10]||(t[10]=i=>Q(!e(o).es_programada)),class:S(["inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] cursor-pointer",e(o).es_programada?"bg-primary":"bg-input"]),"aria-checked":e(o).es_programada,role:"switch"},[l("span",{class:S(["pointer-events-none block size-4 rounded-full bg-background ring-0 transition-transform",e(o).es_programada?"translate-x-[calc(100%-2px)]":"translate-x-0"])},null,2)],10,Lt),a(e(b),{onClick:t[11]||(t[11]=i=>Q(!e(o).es_programada)),class:"cursor-pointer"},{default:s(()=>[...t[50]||(t[50]=[n("Programar envío",-1)])]),_:1})]),e(o).es_programada?(d(),f("div",Pt,[a(e(b),{htmlFor:"fecha_programada"},{default:s(()=>[...t[51]||(t[51]=[n(" Fecha y hora de envío ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(I),{id:"fecha_programada",type:"datetime-local",modelValue:e(o).fecha_programada,"onUpdate:modelValue":t[12]||(t[12]=i=>e(o).fecha_programada=i),min:new Date().toISOString().slice(0,16),class:"w-full",required:""},null,8,["modelValue","min"]),t[52]||(t[52]=l("p",{class:"text-xs text-muted-foreground"}," La campaña se enviará automáticamente en la fecha y hora seleccionada ",-1))])):h("",!0)]),_:1})]),_:1}),a(e(P),null,{default:s(()=>[a(e(j),null,{default:s(()=>[a(e(G),null,{default:s(()=>[...t[53]||(t[53]=[n("Configuración Avanzada",-1)])]),_:1}),a(e(O),null,{default:s(()=>[...t[54]||(t[54]=[n(" Ajusta los parámetros de envío y tracking ",-1)])]),_:1})]),_:1}),a(e(L),{class:"space-y-4"},{default:s(()=>[x.value?(d(),f("div",jt,[a(e(b),{htmlFor:"batch_size_email"},{default:s(()=>[...t[55]||(t[55]=[n(" Tamaño de lote (Email) ",-1)])]),_:1}),a(e(I),{id:"batch_size_email",type:"number",modelValue:e(o).configuracion.batch_size_email,"onUpdate:modelValue":t[13]||(t[13]=i=>e(o).configuracion.batch_size_email=i),modelModifiers:{number:!0},min:"1",max:"100",class:"max-w-xs"},null,8,["modelValue"]),t[56]||(t[56]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Emails enviados por lote (máximo 100, recomendado: 50) ",-1))])):h("",!0),k.value?(d(),f("div",Gt,[a(e(N),null,{default:s(()=>[a(e(X),{class:"h-4 w-4"}),a(e(T),null,{default:s(()=>[...t[57]||(t[57]=[n(" Los mensajes de WhatsApp se envían uno a uno con intervalos de tiempo aleatorios para evitar bloqueos de la API. ",-1)])]),_:1})]),_:1}),l("div",Wt,[l("div",null,[a(e(b),{htmlFor:"whatsapp_delay_min"},{default:s(()=>[...t[58]||(t[58]=[n(" Intervalo mínimo (segundos) ",-1)])]),_:1}),a(e(I),{id:"whatsapp_delay_min",type:"number",modelValue:e(o).configuracion.whatsapp_delay_min,"onUpdate:modelValue":t[14]||(t[14]=i=>e(o).configuracion.whatsapp_delay_min=i),modelModifiers:{number:!0},min:"5",max:"120"},null,8,["modelValue"]),t[59]||(t[59]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Mínimo 5 segundos entre mensajes ",-1))]),l("div",null,[a(e(b),{htmlFor:"whatsapp_delay_max"},{default:s(()=>[...t[60]||(t[60]=[n(" Intervalo máximo (segundos) ",-1)])]),_:1}),a(e(I),{id:"whatsapp_delay_max",type:"number",modelValue:e(o).configuracion.whatsapp_delay_max,"onUpdate:modelValue":t[15]||(t[15]=i=>e(o).configuracion.whatsapp_delay_max=i),modelModifiers:{number:!0},min:"5",max:"120"},null,8,["modelValue"]),t[61]||(t[61]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Máximo 120 segundos entre mensajes ",-1))])])])):h("",!0),x.value?(d(),f("div",Mt,[a(e(b),null,{default:s(()=>[...t[62]||(t[62]=[n("Opciones de Tracking",-1)])]),_:1}),l("div",It,[l("div",Nt,[l("button",{type:"button",onClick:t[16]||(t[16]=i=>le(!e(o).configuracion.enable_pixel_tracking)),class:S(["inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] cursor-pointer",e(o).configuracion.enable_pixel_tracking?"bg-primary":"bg-input"]),"aria-checked":e(o).configuracion.enable_pixel_tracking,role:"switch"},[l("span",{class:S(["pointer-events-none block size-4 rounded-full bg-background ring-0 transition-transform",e(o).configuracion.enable_pixel_tracking?"translate-x-[calc(100%-2px)]":"translate-x-0"])},null,2)],10,Tt),a(e(b),{class:"font-normal cursor-pointer",onClick:t[17]||(t[17]=i=>le(!e(o).configuracion.enable_pixel_tracking))},{default:s(()=>[...t[63]||(t[63]=[n(" Tracking de apertura (pixel) ",-1)])]),_:1})]),l("div",Bt,[l("button",{type:"button",onClick:t[18]||(t[18]=i=>oe(!e(o).configuracion.enable_click_tracking)),class:S(["inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] cursor-pointer",e(o).configuracion.enable_click_tracking?"bg-primary":"bg-input"]),"aria-checked":e(o).configuracion.enable_click_tracking,role:"switch"},[l("span",{class:S(["pointer-events-none block size-4 rounded-full bg-background ring-0 transition-transform",e(o).configuracion.enable_click_tracking?"translate-x-[calc(100%-2px)]":"translate-x-0"])},null,2)],10,Ot),a(e(b),{class:"font-normal cursor-pointer",onClick:t[19]||(t[19]=i=>oe(!e(o).configuracion.enable_click_tracking))},{default:s(()=>[...t[64]||(t[64]=[n(" Tracking de clicks ",-1)])]),_:1})])])])):h("",!0)]),_:1})]),_:1}),a(e(N),null,{default:s(()=>[a(e(X),{class:"h-4 w-4"}),a(e(T),null,{default:s(()=>[...t[65]||(t[65]=[n(" La campaña se guardará en estado ",-1),l("strong",null,"borrador",-1),n(". Podrás revisarla y enviarla desde el listado de campañas. ",-1)])]),_:1})]),_:1})],32)])]),_:1}))}});export{pl as default};
