import{r as E,c as U,d as se,i as h,e as s,g as v,f as e,t as P,m as t,p as ve,b as C,w as r,j as S,h as z,F as N,k as G,n as me,I as we,o as be}from"./app-DiPPUZGR.js";import{_ as ge,c as he,a as Ce,b as ke}from"./CardTitle.vue_vue_type_script_setup_true_lang-_d2aW74W.js";import{_ as Re}from"./CardDescription.vue_vue_type_script_setup_true_lang-JUvdHu7b.js";import{c as ne,_ as M}from"./createLucideIcon-LnFYj6W8.js";import{_ as ue}from"./Skeleton.vue_vue_type_script_setup_true_lang-Cg44Zo1t.js";import{C as $e,_ as Ee,a as Se,b as Pe,c as Te,d as qe}from"./SelectValue.vue_vue_type_script_setup_true_lang-CTzhYuOH.js";import{R as ze}from"./RichTextEditor-gQK9g6ps.js";import{X as Me}from"./x-pr_ySs4L.js";import{L as Le}from"./loader-circle-D6kw1xtd.js";import{S as je}from"./send-5eIdLOyR.js";import{b as Ie,_ as Ue}from"./index-PWa2o0RG.js";import{_ as Ae}from"./index-CT6SjxSq.js";import{b as Xe,c as Oe,g as pe,d as Be}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C_pN3p-k.js";import{_ as De,a as Ne,b as Ve}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-B3e-cB8O.js";import{C as Fe}from"./clock-BYIq73Do.js";import{M as de}from"./message-square-8Gp_gy7F.js";import{E as He}from"./ellipsis-CUvX1d-9.js";import{S as Qe}from"./square-pen-D8QWh03K.js";import{T as We}from"./trash-2-BnWvOJCC.js";import{C as ye}from"./chevron-right-C2UX4xcU.js";import{t as B}from"./index-Cn3vOUme.js";import{C as Ke}from"./chevron-left-Cp-X-kBb.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ne("ArrowUpDownIcon",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=ne("ChevronsLeftIcon",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ne("ChevronsRightIcon",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=ne("QuoteIcon",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=ne("SmilePlusIcon",[["path",{d:"M22 11v1a10 10 0 1 1-9-10",key:"ew0xw9"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}],["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}]]);function ea(a,D,w={}){const{paginaInicial:m=1,urlParam:q="pagina",sincronizarUrl:g=!0}=w,k=E([]),y=E(!1),T=E(null),_=E(m),R=E(1),d=E(0),x=E(0),j=E(0),A=E([]),H=E("recientes"),J={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},Q=`/api/comentarios/${a}/${D}`,ee=c=>{if(!g)return;const f=new URL(window.location.href);c>1?f.searchParams.set(q,String(c)):f.searchParams.delete(q),window.history.replaceState({},"",f.toString())},V=async(c,f=!0)=>{const n=c??_.value;y.value=!0,T.value=null;try{const o=new URLSearchParams({page:String(n),sort:H.value}),u=await(await fetch(`${Q}?${o}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();if(u.success&&u.data)k.value=u.data.data,_.value=u.data.current_page,R.value=u.data.last_page,d.value=u.data.total,x.value=u.data.from||0,j.value=u.data.to||0,A.value=u.data.links||[],f&&ee(n);else throw new Error(u.message||"Error al cargar comentarios")}catch(o){T.value=o instanceof Error?o.message:"Error desconocido",console.error("Error cargando comentarios:",o)}finally{y.value=!1}},Y=async c=>{c!==H.value&&(H.value=c,await V(1))},Z=async c=>{c>=1&&c<=R.value&&c!==_.value&&await V(c)},ae=async()=>{_.value<R.value&&await V(_.value+1)},$=async()=>{_.value>1&&await V(_.value-1)},i=async c=>{y.value=!0,T.value=null;try{const n=await(await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":b()},credentials:"same-origin",body:JSON.stringify(c)})).json();return n.success&&n.comentario&&(c.parent_id?O(c.parent_id,n.comentario):(k.value=[n.comentario,...k.value],d.value++)),n}catch(f){const n=f instanceof Error?f.message:"Error al crear comentario";return T.value=n,{success:!1,message:n}}finally{y.value=!1}},X=async(c,f)=>{y.value=!0,T.value=null;try{const o=await(await fetch(`/api/comentarios/${c}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":b()},credentials:"same-origin",body:JSON.stringify(f)})).json();return o.success&&o.comentario&&W(o.comentario),o}catch(n){const o=n instanceof Error?n.message:"Error al actualizar comentario";return T.value=o,{success:!1,message:o}}finally{y.value=!1}},F=async c=>{y.value=!0,T.value=null;try{const n=await(await fetch(`/api/comentarios/${c}`,{method:"DELETE",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":b()},credentials:"same-origin"})).json();return n.success&&(te(c),d.value--),n}catch(f){const n=f instanceof Error?f.message:"Error al eliminar comentario";return T.value=n,{success:!1,message:n}}finally{y.value=!1}},L=async(c,f)=>{try{const o=await(await fetch(`/api/comentarios/${c}/reaccion`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":b()},credentials:"same-origin",body:JSON.stringify({emoji:f})})).json();return o.success&&o.reacciones&&oe(c,o.reacciones),o}catch(n){return{success:!1,message:n instanceof Error?n.message:"Error al agregar reacciÃ³n"}}},b=()=>{var f;return((f=document.querySelector('meta[name="csrf-token"]'))==null?void 0:f.getAttribute("content"))||""},O=(c,f)=>{const n=o=>{for(const I of o){if(I.id===c)return I.respuestas||(I.respuestas=[]),I.respuestas.push(f),!0;if(I.respuestas&&n(I.respuestas))return!0}return!1};n(k.value)},W=c=>{const f=n=>{for(let o=0;o<n.length;o++){if(n[o].id===c.id)return n[o]={...c,respuestas:n[o].respuestas},!0;if(n[o].respuestas&&f(n[o].respuestas))return!0}return!1};f(k.value)},te=c=>{const f=n=>n.filter(o=>o.id!==c).map(o=>({...o,respuestas:o.respuestas?f(o.respuestas):void 0}));k.value=f(k.value)},oe=(c,f)=>{const n=o=>{for(const I of o){if(I.id===c)return I.reacciones_resumen=f,!0;if(I.respuestas&&n(I.respuestas))return!0}return!1};n(k.value)},re=U(()=>k.value.length>0),le=U(()=>R.value>1),ie=U(()=>_.value>1),ce=U(()=>_.value<R.value);return{comentarios:k,loading:y,error:T,currentPage:_,lastPage:R,total:d,from:x,to:j,links:A,emojis:J,sortBy:H,tieneComentarios:re,tienePaginacion:le,puedePaginaAnterior:ie,puedePaginaSiguiente:ce,cargar:V,irAPagina:Z,paginaSiguiente:ae,paginaAnterior:$,crear:i,editar:X,eliminar:F,toggleReaccion:L,cambiarOrden:Y}}const aa={class:"flex items-start gap-2 p-3 bg-muted/50 rounded-md border-l-4 border-primary/30 text-sm"},ta={class:"flex-1 min-w-0"},sa={class:"flex items-center gap-2 mb-1"},na={class:"font-medium text-xs"},oa={class:"text-xs text-muted-foreground"},ra=["innerHTML"],xe=se({__name:"ComentarioQuote",props:{comentario:{}},setup(a){return(D,w)=>{var m;return t(),h("div",aa,[s(e(_e),{class:"h-4 w-4 text-muted-foreground flex-shrink-0 mt-0.5"}),v("div",ta,[v("div",sa,[v("span",na,P(((m=a.comentario.autor)==null?void 0:m.name)||"Usuario"),1),v("span",oa,P(a.comentario.fecha_relativa),1)]),v("p",{class:"text-muted-foreground line-clamp-2",innerHTML:a.comentario.contenido_truncado||a.comentario.contenido_plain},null,8,ra)])])}}}),la={key:1,class:"flex items-center gap-2 text-sm text-muted-foreground"},ia={class:"font-medium"},ca={class:"flex items-center justify-end gap-2"},fe=se({__name:"ComentarioForm",props:{mode:{default:"create"},comentarioEditar:{default:null},comentarioCitar:{default:null},comentarioResponder:{default:null},loading:{type:Boolean,default:!1},placeholder:{default:"Escribe un comentario..."}},emits:["submit","cancel"],setup(a,{expose:D,emit:w}){const m=a,q=w,g=E("");ve(()=>m.comentarioEditar,d=>{d&&(g.value=d.contenido)},{immediate:!0});const k=U(()=>{switch(m.mode){case"edit":return"Guardar cambios";case"reply":return"Responder";case"quote":return"Comentar";default:return"Comentar"}}),y=U(()=>{var d,x;switch(m.mode){case"reply":return`Responder a ${((x=(d=m.comentarioResponder)==null?void 0:d.autor)==null?void 0:x.name)||"usuario"}...`;case"quote":return"Escribe tu comentario sobre la cita...";default:return m.placeholder}}),T=U(()=>g.value.replace(/<[^>]*>/g,"").trim().length>0),_=()=>{var j,A;if(!T.value||m.loading)return;const d=m.mode==="reply"&&((j=m.comentarioResponder)==null?void 0:j.id)||null,x=m.mode==="quote"&&((A=m.comentarioCitar)==null?void 0:A.id)||null;q("submit",g.value,d,x),m.mode!=="edit"&&(g.value="")},R=()=>{g.value="",q("cancel")};return D({clear:()=>{g.value=""}}),(d,x)=>(t(),C(e(ge),{class:"border-0 shadow-none"},{default:r(()=>[s(e(he),{class:"p-0 space-y-3"},{default:r(()=>{var j;return[a.mode==="quote"&&a.comentarioCitar?(t(),C(xe,{key:0,comentario:a.comentarioCitar},null,8,["comentario"])):S("",!0),a.mode==="reply"&&a.comentarioResponder?(t(),h("div",la,[x[1]||(x[1]=v("span",null,"Respondiendo a",-1)),v("span",ia,P((j=a.comentarioResponder.autor)==null?void 0:j.name),1),s(e(M),{variant:"ghost",size:"sm",class:"h-5 w-5 p-0 ml-auto",onClick:R},{default:r(()=>[s(e(Me),{class:"h-3 w-3"})]),_:1})])):S("",!0),s(ze,{modelValue:g.value,"onUpdate:modelValue":x[0]||(x[0]=A=>g.value=A),placeholder:y.value,rows:3},null,8,["modelValue","placeholder"]),v("div",ca,[a.mode!=="create"?(t(),C(e(M),{key:0,variant:"ghost",size:"sm",onClick:R,disabled:a.loading},{default:r(()=>[...x[2]||(x[2]=[z(" Cancelar ",-1)])]),_:1},8,["disabled"])):S("",!0),s(e(M),{size:"sm",onClick:_,disabled:!T.value||a.loading},{default:r(()=>[a.loading?(t(),C(e(Le),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):(t(),C(e(je),{key:1,class:"h-4 w-4 mr-2"})),z(" "+P(k.value),1)]),_:1},8,["disabled"])])]}),_:1})]),_:1}))}}),ua={class:"flex items-center gap-1.5 flex-wrap"},ma={class:"text-muted-foreground"},da={class:"flex gap-1"},fa=se({__name:"ComentarioReacciones",props:{reacciones:{default:()=>[]},canReact:{type:Boolean,default:!0}},emits:["toggle"],setup(a,{emit:D}){const w=a,m=D,q={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},g=E(!1),k=U(()=>[...w.reacciones].sort((_,R)=>R.count-_.count)),y=_=>{const R=w.reacciones.find(d=>d.emoji===_);return(R==null?void 0:R.usuario_actual_reacciono)||!1},T=_=>{m("toggle",_),g.value=!1};return(_,R)=>(t(),h("div",ua,[(t(!0),h(N,null,G(k.value,d=>(t(),C(e(M),{key:d.emoji,variant:"ghost",size:"sm",class:me(["h-7 px-2 text-xs gap-1",{"bg-primary/10 hover:bg-primary/20":d.usuario_actual_reacciono}]),onClick:x=>T(d.emoji),disabled:!a.canReact},{default:r(()=>[v("span",null,P(d.simbolo),1),v("span",ma,P(d.count),1)]),_:2},1032,["class","onClick","disabled"]))),128)),a.canReact?(t(),C(e(De),{key:0,open:g.value,"onUpdate:open":R[0]||(R[0]=d=>g.value=d)},{default:r(()=>[s(e(Ne),{asChild:""},{default:r(()=>[s(e(M),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:r(()=>[s(e(Ze),{class:"h-4 w-4 text-muted-foreground"})]),_:1})]),_:1}),s(e(Ve),{class:"w-auto p-2",align:"start"},{default:r(()=>[v("div",da,[(t(),h(N,null,G(q,(d,x)=>s(e(M),{key:x,variant:"ghost",size:"sm",class:me(["h-8 w-8 p-0 text-lg hover:scale-125 transition-transform",{"bg-primary/10":y(x)}]),onClick:j=>T(x)},{default:r(()=>[z(P(d),1)]),_:2},1032,["class","onClick"])),64))])]),_:1})]),_:1},8,["open"])):S("",!0)]))}}),pa={class:"group/item flex gap-3"},va={class:"flex-1 min-w-0"},ga={class:"flex items-center gap-2 flex-wrap"},ha={class:"font-medium text-sm"},ya={class:"text-xs text-muted-foreground"},_a={key:1,class:"text-xs text-muted-foreground flex items-center gap-1"},xa={key:0,class:"mt-2"},wa=["innerHTML"],ba={class:"mt-2 flex items-center gap-2 flex-wrap"},Ca={class:"flex items-center gap-1 opacity-0 group-hover/item:opacity-100 transition-opacity"},ka={key:2,class:"mt-3"},Ra={key:0,class:"mt-3 space-y-3"},$a=se({__name:"ComentarioItem",props:{comentario:{},nivel:{default:0},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0}},emits:["reply","quote","edit","delete","toggleReaccion","submitReply"],setup(a,{emit:D}){const w=a,m=D,q=E(!1),g=E(!1),k=E(!1),y=E(!1),T=U(()=>{const $=i=>{var F,L;let X=((F=i.respuestas)==null?void 0:F.length)||0;return(L=i.respuestas)==null||L.forEach(b=>{X+=$(b)}),X};return $(w.comentario)}),_=U(()=>{var $;return((($=w.comentario.respuestas)==null?void 0:$.length)||0)>0}),R=U(()=>{var i;return(((i=w.comentario.autor)==null?void 0:i.name)||"U").substring(0,2).toUpperCase()}),d=U(()=>w.comentario.es_editable||!1),x=U(()=>{const $=w.comentario.tiempo_restante_edicion;if(!$||$<=0)return null;const i=Math.floor($/60),X=$%60;return i>0?`${i}h ${X}m para editar`:`${X}m para editar`}),j=()=>{q.value=!q.value},A=()=>{g.value=!0},H=($,i,X)=>{m("submitReply",$,w.comentario.id),g.value=!1},J=()=>{g.value=!1},Q=()=>{m("quote",w.comentario)},ee=()=>{k.value=!0},V=$=>{m("edit",w.comentario,$),k.value=!1},Y=()=>{k.value=!1},Z=()=>{y.value?(m("delete",w.comentario),y.value=!1):(y.value=!0,setTimeout(()=>{y.value=!1},3e3))},ae=$=>{m("toggleReaccion",w.comentario.id,$)};return($,i)=>{var F;const X=we("ComentarioItem",!0);return t(),h("div",{class:me({"ml-6 border-l-2 border-muted pl-4":a.nivel>0})},[v("div",pa,[s(e(Ue),{class:"h-8 w-8 flex-shrink-0"},{default:r(()=>[s(e(Ie),{class:"text-xs"},{default:r(()=>[z(P(R.value),1)]),_:1})]),_:1}),v("div",va,[v("div",ga,[v("span",ha,P(((F=a.comentario.autor)==null?void 0:F.name)||"Usuario"),1),v("span",ya,P(a.comentario.fecha_relativa),1),a.comentario.es_editado?(t(),C(e(Ae),{key:0,variant:"outline",class:"text-xs h-5"},{default:r(()=>[...i[7]||(i[7]=[z(" editado ",-1)])]),_:1})):S("",!0),x.value?(t(),h("span",_a,[s(e(Fe),{class:"h-3 w-3"}),z(" "+P(x.value),1)])):S("",!0)]),k.value?(t(),h("div",xa,[s(fe,{mode:"edit","comentario-editar":a.comentario,onSubmit:i[0]||(i[0]=L=>V(L)),onCancel:Y},null,8,["comentario-editar"])])):(t(),h(N,{key:1},[a.comentario.comentario_citado?(t(),C(xe,{key:0,comentario:a.comentario.comentario_citado,class:"mt-2"},null,8,["comentario"])):S("",!0),v("div",{class:"mt-1 text-sm prose prose-sm dark:prose-invert max-w-none",innerHTML:a.comentario.contenido},null,8,wa),v("div",ba,[s(fa,{reacciones:a.comentario.reacciones_resumen||[],"can-react":a.canReact,onToggle:ae},null,8,["reacciones","can-react"]),v("div",Ca,[a.canCreate?(t(),C(e(M),{key:0,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:A},{default:r(()=>[s(e(de),{class:"h-3 w-3 mr-1"}),i[8]||(i[8]=z(" Responder ",-1))]),_:1})):S("",!0),a.canCreate?(t(),C(e(M),{key:1,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:Q},{default:r(()=>[s(e(_e),{class:"h-3 w-3 mr-1"}),i[9]||(i[9]=z(" Citar ",-1))]),_:1})):S("",!0),d.value||a.comentario.es_eliminable?(t(),C(e(Xe),{key:2},{default:r(()=>[s(e(Oe),{asChild:""},{default:r(()=>[s(e(M),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:r(()=>[s(e(He),{class:"h-4 w-4"})]),_:1})]),_:1}),s(e(Be),{align:"end"},{default:r(()=>[a.comentario.es_editable?(t(),C(e(pe),{key:0,onClick:ee},{default:r(()=>[s(e(Qe),{class:"h-4 w-4 mr-2"}),i[10]||(i[10]=z(" Editar ",-1))]),_:1})):S("",!0),a.comentario.es_eliminable?(t(),C(e(pe),{key:1,class:"text-destructive",onClick:Z},{default:r(()=>[s(e(We),{class:"h-4 w-4 mr-2"}),z(" "+P(y.value?"Confirmar eliminaciÃ³n":"Eliminar"),1)]),_:1})):S("",!0)]),_:1})]),_:1})):S("",!0),_.value?(t(),C(e(M),{key:3,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:j},{default:r(()=>[q.value?(t(),C(e(ye),{key:1,class:"h-3 w-3 mr-1"})):(t(),C(e($e),{key:0,class:"h-3 w-3 mr-1"})),z(" "+P(q.value?`Mostrar ${T.value}`:"Ocultar"),1)]),_:1})):S("",!0)])])],64)),g.value?(t(),h("div",ka,[s(fe,{mode:"reply","comentario-responder":a.comentario,onSubmit:H,onCancel:J},null,8,["comentario-responder"])])):S("",!0)])]),_.value&&!q.value?(t(),h("div",Ra,[(t(!0),h(N,null,G(a.comentario.respuestas,L=>(t(),C(X,{key:L.id,comentario:L,nivel:a.nivel+1,"can-create":a.canCreate,"can-react":a.canReact,onReply:i[1]||(i[1]=b=>m("reply",b)),onQuote:i[2]||(i[2]=b=>m("quote",b)),onEdit:i[3]||(i[3]=(b,O)=>m("edit",b,O)),onDelete:i[4]||(i[4]=b=>m("delete",b)),onToggleReaccion:i[5]||(i[5]=(b,O)=>m("toggleReaccion",b,O)),onSubmitReply:i[6]||(i[6]=(b,O)=>m("submitReply",b,O))},null,8,["comentario","nivel","can-create","can-react"]))),128))])):S("",!0)],2)}}}),Ea={class:"flex items-center justify-between"},Sa={key:0},Pa={key:1,class:"space-y-4"},Ta={class:"flex-1 space-y-2"},qa={key:2,class:"text-center py-8 text-destructive"},za={key:3,class:"text-center py-8"},Ma={key:0,class:"text-sm text-muted-foreground mt-1"},La={key:4,class:"space-y-4"},ja={key:0,class:"flex flex-col items-center gap-3 pt-4 border-t"},Ia={class:"text-sm text-muted-foreground"},Ua={class:"flex items-center gap-1"},Aa={key:0,class:"px-2 text-muted-foreground"},lt=se({__name:"ComentariosPanel",props:{commentableType:{},commentableId:{},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0}},setup(a){const D=[{value:"recientes",label:"MÃ¡s recientes"},{value:"antiguos",label:"MÃ¡s antiguos"},{value:"populares",label:"MÃ¡s populares"}],w=a,m=()=>{const p=new URLSearchParams(window.location.search).get("pagina");return p?parseInt(p,10):1},{comentarios:q,loading:g,error:k,total:y,lastPage:T,from:_,to:R,links:d,tienePaginacion:x,puedePaginaAnterior:j,puedePaginaSiguiente:A,sortBy:H,cargar:J,irAPagina:Q,paginaSiguiente:ee,paginaAnterior:V,crear:Y,editar:Z,eliminar:ae,toggleReaccion:$,cambiarOrden:i}=ea(w.commentableType,w.commentableId,{paginaInicial:m(),urlParam:"pagina",sincronizarUrl:!0}),X=U(()=>!d.value||d.value.length<=3?[]:d.value),F=u=>{if(!u.url||u.active)return;const p=new URL(u.url,window.location.origin),l=parseInt(p.searchParams.get("page")||"1",10);Q(l)},L=E("create"),b=E(null),O=E(null),W=E(null),te=E(!1),oe=E(null);be(()=>{J()}),ve(()=>[w.commentableType,w.commentableId],()=>{J()});const re=async(u,p,l)=>{te.value=!0;try{if(L.value==="edit"&&W.value){const K=await Z(W.value.id,{contenido:u});K.success?(B.success(K.message),o()):B.error(K.message||"Error al actualizar")}else{const K=await Y({contenido:u,parent_id:p,quoted_comentario_id:l});K.success?(B.success(K.message),o()):B.error(K.message||"Error al publicar")}}finally{te.value=!1}},le=u=>{L.value="reply",b.value=u,O.value=null,W.value=null},ie=u=>{L.value="quote",O.value=u,b.value=null,W.value=null},ce=async(u,p)=>{const l=await Z(u.id,{contenido:p});l.success?B.success(l.message):B.error(l.message||"Error al actualizar")},c=async u=>{const p=await ae(u.id);p.success?B.success(p.message):B.error(p.message||"Error al eliminar")},f=async(u,p)=>{const l=await $(u,p);l.success||B.error(l.message||"Error al agregar reacciÃ³n")},n=async(u,p)=>{const l=await Y({contenido:u,parent_id:p,quoted_comentario_id:null});l.success?B.success(l.message):B.error(l.message||"Error al enviar respuesta")},o=()=>{var u;L.value="create",b.value=null,O.value=null,W.value=null,(u=oe.value)==null||u.clear()},I=()=>{o()};return(u,p)=>(t(),C(e(ge),null,{default:r(()=>[s(e(Ce),null,{default:r(()=>[v("div",Ea,[v("div",null,[s(e(ke),{class:"flex items-center gap-2"},{default:r(()=>[s(e(de),{class:"h-5 w-5"}),p[3]||(p[3]=z(" Comentarios ",-1))]),_:1}),e(y)>0?(t(),C(e(Re),{key:0},{default:r(()=>[z(P(e(y))+" "+P(e(y)===1?"comentario":"comentarios"),1)]),_:1})):S("",!0)]),e(y)>1?(t(),C(e(Ee),{key:0,"model-value":e(H),"onUpdate:modelValue":e(i)},{default:r(()=>[s(e(Se),{class:"w-[160px] h-8 text-xs"},{default:r(()=>[s(e(Je),{class:"h-3 w-3 mr-1"}),s(e(Pe))]),_:1}),s(e(Te),null,{default:r(()=>[(t(),h(N,null,G(D,l=>s(e(qe),{key:l.value,value:l.value},{default:r(()=>[z(P(l.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):S("",!0)])]),_:1}),s(e(he),{class:"space-y-6"},{default:r(()=>[a.canCreate?(t(),h("div",Sa,[s(fe,{ref_key:"formRef",ref:oe,mode:L.value,"comentario-editar":W.value,"comentario-citar":O.value,"comentario-responder":b.value,loading:te.value,onSubmit:re,onCancel:I},null,8,["mode","comentario-editar","comentario-citar","comentario-responder","loading"])])):S("",!0),e(g)&&e(q).length===0?(t(),h("div",Pa,[(t(),h(N,null,G(3,l=>v("div",{key:l,class:"flex gap-3"},[s(e(ue),{class:"h-8 w-8 rounded-full"}),v("div",Ta,[s(e(ue),{class:"h-4 w-32"}),s(e(ue),{class:"h-16 w-full"})])])),64))])):e(k)?(t(),h("div",qa,[v("p",null,P(e(k)),1),s(e(M),{variant:"outline",size:"sm",class:"mt-2",onClick:p[0]||(p[0]=l=>e(J)())},{default:r(()=>[...p[4]||(p[4]=[z(" Reintentar ",-1)])]),_:1})])):e(q).length===0?(t(),h("div",za,[s(e(de),{class:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),p[5]||(p[5]=v("p",{class:"text-muted-foreground"},"No hay comentarios todavÃ­a",-1)),a.canCreate?(t(),h("p",Ma," SÃ© el primero en comentar ")):S("",!0)])):(t(),h("div",La,[(t(!0),h(N,null,G(e(q),l=>(t(),C($a,{key:l.id,comentario:l,"can-create":a.canCreate,"can-react":a.canReact,onReply:le,onQuote:ie,onEdit:ce,onDelete:c,onToggleReaccion:f,onSubmitReply:n},null,8,["comentario","can-create","can-react"]))),128)),e(x)?(t(),h("div",ja,[v("div",Ia," Mostrando "+P(e(_))+" a "+P(e(R))+" de "+P(e(y))+" comentarios ",1),v("div",Ua,[s(e(M),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(j)||e(g),onClick:p[1]||(p[1]=l=>e(Q)(1)),title:"Primera pÃ¡gina"},{default:r(()=>[s(e(Ge),{class:"h-4 w-4"})]),_:1},8,["disabled"]),s(e(M),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(j)||e(g),onClick:e(V),title:"PÃ¡gina anterior"},{default:r(()=>[s(e(Ke),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),(t(!0),h(N,null,G(X.value,l=>(t(),h(N,{key:l.label},[!l.label.includes("Previous")&&!l.label.includes("Next")&&!l.label.includes("previous")&&!l.label.includes("next")?(t(),h(N,{key:0},[l.label==="..."?(t(),h("span",Aa," ... ")):(t(),C(e(M),{key:1,variant:l.active?"default":"outline",size:"sm",class:"h-8 min-w-[32px] px-2",disabled:e(g)||l.active,onClick:K=>F(l)},{default:r(()=>[z(P(l.label),1)]),_:2},1032,["variant","disabled","onClick"]))],64)):S("",!0)],64))),128)),s(e(M),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(A)||e(g),onClick:e(ee),title:"PÃ¡gina siguiente"},{default:r(()=>[s(e(ye),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),s(e(M),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(A)||e(g),onClick:p[2]||(p[2]=l=>e(Q)(e(T))),title:"Ãšltima pÃ¡gina"},{default:r(()=>[s(e(Ye),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])):S("",!0)]))]),_:1})]),_:1}))}});export{lt as _};
