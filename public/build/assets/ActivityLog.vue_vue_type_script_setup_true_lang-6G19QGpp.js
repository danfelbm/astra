import{_ as Z,a as ee,b as te,c as ae}from"./CardTitle.vue_vue_type_script_setup_true_lang-Dn6Y_7jM.js";import{_ as T}from"./Label.vue_vue_type_script_setup_true_lang-DoPMf_am.js";import{_ as $}from"./createLucideIcon-DI6U3gwA.js";import{_ as N,a as S,b as O,c as X,d as F,C as q}from"./SelectValue.vue_vue_type_script_setup_true_lang-CIqxaMm-.js";import{_ as ne,a as re,b as de}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-C5t5baIS.js";import{F as G}from"./filter-CEQhqhF7.js";import{X as j}from"./x-C1SerbTX.js";import{C as ie}from"./calendar-C6eInWsE.js";import{d as se,c as V,b as k,i as u,f as e,w as s,e as t,g as n,j as g,h as i,F as M,k as L,t as d,m as o,r as ue,p as ce,v as J,n as B}from"./app-B7PnGMAV.js";import{f as le,e as oe}from"./es-BDPlFIsO.js";import{_ as K,a as Q,b as W}from"./index-Dy_wxwuH.js";import{_ as fe}from"./CardDescription.vue_vue_type_script_setup_true_lang-VOU9gGEk.js";import{_ as I}from"./index-BTD9fiCJ.js";import{A as Y}from"./arrow-right-BPrvzWjL.js";import{p as _e}from"./parseISO-DFjB8F03.js";const me={class:"flex items-center justify-between"},pe={class:"flex items-center gap-2"},ge={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ve={key:0,class:"space-y-2"},xe={class:"flex gap-2"},he={key:1,class:"space-y-2"},ke={class:"flex gap-2"},be={class:"space-y-2"},ye={class:"flex gap-2"},we={class:"space-y-2"},$e={class:"flex gap-2"},Me={key:0,class:"text-sm"},Ce={key:1,class:"text-muted-foreground"},Ae={class:"p-3 space-y-2"},Pe=["value"],ze=["value"],Ee={key:1,class:"space-y-4"},He={class:"flex items-center justify-between"},Te={class:"flex items-center gap-2"},vt=se({__name:"ActivityFilters",props:{modelValue:{},usuarios:{default:()=>[]},contextLevel:{default:"proyecto"},showCard:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(v,{emit:P}){const z=v,C=P,c=V({get:()=>z.modelValue,set:m=>C("update:modelValue",m)}),E=V(()=>{const m=[];return z.contextLevel==="proyecto"?m.push({value:"Modules\\Proyectos\\Models\\Proyecto",label:"Proyecto"},{value:"Modules\\Proyectos\\Models\\Hito",label:"Hito"},{value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}):z.contextLevel==="hito"?m.push({value:"Modules\\Proyectos\\Models\\Hito",label:"Hito"},{value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}):m.push({value:"Modules\\Proyectos\\Models\\Entregable",label:"Entregable"}),m}),R=[{value:"created",label:"Creado"},{value:"updated",label:"Actualizado"},{value:"deleted",label:"Eliminado"},{value:"restored",label:"Restaurado"},{value:"custom",label:"Acción personalizada"}],y=(m,l)=>{c.value={...c.value,[m]:l}},A=m=>{y(m,null)},D=()=>{c.value={usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}},h=V(()=>Object.values(c.value).some(m=>m!=null)),U=m=>{if(!m)return"";try{return le(new Date(m),"d 'de' MMM yyyy",{locale:oe})}catch{return m}};return(m,l)=>v.showCard?(o(),k(e(Z),{key:0},{default:s(()=>[t(e(ee),{class:"pb-3"},{default:s(()=>[n("div",me,[n("div",pe,[t(e(G),{class:"h-4 w-4"}),t(e(te),{class:"text-base"},{default:s(()=>[...l[9]||(l[9]=[i("Filtros de Actividad",-1)])]),_:1})]),h.value?(o(),k(e($),{key:0,variant:"ghost",size:"sm",onClick:D},{default:s(()=>[t(e(j),{class:"h-4 w-4 mr-1"}),l[10]||(l[10]=i(" Limpiar ",-1))]),_:1})):g("",!0)])]),_:1}),t(e(ae),null,{default:s(()=>{var H;return[n("div",ge,[v.usuarios.length>0?(o(),u("div",ve,[t(e(T),{for:"usuario"},{default:s(()=>[...l[11]||(l[11]=[i("Usuario",-1)])]),_:1}),n("div",xe,[t(e(N),{"model-value":(H=c.value.usuario_id)==null?void 0:H.toString(),"onUpdate:modelValue":l[0]||(l[0]=r=>y("usuario_id",r?parseInt(r):null))},{default:s(()=>[t(e(S),{id:"usuario"},{default:s(()=>[t(e(O),{placeholder:"Todos los usuarios"})]),_:1}),t(e(X),null,{default:s(()=>[t(e(F),{value:"null"},{default:s(()=>[...l[12]||(l[12]=[i("Todos los usuarios",-1)])]),_:1}),(o(!0),u(M,null,L(v.usuarios,r=>(o(),k(e(F),{key:r.id,value:r.id.toString()},{default:s(()=>[i(d(r.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),c.value.usuario_id?(o(),k(e($),{key:0,variant:"ghost",size:"icon",onClick:l[1]||(l[1]=r=>A("usuario_id"))},{default:s(()=>[t(e(j),{class:"h-4 w-4"})]),_:1})):g("",!0)])])):g("",!0),E.value.length>1?(o(),u("div",he,[t(e(T),{for:"tipo-entidad"},{default:s(()=>[...l[13]||(l[13]=[i("Tipo de Entidad",-1)])]),_:1}),n("div",ke,[t(e(N),{"model-value":c.value.tipo_entidad||"null","onUpdate:modelValue":l[2]||(l[2]=r=>y("tipo_entidad",r==="null"?null:r))},{default:s(()=>[t(e(S),{id:"tipo-entidad"},{default:s(()=>[t(e(O),{placeholder:"Todas las entidades"})]),_:1}),t(e(X),null,{default:s(()=>[t(e(F),{value:"null"},{default:s(()=>[...l[14]||(l[14]=[i("Todas las entidades",-1)])]),_:1}),(o(!0),u(M,null,L(E.value,r=>(o(),k(e(F),{key:r.value,value:r.value},{default:s(()=>[i(d(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),c.value.tipo_entidad?(o(),k(e($),{key:0,variant:"ghost",size:"icon",onClick:l[3]||(l[3]=r=>A("tipo_entidad"))},{default:s(()=>[t(e(j),{class:"h-4 w-4"})]),_:1})):g("",!0)])])):g("",!0),n("div",be,[t(e(T),{for:"tipo-accion"},{default:s(()=>[...l[15]||(l[15]=[i("Tipo de Acción",-1)])]),_:1}),n("div",ye,[t(e(N),{"model-value":c.value.tipo_accion||"null","onUpdate:modelValue":l[4]||(l[4]=r=>y("tipo_accion",r==="null"?null:r))},{default:s(()=>[t(e(S),{id:"tipo-accion"},{default:s(()=>[t(e(O),{placeholder:"Todas las acciones"})]),_:1}),t(e(X),null,{default:s(()=>[t(e(F),{value:"null"},{default:s(()=>[...l[16]||(l[16]=[i("Todas las acciones",-1)])]),_:1}),(o(),u(M,null,L(R,r=>t(e(F),{key:r.value,value:r.value},{default:s(()=>[i(d(r.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value"]),c.value.tipo_accion?(o(),k(e($),{key:0,variant:"ghost",size:"icon",onClick:l[5]||(l[5]=r=>A("tipo_accion"))},{default:s(()=>[t(e(j),{class:"h-4 w-4"})]),_:1})):g("",!0)])]),n("div",we,[t(e(T),null,{default:s(()=>[...l[17]||(l[17]=[i("Rango de Fechas",-1)])]),_:1}),n("div",$e,[t(e(ne),null,{default:s(()=>[t(e(re),{"as-child":""},{default:s(()=>[t(e($),{variant:"outline",class:"w-full justify-start text-left font-normal"},{default:s(()=>[t(e(ie),{class:"mr-2 h-4 w-4"}),c.value.fecha_inicio||c.value.fecha_fin?(o(),u("span",Me,d(c.value.fecha_inicio?U(c.value.fecha_inicio):"...")+" - "+d(c.value.fecha_fin?U(c.value.fecha_fin):"..."),1)):(o(),u("span",Ce,"Seleccionar rango"))]),_:1})]),_:1}),t(e(de),{class:"w-auto p-0",align:"start"},{default:s(()=>[n("div",Ae,[n("div",null,[t(e(T),{class:"text-xs"},{default:s(()=>[...l[18]||(l[18]=[i("Desde",-1)])]),_:1}),n("input",{type:"date",value:c.value.fecha_inicio||"",onInput:l[6]||(l[6]=r=>y("fecha_inicio",r.target.value)),class:"w-full mt-1 px-3 py-2 border rounded-md text-sm"},null,40,Pe)]),n("div",null,[t(e(T),{class:"text-xs"},{default:s(()=>[...l[19]||(l[19]=[i("Hasta",-1)])]),_:1}),n("input",{type:"date",value:c.value.fecha_fin||"",onInput:l[7]||(l[7]=r=>y("fecha_fin",r.target.value)),class:"w-full mt-1 px-3 py-2 border rounded-md text-sm"},null,40,ze)])])]),_:1})]),_:1}),c.value.fecha_inicio||c.value.fecha_fin?(o(),k(e($),{key:0,variant:"ghost",size:"icon",onClick:l[8]||(l[8]=r=>{A("fecha_inicio"),A("fecha_fin")})},{default:s(()=>[t(e(j),{class:"h-4 w-4"})]),_:1})):g("",!0)])])])]}),_:1})]),_:1})):(o(),u("div",Ee,[n("div",He,[n("div",Te,[t(e(G),{class:"h-4 w-4"}),l[20]||(l[20]=n("h3",{class:"text-sm font-medium"},"Filtros",-1))]),h.value?(o(),k(e($),{key:0,variant:"ghost",size:"sm",onClick:D},{default:s(()=>[t(e(j),{class:"h-4 w-4 mr-1"}),l[21]||(l[21]=i(" Limpiar ",-1))]),_:1})):g("",!0)]),l[22]||(l[22]=n("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},null,-1))]))}}),Fe={class:"flex items-center justify-between"},je={key:0,class:"text-xs text-muted-foreground"},Ve={key:0,class:"space-y-4"},De={class:"flex-1 min-w-0"},Ue={class:"text-sm"},Le={key:0,class:"inline-flex items-center gap-1.5 mt-1.5 flex-wrap"},Re={class:"flex items-center gap-2 mt-1"},Be={class:"text-xs text-muted-foreground"},Ie={key:0,class:"text-xs text-muted-foreground"},Ne={key:0,class:"pt-2 text-center"},Se={key:1,class:"text-center py-8"},Oe={class:"text-sm text-muted-foreground"},Xe={key:1},qe={key:0,class:"space-y-4"},Ge={class:"flex-1 min-w-0"},Je={class:"text-sm"},Ke={key:0,class:"inline-flex items-center gap-1.5 mt-1.5 flex-wrap"},Qe={class:"flex items-center gap-2 mt-1"},We={class:"text-xs text-muted-foreground"},Ye={key:0,class:"text-xs text-muted-foreground"},Ze={key:0,class:"pt-2 text-center"},et={key:1,class:"text-center py-8"},tt={class:"text-sm text-muted-foreground"},xt=se({__name:"ActivityLog",props:{activities:{},title:{default:"Historial de Actividad"},description:{default:"Registro completo de cambios y eventos"},emptyMessage:{default:"No hay actividad registrada"},showCard:{type:Boolean,default:!0},perPage:{default:20}},setup(v){const P=v,z=ue(1),C=V(()=>{const p=z.value*P.perPage;return P.activities.slice(0,p)}),c=V(()=>C.value.length<P.activities.length),E=V(()=>P.activities.length),R=()=>{z.value++};ce(()=>P.activities,()=>{z.value=1},{deep:!0});const y=f=>{try{const p=_e(f),b=new Date().getTime()-p.getTime(),x=Math.floor(b/6e4),_=Math.floor(b/36e5),w=Math.floor(b/864e5);return x<1?"Hace un momento":x<60?`Hace ${x} ${x===1?"minuto":"minutos"}`:_<24?`Hace ${_} ${_===1?"hora":"horas"}`:w<7?`Hace ${w} ${w===1?"día":"días"}`:le(p,"d 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:oe})}catch{return f}},A=f=>f?f.split(" ").map(p=>p[0]).join("").toUpperCase().slice(0,2):"SI",D=f=>{if(!f)return"";const p=f.split("\\");return p[p.length-1]},h=f=>{const p=f.description||"",a=f.properties;if(a!=null&&a.entidad_url&&(a!=null&&a.entidad_nombre)&&(a!=null&&a.entidad_tipo)){const b=new RegExp(`(.*)(en ${a.entidad_tipo} ')([^']+)('.*)`),x=p.match(b);if(x)return{before:x[1]+`en ${a.entidad_tipo} '`,linkText:x[3],linkUrl:a.entidad_url,after:x[4]}}return{text:p}},U=f=>{var p,a;return f.event==="state_changed"&&((p=f.properties)==null?void 0:p.old_value)&&((a=f.properties)==null?void 0:a.new_value)},m={planificacion:"Planificación",en_progreso:"En Progreso",pausado:"Pausado",completado:"Completado",cancelado:"Cancelado",pendiente:"Pendiente",aprobada:"Aprobada",rechazada:"Rechazada"},l={pendiente:"gray",planificacion:"blue",en_progreso:"yellow",pausado:"orange",completado:"green",cancelado:"red",aprobada:"green",rechazada:"red"},H=f=>m[f]||f,r=f=>{const p=l[f]||"gray",a={green:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",red:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",gray:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"};return a[p]||a.gray};return(f,p)=>v.showCard?(o(),k(e(Z),{key:0},{default:s(()=>[t(e(ee),null,{default:s(()=>[n("div",Fe,[n("div",null,[t(e(te),null,{default:s(()=>[i(d(v.title),1)]),_:1}),t(e(fe),null,{default:s(()=>[i(d(v.description),1)]),_:1})]),E.value>0?(o(),u("span",je,d(C.value.length)+" de "+d(E.value),1)):g("",!0)])]),_:1}),t(e(ae),null,{default:s(()=>[v.activities&&v.activities.length>0?(o(),u("div",Ve,[(o(!0),u(M,null,L(C.value,a=>{var b,x;return o(),u("div",{key:a.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[t(e(K),{class:"h-8 w-8 flex-shrink-0"},{default:s(()=>{var _;return[(_=a.causer)!=null&&_.avatar?(o(),k(e(Q),{key:0,src:a.causer.avatar},null,8,["src"])):g("",!0),t(e(W),null,{default:s(()=>{var w;return[i(d(A(((w=a.causer)==null?void 0:w.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),n("div",De,[n("p",Ue,[h(a).linkUrl?(o(),u(M,{key:0},[n("span",null,d(h(a).before),1),t(e(J),{href:h(a).linkUrl,class:"font-medium text-primary hover:underline"},{default:s(()=>[i(d(h(a).linkText),1)]),_:2},1032,["href"]),n("span",null,d(h(a).after),1)],64)):(o(),u(M,{key:1},[i(d(a.description),1)],64))]),U(a)?(o(),u("div",Le,[t(e(I),{variant:"outline",class:B(["text-xs h-5 font-normal",r((b=a.properties)==null?void 0:b.old_value)])},{default:s(()=>{var _;return[i(d(H((_=a.properties)==null?void 0:_.old_value)),1)]}),_:2},1032,["class"]),t(e(Y),{class:"h-3 w-3 text-muted-foreground flex-shrink-0"}),t(e(I),{variant:"outline",class:B(["text-xs h-5 font-medium",r((x=a.properties)==null?void 0:x.new_value)])},{default:s(()=>{var _;return[i(d(H((_=a.properties)==null?void 0:_.new_value)),1)]}),_:2},1032,["class"])])):g("",!0),n("div",Re,[n("p",Be,d(y(a.created_at)),1),a.subject_type?(o(),u("span",Ie," • "+d(D(a.subject_type)),1)):g("",!0)])])])}),128)),c.value?(o(),u("div",Ne,[t(e($),{variant:"ghost",size:"sm",onClick:R,class:"text-muted-foreground"},{default:s(()=>[t(e(q),{class:"h-4 w-4 mr-1"}),i(" Cargar más ("+d(E.value-C.value.length)+" restantes) ",1)]),_:1})])):g("",!0)])):(o(),u("div",Se,[n("p",Oe,d(v.emptyMessage),1)]))]),_:1})]),_:1})):(o(),u("div",Xe,[v.activities&&v.activities.length>0?(o(),u("div",qe,[(o(!0),u(M,null,L(C.value,a=>{var b,x;return o(),u("div",{key:a.id,class:"flex gap-3 pb-4 border-b last:border-0 dark:border-gray-700"},[t(e(K),{class:"h-8 w-8 flex-shrink-0"},{default:s(()=>{var _;return[(_=a.causer)!=null&&_.avatar?(o(),k(e(Q),{key:0,src:a.causer.avatar},null,8,["src"])):g("",!0),t(e(W),null,{default:s(()=>{var w;return[i(d(A(((w=a.causer)==null?void 0:w.name)||"Sistema")),1)]}),_:2},1024)]}),_:2},1024),n("div",Ge,[n("p",Je,[h(a).linkUrl?(o(),u(M,{key:0},[n("span",null,d(h(a).before),1),t(e(J),{href:h(a).linkUrl,class:"font-medium text-primary hover:underline"},{default:s(()=>[i(d(h(a).linkText),1)]),_:2},1032,["href"]),n("span",null,d(h(a).after),1)],64)):(o(),u(M,{key:1},[i(d(a.description),1)],64))]),U(a)?(o(),u("div",Ke,[t(e(I),{variant:"outline",class:B(["text-xs h-5 font-normal",r((b=a.properties)==null?void 0:b.old_value)])},{default:s(()=>{var _;return[i(d(H((_=a.properties)==null?void 0:_.old_value)),1)]}),_:2},1032,["class"]),t(e(Y),{class:"h-3 w-3 text-muted-foreground flex-shrink-0"}),t(e(I),{variant:"outline",class:B(["text-xs h-5 font-medium",r((x=a.properties)==null?void 0:x.new_value)])},{default:s(()=>{var _;return[i(d(H((_=a.properties)==null?void 0:_.new_value)),1)]}),_:2},1032,["class"])])):g("",!0),n("div",Qe,[n("p",We,d(y(a.created_at)),1),a.subject_type?(o(),u("span",Ye," • "+d(D(a.subject_type)),1)):g("",!0)])])])}),128)),c.value?(o(),u("div",Ze,[t(e($),{variant:"ghost",size:"sm",onClick:R,class:"text-muted-foreground"},{default:s(()=>[t(e(q),{class:"h-4 w-4 mr-1"}),i(" Cargar más ("+d(E.value-C.value.length)+" restantes) ",1)]),_:1})])):g("",!0)])):(o(),u("div",et,[n("p",tt,d(v.emptyMessage),1)]))]))}});export{vt as _,xt as a};
