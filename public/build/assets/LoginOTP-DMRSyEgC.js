import{d as H,r as x,c as T,o as D,y as Q,b as C,e as t,I as G,w as u,i as a,j as w,f as o,u as e,h as r,g as i,t as c,a as L,C as A,p as J,l as M,n as K,F as Y,k as Z}from"./app-B7JHmzZ3.js";import{_ as W}from"./InputError.vue_vue_type_script_setup_true_lang-DsLbAXAC.js";import{a as ee,b as te,c as se,_ as ae}from"./CardTitle.vue_vue_type_script_setup_true_lang-xUjjE8IK.js";import{_ as B,a as F}from"./index-B33DXrho.js";import{_ as O}from"./AlertTitle.vue_vue_type_script_setup_true_lang-Bkd9X7Ze.js";import{_ as oe}from"./index-rxln-YzF.js";import{_ as R}from"./createLucideIcon-fGeWyvG_.js";import{_ as ne}from"./Progress.vue_vue_type_script_setup_true_lang-Dj630CNs.js";import{_ as z}from"./Skeleton.vue_vue_type_script_setup_true_lang-CnXUKbSY.js";import{L as V}from"./loader-circle-DSjk3Wn9.js";import{C as ie}from"./clock-DQhl_-hl.js";import{C as le}from"./circle-alert-C_k_uumx.js";import{T as re}from"./timer-CYXTT6S-.js";import{I as de}from"./info-C0X0fvmO.js";import{R as ue}from"./refresh-cw-COIxsrF8.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as pe}from"./Input.vue_vue_type_script_setup_true_lang-B6w5yMA0.js";import{_ as N}from"./Label.vue_vue_type_script_setup_true_lang-fFAFaom6.js";import{_ as me,a as fe,b as ve}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-M2gkMWbr.js";import{_ as _e}from"./AuthLayout.vue_vue_type_script_setup_true_lang-DEn0huc-.js";import{M as he}from"./mail-FEyEUa_K.js";import"./index-CBze1Ugy.js";import"./VisuallyHidden-C5pU9xhK.js";import"./nullish-CHIgUVhi.js";import"./useArrowNavigation-B5rxJs06.js";import"./VisuallyHiddenInput-BHNykh89.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CLZMVAKW.js";const ge={key:0,class:"mt-4"},ye={key:0,class:"space-y-3"},be={key:1,class:"space-y-4"},xe={key:0,class:"space-y-2"},ke={class:"flex items-center justify-between"},we={class:"text-sm text-muted-foreground"},Ce={key:1,class:"space-y-2"},$e={key:2,class:"space-y-2"},Ie={class:"flex items-center justify-between"},Ee={class:"text-sm font-medium"},Re={class:"flex items-center gap-2 text-xs text-muted-foreground"},Te={key:3,class:"mt-4 pt-4 border-t"},Se={key:2,class:"text-center py-4"},je=H({__name:"OTPQueueStatus",props:{type:{},identifier:{},autoRefresh:{type:Boolean,default:!0},refreshInterval:{default:5e3},showRateLimitInfo:{type:Boolean,default:!0}},emits:["statusUpdate","error"],setup(P,{emit:p}){const f=P,_=p,m=x(!1),h=x(!1),s=x(null),b=x(5),v=x(null),g=x(null),y=T(()=>{if(!s.value||s.value.total_ahead===0)return 100;const k=s.value.position+10,l=k-s.value.position;return Math.min(100,Math.round(l/k*100))}),S=T(()=>f.type==="email"?2:5),$=async()=>{var k;m.value=!0;try{const l=await L.get(`/api/queue/otp/position/${encodeURIComponent(f.identifier)}`,{params:{type:f.type}});l.data.success&&(s.value=l.data.data,h.value=!0,_("statusUpdate",s.value),s.value.position===0&&j())}catch(l){if(((k=l.response)==null?void 0:k.status)===404)try{const d=await L.get("/api/queue/otp/estimate",{params:{type:f.type}});d.data.success&&(s.value=d.data.data,h.value=!0,_("statusUpdate",s.value))}catch(d){console.error("Error obteniendo estimación:",d),_("error",d)}else console.error("Error verificando estado:",l),_("error",l)}finally{m.value=!1}},I=()=>{f.autoRefresh&&(v.value=window.setInterval(()=>{$(),U()},f.refreshInterval),g.value=window.setInterval(()=>{b.value=Math.max(0,b.value-1)},1e3))},j=()=>{v.value&&(clearInterval(v.value),v.value=null),g.value&&(clearInterval(g.value),g.value=null)},U=()=>{b.value=Math.floor(f.refreshInterval/1e3)};return D(()=>{$(),I()}),Q(()=>{j()}),(k,l)=>(t(),C(G,{name:"fade"},{default:u(()=>[h.value?(t(),a("div",ge,[o(e(ae),null,{default:u(()=>[o(e(ee),null,{default:u(()=>[o(e(te),{class:"flex items-center gap-2"},{default:u(()=>[m.value?(t(),C(e(V),{key:0,class:"h-4 w-4 animate-spin"})):(t(),C(e(ie),{key:1,class:"h-4 w-4"})),l[0]||(l[0]=r(" Estado de envío de tu código ",-1))]),_:1})]),_:1}),o(e(se),null,{default:u(()=>[m.value?(t(),a("div",ye,[o(e(z),{class:"h-4 w-full"}),o(e(z),{class:"h-4 w-3/4"})])):s.value?(t(),a("div",be,[s.value.position>1?(t(),a("div",xe,[i("div",ke,[l[1]||(l[1]=i("span",{class:"text-sm text-muted-foreground"},"Posición en cola",-1)),o(e(oe),{variant:"secondary"},{default:u(()=>[r(c(s.value.position),1)]),_:1})]),o(e(ne),{value:y.value,class:"h-2"},null,8,["value"]),i("p",we,c(s.value.total_ahead)+" personas delante de ti ",1)])):s.value.position===1?(t(),a("div",Ce,[o(e(B),null,{default:u(()=>[o(e(le),{class:"h-4 w-4"}),o(e(O),null,{default:u(()=>[...l[2]||(l[2]=[r("Procesando tu solicitud",-1)])]),_:1}),o(e(F),null,{default:u(()=>[...l[3]||(l[3]=[r(" Tu código está siendo enviado en este momento... ",-1)])]),_:1})]),_:1})])):w("",!0),s.value.estimated_seconds>0?(t(),a("div",$e,[i("div",Ie,[l[4]||(l[4]=i("span",{class:"text-sm text-muted-foreground"},"Tiempo estimado",-1)),i("span",Ee,c(s.value.estimated_time),1)]),i("div",Re,[o(e(re),{class:"h-3 w-3"}),i("span",null,"Actualizando en "+c(b.value)+"s",1)])])):w("",!0),k.showRateLimitInfo?(t(),a("div",Te,[o(e(B),{variant:"info"},{default:u(()=>[o(e(de),{class:"h-4 w-4"}),o(e(O),null,{default:u(()=>[...l[5]||(l[5]=[r("¿Por qué la espera?",-1)])]),_:1}),o(e(F),null,{default:u(()=>[r(" Para garantizar la entrega confiable de mensajes, procesamos "+c(S.value)+" "+c(k.type==="email"?"correos":"mensajes")+" por segundo. Esto nos ayuda a mantener un servicio estable para todos. ",1)]),_:1})]),_:1})])):w("",!0)])):(t(),a("div",Se,[l[7]||(l[7]=i("p",{class:"text-sm text-muted-foreground"}," No se pudo obtener el estado de la cola ",-1)),o(e(R),{onClick:$,variant:"ghost",size:"sm",class:"mt-2"},{default:u(()=>[o(e(ue),{class:"h-3 w-3 mr-2"}),l[6]||(l[6]=r(" Reintentar ",-1))]),_:1})]))]),_:1})]),_:1})])):w("",!0)]),_:1}))}}),q=ce(je,[["__scopeId","data-v-4203e165"]]),Ve={key:0,class:"mb-4 text-center text-muted-foreground"},Pe={key:0},Ue={key:0},Ae={key:1},qe={key:2},Le={key:3},Me={key:1},We={key:1,class:"mb-4 text-center text-muted-foreground"},Be={key:0},Fe={key:1},Oe={key:2},ze={key:2,class:"mb-4 text-center text-sm font-medium text-green-600"},Ne={class:"grid gap-6"},He={class:"grid gap-2"},De={class:"relative"},Qe={class:"grid gap-6"},Xe={class:"text-center"},Ge={class:"text-sm text-muted-foreground"},Je={key:0},Ke={key:0},Ye={class:"font-medium"},Ze={key:1},et={class:"font-medium"},tt={key:2},st={class:"font-medium"},at={key:1},ot={key:0},nt={class:"font-medium"},it={key:1},lt={class:"font-medium"},rt={class:"font-medium"},dt={key:2},ut={class:"font-medium"},ct={class:"font-medium"},pt={key:0},mt={key:1},ft={class:"grid gap-2"},vt={class:"flex justify-center"},_t={class:"flex flex-col gap-3"},ht={class:"flex flex-col gap-2 text-center"},gt={class:"mt-6 text-center text-xs text-muted-foreground"},yt={key:0},bt={key:1},xt=["innerHTML"],Gt=H({__name:"LoginOTP",props:{status:{},authConfig:{},censoredEmail:{},otpCredential:{},otpChannel:{},whatsappEnabled:{type:Boolean},intendedUrl:{}},setup(P){const p=P,f=x(p.censoredEmail?"otp":"credential"),_=x(p.censoredEmail||""),m=T(()=>p.authConfig||{login_type:"email",input_type:"email",placeholder:"correo@ejemplo.com",pattern:null,label:"Correo Electrónico"}),h=A({credential:""}),s=A({credential:p.otpCredential||"",otp_code:[]}),b=A({credential:"",otp_code:""}),v=x(!1),g=x(0),y=x(null),S=T(()=>g.value===0),$=T(()=>g.value>0?`Reenviar en ${g.value}s`:"Reenviar código"),I=(d=60)=>{g.value=d,y.value&&clearInterval(y.value),y.value=window.setInterval(()=>{g.value--,g.value<=0&&(clearInterval(y.value),y.value=null)},1e3)},j=()=>{v.value=!0,h.post(route("auth.request-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),f.value="otp",s.credential=h.credential,s.clearErrors(),I(60)},onError:()=>{},onFinish:()=>{v.value=!1}})},U=()=>{const d=s.otp_code.join("");b.credential=s.credential,b.otp_code=d,b.post(route("auth.verify-otp"),{onSuccess:()=>{},onError:()=>{s.otp_code=[]}})},k=()=>{S.value&&(v.value=!0,s.post(route("auth.resend-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),I(60)},onFinish:()=>{v.value=!1}}))},l=()=>{f.value="credential",s.reset(),y.value&&(clearInterval(y.value),y.value=null),g.value=0};return D(()=>{f.value==="otp"&&I(60);const d=localStorage.getItem("intendedUrl");d&&!p.intendedUrl&&fetch("/login?intended="+encodeURIComponent(d),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{localStorage.removeItem("intendedUrl")})}),Q(()=>{y.value&&clearInterval(y.value)}),(d,n)=>(t(),C(_e,{title:f.value==="credential"?"Iniciar Sesión":"Verificar Código"},{default:u(()=>[o(e(J),{title:"Iniciar Sesión"}),f.value==="credential"?(t(),a("div",Ve,[m.value.login_type==="documento"?(t(),a("p",Pe,[n[2]||(n[2]=r(" Ingresa tu documento de identidad para recibir el código de verificación ",-1)),d.whatsappEnabled?p.otpChannel==="whatsapp"?(t(),a("strong",Ae,"vía WhatsApp")):p.otpChannel==="both"?(t(),a("strong",qe,"vía correo electrónico y WhatsApp")):(t(),a("strong",Le,"vía correo electrónico")):(t(),a("strong",Ue,"vía correo electrónico"))])):(t(),a("p",Me," Ingresa tu "+c(m.value.label.toLowerCase())+" para recibir el código de verificación ",1))])):(t(),a("div",We,[p.otpChannel==="whatsapp"?(t(),a("p",Be,[...n[3]||(n[3]=[r(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"WhatsApp",-1)])])):p.otpChannel==="both"?(t(),a("p",Fe,[...n[4]||(n[4]=[r(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"correo y WhatsApp",-1)])])):(t(),a("p",Oe,[...n[5]||(n[5]=[r(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"correo",-1)])]))])),d.status?(t(),a("div",ze,c(d.status),1)):w("",!0),f.value==="credential"?(t(),a("form",{key:3,onSubmit:M(j,["prevent"]),class:"flex flex-col gap-6"},[i("div",Ne,[i("div",He,[o(e(N),{for:"credential"},{default:u(()=>[r(c(m.value.label),1)]),_:1}),i("div",De,[m.value.login_type==="email"?(t(),C(e(he),{key:0,class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})):w("",!0),o(e(pe),{id:"credential",type:m.value.input_type,required:"",autofocus:"",tabindex:"1",autocomplete:m.value.login_type==="email"?"email":"off",inputmode:m.value.login_type==="documento"?"numeric":void 0,modelValue:e(h).credential,"onUpdate:modelValue":n[0]||(n[0]=E=>e(h).credential=E),placeholder:m.value.placeholder,pattern:m.value.pattern,class:K({"pl-10":m.value.login_type==="email"})},null,8,["type","autocomplete","inputmode","modelValue","placeholder","pattern","class"])]),o(W,{message:e(h).errors.credential},null,8,["message"])]),o(e(R),{type:"submit",class:"mt-4 w-full",tabindex:"2",disabled:e(h).processing||v.value},{default:u(()=>[e(h).processing||v.value?(t(),C(e(V),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):w("",!0),r(" "+c(e(h).processing||v.value?"Enviando...":"Enviar Código"),1)]),_:1},8,["disabled"])])],32)):(t(),a("form",{key:4,onSubmit:M(U,["prevent"]),class:"flex flex-col gap-6"},[i("div",Qe,[i("div",Xe,[i("p",Ge,[m.value.login_type==="email"?(t(),a("span",Je,[p.otpChannel==="whatsapp"?(t(),a("span",Ke,[n[6]||(n[6]=r(" Código enviado por WhatsApp al número asociado con ",-1)),i("span",Ye,c(_.value||e(s).credential),1)])):p.otpChannel==="both"?(t(),a("span",Ze,[n[7]||(n[7]=r(" Código enviado al email ",-1)),i("span",et,c(_.value||e(s).credential),1),n[8]||(n[8]=r(" y WhatsApp ",-1))])):(t(),a("span",tt,[n[9]||(n[9]=r(" Código enviado al email ",-1)),i("span",st,c(_.value||e(s).credential),1)]))])):(t(),a("span",at,[p.otpChannel==="whatsapp"?(t(),a("span",ot,[n[10]||(n[10]=r(" Código enviado por WhatsApp al número asociado con el documento ",-1)),i("span",nt,c(e(s).credential),1)])):p.otpChannel==="both"?(t(),a("span",it,[n[11]||(n[11]=r(" Código enviado al email ",-1)),i("span",lt,c(_.value),1),n[12]||(n[12]=r(" y WhatsApp asociados al documento ",-1)),i("span",rt,c(e(s).credential),1)])):(t(),a("span",dt,[n[13]||(n[13]=r(" Código enviado al email ",-1)),i("span",ut,c(_.value),1),n[14]||(n[14]=r(" asociado al documento ",-1)),i("span",ct,c(e(s).credential),1)]))]))])]),p.otpChannel==="both"?(t(),a("div",pt,[o(q,{type:"email",identifier:_.value||e(s).credential,"show-rate-limit-info":!0},null,8,["identifier"]),o(q,{type:"whatsapp",identifier:e(s).credential,"show-rate-limit-info":!0},null,8,["identifier"])])):(t(),a("div",mt,[o(q,{type:p.otpChannel==="whatsapp"?"whatsapp":"email",identifier:p.otpChannel==="whatsapp"?e(s).credential:_.value||e(s).credential,"show-rate-limit-info":!0},null,8,["type","identifier"])])),i("div",ft,[o(e(N),{class:"text-center"},{default:u(()=>[...n[15]||(n[15]=[r("Código de Verificación",-1)])]),_:1}),i("div",vt,[o(e(me),{modelValue:e(s).otp_code,"onUpdate:modelValue":n[1]||(n[1]=E=>e(s).otp_code=E),length:6,type:"text",placeholder:"0",class:"gap-2"},{default:u(()=>[o(e(fe),null,{default:u(()=>[(t(),a(Y,null,Z(6,(E,X)=>o(e(ve),{key:E,index:X,class:"h-12 w-12 text-lg font-medium",inputmode:"numeric"},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue"])]),o(W,{message:e(s).errors.otp_code},null,8,["message"])]),i("div",_t,[o(e(R),{type:"submit",class:"w-full",disabled:e(b).processing||e(s).otp_code.join("").length!==6},{default:u(()=>[e(b).processing?(t(),C(e(V),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):w("",!0),r(" "+c(e(b).processing?"Verificando...":"Verificar Código"),1)]),_:1},8,["disabled"]),i("div",ht,[o(e(R),{type:"button",variant:"ghost",size:"sm",onClick:k,disabled:!S.value||v.value},{default:u(()=>[v.value?(t(),C(e(V),{key:0,class:"mr-2 h-3 w-3 animate-spin"})):w("",!0),r(" "+c(v.value?"Enviando...":$.value),1)]),_:1},8,["disabled"]),o(e(R),{type:"button",variant:"ghost",size:"sm",onClick:l},{default:u(()=>[r(c(m.value.login_type==="email"?"Cambiar correo electrónico":"Cambiar documento"),1)]),_:1})])])])],32)),i("div",gt,[f.value==="credential"?(t(),a("p",yt," Solo personas registradas como militantes pueden acceder al sistema. ")):(t(),a("p",bt," El código expira en 10 minutos. Si no lo recibes, verifica tu bandeja de spam. ")),n[16]||(n[16]=i("br",null,null,-1)),i("p",{innerHTML:d.$page.props.config["auth.mensaje_login"]||"Si necesitas ayuda escribe a <b>soporte@colombiahumana.co</b> para soporte sobre la plataforma. Para inquietudes jurídicas a <b>juridicoelectoral@colombiahumana.co</b>"},null,8,xt)])]),_:1},8,["title"]))}});export{Gt as default};
