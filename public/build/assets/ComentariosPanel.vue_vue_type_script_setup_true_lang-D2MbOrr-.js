import{r as M,c as q,d as J,i as _,e as a,g as b,f as e,t as R,m as s,p as be,b as E,w as c,j as $,n as ee,h as P,F as N,k as G,x as Ee,I as Me,o as Se}from"./app-CqrxAVE4.js";import{_ as ke,c as we,b as Pe,a as je}from"./CardTitle.vue_vue_type_script_setup_true_lang-Dx42q8co.js";import{_ as Te}from"./CardDescription.vue_vue_type_script_setup_true_lang-DMjzisnv.js";import{c as se,_ as I}from"./createLucideIcon-BgvNgHlT.js";import{_ as ge}from"./Skeleton.vue_vue_type_script_setup_true_lang-CBrtr02R.js";import{C as ye,_ as ze,a as qe,b as Ie,c as Le,d as Ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-D00Vodyw.js";import{R as Ue}from"./RichTextEditor-BhjmvMgm.js";import{_ as Be}from"./FileUploadField.vue_vue_type_script_setup_true_lang-jo661j0c.js";import{X as Ve}from"./x-B5SFulEs.js";import{P as De}from"./paperclip-DOe0L4cA.js";import{L as Xe}from"./loader-circle-DNaslWeB.js";import{S as Fe}from"./send-CbWHlfjL.js";import{b as Ne,_ as Oe}from"./index-DD5KrQ7V.js";import{_ as ue}from"./index-CJJGyBEY.js";import{b as He,c as Qe,g as _e,d as We}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DXvTGocI.js";import{_ as Ke,a as Ge,b as Je}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CLigi8h5.js";import{e as Ze,_ as Ye,a as et,b as tt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DMJcMeWk.js";import{E as at}from"./external-link-BU2oV4Qw.js";import{D as ve}from"./download-DS21621f.js";import{I as st}from"./image-DgpsbWlS.js";import{F as ot}from"./file-text-DpDhqzMk.js";import{A as nt}from"./arrow-right-BaWGYQU_.js";import{C as rt}from"./clock-B2O0ftAp.js";import{M as he}from"./message-square-BSV6Lsrw.js";import{E as lt}from"./ellipsis-CPOWMqh9.js";import{S as it}from"./square-pen-B9ObDY72.js";import{T as ct}from"./trash-2-CQddMBHD.js";import{C as Ce}from"./chevron-right-D5BxyZ38.js";import{t as O}from"./index-v3LDUSPx.js";import{C as ut}from"./chevron-left-CdIHvWNI.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=se("ArrowUpDownIcon",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=se("ChevronsLeftIcon",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=se("ChevronsRightIcon",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=se("FileSpreadsheetIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=se("QuoteIcon",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=se("SmilePlusIcon",[["path",{d:"M22 11v1a10 10 0 1 1-9-10",key:"ew0xw9"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}],["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}]]);function vt(t,j,v={}){const{paginaInicial:f=1,urlParam:S="pagina",sincronizarUrl:w=!0}=v,h=M([]),u=M(!1),x=M(null),r=M(f),k=M(1),d=M(0),V=M(0),B=M(0),T=M([]),C=M("recientes"),D={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},X=`/api/comentarios/${t}/${j}`,oe=m=>{if(!w)return;const y=new URL(window.location.href);m>1?y.searchParams.set(S,String(m)):y.searchParams.delete(S),window.history.replaceState({},"",y.toString())},W=async(m,y=!0)=>{const l=m??r.value;u.value=!0,x.value=null;try{const i=new URLSearchParams({page:String(l),sort:C.value}),o=await(await fetch(`${X}?${i}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();if(o.success&&o.data)h.value=o.data.data,r.value=o.data.current_page,k.value=o.data.last_page,d.value=o.data.total,V.value=o.data.from||0,B.value=o.data.to||0,T.value=o.data.links||[],y&&oe(l);else throw new Error(o.message||"Error al cargar comentarios")}catch(i){x.value=i instanceof Error?i.message:"Error desconocido",console.error("Error cargando comentarios:",i)}finally{u.value=!1}},te=async m=>{m!==C.value&&(C.value=m,await W(1))},ae=async m=>{m>=1&&m<=k.value&&m!==r.value&&await W(m)},ne=async()=>{r.value<k.value&&await W(r.value+1)},re=async()=>{r.value>1&&await W(r.value-1)},le=async m=>{u.value=!0,x.value=null;try{const l=await(await fetch(X,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin",body:JSON.stringify(m)})).json();return l.success&&l.comentario&&(m.parent_id?F(m.parent_id,l.comentario):(h.value=[l.comentario,...h.value],d.value++)),l}catch(y){const l=y instanceof Error?y.message:"Error al crear comentario";return x.value=l,{success:!1,message:l}}finally{u.value=!1}},ie=async(m,y)=>{u.value=!0,x.value=null;try{const i=await(await fetch(`/api/comentarios/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin",body:JSON.stringify(y)})).json();return i.success&&i.comentario&&U(i.comentario),i}catch(l){const i=l instanceof Error?l.message:"Error al actualizar comentario";return x.value=i,{success:!1,message:i}}finally{u.value=!1}},ce=async m=>{u.value=!0,x.value=null;try{const l=await(await fetch(`/api/comentarios/${m}`,{method:"DELETE",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin"})).json();return l.success&&(K(m),d.value--),l}catch(y){const l=y instanceof Error?y.message:"Error al eliminar comentario";return x.value=l,{success:!1,message:l}}finally{u.value=!1}},L=async(m,y)=>{try{const i=await(await fetch(`/api/comentarios/${m}/reaccion`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":A()},credentials:"same-origin",body:JSON.stringify({emoji:y})})).json();return i.success&&i.reacciones&&Z(m,i.reacciones),i}catch(l){return{success:!1,message:l instanceof Error?l.message:"Error al agregar reacciÃ³n"}}},p=async(m,y=0,l=10)=>{try{const i=new URLSearchParams({offset:String(y),limit:String(l)}),o=await(await fetch(`/api/comentarios/${m}/respuestas?${i}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();return o.success&&o.data&&Q(m,o.data),o}catch(i){return{success:!1,message:i instanceof Error?i.message:"Error al cargar respuestas"}}},A=()=>{var y;return((y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content"))||""},z=m=>m.respuestas||m.respuestas_limitadas||[],F=(m,y)=>{const l=i=>{for(const n of i){if(n.id===m){!n.respuestas&&!n.respuestas_limitadas&&(n.respuestas=[]);const g=n.respuestas||n.respuestas_limitadas;return g==null||g.push(y),!0}const o=z(n);if(o.length>0&&l(o))return!0}return!1};l(h.value)},Q=(m,y)=>{const l=i=>{for(const n of i){if(n.id===m){!n.respuestas&&!n.respuestas_limitadas&&(n.respuestas=[]);const g=n.respuestas||n.respuestas_limitadas;return g&&g.push(...y),n.total_respuestas_anidadas!==void 0&&(n.total_respuestas_anidadas=Math.max(0,n.total_respuestas_anidadas-y.length)),!0}const o=z(n);if(o.length>0&&l(o))return!0}return!1};l(h.value)},U=m=>{const y=l=>{for(let i=0;i<l.length;i++){if(l[i].id===m.id)return l[i]={...m,respuestas:l[i].respuestas,respuestas_limitadas:l[i].respuestas_limitadas},!0;const n=z(l[i]);if(n.length>0&&y(n))return!0}return!1};y(h.value)},K=m=>{const y=l=>l.filter(i=>i.id!==m).map(i=>(z(i),{...i,respuestas:i.respuestas?y(i.respuestas):void 0,respuestas_limitadas:i.respuestas_limitadas?y(i.respuestas_limitadas):void 0}));h.value=y(h.value)},Z=(m,y)=>{const l=i=>{for(const n of i){if(n.id===m)return n.reacciones_resumen=y,!0;const o=z(n);if(o.length>0&&l(o))return!0}return!1};l(h.value)},de=q(()=>h.value.length>0),me=q(()=>k.value>1),pe=q(()=>r.value>1),fe=q(()=>r.value<k.value);return{comentarios:h,loading:u,error:x,currentPage:r,lastPage:k,total:d,from:V,to:B,links:T,emojis:D,sortBy:C,tieneComentarios:de,tienePaginacion:me,puedePaginaAnterior:pe,puedePaginaSiguiente:fe,cargar:W,irAPagina:ae,paginaSiguiente:ne,paginaAnterior:re,crear:le,editar:ie,eliminar:ce,toggleReaccion:L,cambiarOrden:te,cargarRespuestasAdicionales:p}}const ht={class:"flex items-start gap-2 p-3 bg-muted/50 rounded-md border-l-4 border-primary/30 text-sm"},xt={class:"flex-1 min-w-0"},yt={class:"flex items-center gap-2 mb-1"},_t={class:"font-medium text-xs"},bt={class:"text-xs text-muted-foreground"},kt=["innerHTML"],Re=J({__name:"ComentarioQuote",props:{comentario:{}},setup(t){return(j,v)=>{var f;return s(),_("div",ht,[a(e($e),{class:"h-4 w-4 text-muted-foreground flex-shrink-0 mt-0.5"}),b("div",xt,[b("div",yt,[b("span",_t,R(((f=t.comentario.autor)==null?void 0:f.name)||"Usuario"),1),b("span",bt,R(t.comentario.fecha_relativa),1)]),b("p",{class:"text-muted-foreground line-clamp-2",innerHTML:t.comentario.contenido_truncado||t.comentario.contenido_plain},null,8,kt)])])}}}),wt={key:1,class:"flex items-center gap-2 text-sm text-muted-foreground"},Ct={class:"font-medium"},$t={key:2,class:"mt-2"},Rt={class:"flex items-center justify-between gap-2"},Et={class:"text-xs"},Mt={class:"flex items-center gap-2"},xe=J({__name:"ComentarioForm",props:{mode:{default:"create"},comentarioEditar:{default:null},comentarioCitar:{default:null},comentarioResponder:{default:null},loading:{type:Boolean,default:!1},placeholder:{default:"Escribe un comentario..."}},emits:["submit","cancel"],setup(t,{expose:j,emit:v}){const f=t,S=v,w=M(""),h=M([]),u=M(!1);be(()=>f.comentarioEditar,T=>{T&&(w.value=T.contenido,T.archivos_info&&T.archivos_info.length>0&&(h.value=T.archivos_info.map((C,D)=>({id:`existing_${D}`,name:C.nombre,size:0,path:C.path,url:C.url,mime_type:C.tipo,uploaded_at:""})),u.value=!0))},{immediate:!0});const x=q(()=>{switch(f.mode){case"edit":return"Guardar cambios";case"reply":return"Responder";case"quote":return"Comentar";default:return"Comentar"}}),r=q(()=>{var T,C;switch(f.mode){case"reply":return`Responder a ${((C=(T=f.comentarioResponder)==null?void 0:T.autor)==null?void 0:C.name)||"usuario"}...`;case"quote":return"Escribe tu comentario sobre la cita...";default:return f.placeholder}}),k=q(()=>w.value.replace(/<[^>]*>/g,"").trim().length>0),d=()=>{var D,X;if(!k.value||f.loading)return;const T=f.mode==="reply"&&((D=f.comentarioResponder)==null?void 0:D.id)||null,C=f.mode==="quote"&&((X=f.comentarioCitar)==null?void 0:X.id)||null;S("submit",w.value,T,C,h.value),f.mode!=="edit"&&(w.value="",h.value=[],u.value=!1)},V=()=>{w.value="",h.value=[],u.value=!1,S("cancel")},B=()=>{u.value=!u.value};return j({clear:()=>{w.value="",h.value=[],u.value=!1}}),(T,C)=>(s(),E(e(ke),{class:"border-0 shadow-none"},{default:c(()=>[a(e(we),{class:"p-0 space-y-3"},{default:c(()=>{var D;return[t.mode==="quote"&&t.comentarioCitar?(s(),E(Re,{key:0,comentario:t.comentarioCitar},null,8,["comentario"])):$("",!0),t.mode==="reply"&&t.comentarioResponder?(s(),_("div",wt,[C[2]||(C[2]=b("span",null,"Respondiendo a",-1)),b("span",Ct,R((D=t.comentarioResponder.autor)==null?void 0:D.name),1),a(e(I),{variant:"ghost",size:"sm",class:"h-5 w-5 p-0 ml-auto",onClick:V},{default:c(()=>[a(e(Ve),{class:"h-3 w-3"})]),_:1})])):$("",!0),a(Ue,{modelValue:w.value,"onUpdate:modelValue":C[0]||(C[0]=X=>w.value=X),placeholder:r.value,rows:3},null,8,["modelValue","placeholder"]),u.value?(s(),_("div",$t,[a(Be,{modelValue:h.value,"onUpdate:modelValue":C[1]||(C[1]=X=>h.value=X),label:"Archivos adjuntos",description:"MÃ¡ximo 3 archivos de 10MB cada uno",module:"comentarios","field-id":"archivos",multiple:!0,"max-files":3,"max-file-size":10,accept:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.xls,.xlsx","auto-upload":!0},null,8,["modelValue"])])):$("",!0),b("div",Rt,[a(e(I),{variant:"ghost",size:"sm",type:"button",onClick:B,class:ee({"text-primary":u.value||h.value.length>0}),title:"Adjuntar archivos"},{default:c(()=>[a(e(De),{class:"h-4 w-4 mr-1"}),b("span",Et,[C[3]||(C[3]=P(" Adjuntar archivos ",-1)),h.value.length>0?(s(),_(N,{key:0},[P("("+R(h.value.length)+")",1)],64)):$("",!0)])]),_:1},8,["class"]),b("div",Mt,[t.mode!=="create"?(s(),E(e(I),{key:0,variant:"ghost",size:"sm",onClick:V,disabled:t.loading},{default:c(()=>[...C[4]||(C[4]=[P(" Cancelar ",-1)])]),_:1},8,["disabled"])):$("",!0),a(e(I),{size:"sm",onClick:d,disabled:!k.value||t.loading},{default:c(()=>[t.loading?(s(),E(e(Xe),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):(s(),E(e(Fe),{key:1,class:"h-4 w-4 mr-2"})),P(" "+R(x.value),1)]),_:1},8,["disabled"])])])]}),_:1})]),_:1}))}}),St={class:"flex items-center gap-1.5 flex-wrap"},Pt={class:"text-muted-foreground"},jt={class:"flex gap-1"},Tt=J({__name:"ComentarioReacciones",props:{reacciones:{default:()=>[]},canReact:{type:Boolean,default:!0}},emits:["toggle"],setup(t,{emit:j}){const v=t,f=j,S={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},w=M(!1),h=q(()=>[...v.reacciones].sort((r,k)=>k.count-r.count)),u=r=>{const k=v.reacciones.find(d=>d.emoji===r);return(k==null?void 0:k.usuario_actual_reacciono)||!1},x=r=>{f("toggle",r),w.value=!1};return(r,k)=>(s(),_("div",St,[(s(!0),_(N,null,G(h.value,d=>(s(),E(e(I),{key:d.emoji,variant:"ghost",size:"sm",class:ee(["h-7 px-2 text-xs gap-1",{"bg-primary/10 hover:bg-primary/20":d.usuario_actual_reacciono}]),onClick:V=>x(d.emoji),disabled:!t.canReact},{default:c(()=>[b("span",null,R(d.simbolo),1),b("span",Pt,R(d.count),1)]),_:2},1032,["class","onClick","disabled"]))),128)),t.canReact?(s(),E(e(Ke),{key:0,open:w.value,"onUpdate:open":k[0]||(k[0]=d=>w.value=d)},{default:c(()=>[a(e(Ge),{asChild:""},{default:c(()=>[a(e(I),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:c(()=>[a(e(gt),{class:"h-4 w-4 text-muted-foreground"})]),_:1})]),_:1}),a(e(Je),{class:"w-auto p-2",align:"start"},{default:c(()=>[b("div",jt,[(s(),_(N,null,G(S,(d,V)=>a(e(I),{key:V,variant:"ghost",size:"sm",class:ee(["h-8 w-8 p-0 text-lg hover:scale-125 transition-transform",{"bg-primary/10":u(V)}]),onClick:B=>x(V)},{default:c(()=>[P(R(d),1)]),_:2},1032,["class","onClick"])),64))])]),_:1})]),_:1},8,["open"])):$("",!0)]))}}),zt={class:"flex items-center gap-2 mt-2"},qt={class:"flex items-center justify-center p-4 bg-muted/30 min-h-[300px] max-h-[calc(90vh-80px)] overflow-auto"},It=["src","alt"],Lt=J({__name:"ImagePreviewModal",props:{open:{type:Boolean},archivo:{}},emits:["update:open"],setup(t,{emit:j}){const v=t,f=j,S=q({get:()=>v.open,set:u=>f("update:open",u)}),w=()=>{var u;(u=v.archivo)!=null&&u.url&&window.open(v.archivo.url,"_blank")},h=()=>{var u;if((u=v.archivo)!=null&&u.url){const x=document.createElement("a");x.href=v.archivo.url,x.download=v.archivo.nombre,document.body.appendChild(x),x.click(),document.body.removeChild(x)}};return(u,x)=>(s(),E(e(Ze),{open:S.value,"onUpdate:open":x[1]||(x[1]=r=>S.value=r)},{default:c(()=>[a(e(Ye),{class:"max-w-4xl max-h-[90vh] p-0 overflow-hidden"},{default:c(()=>{var r;return[a(e(et),{class:"p-4 pb-2 pr-10"},{default:c(()=>[a(e(tt),{class:"text-sm font-medium truncate"},{default:c(()=>{var k;return[P(R(((k=t.archivo)==null?void 0:k.nombre)||"Imagen"),1)]}),_:1}),b("div",zt,[a(e(I),{variant:"outline",size:"sm",onClick:w},{default:c(()=>[a(e(at),{class:"h-4 w-4 mr-1"}),x[2]||(x[2]=P(" Abrir ",-1))]),_:1}),a(e(I),{variant:"outline",size:"sm",onClick:h},{default:c(()=>[a(e(ve),{class:"h-4 w-4 mr-1"}),x[3]||(x[3]=P(" Descargar ",-1))]),_:1})])]),_:1}),b("div",qt,[(r=t.archivo)!=null&&r.url?(s(),_("img",{key:0,src:t.archivo.url,alt:t.archivo.nombre,class:"max-w-full max-h-full object-contain rounded",onError:x[0]||(x[0]=k=>k.target.src="/images/placeholder.png")},null,40,It)):$("",!0)])]}),_:1})]),_:1},8,["open"]))}}),At={key:0,class:"mt-2"},Ut={class:"flex flex-wrap gap-2"},Bt=["onClick"],Vt={key:0,class:"relative w-20 h-20 rounded-md overflow-hidden border bg-muted/30 hover:ring-2 hover:ring-primary transition-all"},Dt=["src","alt"],Xt={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},Ft={key:1,class:"flex items-center gap-2 px-3 py-2 rounded-md border bg-muted/30 hover:bg-muted/50 transition-colors max-w-[200px]"},Nt={class:"flex-1 min-w-0"},Ot={class:"text-xs font-medium truncate"},Ht=J({__name:"ComentarioAdjuntos",props:{archivos:{}},setup(t){const j=M(!1),v=M(null),f=r=>{v.value=r,j.value=!0},S=r=>{window.open(r.url,"_blank")},w=r=>{r.es_imagen?f(r):S(r)},h=r=>["jpg","jpeg","png","gif","webp"].includes(r)?st:["xls","xlsx"].includes(r)?ft:ot,u=r=>["jpg","jpeg","png","gif","webp"].includes(r)?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":["pdf"].includes(r)?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":["doc","docx"].includes(r)?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":["xls","xlsx"].includes(r)?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",x=(r,k)=>{k.stopPropagation();const d=document.createElement("a");d.href=r.url,d.download=r.nombre,document.body.appendChild(d),d.click(),document.body.removeChild(d)};return(r,k)=>t.archivos&&t.archivos.length>0?(s(),_("div",At,[b("div",Ut,[(s(!0),_(N,null,G(t.archivos,(d,V)=>(s(),_("div",{key:V,class:"group relative cursor-pointer",onClick:B=>w(d)},[d.es_imagen?(s(),_("div",Vt,[b("img",{src:d.url,alt:d.nombre,class:"w-full h-full object-cover",onError:k[0]||(k[0]=B=>B.target.style.display="none")},null,40,Dt),b("div",Xt,[a(e(ve),{class:"h-5 w-5 text-white hover:scale-110 transition-transform",onClick:B=>x(d,B)},null,8,["onClick"])])])):(s(),_("div",Ft,[(s(),E(Ee(h(d.extension)),{class:"h-5 w-5 flex-shrink-0 text-muted-foreground"})),b("div",Nt,[b("p",Ot,R(d.nombre),1),a(e(ue),{class:ee([u(d.extension),"text-[10px] px-1"])},{default:c(()=>[P(R(d.extension.toUpperCase()),1)]),_:2},1032,["class"])]),a(e(ve),{class:"h-4 w-4 text-muted-foreground hover:text-foreground transition-colors flex-shrink-0",onClick:B=>x(d,B)},null,8,["onClick"])]))],8,Bt))),128))]),a(Lt,{open:j.value,"onUpdate:open":k[1]||(k[1]=d=>j.value=d),archivo:v.value},null,8,["open","archivo"])])):$("",!0)}}),Qt={key:0,class:"inline-flex items-center gap-1.5 flex-wrap"},Wt=J({__name:"ComentarioContextoBadge",props:{contexto:{},showTransition:{type:Boolean,default:!0}},setup(t){const j=t,v=h=>{const u={green:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",red:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",gray:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",purple:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400"};return u[h||"gray"]||u.gray},f=q(()=>v(j.contexto.color_anterior)),S=q(()=>v(j.contexto.color_nuevo)),w=q(()=>j.contexto.label_nuevo||j.contexto.estado_nuevo);return(h,u)=>w.value?(s(),_("div",Qt,[t.showTransition&&(t.contexto.label_anterior||t.contexto.estado_anterior)?(s(),_(N,{key:0},[a(e(ue),{variant:"outline",class:ee(["text-xs h-5 font-normal",f.value])},{default:c(()=>[P(R(t.contexto.label_anterior||t.contexto.estado_anterior),1)]),_:1},8,["class"]),a(e(nt),{class:"h-3 w-3 text-muted-foreground flex-shrink-0"})],64)):$("",!0),a(e(ue),{variant:"outline",class:ee(["text-xs h-5 font-medium",S.value])},{default:c(()=>[P(R(t.contexto.label_nuevo||t.contexto.estado_nuevo),1)]),_:1},8,["class"])])):$("",!0)}}),Kt={class:"group/item flex gap-3"},Gt={class:"flex-1 min-w-0"},Jt={class:"flex items-center gap-2 flex-wrap"},Zt={class:"font-medium text-sm"},Yt={class:"text-xs text-muted-foreground"},ea={key:2,class:"text-xs text-muted-foreground flex items-center gap-1"},ta={key:0,class:"mt-2"},aa=["innerHTML"],sa={class:"mt-2 flex items-center gap-2 flex-wrap"},oa={class:"flex items-center gap-1 opacity-0 group-hover/item:opacity-100 transition-opacity"},na={key:2,class:"mt-3"},ra={key:0,class:"mt-3 space-y-3"},la={key:1,class:"mt-2 ml-6 pl-4"},ia=J({__name:"ComentarioItem",props:{comentario:{},nivel:{default:0},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0}},emits:["reply","quote","edit","delete","toggleReaccion","submitReply","cargarMasRespuestas"],setup(t,{emit:j}){const v=t,f=j,S=M(!1),w=M(!1),h=M(!1),u=M(!1),x=M(!1),r=q(()=>v.comentario.respuestas||v.comentario.respuestas_limitadas||[]),k=q(()=>{const L=p=>{const A=p.respuestas||p.respuestas_limitadas||[];let z=A.length;return A.forEach(F=>{z+=L(F)}),z};return L(v.comentario)}),d=q(()=>r.value.length>0),V=q(()=>(v.comentario.total_respuestas_anidadas||0)>0),B=q(()=>{var p;return(((p=v.comentario.autor)==null?void 0:p.name)||"U").substring(0,2).toUpperCase()}),T=q(()=>v.comentario.es_editable||!1),C=q(()=>{const L=v.comentario.tiempo_restante_edicion;if(!L||L<=0)return null;const p=Math.floor(L/60),A=L%60;return p>0?`${p}h ${A}m para editar`:`${A}m para editar`}),D=()=>{S.value=!S.value},X=()=>{w.value=!0},oe=(L,p,A,z=[])=>{f("submitReply",L,v.comentario.id,z),w.value=!1},W=()=>{w.value=!1},te=()=>{f("quote",v.comentario)},ae=()=>{h.value=!0},ne=(L,p,A,z=[])=>{f("edit",v.comentario,L,z),h.value=!1},re=()=>{h.value=!1},le=()=>{u.value?(f("delete",v.comentario),u.value=!1):(u.value=!0,setTimeout(()=>{u.value=!1},3e3))},ie=L=>{f("toggleReaccion",v.comentario.id,L)},ce=()=>{x.value=!0,f("cargarMasRespuestas",v.comentario.id),setTimeout(()=>{x.value=!1},2e3)};return(L,p)=>{var z,F;const A=Me("ComentarioItem",!0);return s(),_("div",{class:ee({"ml-6 border-l-2 border-muted pl-4":t.nivel>0})},[b("div",Kt,[a(e(Oe),{class:"h-8 w-8 flex-shrink-0"},{default:c(()=>[a(e(Ne),{class:"text-xs"},{default:c(()=>[P(R(B.value),1)]),_:1})]),_:1}),b("div",Gt,[b("div",Jt,[b("span",Zt,R(((z=t.comentario.autor)==null?void 0:z.name)||"Usuario"),1),b("span",Yt,R(t.comentario.fecha_relativa),1),t.comentario.es_editado?(s(),E(e(ue),{key:0,variant:"outline",class:"text-xs h-5"},{default:c(()=>[...p[8]||(p[8]=[P(" editado ",-1)])]),_:1})):$("",!0),t.comentario.tiene_contexto&&((F=t.comentario.contexto_info)==null?void 0:F.tipo)==="cambio_estado"?(s(),E(Wt,{key:1,contexto:t.comentario.contexto_info},null,8,["contexto"])):$("",!0),C.value?(s(),_("span",ea,[a(e(rt),{class:"h-3 w-3"}),P(" "+R(C.value),1)])):$("",!0)]),h.value?(s(),_("div",ta,[a(xe,{mode:"edit","comentario-editar":t.comentario,onSubmit:p[0]||(p[0]=Q=>ne(Q)),onCancel:re},null,8,["comentario-editar"])])):(s(),_(N,{key:1},[t.comentario.comentario_citado?(s(),E(Re,{key:0,comentario:t.comentario.comentario_citado,class:"mt-2"},null,8,["comentario"])):$("",!0),b("div",{class:"mt-1 text-sm prose prose-sm dark:prose-invert max-w-none",innerHTML:t.comentario.contenido},null,8,aa),t.comentario.archivos_info&&t.comentario.archivos_info.length>0?(s(),E(Ht,{key:1,archivos:t.comentario.archivos_info},null,8,["archivos"])):$("",!0),b("div",sa,[a(Tt,{reacciones:t.comentario.reacciones_resumen||[],"can-react":t.canReact,onToggle:ie},null,8,["reacciones","can-react"]),b("div",oa,[t.canCreate?(s(),E(e(I),{key:0,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:X},{default:c(()=>[a(e(he),{class:"h-3 w-3 mr-1"}),p[9]||(p[9]=P(" Responder ",-1))]),_:1})):$("",!0),t.canCreate?(s(),E(e(I),{key:1,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:te},{default:c(()=>[a(e($e),{class:"h-3 w-3 mr-1"}),p[10]||(p[10]=P(" Citar ",-1))]),_:1})):$("",!0),T.value||t.comentario.es_eliminable?(s(),E(e(He),{key:2},{default:c(()=>[a(e(Qe),{asChild:""},{default:c(()=>[a(e(I),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:c(()=>[a(e(lt),{class:"h-4 w-4"})]),_:1})]),_:1}),a(e(We),{align:"end"},{default:c(()=>[t.comentario.es_editable?(s(),E(e(_e),{key:0,onClick:ae},{default:c(()=>[a(e(it),{class:"h-4 w-4 mr-2"}),p[11]||(p[11]=P(" Editar ",-1))]),_:1})):$("",!0),t.comentario.es_eliminable?(s(),E(e(_e),{key:1,class:"text-destructive",onClick:le},{default:c(()=>[a(e(ct),{class:"h-4 w-4 mr-2"}),P(" "+R(u.value?"Confirmar eliminaciÃ³n":"Eliminar"),1)]),_:1})):$("",!0)]),_:1})]),_:1})):$("",!0),d.value?(s(),E(e(I),{key:3,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:D},{default:c(()=>[S.value?(s(),E(e(Ce),{key:1,class:"h-3 w-3 mr-1"})):(s(),E(e(ye),{key:0,class:"h-3 w-3 mr-1"})),P(" "+R(S.value?`Mostrar ${k.value}`:"Ocultar"),1)]),_:1})):$("",!0)])])],64)),w.value?(s(),_("div",na,[a(xe,{mode:"reply","comentario-responder":t.comentario,onSubmit:oe,onCancel:W},null,8,["comentario-responder"])])):$("",!0)])]),d.value&&!S.value?(s(),_("div",ra,[(s(!0),_(N,null,G(r.value,Q=>(s(),E(A,{key:Q.id,comentario:Q,nivel:t.nivel+1,"can-create":t.canCreate,"can-react":t.canReact,onReply:p[1]||(p[1]=U=>f("reply",U)),onQuote:p[2]||(p[2]=U=>f("quote",U)),onEdit:p[3]||(p[3]=(U,K,Z)=>f("edit",U,K,Z)),onDelete:p[4]||(p[4]=U=>f("delete",U)),onToggleReaccion:p[5]||(p[5]=(U,K)=>f("toggleReaccion",U,K)),onSubmitReply:p[6]||(p[6]=(U,K,Z)=>f("submitReply",U,K,Z)),onCargarMasRespuestas:p[7]||(p[7]=U=>f("cargarMasRespuestas",U))},null,8,["comentario","nivel","can-create","can-react"]))),128))])):$("",!0),V.value&&!S.value?(s(),_("div",la,[a(e(I),{variant:"ghost",size:"sm",class:"h-7 text-xs text-muted-foreground",disabled:x.value,onClick:ce},{default:c(()=>[a(e(ye),{class:"h-3 w-3 mr-1"}),P(" "+R(x.value?"Cargando...":`Cargar ${t.comentario.total_respuestas_anidadas} respuestas mÃ¡s`),1)]),_:1},8,["disabled"])])):$("",!0)],2)}}}),ca={class:"flex items-center justify-between"},ua={key:0},da={key:1,class:"space-y-4"},ma={class:"flex-1 space-y-2"},pa={key:2,class:"text-center py-8 text-destructive"},fa={key:3,class:"text-center py-8"},ga={key:0,class:"text-sm text-muted-foreground mt-1"},va={key:4,class:"space-y-4"},ha={key:0,class:"flex flex-col items-center gap-3 pt-4 border-t"},xa={class:"text-sm text-muted-foreground"},ya={class:"flex items-center gap-1"},_a={key:0,class:"px-2 text-muted-foreground"},Ja=J({__name:"ComentariosPanel",props:{commentableType:{},commentableId:{},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0}},setup(t){const j=[{value:"recientes",label:"MÃ¡s recientes"},{value:"antiguos",label:"MÃ¡s antiguos"},{value:"populares",label:"MÃ¡s populares"}],v=t,f=()=>{const o=new URLSearchParams(window.location.search).get("pagina");return o?parseInt(o,10):1},{comentarios:S,loading:w,error:h,total:u,lastPage:x,from:r,to:k,links:d,tienePaginacion:V,puedePaginaAnterior:B,puedePaginaSiguiente:T,sortBy:C,cargar:D,irAPagina:X,paginaSiguiente:oe,paginaAnterior:W,crear:te,editar:ae,eliminar:ne,toggleReaccion:re,cambiarOrden:le,cargarRespuestasAdicionales:ie}=vt(v.commentableType,v.commentableId,{paginaInicial:f(),urlParam:"pagina",sincronizarUrl:!0}),ce=q(()=>!d.value||d.value.length<=3?[]:d.value),L=n=>{if(!n.url||n.active)return;const o=new URL(n.url,window.location.origin),g=parseInt(o.searchParams.get("page")||"1",10);X(g)},p=M("create"),A=M(null),z=M(null),F=M(null),Q=M(!1),U=M(null);Se(()=>{D()}),be(()=>[v.commentableType,v.commentableId],()=>{D()});const K=async(n,o,g,H=[])=>{Q.value=!0;try{if(p.value==="edit"&&F.value){const Y=await ae(F.value.id,{contenido:n,archivos:H});Y.success?(O.success(Y.message),l()):O.error(Y.message||"Error al actualizar")}else{const Y=await te({contenido:n,parent_id:o,quoted_comentario_id:g,archivos:H});Y.success?(O.success(Y.message),l()):O.error(Y.message||"Error al publicar")}}finally{Q.value=!1}},Z=n=>{p.value="reply",A.value=n,z.value=null,F.value=null},de=n=>{p.value="quote",z.value=n,A.value=null,F.value=null},me=async(n,o,g=[])=>{const H=await ae(n.id,{contenido:o,archivos:g});H.success?O.success(H.message):O.error(H.message||"Error al actualizar")},pe=async n=>{const o=await ne(n.id);o.success?O.success(o.message):O.error(o.message||"Error al eliminar")},fe=async(n,o)=>{const g=await re(n,o);g.success||O.error(g.message||"Error al agregar reacciÃ³n")},m=async(n,o,g=[])=>{const H=await te({contenido:n,parent_id:o,quoted_comentario_id:null,archivos:g});H.success?O.success(H.message):O.error(H.message||"Error al enviar respuesta")},y=async n=>{const o=await ie(n);o.success||O.error(o.message||"Error al cargar respuestas")},l=()=>{var n;p.value="create",A.value=null,z.value=null,F.value=null,(n=U.value)==null||n.clear()},i=()=>{l()};return(n,o)=>(s(),E(e(ke),null,{default:c(()=>[a(e(je),null,{default:c(()=>[b("div",ca,[b("div",null,[a(e(Pe),{class:"flex items-center gap-2"},{default:c(()=>[a(e(he),{class:"h-5 w-5"}),o[3]||(o[3]=P(" Comentarios ",-1))]),_:1}),e(u)>0?(s(),E(e(Te),{key:0},{default:c(()=>[P(R(e(u))+" "+R(e(u)===1?"comentario":"comentarios"),1)]),_:1})):$("",!0)]),e(u)>1?(s(),E(e(ze),{key:0,"model-value":e(C),"onUpdate:modelValue":e(le)},{default:c(()=>[a(e(qe),{class:"w-[160px] h-8 text-xs"},{default:c(()=>[a(e(dt),{class:"h-3 w-3 mr-1"}),a(e(Ie))]),_:1}),a(e(Le),null,{default:c(()=>[(s(),_(N,null,G(j,g=>a(e(Ae),{key:g.value,value:g.value},{default:c(()=>[P(R(g.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):$("",!0)])]),_:1}),a(e(we),{class:"space-y-6"},{default:c(()=>[t.canCreate?(s(),_("div",ua,[a(xe,{ref_key:"formRef",ref:U,mode:p.value,"comentario-editar":F.value,"comentario-citar":z.value,"comentario-responder":A.value,loading:Q.value,onSubmit:K,onCancel:i},null,8,["mode","comentario-editar","comentario-citar","comentario-responder","loading"])])):$("",!0),e(w)&&e(S).length===0?(s(),_("div",da,[(s(),_(N,null,G(3,g=>b("div",{key:g,class:"flex gap-3"},[a(e(ge),{class:"h-8 w-8 rounded-full"}),b("div",ma,[a(e(ge),{class:"h-4 w-32"}),a(e(ge),{class:"h-16 w-full"})])])),64))])):e(h)?(s(),_("div",pa,[b("p",null,R(e(h)),1),a(e(I),{variant:"outline",size:"sm",class:"mt-2",onClick:o[0]||(o[0]=g=>e(D)())},{default:c(()=>[...o[4]||(o[4]=[P(" Reintentar ",-1)])]),_:1})])):e(S).length===0?(s(),_("div",fa,[a(e(he),{class:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),o[5]||(o[5]=b("p",{class:"text-muted-foreground"},"No hay comentarios todavÃ­a",-1)),t.canCreate?(s(),_("p",ga," SÃ© el primero en comentar ")):$("",!0)])):(s(),_("div",va,[(s(!0),_(N,null,G(e(S),g=>(s(),E(ia,{key:g.id,comentario:g,"can-create":t.canCreate,"can-react":t.canReact,onReply:Z,onQuote:de,onEdit:me,onDelete:pe,onToggleReaccion:fe,onSubmitReply:m,onCargarMasRespuestas:y},null,8,["comentario","can-create","can-react"]))),128)),e(V)?(s(),_("div",ha,[b("div",xa," Mostrando "+R(e(r))+" a "+R(e(k))+" de "+R(e(u))+" comentarios ",1),b("div",ya,[a(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(B)||e(w),onClick:o[1]||(o[1]=g=>e(X)(1)),title:"Primera pÃ¡gina"},{default:c(()=>[a(e(mt),{class:"h-4 w-4"})]),_:1},8,["disabled"]),a(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(B)||e(w),onClick:e(W),title:"PÃ¡gina anterior"},{default:c(()=>[a(e(ut),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),(s(!0),_(N,null,G(ce.value,g=>(s(),_(N,{key:g.label},[!g.label.includes("Previous")&&!g.label.includes("Next")&&!g.label.includes("previous")&&!g.label.includes("next")?(s(),_(N,{key:0},[g.label==="..."?(s(),_("span",_a," ... ")):(s(),E(e(I),{key:1,variant:g.active?"default":"outline",size:"sm",class:"h-8 min-w-[32px] px-2",disabled:e(w)||g.active,onClick:H=>L(g)},{default:c(()=>[P(R(g.label),1)]),_:2},1032,["variant","disabled","onClick"]))],64)):$("",!0)],64))),128)),a(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(T)||e(w),onClick:e(oe),title:"PÃ¡gina siguiente"},{default:c(()=>[a(e(Ce),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),a(e(I),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(T)||e(w),onClick:o[2]||(o[2]=g=>e(X)(e(x))),title:"Ãšltima pÃ¡gina"},{default:c(()=>[a(e(pt),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])):$("",!0)]))]),_:1})]),_:1}))}});export{Ja as _};
