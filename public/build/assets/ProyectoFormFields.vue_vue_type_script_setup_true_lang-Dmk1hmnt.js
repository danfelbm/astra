import{d as re,r as z,p as pe,c as B,i as m,F as C,e as s,f as e,w as a,g as u,h as c,k as F,m as i,t as f,u as fe,l as ye,b as w,j as b,n as q}from"./app-BQOuftjp.js";import{_ as E,a as I,b as M,c as G}from"./CardTitle.vue_vue_type_script_setup_true_lang-COZtpGNd.js";import{_ as U}from"./createLucideIcon-u3b_FJqO.js";import{_ as A}from"./Input.vue_vue_type_script_setup_true_lang-CIUGnQxq.js";import{_ as _e}from"./Textarea.vue_vue_type_script_setup_true_lang-DNOVqh5q.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-B1DKvfl2.js";import{a as be,_ as ge}from"./index-ChjO1gxC.js";import{_ as Z,a as ee,b as se,c as oe,d as te}from"./SelectValue.vue_vue_type_script_setup_true_lang-Dl66d_KU.js";import{_ as ve}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-I4pSsSH9.js";import{E as xe}from"./EtiquetaSelector-o65s07be.js";import{_ as he}from"./CardDescription.vue_vue_type_script_setup_true_lang-BFsHl_p7.js";import{_ as Ve}from"./index-CVblgXJE.js";import{_ as le}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-Di9YagXZ.js";import{U as R}from"./user-CALY3_c3.js";import{U as ie}from"./user-plus-D-JB37Zu.js";import{X as N}from"./x-Bldz7iDm.js";import{t as ae}from"./index-Czl6Hd1P.js";import{T as ke}from"./tag-B32T54G3.js";import{C as $e}from"./circle-alert-CktHmVBr.js";import{S as we}from"./save-CVpk2vcW.js";const Ce={class:"flex items-center justify-between"},Ue={key:0,class:"space-y-2"},Se={class:"flex items-center gap-3"},Pe={class:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center"},ze={class:"font-medium"},qe={class:"text-sm text-gray-500 dark:text-gray-400"},Ee={class:"flex items-center gap-2"},Ge={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},je=re({__name:"GestoresManager",props:{modelValue:{default:()=>[]},gestores:{default:()=>[]}},emits:["update:modelValue"],setup(p,{emit:j}){const l=p,S=j,k=z(!1),$=z(new Map);pe(()=>l.gestores,y=>{y&&y.length>0&&y.forEach(r=>{$.value.set(r.id,r)})},{immediate:!0,deep:!0});const x=B(()=>{var r;const y=[];for(const _ of l.modelValue){let v=(r=l.gestores)==null?void 0:r.find(g=>g.id===_);v||(v=$.value.get(_)),v&&y.push(v)}return y}),o=({userIds:y,users:r})=>{r&&r.length>0&&r.forEach(g=>{$.value.set(g.id,g)});const _=y.filter(g=>g&&g>0),v=[...new Set([...l.modelValue.filter(g=>g&&g>0),..._])];S("update:modelValue",v),k.value=!1},h=y=>{const r=l.modelValue.filter(_=>_!==y);S("update:modelValue",r)};return(y,r)=>(i(),m(C,null,[s(e(E),null,{default:a(()=>[s(e(I),null,{default:a(()=>[u("div",Ce,[u("div",null,[s(e(M),{class:"flex items-center gap-2"},{default:a(()=>[s(e(R),{class:"h-5 w-5"}),r[2]||(r[2]=c(" Gestores del Proyecto ",-1))]),_:1}),s(e(he),null,{default:a(()=>[...r[3]||(r[3]=[c(" Los gestores pueden editar el proyecto desde el panel de usuario ",-1)])]),_:1})]),s(e(U),{type:"button",variant:"outline",size:"sm",onClick:r[0]||(r[0]=_=>k.value=!0)},{default:a(()=>[s(e(ie),{class:"h-4 w-4 mr-2"}),r[4]||(r[4]=c(" Añadir Gestor ",-1))]),_:1})])]),_:1}),s(e(G),null,{default:a(()=>[x.value.length>0?(i(),m("div",Ue,[(i(!0),m(C,null,F(x.value,_=>(i(),m("div",{key:_.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[u("div",Se,[u("div",Pe,[s(e(R),{class:"h-5 w-5 text-primary"})]),u("div",null,[u("p",ze,f(_.name),1),u("p",qe,f(_.email),1)])]),u("div",Ee,[s(e(Ve),{variant:"secondary"},{default:a(()=>[...r[5]||(r[5]=[c("Gestor",-1)])]),_:1}),s(e(U),{type:"button",variant:"ghost",size:"sm",onClick:v=>h(_.id)},{default:a(()=>[s(e(N),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]))),128))])):(i(),m("div",Ge,[s(e(R),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),r[6]||(r[6]=u("p",null,"No hay gestores asignados",-1)),r[7]||(r[7]=u("p",{class:"text-sm mt-1"},'Haz clic en "Añadir Gestor" para asignar gestores al proyecto',-1))]))]),_:1})]),_:1}),s(le,{modelValue:k.value,"onUpdate:modelValue":r[1]||(r[1]=_=>k.value=_),title:"Seleccionar Gestores",description:"Selecciona los usuarios que podrán gestionar y editar este proyecto","search-endpoint":y.route("admin.proyectos.search-users"),"excluded-ids":p.modelValue,"submit-button-text":"Añadir Gestores",onSubmit:o},null,8,["modelValue","search-endpoint","excluded-ids"])],64))}}),Ae={key:0,class:"mt-1 text-sm text-red-600"},Re={key:0,class:"mt-1 text-sm text-red-600"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fe={key:0,class:"mt-1 text-sm text-red-600"},Ie={key:0,class:"mt-1 text-sm text-red-600"},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ne={key:0,class:"mt-1 text-sm text-red-600"},De={key:0,class:"mt-1 text-sm text-red-600"},Te={key:0},Le={class:"space-y-2"},Oe={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},He={class:"font-medium"},Xe={class:"text-sm text-muted-foreground"},Je={key:0,class:"mt-1 text-sm text-red-600"},Ke={key:1},Qe={key:0,class:"mt-1 text-sm text-red-600"},bs=re({__name:"ProyectoFormFields",props:{proyecto:{},camposPersonalizados:{},valoresCampos:{default:()=>({})},categorias:{},gestores:{},submitUrl:{},cancelUrl:{},mode:{default:"edit"},showResponsable:{type:Boolean,default:!1},showGestores:{type:Boolean,default:!1},showInfoAlert:{type:Boolean,default:!0},searchUsersEndpoint:{},estados:{default:()=>({})},prioridades:{default:()=>({})}},emits:["cancel","success"],setup(p,{emit:j}){var D,T,L,O,H,X,J,K,Q,W,Y;const l=p,S=j,k=d=>d?d.split(" ")[0]:"",$={};l.valoresCampos&&l.camposPersonalizados.forEach(d=>{$[d.id]=l.valoresCampos[d.id]||l.valoresCampos[d.slug]||""});const x=l.mode==="create",o=fe({nombre:((D=l.proyecto)==null?void 0:D.nombre)||"",descripcion:((T=l.proyecto)==null?void 0:T.descripcion)||"",fecha_inicio:k((L=l.proyecto)==null?void 0:L.fecha_inicio),fecha_fin:k((O=l.proyecto)==null?void 0:O.fecha_fin),estado:((H=l.proyecto)==null?void 0:H.estado)||"planificacion",prioridad:((X=l.proyecto)==null?void 0:X.prioridad)||"media",responsable_id:((J=l.proyecto)==null?void 0:J.responsable_id)||null,etiquetas:((Q=(K=l.proyecto)==null?void 0:K.etiquetas)==null?void 0:Q.map(d=>d.id))||[],gestores:((W=l.gestores)==null?void 0:W.map(d=>d.id))||[],campos_personalizados:$}),h=z(!1),y=z(!1),r=z(((Y=l.proyecto)==null?void 0:Y.responsable)||null),_={planificacion:"Planificación",en_progreso:"En Progreso",pausado:"Pausado",completado:"Completado",cancelado:"Cancelado"},v={baja:"Baja",media:"Media",alta:"Alta",critica:"Crítica"},g=B(()=>Object.keys(l.estados).length>0?l.estados:_),ne=B(()=>Object.keys(l.prioridades).length>0?l.prioridades:v),de=()=>{h.value=!0;const d={preserveScroll:!0,onSuccess:()=>{ae.success(x?"Proyecto creado exitosamente":"Proyecto actualizado exitosamente"),S("success")},onError:t=>{ae.error(x?"Error al crear el proyecto":"Error al actualizar el proyecto"),console.error(t)},onFinish:()=>{h.value=!1}};x?o.post(l.submitUrl,d):o.put(l.submitUrl,d)},ue=()=>{S("cancel")},ce=d=>{o.campos_personalizados=d},me=d=>{d.userIds.length>0&&(o.responsable_id=d.userIds[0],d.users&&d.users.length>0&&(r.value=d.users[0]))};return(d,t)=>(i(),m("form",{onSubmit:ye(de,["prevent"]),class:"space-y-6"},[s(e(E),null,{default:a(()=>[s(e(I),null,{default:a(()=>[s(e(M),null,{default:a(()=>[...t[11]||(t[11]=[c("Información Básica",-1)])]),_:1})]),_:1}),s(e(G),{class:"space-y-4"},{default:a(()=>[u("div",null,[s(e(V),{for:"nombre"},{default:a(()=>[...t[12]||(t[12]=[c("Nombre del Proyecto *",-1)])]),_:1}),s(e(A),{id:"nombre",modelValue:e(o).nombre,"onUpdate:modelValue":t[0]||(t[0]=n=>e(o).nombre=n),type:"text",placeholder:"Ingrese el nombre del proyecto",class:q({"border-red-500":e(o).errors.nombre}),required:""},null,8,["modelValue","class"]),e(o).errors.nombre?(i(),m("p",Ae,f(e(o).errors.nombre),1)):b("",!0)]),u("div",null,[s(e(V),{for:"descripcion"},{default:a(()=>[...t[13]||(t[13]=[c("Descripción",-1)])]),_:1}),s(e(_e),{id:"descripcion",modelValue:e(o).descripcion,"onUpdate:modelValue":t[1]||(t[1]=n=>e(o).descripcion=n),placeholder:"Ingrese una descripción del proyecto",rows:"4",class:q({"border-red-500":e(o).errors.descripcion})},null,8,["modelValue","class"]),e(o).errors.descripcion?(i(),m("p",Re,f(e(o).errors.descripcion),1)):b("",!0)]),u("div",Be,[u("div",null,[s(e(V),{for:"fecha_inicio"},{default:a(()=>[...t[14]||(t[14]=[c("Fecha de Inicio *",-1)])]),_:1}),s(e(A),{id:"fecha_inicio",modelValue:e(o).fecha_inicio,"onUpdate:modelValue":t[2]||(t[2]=n=>e(o).fecha_inicio=n),type:"date",class:q({"border-red-500":e(o).errors.fecha_inicio}),required:""},null,8,["modelValue","class"]),e(o).errors.fecha_inicio?(i(),m("p",Fe,f(e(o).errors.fecha_inicio),1)):b("",!0)]),u("div",null,[s(e(V),{for:"fecha_fin"},{default:a(()=>[...t[15]||(t[15]=[c("Fecha de Fin",-1)])]),_:1}),s(e(A),{id:"fecha_fin",modelValue:e(o).fecha_fin,"onUpdate:modelValue":t[3]||(t[3]=n=>e(o).fecha_fin=n),type:"date",min:e(o).fecha_inicio,class:q({"border-red-500":e(o).errors.fecha_fin})},null,8,["modelValue","min","class"]),e(o).errors.fecha_fin?(i(),m("p",Ie,f(e(o).errors.fecha_fin),1)):b("",!0)])])]),_:1})]),_:1}),s(e(E),null,{default:a(()=>[s(e(I),null,{default:a(()=>[s(e(M),null,{default:a(()=>[...t[16]||(t[16]=[c("Configuración del Proyecto",-1)])]),_:1})]),_:1}),s(e(G),{class:"space-y-4"},{default:a(()=>[u("div",Me,[u("div",null,[s(e(V),{for:"estado"},{default:a(()=>[...t[17]||(t[17]=[c("Estado *",-1)])]),_:1}),s(e(Z),{modelValue:e(o).estado,"onUpdate:modelValue":t[4]||(t[4]=n=>e(o).estado=n)},{default:a(()=>[s(e(ee),null,{default:a(()=>[s(e(se),{placeholder:"Seleccione el estado"})]),_:1}),s(e(oe),null,{default:a(()=>[(i(!0),m(C,null,F(g.value,(n,P)=>(i(),w(e(te),{key:P,value:P},{default:a(()=>[c(f(n),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(o).errors.estado?(i(),m("p",Ne,f(e(o).errors.estado),1)):b("",!0)]),u("div",null,[s(e(V),{for:"prioridad"},{default:a(()=>[...t[18]||(t[18]=[c("Prioridad *",-1)])]),_:1}),s(e(Z),{modelValue:e(o).prioridad,"onUpdate:modelValue":t[5]||(t[5]=n=>e(o).prioridad=n)},{default:a(()=>[s(e(ee),null,{default:a(()=>[s(e(se),{placeholder:"Seleccione la prioridad"})]),_:1}),s(e(oe),null,{default:a(()=>[(i(!0),m(C,null,F(ne.value,(n,P)=>(i(),w(e(te),{key:P,value:P},{default:a(()=>[c(f(n),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(o).errors.prioridad?(i(),m("p",De,f(e(o).errors.prioridad),1)):b("",!0)])]),p.showResponsable?(i(),m("div",Te,[s(e(V),{for:"responsable_id"},{default:a(()=>[...t[19]||(t[19]=[c("Responsable",-1)])]),_:1}),u("div",Le,[r.value?(i(),m("div",Oe,[u("div",null,[u("p",He,f(r.value.name),1),u("p",Xe,f(r.value.email),1)]),s(e(U),{type:"button",variant:"ghost",size:"sm",onClick:t[6]||(t[6]=n=>{e(o).responsable_id=null,r.value=null})},{default:a(()=>[s(e(N),{class:"h-4 w-4"})]),_:1})])):b("",!0),s(e(U),{type:"button",variant:"outline",onClick:t[7]||(t[7]=n=>y.value=!0),class:"w-full"},{default:a(()=>[s(e(ie),{class:"h-4 w-4 mr-2"}),c(" "+f(r.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(o).errors.responsable_id?(i(),m("p",Je,f(e(o).errors.responsable_id),1)):b("",!0)])):b("",!0),p.categorias&&p.categorias.length>0?(i(),m("div",Ke,[s(e(V),{class:"flex items-center gap-2 mb-2"},{default:a(()=>[s(e(ke),{class:"h-4 w-4"}),t[20]||(t[20]=c(" Etiquetas ",-1))]),_:1}),s(xe,{modelValue:e(o).etiquetas,"onUpdate:modelValue":t[8]||(t[8]=n=>e(o).etiquetas=n),categorias:p.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas para el proyecto...",description:"Puedes asignar hasta 10 etiquetas para categorizar este proyecto"},null,8,["modelValue","categorias"]),e(o).errors.etiquetas?(i(),m("p",Qe,f(e(o).errors.etiquetas),1)):b("",!0)])):b("",!0)]),_:1})]),_:1}),p.showGestores?(i(),w(je,{key:0,modelValue:e(o).gestores,"onUpdate:modelValue":t[9]||(t[9]=n=>e(o).gestores=n),gestores:p.gestores},null,8,["modelValue","gestores"])):b("",!0),p.camposPersonalizados.length>0?(i(),w(ve,{key:1,campos:p.camposPersonalizados,valores:$,errors:e(o).errors,onUpdate:ce},null,8,["campos","errors"])):b("",!0),!p.showResponsable&&!x&&p.showInfoAlert?(i(),w(e(ge),{key:2},{default:a(()=>[s(e($e),{class:"h-4 w-4"}),s(e(be),null,{default:a(()=>[...t[21]||(t[21]=[c(" Los cambios se guardarán inmediatamente. Si necesitas cambiar el responsable del proyecto, contacta con un administrador. ",-1)])]),_:1})]),_:1})):b("",!0),s(e(E),null,{default:a(()=>[s(e(G),{class:"flex justify-end gap-4 pt-6"},{default:a(()=>[s(e(U),{type:"button",variant:"outline",onClick:ue,disabled:h.value},{default:a(()=>[s(e(N),{class:"mr-2 h-4 w-4"}),t[22]||(t[22]=c(" Cancelar ",-1))]),_:1},8,["disabled"]),s(e(U),{type:"submit",disabled:h.value||e(o).processing},{default:a(()=>[s(e(we),{class:"mr-2 h-4 w-4"}),x?(i(),m(C,{key:0},[c(f(h.value?"Guardando...":"Guardar Proyecto"),1)],64)):(i(),m(C,{key:1},[c(f(h.value?"Actualizando...":"Actualizar Proyecto"),1)],64))]),_:1},8,["disabled"])]),_:1})]),_:1}),p.showResponsable&&p.searchUsersEndpoint?(i(),w(le,{key:3,modelValue:y.value,"onUpdate:modelValue":t[10]||(t[10]=n=>y.value=n),title:"Seleccionar Responsable",description:"Selecciona el usuario que será responsable de este proyecto","search-endpoint":p.searchUsersEndpoint,"excluded-ids":e(o).responsable_id?[e(o).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:me},null,8,["modelValue","search-endpoint","excluded-ids"])):b("",!0)],32))}});export{bs as _};
