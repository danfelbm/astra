import{d as K,r as O,c as x,b as h,x as w,f as a,w as o,j as f,e as l,h as r,t as u,i as v,g as m,k as S,F as V,y as Q,m as n,n as L,l as W}from"./app-BfPvEkA-.js";import{_ as Y,a as Z,b as ee,c as te}from"./CardTitle.vue_vue_type_script_setup_true_lang-BSnzyO3E.js";import{_ as T}from"./CardDescription.vue_vue_type_script_setup_true_lang-S1t_LPFF.js";import{_ as g}from"./createLucideIcon-GRWsbGen.js";import{_ as $}from"./Label.vue_vue_type_script_setup_true_lang-D_cUwdsK.js";import{_ as ae}from"./Input.vue_vue_type_script_setup_true_lang-CJnDnmxt.js";import{_ as se}from"./Checkbox.vue_vue_type_script_setup_true_lang-9NOOiYW_.js";import{_ as E}from"./index-CxtQmOvh.js";import{a as z,b as D,c as N,d as _,_ as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-B_ZtV9MM.js";import{_ as le}from"./ScrollArea.vue_vue_type_script_setup_true_lang-Bfj5aNs_.js";import{S as oe}from"./search-D9_vtSZ4.js";import{X as A}from"./x-Dw4t4IDb.js";import{R as de}from"./rotate-ccw-CAWiryWR.js";import{F as ne}from"./file-text-DCJ8hQH1.js";import{C as ie}from"./calendar-DVEbrIqF.js";import{C as re}from"./circle-alert-CLEo-4FT.js";import{C as ue}from"./clock-DPnnatu6.js";import{C as ce}from"./circle-check-big-ieuJ3URW.js";const me={key:0},fe={class:"space-y-3 p-3 border rounded-lg bg-muted/30"},ve={class:"flex items-center gap-2"},he={class:"relative flex-1"},be={class:"flex flex-wrap items-end gap-2"},xe={class:"flex-1 min-w-[140px]"},pe={class:"flex-1 min-w-[140px]"},ge={key:0,class:"flex items-center gap-2 pt-2 border-t"},_e={class:"text-xs text-muted-foreground"},ye={class:"p-2 space-y-1"},ke={key:0,class:"flex flex-col items-center justify-center py-8 text-center"},Ce={class:"text-sm text-muted-foreground"},we=["onClick"],Se={class:"flex-1 min-w-0"},Ve={class:"text-sm block"},$e={class:"flex flex-wrap items-center gap-1.5 mt-1"},Ee={key:0,class:"text-xs text-muted-foreground flex items-center gap-1"},Be={key:1,class:"text-xs text-amber-600"},Ke=K({__name:"EntregableSelector",props:{modelValue:{},entregables:{},label:{default:"Entregables Relacionados"},description:{default:"Selecciona los entregables del proyecto que se relacionan"},maxSelections:{default:50},disabled:{type:Boolean,default:!1},showCard:{type:Boolean,default:!1},height:{default:"16rem"}},emits:["update:modelValue"],setup(d,{emit:R}){const c=d,y=R,i=O({search:"",hito:null,estado:null}),j=x(()=>{const s=new Set;return c.entregables.forEach(e=>{e.hito&&s.add(e.hito)}),Array.from(s).sort()}),H=[{value:"pendiente",label:"Pendiente"},{value:"en_progreso",label:"En Progreso"},{value:"completado",label:"Completado"},{value:"cancelado",label:"Cancelado"}],b=x(()=>{let s=[...c.entregables];if(i.value.search){const e=i.value.search.toLowerCase();s=s.filter(t=>t.nombre.toLowerCase().includes(e)||t.hito.toLowerCase().includes(e))}return i.value.hito&&(s=s.filter(e=>e.hito===i.value.hito)),i.value.estado&&(s=s.filter(e=>e.estado===i.value.estado)),s}),k=x(()=>i.value.search!==""||i.value.hito!==null||i.value.estado!==null),M=x(()=>c.modelValue.length),p=x(()=>c.modelValue.length<c.maxSelections),C=s=>c.modelValue.includes(s),B=s=>{if(c.disabled)return;let e=[...c.modelValue];C(s)?e=e.filter(t=>t!==s):p.value&&e.push(s),y("update:modelValue",e)},F=()=>{i.value={search:"",hito:null,estado:null}},P=()=>{if(c.disabled)return;const s=b.value.map(t=>t.id),e=[...new Set([...c.modelValue,...s])];y("update:modelValue",e.slice(0,c.maxSelections))},q=()=>{if(c.disabled)return;const s=new Set(b.value.map(t=>t.id)),e=c.modelValue.filter(t=>!s.has(t));y("update:modelValue",e)},I=s=>{const e={pendiente:"bg-gray-100 text-gray-700 border-gray-200",en_progreso:"bg-blue-100 text-blue-700 border-blue-200",completado:"bg-green-100 text-green-700 border-green-200",cancelado:"bg-red-100 text-red-700 border-red-200"};return e[s]||e.pendiente},X=s=>{switch(s){case"completado":return ce;case"en_progreso":return ue;case"cancelado":return A;default:return re}},G=s=>{if(!s)return null;try{return new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"short"})}catch{return s}};return(s,e)=>(n(),h(w(d.showCard?a(Y):"div"),null,{default:o(()=>[d.showCard?(n(),h(a(Z),{key:0,class:"pb-3"},{default:o(()=>[l(a(ee),{class:"text-base"},{default:o(()=>[r(u(d.label),1)]),_:1}),d.description?(n(),h(a(T),{key:0},{default:o(()=>[r(u(d.description),1)]),_:1})):f("",!0)]),_:1})):f("",!0),(n(),h(w(d.showCard?a(te):"div"),{class:"space-y-3"},{default:o(()=>[!d.showCard&&d.label?(n(),v("div",me,[l(a($),null,{default:o(()=>[r(u(d.label),1)]),_:1}),d.description?(n(),h(a(T),{key:0,class:"mt-1"},{default:o(()=>[r(u(d.description),1)]),_:1})):f("",!0)])):f("",!0),m("div",fe,[m("div",ve,[m("div",he,[l(a(oe),{class:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),l(a(ae),{modelValue:i.value.search,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.search=t),placeholder:"Buscar entregable...",class:"pl-8 h-9",disabled:d.disabled},null,8,["modelValue","disabled"]),i.value.search?(n(),v("button",{key:0,onClick:e[1]||(e[1]=t=>i.value.search=""),class:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"},[l(a(A),{class:"h-4 w-4"})])):f("",!0)]),l(a(E),{variant:"outline",class:"whitespace-nowrap"},{default:o(()=>[r(u(M.value)+" seleccionados ",1)]),_:1})]),m("div",be,[m("div",xe,[l(a($),{class:"text-xs text-muted-foreground mb-1 block"},{default:o(()=>[...e[5]||(e[5]=[r("Hito",-1)])]),_:1}),l(a(U),{"model-value":i.value.hito||"all","onUpdate:modelValue":e[2]||(e[2]=t=>i.value.hito=t==="all"?null:t),disabled:d.disabled},{default:o(()=>[l(a(z),{class:"h-9"},{default:o(()=>[l(a(D),{placeholder:"Todos los hitos"})]),_:1}),l(a(N),null,{default:o(()=>[l(a(_),{value:"all"},{default:o(()=>[...e[6]||(e[6]=[r("Todos los hitos",-1)])]),_:1}),(n(!0),v(V,null,S(j.value,t=>(n(),h(a(_),{key:t,value:t},{default:o(()=>[r(u(t),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),m("div",pe,[l(a($),{class:"text-xs text-muted-foreground mb-1 block"},{default:o(()=>[...e[7]||(e[7]=[r("Estado",-1)])]),_:1}),l(a(U),{"model-value":i.value.estado||"all","onUpdate:modelValue":e[3]||(e[3]=t=>i.value.estado=t==="all"?null:t),disabled:d.disabled},{default:o(()=>[l(a(z),{class:"h-9"},{default:o(()=>[l(a(D),{placeholder:"Todos los estados"})]),_:1}),l(a(N),null,{default:o(()=>[l(a(_),{value:"all"},{default:o(()=>[...e[8]||(e[8]=[r("Todos los estados",-1)])]),_:1}),(n(),v(V,null,S(H,t=>l(a(_),{key:t.value,value:t.value},{default:o(()=>[r(u(t.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value","disabled"])]),k.value?(n(),h(a(g),{key:0,variant:"ghost",size:"sm",onClick:F,class:"h-9"},{default:o(()=>[l(a(de),{class:"h-4 w-4 mr-1"}),e[9]||(e[9]=r(" Limpiar ",-1))]),_:1})):f("",!0)]),b.value.length>0?(n(),v("div",ge,[m("span",_e,u(b.value.length)+" encontrados ",1),e[12]||(e[12]=m("div",{class:"flex-1"},null,-1)),l(a(g),{variant:"ghost",size:"sm",onClick:P,disabled:d.disabled||!p.value,class:"h-7 text-xs"},{default:o(()=>[...e[10]||(e[10]=[r(" Seleccionar todos ",-1)])]),_:1},8,["disabled"]),l(a(g),{variant:"ghost",size:"sm",onClick:q,disabled:d.disabled,class:"h-7 text-xs"},{default:o(()=>[...e[11]||(e[11]=[r(" Deseleccionar ",-1)])]),_:1},8,["disabled"])])):f("",!0)]),l(a(le),{style:Q({height:d.height}),class:"border rounded-lg"},{default:o(()=>[m("div",ye,[b.value.length===0?(n(),v("div",ke,[l(a(ne),{class:"h-10 w-10 text-muted-foreground/50 mb-2"}),m("p",Ce,u(k.value?"No se encontraron entregables con los filtros aplicados":"No hay entregables disponibles"),1),k.value?(n(),h(a(g),{key:0,variant:"link",size:"sm",onClick:F,class:"mt-2"},{default:o(()=>[...e[13]||(e[13]=[r(" Limpiar filtros ",-1)])]),_:1})):f("",!0)])):f("",!0),(n(!0),v(V,null,S(b.value,t=>(n(),v("div",{key:t.id,class:L(["flex items-start gap-3 p-2 rounded-md hover:bg-accent/50 transition-colors cursor-pointer",{"opacity-50":d.disabled}]),onClick:J=>B(t.id)},[l(a(se),{id:`entregable-${t.id}`,checked:C(t.id),disabled:d.disabled||!C(t.id)&&!p.value,"onUpdate:checked":J=>B(t.id),onClick:e[4]||(e[4]=W(()=>{},["stop"])),class:"mt-0.5"},null,8,["id","checked","disabled","onUpdate:checked"]),m("div",Se,[m("span",Ve,u(t.nombre),1),m("div",$e,[l(a(E),{variant:"secondary",class:"text-xs font-normal"},{default:o(()=>[r(u(t.hito),1)]),_:2},1024),l(a(E),{variant:"outline",class:L(["text-xs font-normal",I(t.estado)])},{default:o(()=>[(n(),h(w(X(t.estado)),{class:"h-3 w-3 mr-1"})),r(" "+u(t.estado.replace("_"," ")),1)]),_:2},1032,["class"]),t.fecha_fin?(n(),v("span",Ee,[l(a(ie),{class:"h-3 w-3"}),r(" "+u(G(t.fecha_fin)),1)])):f("",!0)])])],10,we))),128))])]),_:1},8,["style"]),!p.value&&d.maxSelections<50?(n(),v("p",Be," Has alcanzado el lÃ­mite de "+u(d.maxSelections)+" selecciones. ",1)):f("",!0)]),_:1}))]),_:1}))}});export{Ke as _};
