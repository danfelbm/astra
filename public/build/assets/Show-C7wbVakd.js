import{_ as H}from"./AdminLayout.vue_vue_type_script_setup_true_lang-s8UCj-v6.js";import{r as $,W as C,d as W,i as y,e as d,f as o,u as s,p as G,w as r,g as a,j as g,t as c,b as v,P as A,h as m,q as J,n as N,F as V,k as L}from"./app-MhRkZYda.js";import{_ as h,a as x,b as E,c as q}from"./CardTitle.vue_vue_type_script_setup_true_lang-l03Rvke8.js";import{_ as w}from"./createLucideIcon-CtoO_Kiv.js";import{_ as M}from"./index-D9cSDYZw.js";import{_ as K}from"./Progress.vue_vue_type_script_setup_true_lang-BEOhj0aF.js";import{t as P}from"./index-C4AhATEj.js";import{E as X}from"./EtiquetaDisplay-DjuLBliz.js";import{E as Q}from"./EtiquetaSelector-B3AhsM4v.js";import{S as I}from"./square-pen-DZZBQ3vz.js";import{T as Y}from"./trash-2-BhEX4Sbt.js";import{F as Z}from"./zap-DxpGICYi.js";import{C as O}from"./calendar-G1jntOAT.js";import{C as ee}from"./clock-BnwLa_QT.js";import{a as te,T as ae}from"./target-B9U4ycgp.js";import{U}from"./user-ByVghZe9.js";import{B as se,C as oe}from"./circle-pause-bGOmkamz.js";import{C as re}from"./circle-check-big-Cw5ApxxX.js";import{C as ie}from"./circle-play-CrP0Om_x.js";import{C as le}from"./circle-alert-Crskc4s_.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-D128fxVw.js";import"./index-CKzDzxRj.js";import"./floating-ui.vue-Jtid5Cir.js";import"./x-DDu6o8kn.js";import"./Input.vue_vue_type_script_setup_true_lang-BIqg1Ebh.js";import"./index-D1N0p-74.js";import"./index-CGlb_uG-.js";import"./shield-C7We-wCE.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-ZgmtTIfd.js";import"./chevron-right-CLygI0q1.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BtbY9BuF.js";import"./VisuallyHidden-ClD0DDsS.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Cw5PJOxU.js";import"./check-DIKoOxln.js";import"./nullish-CHIgUVhi.js";import"./Label.vue_vue_type_script_setup_true_lang-dAqUlvBp.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-ZdbDwAbT.js";import"./map-pin-B5DXokRd.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-ZZIvmMj6.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BqmWBxIU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B_e-HSmn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DoAxHmi0.js";import"./users-jwOqaBj3.js";import"./vote-BbOfLgcg.js";import"./folder-open-CJtFOPOB.js";import"./send-B-3fqeSw.js";import"./file-text-CSf3KGSt.js";import"./briefcase-BhQcV9fE.js";import"./megaphone-l3pQSHwh.js";import"./user-check-TX_Nop_V.js";import"./mail-D2iFew9f.js";import"./message-square-DqgXAPvJ.js";import"./external-link-D5LXOYvq.js";import"./panel-left-Bv2yObtj.js";import"./index-DhGDRjjN.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Bt1CH-vI.js";import"./trending-up-B7HJYant.js";import"./award-B8SJSPjU.js";import"./hash-D4AC-sHz.js";import"./TabsTrigger.vue_vue_type_script_setup_true_lang-CHhWzZpt.js";import"./RovingFocusItem-CbR6igbu.js";import"./utils-D9jgK0ly.js";import"./index-DpGSr-Ww.js";import"./search-CWj5t0jZ.js";import"./useKbd-kRIii9yh.js";import"./VisuallyHiddenInput-Bw6ddUlF.js";import"./useEtiquetaHierarchy-cXKsOBMP.js";import"./list-IH8fxzaF.js";import"./plus-qawNJpnW.js";function ne(){const p=$(!1),n=$(null);async function _(l,i){return p.value=!0,n.value=null,new Promise((u,t)=>{C.post(`/admin/proyectos/${l}/etiquetas`,{etiqueta_id:i},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.value=!1,u(!0)},onError:e=>{p.value=!1,n.value=Object.values(e).join(", "),t(e)}})})}async function b(l,i){return p.value=!0,n.value=null,new Promise((u,t)=>{C.delete(`/admin/proyectos/${l}/etiquetas/${i}`,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.value=!1,u(!0)},onError:e=>{p.value=!1,n.value="Error al quitar la etiqueta",t(e)}})})}async function j(l,i){return p.value=!0,n.value=null,new Promise((u,t)=>{C.put(`/admin/proyectos/${l}/etiquetas/sync`,{etiquetas:i},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.value=!1,u(!0)},onError:e=>{p.value=!1,n.value="Error al sincronizar etiquetas",t(e)}})})}async function S(l){p.value=!0,n.value=null;try{const i=await fetch(`/admin/proyectos/${l}/etiquetas/suggest`);if(!i.ok)throw new Error("Error al obtener sugerencias");const u=await i.json();return p.value=!1,u.etiquetas||[]}catch(i){return p.value=!1,n.value="Error al obtener sugerencias de etiquetas",console.error(i),[]}}async function T(l){var i;p.value=!0,n.value=null;try{const u=await fetch("/admin/etiquetas",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""},body:JSON.stringify(l)});if(!u.ok){const e=await u.json();throw new Error(e.message||"Error al crear etiqueta")}const t=await u.json();return p.value=!1,t.data}catch(u){return p.value=!1,n.value=u.message||"Error al crear etiqueta",console.error(u),null}}async function z(l){if(l.length<2)return[];try{const i=await fetch(`/admin/etiquetas/search?q=${encodeURIComponent(l)}`);if(!i.ok)throw new Error("Error al buscar etiquetas");return(await i.json()).data||[]}catch(i){return console.error("Error buscando etiquetas:",i),[]}}function D(l){const i=new Map;return l.forEach(u=>{var e;const t=((e=u.categoria)==null?void 0:e.nombre)||"Sin categoría";i.has(t)||i.set(t,[]),i.get(t).push(u)}),i}function B(l){var i;return l.color||((i=l.categoria)==null?void 0:i.color)||"gray"}function F(l,i=10){return l<i}async function k(l,i){return p.value=!0,n.value=null,new Promise((u,t)=>{C.post(`/admin/proyectos/${l}/etiquetas/reorder`,{etiquetas:i},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.value=!1,u(!0)},onError:e=>{p.value=!1,n.value="Error al reordenar etiquetas",t(e)}})})}return{isLoading:p,error:n,addEtiquetaToProyecto:_,removeEtiquetaFromProyecto:b,syncEtiquetasProyecto:j,getSugerenciasEtiquetas:S,reorderEtiquetas:k,createEtiqueta:T,searchEtiquetas:z,groupEtiquetasByCategoria:D,getEtiquetaColor:B,canAddMoreEtiquetas:F}}const ue={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},de={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},ce={class:"text-2xl font-bold text-gray-900 dark:text-white"},pe={key:0,class:"mt-2 text-gray-600 dark:text-gray-400"},me={class:"flex gap-2"},fe={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},ye={class:"lg:col-span-2 space-y-4"},ge={class:"flex items-center justify-between"},ve={class:"flex items-center gap-3"},_e={class:"flex items-center gap-3"},be={class:"space-y-2"},he={class:"flex justify-between text-sm"},xe={class:"font-medium"},Ee={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2"},qe={class:"flex items-start gap-3"},we={class:"font-medium"},ke={class:"text-xs text-gray-500"},Ce={key:0,class:"flex items-start gap-3"},Se={class:"font-medium"},Pe={class:"text-xs text-gray-500"},$e={key:0,class:"flex items-center gap-3 pt-2"},je={class:"font-medium ml-2"},Te={key:0},ze={key:1,class:"text-sm text-muted-foreground"},De={key:1,class:"space-y-4"},Be={class:"flex gap-2"},Fe={class:"space-y-3"},Ae={class:"text-sm text-gray-600 dark:text-gray-400"},Ne={class:"font-medium"},Ve={class:"space-y-3"},Me={class:"w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},Ie={class:"flex-1"},Re={class:"text-sm"},Le={class:"font-medium"},Oe={class:"text-xs text-gray-500 mt-1"},Ue={class:"space-y-4"},He={key:0,class:"flex items-center gap-3"},We={class:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},Ge={class:"font-medium"},Je={class:"text-sm text-gray-500"},Ke={key:1,class:"text-gray-500"},Xe={class:"font-mono"},Qe={class:"font-medium"},Ye={class:"text-sm"},Ze={class:"text-sm"},ga=W({__name:"Show",props:{proyecto:{},categorias:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canManageTags:{type:Boolean}},setup(p){const n=p,_=$(!1),b=$([]),{syncEtiquetasProyecto:j,isLoading:S}=ne();n.proyecto.etiquetas&&(b.value=n.proyecto.etiquetas.map(t=>t.id));const T=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:n.proyecto.nombre,href:`/admin/proyectos/${n.proyecto.id}`}],z=()=>{confirm(`¿Estás seguro de eliminar el proyecto "${n.proyecto.nombre}"?`)&&C.delete(`/admin/proyectos/${n.proyecto.id}`,{onSuccess:()=>{P.success("Proyecto eliminado exitosamente")},onError:()=>{P.error("Error al eliminar el proyecto")}})},D=t=>({planificacion:ae,en_progreso:ie,pausado:oe,completado:re,cancelado:se})[t]||le,B=t=>({planificacion:"bg-blue-100 text-blue-800",en_progreso:"bg-yellow-100 text-yellow-800",pausado:"bg-orange-100 text-orange-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",F=t=>({baja:"bg-gray-100 text-gray-800",media:"bg-blue-100 text-blue-800",alta:"bg-orange-100 text-orange-800",critica:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",k=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),l=t=>{const e=Math.floor((new Date(t).getTime()-new Date().getTime())/864e5);return e===0?"Hoy":e===1?"Mañana":e===-1?"Ayer":e>0?`En ${e} días`:`Hace ${Math.abs(e)} días`},i=async()=>{try{await j(n.proyecto.id,b.value),_.value=!1,P.success("Etiquetas actualizadas exitosamente"),C.reload({only:["proyecto"]})}catch{P.error("Error al actualizar las etiquetas")}},u=()=>{var t;b.value=((t=n.proyecto.etiquetas)==null?void 0:t.map(e=>e.id))||[],_.value=!1};return(t,e)=>(d(),y(V,null,[o(s(G),{title:`Proyecto: ${t.proyecto.nombre}`},null,8,["title"]),o(H,{breadcrumbs:T},{default:r(()=>[a("div",ue,[a("div",de,[a("div",null,[a("h1",ce,c(t.proyecto.nombre),1),t.proyecto.descripcion?(d(),y("p",pe,c(t.proyecto.descripcion),1)):g("",!0)]),a("div",me,[t.canEdit?(d(),v(s(A),{key:0,href:`/admin/proyectos/${t.proyecto.id}/edit`},{default:r(()=>[o(s(w),null,{default:r(()=>[o(s(I),{class:"mr-2 h-4 w-4"}),e[2]||(e[2]=m(" Editar ",-1))]),_:1})]),_:1},8,["href"])):g("",!0),t.canDelete?(d(),v(s(w),{key:1,variant:"destructive",onClick:z},{default:r(()=>[o(s(Y),{class:"mr-2 h-4 w-4"}),e[3]||(e[3]=m(" Eliminar ",-1))]),_:1})):g("",!0)])]),a("div",fe,[a("div",ye,[o(s(h),null,{default:r(()=>[o(s(x),null,{default:r(()=>[o(s(E),null,{default:r(()=>[...e[4]||(e[4]=[m("Estado del Proyecto",-1)])]),_:1})]),_:1}),o(s(q),{class:"space-y-4"},{default:r(()=>[a("div",ge,[a("div",ve,[(d(),v(J(D(t.proyecto.estado)),{class:"h-5 w-5 text-gray-500"})),e[5]||(e[5]=a("span",{class:"font-medium"},"Estado:",-1)),o(s(M),{class:N(B(t.proyecto.estado))},{default:r(()=>[m(c(t.proyecto.estado_label),1)]),_:1},8,["class"])]),a("div",_e,[o(s(Z),{class:"h-5 w-5 text-gray-500"}),e[6]||(e[6]=a("span",{class:"font-medium"},"Prioridad:",-1)),o(s(M),{class:N(F(t.proyecto.prioridad))},{default:r(()=>[m(c(t.proyecto.prioridad_label),1)]),_:1},8,["class"])])]),a("div",be,[a("div",he,[e[7]||(e[7]=a("span",{class:"text-gray-600 dark:text-gray-400"},"Progreso",-1)),a("span",xe,c(t.proyecto.porcentaje_completado)+"%",1)]),o(s(K),{value:t.proyecto.porcentaje_completado,class:"h-2"},null,8,["value"])]),a("div",Ee,[a("div",qe,[o(s(O),{class:"h-5 w-5 text-gray-500 mt-0.5"}),a("div",null,[e[8]||(e[8]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de inicio",-1)),a("p",we,c(k(t.proyecto.fecha_inicio)),1),a("p",ke,c(l(t.proyecto.fecha_inicio)),1)])]),t.proyecto.fecha_fin?(d(),y("div",Ce,[o(s(O),{class:"h-5 w-5 text-gray-500 mt-0.5"}),a("div",null,[e[9]||(e[9]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de fin",-1)),a("p",Se,c(k(t.proyecto.fecha_fin)),1),a("p",Pe,c(l(t.proyecto.fecha_fin)),1)])])):g("",!0)]),t.proyecto.duracion_dias?(d(),y("div",$e,[o(s(ee),{class:"h-5 w-5 text-gray-500"}),a("div",null,[e[10]||(e[10]=a("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Duración total:",-1)),a("span",je,c(t.proyecto.duracion_dias)+" días",1)])])):g("",!0)]),_:1})]),_:1}),o(s(h),null,{default:r(()=>[o(s(x),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[o(s(E),{class:"flex items-center gap-2"},{default:r(()=>[o(s(te),{class:"h-5 w-5"}),e[11]||(e[11]=m(" Etiquetas ",-1))]),_:1}),t.canManageTags&&!_.value?(d(),v(s(w),{key:0,variant:"ghost",size:"sm",onClick:e[0]||(e[0]=f=>_.value=!0)},{default:r(()=>[o(s(I),{class:"h-4 w-4"})]),_:1})):g("",!0)]),_:1}),o(s(q),null,{default:r(()=>[_.value?(d(),y("div",De,[t.categorias?(d(),v(Q,{key:0,modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=f=>b.value=f),categorias:t.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas...",description:"Selecciona hasta 10 etiquetas para este proyecto"},null,8,["modelValue","categorias"])):g("",!0),a("div",Be,[o(s(w),{size:"sm",onClick:i,disabled:s(S)},{default:r(()=>[...e[12]||(e[12]=[m(" Guardar ",-1)])]),_:1},8,["disabled"]),o(s(w),{size:"sm",variant:"outline",onClick:u,disabled:s(S)},{default:r(()=>[...e[13]||(e[13]=[m(" Cancelar ",-1)])]),_:1},8,["disabled"])])])):(d(),y("div",Te,[t.proyecto.etiquetas&&t.proyecto.etiquetas.length>0?(d(),v(X,{key:0,etiquetas:t.proyecto.etiquetas,"show-categoria":!0,interactive:!0,size:"md"},null,8,["etiquetas"])):(d(),y("p",ze," No hay etiquetas asignadas "))]))]),_:1})]),_:1}),t.proyecto.campos_personalizados&&t.proyecto.campos_personalizados.length>0?(d(),v(s(h),{key:0},{default:r(()=>[o(s(x),null,{default:r(()=>[o(s(E),null,{default:r(()=>[...e[14]||(e[14]=[m("Campos Personalizados",-1)])]),_:1})]),_:1}),o(s(q),null,{default:r(()=>[a("div",Fe,[(d(!0),y(V,null,L(t.proyecto.campos_personalizados,f=>(d(),y("div",{key:f.id,class:"flex justify-between py-2 border-b last:border-b-0"},[a("span",Ae,c(f.nombre),1),a("span",Ne,c(f.valor_formateado||f.valor||"-"),1)]))),128))])]),_:1})]),_:1})):g("",!0),t.proyecto.activities&&t.proyecto.activities.length>0?(d(),v(s(h),{key:1},{default:r(()=>[o(s(x),null,{default:r(()=>[o(s(E),null,{default:r(()=>[...e[15]||(e[15]=[m("Actividad Reciente",-1)])]),_:1})]),_:1}),o(s(q),null,{default:r(()=>[a("div",Ve,[(d(!0),y(V,null,L(t.proyecto.activities,f=>{var R;return d(),y("div",{key:f.id,class:"flex items-start gap-3 pb-3 border-b last:border-b-0"},[a("div",Me,[o(s(U),{class:"h-4 w-4 text-gray-500"})]),a("div",Ie,[a("p",Re,[a("span",Le,c(((R=f.causer)==null?void 0:R.name)||"Sistema"),1),m(" "+c(f.description),1)]),a("p",Oe,c(l(f.created_at)),1)])])}),128))])]),_:1})]),_:1})):g("",!0)]),a("div",Ue,[o(s(h),null,{default:r(()=>[o(s(x),null,{default:r(()=>[o(s(E),null,{default:r(()=>[...e[16]||(e[16]=[m("Responsable",-1)])]),_:1})]),_:1}),o(s(q),null,{default:r(()=>[t.proyecto.responsable?(d(),y("div",He,[a("div",We,[o(s(U),{class:"h-5 w-5 text-gray-500"})]),a("div",null,[a("p",Ge,c(t.proyecto.responsable.name),1),a("p",Je,c(t.proyecto.responsable.email),1)])])):(d(),y("p",Ke,"Sin asignar"))]),_:1})]),_:1}),o(s(h),null,{default:r(()=>[o(s(x),null,{default:r(()=>[o(s(E),null,{default:r(()=>[...e[17]||(e[17]=[m("Información del Sistema",-1)])]),_:1})]),_:1}),o(s(q),{class:"space-y-3"},{default:r(()=>{var f;return[a("div",null,[e[18]||(e[18]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"ID del Proyecto",-1)),a("p",Xe,"#"+c(t.proyecto.id),1)]),a("div",null,[e[19]||(e[19]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Estado",-1)),o(s(M),{class:N(t.proyecto.activo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800")},{default:r(()=>[m(c(t.proyecto.activo?"Activo":"Inactivo"),1)]),_:1},8,["class"])]),a("div",null,[e[20]||(e[20]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Creado por",-1)),a("p",Qe,c(((f=t.proyecto.creador)==null?void 0:f.name)||"Sistema"),1)]),a("div",null,[e[21]||(e[21]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de creación",-1)),a("p",Ye,c(k(t.proyecto.created_at)),1)]),a("div",null,[e[22]||(e[22]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Última actualización",-1)),a("p",Ze,c(k(t.proyecto.updated_at)),1)])]}),_:1})]),_:1}),o(s(h),null,{default:r(()=>[o(s(x),null,{default:r(()=>[o(s(E),null,{default:r(()=>[...e[23]||(e[23]=[m("Acciones Rápidas",-1)])]),_:1})]),_:1}),o(s(q),{class:"space-y-2"},{default:r(()=>[o(s(A),{href:"/admin/proyectos"},{default:r(()=>[o(s(w),{variant:"outline",class:"w-full justify-start"},{default:r(()=>[...e[24]||(e[24]=[m(" Volver al listado ",-1)])]),_:1})]),_:1}),t.canEdit?(d(),v(s(A),{key:0,href:`/admin/proyectos/${t.proyecto.id}/edit`},{default:r(()=>[o(s(w),{variant:"outline",class:"w-full justify-start"},{default:r(()=>[o(s(I),{class:"mr-2 h-4 w-4"}),e[25]||(e[25]=m(" Editar proyecto ",-1))]),_:1})]),_:1},8,["href"])):g("",!0)]),_:1})]),_:1})])])])]),_:1})],64))}});export{ga as default};
