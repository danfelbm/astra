import{d as H,r as b,c as S,o as D,B as Q,b as $,m as t,O as G,w as u,i as s,j as k,e as o,f as e,h as r,g as i,t as c,a as L,u as q,q as J,l as M,n as K,F as Y,k as Z}from"./app-DMuAIQna.js";import{_ as B}from"./InputError.vue_vue_type_script_setup_true_lang-jQaY_KtT.js";import{a as ee,b as te,c as ae,_ as se}from"./CardTitle.vue_vue_type_script_setup_true_lang-BuU4x3mY.js";import{_ as W,a as F}from"./index-DpE8LhEi.js";import{_ as O}from"./AlertTitle.vue_vue_type_script_setup_true_lang-CRF_NwO_.js";import{_ as oe}from"./index-ByRNdMTg.js";import{_ as T}from"./createLucideIcon-DVREvg6J.js";import{_ as ne}from"./Progress.vue_vue_type_script_setup_true_lang-2K8Fv54y.js";import{_ as z}from"./Skeleton.vue_vue_type_script_setup_true_lang-D-Bujckb.js";import{L as P}from"./loader-circle-BqKSK0Eu.js";import{C as ie}from"./clock-YZLdRJhP.js";import{C as le}from"./circle-alert-DLR_15wS.js";import{T as re}from"./timer-iy_reTAC.js";import{I as de}from"./info-BDF1BKU4.js";import{R as ue}from"./refresh-cw-D7ZN7J1x.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as pe}from"./Input.vue_vue_type_script_setup_true_lang-BGVUfrGL.js";import{_ as N}from"./Label.vue_vue_type_script_setup_true_lang-BjkfVnrt.js";import{_ as me,a as fe,b as ve}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-K4F9AxgZ.js";import{_ as _e}from"./AuthLayout.vue_vue_type_script_setup_true_lang-OW7YuUyF.js";import{M as he}from"./mail-DfeHhtpF.js";import"./index-DhwjMzhI.js";import"./VisuallyHidden-B9gbRvHT.js";import"./nullish-CHIgUVhi.js";import"./useArrowNavigation-B5rxJs06.js";import"./VisuallyHiddenInput-CRay1ql6.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-cf_yvTXL.js";const ge={key:0,class:"mt-4"},ye={key:0,class:"space-y-3"},xe={key:1,class:"space-y-4"},be={key:0,class:"space-y-2"},ke={class:"flex items-center justify-between"},we={class:"text-sm text-muted-foreground"},Ce={key:1,class:"space-y-2"},$e={key:2,class:"space-y-2"},Ie={class:"flex items-center justify-between"},Ee={class:"text-sm font-medium"},Re={class:"flex items-center gap-2 text-xs text-muted-foreground"},Te={key:3,class:"mt-4 pt-4 border-t"},Se={key:2,class:"text-center py-4"},je=H({__name:"OTPQueueStatus",props:{type:{},identifier:{},autoRefresh:{type:Boolean,default:!0},refreshInterval:{default:5e3},showRateLimitInfo:{type:Boolean,default:!0}},emits:["statusUpdate","error"],setup(w,{emit:p}){const f=w,_=p,m=b(!1),h=b(!1),a=b(null),x=b(5),v=b(null),g=b(null),y=S(()=>{if(!a.value||a.value.total_ahead===0)return 100;const C=a.value.position+10,l=C-a.value.position;return Math.min(100,Math.round(l/C*100))}),j=S(()=>f.type==="email"?2:5),I=async()=>{var C;m.value=!0;try{const l=await L.get(`/api/queue/otp/position/${encodeURIComponent(f.identifier)}`,{params:{type:f.type}});l.data.success&&(a.value=l.data.data,h.value=!0,_("statusUpdate",a.value),a.value.position===0&&V())}catch(l){if(((C=l.response)==null?void 0:C.status)===404)try{const d=await L.get("/api/queue/otp/estimate",{params:{type:f.type}});d.data.success&&(a.value=d.data.data,h.value=!0,_("statusUpdate",a.value))}catch(d){console.error("Error obteniendo estimación:",d),_("error",d)}else console.error("Error verificando estado:",l),_("error",l)}finally{m.value=!1}},E=()=>{f.autoRefresh&&(v.value=window.setInterval(()=>{I(),U()},f.refreshInterval),g.value=window.setInterval(()=>{x.value=Math.max(0,x.value-1)},1e3))},V=()=>{v.value&&(clearInterval(v.value),v.value=null),g.value&&(clearInterval(g.value),g.value=null)},U=()=>{x.value=Math.floor(f.refreshInterval/1e3)};return D(()=>{I(),E()}),Q(()=>{V()}),(C,l)=>(t(),$(G,{name:"fade"},{default:u(()=>[h.value?(t(),s("div",ge,[o(e(se),null,{default:u(()=>[o(e(ee),null,{default:u(()=>[o(e(te),{class:"flex items-center gap-2"},{default:u(()=>[m.value?(t(),$(e(P),{key:0,class:"h-4 w-4 animate-spin"})):(t(),$(e(ie),{key:1,class:"h-4 w-4"})),l[0]||(l[0]=r(" Estado de envío de tu código ",-1))]),_:1})]),_:1}),o(e(ae),null,{default:u(()=>[m.value?(t(),s("div",ye,[o(e(z),{class:"h-4 w-full"}),o(e(z),{class:"h-4 w-3/4"})])):a.value?(t(),s("div",xe,[a.value.position>1?(t(),s("div",be,[i("div",ke,[l[1]||(l[1]=i("span",{class:"text-sm text-muted-foreground"},"Posición en cola",-1)),o(e(oe),{variant:"secondary"},{default:u(()=>[r(c(a.value.position),1)]),_:1})]),o(e(ne),{value:y.value,class:"h-2"},null,8,["value"]),i("p",we,c(a.value.total_ahead)+" personas delante de ti ",1)])):a.value.position===1?(t(),s("div",Ce,[o(e(W),null,{default:u(()=>[o(e(le),{class:"h-4 w-4"}),o(e(O),null,{default:u(()=>[...l[2]||(l[2]=[r("Procesando tu solicitud",-1)])]),_:1}),o(e(F),null,{default:u(()=>[...l[3]||(l[3]=[r(" Tu código está siendo enviado en este momento... ",-1)])]),_:1})]),_:1})])):k("",!0),a.value.estimated_seconds>0?(t(),s("div",$e,[i("div",Ie,[l[4]||(l[4]=i("span",{class:"text-sm text-muted-foreground"},"Tiempo estimado",-1)),i("span",Ee,c(a.value.estimated_time),1)]),i("div",Re,[o(e(re),{class:"h-3 w-3"}),i("span",null,"Actualizando en "+c(x.value)+"s",1)])])):k("",!0),w.showRateLimitInfo?(t(),s("div",Te,[o(e(W),{variant:"info"},{default:u(()=>[o(e(de),{class:"h-4 w-4"}),o(e(O),null,{default:u(()=>[...l[5]||(l[5]=[r("¿Por qué la espera?",-1)])]),_:1}),o(e(F),null,{default:u(()=>[r(" Para garantizar la entrega confiable de mensajes, procesamos "+c(j.value)+" "+c(w.type==="email"?"correos":"mensajes")+" por segundo. Esto nos ayuda a mantener un servicio estable para todos. ",1)]),_:1})]),_:1})])):k("",!0)])):(t(),s("div",Se,[l[7]||(l[7]=i("p",{class:"text-sm text-muted-foreground"}," No se pudo obtener el estado de la cola ",-1)),o(e(T),{onClick:I,variant:"ghost",size:"sm",class:"mt-2"},{default:u(()=>[o(e(ue),{class:"h-3 w-3 mr-2"}),l[6]||(l[6]=r(" Reintentar ",-1))]),_:1})]))]),_:1})]),_:1})])):k("",!0)]),_:1}))}}),A=ce(je,[["__scopeId","data-v-4203e165"]]),Ve={key:0,class:"mb-4 text-center text-muted-foreground"},Pe={key:0},Ue={key:0},qe={key:1},Ae={key:2},Le={key:3},Me={key:1},Be={key:1,class:"mb-4 text-center text-muted-foreground"},We={key:0},Fe={key:1},Oe={key:2},ze={key:2,class:"mb-4 text-center text-sm font-medium text-green-600"},Ne={class:"grid gap-6"},He={class:"grid gap-2"},De={class:"relative"},Qe={class:"grid gap-6"},Xe={class:"text-center"},Ge={class:"text-sm text-muted-foreground"},Je={key:0},Ke={key:0},Ye={class:"font-medium"},Ze={key:1},et={class:"font-medium"},tt={key:2},at={class:"font-medium"},st={key:1},ot={key:0},nt={class:"font-medium"},it={key:1},lt={class:"font-medium"},rt={class:"font-medium"},dt={key:2},ut={class:"font-medium"},ct={class:"font-medium"},pt={key:0},mt={key:1},ft={class:"grid gap-2"},vt={class:"flex justify-center"},_t={class:"flex flex-col gap-3"},ht={class:"flex flex-col gap-2 text-center"},gt={class:"mt-6 text-center text-xs text-muted-foreground"},yt={key:0},xt={key:1},bt=["innerHTML"],Gt=H({__name:"LoginOTP",props:{status:{},authConfig:{},censoredEmail:{},otpCredential:{},otpChannel:{},whatsappEnabled:{type:Boolean},intendedUrl:{}},setup(w){const p=w,f=b(p.censoredEmail?"otp":"credential"),_=b(p.censoredEmail||""),m=S(()=>p.authConfig||{login_type:"email",input_type:"email",placeholder:"correo@ejemplo.com",pattern:null,label:"Correo Electrónico"}),h=q({credential:""}),a=q({credential:p.otpCredential||"",otp_code:[]}),x=q({credential:"",otp_code:""}),v=b(!1),g=b(0),y=b(null),j=S(()=>g.value===0),I=S(()=>g.value>0?`Reenviar en ${g.value}s`:"Reenviar código"),E=(d=60)=>{g.value=d,y.value&&clearInterval(y.value),y.value=window.setInterval(()=>{g.value--,g.value<=0&&(clearInterval(y.value),y.value=null)},1e3)},V=()=>{v.value=!0,h.post(route("auth.request-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),f.value="otp",a.credential=h.credential,a.clearErrors(),E(60)},onError:()=>{},onFinish:()=>{v.value=!1}})},U=()=>{const d=a.otp_code.join("");x.credential=a.credential,x.otp_code=d,x.post(route("auth.verify-otp"),{onSuccess:()=>{},onError:()=>{a.otp_code=[]}})},C=()=>{j.value&&(v.value=!0,a.post(route("auth.resend-otp"),{onSuccess:d=>{d.props&&d.props.censoredEmail&&(_.value=d.props.censoredEmail),E(60)},onFinish:()=>{v.value=!1}}))},l=()=>{f.value="credential",a.reset(),y.value&&(clearInterval(y.value),y.value=null),g.value=0};return D(()=>{f.value==="otp"&&E(60);const d=localStorage.getItem("intendedUrl");d&&!p.intendedUrl&&fetch("/login?intended="+encodeURIComponent(d),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{localStorage.removeItem("intendedUrl")})}),Q(()=>{y.value&&clearInterval(y.value)}),(d,n)=>(t(),$(_e,{title:f.value==="credential"?"Iniciar Sesión":"Verificar Código"},{default:u(()=>[o(e(J),{title:"Iniciar Sesión"}),f.value==="credential"?(t(),s("div",Ve,[m.value.login_type==="documento"?(t(),s("p",Pe,[n[2]||(n[2]=r(" Ingresa tu documento de identidad para recibir el código de verificación ",-1)),w.whatsappEnabled?p.otpChannel==="whatsapp"?(t(),s("strong",qe,"vía WhatsApp")):p.otpChannel==="both"?(t(),s("strong",Ae,"vía correo electrónico y WhatsApp")):(t(),s("strong",Le,"vía correo electrónico")):(t(),s("strong",Ue,"vía correo electrónico"))])):(t(),s("p",Me," Ingresa tu "+c(m.value.label.toLowerCase())+" para recibir el código de verificación ",1))])):(t(),s("div",Be,[p.otpChannel==="whatsapp"?(t(),s("p",We,[...n[3]||(n[3]=[r(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"WhatsApp",-1)])])):p.otpChannel==="both"?(t(),s("p",Fe,[...n[4]||(n[4]=[r(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"correo y WhatsApp",-1)])])):(t(),s("p",Oe,[...n[5]||(n[5]=[r(" Ingresa el código de 6 dígitos enviado a tu ",-1),i("strong",null,"correo",-1)])]))])),w.status?(t(),s("div",ze,c(w.status),1)):k("",!0),f.value==="credential"?(t(),s("form",{key:3,onSubmit:M(V,["prevent"]),class:"flex flex-col gap-6"},[i("div",Ne,[i("div",He,[o(e(N),{for:"credential"},{default:u(()=>[r(c(m.value.label),1)]),_:1}),i("div",De,[m.value.login_type==="email"?(t(),$(e(he),{key:0,class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})):k("",!0),o(e(pe),{id:"credential",type:m.value.input_type,required:"",autofocus:"",tabindex:"1",autocomplete:m.value.login_type==="email"?"email":"off",inputmode:m.value.login_type==="documento"?"numeric":void 0,modelValue:e(h).credential,"onUpdate:modelValue":n[0]||(n[0]=R=>e(h).credential=R),placeholder:m.value.placeholder,pattern:m.value.pattern,class:K({"pl-10":m.value.login_type==="email"})},null,8,["type","autocomplete","inputmode","modelValue","placeholder","pattern","class"])]),o(B,{message:e(h).errors.credential},null,8,["message"])]),o(e(T),{type:"submit",class:"mt-4 w-full",tabindex:"2",disabled:e(h).processing||v.value},{default:u(()=>[e(h).processing||v.value?(t(),$(e(P),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):k("",!0),r(" "+c(e(h).processing||v.value?"Enviando...":"Enviar Código"),1)]),_:1},8,["disabled"])])],32)):(t(),s("form",{key:4,onSubmit:M(U,["prevent"]),class:"flex flex-col gap-6"},[i("div",Qe,[i("div",Xe,[i("p",Ge,[m.value.login_type==="email"?(t(),s("span",Je,[p.otpChannel==="whatsapp"?(t(),s("span",Ke,[n[6]||(n[6]=r(" Código enviado por WhatsApp al número asociado con ",-1)),i("span",Ye,c(_.value||e(a).credential),1)])):p.otpChannel==="both"?(t(),s("span",Ze,[n[7]||(n[7]=r(" Código enviado al email ",-1)),i("span",et,c(_.value||e(a).credential),1),n[8]||(n[8]=r(" y WhatsApp ",-1))])):(t(),s("span",tt,[n[9]||(n[9]=r(" Código enviado al email ",-1)),i("span",at,c(_.value||e(a).credential),1)]))])):(t(),s("span",st,[p.otpChannel==="whatsapp"?(t(),s("span",ot,[n[10]||(n[10]=r(" Código enviado por WhatsApp al número asociado con el documento ",-1)),i("span",nt,c(e(a).credential),1)])):p.otpChannel==="both"?(t(),s("span",it,[n[11]||(n[11]=r(" Código enviado al email ",-1)),i("span",lt,c(_.value),1),n[12]||(n[12]=r(" y WhatsApp asociados al documento ",-1)),i("span",rt,c(e(a).credential),1)])):(t(),s("span",dt,[n[13]||(n[13]=r(" Código enviado al email ",-1)),i("span",ut,c(_.value),1),n[14]||(n[14]=r(" asociado al documento ",-1)),i("span",ct,c(e(a).credential),1)]))]))])]),p.otpChannel==="both"?(t(),s("div",pt,[o(A,{type:"email",identifier:_.value||e(a).credential,"show-rate-limit-info":!0},null,8,["identifier"]),o(A,{type:"whatsapp",identifier:e(a).credential,"show-rate-limit-info":!0},null,8,["identifier"])])):(t(),s("div",mt,[o(A,{type:p.otpChannel==="whatsapp"?"whatsapp":"email",identifier:p.otpChannel==="whatsapp"?e(a).credential:_.value||e(a).credential,"show-rate-limit-info":!0},null,8,["type","identifier"])])),i("div",ft,[o(e(N),{class:"text-center"},{default:u(()=>[...n[15]||(n[15]=[r("Código de Verificación",-1)])]),_:1}),i("div",vt,[o(e(me),{modelValue:e(a).otp_code,"onUpdate:modelValue":n[1]||(n[1]=R=>e(a).otp_code=R),length:6,type:"text",placeholder:"0",class:"gap-2"},{default:u(()=>[o(e(fe),null,{default:u(()=>[(t(),s(Y,null,Z(6,(R,X)=>o(e(ve),{key:R,index:X,class:"h-12 w-12 text-lg font-medium",inputmode:"numeric"},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue"])]),o(B,{message:e(a).errors.otp_code},null,8,["message"])]),i("div",_t,[o(e(T),{type:"submit",class:"w-full",disabled:e(x).processing||e(a).otp_code.join("").length!==6},{default:u(()=>[e(x).processing?(t(),$(e(P),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):k("",!0),r(" "+c(e(x).processing?"Verificando...":"Verificar Código"),1)]),_:1},8,["disabled"]),i("div",ht,[o(e(T),{type:"button",variant:"ghost",size:"sm",onClick:C,disabled:!j.value||v.value},{default:u(()=>[v.value?(t(),$(e(P),{key:0,class:"mr-2 h-3 w-3 animate-spin"})):k("",!0),r(" "+c(v.value?"Enviando...":I.value),1)]),_:1},8,["disabled"]),o(e(T),{type:"button",variant:"ghost",size:"sm",onClick:l},{default:u(()=>[r(c(m.value.login_type==="email"?"Cambiar correo electrónico":"Cambiar documento"),1)]),_:1})])])])],32)),i("div",gt,[f.value==="credential"?(t(),s("p",yt," Solo personas registradas como militantes pueden acceder al sistema. ")):(t(),s("p",xt," El código expira en 10 minutos. Si no lo recibes, verifica tu bandeja de spam. ")),n[16]||(n[16]=i("br",null,null,-1)),i("p",{innerHTML:d.$page.props.config["auth.mensaje_login"]||"Si necesitas ayuda escribe a <b>soporte@colombiahumana.co</b> para soporte sobre la plataforma. Para inquietudes jurídicas a <b>juridicoelectoral@colombiahumana.co</b>"},null,8,bt)])]),_:1},8,["title"]))}});export{Gt as default};
