import{_ as R,C as P}from"./index-km6xCIYg.js";import{_}from"./createLucideIcon-CviqBos0.js";import{_ as ae,c as ne}from"./CardTitle.vue_vue_type_script_setup_true_lang-BBY3VA40.js";import{_ as S}from"./Label.vue_vue_type_script_setup_true_lang-BLFZUZ5f.js";import{S as ie,U as L,_ as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-vkCaAvM3.js";import{d as X,a as p,i as A,o as d,f as s,F as N,r as G,j as I,u as o,W as Q,k as v,w as re,b as t,m as de,e as n,g as r,P as F,t as i,n as ue}from"./app-DItX2zhq.js";import{_ as ce}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-BOHLrkrU.js";import{_ as O,a as U,b as B,c as D,d as z,e as H}from"./DialogTitle.vue_vue_type_script_setup_true_lang-g_plKu7b.js";import{_ as j}from"./Checkbox.vue_vue_type_script_setup_true_lang-DkMabsri.js";import{M as E}from"./mail-By6BenGq.js";import{S as T}from"./send-FWyuWeeJ.js";import{C as J}from"./clock-CbMi1JGM.js";import{E as me}from"./eye-D5JZb8la.js";import{M as K}from"./message-square-DRV7DvO7.js";import"./index-Br5DeLJK.js";import"./check-B0GmKO8q.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-GChdzzfG.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-ChQ46kcI.js";import"./VisuallyHidden-DozJCIER.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DwDNM_x7.js";import"./index-BG_CICwf.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-DAnUAWKH.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-BXQSN2b8.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-ogu3mjYS.js";import"./es-DfN3vIXC.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-Du79nBJO.js";import"./loader-circle-BDnOriwn.js";import"./trash-2-CPEQAdjA.js";import"./plus-D8mD3NNZ.js";import"./search-BmPWz5tU.js";import"./history-DuvQwshS.js";import"./save-DpT3dP4F.js";const pe={key:0,class:"mt-6 flex justify-center"},fe={class:"flex items-center gap-2"},ve=["innerHTML"],_e=X({__name:"Pagination",props:{links:{}},setup(W){const g=u=>({"pagination.previous":"&laquo; Anterior","pagination.next":"Siguiente &raquo;","&laquo; Previous":"&laquo; Anterior","Next &raquo;":"Siguiente &raquo;",Previous:"Anterior",Next:"Siguiente","...":"..."})[u]||u,V=u=>{u&&Q.get(u)};return(u,M)=>u.links&&u.links.length>3?(d(),p("div",pe,[s("div",fe,[(d(!0),p(N,null,G(u.links,f=>(d(),p(N,{key:f.label},[f.url?(d(),I(o(_),{key:0,variant:f.active?"default":"outline",size:"sm",onClick:b=>V(f.url),innerHTML:g(f.label)},null,8,["variant","onClick","innerHTML"])):(d(),p("span",{key:1,class:"px-3 py-1 text-sm text-muted-foreground cursor-not-allowed",innerHTML:g(f.label)},null,8,ve))],64))),128))])])):A("",!0)}}),ge={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},be={class:"flex items-center justify-between"},xe={class:"flex gap-3"},he={key:0,class:"text-center py-8"},ye={key:1,class:"space-y-4"},we={class:"flex items-start justify-between"},Ce={class:"flex-1"},ke={class:"flex items-center gap-2 mb-2"},$e={class:"text-lg font-semibold"},Ee={class:"text-muted-foreground mb-3"},Se={class:"grid gap-2 md:grid-cols-2 lg:grid-cols-4 text-sm"},je={class:"flex items-center gap-2"},Ae={class:"flex items-center gap-2"},Ne={key:0},Ve={class:"text-muted-foreground"},Me={key:1},Pe={key:0,class:"flex items-center gap-2"},Te={class:"flex items-center gap-2"},We={key:0,class:"mt-3 p-2 bg-blue-50 dark:bg-blue-950/20 rounded border-l-4 border-blue-200 dark:border-blue-800"},qe={class:"text-sm text-blue-800 dark:text-blue-200"},Re={class:"flex items-center gap-2 ml-4"},Le={class:"space-y-6"},Fe={class:"bg-orange-50 border border-orange-200 rounded-lg p-4"},Oe={class:"flex items-center gap-2 mb-3"},Ue={class:"grid grid-cols-2 gap-3 text-sm"},Be={class:"flex justify-between"},De={class:"font-medium text-orange-900"},ze={class:"flex justify-between"},He={class:"font-medium text-orange-900"},Je={class:"flex justify-between"},Ke={class:"font-medium text-orange-900"},Xe={class:"flex justify-between"},Ge={class:"font-medium text-red-700"},Ie={class:"space-y-4"},Qe={class:"space-y-3"},Ye={class:"flex items-center space-x-3"},Ze={class:"flex items-center gap-2"},es={class:"text-sm text-muted-foreground ml-1"},ss={class:"flex items-center space-x-3"},ts={class:"flex items-center gap-2"},os={class:"text-sm text-muted-foreground ml-1"},as={class:"space-y-6"},ns={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},is={class:"flex items-center gap-2 mb-3"},ls={class:"grid grid-cols-2 gap-3 text-sm"},rs={class:"flex justify-between"},ds={class:"font-medium text-blue-900"},us={class:"flex justify-between"},cs={class:"font-medium text-blue-900"},ms={class:"flex justify-between"},ps={class:"font-medium text-blue-900"},fs={class:"flex justify-between"},vs={class:"font-medium text-red-700"},_s={class:"space-y-4"},gs={class:"space-y-3"},bs={class:"flex items-center space-x-3"},xs={class:"flex items-center gap-2"},hs={class:"text-sm text-muted-foreground ml-1"},ys={class:"flex items-center space-x-3"},ws={class:"flex items-center gap-2"},Cs={class:"text-sm text-muted-foreground ml-1"},ot=X({__name:"Index",props:{candidaturas:{},filters:{},filterFieldsConfig:{}},setup(W){const g=W,V=[{title:"Admin",href:"/admin/dashboard"},{title:"Candidaturas",href:"#"}],u=v({estado:g.filters.estado||"null",search:g.filters.search||""});re(u,l=>{const e=Object.entries(l).reduce((a,[oe,q])=>(a[oe]=q==="null"?"":q,a),{});Q.get("/admin/candidaturas",e,{preserveState:!0,replace:!0})},{deep:!0});const M={fields:g.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por nombre o email...",quickSearchFields:["user.name","user.email"],maxNestingLevel:2,allowSaveFilters:!0,debounceTime:500,autoApply:!1},{route:f}=window,b=v(!1),x=v(!1),h=v(!0),y=v(!0),c=v({total_borradores:0,con_email:0,con_telefono:0,sin_email:0,sin_telefono:0}),w=v(!1),C=v(!1),k=v(!0),$=v(!0),m=v({total_pendientes:0,con_email:0,con_telefono:0,sin_email:0,sin_telefono:0}),Y=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=async()=>{try{const e=await(await fetch(f("admin.candidaturas.estadisticas-borradores"))).json();c.value=e,b.value=!0}catch(l){console.error("Error cargando estadísticas:",l),alert("Error cargando estadísticas de candidaturas en borrador")}},ee=async()=>{try{const e=await(await fetch(f("admin.candidaturas.estadisticas-pendientes"))).json();m.value=e,w.value=!0}catch(l){console.error("Error cargando estadísticas:",l),alert("Error cargando estadísticas de candidaturas pendientes")}},se=async()=>{var l;if(!k.value&&!$.value){alert("Debes seleccionar al menos un tipo de notificación (email o WhatsApp)");return}C.value=!0;try{const a=await(await fetch(f("admin.candidaturas.enviar-notificaciones"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""},body:JSON.stringify({incluir_email:k.value,incluir_whatsapp:$.value})})).json();a.success?(w.value=!1,alert(`Notificaciones enviadas exitosamente!

• Candidaturas procesadas: ${a.contadores.total_candidaturas}
• Correos programados: ${a.contadores.emails_enviados}
• WhatsApps programados: ${a.contadores.whatsapps_enviados}
• Errores: ${a.contadores.errores}

Los mensajes se están enviando en segundo plano respetando los límites de velocidad configurados.`)):alert(`Error: ${a.message}`)}catch(e){console.error("Error enviando notificaciones:",e),alert("Error enviando notificaciones. Por favor intenta de nuevo.")}finally{C.value=!1}},te=async()=>{var l;if(!h.value&&!y.value){alert("Debes seleccionar al menos un tipo de recordatorio (email o WhatsApp)");return}x.value=!0;try{const a=await(await fetch(f("admin.candidaturas.enviar-recordatorios"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""},body:JSON.stringify({incluir_email:h.value,incluir_whatsapp:y.value})})).json();a.success?(b.value=!1,alert(`Recordatorios enviados exitosamente!

• Candidaturas procesadas: ${a.contadores.total_candidaturas}
• Correos programados: ${a.contadores.emails_enviados}
• WhatsApps programados: ${a.contadores.whatsapps_enviados}
• Errores: ${a.contadores.errores}

Los mensajes se están enviando en segundo plano respetando los límites de velocidad configurados.`)):alert(`Error: ${a.message}`)}catch(e){console.error("Error enviando recordatorios:",e),alert("Error enviando recordatorios. Por favor intenta de nuevo.")}finally{x.value=!1}};return(l,e)=>(d(),p(N,null,[t(o(de),{title:"Candidaturas"}),t(le,{breadcrumbs:V},{default:n(()=>[s("div",ge,[s("div",be,[e[11]||(e[11]=s("div",null,[s("h1",{class:"text-3xl font-bold"},"Candidaturas"),s("p",{class:"text-muted-foreground"}," Revisa y gestiona los perfiles de candidatura de los usuarios ")],-1)),s("div",xe,[t(o(_),{onClick:ee,variant:"outline",class:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100 hover:border-blue-300"},{default:n(()=>[t(o(E),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=r(" Notificaciones "))]),_:1}),t(o(_),{onClick:Z,variant:"outline",class:"bg-orange-50 border-orange-200 text-orange-700 hover:bg-orange-100 hover:border-orange-300"},{default:n(()=>[t(o(T),{class:"mr-2 h-4 w-4"}),e[9]||(e[9]=r(" Recordatorios "))]),_:1}),t(o(F),{href:"/admin/candidaturas/configuracion"},{default:n(()=>[t(o(_),null,{default:n(()=>[t(o(ie),{class:"mr-2 h-4 w-4"}),e[10]||(e[10]=r(" Configuración "))]),_:1})]),_:1})])]),t(ce,{config:M,route:o(f)("admin.candidaturas.index"),"initial-filters":{quickSearch:u.value.search,rootGroup:u.value.advanced_filters?JSON.parse(u.value.advanced_filters):void 0}},null,8,["route","initial-filters"]),t(o(ae),null,{default:n(()=>[t(o(ne),{class:"pt-6"},{default:n(()=>[l.candidaturas.data.length===0?(d(),p("div",he,[t(o(L),{class:"mx-auto h-12 w-12 text-muted-foreground"}),e[12]||(e[12]=s("h3",{class:"mt-4 text-lg font-medium"},"No hay candidaturas",-1)),e[13]||(e[13]=s("p",{class:"text-muted-foreground"},"No se encontraron candidaturas con los filtros aplicados.",-1))])):(d(),p("div",ye,[(d(!0),p(N,null,G(l.candidaturas.data,a=>(d(),p("div",{key:a.id,class:"border rounded-lg p-4 hover:bg-muted/50 transition-colors"},[s("div",we,[s("div",Ce,[s("div",ke,[s("h3",$e,i(a.usuario.name),1),t(o(R),{class:ue(a.estado_color)},{default:n(()=>[r(i(a.estado_label),1)]),_:2},1032,["class"]),a.esta_pendiente?(d(),I(o(R),{key:0,variant:"outline",class:"bg-blue-50 text-blue-700"},{default:n(()=>e[14]||(e[14]=[r(" Pendiente Revisión ")])),_:1})):A("",!0)]),s("p",Ee,i(a.usuario.email),1),s("div",Se,[s("div",je,[t(o(J),{class:"h-4 w-4 text-muted-foreground"}),e[15]||(e[15]=s("span",{class:"font-medium"},"Versión:",-1)),s("span",null,i(a.version),1)]),s("div",Ae,[t(o(P),{class:"h-4 w-4 text-muted-foreground"}),e[16]||(e[16]=s("span",{class:"font-medium"},"Datos:",-1)),a.total_campos>0?(d(),p("span",Ne,[r(i(a.campos_llenados)+" / "+i(a.total_campos)+" ",1),s("span",Ve,"("+i(a.porcentaje_completado)+"%)",1)])):(d(),p("span",Me,"Sin configuración"))]),a.aprobado_por?(d(),p("div",Pe,[t(o(L),{class:"h-4 w-4 text-muted-foreground"}),e[17]||(e[17]=s("span",{class:"font-medium"},"Aprobado por:",-1)),s("span",null,i(a.aprobado_por.name),1)])):A("",!0),s("div",Te,[t(o(J),{class:"h-4 w-4 text-muted-foreground"}),e[18]||(e[18]=s("span",{class:"font-medium"},"Actualizado:",-1)),s("span",null,i(Y(a.updated_at)),1)])]),a.comentarios_admin?(d(),p("div",We,[s("p",qe,[e[19]||(e[19]=s("span",{class:"font-medium"},"Comentarios de la comisión:",-1)),r(" "+i(a.comentarios_admin),1)])])):A("",!0)]),s("div",Re,[t(o(F),{href:`/admin/candidaturas/${a.id}`},{default:n(()=>[t(o(_),{variant:"outline",size:"sm"},{default:n(()=>[t(o(me),{class:"h-4 w-4"})]),_:1})]),_:2},1032,["href"])])])]))),128))])),t(_e,{links:l.candidaturas.links},null,8,["links"])]),_:1})]),_:1}),t(o(O),{open:b.value,"onUpdate:open":e[3]||(e[3]=a=>b.value=a)},{default:n(()=>[t(o(U),{class:"sm:max-w-md"},{default:n(()=>[t(o(B),null,{default:n(()=>[t(o(D),{class:"flex items-center gap-2"},{default:n(()=>[t(o(T),{class:"h-5 w-5 text-orange-600"}),e[20]||(e[20]=r(" Enviar Recordatorios Masivos "))]),_:1}),t(o(z),null,{default:n(()=>e[21]||(e[21]=[r(" Envía recordatorios por correo y/o WhatsApp a todas las candidaturas en estado borrador. ")])),_:1})]),_:1}),s("div",Le,[s("div",Fe,[s("div",Oe,[t(o(P),{class:"h-5 w-5 text-orange-600"}),e[22]||(e[22]=s("h3",{class:"font-medium text-orange-900"},"Candidaturas en Borrador",-1))]),s("div",Ue,[s("div",Be,[e[23]||(e[23]=s("span",{class:"text-orange-700"},"Total en borrador:",-1)),s("span",De,i(c.value.total_borradores),1)]),s("div",ze,[e[24]||(e[24]=s("span",{class:"text-orange-700"},"Con email:",-1)),s("span",He,i(c.value.con_email),1)]),s("div",Je,[e[25]||(e[25]=s("span",{class:"text-orange-700"},"Con teléfono:",-1)),s("span",Ke,i(c.value.con_telefono),1)]),s("div",Xe,[e[26]||(e[26]=s("span",{class:"text-red-600"},"Sin contacto:",-1)),s("span",Ge,i(Math.max(0,c.value.total_borradores-Math.max(c.value.con_email,c.value.con_telefono))),1)])])]),s("div",Ie,[e[29]||(e[29]=s("h4",{class:"font-medium text-gray-900"},"Selecciona los tipos de recordatorio:",-1)),s("div",Qe,[s("div",Ye,[t(o(j),{id:"include-email",modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),disabled:c.value.con_email===0},null,8,["modelValue","disabled"]),s("div",Ze,[t(o(E),{class:"h-4 w-4 text-blue-600"}),t(o(S),{for:"include-email",class:"flex-1"},{default:n(()=>[e[27]||(e[27]=r(" Correo electrónico ")),s("span",es," ("+i(c.value.con_email)+" candidaturas) ",1)]),_:1})])]),s("div",ss,[t(o(j),{id:"include-whatsapp",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),disabled:c.value.con_telefono===0},null,8,["modelValue","disabled"]),s("div",ts,[t(o(K),{class:"h-4 w-4 text-green-600"}),t(o(S),{for:"include-whatsapp",class:"flex-1"},{default:n(()=>[e[28]||(e[28]=r(" WhatsApp ")),s("span",os," ("+i(c.value.con_telefono)+" candidaturas) ",1)]),_:1})])])])]),e[30]||(e[30]=s("div",{class:"text-xs text-muted-foreground bg-gray-50 border border-gray-200 rounded p-3"},[s("p",{class:"mb-1"},"• Los mensajes se envían respetando los límites de velocidad configurados"),s("p",{class:"mb-1"},"• Emails: 2 por segundo | WhatsApp: 5 por segundo"),s("p",null,"• El proceso se ejecuta en segundo plano")],-1))]),t(o(H),null,{default:n(()=>[t(o(_),{variant:"outline",onClick:e[2]||(e[2]=a=>b.value=!1),disabled:x.value},{default:n(()=>e[31]||(e[31]=[r(" Cancelar ")])),_:1},8,["disabled"]),t(o(_),{onClick:te,disabled:x.value||c.value.total_borradores===0||!h.value&&!y.value,class:"bg-orange-600 hover:bg-orange-700"},{default:n(()=>[t(o(T),{class:"mr-2 h-4 w-4"}),r(" "+i(x.value?"Enviando...":`Enviar Recordatorios (${c.value.total_borradores})`),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(o(O),{open:w.value,"onUpdate:open":e[7]||(e[7]=a=>w.value=a)},{default:n(()=>[t(o(U),{class:"sm:max-w-md"},{default:n(()=>[t(o(B),null,{default:n(()=>[t(o(D),{class:"flex items-center gap-2"},{default:n(()=>[t(o(E),{class:"h-5 w-5 text-blue-600"}),e[32]||(e[32]=r(" Enviar Notificaciones de Estado "))]),_:1}),t(o(z),null,{default:n(()=>e[33]||(e[33]=[r(" Envía notificaciones por correo y/o WhatsApp a todas las candidaturas en estado pendiente de revisión. ")])),_:1})]),_:1}),s("div",as,[s("div",ns,[s("div",is,[t(o(P),{class:"h-5 w-5 text-blue-600"}),e[34]||(e[34]=s("h3",{class:"font-medium text-blue-900"},"Candidaturas Pendientes de Revisión",-1))]),s("div",ls,[s("div",rs,[e[35]||(e[35]=s("span",{class:"text-blue-700"},"Total pendientes:",-1)),s("span",ds,i(m.value.total_pendientes),1)]),s("div",us,[e[36]||(e[36]=s("span",{class:"text-blue-700"},"Con email:",-1)),s("span",cs,i(m.value.con_email),1)]),s("div",ms,[e[37]||(e[37]=s("span",{class:"text-blue-700"},"Con teléfono:",-1)),s("span",ps,i(m.value.con_telefono),1)]),s("div",fs,[e[38]||(e[38]=s("span",{class:"text-red-600"},"Sin contacto:",-1)),s("span",vs,i(Math.max(0,m.value.total_pendientes-Math.max(m.value.con_email,m.value.con_telefono))),1)])])]),s("div",_s,[e[41]||(e[41]=s("h4",{class:"font-medium text-gray-900"},"Selecciona los tipos de notificación:",-1)),s("div",gs,[s("div",bs,[t(o(j),{id:"include-email-notif",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=a=>k.value=a),disabled:m.value.con_email===0},null,8,["modelValue","disabled"]),s("div",xs,[t(o(E),{class:"h-4 w-4 text-blue-600"}),t(o(S),{for:"include-email-notif",class:"flex-1"},{default:n(()=>[e[39]||(e[39]=r(" Correo electrónico ")),s("span",hs," ("+i(m.value.con_email)+" candidaturas) ",1)]),_:1})])]),s("div",ys,[t(o(j),{id:"include-whatsapp-notif",modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=a=>$.value=a),disabled:m.value.con_telefono===0},null,8,["modelValue","disabled"]),s("div",ws,[t(o(K),{class:"h-4 w-4 text-green-600"}),t(o(S),{for:"include-whatsapp-notif",class:"flex-1"},{default:n(()=>[e[40]||(e[40]=r(" WhatsApp ")),s("span",Cs," ("+i(m.value.con_telefono)+" candidaturas) ",1)]),_:1})])])])]),e[42]||(e[42]=s("div",{class:"text-xs text-muted-foreground bg-gray-50 border border-gray-200 rounded p-3"},[s("p",{class:"mb-1"},"• Se notificará que la candidatura fue recibida exitosamente"),s("p",{class:"mb-1"},"• Emails: 2 por segundo | WhatsApp: 5 por segundo"),s("p",null,"• El proceso se ejecuta en segundo plano")],-1))]),t(o(H),null,{default:n(()=>[t(o(_),{variant:"outline",onClick:e[6]||(e[6]=a=>w.value=!1),disabled:C.value},{default:n(()=>e[43]||(e[43]=[r(" Cancelar ")])),_:1},8,["disabled"]),t(o(_),{onClick:se,disabled:C.value||m.value.total_pendientes===0||!k.value&&!$.value,class:"bg-blue-600 hover:bg-blue-700"},{default:n(()=>[t(o(E),{class:"mr-2 h-4 w-4"}),r(" "+i(C.value?"Enviando...":`Enviar Notificaciones (${m.value.total_pendientes})`),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{ot as default};
