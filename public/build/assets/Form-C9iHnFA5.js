import{d as Q,r as S,c as T,p as q,i as c,e as a,g as l,w as o,f as e,h as d,J as se,K as le,l as V,t as p,j as C,F as B,k as D,b as M,n as K,m as u,u as oe,I as re,q as ne,s as ie}from"./app-BDg7E49x.js";import{c as X,_ as h}from"./createLucideIcon-BdVmm7P_.js";import{a as N,b as L,c as W,_ as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-PGdupcIB.js";import{_ as O}from"./CardDescription.vue_vue_type_script_setup_true_lang-BkVVIKEx.js";import{_ as de}from"./Input.vue_vue_type_script_setup_true_lang-DdSjcwnl.js";import{_ as I}from"./Label.vue_vue_type_script_setup_true_lang-np36qPXZ.js";import{_ as Y}from"./Textarea.vue_vue_type_script_setup_true_lang-D-ysd6cn.js";import{_ as ue}from"./Switch.vue_vue_type_script_setup_true_lang-Bnik07p_.js";import{_ as G,a as J}from"./index-BEZytBRS.js";import{_ as pe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DQtw_HzK.js";import{_ as me}from"./index-DjS2Yj2q.js";import{u as ce,V as fe}from"./useTemplateVariables-CXVATH20.js";import{E as ve}from"./eye-C8tnSqng.js";import{B as _e,I as be}from"./italic-M9qadL8y.js";import{S as Z}from"./smartphone-DZqr-ajJ.js";import{I as ee}from"./info-DAbqDYl0.js";import{t as E}from"./index-ClqqlYCG.js";import{A as ge}from"./arrow-left-CpbS6NHc.js";import{S as xe}from"./save-BSnvqq-9.js";import{C as he}from"./circle-alert-D2_vXx_s.js";import"./index-A85eAGP1.js";import"./VisuallyHidden-CaM2o_WC.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-tpq5Hvrt.js";import"./check-BSXmPTLR.js";import"./floating-ui.vue-BdF4JOJl.js";import"./VisuallyHiddenInput-8UdSZeuv.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-B3xcxErQ.js";import"./index-DwmLcJQk.js";import"./x-G0LZP78x.js";import"./index-Cp6BehJD.js";import"./shield-47ee-sAU.js";import"./user-DFclF7qW.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CbQ9dhwM.js";import"./chevron-right-DbDOw8_f.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CssOazgJ.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DmLL_yNx.js";import"./map-pin-CcReoaeK.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Bf2ruFqZ.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-fbrGXwCx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-C_zyeJPb.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-gLQTMRvN.js";import"./tag-DQ85ruQd.js";import"./users-B4eDDANw.js";import"./target-SmQeNmiJ.js";import"./vote-DLVjarZJ.js";import"./folder-open-Lae0pyJG.js";import"./send-BMsH3-Hb.js";import"./file-text-Dsaay5EU.js";import"./briefcase-BBbisQqT.js";import"./calendar-DCovRqU-.js";import"./megaphone-BpECQaLq.js";import"./user-check-lWsW8r3F.js";import"./clipboard-list-C9DnNK0q.js";import"./mail-C-MCuTK7.js";import"./message-square-BZT_4IMP.js";import"./external-link-q6POtaVR.js";import"./panel-left-Bq0PqqJ4.js";import"./index--7yEigtK.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=X("CodeIcon",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=X("StrikethroughIcon",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]),ke={class:"space-y-4"},$e={class:"flex justify-between items-center"},Ve={class:"flex gap-2"},Ce={class:"flex items-center gap-2 text-sm"},Ae={class:"space-y-2"},Ee={key:0,class:"flex items-center gap-2 p-2 border rounded-md bg-muted/30"},Me={key:1},Fe={key:2,class:"min-h-[240px] p-4 border rounded-md bg-gray-50"},Se={class:"max-w-sm mx-auto"},We={class:"bg-white rounded-lg shadow p-3"},Pe={class:"flex items-center gap-2 mb-2"},je=["innerHTML"],Ue={class:"space-y-3"},ze={class:"text-sm font-medium mb-2"},Ie={class:"flex flex-wrap gap-2"},Te={class:"space-y-2"},Be={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},De={class:"ml-2 font-medium"},Ne={class:"ml-2 font-medium"},Le=Q({__name:"WhatsAppTemplateEditor",props:{modelValue:{default:""},usaFormato:{type:Boolean,default:!0},placeholder:{default:"Escribe tu mensaje de WhatsApp..."}},emits:["update:modelValue","update:usaFormato","update:variables"],setup(j,{emit:_}){const f=j,F=_,{variableCategories:r,extractUsedVariables:A,replaceWithExamples:H,estimateLength:R}=ce(),m=S(f.modelValue),w=S(!1),y=S(null),k=S(f.usaFormato),$=n=>{if(!y.value)return;const t=y.value.$el;if(!t)return;const s=t.selectionStart??0,g=t.selectionEnd??0,i=m.value||"",b=i.substring(s,g);if(!b)return;let x="";switch(n){case"bold":x=`*${b}*`;break;case"italic":x=`_${b}_`;break;case"strikethrough":x=`~${b}~`;break;case"monospace":x=`\`\`\`${b}\`\`\``;break}const te=i.substring(0,s),ae=i.substring(g);m.value=te+x+ae,setTimeout(()=>{t&&(t.selectionStart=s,t.selectionEnd=s+x.length,t.focus())},0)},U=n=>{if(!y.value)return;const t=y.value.$el;if(!t)return;const s=t.selectionStart??0,g=m.value||"",i=g.substring(0,s),b=g.substring(s);m.value=i+n+b,setTimeout(()=>{if(t){const x=s+n.length;t.selectionStart=x,t.selectionEnd=x,t.focus()}},0)},z=T(()=>{let n=H(m.value);return k.value&&(n=n.replace(/\*(.*?)\*/g,"<strong>$1</strong>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/~(.*?)~/g,"<del>$1</del>").replace(/```(.*?)```/g,"<code>$1</code>").replace(/\n/g,"<br>")),n}),v=T(()=>{const n=R(m.value),t=A(m.value);return{charactersMin:n.min,charactersMax:n.max,charactersAvg:n.avg,variables:t.length,warningMax:n.max>4096,warningAvg:n.avg>4096}});return q(m,n=>{F("update:modelValue",n),F("update:variables",A(n))}),q(k,n=>{F("update:usaFormato",n)}),q(()=>f.modelValue,n=>{n!==m.value&&(m.value=n)}),(n,t)=>(u(),c("div",ke,[a(e(P),null,{default:o(()=>[a(e(N),null,{default:o(()=>[l("div",$e,[a(e(L),null,{default:o(()=>[...t[7]||(t[7]=[d("Mensaje de WhatsApp",-1)])]),_:1}),l("div",Ve,[l("label",Ce,[se(l("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=s=>k.value=s),class:"rounded"},null,512),[[le,k.value]]),t[8]||(t[8]=l("span",null,"Usar formato WhatsApp",-1))]),a(e(h),{type:"button",variant:"outline",size:"sm",onClick:t[1]||(t[1]=V(s=>w.value=!w.value,["prevent","stop"]))},{default:o(()=>[a(e(ve),{class:"w-4 h-4 mr-2"}),d(" "+p(w.value?"Editar":"Vista previa"),1)]),_:1})])])]),_:1}),a(e(W),null,{default:o(()=>[l("div",Ae,[k.value&&!w.value?(u(),c("div",Ee,[a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[2]||(t[2]=V(s=>$("bold"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(_e),{class:"h-4 w-4 mr-1"}),t[9]||(t[9]=d(" *texto* ",-1))]),_:1}),a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[3]||(t[3]=V(s=>$("italic"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(be),{class:"h-4 w-4 mr-1"}),t[10]||(t[10]=d(" _texto_ ",-1))]),_:1}),a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[4]||(t[4]=V(s=>$("strikethrough"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(ye),{class:"h-4 w-4 mr-1"}),t[11]||(t[11]=d(" ~texto~ ",-1))]),_:1}),a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[5]||(t[5]=V(s=>$("monospace"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(we),{class:"h-4 w-4 mr-1"}),t[12]||(t[12]=d(" ```texto``` ",-1))]),_:1})])):C("",!0),w.value?(u(),c("div",Fe,[l("div",Se,[l("div",We,[l("div",Pe,[a(e(Z),{class:"w-4 h-4 text-green-600"}),t[13]||(t[13]=l("span",{class:"text-sm font-medium"},"Vista previa WhatsApp",-1))]),l("div",{class:"text-sm whitespace-pre-wrap",innerHTML:z.value},null,8,je)])])])):(u(),c("div",Me,[a(e(Y),{ref_key:"textareaRef",ref:y,modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=s=>m.value=s),placeholder:j.placeholder,rows:"10",class:"w-full font-mono"},null,8,["modelValue","placeholder"])]))])]),_:1})]),_:1}),a(e(P),null,{default:o(()=>[a(e(N),null,{default:o(()=>[a(e(L),{class:"text-base"},{default:o(()=>[...t[14]||(t[14]=[d("Variables Disponibles",-1)])]),_:1})]),_:1}),a(e(W),null,{default:o(()=>[l("div",Ue,[(u(!0),c(B,null,D(e(r),(s,g)=>(u(),c("div",{key:g},[l("h4",ze,p(s.label),1),l("div",Ie,[(u(!0),c(B,null,D(s.variables,i=>(u(),M(e(me),{key:i.key,variant:"outline",class:"cursor-pointer hover:bg-accent",onClick:V(b=>U(i.key),["prevent","stop"])},{default:o(()=>[a(e(fe),{class:"w-3 h-3 mr-1"}),d(" "+p(i.key),1)]),_:2},1032,["onClick"]))),128))])]))),128))])]),_:1})]),_:1}),l("div",Te,[v.value.warningAvg?(u(),M(e(G),{key:0,variant:"warning"},{default:o(()=>[a(e(ee),{class:"h-4 w-4"}),a(e(J),null,{default:o(()=>[d(" El mensaje podría exceder el límite de 4096 caracteres de WhatsApp (promedio estimado: "+p(v.value.charactersAvg)+" caracteres) ",1)]),_:1})]),_:1})):C("",!0),a(e(P),null,{default:o(()=>[a(e(W),{class:"pt-6"},{default:o(()=>[l("div",Be,[l("div",null,[t[15]||(t[15]=l("span",{class:"text-muted-foreground"},"Variables:",-1)),l("span",De,p(v.value.variables),1)]),l("div",null,[t[16]||(t[16]=l("span",{class:"text-muted-foreground"},"Mín:",-1)),l("span",Ne,p(v.value.charactersMin)+" car.",1)]),l("div",null,[t[17]||(t[17]=l("span",{class:"text-muted-foreground"},"Máx:",-1)),l("span",{class:K(["ml-2 font-medium",{"text-red-600":v.value.warningMax}])},p(v.value.charactersMax)+" car. ",3)]),l("div",null,[t[18]||(t[18]=l("span",{class:"text-muted-foreground"},"Promedio:",-1)),l("span",{class:K(["ml-2 font-medium",{"text-yellow-600":v.value.warningAvg}])},p(v.value.charactersAvg)+" car. ",3)])])]),_:1})]),_:1})])]))}}),He={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Re={class:"flex justify-between items-center"},qe={class:"text-3xl font-bold"},Ge={class:"text-muted-foreground mt-1"},Je={class:"flex gap-2"},Ke={class:"list-disc pl-4"},Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qe={key:0,class:"text-sm text-destructive mt-1"},Xe={class:"flex items-center space-x-2 mt-2"},Ye={key:0,class:"text-sm text-destructive mt-1"},Ze={class:"flex flex-wrap gap-2"},oa=Q({__name:"Form",props:{plantilla:{},variablesDisponibles:{}},setup(j){var $,U,z,v,n;const _=j,f=T(()=>{var t;return!!((t=_.plantilla)!=null&&t.id)}),F=[{title:"Admin",href:"/admin/dashboard"},{title:"Campañas",href:"/admin/campanas"},{title:"Plantillas WhatsApp",href:"/admin/campanas/plantillas-whatsapp"},{title:f.value?"Editar Plantilla":"Nueva Plantilla",href:"#"}],r=oe({nombre:(($=_.plantilla)==null?void 0:$.nombre)||"",descripcion:((U=_.plantilla)==null?void 0:U.descripcion)||"",contenido:((z=_.plantilla)==null?void 0:z.contenido)||"",usa_formato:((v=_.plantilla)==null?void 0:v.usa_formato)??!0,es_activa:((n=_.plantilla)==null?void 0:n.es_activa)??!0}),A=S([]),H=t=>{r.contenido=t},R=t=>{r.usa_formato=t},m=t=>{A.value=t},w=()=>{var t;f.value?r.put(`/admin/campanas/plantillas-whatsapp/${(t=_.plantilla)==null?void 0:t.id}`,{onSuccess:()=>{E.success("Plantilla actualizada exitosamente")},onError:()=>{E.error("Error al actualizar la plantilla")}}):r.post("/admin/campanas/plantillas-whatsapp",{onSuccess:()=>{E.success("Plantilla creada exitosamente")},onError:()=>{E.error("Error al crear la plantilla")}})},y=T(()=>r.nombre&&r.contenido&&!r.processing),k=()=>{var s;const t=prompt("Ingresa el número de WhatsApp para la prueba (con código de país):");t&&ie.post(`/admin/campanas/plantillas-whatsapp/${((s=_.plantilla)==null?void 0:s.id)||"preview"}/test`,{phone:t,...r.data()},{onSuccess:()=>{E.success(`Mensaje de prueba enviado a ${t}`)},onError:()=>{E.error("Error al enviar el mensaje de prueba")}})};return(t,s)=>{const g=re("router-link");return u(),M(pe,{breadcrumbs:F},{default:o(()=>[a(e(ne),{title:f.value?"Editar Plantilla WhatsApp":"Nueva Plantilla WhatsApp"},null,8,["title"]),l("div",He,[l("form",{onSubmit:V(w,["prevent"]),class:"space-y-6"},[l("div",Re,[l("div",null,[l("h1",qe,p(f.value?"Editar Plantilla":"Nueva Plantilla de WhatsApp"),1),l("p",Ge,p(f.value?"Modifica los detalles de la plantilla de WhatsApp":"Crea una nueva plantilla para tus campañas de WhatsApp"),1)]),l("div",Je,[a(g,{href:"/admin/campanas/plantillas-whatsapp"},{default:o(()=>[a(e(h),{type:"button",variant:"outline"},{default:o(()=>[a(e(ge),{class:"w-4 h-4 mr-2"}),s[3]||(s[3]=d(" Cancelar ",-1))]),_:1})]),_:1}),f.value?(u(),M(e(h),{key:0,type:"button",variant:"outline",onClick:k},{default:o(()=>[a(e(Z),{class:"w-4 h-4 mr-2"}),s[4]||(s[4]=d(" Enviar Prueba ",-1))]),_:1})):C("",!0),a(e(h),{type:"submit",disabled:!y.value},{default:o(()=>[a(e(xe),{class:"w-4 h-4 mr-2"}),d(" "+p(f.value?"Actualizar":"Guardar")+" Plantilla ",1)]),_:1},8,["disabled"])])]),Object.keys(e(r).errors).length>0?(u(),M(e(G),{key:0,variant:"destructive"},{default:o(()=>[a(e(he),{class:"h-4 w-4"}),a(e(J),null,{default:o(()=>[l("ul",Ke,[(u(!0),c(B,null,D(e(r).errors,(i,b)=>(u(),c("li",{key:b},p(i),1))),128))])]),_:1})]),_:1})):C("",!0),a(e(P),null,{default:o(()=>[a(e(N),null,{default:o(()=>[a(e(L),null,{default:o(()=>[...s[5]||(s[5]=[d("Información Básica",-1)])]),_:1}),a(e(O),null,{default:o(()=>[...s[6]||(s[6]=[d(" Define el nombre y descripción de la plantilla ",-1)])]),_:1})]),_:1}),a(e(W),{class:"space-y-4"},{default:o(()=>[l("div",Oe,[l("div",null,[a(e(I),{htmlFor:"nombre"},{default:o(()=>[...s[7]||(s[7]=[d(" Nombre de la Plantilla ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(de),{id:"nombre",modelValue:e(r).nombre,"onUpdate:modelValue":s[0]||(s[0]=i=>e(r).nombre=i),placeholder:"Ej: Recordatorio de evento",error:e(r).errors.nombre},null,8,["modelValue","error"]),e(r).errors.nombre?(u(),c("p",Qe,p(e(r).errors.nombre),1)):C("",!0)]),l("div",null,[a(e(I),{htmlFor:"es_activa"},{default:o(()=>[...s[8]||(s[8]=[d("Estado",-1)])]),_:1}),l("div",Xe,[a(e(ue),{id:"es_activa",modelValue:e(r).es_activa,"onUpdate:modelValue":s[1]||(s[1]=i=>e(r).es_activa=i)},null,8,["modelValue"]),a(e(I),{for:"es_activa",class:"cursor-pointer"},{default:o(()=>[d(p(e(r).es_activa?"Activa":"Inactiva"),1)]),_:1})])])]),l("div",null,[a(e(I),{htmlFor:"descripcion"},{default:o(()=>[...s[9]||(s[9]=[d("Descripción",-1)])]),_:1}),a(e(Y),{id:"descripcion",modelValue:e(r).descripcion,"onUpdate:modelValue":s[2]||(s[2]=i=>e(r).descripcion=i),placeholder:"Describe el propósito de esta plantilla...",rows:"3"},null,8,["modelValue"])])]),_:1})]),_:1}),a(e(P),null,{default:o(()=>[a(e(N),null,{default:o(()=>[a(e(L),null,{default:o(()=>[...s[10]||(s[10]=[d("Contenido del Mensaje",-1)])]),_:1}),a(e(O),null,{default:o(()=>[...s[11]||(s[11]=[d(" Define el contenido del mensaje de WhatsApp ",-1)])]),_:1})]),_:1}),a(e(W),null,{default:o(()=>[a(Le,{modelValue:e(r).contenido,usaFormato:e(r).usa_formato,"onUpdate:modelValue":H,"onUpdate:usaFormato":R,"onUpdate:variables":m},null,8,["modelValue","usaFormato"]),e(r).errors.contenido?(u(),c("p",Ye,p(e(r).errors.contenido),1)):C("",!0)]),_:1})]),_:1}),A.value.length>0?(u(),M(e(G),{key:1},{default:o(()=>[a(e(ee),{class:"h-4 w-4"}),a(e(J),null,{default:o(()=>[s[12]||(s[12]=l("p",{class:"font-medium mb-2"},"Variables utilizadas:",-1)),l("div",Ze,[(u(!0),c(B,null,D(A.value,i=>(u(),c("code",{key:i,class:"px-2 py-1 bg-muted rounded text-sm"},p(i),1))),128))])]),_:1})]),_:1})):C("",!0)],32)])]),_:1})}}});export{oa as default};
