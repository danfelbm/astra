import{_ as te,a as ie,b as oe,c as de}from"./CardTitle.vue_vue_type_script_setup_true_lang-BQw5IOx1.js";import{_ as D}from"./Label.vue_vue_type_script_setup_true_lang-Q5gYLrMD.js";import{_ as T,a as E,b as A,c as P,d as F}from"./SelectValue.vue_vue_type_script_setup_true_lang-DG76JhhK.js";import{d as se,r as S,c as _,M as re,p as ue,o as ne,b as g,x as Y,f as i,n as ce,w as d,j as h,e as r,g as Z,h as p,t as m,i as v,F as G,k as z,U as b,m as n}from"./app-D6dAgRLX.js";const me={class:"text-sm text-muted-foreground"},fe={class:"w-full"},ve={key:0,class:"text-xs text-muted-foreground mt-1"},pe={key:0,class:"w-full"},_e={key:0,class:"text-xs text-muted-foreground mt-1"},he={key:1,class:"w-full"},ge={key:0,class:"text-xs text-muted-foreground mt-1"},we={key:2,class:"w-full"},be={key:0,class:"text-xs text-muted-foreground mt-1"},Le=se({__name:"GeographicSelector",props:{modelValue:{default:()=>({territorios_ids:[],departamentos_ids:[],municipios_ids:[],localidades_ids:[]})},disabled:{type:Boolean,default:!1},title:{default:"Ubicación Geográfica"},description:{default:"Selecciona la ubicación"},mode:{default:"multiple"},showCard:{type:Boolean,default:!0},departamentoLabel:{default:"Departamento"},municipioLabel:{default:"Municipio"},showLocalidad:{type:Boolean,default:!0},showDepartamento:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(s,{emit:I}){const c=s,ee=I,J=S([]),k=S([]),C=S([]),B=S([]),f=S(!1),o=_(()=>c.mode==="multiple"),y=_(()=>{var e,a;if(o.value)return((e=c.modelValue)==null?void 0:e.territorios_ids)||[];{const l=(a=c.modelValue)==null?void 0:a.territorio_id;return l?[l]:[]}}),w=_(()=>{var e,a;if(o.value)return((e=c.modelValue)==null?void 0:e.departamentos_ids)||[];{const l=(a=c.modelValue)==null?void 0:a.departamento_id;return l?[l]:[]}}),V=_(()=>{var e,a;if(o.value)return((e=c.modelValue)==null?void 0:e.municipios_ids)||[];{const l=(a=c.modelValue)==null?void 0:a.municipio_id;return l?[l]:[]}}),W=_(()=>{var e,a;if(o.value)return((e=c.modelValue)==null?void 0:e.localidades_ids)||[];{const l=(a=c.modelValue)==null?void 0:a.localidad_id;return l?[l]:[]}}),K=re();_(()=>{var e;return((e=K.props.auth)==null?void 0:e.isAdmin)||!1});const ae=_(()=>{var e;return!!((e=K.props.auth)!=null&&e.user)}),j=_(()=>ae.value?window.location.pathname.startsWith("/admin")?"/admin/geographic":"/api/geographic":"/api/public/geographic");ue(w,e=>{e.length>0&&M(e)},{immediate:!1});const le=async()=>{try{f.value=!0;const e=await fetch(`${j.value}/territorios`);J.value=await e.json()}catch(e){console.error("Error loading territorios:",e)}finally{f.value=!1}},q=async e=>{if(!e.length){k.value=[];return}try{f.value=!0;const a=await fetch(`${j.value}/departamentos?territorio_ids=${e.join(",")}`);k.value=await a.json()}catch(a){console.error("Error loading departamentos:",a)}finally{f.value=!1}},M=async e=>{if(!e.length){C.value=[];return}try{f.value=!0;const a=await fetch(`${j.value}/municipios?departamento_ids=${e.join(",")}`);C.value=await a.json()}catch(a){console.error("Error loading municipios:",a)}finally{f.value=!1}},H=async e=>{if(!e.length){B.value=[];return}try{f.value=!0;const a=await fetch(`${j.value}/localidades?municipio_ids=${e.join(",")}`);B.value=await a.json()}catch(a){console.error("Error loading localidades:",a)}finally{f.value=!1}},N=(e,a)=>{var $,x,L,t,O,Q,R,X;let l;if(o.value){const u=Array.isArray(e)?e.map(Number).filter(Boolean):e?[Number(e)].filter(Boolean):[];l={territorios_ids:(($=c.modelValue)==null?void 0:$.territorios_ids)||[],departamentos_ids:((x=c.modelValue)==null?void 0:x.departamentos_ids)||[],municipios_ids:((L=c.modelValue)==null?void 0:L.municipios_ids)||[],localidades_ids:((t=c.modelValue)==null?void 0:t.localidades_ids)||[]},a==="territorio"?(l.territorios_ids=u,l.departamentos_ids=[],l.municipios_ids=[],l.localidades_ids=[],b(()=>q(u))):a==="departamento"?(l.departamentos_ids=u,l.municipios_ids=[],l.localidades_ids=[],b(()=>M(u))):a==="municipio"?(l.municipios_ids=u,l.localidades_ids=[],b(()=>H(u))):a==="localidad"&&(l.localidades_ids=u)}else{const u=e?Number(e):void 0;l={territorio_id:(O=c.modelValue)==null?void 0:O.territorio_id,departamento_id:(Q=c.modelValue)==null?void 0:Q.departamento_id,municipio_id:(R=c.modelValue)==null?void 0:R.municipio_id,localidad_id:(X=c.modelValue)==null?void 0:X.localidad_id},a==="territorio"?(l.territorio_id=u,l.departamento_id=void 0,l.municipio_id=void 0,l.localidad_id=void 0,b(()=>q(u?[u]:[]))):a==="departamento"?(l.departamento_id=u,l.municipio_id=void 0,l.localidad_id=void 0,b(()=>M(u?[u]:[]))):a==="municipio"?(l.municipio_id=u,l.localidad_id=void 0,b(()=>H(u?[u]:[]))):a==="localidad"&&(l.localidad_id=u)}ee("update:modelValue",l)};ne(async()=>{await le(),y.value.length&&await q(y.value),w.value.length&&await M(w.value),V.value.length&&await H(V.value)});const U=(e,a,l)=>o.value?`${e} ${e===1?a:l} seleccionado${e===1?"":"s"}`:"";return(e,a)=>(n(),g(Y(s.showCard?i(te):"div"),{class:ce(s.showCard?"border-dashed":"")},{default:d(()=>[s.showCard?(n(),g(i(ie),{key:0},{default:d(()=>[r(i(oe),{class:"text-base"},{default:d(()=>[p(m(s.title),1)]),_:1}),Z("p",me,m(s.description),1)]),_:1})):h("",!0),(n(),g(Y(s.showCard?i(de):"div"),{class:"space-y-4"},{default:d(()=>{var l,$,x,L;return[Z("div",fe,[r(i(D),null,{default:d(()=>[p("Territorio"+m(o.value?"s":""),1)]),_:1}),r(i(T),{"model-value":o.value?y.value.map(t=>t.toString()):((l=y.value[0])==null?void 0:l.toString())||"","onUpdate:modelValue":a[0]||(a[0]=t=>N(t,"territorio")),multiple:o.value,disabled:s.disabled||f.value},{default:d(()=>[r(i(E),{class:"w-full"},{default:d(()=>[r(i(A),{placeholder:`Seleccionar territorio${o.value?"s":""}...`},null,8,["placeholder"])]),_:1}),r(i(P),null,{default:d(()=>[(n(!0),v(G,null,z(J.value,t=>(n(),g(i(F),{key:t.id,value:t.id.toString()},{default:d(()=>[p(m(t.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(n(),v("p",ve,m(U(y.value.length,"territorio","territorios")),1)):h("",!0)]),s.showDepartamento&&k.value.length>0?(n(),v("div",pe,[r(i(D),null,{default:d(()=>[p(m(s.departamentoLabel)+m(o.value?"s":""),1)]),_:1}),r(i(T),{"model-value":o.value?w.value.map(t=>t.toString()):(($=w.value[0])==null?void 0:$.toString())||"","onUpdate:modelValue":a[1]||(a[1]=t=>N(t,"departamento")),multiple:o.value,disabled:s.disabled||f.value},{default:d(()=>[r(i(E),{class:"w-full"},{default:d(()=>[r(i(A),{placeholder:`Seleccionar ${s.departamentoLabel.toLowerCase()}${o.value?"s":""}...`},null,8,["placeholder"])]),_:1}),r(i(P),null,{default:d(()=>[(n(!0),v(G,null,z(k.value,t=>(n(),g(i(F),{key:t.id,value:t.id.toString()},{default:d(()=>[p(m(t.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(n(),v("p",_e,m(U(w.value.length,s.departamentoLabel.toLowerCase(),s.departamentoLabel.toLowerCase()+"s")),1)):h("",!0)])):h("",!0),C.value.length>0?(n(),v("div",he,[r(i(D),null,{default:d(()=>[p(m(s.municipioLabel)+m(o.value?"s":""),1)]),_:1}),r(i(T),{"model-value":o.value?V.value.map(t=>t.toString()):((x=V.value[0])==null?void 0:x.toString())||"","onUpdate:modelValue":a[2]||(a[2]=t=>N(t,"municipio")),multiple:o.value,disabled:s.disabled||f.value},{default:d(()=>[r(i(E),{class:"w-full"},{default:d(()=>[r(i(A),{placeholder:`Seleccionar ${s.municipioLabel.toLowerCase()}${o.value?"s":""}...`},null,8,["placeholder"])]),_:1}),r(i(P),null,{default:d(()=>[(n(!0),v(G,null,z(C.value,t=>(n(),g(i(F),{key:t.id,value:t.id.toString()},{default:d(()=>[p(m(t.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(n(),v("p",ge,m(U(V.value.length,s.municipioLabel.toLowerCase(),s.municipioLabel.toLowerCase()+"s")),1)):h("",!0)])):h("",!0),s.showLocalidad&&B.value.length>0?(n(),v("div",we,[r(i(D),null,{default:d(()=>[p("Localidad"+m(o.value?"es":""),1)]),_:1}),r(i(T),{"model-value":o.value?W.value.map(t=>t.toString()):((L=W.value[0])==null?void 0:L.toString())||"","onUpdate:modelValue":a[3]||(a[3]=t=>N(t,"localidad")),multiple:o.value,disabled:s.disabled||f.value},{default:d(()=>[r(i(E),{class:"w-full"},{default:d(()=>[r(i(A),{placeholder:`Seleccionar localidad${o.value?"es":""}...`},null,8,["placeholder"])]),_:1}),r(i(P),null,{default:d(()=>[(n(!0),v(G,null,z(B.value,t=>(n(),g(i(F),{key:t.id,value:t.id.toString()},{default:d(()=>[p(m(t.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","multiple","disabled"]),o.value?(n(),v("p",be,m(U(W.value.length,"localidad","localidades")),1)):h("",!0)])):h("",!0)]}),_:1}))]),_:1},8,["class"]))}});export{Le as _};
