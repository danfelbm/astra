import{d as H,a as l,o as r,n as w,u as s,k as g,c as D,s as U,F as y,b as o,e as i,g as m,r as b,f as e,t as n,i as _,j,h as q,l as L}from"./app-CRtAryep.js";import{a as M,r as O,t as X,e as I,d as J,s as T}from"./AppLayout.vue_vue_type_script_setup_true_lang-C1azZtFX.js";import{a as W,_ as h}from"./AppLogo.vue_vue_type_script_setup_true_lang-CMxkBa9N.js";import{_ as G,a as K}from"./CardContent.vue_vue_type_script_setup_true_lang-D1WxX5UR.js";import{_ as P,a as Q}from"./CardTitle.vue_vue_type_script_setup_true_lang-Bb-ZiE1h.js";import{_ as Y,a as Z,b as aa,c as ea}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BY8AArZV.js";import{C as V}from"./clock-CoofMxuf.js";import{U as ta}from"./user-B3M_5sA5.js";import{E as B}from"./eye-FMG4EKUK.js";const N=H({__name:"Skeleton",props:{class:{}},setup(C){const p=C;return(x,v)=>(r(),l("div",{class:w(s(W)("animate-pulse rounded-md bg-muted",p.class))},null,2))}}),sa={key:0,class:"space-y-3"},oa={class:"space-y-2 flex-1"},ra={key:1,class:"text-center py-8"},la={class:"text-red-600 mb-4"},ia={key:2,class:"text-center py-8"},na={key:3,class:"space-y-4"},da={class:"flex items-center gap-3"},ua={class:"flex-shrink-0"},ca={class:"flex-1 min-w-0"},ma={class:"font-medium text-gray-900 dark:text-gray-100 truncate"},_a={class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mt-1"},fa={class:"flex items-center gap-2"},ga={class:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700"},pa={key:0,class:"mb-3"},va={class:"text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-2 rounded"},ya={key:1,class:"mb-3"},xa={class:"text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-950/20 p-2 rounded border border-blue-200 dark:border-blue-800"},ka={class:"flex gap-2"},ba={key:0,class:"flex justify-center mt-6"},ha={class:"flex gap-2"},wa={key:0,class:"space-y-6"},Ca={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},$a={class:"grid grid-cols-2 gap-4 text-sm"},Ea={class:"text-gray-600 dark:text-gray-400"},ja={class:"text-gray-600 dark:text-gray-400"},Ma={key:0},Na={class:"text-gray-600 dark:text-gray-400"},Aa={key:1},Da={class:"text-gray-600 dark:text-gray-400"},Va={class:"space-y-4"},Ba={class:"font-medium text-gray-700 dark:text-gray-300 mb-2"},Ha={class:"bg-gray-50 dark:bg-gray-800 p-3 rounded text-sm"},Sa={class:"whitespace-pre-wrap text-gray-800 dark:text-gray-200"},za={key:0,class:"text-center py-4"},Ta=H({__name:"HistorialCandidatura",props:{candidaturaId:{},versionActual:{},isAdmin:{type:Boolean,default:!1}},setup(C){const p=C,x=g(!0),v=g(null),c=g(null),k=g(new Set),d=g(null),$=g(!1),S=D(()=>c.value&&c.value.data.length>0),z=D(()=>c.value?c.value.data:[]),E=async(u=1)=>{try{x.value=!0,v.value=null;const a=p.isAdmin?`/admin/candidaturas/${p.candidaturaId}/historial?page=${u}`:`/candidaturas/${p.candidaturaId}/historial?page=${u}`,t=await fetch(a,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Error al cargar el historial");c.value=await t.json()}catch(a){v.value=a instanceof Error?a.message:"Error desconocido",console.error("Error cargando historial:",a)}finally{x.value=!1}},F=u=>{k.value.has(u)?k.value.delete(u):k.value.add(u)},A=u=>{d.value=u,$.value=!0},R=(u,a)=>a==null?"No especificado":Array.isArray(a)?a.join(", "):typeof a=="object"?JSON.stringify(a,null,2):String(a);return U(()=>{E()}),(u,a)=>(r(),l(y,null,[o(s(G),null,{default:i(()=>[o(s(P),null,{default:i(()=>[o(s(Q),{class:"flex items-center gap-2"},{default:i(()=>[o(s(V),{class:"h-5 w-5"}),a[2]||(a[2]=m(" Historial de Cambios "))]),_:1})]),_:1}),o(s(K),null,{default:i(()=>[x.value?(r(),l("div",sa,[(r(),l(y,null,b(3,t=>e("div",{key:t,class:"flex items-center space-x-3"},[o(s(N),{class:"h-10 w-10 rounded-full"}),e("div",oa,[o(s(N),{class:"h-4 w-3/4"}),o(s(N),{class:"h-3 w-1/2"})])])),64))])):v.value?(r(),l("div",ra,[e("p",la,n(v.value),1),o(s(h),{onClick:a[0]||(a[0]=t=>E()),variant:"outline"},{default:i(()=>a[3]||(a[3]=[m(" Reintentar ")])),_:1})])):S.value?(r(),l("div",na,[(r(!0),l(y,null,b(z.value,t=>(r(),l("div",{key:t.id,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors"},[o(s(O),null,{default:i(()=>[o(s(X),{class:"flex items-center justify-between w-full text-left",onClick:f=>F(t.id)},{default:i(()=>[e("div",da,[e("div",ua,[o(s(M),{class:w(t.estado_color)},{default:i(()=>[m(" v"+n(t.version),1)]),_:2},1032,["class"])]),e("div",ca,[e("p",ma,n(t.resumen_cambios),1),e("div",_a,[o(s(ta),{class:"h-3 w-3"}),e("span",null,n(t.created_by),1),a[6]||(a[6]=e("span",null,"•",-1)),e("span",null,n(t.fecha_formateada),1),a[7]||(a[7]=e("span",null,"•",-1)),o(s(M),{variant:"outline",class:w(t.estado_color)},{default:i(()=>[m(n(t.estado_label),1)]),_:2},1032,["class"])])])]),e("div",fa,[o(s(h),{onClick:q(f=>A(t),["stop"]),variant:"ghost",size:"sm"},{default:i(()=>[o(s(B),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),(r(),j(L(k.value.has(t.id)?s(I):s(J)),{class:"h-4 w-4 text-gray-400 dark:text-gray-600"}))])]),_:2},1032,["onClick"]),o(s(T),null,{default:i(()=>[e("div",ga,[t.motivo_cambio?(r(),l("div",pa,[a[8]||(a[8]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Motivo del cambio:",-1)),e("p",va,n(t.motivo_cambio),1)])):_("",!0),t.comentarios_admin_en_momento?(r(),l("div",ya,[a[9]||(a[9]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Comentarios de la comisión:",-1)),e("p",xa,n(t.comentarios_admin_en_momento),1)])):_("",!0),e("div",ka,[o(s(h),{onClick:f=>A(t),variant:"outline",size:"sm"},{default:i(()=>[o(s(B),{class:"h-4 w-4 mr-2"}),a[10]||(a[10]=m(" Ver formulario completo "))]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024)]))),128)),c.value&&c.value.last_page>1?(r(),l("div",ba,[e("div",ha,[(r(!0),l(y,null,b(c.value.last_page,t=>(r(),j(s(h),{key:t,onClick:f=>E(t),variant:t===c.value.current_page?"default":"outline",size:"sm"},{default:i(()=>[m(n(t),1)]),_:2},1032,["onClick","variant"]))),128))])])):_("",!0)])):(r(),l("div",ia,[o(s(V),{class:"h-12 w-12 mx-auto text-gray-400 dark:text-gray-600 mb-4"}),a[4]||(a[4]=e("p",{class:"text-gray-600 dark:text-gray-400 mb-2"},"No hay historial disponible",-1)),a[5]||(a[5]=e("p",{class:"text-sm text-gray-500 dark:text-gray-500"}," El historial se creará automáticamente cuando realices cambios a tu candidatura. ",-1))]))]),_:1})]),_:1}),o(s(Y),{open:$.value,"onUpdate:open":a[1]||(a[1]=t=>$.value=t)},{default:i(()=>[o(s(Z),{class:"max-w-4xl max-h-[80vh] overflow-y-auto"},{default:i(()=>[o(s(aa),null,{default:i(()=>[d.value?(r(),j(s(ea),{key:0},{default:i(()=>[m(" Formulario - Versión "+n(d.value.version)+" ",1),o(s(M),{class:w([d.value.estado_color,"ml-2"])},{default:i(()=>[m(n(d.value.estado_label),1)]),_:1},8,["class"])]),_:1})):_("",!0)]),_:1}),d.value?(r(),l("div",wa,[e("div",Ca,[e("div",$a,[e("div",null,[a[11]||(a[11]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Fecha del cambio:",-1)),e("p",Ea,n(d.value.fecha_formateada),1)]),e("div",null,[a[12]||(a[12]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Modificado por:",-1)),e("p",ja,n(d.value.created_by),1)]),d.value.motivo_cambio?(r(),l("div",Ma,[a[13]||(a[13]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Motivo:",-1)),e("p",Na,n(d.value.motivo_cambio),1)])):_("",!0),d.value.comentarios_admin_en_momento?(r(),l("div",Aa,[a[14]||(a[14]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Comentarios de la comisión:",-1)),e("p",Da,n(d.value.comentarios_admin_en_momento),1)])):_("",!0)])]),e("div",null,[a[16]||(a[16]=e("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-4"},"Datos del formulario en esta versión:",-1)),e("div",Va,[(r(!0),l(y,null,b(d.value.formulario_data_con_nombres,(t,f)=>(r(),l("div",{key:f,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-3"},[e("p",Ba,n(f),1),e("div",Ha,[e("pre",Sa,n(R(f,t)),1)])]))),128)),Object.keys(d.value.formulario_data_con_nombres||{}).length===0?(r(),l("div",za,a[15]||(a[15]=[e("p",{class:"text-gray-500 dark:text-gray-500"},"No hay datos de formulario disponibles para esta versión.",-1)]))):_("",!0)])])])):_("",!0)]),_:1})]),_:1},8,["open"])],64))}});export{Ta as _};
