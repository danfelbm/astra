import{d as q,C as z,k as G,j as w,o as g,e as l,b as s,f as a,u as e,m as B,g as n,P as F,t as d,h as P,a as _,F as D,r as U,W}from"./app-3PnVxn_i.js";import{s as I,T as O,S as Q,U as H,_ as v,a as y,b,c as $,d as J,e as K,f as X,g as Y,h as Z,j as ee,i as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-DTPQizsx.js";import{_ as f}from"./AppLogo.vue_vue_type_script_setup_true_lang-2ZK4DXgR.js";import{_ as x}from"./CardDescription.vue_vue_type_script_setup_true_lang-BwNCxnkX.js";import{_ as p,a as h}from"./Label.vue_vue_type_script_setup_true_lang-Cmad3Opx.js";import{_ as se}from"./Textarea.vue_vue_type_script_setup_true_lang-vdEnmjWc.js";import{_ as le}from"./Switch.vue_vue_type_script_setup_true_lang-D5oDEBwV.js";import{_ as ae}from"./Checkbox.vue_vue_type_script_setup_true_lang-9o-imbru.js";import{_ as ne,a as oe,b as S,c as V}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BRBmSVHN.js";import{_ as ie,a as re}from"./index-ShcnTxb-.js";import{F as de,_ as ue}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-CbH8algI.js";import{_ as c}from"./InputError.vue_vue_type_script_setup_true_lang-CCRsSLZe.js";import{A as me}from"./arrow-left-CvIrulFP.js";import{S as fe}from"./save-B8n4gfF1.js";import"./index-B4f8LOCP.js";import"./VisuallyHidden-D5uEwMT5.js";import"./VisuallyHiddenInput-DwsSScso.js";import"./RovingFocusItem-BO8its_f.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-DnwNMeEE.js";import"./es-DfN3vIXC.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-D_R3Y-Fl.js";import"./loader-circle-BTvKQjHT.js";import"./trash-2-jYCnVLY_.js";import"./plus-Lqf2uCpv.js";import"./search-DlY197sG.js";import"./history-k1fN646f.js";const pe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ge={class:"flex items-center justify-between"},ce={class:"flex gap-2"},_e={class:"space-y-2"},ve={class:"space-y-2"},ye={class:"space-y-2"},be={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},$e={class:"flex items-center justify-between"},xe={class:"space-y-0.5"},Se={class:"flex items-center space-x-2"},Ve={class:"space-y-2"},ke={class:"grid grid-cols-2 gap-2"},Ce={class:"flex items-center px-3 py-2 bg-muted rounded-md"},we={class:"text-sm text-muted-foreground"},Fe={class:"grid grid-cols-2 gap-2 mt-2"},De={key:0,class:"space-y-3"},Ue={class:"flex-1"},he={class:"text-xs text-muted-foreground mt-1"},Ee={key:1,class:"text-center py-8 text-muted-foreground"},Le={class:"flex justify-end gap-4"},nt=q({__name:"Edit",props:{segment:{},roles:{},filterFieldsConfig:{},modelTypes:{},selectedRoles:{}},setup(E){const u=E,L=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:"Editar Segmento",href:"#"}],i=z({name:u.segment.name,description:u.segment.description||"",model_type:u.segment.model_type,filters:u.segment.filters||{},is_dynamic:u.segment.is_dynamic,cache_duration:u.segment.cache_duration,role_ids:u.selectedRoles||[]}),N=G(null),R=o=>{const t=i.role_ids.indexOf(o);t>-1?i.role_ids.splice(t,1):i.role_ids.push(o)},j=o=>{i.filters=o},A=()=>{i.put(`/admin/segments/${u.segment.id}`,{preserveScroll:!0,onSuccess:()=>{}})},M=()=>{confirm(`¿Estás seguro de eliminar el segmento "${u.segment.name}"? Esta acción no se puede deshacer.`)&&W.delete(`/admin/segments/${u.segment.id}`)},T=o=>o<60?`${o} segundos`:o<3600?`${Math.floor(o/60)} minutos`:`${Math.floor(o/3600)} horas`,k=o=>o!=null&&o.last_calculated_at?new Date(o.last_calculated_at).toLocaleString():"Nunca";return(o,t)=>(g(),w(te,{breadcrumbs:L},{default:l(()=>[s(e(B),{title:"Editar Segmento"}),a("div",pe,[a("div",ge,[t[11]||(t[11]=a("div",null,[a("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Segmento"),a("p",{class:"text-muted-foreground"}," Modifica los filtros y configuración del segmento ")],-1)),a("div",ce,[s(e(f),{onClick:M,variant:"destructive",type:"button"},{default:l(()=>t[9]||(t[9]=[n(" Eliminar Segmento ")])),_:1}),s(e(F),{href:o.route("admin.segments.index")},{default:l(()=>[s(e(f),{variant:"outline"},{default:l(()=>[s(e(me),{class:"mr-2 h-4 w-4"}),t[10]||(t[10]=n(" Volver "))]),_:1})]),_:1},8,["href"])])]),s(e(ie),null,{default:l(()=>[s(e(I),{class:"h-4 w-4"}),s(e(re),null,{default:l(()=>{var r;return[n(" Este segmento tiene "+d(((r=o.segment.metadata)==null?void 0:r.contacts_count)||0)+" usuarios. Última evaluación: "+d(k(o.segment.metadata)),1)]}),_:1})]),_:1}),a("form",{onSubmit:P(A,["prevent"]),class:"space-y-6"},[s(e(ne),{defaultValue:"general",class:"space-y-4"},{default:l(()=>[s(e(oe),{class:"grid w-full grid-cols-4"},{default:l(()=>[s(e(S),{value:"general"},{default:l(()=>[s(e(O),{class:"mr-2 h-4 w-4"}),t[12]||(t[12]=n(" General "))]),_:1}),s(e(S),{value:"filters"},{default:l(()=>[s(e(de),{class:"mr-2 h-4 w-4"}),t[13]||(t[13]=n(" Filtros "))]),_:1}),s(e(S),{value:"settings"},{default:l(()=>[s(e(Q),{class:"mr-2 h-4 w-4"}),t[14]||(t[14]=n(" Configuración "))]),_:1}),s(e(S),{value:"roles"},{default:l(()=>[s(e(H),{class:"mr-2 h-4 w-4"}),t[15]||(t[15]=n(" Roles "))]),_:1})]),_:1}),s(e(V),{value:"general"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>t[16]||(t[16]=[n("Información General")])),_:1}),s(e(x),null,{default:l(()=>t[17]||(t[17]=[n(" Define el nombre y descripción del segmento ")])),_:1})]),_:1}),s(e($),{class:"space-y-4"},{default:l(()=>{var r;return[a("div",_e,[s(e(p),{htmlFor:"name"},{default:l(()=>t[18]||(t[18]=[n("Nombre del Segmento")])),_:1}),s(e(h),{id:"name",modelValue:e(i).name,"onUpdate:modelValue":t[0]||(t[0]=m=>e(i).name=m),placeholder:"Usuarios por Región Norte"},null,8,["modelValue"]),s(c,{message:e(i).errors.name},null,8,["message"])]),a("div",ve,[s(e(p),{htmlFor:"description"},{default:l(()=>t[19]||(t[19]=[n("Descripción")])),_:1}),s(e(se),{id:"description",modelValue:e(i).description,"onUpdate:modelValue":t[1]||(t[1]=m=>e(i).description=m),placeholder:"Describe el propósito y criterios de este segmento...",rows:"4"},null,8,["modelValue"]),s(c,{message:e(i).errors.description},null,8,["message"])]),a("div",ye,[s(e(p),{htmlFor:"model_type"},{default:l(()=>t[20]||(t[20]=[n("Tipo de Modelo")])),_:1}),s(e(J),{modelValue:e(i).model_type,"onUpdate:modelValue":t[2]||(t[2]=m=>e(i).model_type=m)},{default:l(()=>[s(e(K),null,{default:l(()=>[s(e(X),{placeholder:"Selecciona el tipo de modelo"})]),_:1}),s(e(Y),null,{default:l(()=>[(g(!0),_(D,null,U(o.modelTypes,(m,C)=>(g(),w(e(Z),{key:C,value:C},{default:l(()=>[n(d(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),t[21]||(t[21]=a("p",{class:"text-xs text-muted-foreground"}," Selecciona el modelo de datos sobre el que aplicar el segmento ",-1)),s(c,{message:e(i).errors.model_type},null,8,["message"])]),a("div",be,[a("p",null,"ID del Segmento: "+d(o.segment.id),1),a("p",null,"Usuarios actuales: "+d(((r=o.segment.metadata)==null?void 0:r.contacts_count)||0),1),a("p",null,"Creado: "+d(new Date(o.segment.created_at).toLocaleDateString()),1),a("p",null,"Última actualización: "+d(new Date(o.segment.updated_at).toLocaleDateString()),1),a("p",null,"Última evaluación: "+d(k(o.segment.metadata)),1)])]}),_:1})]),_:1})]),_:1}),s(e(V),{value:"filters"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>t[22]||(t[22]=[n("Criterios de Filtrado")])),_:1}),s(e(x),null,{default:l(()=>t[23]||(t[23]=[n(" Modifica los filtros que determinan qué usuarios pertenecen a este segmento ")])),_:1})]),_:1}),s(e($),null,{default:l(()=>{var r;return[s(ue,{ref_key:"advancedFiltersRef",ref:N,config:{fields:o.filterFieldsConfig,showQuickSearch:!1},route:"",initialFilters:(r=o.segment.filters)!=null&&r.advanced_filters?{rootGroup:o.segment.filters.advanced_filters}:void 0,onApply:j},null,8,["config","initialFilters"]),s(c,{message:e(i).errors.filters},null,8,["message"]),t[24]||(t[24]=a("div",{class:"mt-4 p-4 bg-muted/50 rounded-lg"},[a("p",{class:"text-sm text-muted-foreground"},[a("strong",null,"Nota:"),n(" Los cambios en los filtros actualizarán automáticamente el segmento y recalcularán los usuarios que pertenecen a él. ")])],-1))]}),_:1})]),_:1})]),_:1}),s(e(V),{value:"settings"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>t[25]||(t[25]=[n("Configuración del Segmento")])),_:1}),s(e(x),null,{default:l(()=>t[26]||(t[26]=[n(" Ajusta el comportamiento y cache del segmento ")])),_:1})]),_:1}),s(e($),{class:"space-y-6"},{default:l(()=>[a("div",$e,[a("div",xe,[s(e(p),null,{default:l(()=>t[27]||(t[27]=[n("Tipo de Segmento")])),_:1}),t[28]||(t[28]=a("p",{class:"text-sm text-muted-foreground"}," Los segmentos dinámicos se recalculan en tiempo real ",-1))]),a("div",Se,[s(e(p),{htmlFor:"is_dynamic",class:"text-sm"},{default:l(()=>t[29]||(t[29]=[n("Dinámico")])),_:1}),s(e(le),{id:"is_dynamic",modelValue:e(i).is_dynamic,"onUpdate:modelValue":t[3]||(t[3]=r=>e(i).is_dynamic=r)},null,8,["modelValue"])])]),a("div",Ve,[s(e(p),{htmlFor:"cache_duration"},{default:l(()=>t[30]||(t[30]=[n("Duración del Cache (segundos)")])),_:1}),a("div",ke,[s(e(h),{id:"cache_duration",modelValue:e(i).cache_duration,"onUpdate:modelValue":t[4]||(t[4]=r=>e(i).cache_duration=r),modelModifiers:{number:!0},type:"number",min:"0",max:"86400"},null,8,["modelValue"]),a("div",Ce,[a("span",we,d(T(e(i).cache_duration)),1)])]),t[31]||(t[31]=a("p",{class:"text-xs text-muted-foreground"}," Tiempo que se mantendrán en cache los resultados del segmento (0 = sin cache) ",-1)),s(c,{message:e(i).errors.cache_duration},null,8,["message"])]),a("div",null,[s(e(p),{class:"text-sm font-medium"},{default:l(()=>t[32]||(t[32]=[n("Valores Predefinidos")])),_:1}),a("div",Fe,[s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[5]||(t[5]=r=>e(i).cache_duration=60)},{default:l(()=>t[33]||(t[33]=[n(" 1 minuto ")])),_:1}),s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[6]||(t[6]=r=>e(i).cache_duration=300)},{default:l(()=>t[34]||(t[34]=[n(" 5 minutos ")])),_:1}),s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[7]||(t[7]=r=>e(i).cache_duration=1800)},{default:l(()=>t[35]||(t[35]=[n(" 30 minutos ")])),_:1}),s(e(f),{type:"button",variant:"outline",size:"sm",onClick:t[8]||(t[8]=r=>e(i).cache_duration=3600)},{default:l(()=>t[36]||(t[36]=[n(" 1 hora ")])),_:1})])])]),_:1})]),_:1})]),_:1}),s(e(V),{value:"roles"},{default:l(()=>[s(e(v),null,{default:l(()=>[s(e(y),null,{default:l(()=>[s(e(b),null,{default:l(()=>t[37]||(t[37]=[n("Roles Asociados")])),_:1}),s(e(x),null,{default:l(()=>t[38]||(t[38]=[n(" Vincula este segmento con roles específicos para delimitar el alcance de datos ")])),_:1})]),_:1}),s(e($),null,{default:l(()=>[o.roles.length>0?(g(),_("div",De,[(g(!0),_(D,null,U(o.roles,r=>(g(),_("div",{key:r.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[s(e(ae),{checked:e(i).role_ids.includes(r.id),"onUpdate:checked":m=>R(r.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),a("div",Ue,[s(e(p),{class:"text-sm font-medium cursor-pointer"},{default:l(()=>[n(d(r.display_name),1)]),_:2},1024),a("p",he,d(r.description||"Sin descripción"),1),s(e(ee),{variant:"outline",class:"mt-2"},{default:l(()=>[n(d(r.name),1)]),_:2},1024)])]))),128))])):(g(),_("div",Ee," No hay roles disponibles ")),s(c,{message:e(i).errors.role_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),a("div",Le,[s(e(F),{href:o.route("admin.segments.index")},{default:l(()=>[s(e(f),{type:"button",variant:"outline"},{default:l(()=>t[39]||(t[39]=[n(" Cancelar ")])),_:1})]),_:1},8,["href"]),s(e(f),{type:"submit",disabled:e(i).processing},{default:l(()=>[s(e(fe),{class:"mr-2 h-4 w-4"}),n(" "+d(e(i).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{nt as default};
