import{_ as L}from"./index-BVK128az.js";import{c as Ae,_ as z}from"./createLucideIcon-Bpd7Lz21.js";import{a as G,b as B,c as H,_ as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-ByNoy_Y2.js";import{_ as je,a as Me,b as te,c as se}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-EaRkZiOc.js";import{_ as Xe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BYS78uXz.js";import{_ as de}from"./Progress.vue_vue_type_script_setup_true_lang-CqOhE0r-.js";import{E as ue}from"./eye-BrpzLeBr.js";import{C as _e}from"./circle-alert-Buh9_Ypt.js";import{C as Ke}from"./chart-column-DiLIlY9d.js";import{M as le}from"./mail-OzI6XGZn.js";import{M as oe}from"./message-square-CEjBnq_U.js";import{U as ae}from"./users-E7aQQxwT.js";import{C as Be}from"./circle-check-xYD4v91O.js";import{C as ye}from"./circle-x-D4Nlv0Z9.js";import{T as ke}from"./trending-up-DWMM69_i.js";import{M as Ie}from"./minus-ho3PmuN2.js";import{d as xe,c as Q,i as p,g as t,j as x,b as g,e as a,w as s,f as e,h as d,n as K,t as l,x as fe,F as U,m as o,r as S,o as De,k as ee,A as Je,B as Qe,q as Ye,v as Le,s as ce}from"./app-CSUPqSMz.js";import{C as pe}from"./clock-Bx7kf3Hn.js";import{_ as He,a as Oe,b as ve,c as J,d as qe,e as X}from"./TableHeader.vue_vue_type_script_setup_true_lang-C7szzAUe.js";import{_ as be,a as Ee}from"./index-18rteUfq.js";import{_ as Ze,a as et,b as tt,c as at,e as st}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BjDwmADO.js";import{R as he}from"./refresh-cw-DdsUZTwT.js";import{C as lt}from"./circle-check-big-C1QHoh3-.js";import{_ as $e}from"./Input.vue_vue_type_script_setup_true_lang-qz7OskJt.js";import{_ as me}from"./Label.vue_vue_type_script_setup_true_lang-sz79BH87.js";import{_ as Pe,a as ze,b as Ve,c as We,d as ge,C as ot}from"./SelectValue.vue_vue_type_script_setup_true_lang-B0zCjsGc.js";import{S as it}from"./search-B7koysji.js";import{X as nt}from"./x-5CiMQrWb.js";import{F as rt}from"./filter-VfceoQwC.js";import{C as dt}from"./chevron-right-BplIK_Zm.js";import{t as W}from"./index-DuDiNkIE.js";import{C as ut}from"./calendar-DrKaZ9qm.js";import{A as ct}from"./arrow-left-BrFNyTsl.js";import{S as mt}from"./square-pen-pWxacdmg.js";import{P as Ne,a as ft}from"./play-3LhqJ3Y4.js";import{D as pt}from"./download-C-3vq9PK.js";import{S as vt}from"./send-DhSNIL02.js";import"./index-DHUnTxeJ.js";import"./VisuallyHidden-CoJfAQ5l.js";import"./RovingFocusItem-BlOGdQFV.js";import"./utils-BVVdBQk4.js";import"./useFlashMessages-x-Su6vge.js";import"./index-EaL6PGP0.js";import"./floating-ui.vue-D3TvU6_4.js";import"./index-rNE8Lpd7.js";import"./shield-qd1Wf5F6.js";import"./user-B3paekYl.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-QolKlYuj.js";import"./house-BKaJiwK1.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Cntn2jBR.js";import"./map-pin-8cL7Agee.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CZLqwq4w.js";import"./chevrons-up-down-CCT5UoMT.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-SopszEwA.js";import"./target-DIcFC4_y.js";import"./vote-T-IOb6dV.js";import"./folder-open-BSPHF0Yp.js";import"./file-text-D16aePTg.js";import"./briefcase-C1Z2eHEx.js";import"./megaphone-BFP4Avio.js";import"./user-check-Bf1Rc3kL.js";import"./clipboard-list-DtdWY6MC.js";import"./external-link-o3ntK-Zj.js";import"./panel-left-BiCO4_cc.js";import"./check-BJXe_xaF.js";import"./index-D10GpyFo.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=Ae("LinkIcon",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=Ae("MousePointerIcon",[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=Ae("TrendingDownIcon",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),xt={class:"space-y-4"},gt={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},ht={class:"flex items-center gap-2 mt-1"},yt={class:"text-xs text-muted-foreground"},wt={class:"text-xs text-muted-foreground mt-2"},$t={class:"flex items-center gap-2 mt-1"},kt={class:"text-xs text-muted-foreground"},bt={class:"text-xs text-muted-foreground mt-2"},Et={class:"flex items-center gap-2 mt-1"},Ct={class:"text-xs text-muted-foreground"},At={class:"text-xs text-muted-foreground mt-2"},jt={class:"text-2xl font-bold text-purple-600"},Mt={key:0,class:"grid gap-4 md:grid-cols-2"},Dt={class:"flex items-center justify-between"},Tt={class:"space-y-2"},Rt={class:"flex justify-between text-sm"},St={class:"font-medium"},Ft={class:"space-y-2"},It={class:"flex justify-between text-sm"},Lt={class:"font-medium"},Pt={class:"grid grid-cols-2 gap-4 pt-2 border-t"},zt={class:"text-lg font-semibold"},Vt={class:"text-lg font-semibold"},Wt={key:0,class:"pt-2 border-t"},Nt={class:"text-sm font-medium"},Ut={class:"flex items-center justify-between"},Gt={class:"space-y-2"},Bt={class:"flex justify-between text-sm"},Ht={class:"font-medium"},Ot={class:"space-y-2"},qt={class:"flex justify-between text-sm"},Xt={class:"font-medium text-red-600"},Kt={class:"pt-2 border-t"},Jt={class:"flex items-center justify-between"},Qt={class:"space-y-2"},Yt={class:"flex justify-between text-sm"},Zt={class:"font-medium"},ea={class:"space-y-2"},ta={class:"flex justify-between text-sm"},aa={class:"font-medium text-red-600"},sa={class:"space-y-2"},la={class:"flex justify-between text-sm"},oa={class:"font-medium"},ia={class:"space-y-2"},na={class:"flex justify-between text-sm"},ra={class:"font-medium text-red-600"},da={class:"pt-2 border-t"},ua={class:"flex items-center justify-between"},ca={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ma={class:"flex items-center gap-3"},fa={class:"text-xl font-bold"},pa={class:"flex items-center gap-3"},va={class:"text-xl font-bold"},_a={class:"flex items-center gap-3"},xa={class:"text-xl font-bold"},ga={class:"flex items-center gap-3"},ha={class:"text-xl font-bold"},ya=xe({__name:"CampanaMetrics",props:{metrics:{},comparison:{},showDetails:{type:Boolean,default:!0},tipo:{default:"ambos"},whatsappMode:{default:"individual"}},setup(u){const C=u,i=Q(()=>C.tipo!=="email"&&["grupos","mixto"].includes(C.whatsappMode||"individual")),h=(n,m)=>{if(!m)return{icon:Ie,color:"text-gray-400",text:"--"};const y=n-m,w=Math.abs(y/m*100).toFixed(1);return Math.abs(y)<.5?{icon:Ie,color:"text-gray-400",text:"0%"}:y>0?{icon:ke,color:"text-green-600",text:`+${w}%`}:{icon:_t,color:"text-red-600",text:`-${w}%`}},F=(n,m)=>{const w={apertura:{excellent:25,good:20,warning:15,poor:10},click:{excellent:10,good:5,warning:3,poor:2},rebote:{excellent:2,good:5,warning:10,poor:15},entrega:{excellent:98,good:95,warning:90,poor:85}}[m];return m==="rebote"?n<=w.excellent?"text-green-700":n<=w.good?"text-green-600":n<=w.warning?"text-yellow-600":"text-red-600":n>=w.excellent?"text-green-700":n>=w.good?"text-green-600":n>=w.warning?"text-yellow-600":n>=w.poor?"text-orange-600":"text-red-600"},E=Q(()=>{const n=C.metrics;return{tasaEntrega:((n==null?void 0:n.total_enviados)||0)>0?(((n==null?void 0:n.total_enviados)||0)-((n==null?void 0:n.total_fallidos)||0))/((n==null?void 0:n.total_enviados)||1)*100:0,engagementRate:((n==null?void 0:n.emails_enviados)||0)>0?(((n==null?void 0:n.emails_abiertos)||0)+((n==null?void 0:n.emails_con_click)||0))/(((n==null?void 0:n.emails_enviados)||1)*2)*100:0,ctr:((n==null?void 0:n.emails_abiertos)||0)>0?((n==null?void 0:n.emails_con_click)||0)/((n==null?void 0:n.emails_abiertos)||1)*100:0,clicksPorUsuario:((n==null?void 0:n.emails_con_click)||0)>0?((n==null?void 0:n.total_clicks)||0)/((n==null?void 0:n.emails_con_click)||1):0,tasaExitoWhatsApp:((n==null?void 0:n.whatsapp_enviados)||0)>0?((n==null?void 0:n.whatsapp_entregados)||0)/((n==null?void 0:n.whatsapp_enviados)||1)*100:0}}),r=n=>n>=1e6?`${(n/1e6).toFixed(1)}M`:n>=1e3?`${(n/1e3).toFixed(1)}K`:n.toString();return(n,m)=>(o(),p("div",xt,[t("div",gt,[a(e(O),null,{default:s(()=>[a(e(G),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(B),{class:"text-sm font-medium"},{default:s(()=>[...m[0]||(m[0]=[d("Tasa de Apertura",-1)])]),_:1}),a(e(ue),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(H),null,{default:s(()=>{var y,w,A,R,j,M,T,k,_,b;return[t("div",{class:K(["text-2xl font-bold",F(((y=u.metrics)==null?void 0:y.tasa_apertura)||0,"apertura")])},l((((w=u.metrics)==null?void 0:w.tasa_apertura)||0).toFixed(1))+"% ",3),t("div",ht,[(o(),g(fe(h(((A=u.metrics)==null?void 0:A.tasa_apertura)||0,(R=u.comparison)==null?void 0:R.tasa_apertura_prev).icon),{class:K(["h-3 w-3",h(((j=u.metrics)==null?void 0:j.tasa_apertura)||0,(M=u.comparison)==null?void 0:M.tasa_apertura_prev).color])},null,8,["class"])),t("span",yt,l(h(((T=u.metrics)==null?void 0:T.tasa_apertura)||0,(k=u.comparison)==null?void 0:k.tasa_apertura_prev).text),1)]),t("p",wt,l(r(((_=u.metrics)==null?void 0:_.emails_abiertos)||0))+" de "+l(r(((b=u.metrics)==null?void 0:b.emails_enviados)||0)),1)]}),_:1})]),_:1}),a(e(O),null,{default:s(()=>[a(e(G),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(B),{class:"text-sm font-medium"},{default:s(()=>[...m[1]||(m[1]=[d("Tasa de Clicks",-1)])]),_:1}),a(e(Ce),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(H),null,{default:s(()=>{var y,w,A,R,j,M,T,k,_;return[t("div",{class:K(["text-2xl font-bold",F(((y=u.metrics)==null?void 0:y.tasa_click)||0,"click")])},l((((w=u.metrics)==null?void 0:w.tasa_click)||0).toFixed(1))+"% ",3),t("div",$t,[(o(),g(fe(h(((A=u.metrics)==null?void 0:A.tasa_click)||0,(R=u.comparison)==null?void 0:R.tasa_click_prev).icon),{class:K(["h-3 w-3",h(((j=u.metrics)==null?void 0:j.tasa_click)||0,(M=u.comparison)==null?void 0:M.tasa_click_prev).color])},null,8,["class"])),t("span",kt,l(h(((T=u.metrics)==null?void 0:T.tasa_click)||0,(k=u.comparison)==null?void 0:k.tasa_click_prev).text),1)]),t("p",bt,l(r(((_=u.metrics)==null?void 0:_.emails_con_click)||0))+" usuarios ",1)]}),_:1})]),_:1}),a(e(O),null,{default:s(()=>[a(e(G),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(B),{class:"text-sm font-medium"},{default:s(()=>[...m[2]||(m[2]=[d("Tasa de Rebote",-1)])]),_:1}),a(e(_e),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(H),null,{default:s(()=>{var y,w,A,R,j,M,T,k,_;return[t("div",{class:K(["text-2xl font-bold",F(((y=u.metrics)==null?void 0:y.tasa_rebote)||0,"rebote")])},l((((w=u.metrics)==null?void 0:w.tasa_rebote)||0).toFixed(1))+"% ",3),t("div",Et,[(o(),g(fe(h(((A=u.metrics)==null?void 0:A.tasa_rebote)||0,(R=u.comparison)==null?void 0:R.tasa_rebote_prev).icon),{class:K(["h-3 w-3",h(((j=u.metrics)==null?void 0:j.tasa_rebote)||0,(M=u.comparison)==null?void 0:M.tasa_rebote_prev).color])},null,8,["class"])),t("span",Ct,l(h(((T=u.metrics)==null?void 0:T.tasa_rebote)||0,(k=u.comparison)==null?void 0:k.tasa_rebote_prev).text),1)]),t("p",At,l(r(((_=u.metrics)==null?void 0:_.emails_rebotados)||0))+" rebotes ",1)]}),_:1})]),_:1}),a(e(O),null,{default:s(()=>[a(e(G),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[a(e(B),{class:"text-sm font-medium"},{default:s(()=>[...m[3]||(m[3]=[d("Engagement",-1)])]),_:1}),a(e(Ke),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(H),null,{default:s(()=>[t("div",jt,l(E.value.engagementRate.toFixed(1))+"% ",1),m[4]||(m[4]=t("p",{class:"text-xs text-muted-foreground mt-3"}," Interacción general ",-1))]),_:1})]),_:1})]),u.showDetails?(o(),p("div",Mt,[a(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>[t("div",Dt,[a(e(B),{class:"text-base flex items-center gap-2"},{default:s(()=>[a(e(le),{class:"h-4 w-4"}),m[5]||(m[5]=d(" Email ",-1))]),_:1}),a(e(L),{variant:"outline"},{default:s(()=>{var y;return[d(l(r(((y=u.metrics)==null?void 0:y.emails_enviados)||0))+" enviados ",1)]}),_:1})])]),_:1}),a(e(H),{class:"space-y-3"},{default:s(()=>{var y,w,A,R,j,M,T;return[t("div",Tt,[t("div",Rt,[m[6]||(m[6]=t("span",{class:"text-muted-foreground"},"Abiertos",-1)),t("span",St,l(r(((y=u.metrics)==null?void 0:y.emails_abiertos)||0)),1)]),a(e(de),{"model-value":((w=u.metrics)==null?void 0:w.tasa_apertura)||0,class:"h-2"},null,8,["model-value"])]),t("div",Ft,[t("div",It,[m[7]||(m[7]=t("span",{class:"text-muted-foreground"},"Con clicks",-1)),t("span",Lt,l(r(((A=u.metrics)==null?void 0:A.emails_con_click)||0)),1)]),a(e(de),{"model-value":((R=u.metrics)==null?void 0:R.tasa_click)||0,class:"h-2"},null,8,["model-value"])]),t("div",Pt,[t("div",null,[m[8]||(m[8]=t("p",{class:"text-xs text-muted-foreground"},"Total clicks",-1)),t("p",zt,l(r(((j=u.metrics)==null?void 0:j.total_clicks)||0)),1)]),t("div",null,[m[9]||(m[9]=t("p",{class:"text-xs text-muted-foreground"},"Clicks/usuario",-1)),t("p",Vt,l(E.value.clicksPorUsuario.toFixed(1)),1)])]),(((M=u.metrics)==null?void 0:M.tiempo_promedio_apertura)||0)>0?(o(),p("div",Wt,[m[10]||(m[10]=t("p",{class:"text-xs text-muted-foreground"},"Tiempo promedio hasta apertura",-1)),t("p",Nt,l((((T=u.metrics)==null?void 0:T.tiempo_promedio_apertura)||0).toFixed(0))+" min",1)])):x("",!0)]}),_:1})]),_:1}),a(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>[t("div",Ut,[a(e(B),{class:"text-base flex items-center gap-2"},{default:s(()=>[a(e(oe),{class:"h-4 w-4"}),m[11]||(m[11]=d(" WhatsApp ",-1))]),_:1}),a(e(L),{variant:"outline"},{default:s(()=>{var y;return[d(l(r(((y=u.metrics)==null?void 0:y.whatsapp_enviados)||0))+" enviados ",1)]}),_:1})])]),_:1}),a(e(H),{class:"space-y-3"},{default:s(()=>{var y,w,A,R,j;return[i.value?(o(),g(e(je),{key:0,"default-value":"contactos",class:"w-full"},{default:s(()=>[a(e(Me),{class:"grid w-full grid-cols-2 mb-4"},{default:s(()=>[a(e(te),{value:"contactos",class:"text-xs"},{default:s(()=>[a(e(oe),{class:"h-3 w-3 mr-1"}),m[12]||(m[12]=d(" Contactos ",-1))]),_:1}),a(e(te),{value:"grupos",class:"text-xs"},{default:s(()=>[a(e(ae),{class:"h-3 w-3 mr-1"}),m[13]||(m[13]=d(" Grupos ",-1))]),_:1})]),_:1}),a(e(se),{value:"contactos",class:"space-y-3 mt-0"},{default:s(()=>{var M,T,k;return[t("div",Gt,[t("div",Bt,[m[14]||(m[14]=t("span",{class:"text-muted-foreground"},"Entregados",-1)),t("span",Ht,l(r(((M=u.metrics)==null?void 0:M.whatsapp_individual_enviados)||((T=u.metrics)==null?void 0:T.whatsapp_entregados)||0)),1)]),a(e(de),{"model-value":E.value.tasaExitoWhatsApp,class:"h-2"},null,8,["model-value"])]),t("div",Ot,[t("div",qt,[m[15]||(m[15]=t("span",{class:"text-muted-foreground"},"Fallidos",-1)),t("span",Xt,l(r(((k=u.metrics)==null?void 0:k.whatsapp_individual_fallidos)||0)),1)])]),t("div",Kt,[t("div",Jt,[m[16]||(m[16]=t("span",{class:"text-sm text-muted-foreground"},"Tasa de éxito",-1)),t("span",{class:K(["text-lg font-semibold",F(E.value.tasaExitoWhatsApp,"entrega")])},l(E.value.tasaExitoWhatsApp.toFixed(1))+"% ",3)])])]}),_:1}),a(e(se),{value:"grupos",class:"space-y-3 mt-0"},{default:s(()=>{var M,T,k,_,b;return[t("div",Qt,[t("div",Yt,[m[17]||(m[17]=t("span",{class:"text-muted-foreground"},"Grupos enviados",-1)),t("span",Zt,l(r(((M=u.metrics)==null?void 0:M.whatsapp_grupos_enviados)||0)),1)]),a(e(de),{"model-value":(((T=u.metrics)==null?void 0:T.whatsapp_grupos_total)||0)>0?(((k=u.metrics)==null?void 0:k.whatsapp_grupos_enviados)||0)/(((_=u.metrics)==null?void 0:_.whatsapp_grupos_total)||1)*100:0,class:"h-2"},null,8,["model-value"])]),t("div",ea,[t("div",ta,[m[18]||(m[18]=t("span",{class:"text-muted-foreground"},"Fallidos",-1)),t("span",aa,l(r(((b=u.metrics)==null?void 0:b.whatsapp_grupos_fallidos)||0)),1)])]),m[19]||(m[19]=t("div",{class:"pt-2 border-t text-xs text-muted-foreground"}," Los mensajes a grupos no tienen tracking individual de entrega. ",-1))]}),_:1})]),_:1})):(o(),p(U,{key:1},[t("div",sa,[t("div",la,[m[20]||(m[20]=t("span",{class:"text-muted-foreground"},"Entregados",-1)),t("span",oa,l(r(((y=u.metrics)==null?void 0:y.whatsapp_entregados)||0)),1)]),a(e(de),{"model-value":E.value.tasaExitoWhatsApp,class:"h-2"},null,8,["model-value"])]),t("div",ia,[t("div",na,[m[21]||(m[21]=t("span",{class:"text-muted-foreground"},"Fallidos",-1)),t("span",ra,l(r(((w=u.metrics)==null?void 0:w.whatsapp_fallidos)||0)),1)]),a(e(de),{"model-value":(((A=u.metrics)==null?void 0:A.whatsapp_enviados)||0)>0?(((R=u.metrics)==null?void 0:R.whatsapp_fallidos)||0)/(((j=u.metrics)==null?void 0:j.whatsapp_enviados)||1)*100:0,class:"h-2"},null,8,["model-value"])]),t("div",da,[t("div",ua,[m[22]||(m[22]=t("span",{class:"text-sm text-muted-foreground"},"Tasa de éxito",-1)),t("span",{class:K(["text-lg font-semibold",F(E.value.tasaExitoWhatsApp,"entrega")])},l(E.value.tasaExitoWhatsApp.toFixed(1))+"% ",3)])])],64))]}),_:1})]),_:1})])):x("",!0),u.showDetails?(o(),g(e(O),{key:1},{default:s(()=>[a(e(G),null,{default:s(()=>[a(e(B),{class:"text-base"},{default:s(()=>[...m[23]||(m[23]=[d("Resumen General",-1)])]),_:1})]),_:1}),a(e(H),null,{default:s(()=>{var y,w,A;return[t("div",ca,[t("div",ma,[a(e(ae),{class:"h-8 w-8 text-blue-600"}),t("div",null,[m[24]||(m[24]=t("p",{class:"text-xs text-muted-foreground"},"Destinatarios",-1)),t("p",fa,l(r(((y=u.metrics)==null?void 0:y.total_destinatarios)||0)),1)])]),t("div",pa,[a(e(Be),{class:"h-8 w-8 text-green-600"}),t("div",null,[m[25]||(m[25]=t("p",{class:"text-xs text-muted-foreground"},"Enviados",-1)),t("p",va,l(r(((w=u.metrics)==null?void 0:w.total_enviados)||0)),1)])]),t("div",_a,[a(e(ye),{class:"h-8 w-8 text-red-600"}),t("div",null,[m[26]||(m[26]=t("p",{class:"text-xs text-muted-foreground"},"Fallidos",-1)),t("p",xa,l(r(((A=u.metrics)==null?void 0:A.total_fallidos)||0)),1)])]),t("div",ga,[a(e(ke),{class:"h-8 w-8 text-purple-600"}),t("div",null,[m[27]||(m[27]=t("p",{class:"text-xs text-muted-foreground"},"Tasa entrega",-1)),t("p",ha,l(E.value.tasaEntrega.toFixed(1))+"%",1)])])])]}),_:1})]),_:1})):x("",!0)]))}}),wa={class:"flex justify-between items-center"},$a={class:"space-y-2"},ka={class:"flex justify-between text-sm"},ba={class:"font-medium"},Ea={class:"flex justify-between text-xs text-muted-foreground"},Ca={class:"grid grid-cols-2 gap-4"},Aa={class:"space-y-1"},ja={class:"flex items-center gap-2"},Ma={class:"text-2xl font-bold"},Da={class:"text-xs text-muted-foreground"},Ta={class:"space-y-1"},Ra={class:"flex items-center gap-2"},Sa={class:"text-2xl font-bold"},Fa={class:"space-y-1"},Ia={class:"flex items-center gap-2"},La={class:"text-2xl font-bold"},Pa={class:"text-xs text-muted-foreground"},za={class:"space-y-1"},Va={class:"flex items-center gap-2"},Wa={class:"text-2xl font-bold"},Na={key:0,class:"pt-2 border-t"},Ua={class:"flex justify-between items-center text-sm"},Ga={key:0},Ba={class:"ml-2"},Ha={key:1},Oa={class:"ml-2 font-medium"},qa={key:1,class:"p-3 bg-red-50 border border-red-200 rounded-md"},Xa={class:"flex items-center gap-2"},Ka={class:"text-sm text-red-800"},Ja=xe({__name:"CampanaProgress",props:{progreso:{},total:{},enviados:{},pendientes:{},fallidos:{},estado:{},velocidad:{},tiempoRestante:{},fechaInicio:{}},setup(u){const C=u,i=Q(()=>{let r=0;if(C.progreso!==void 0)r=C.progreso;else{if(C.total===0)return 0;r=Math.round(C.enviados/C.total*100)}return Math.max(0,Math.min(r,100))}),h=Q(()=>C.total===0?0:Math.round(C.fallidos/C.total*100)),F=r=>{if(!r)return"--";if(r<60)return`${Math.round(r)} min`;const n=Math.floor(r/60),m=Math.round(r%60);if(n<24)return`${n}h ${m}m`;const y=Math.floor(n/24),w=n%24;return`${y}d ${w}h`},E=r=>({iniciando:{variant:"default",text:"Iniciando"},enviando:{variant:"default",text:"Enviando"},pausada:{variant:"warning",text:"Pausada"},completada:{variant:"success",text:"Completada"},cancelada:{variant:"destructive",text:"Cancelada"},fallida:{variant:"destructive",text:"Fallida"}})[r]||{variant:"secondary",text:r};return(r,n)=>(o(),g(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>[t("div",wa,[a(e(B),{class:"text-base"},{default:s(()=>[...n[0]||(n[0]=[d("Progreso de Envío",-1)])]),_:1}),a(e(L),{variant:E(u.estado).variant},{default:s(()=>[d(l(E(u.estado).text),1)]),_:1},8,["variant"])])]),_:1}),a(e(H),{class:"space-y-4"},{default:s(()=>[t("div",$a,[t("div",ka,[n[1]||(n[1]=t("span",{class:"text-muted-foreground"},"Progreso total",-1)),t("span",ba,l(i.value)+"%",1)]),a(e(de),{"model-value":i.value,class:"h-3"},null,8,["model-value"]),t("div",Ea,[t("span",null,l(u.enviados)+" enviados",1),t("span",null,l(u.total)+" total",1)])]),t("div",Ca,[t("div",Aa,[t("div",ja,[a(e(Be),{class:"w-4 h-4 text-green-600"}),n[2]||(n[2]=t("span",{class:"text-sm font-medium"},"Enviados",-1))]),t("p",Ma,l(u.enviados.toLocaleString()),1),t("p",Da,l(i.value)+"% completado ",1)]),t("div",Ta,[t("div",Ra,[a(e(pe),{class:"w-4 h-4 text-blue-600"}),n[3]||(n[3]=t("span",{class:"text-sm font-medium"},"Pendientes",-1))]),t("p",Sa,l(u.pendientes.toLocaleString()),1),n[4]||(n[4]=t("p",{class:"text-xs text-muted-foreground"}," Por enviar ",-1))]),t("div",Fa,[t("div",Ia,[a(e(ye),{class:"w-4 h-4 text-red-600"}),n[5]||(n[5]=t("span",{class:"text-sm font-medium"},"Fallidos",-1))]),t("p",La,l(u.fallidos.toLocaleString()),1),t("p",Pa,l(h.value)+"% del total ",1)]),t("div",za,[t("div",Va,[a(e(ke),{class:"w-4 h-4 text-purple-600"}),n[6]||(n[6]=t("span",{class:"text-sm font-medium"},"Velocidad",-1))]),t("p",Wa,l(u.velocidad?u.velocidad.toFixed(1):"--"),1),n[7]||(n[7]=t("p",{class:"text-xs text-muted-foreground"}," envíos/min ",-1))])]),u.tiempoRestante||u.fechaInicio?(o(),p("div",Na,[t("div",Ua,[u.fechaInicio?(o(),p("div",Ga,[n[8]||(n[8]=t("span",{class:"text-muted-foreground"},"Iniciado:",-1)),t("span",Ba,l(new Date(u.fechaInicio).toLocaleString("es-CO")),1)])):x("",!0),u.tiempoRestante?(o(),p("div",Ha,[n[9]||(n[9]=t("span",{class:"text-muted-foreground"},"Tiempo restante:",-1)),t("span",Oa,l(F(u.tiempoRestante)),1)])):x("",!0)])])):x("",!0),h.value>10?(o(),p("div",qa,[t("div",Xa,[a(e(_e),{class:"w-4 h-4 text-red-600"}),t("span",Ka," Alta tasa de fallos ("+l(h.value)+"%). Revisa la configuración de envío. ",1)])])):x("",!0)]),_:1})]),_:1}))}}),Qa={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},Ya={class:"text-sm text-muted-foreground mt-1"},Za={class:"flex flex-wrap gap-2"},es={key:1,class:"text-center py-8 text-muted-foreground"},ts={key:2,class:"text-center py-8 text-muted-foreground"},as={key:3,class:"overflow-x-auto"},ss={key:0,class:"truncate"},ls={class:"font-medium text-green-700"},os={class:"text-xs text-muted-foreground"},is=["title"],ns={key:0,class:"space-y-4"},rs={class:"grid grid-cols-2 gap-4"},ds={class:"font-mono text-sm"},us={class:"text-sm"},cs={key:0,class:"p-3 bg-green-50 dark:bg-green-950 rounded-lg"},ms={class:"grid grid-cols-2 gap-2 text-sm"},fs={class:"ml-2 font-medium"},ps={class:"ml-2 font-medium"},vs={key:1},_s={class:"font-mono text-xs bg-muted p-2 rounded"},xs={key:2},gs={key:3},hs={class:"bg-muted p-3 rounded text-xs overflow-auto max-h-[200px]"},ys=xe({__name:"CampanaLogs",props:{campanaId:{},tipo:{}},setup(u){const C=u,i=S([]),h=S("todos"),F=S(!1),E=S(null),r=S(null),n=S(!1),m=Q(()=>h.value==="todos"?i.value:i.value.filter(k=>k.servicio===h.value)),y=Q(()=>({email:i.value.filter(k=>k.servicio==="resend").length,waIndividual:i.value.filter(k=>k.servicio==="evolution_individual").length,waGrupo:i.value.filter(k=>k.servicio==="evolution_group").length})),w=Q(()=>{const k=i.value.length,_=i.value.filter(N=>["enviado","abierto","click"].includes(N.estado)).length,b=i.value.filter(N=>N.estado==="fallido").length,Y=i.value.filter(N=>["pendiente","enviando"].includes(N.estado)).length;return{total:k,exitosos:_,fallidos:b,pendientes:Y}}),A=async()=>{F.value=!0,E.value=null;try{const k=await fetch(`/admin/envio-campanas/${C.campanaId}/logs`);if(!k.ok)throw new Error("Error al cargar logs");i.value=await k.json()}catch(k){E.value=k.message||"Error desconocido"}finally{F.value=!1}},R=k=>({pendiente:"secondary",enviando:"outline",enviado:"default",abierto:"default",click:"default",fallido:"destructive"})[k]||"secondary",j=k=>({pendiente:pe,enviando:pe,enviado:lt,abierto:ue,click:ue,fallido:ye})[k]||pe,M=k=>{if(!k)return"-";try{return new Date(k).toLocaleString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return k}},T=k=>{r.value=k,n.value=!0};return De(A),(k,_)=>(o(),p(U,null,[a(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>[t("div",Qa,[t("div",null,[a(e(B),null,{default:s(()=>[..._[4]||(_[4]=[d("Logs de Envío",-1)])]),_:1}),t("p",Ya,l(w.value.total)+" registros | "+l(w.value.exitosos)+" exitosos | "+l(w.value.fallidos)+" fallidos ",1)]),t("div",Za,[u.tipo!=="whatsapp"?(o(),g(e(z),{key:0,variant:h.value==="resend"?"default":"outline",size:"sm",onClick:_[0]||(_[0]=b=>h.value=h.value==="resend"?"todos":"resend")},{default:s(()=>[a(e(le),{class:"w-4 h-4 mr-1"}),_[5]||(_[5]=d(" Email ",-1)),y.value.email>0?(o(),g(e(L),{key:0,variant:"secondary",class:"ml-1 text-xs"},{default:s(()=>[d(l(y.value.email),1)]),_:1})):x("",!0)]),_:1},8,["variant"])):x("",!0),u.tipo!=="email"?(o(),g(e(z),{key:1,variant:h.value==="evolution_individual"?"default":"outline",size:"sm",onClick:_[1]||(_[1]=b=>h.value=h.value==="evolution_individual"?"todos":"evolution_individual")},{default:s(()=>[a(e(oe),{class:"w-4 h-4 mr-1"}),_[6]||(_[6]=d(" WA Individual ",-1)),y.value.waIndividual>0?(o(),g(e(L),{key:0,variant:"secondary",class:"ml-1 text-xs"},{default:s(()=>[d(l(y.value.waIndividual),1)]),_:1})):x("",!0)]),_:1},8,["variant"])):x("",!0),u.tipo!=="email"?(o(),g(e(z),{key:2,variant:h.value==="evolution_group"?"default":"outline",size:"sm",onClick:_[2]||(_[2]=b=>h.value=h.value==="evolution_group"?"todos":"evolution_group")},{default:s(()=>[a(e(ae),{class:"w-4 h-4 mr-1"}),_[7]||(_[7]=d(" WA Grupos ",-1)),y.value.waGrupo>0?(o(),g(e(L),{key:0,variant:"secondary",class:"ml-1 text-xs"},{default:s(()=>[d(l(y.value.waGrupo),1)]),_:1})):x("",!0)]),_:1},8,["variant"])):x("",!0),a(e(z),{variant:"ghost",size:"sm",onClick:A,disabled:F.value},{default:s(()=>[a(e(he),{class:K(["w-4 h-4",{"animate-spin":F.value}])},null,8,["class"])]),_:1},8,["disabled"])])])]),_:1}),a(e(H),null,{default:s(()=>[E.value?(o(),g(e(be),{key:0,variant:"destructive",class:"mb-4"},{default:s(()=>[a(e(_e),{class:"h-4 w-4"}),a(e(Ee),null,{default:s(()=>[d(l(E.value),1)]),_:1})]),_:1})):x("",!0),F.value&&i.value.length===0?(o(),p("div",es," Cargando logs... ")):m.value.length===0?(o(),p("div",ts," No hay logs de envío disponibles ")):(o(),p("div",as,[a(e(He),null,{default:s(()=>[a(e(Oe),null,{default:s(()=>[a(e(ve),null,{default:s(()=>[a(e(J),{class:"w-[100px]"},{default:s(()=>[..._[8]||(_[8]=[d("Servicio",-1)])]),_:1}),a(e(J),null,{default:s(()=>[..._[9]||(_[9]=[d("Destinatario",-1)])]),_:1}),a(e(J),{class:"w-[100px]"},{default:s(()=>[..._[10]||(_[10]=[d("Estado",-1)])]),_:1}),a(e(J),null,{default:s(()=>[..._[11]||(_[11]=[d("Fecha",-1)])]),_:1}),a(e(J),null,{default:s(()=>[..._[12]||(_[12]=[d("ID Mensaje",-1)])]),_:1}),a(e(J),{class:"w-[80px]"},{default:s(()=>[..._[13]||(_[13]=[d("Acciones",-1)])]),_:1})]),_:1})]),_:1}),a(e(qe),null,{default:s(()=>[(o(!0),p(U,null,ee(m.value,b=>(o(),g(e(ve),{key:b.id},{default:s(()=>[a(e(X),null,{default:s(()=>[a(e(L),{variant:b.servicio==="resend"?"default":"secondary"},{default:s(()=>[b.servicio==="resend"?(o(),g(e(le),{key:0,class:"w-3 h-3 mr-1"})):b.servicio==="evolution_group"?(o(),g(e(ae),{key:1,class:"w-3 h-3 mr-1"})):(o(),g(e(oe),{key:2,class:"w-3 h-3 mr-1"})),d(" "+l(b.servicio==="resend"?"Email":b.servicio==="evolution_group"?"Grupo":"WA"),1)]),_:2},1032,["variant"])]),_:2},1024),a(e(X),{class:"max-w-[200px]"},{default:s(()=>{var Y;return[(Y=b.grupo)!=null&&Y.nombre?(o(),p("div",ss,[t("div",ls,l(b.grupo.nombre),1),t("div",os,l(b.grupo.participantes)+" participantes ",1)])):(o(),p("div",{key:1,class:"truncate",title:b.destinatario},l(b.destinatario),9,is))]}),_:2},1024),a(e(X),null,{default:s(()=>[a(e(L),{variant:R(b.estado)},{default:s(()=>[(o(),g(fe(j(b.estado)),{class:"w-3 h-3 mr-1"})),d(" "+l(b.estado),1)]),_:2},1032,["variant"])]),_:2},1024),a(e(X),{class:"text-sm"},{default:s(()=>[d(l(M(b.fecha)),1)]),_:2},1024),a(e(X),{class:"font-mono text-xs max-w-[150px] truncate",title:b.mensaje_id||""},{default:s(()=>[d(l(b.mensaje_id||"-"),1)]),_:2},1032,["title"]),a(e(X),null,{default:s(()=>[a(e(z),{variant:"ghost",size:"sm",onClick:Y=>T(b)},{default:s(()=>[a(e(ue),{class:"w-4 h-4"})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]))]),_:1})]),_:1}),a(e(st),{open:n.value,"onUpdate:open":_[3]||(_[3]=b=>n.value=b)},{default:s(()=>[a(e(Ze),{class:"max-w-2xl"},{default:s(()=>{var b;return[a(e(et),null,{default:s(()=>[a(e(tt),null,{default:s(()=>[..._[14]||(_[14]=[d("Detalles del Envío",-1)])]),_:1}),a(e(at),null,{default:s(()=>[..._[15]||(_[15]=[d(" Información completa del registro de envío ",-1)])]),_:1})]),_:1}),r.value?(o(),p("div",ns,[t("div",rs,[t("div",null,[_[16]||(_[16]=t("p",{class:"text-sm text-muted-foreground"},"Servicio",-1)),a(e(L),{variant:r.value.servicio==="resend"?"default":"secondary"},{default:s(()=>[r.value.servicio==="resend"?(o(),g(e(le),{key:0,class:"w-3 h-3 mr-1"})):r.value.servicio==="evolution_group"?(o(),g(e(ae),{key:1,class:"w-3 h-3 mr-1"})):(o(),g(e(oe),{key:2,class:"w-3 h-3 mr-1"})),d(" "+l(r.value.servicio==="resend"?"Email (Resend)":r.value.servicio==="evolution_group"?"WA Grupo":"WA Individual"),1)]),_:1},8,["variant"])]),t("div",null,[_[17]||(_[17]=t("p",{class:"text-sm text-muted-foreground"},"Estado",-1)),a(e(L),{variant:R(r.value.estado)},{default:s(()=>[d(l(r.value.estado),1)]),_:1},8,["variant"])]),t("div",null,[_[18]||(_[18]=t("p",{class:"text-sm text-muted-foreground"},"Destinatario",-1)),t("p",ds,l(r.value.destinatario),1)]),t("div",null,[_[19]||(_[19]=t("p",{class:"text-sm text-muted-foreground"},"Fecha de Envío",-1)),t("p",us,l(M(r.value.fecha)),1)])]),(b=r.value.grupo)!=null&&b.nombre?(o(),p("div",cs,[_[22]||(_[22]=t("p",{class:"text-sm text-muted-foreground mb-2"},"Información del Grupo",-1)),t("div",ms,[t("div",null,[_[20]||(_[20]=t("span",{class:"text-muted-foreground"},"Nombre:",-1)),t("span",fs,l(r.value.grupo.nombre),1)]),t("div",null,[_[21]||(_[21]=t("span",{class:"text-muted-foreground"},"Participantes:",-1)),t("span",ps,l(r.value.grupo.participantes),1)])])])):x("",!0),r.value.mensaje_id?(o(),p("div",vs,[_[23]||(_[23]=t("p",{class:"text-sm text-muted-foreground"},"ID del Mensaje",-1)),t("p",_s,l(r.value.mensaje_id),1)])):x("",!0),r.value.error?(o(),p("div",xs,[_[24]||(_[24]=t("p",{class:"text-sm text-muted-foreground"},"Error",-1)),a(e(be),{variant:"destructive"},{default:s(()=>[a(e(_e),{class:"h-4 w-4"}),a(e(Ee),null,{default:s(()=>[d(l(r.value.error),1)]),_:1})]),_:1})])):x("",!0),r.value.metadata&&Object.keys(r.value.metadata).length>0?(o(),p("div",gs,[_[25]||(_[25]=t("p",{class:"text-sm text-muted-foreground mb-2"},"Metadata",-1)),t("pre",hs,l(JSON.stringify(r.value.metadata,null,2)),1)])):x("",!0)])):x("",!0)]}),_:1})]),_:1},8,["open"])],64))}}),ws={class:"flex flex-col gap-4"},$s={class:"flex justify-between items-center"},ks={class:"flex items-center gap-2"},bs={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-3 p-4 bg-muted/50 rounded-lg"},Es={class:"lg:col-span-2"},Cs={class:"relative"},As={class:"lg:col-span-6 flex justify-end gap-2 pt-2 border-t mt-2"},js={key:1,class:"text-center py-8 text-muted-foreground"},Ms={key:2,class:"text-center py-8 text-muted-foreground"},Ds={key:3,class:"space-y-4"},Ts={class:"flex items-center gap-2"},Rs={key:2},Ss={class:"font-medium"},Fs={class:"text-sm text-muted-foreground"},Is={key:3,class:"flex items-center gap-2"},Ls={class:"font-medium text-green-700"},Ps={class:"text-sm text-muted-foreground"},zs={key:4},Vs={class:"font-medium text-muted-foreground"},Ws={key:0,class:"flex items-center gap-1"},Ns={key:1,class:"text-muted-foreground"},Us={key:1,class:"text-muted-foreground text-xs"},Gs={key:0,class:"flex items-center gap-1"},Bs={key:1,class:"text-muted-foreground"},Hs={key:1,class:"text-muted-foreground text-xs"},Os={class:"bg-muted/30 p-4"},qs={key:0,class:"space-y-2"},Xs={class:"text-muted-foreground text-xs"},Ks={key:1,class:"text-sm text-muted-foreground"},Js={key:0,class:"space-y-2"},Qs={key:0},Ys={class:"flex items-center gap-2 text-sm"},Zs={class:"font-medium"},el={class:"text-xs text-muted-foreground ml-5"},tl={class:"truncate"},al={key:0},sl={key:1},ll={class:"flex items-center gap-2 text-sm"},ol={class:"font-medium"},il={class:"text-xs text-muted-foreground ml-5"},nl={class:"truncate"},rl={key:1,class:"text-sm text-muted-foreground"},dl={key:1,class:"space-y-3"},ul={class:"grid grid-cols-2 gap-4 text-sm"},cl={class:"ml-2 font-medium"},ml={class:"ml-2 font-medium"},fl={class:"col-span-2"},pl={class:"ml-2 text-xs bg-muted px-2 py-1 rounded"},vl={key:2,class:"space-y-3"},_l={class:"grid grid-cols-2 gap-4 text-sm"},xl={class:"ml-2 font-medium"},gl={class:"ml-2 font-medium"},hl={key:0,class:"text-sm text-destructive"},yl={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},wl={class:"text-sm text-muted-foreground"},$l={key:0,class:"flex items-center gap-2"},kl=["innerHTML"],bl=xe({__name:"ActividadReciente",props:{campanaId:{},tipo:{}},setup(u){const C=u,i=S(null),h=S(!1),F=S(null),E=S([]),r=S({tipo:"__all__",estado:"__all__",search:"",fecha_desde:"",fecha_hasta:""}),n=S(1),m=Q(()=>C.tipo==="email"?[{value:"email",label:"Email"}]:C.tipo==="whatsapp"?[{value:"whatsapp",label:"WhatsApp"},{value:"whatsapp_group",label:"Grupo WhatsApp"}]:[{value:"email",label:"Email"},{value:"whatsapp",label:"WhatsApp"},{value:"whatsapp_group",label:"Grupo WhatsApp"}]),y=[{value:"pendiente",label:"Pendiente"},{value:"enviando",label:"Enviando"},{value:"enviado",label:"Enviado"},{value:"abierto",label:"Abierto"},{value:"click",label:"Con Click"},{value:"fallido",label:"Fallido"}],w=Q(()=>r.value.tipo!=="__all__"&&r.value.tipo!==""||r.value.estado!=="__all__"&&r.value.estado!==""||r.value.search!==""||r.value.fecha_desde!==""||r.value.fecha_hasta!==""),A=Q(()=>{let $=0;return r.value.tipo&&r.value.tipo!=="__all__"&&$++,r.value.estado&&r.value.estado!=="__all__"&&$++,r.value.search&&$++,r.value.fecha_desde&&$++,r.value.fecha_hasta&&$++,$}),R=()=>{const $=new URLSearchParams;return $.append("page",n.value.toString()),r.value.tipo&&r.value.tipo!=="__all__"&&$.append("tipo",r.value.tipo),r.value.estado&&r.value.estado!=="__all__"&&$.append("estado",r.value.estado),r.value.search&&$.append("search",r.value.search),r.value.fecha_desde&&$.append("fecha_desde",r.value.fecha_desde),r.value.fecha_hasta&&$.append("fecha_hasta",r.value.fecha_hasta),`/admin/envio-campanas/${C.campanaId}/envios?${$.toString()}`},j=async()=>{h.value=!0,F.value=null;try{const $=await fetch(R(),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!$.ok)throw new Error("Error al cargar actividad");const c=await $.json();if(c.success)i.value=c.envios;else throw new Error(c.message||"Error desconocido")}catch($){F.value=$.message||"Error desconocido"}finally{h.value=!1}},M=()=>{n.value=1,j()},T=()=>{r.value={tipo:"__all__",estado:"__all__",search:"",fecha_desde:"",fecha_hasta:""},n.value=1,j()},k=$=>{if(!$)return;const v=new URL($,window.location.origin).searchParams.get("page");v&&(n.value=parseInt(v),j())},_=$=>{const c=E.value.indexOf($);c>-1?E.value.splice(c,1):E.value.push($)},b=$=>{if(!$)return"-";try{return new Date($).toLocaleString("es-ES")}catch{return $}},Y=$=>{if(!$)return"-";try{return new Date($).toLocaleTimeString("es-ES")}catch{return $}},N=$=>["enviado","abierto","click"].includes($)?"default":$==="fallido"?"destructive":"secondary",ie=Q(()=>C.tipo==="email"||C.tipo==="ambos");return De(j),($,c)=>(o(),g(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>{var v;return[t("div",ws,[t("div",$s,[t("div",ks,[a(e(B),null,{default:s(()=>[...c[5]||(c[5]=[d("Actividad Reciente",-1)])]),_:1}),(v=i.value)!=null&&v.total?(o(),g(e(L),{key:0,variant:"secondary"},{default:s(()=>[d(l(i.value.total)+" envíos ",1)]),_:1})):x("",!0)]),a(e(z),{onClick:j,variant:"outline",size:"sm",disabled:h.value},{default:s(()=>[a(e(he),{class:K(["w-4 h-4",{"animate-spin":h.value}])},null,8,["class"])]),_:1},8,["disabled"])]),t("div",bs,[t("div",Es,[a(e(me),{class:"text-xs text-muted-foreground"},{default:s(()=>[...c[6]||(c[6]=[d("Buscar destinatario",-1)])]),_:1}),t("div",Cs,[a(e(it),{class:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a(e($e),{modelValue:r.value.search,"onUpdate:modelValue":c[0]||(c[0]=D=>r.value.search=D),placeholder:"Email, teléfono, nombre...",class:"pl-8",onKeyup:Je(M,["enter"])},null,8,["modelValue"])])]),t("div",null,[a(e(me),{class:"text-xs text-muted-foreground"},{default:s(()=>[...c[7]||(c[7]=[d("Tipo",-1)])]),_:1}),a(e(Pe),{modelValue:r.value.tipo,"onUpdate:modelValue":c[1]||(c[1]=D=>r.value.tipo=D)},{default:s(()=>[a(e(ze),null,{default:s(()=>[a(e(Ve),{placeholder:"Todos"})]),_:1}),a(e(We),null,{default:s(()=>[a(e(ge),{value:"__all__"},{default:s(()=>[...c[8]||(c[8]=[d("Todos",-1)])]),_:1}),(o(!0),p(U,null,ee(m.value,D=>(o(),g(e(ge),{key:D.value,value:D.value},{default:s(()=>[d(l(D.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),t("div",null,[a(e(me),{class:"text-xs text-muted-foreground"},{default:s(()=>[...c[9]||(c[9]=[d("Estado",-1)])]),_:1}),a(e(Pe),{modelValue:r.value.estado,"onUpdate:modelValue":c[2]||(c[2]=D=>r.value.estado=D)},{default:s(()=>[a(e(ze),null,{default:s(()=>[a(e(Ve),{placeholder:"Todos"})]),_:1}),a(e(We),null,{default:s(()=>[a(e(ge),{value:"__all__"},{default:s(()=>[...c[10]||(c[10]=[d("Todos",-1)])]),_:1}),(o(),p(U,null,ee(y,D=>a(e(ge),{key:D.value,value:D.value},{default:s(()=>[d(l(D.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])]),t("div",null,[a(e(me),{class:"text-xs text-muted-foreground"},{default:s(()=>[...c[11]||(c[11]=[d("Desde",-1)])]),_:1}),a(e($e),{modelValue:r.value.fecha_desde,"onUpdate:modelValue":c[3]||(c[3]=D=>r.value.fecha_desde=D),type:"date"},null,8,["modelValue"])]),t("div",null,[a(e(me),{class:"text-xs text-muted-foreground"},{default:s(()=>[...c[12]||(c[12]=[d("Hasta",-1)])]),_:1}),a(e($e),{modelValue:r.value.fecha_hasta,"onUpdate:modelValue":c[4]||(c[4]=D=>r.value.fecha_hasta=D),type:"date"},null,8,["modelValue"])]),t("div",As,[w.value?(o(),g(e(z),{key:0,variant:"ghost",size:"sm",onClick:T},{default:s(()=>[a(e(nt),{class:"w-4 h-4 mr-1"}),c[13]||(c[13]=d(" Limpiar ",-1))]),_:1})):x("",!0),a(e(z),{variant:"default",size:"sm",onClick:M,disabled:h.value},{default:s(()=>[a(e(rt),{class:"w-4 h-4 mr-1"}),c[14]||(c[14]=d(" Aplicar filtros ",-1)),A.value>0?(o(),g(e(L),{key:0,variant:"secondary",class:"ml-1"},{default:s(()=>[d(l(A.value),1)]),_:1})):x("",!0)]),_:1},8,["disabled"])])])])]}),_:1}),a(e(H),null,{default:s(()=>[F.value?(o(),g(e(be),{key:0,variant:"destructive",class:"mb-4"},{default:s(()=>[a(e(_e),{class:"h-4 w-4"}),a(e(Ee),null,{default:s(()=>[d(l(F.value),1)]),_:1})]),_:1})):x("",!0),h.value&&!i.value?(o(),p("div",js,[a(e(he),{class:"w-6 h-6 animate-spin mx-auto mb-2"}),c[15]||(c[15]=d(" Cargando actividad... ",-1))])):i.value&&i.value.data.length===0?(o(),p("div",Ms,[a(e(le),{class:"w-8 h-8 mx-auto mb-2 opacity-50"}),c[16]||(c[16]=d(" No hay envíos que mostrar ",-1))])):i.value?(o(),p("div",Ds,[a(e(He),null,{default:s(()=>[a(e(Oe),null,{default:s(()=>[a(e(ve),null,{default:s(()=>[a(e(J),{class:"w-[100px]"},{default:s(()=>[...c[17]||(c[17]=[d("Tipo",-1)])]),_:1}),a(e(J),null,{default:s(()=>[...c[18]||(c[18]=[d("Destinatario",-1)])]),_:1}),a(e(J),null,{default:s(()=>[...c[19]||(c[19]=[d("Estado",-1)])]),_:1}),a(e(J),null,{default:s(()=>[...c[20]||(c[20]=[d("Fecha Envío",-1)])]),_:1}),ie.value?(o(),g(e(J),{key:0},{default:s(()=>[...c[21]||(c[21]=[d("Apertura",-1)])]),_:1})):x("",!0),ie.value?(o(),g(e(J),{key:1},{default:s(()=>[...c[22]||(c[22]=[d("Clicks",-1)])]),_:1})):x("",!0)]),_:1})]),_:1}),a(e(qe),null,{default:s(()=>[(o(!0),p(U,null,ee(i.value.data,v=>(o(),p(U,{key:v.id},[a(e(ve),{onClick:D=>_(v.id),class:"cursor-pointer hover:bg-muted/50 transition-colors"},{default:s(()=>[a(e(X),null,{default:s(()=>[a(e(L),{variant:v.tipo==="email"?"default":"secondary",class:"text-xs"},{default:s(()=>[v.tipo==="email"?(o(),g(e(le),{key:0,class:"w-3 h-3 mr-1"})):v.tipo==="whatsapp_group"?(o(),g(e(ae),{key:1,class:"w-3 h-3 mr-1"})):(o(),g(e(oe),{key:2,class:"w-3 h-3 mr-1"})),d(" "+l(v.tipo==="email"?"Email":v.tipo==="whatsapp_group"?"Grupo":"WA"),1)]),_:2},1032,["variant"])]),_:2},1024),a(e(X),null,{default:s(()=>[t("div",Ts,[E.value.includes(v.id)?(o(),g(e(ot),{key:1,class:"w-4 h-4 flex-shrink-0"})):(o(),g(e(dt),{key:0,class:"w-4 h-4 flex-shrink-0"})),v.user?(o(),p("div",Rs,[t("div",Ss,l(v.user.nombre),1),t("div",Fs,l(v.user.email||v.destinatario),1)])):v.grupo?(o(),p("div",Is,[t("div",null,[t("div",Ls,l(v.grupo.nombre),1),t("div",Ps,l(v.grupo.participantes)+" participantes ",1)])])):(o(),p("div",zs,[t("div",Vs,l(v.destinatario),1)]))])]),_:2},1024),a(e(X),null,{default:s(()=>[a(e(L),{variant:N(v.estado)},{default:s(()=>[d(l(v.estado),1)]),_:2},1032,["variant"])]),_:2},1024),a(e(X),null,{default:s(()=>[d(l(b(v.fecha_enviado)),1)]),_:2},1024),ie.value?(o(),g(e(X),{key:0},{default:s(()=>[v.tipo==="email"?(o(),p(U,{key:0},[v.fecha_abierto?(o(),p("div",Ws,[a(e(ue),{class:"w-3 h-3"}),d(" "+l(Y(v.fecha_abierto))+" ",1),v.aperturas_count&&v.aperturas_count>1?(o(),g(e(L),{key:0,variant:"secondary",class:"ml-1"},{default:s(()=>[d(l(v.aperturas_count),1)]),_:2},1024)):x("",!0)])):(o(),p("span",Ns,"-"))],64)):(o(),p("span",Us,"N/A"))]),_:2},1024)):x("",!0),ie.value?(o(),g(e(X),{key:1},{default:s(()=>[v.tipo==="email"?(o(),p(U,{key:0},[v.fecha_primer_click?(o(),p("div",Gs,[a(e(Ce),{class:"w-3 h-3"}),d(" "+l(Y(v.fecha_primer_click))+" ",1),v.clicks_count&&v.clicks_count>1?(o(),g(e(L),{key:0,variant:"secondary",class:"ml-1"},{default:s(()=>[d(l(v.clicks_count),1)]),_:2},1024)):x("",!0)])):(o(),p("span",Bs,"-"))],64)):(o(),p("span",Hs,"N/A"))]),_:2},1024)):x("",!0)]),_:2},1032,["onClick"]),E.value.includes(v.id)?(o(),g(e(ve),{key:0},{default:s(()=>[a(e(X),{colspan:ie.value?6:4,class:"p-0"},{default:s(()=>{var D,I,f,Z;return[t("div",Os,[v.tipo==="email"?(o(),g(e(je),{key:0,"default-value":"aperturas",class:"w-full"},{default:s(()=>[a(e(Me),{class:"grid w-full max-w-md grid-cols-2"},{default:s(()=>[a(e(te),{value:"aperturas"},{default:s(()=>[a(e(ue),{class:"w-4 h-4 mr-2"}),d(" Aperturas "+l(v.aperturas_count?`(${v.aperturas_count})`:""),1)]),_:2},1024),a(e(te),{value:"clics"},{default:s(()=>[a(e(Ce),{class:"w-4 h-4 mr-2"}),d(" Clics "+l(v.clicks_count?`(${v.clicks_count})`:""),1)]),_:2},1024)]),_:2},1024),a(e(se),{value:"aperturas",class:"mt-4"},{default:s(()=>{var V,P;return[(P=(V=v.metadata)==null?void 0:V.aperturas)!=null&&P.length?(o(),p("div",qs,[c[23]||(c[23]=t("div",{class:"text-sm font-medium mb-2"},"Historial de aperturas:",-1)),(o(!0),p(U,null,ee(v.metadata.aperturas,(q,ne)=>(o(),p("div",{key:ne,class:"flex items-center gap-2 text-sm p-2 bg-background rounded"},[a(e(ue),{class:"w-3 h-3 text-muted-foreground"}),t("span",null,l(b(q.timestamp)),1),t("span",Xs,l(q.ip),1)]))),128))])):(o(),p("div",Ks," No hay registros de apertura "))]}),_:2},1024),a(e(se),{value:"clics",class:"mt-4"},{default:s(()=>{var V,P,q,ne,Te,Re,Se,Fe;return[(P=(V=v.metadata)==null?void 0:V.clicks)!=null&&P.length||(ne=(q=v.metadata)==null?void 0:q.clicks_detail)!=null&&ne.length?(o(),p("div",Js,[c[24]||(c[24]=t("div",{class:"text-sm font-medium mb-2"},"Historial de clics:",-1)),(Re=(Te=v.metadata)==null?void 0:Te.clicks_detail)!=null&&Re.length?(o(),p("div",Qs,[(o(!0),p(U,null,ee(v.metadata.clicks_detail,(re,we)=>(o(),p("div",{key:`click-${we}`,class:"p-2 bg-background rounded space-y-1"},[t("div",Ys,[a(e(Ue),{class:"w-3 h-3 text-muted-foreground"}),t("span",Zs,l(b(re.clicked_at)),1)]),t("div",el,[t("div",tl,"URL: "+l(re.url),1),re.ip?(o(),p("div",al,"IP: "+l(re.ip),1)):x("",!0)])]))),128))])):(Fe=(Se=v.metadata)==null?void 0:Se.clicks)!=null&&Fe.length?(o(),p("div",sl,[(o(!0),p(U,null,ee(v.metadata.clicks,(re,we)=>(o(),p("div",{key:`click-${we}`,class:"p-2 bg-background rounded space-y-1"},[t("div",ll,[a(e(Ue),{class:"w-3 h-3 text-muted-foreground"}),t("span",ol,l(b(re.timestamp)),1)]),t("div",il,[t("div",nl,"URL: "+l(re.url),1)])]))),128))])):x("",!0)])):(o(),p("div",rl," No hay registros de clics "))]}),_:2},1024)]),_:2},1024)):v.tipo==="whatsapp_group"?(o(),p("div",dl,[c[28]||(c[28]=t("div",{class:"text-sm font-medium"},"Información del Grupo",-1)),t("div",ul,[t("div",null,[c[25]||(c[25]=t("span",{class:"text-muted-foreground"},"Nombre:",-1)),t("span",cl,l(((D=v.grupo)==null?void 0:D.nombre)||((I=v.metadata)==null?void 0:I.group_nombre)||"N/A"),1)]),t("div",null,[c[26]||(c[26]=t("span",{class:"text-muted-foreground"},"Participantes:",-1)),t("span",ml,l(((f=v.grupo)==null?void 0:f.participantes)||((Z=v.metadata)==null?void 0:Z.group_participantes)||"N/A"),1)]),t("div",fl,[c[27]||(c[27]=t("span",{class:"text-muted-foreground"},"JID:",-1)),t("code",pl,l(v.destinatario),1)])]),c[29]||(c[29]=t("div",{class:"text-xs text-muted-foreground mt-2"}," WhatsApp no soporta tracking de aperturas ni clics para grupos. ",-1))])):(o(),p("div",vl,[c[32]||(c[32]=t("div",{class:"text-sm font-medium"},"Información del Envío",-1)),t("div",_l,[t("div",null,[c[30]||(c[30]=t("span",{class:"text-muted-foreground"},"Destinatario:",-1)),t("span",xl,l(v.destinatario),1)]),t("div",null,[c[31]||(c[31]=t("span",{class:"text-muted-foreground"},"Estado:",-1)),t("span",gl,l(v.estado),1)])]),v.error?(o(),p("div",hl," Error: "+l(v.error),1)):x("",!0),c[33]||(c[33]=t("div",{class:"text-xs text-muted-foreground mt-2"}," WhatsApp no soporta tracking de aperturas ni clics. ",-1))]))])]}),_:2},1032,["colspan"])]),_:2},1024)):x("",!0)],64))),128))]),_:1})]),_:1}),t("div",yl,[t("div",wl," Mostrando "+l(i.value.from||0)+" a "+l(i.value.to||0)+" de "+l(i.value.total)+" resultados ",1),i.value.links&&i.value.links.length>3?(o(),p("div",$l,[(o(!0),p(U,null,ee(i.value.links,v=>(o(),p(U,{key:v.label},[v.url?(o(),g(e(z),{key:0,variant:v.active?"default":"outline",size:"sm",onClick:D=>k(v.url),innerHTML:v.label.replace("« Previous","← Anterior").replace("Next »","Siguiente →")},null,8,["variant","onClick","innerHTML"])):(o(),p("span",{key:1,class:"px-3 py-1 text-sm text-muted-foreground cursor-not-allowed",innerHTML:v.label.replace("« Previous","← Anterior").replace("Next »","Siguiente →")},null,8,kl))],64))),128))])):x("",!0)])])):x("",!0)]),_:1})]),_:1}))}}),El={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Cl={class:"flex justify-between items-start"},Al={class:"flex items-center gap-3"},jl={class:"text-3xl font-bold"},Ml={key:0,class:"flex items-center gap-1 text-xs"},Dl={key:0,class:"text-muted-foreground mt-1"},Tl={class:"flex items-center gap-4 mt-2 text-sm text-muted-foreground flex-wrap"},Rl={class:"flex items-center gap-1"},Sl={class:"capitalize"},Fl={key:0,class:"flex items-center gap-1"},Il={key:1,class:"flex items-center gap-1"},Ll={key:2,class:"flex items-center gap-1"},Pl={key:3,class:"flex items-center gap-1"},zl={class:"flex items-center gap-1 text-xs"},Vl={class:"flex gap-2"},Wl={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Nl={class:"flex justify-between"},Ul={class:"flex justify-between"},Gl={key:0,class:"flex justify-between"},Bl={key:1,class:"flex justify-between"},Hl={key:2,class:"flex justify-between"},Ol={key:0},ql={class:"flex items-center gap-2 mb-1"},Xl={class:"pl-6 text-sm"},Kl={class:"text-muted-foreground"},Jl={key:1},Ql={class:"flex items-center gap-2 mb-1"},Yl={class:"pl-6 text-sm"},Zl={class:"flex items-center justify-between"},eo={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},to={class:"flex items-center gap-2"},ao={class:"font-medium truncate"},so={class:"mt-3 pt-3 border-t text-sm text-muted-foreground"},lo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oo={key:0},io={class:"font-medium"},no={key:1},ro={class:"font-medium"},uo={key:2},co={class:"font-medium"},mo={key:3},fo={class:"font-medium"},Ge=3,Ci=xe({__name:"Show",props:{campana:{},metricas:{},comparacion:{},tendencias:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canPause:{type:Boolean},canResume:{type:Boolean},canCancel:{type:Boolean}},setup(u){const C=u,i=S(C.campana),h=S(C.metricas),F=S(C.comparacion),E=S(C.tendencias),r=[{title:"Admin",href:"/admin/dashboard"},{title:"Campañas",href:"/admin/envio-campanas"},{title:i.value.nombre,href:"#"}],n=S("resumen"),m=S(!1);let y=null;const w=S(!0),A=S(5e3),R=S(new Date),j=Q(()=>{const I=h.value.total_destinatarios||1,f=h.value.total_enviados||0,Z=Math.round(f/I*100);return Math.min(Z,100)}),M=I=>({borrador:"secondary",programada:"outline",enviando:"default",completada:"default",pausada:"warning",cancelada:"destructive"})[I]||"secondary",T=I=>I==="email"?le:I==="whatsapp"?oe:vt,k=()=>{ce.post(`/admin/envio-campanas/${i.value.id}/send`,{},{onSuccess:()=>{W.success("Campaña iniciada exitosamente"),i.value.estado="enviando",c(),N()},onError:()=>{W.error("Error al iniciar la campaña")}})},_=()=>{ce.post(`/admin/envio-campanas/${i.value.id}/pause`,{},{onSuccess:()=>{W.success("Campaña pausada"),i.value.estado="pausada",N()},onError:()=>{W.error("Error al pausar la campaña")}})},b=()=>{ce.post(`/admin/envio-campanas/${i.value.id}/resume`,{},{onSuccess:()=>{W.success("Campaña reanudada"),i.value.estado="enviando",c(),N()},onError:()=>{W.error("Error al reanudar la campaña")}})},Y=()=>{confirm("¿Estás seguro de cancelar esta campaña? Esta acción no se puede deshacer.")&&ce.post(`/admin/envio-campanas/${i.value.id}/cancel`,{},{onSuccess:()=>{W.success("Campaña cancelada"),i.value.estado="cancelada",v(),N()},onError:()=>{W.error("Error al cancelar la campaña")}})},N=async()=>{if(!m.value){m.value=!0;try{const I=await fetch(`/admin/envio-campanas/${i.value.id}/metrics`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!I.ok)throw new Error(`HTTP error! status: ${I.status}`);const f=await I.json();if(f.success){f.metricas&&(h.value={...h.value,...f.metricas}),f.estado&&(i.value.estado=f.estado),f.progreso,R.value=new Date;const Z=f.estado==="completada"&&h.value.total_enviados>=h.value.total_destinatarios,V=f.estado==="cancelada";Z||V?(v(),Z?W.success("¡Campaña completada exitosamente! 🎉"):V&&W.info("Campaña cancelada. Auto-actualización detenida.")):f.estado==="completada"&&j.value<100&&console.warn("[CampanaMetrics] Estado completada pero progreso incompleto, continuando actualización...")}}catch(I){console.error("Error refreshing metrics:",I),w.value||W.error("Error al actualizar métricas")}finally{m.value=!1}}},ie=()=>{ce.post(`/admin/envio-campanas/${i.value.id}/export`,{formato:"excel",incluir_detalles:!0},{onSuccess:()=>{W.success("Reporte exportado exitosamente")},onError:()=>{W.error("Error al exportar el reporte")}})};let $=0;const c=()=>{y&&clearInterval(y);let I=A.value;i.value.estado==="enviando"?I=2e3:i.value.estado==="programada"&&(I=5e3),y=setInterval(()=>{w.value&&N().catch(f=>{$++,console.error("[AutoRefresh] Error consecutivo",$,"de",Ge),$>=Ge&&(console.error("[AutoRefresh] Demasiados errores consecutivos, deteniendo auto-refresh"),v(),W.error('Auto-actualización detenida por errores. Haz clic en "Auto OFF" para reactivar.'))}).then(()=>{$>0&&($=0)})},I),w.value=!0,$=0},v=()=>{y&&(clearInterval(y),y=null),w.value=!1,$=0},D=()=>{w.value?(v(),W.info("Auto-actualización detenida")):(c(),W.success("Auto-actualización activada"),N())};return De(()=>{["enviando","programada","pausada"].includes(i.value.estado)&&c(),setTimeout(()=>{N()},1e3)}),Qe(()=>{v()}),(I,f)=>(o(),g(Xe,{breadcrumbs:r},{default:s(()=>{var Z;return[a(e(Ye),{title:`Campaña: ${i.value.nombre}`},null,8,["title"]),t("div",El,[t("div",Cl,[t("div",null,[t("div",Al,[t("h1",jl,l(i.value.nombre),1),a(e(L),{variant:M(i.value.estado),class:"text-sm"},{default:s(()=>[d(l(i.value.estado),1)]),_:1},8,["variant"]),w.value?(o(),p("div",Ml,[...f[1]||(f[1]=[t("div",{class:"w-2 h-2 bg-green-500 rounded-full animate-pulse"},null,-1),t("span",{class:"text-muted-foreground"},"Actualizando...",-1)])])):x("",!0)]),i.value.descripcion?(o(),p("p",Dl,l(i.value.descripcion),1)):x("",!0),t("div",Tl,[t("div",Rl,[(o(),g(fe(T(i.value.tipo)),{class:"w-4 h-4"})),t("span",Sl,l(i.value.tipo),1)]),i.value.tipo!=="email"&&i.value.whatsapp_mode?(o(),p("div",Fl,[a(e(L),{variant:"outline",class:"text-xs"},{default:s(()=>[d(l(i.value.whatsapp_mode==="grupos"?"Solo Grupos":i.value.whatsapp_mode==="mixto"?"Mixto":"Individual"),1)]),_:1})])):x("",!0),(Z=i.value.whatsapp_groups)!=null&&Z.length?(o(),p("div",Il,[a(e(ae),{class:"w-4 h-4 text-green-600"}),t("span",null,l(i.value.whatsapp_groups.length)+" grupo(s)",1)])):x("",!0),i.value.segment?(o(),p("div",Ll,[a(e(ae),{class:"w-4 h-4"}),t("span",null,l(i.value.segment.name),1)])):x("",!0),i.value.fecha_programada?(o(),p("div",Pl,[a(e(ut),{class:"w-4 h-4"}),t("span",null,l(i.value.fecha_programada?new Date(i.value.fecha_programada).toLocaleString("es-ES"):"-"),1)])):x("",!0),t("div",zl,[a(e(pe),{class:"w-3 h-3"}),t("span",null,"Actualizado: "+l(R.value.toLocaleTimeString("es-ES")),1)])])]),t("div",Vl,[a(e(Le),{href:"/admin/envio-campanas"},{default:s(()=>[a(e(z),{variant:"outline"},{default:s(()=>[a(e(ct),{class:"w-4 h-4 mr-2"}),f[2]||(f[2]=d(" Volver ",-1))]),_:1})]),_:1}),a(e(z),{onClick:D,variant:"outline",class:K({"border-green-500":w.value})},{default:s(()=>[a(e(he),{class:K(["w-4 h-4 mr-2",{"animate-spin":m.value}])},null,8,["class"]),d(" "+l(w.value?"Auto ON":"Auto OFF"),1)]),_:1},8,["class"]),u.canEdit&&i.value.estado==="borrador"?(o(),g(e(Le),{key:0,href:`/admin/envio-campanas/${i.value.id}/edit`},{default:s(()=>[a(e(z),{variant:"outline"},{default:s(()=>[a(e(mt),{class:"w-4 h-4 mr-2"}),f[3]||(f[3]=d(" Editar ",-1))]),_:1})]),_:1},8,["href"])):x("",!0),i.value.estado==="borrador"?(o(),g(e(z),{key:1,onClick:k,variant:"default"},{default:s(()=>[a(e(Ne),{class:"w-4 h-4 mr-2"}),f[4]||(f[4]=d(" Iniciar Envío ",-1))]),_:1})):x("",!0),u.canPause&&i.value.estado==="enviando"?(o(),g(e(z),{key:2,onClick:_,variant:"warning"},{default:s(()=>[a(e(ft),{class:"w-4 h-4 mr-2"}),f[5]||(f[5]=d(" Pausar ",-1))]),_:1})):x("",!0),u.canResume&&i.value.estado==="pausada"?(o(),g(e(z),{key:3,onClick:b,variant:"default"},{default:s(()=>[a(e(Ne),{class:"w-4 h-4 mr-2"}),f[6]||(f[6]=d(" Reanudar ",-1))]),_:1})):x("",!0),u.canCancel&&["borrador","programada","pausada"].includes(i.value.estado)?(o(),g(e(z),{key:4,onClick:Y,variant:"destructive"},{default:s(()=>[a(e(ye),{class:"w-4 h-4 mr-2"}),f[7]||(f[7]=d(" Cancelar ",-1))]),_:1})):x("",!0),a(e(z),{onClick:ie,variant:"outline"},{default:s(()=>[a(e(pt),{class:"w-4 h-4 mr-2"}),f[8]||(f[8]=d(" Exportar ",-1))]),_:1})])]),["enviando","completada","pausada"].includes(i.value.estado)?(o(),g(Ja,{key:0,progreso:j.value,total:h.value.total_destinatarios,enviados:h.value.total_enviados,pendientes:h.value.total_pendientes,fallidos:h.value.total_fallidos,estado:i.value.estado,"fecha-inicio":i.value.fecha_inicio},null,8,["progreso","total","enviados","pendientes","fallidos","estado","fecha-inicio"])):x("",!0),a(ya,{metrics:h.value,comparison:F.value,tipo:i.value.tipo,"whatsapp-mode":i.value.whatsapp_mode},null,8,["metrics","comparison","tipo","whatsapp-mode"]),a(e(je),{modelValue:n.value,"onUpdate:modelValue":f[0]||(f[0]=V=>n.value=V)},{default:s(()=>[a(e(Me),null,{default:s(()=>[a(e(te),{value:"resumen"},{default:s(()=>[...f[9]||(f[9]=[d("Resumen",-1)])]),_:1}),a(e(te),{value:"actividad"},{default:s(()=>[...f[10]||(f[10]=[d("Actividad Reciente",-1)])]),_:1}),a(e(te),{value:"logs"},{default:s(()=>[...f[11]||(f[11]=[d("Logs",-1)])]),_:1}),E.value&&E.value.length>0?(o(),g(e(te),{key:0,value:"tendencias"},{default:s(()=>[...f[12]||(f[12]=[d(" Tendencias ",-1)])]),_:1})):x("",!0),a(e(te),{value:"configuracion"},{default:s(()=>[...f[13]||(f[13]=[d("Configuración",-1)])]),_:1})]),_:1}),a(e(se),{value:"resumen"},{default:s(()=>{var V;return[t("div",Wl,[a(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>[a(e(B),null,{default:s(()=>[...f[14]||(f[14]=[d("Información de la Campaña",-1)])]),_:1})]),_:1}),a(e(H),{class:"space-y-3"},{default:s(()=>{var P,q;return[t("div",Nl,[f[15]||(f[15]=t("span",{class:"text-muted-foreground"},"Creada por:",-1)),t("span",null,l(((P=i.value.created_by)==null?void 0:P.nombre)||((q=i.value.created_by)==null?void 0:q.name)||"Sistema"),1)]),t("div",Ul,[f[16]||(f[16]=t("span",{class:"text-muted-foreground"},"Fecha creación:",-1)),t("span",null,l(new Date(i.value.created_at).toLocaleDateString("es-ES")),1)]),i.value.fecha_inicio?(o(),p("div",Gl,[f[17]||(f[17]=t("span",{class:"text-muted-foreground"},"Inicio envío:",-1)),t("span",null,l(i.value.fecha_inicio?new Date(i.value.fecha_inicio).toLocaleString("es-ES"):"-"),1)])):x("",!0),i.value.fecha_fin?(o(),p("div",Bl,[f[18]||(f[18]=t("span",{class:"text-muted-foreground"},"Fin envío:",-1)),t("span",null,l(i.value.fecha_fin?new Date(i.value.fecha_fin).toLocaleString("es-ES"):"-"),1)])):x("",!0),h.value.tiempo_promedio_envio?(o(),p("div",Hl,[f[19]||(f[19]=t("span",{class:"text-muted-foreground"},"Tiempo promedio:",-1)),t("span",null,l(h.value.tiempo_promedio_envio)+"s por envío",1)])):x("",!0)]}),_:1})]),_:1}),a(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>[a(e(B),null,{default:s(()=>[...f[20]||(f[20]=[d("Plantillas Utilizadas",-1)])]),_:1})]),_:1}),a(e(H),{class:"space-y-3"},{default:s(()=>[i.value.plantilla_email?(o(),p("div",Ol,[t("div",ql,[a(e(le),{class:"w-4 h-4 text-muted-foreground"}),f[21]||(f[21]=t("span",{class:"font-medium"},"Email:",-1))]),t("div",Xl,[t("div",null,l(i.value.plantilla_email.nombre),1),t("div",Kl," Asunto: "+l(i.value.plantilla_email.asunto),1)])])):x("",!0),i.value.plantilla_whats_app?(o(),p("div",Jl,[t("div",Ql,[a(e(oe),{class:"w-4 h-4 text-muted-foreground"}),f[22]||(f[22]=t("span",{class:"font-medium"},"WhatsApp:",-1))]),t("div",Yl,l(i.value.plantilla_whats_app.nombre),1)])):x("",!0)]),_:1})]),_:1}),(V=i.value.whatsapp_groups)!=null&&V.length?(o(),g(e(O),{key:0,class:"md:col-span-2"},{default:s(()=>[a(e(G),null,{default:s(()=>[t("div",Zl,[a(e(B),null,{default:s(()=>[...f[23]||(f[23]=[d("Grupos de WhatsApp",-1)])]),_:1}),a(e(L),{variant:"outline"},{default:s(()=>[d(" Modo: "+l(i.value.whatsapp_mode==="grupos"?"Solo Grupos":i.value.whatsapp_mode==="mixto"?"Mixto":"Individual"),1)]),_:1})])]),_:1}),a(e(H),null,{default:s(()=>[t("div",eo,[(o(!0),p(U,null,ee(i.value.whatsapp_groups,P=>(o(),p("div",{key:P.id,class:"flex items-center justify-between p-3 bg-muted/50 rounded-lg"},[t("div",to,[a(e(ae),{class:"w-4 h-4 text-green-600 flex-shrink-0"}),t("span",ao,l(P.nombre),1)]),a(e(L),{variant:"secondary",class:"flex-shrink-0"},{default:s(()=>[d(l(P.participantes_count)+" participantes ",1)]),_:2},1024)]))),128))]),t("div",so," Total: "+l(i.value.whatsapp_groups.length)+" grupo(s) • "+l(i.value.whatsapp_groups.reduce((P,q)=>P+(q.participantes_count||0),0))+" participantes ",1)]),_:1})]),_:1})):x("",!0)])]}),_:1}),a(e(se),{value:"actividad"},{default:s(()=>[a(bl,{"campana-id":i.value.id,tipo:i.value.tipo},null,8,["campana-id","tipo"])]),_:1}),a(e(se),{value:"logs"},{default:s(()=>[a(ys,{"campana-id":i.value.id,tipo:i.value.tipo},null,8,["campana-id","tipo"])]),_:1}),a(e(se),{value:"configuracion"},{default:s(()=>[a(e(O),null,{default:s(()=>[a(e(G),null,{default:s(()=>[a(e(B),null,{default:s(()=>[...f[24]||(f[24]=[d("Configuración de Envío",-1)])]),_:1})]),_:1}),a(e(H),null,{default:s(()=>{var V,P,q,ne;return[t("div",lo,[(V=i.value.configuracion)!=null&&V.batch_size_email?(o(),p("div",oo,[f[25]||(f[25]=t("div",{class:"text-sm text-muted-foreground"},"Tamaño de lote (Email)",-1)),t("div",io,l(i.value.configuracion.batch_size_email)+" emails/lote",1)])):x("",!0),(P=i.value.configuracion)!=null&&P.batch_size_whatsapp?(o(),p("div",no,[f[26]||(f[26]=t("div",{class:"text-sm text-muted-foreground"},"Tamaño de lote (WhatsApp)",-1)),t("div",ro,l(i.value.configuracion.batch_size_whatsapp)+" mensajes/lote",1)])):x("",!0),((q=i.value.configuracion)==null?void 0:q.enable_pixel_tracking)!==void 0?(o(),p("div",uo,[f[27]||(f[27]=t("div",{class:"text-sm text-muted-foreground"},"Tracking de apertura",-1)),t("div",co,l(i.value.configuracion.enable_pixel_tracking?"Habilitado":"Deshabilitado"),1)])):x("",!0),((ne=i.value.configuracion)==null?void 0:ne.enable_click_tracking)!==void 0?(o(),p("div",mo,[f[28]||(f[28]=t("div",{class:"text-sm text-muted-foreground"},"Tracking de clicks",-1)),t("div",fo,l(i.value.configuracion.enable_click_tracking?"Habilitado":"Deshabilitado"),1)])):x("",!0)])]}),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]}),_:1}))}});export{Ci as default};
