import{_ as D}from"./index-RIp_-Vk5.js";import{_ as g}from"./createLucideIcon-BZexDsQJ.js";import{_ as J,c as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-ouwQQD5O.js";import{_ as Q}from"./Switch.vue_vue_type_script_setup_true_lang-ls8b85OI.js";import{_ as R,a as K,b as x,c as v,d as X,e as c}from"./TableHeader.vue_vue_type_script_setup_true_lang-DZJR0ydD.js";import{_ as y,a as k,b as $,c as C,d as w,e as z,f as S,g as E}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DwNtZ1tk.js";import{_ as F}from"./AlertDialogTrigger.vue_vue_type_script_setup_true_lang-C2DyrxZK.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DhCpEapD.js";import{d as Z,c as ee,a as m,o as n,b as t,u as e,m as te,e as a,f as r,j as _,i as f,P as L,g as l,F as V,r as N,t as d,n as ae,W as b}from"./app-adm4E9By.js";import{_ as se}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-CjwwUi8S.js";import{P as oe}from"./plus-mxdiJDdT.js";import{U as le}from"./users-DZL9w0oY.js";import{F as ie}from"./file-text-8gYHGT8o.js";import{C as ne}from"./chart-column-DjoQQOuY.js";import{S as re}from"./square-pen-CM0Ceg7g.js";import{T as de}from"./trash-2-DB0L4lLl.js";import"./index-BljgFSoA.js";import"./VisuallyHidden-CHziw9t0.js";import"./Input.vue_vue_type_script_setup_true_lang-DPeax23E.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-COAsKRo-.js";import"./check-7dEyZjxo.js";import"./floating-ui.vue-CHVdCOHU.js";import"./VisuallyHiddenInput-DAllJD5K.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CUlOaAYK.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-CYAfzaIu.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-CwctApMP.js";import"./index-D_FvUGWk.js";import"./shield-BA_mSgwr.js";import"./user-9gw01jjs.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Dt3CXXnZ.js";import"./Label.vue_vue_type_script_setup_true_lang-U1PsHnlq.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Dk5CULeb.js";import"./index-C3hFIBGF.js";import"./circle-alert-DH-tXgXk.js";import"./map-pin-BDFPWgVN.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DJj5orOZ.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CUrUy-W4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-HPS1mOzq.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-B2K2P9ZP.js";import"./vote-tpsNvE_M.js";import"./calendar-W5yOTorW.js";import"./briefcase-CsGy18Yk.js";import"./megaphone-CGlNxhdi.js";import"./user-check-xz8sJqrM.js";import"./external-link-CDS4yhn-.js";import"./panel-left-s67SQ0O6.js";import"./index-DB-wCrKJ.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-Bq7NmKO-.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CfQmYURr.js";import"./es-DfN3vIXC.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-BquL-eJU.js";import"./loader-circle-VzOlCmBW.js";import"./search-Bc7_Mqt5.js";import"./history-hGl6O7xl.js";import"./save-D8PnxFU9.js";const ue={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},fe={class:"flex items-center justify-between"},me={class:"relative min-h-[50vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border"},ce={class:"rounded-md border"},_e={class:"font-medium"},pe={key:0,class:"text-sm text-muted-foreground"},ve={class:"flex items-center gap-3"},ge={key:0,class:"flex items-center gap-2"},be={key:0,class:"text-xs text-orange-600 mr-2",title:"Asigna votantes antes de activar"},he={key:0},xe={key:1},ye={key:0,class:"text-orange-600 font-medium"},ke={class:"text-xs text-muted-foreground"},$e={key:1,class:"ml-2"},Ce={key:2,class:"text-xs text-muted-foreground"},we={class:"flex items-center gap-1"},ze={class:"flex justify-end gap-2"},Se={key:0,class:"flex items-center justify-between mt-4"},Ee={class:"text-sm text-muted-foreground"},Fe={class:"flex gap-2"},Bt=Z({__name:"Index",props:{votaciones:{},categorias:{},filters:{},filterFieldsConfig:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canManageVoters:{type:Boolean}},setup(T){const u=T,q=[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"}],M={fields:u.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por título o descripción...",quickSearchFields:["titulo","descripcion"],maxNestingLevel:2,allowSaveFilters:!0,debounceTime:500,autoApply:!1},P=i=>{b.get(`/admin/votaciones/${i}/imports`)},j=i=>{b.get(`/votaciones/${i}/resultados`)},{route:h}=window,I=ee(()=>({quickSearch:u.filters.search,rootGroup:u.filters.advanced_filters?JSON.parse(u.filters.advanced_filters):void 0})),G=i=>{b.delete(`/admin/votaciones/${i}`,{onSuccess:()=>{}})},H=i=>{const o=i.estado==="borrador"?"activa":"borrador";b.post(h("admin.votaciones.toggle-status",i.id),{estado:o},{preserveScroll:!0,onSuccess:()=>{},onError:s=>{console.error("Error toggling status:",s),s!=null&&s.message&&alert(s.message)}})},U=i=>{b.post(h("admin.votaciones.toggle-status",i.id),{estado:"finalizada"},{preserveScroll:!0,onSuccess:()=>{},onError:o=>{console.error("Error finalizando votación:",o),o!=null&&o.message&&alert(o.message)}})},W=i=>{switch(i){case"borrador":return"secondary";case"activa":return"default";case"finalizada":return"outline";default:return"secondary"}},A=i=>new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(i,o)=>(n(),m(V,null,[t(e(te),{title:"Gestión de Votaciones"}),t(Y,{breadcrumbs:q},{default:a(()=>[r("div",ue,[r("div",fe,[o[1]||(o[1]=r("div",null,[r("h1",{class:"text-3xl font-bold"},"Gestión de Votaciones"),r("p",{class:"text-muted-foreground"}," Administra todas las votaciones del sistema ")],-1)),i.canCreate?(n(),_(e(g),{key:0,"as-child":""},{default:a(()=>[t(e(L),{href:e(h)("admin.votaciones.create")},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),o[0]||(o[0]=l(" Nueva Votación "))]),_:1},8,["href"])]),_:1})):f("",!0)]),t(se,{config:M,route:e(h)("admin.votaciones.index"),"initial-filters":I.value},null,8,["route","initial-filters"]),r("div",me,[t(e(J),{class:"border-0 shadow-none h-full"},{default:a(()=>[t(e(O),{class:"pt-6"},{default:a(()=>[r("div",ce,[t(e(R),null,{default:a(()=>[t(e(K),null,{default:a(()=>[t(e(x),null,{default:a(()=>[t(e(v),null,{default:a(()=>o[2]||(o[2]=[l("Título")])),_:1}),t(e(v),null,{default:a(()=>o[3]||(o[3]=[l("Categoría")])),_:1}),t(e(v),null,{default:a(()=>o[4]||(o[4]=[l("Estado")])),_:1}),t(e(v),null,{default:a(()=>o[5]||(o[5]=[l("Activar/Desactivar")])),_:1}),t(e(v),null,{default:a(()=>o[6]||(o[6]=[l("Fecha Inicio")])),_:1}),t(e(v),null,{default:a(()=>o[7]||(o[7]=[l("Fecha Fin")])),_:1}),t(e(v),null,{default:a(()=>o[8]||(o[8]=[l("Votantes")])),_:1}),t(e(v),{class:"text-right"},{default:a(()=>o[9]||(o[9]=[l("Acciones")])),_:1})]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[u.votaciones.data.length===0?(n(),_(e(x),{key:0},{default:a(()=>[t(e(c),{colspan:8,class:"text-center py-8 text-muted-foreground"},{default:a(()=>o[10]||(o[10]=[l(" No se encontraron votaciones ")])),_:1})]),_:1})):f("",!0),(n(!0),m(V,null,N(u.votaciones.data,s=>(n(),_(e(x),{key:s.id},{default:a(()=>[t(e(c),null,{default:a(()=>{var p,B;return[r("div",null,[r("p",_e,d(s.titulo),1),s.descripcion?(n(),m("p",pe,d((p=s.descripcion)==null?void 0:p.substring(0,60))+d(((B=s.descripcion)==null?void 0:B.length)>60?"...":""),1)):f("",!0)])]}),_:2},1024),t(e(c),null,{default:a(()=>[t(e(D),{variant:"outline"},{default:a(()=>[l(d(s.categoria.nombre),1)]),_:2},1024)]),_:2},1024),t(e(c),null,{default:a(()=>[t(e(D),{variant:W(s.estado)},{default:a(()=>[l(d(s.estado),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(c),null,{default:a(()=>[r("div",ve,[s.estado!=="finalizada"?(n(),m("div",ge,[s.estado==="borrador"&&(!s.votantes_count||s.votantes_count===0)?(n(),m("div",be," ⚠️ Sin votantes ")):f("",!0),i.canEdit?(n(),_(e(y),{key:1},{default:a(()=>[t(e(F),{"as-child":""},{default:a(()=>[t(e(Q),{checked:s.estado==="activa",disabled:!1},null,8,["checked"])]),_:2},1024),t(e(k),null,{default:a(()=>[t(e($),null,{default:a(()=>[t(e(C),null,{default:a(()=>[l(d(s.estado==="activa"?"Desactivar votación":"Activar votación"),1)]),_:2},1024),t(e(w),null,{default:a(()=>[s.estado==="activa"?(n(),m("span",he,' La votación "'+d(s.titulo)+'" será desactivada y volverá al estado borrador. Los votantes no podrán acceder hasta que la actives nuevamente. ',1)):(n(),m("span",xe,[!s.votantes_count||s.votantes_count===0?(n(),m("span",ye,o[11]||(o[11]=[l(" ⚠️ Advertencia: Esta votación no tiene votantes asignados. Debes asignar votantes antes de poder activarla. "),r("br",null,null,-1),r("br",null,null,-1)]))):f("",!0),l(' La votación "'+d(s.titulo)+'" será activada y los votantes podrán empezar a votar. Asegúrate de que la configuración esté completa. ',1)]))]),_:2},1024)]),_:2},1024),t(e(z),null,{default:a(()=>[t(e(S),null,{default:a(()=>o[12]||(o[12]=[l("Cancelar")])),_:1}),t(e(E),{onClick:p=>H(s),class:ae((!s.votantes_count||s.votantes_count===0)&&s.estado==="borrador"?"bg-orange-600 hover:bg-orange-700":"")},{default:a(()=>[l(d(s.estado==="activa"?"Desactivar":"Activar"),1)]),_:2},1032,["onClick","class"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):f("",!0),r("span",ke,d(s.estado==="activa"?"Activa":"Inactiva"),1)])):f("",!0),s.estado==="activa"&&i.canEdit?(n(),m("div",$e,[t(e(y),null,{default:a(()=>[t(e(F),{"as-child":""},{default:a(()=>[t(e(g),{variant:"outline",size:"sm",class:"text-orange-600 hover:text-orange-700"},{default:a(()=>o[13]||(o[13]=[l(" Finalizar ")])),_:1})]),_:1}),t(e(k),null,{default:a(()=>[t(e($),null,{default:a(()=>[t(e(C),null,{default:a(()=>o[14]||(o[14]=[l("Finalizar votación")])),_:1}),t(e(w),null,{default:a(()=>[l(' La votación "'+d(s.titulo)+'" será finalizada permanentemente. Esta acción no se puede deshacer y los votantes ya no podrán votar. ',1)]),_:2},1024)]),_:2},1024),t(e(z),null,{default:a(()=>[t(e(S),null,{default:a(()=>o[15]||(o[15]=[l("Cancelar")])),_:1}),t(e(E),{onClick:p=>U(s),class:"bg-orange-600 text-white hover:bg-orange-700"},{default:a(()=>o[16]||(o[16]=[l(" Finalizar ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])):f("",!0),s.estado==="finalizada"?(n(),m("div",Ce," Finalizada ")):f("",!0)])]),_:2},1024),t(e(c),null,{default:a(()=>[l(d(A(s.fecha_inicio)),1)]),_:2},1024),t(e(c),null,{default:a(()=>[l(d(A(s.fecha_fin)),1)]),_:2},1024),t(e(c),null,{default:a(()=>[r("div",we,[t(e(le),{class:"h-4 w-4 text-muted-foreground"}),r("span",null,d(s.votantes_count||0),1)])]),_:2},1024),t(e(c),{class:"text-right"},{default:a(()=>[r("div",ze,[i.canManageVoters?(n(),_(e(g),{key:0,variant:"ghost",size:"sm",onClick:p=>P(s.id),title:"Ver historial de importaciones"},{default:a(()=>[t(e(ie),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):f("",!0),s.resultados_publicos?(n(),_(e(g),{key:1,variant:"ghost",size:"sm",onClick:p=>j(s.id),title:"Ver resultados",class:"text-blue-600 hover:text-blue-700"},{default:a(()=>[t(e(ne),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):f("",!0),s.estado==="borrador"&&i.canEdit?(n(),_(e(g),{key:2,variant:"ghost",size:"sm","as-child":""},{default:a(()=>[t(e(L),{href:e(h)("admin.votaciones.edit",s.id)},{default:a(()=>[t(e(re),{class:"h-4 w-4"})]),_:2},1032,["href"])]),_:2},1024)):f("",!0),s.estado==="borrador"&&i.canDelete?(n(),_(e(y),{key:3},{default:a(()=>[t(e(F),{"as-child":""},{default:a(()=>[t(e(g),{variant:"ghost",size:"sm"},{default:a(()=>[t(e(de),{class:"h-4 w-4 text-destructive"})]),_:1})]),_:1}),t(e(k),null,{default:a(()=>[t(e($),null,{default:a(()=>[t(e(C),null,{default:a(()=>o[17]||(o[17]=[l("¿Eliminar votación?")])),_:1}),t(e(w),null,{default:a(()=>[l(' Esta acción no se puede deshacer. Se eliminará permanentemente la votación "'+d(s.titulo)+'" y todos sus datos asociados. ',1)]),_:2},1024)]),_:2},1024),t(e(z),null,{default:a(()=>[t(e(S),null,{default:a(()=>o[18]||(o[18]=[l("Cancelar")])),_:1}),t(e(E),{onClick:p=>G(s.id),class:"bg-destructive text-destructive-foreground hover:bg-destructive/90"},{default:a(()=>o[19]||(o[19]=[l(" Eliminar ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):f("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),u.votaciones.last_page>1?(n(),m("div",Se,[r("p",Ee," Mostrando "+d((u.votaciones.current_page-1)*u.votaciones.per_page+1)+" a "+d(Math.min(u.votaciones.current_page*u.votaciones.per_page,u.votaciones.total))+" de "+d(u.votaciones.total)+" resultados ",1),r("div",Fe,[(n(!0),m(V,null,N(u.votaciones.links,s=>(n(),_(e(g),{key:s.label,variant:s.active?"default":"outline",disabled:!s.url,size:"sm",onClick:p=>s.url&&e(b).get(s.url),innerHTML:s.label},null,8,["variant","disabled","onClick","innerHTML"]))),128))])])):f("",!0)]),_:1})]),_:1})])])]),_:1})],64))}});export{Bt as default};
