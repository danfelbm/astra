import{d as R,r as w,c as $,i as b,e as i,f as e,q as J,w as o,g as s,t as c,b as g,j as v,v as j,h as u,m,F as B,k as K,s as Q}from"./app-H5iGr2tD.js";import{_ as W}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BCAJiJwc.js";import{c as X,_ as F}from"./createLucideIcon-CkqZGnyd.js";import{_ as V,a as A,b as D,c as I}from"./CardTitle.vue_vue_type_script_setup_true_lang-Ciw19BiC.js";import{_ as Y}from"./CardDescription.vue_vue_type_script_setup_true_lang-CIWMbEaO.js";import{_ as M}from"./index-CVi_6vMd.js";import{_ as L}from"./Label.vue_vue_type_script_setup_true_lang-C-7cI9mo.js";import{_ as Z,a as tt,b as _,c as y}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BVivhsTx.js";import{_ as et}from"./AccordionContent.vue_vue_type_script_setup_true_lang-BaA9_cu_.js";import{_ as it}from"./EvidenciasTable.vue_vue_type_script_setup_true_lang-BHYQBidz.js";import{O as at}from"./ObligacionTree-Cq_tk7Aq.js";import{_ as ot,a as lt}from"./ActivityLog.vue_vue_type_script_setup_true_lang-d41UO77q.js";import{u as st}from"./usePermissions-CdJSNnfj.js";import{A as nt}from"./arrow-left-CGwtD0Oq.js";import{P as rt}from"./pencil-COXUnWg6.js";import{I as dt}from"./info-DRYXb4A3.js";import{I as ct}from"./image-BlwBd4ab.js";import{A as ut}from"./activity-C5nbs14N.js";import{P as mt}from"./paperclip-WA3y3p7H.js";import{f as P,e as S}from"./es-BDPlFIsO.js";import{p as N}from"./parseISO-DFjB8F03.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-C0zjsxb5.js";import"./index-Dp8cUT_u.js";import"./floating-ui.vue-CJ1L8zYV.js";import"./x-B2euRnbr.js";import"./Input.vue_vue_type_script_setup_true_lang-B1Lc6gQc.js";import"./index-Dcd21PRe.js";import"./index-BJx3gFlP.js";import"./shield-D98MIKS9.js";import"./user-D5H1w3fJ.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DYYECxPg.js";import"./chevron-right-BgdsT0dn.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CX-gld0c.js";import"./VisuallyHidden-DlItcrV_.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-CJYgGnBu.js";import"./check-B1h7EPWs.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-cwH8SYT4.js";import"./index-3G2vCCyX.js";import"./circle-alert-D9jIwQNH.js";import"./map-pin-DNMqy0_2.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Cc2yh2pz.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-pbIFYNm1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-BStAzKqx.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-B58itKTX.js";import"./tag-QU_AiBTS.js";import"./users-BC1UsjyQ.js";import"./target-DXJQ0YK7.js";import"./vote-BkUIub_U.js";import"./folder-open-DBOnHlH-.js";import"./send-DTvdQMKx.js";import"./file-text-y9clDDO_.js";import"./briefcase-B1VQAkF-.js";import"./calendar-0cFmYIMz.js";import"./megaphone-CNpY-fW7.js";import"./user-check-Bm0tBagc.js";import"./clipboard-list-BcNxqdsO.js";import"./mail-5ip0Aj74.js";import"./message-square-Di5ZRyL7.js";import"./external-link-C9mSBcmb.js";import"./panel-left-DDYMgNNA.js";import"./index-Cyuy9O1y.js";import"./RovingFocusItem-BSZTDC49.js";import"./utils-BflHrgZi.js";import"./useArrowNavigation-B5rxJs06.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-VUbk_Dvo.js";import"./download-D8zzSkOx.js";import"./Separator.vue_vue_type_script_setup_true_lang-DhSf1Ern.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-D8sEGxXI.js";import"./circle-C78S9bR6.js";import"./layers-hjQLogAg.js";import"./plus-CHHStuvJ.js";import"./trash-2-DpusxaTC.js";import"./loader-circle-D-PXcE-A.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BFu5yAJx.js";import"./filter-ld3FPJAJ.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=X("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),vt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},pt={class:"flex items-center justify-between"},gt={class:"text-3xl font-bold"},ht={class:"text-muted-foreground mt-2"},bt={class:"flex gap-2"},_t={class:"mt-1"},yt={class:"pt-4 border-t"},xt={class:"font-medium mt-1"},kt={class:"text-sm text-gray-600 mt-1"},wt={class:"pt-4 border-t space-y-3"},$t={class:"mt-1"},jt={class:"text-xs text-gray-500"},Vt={key:0},At={class:"mt-1"},Dt={class:"text-xs text-gray-500"},It={key:1},Mt={class:"mt-1"},Ct={class:"text-xs text-gray-500"},Et={class:"space-y-2"},Ht=["href"],ii=R({__name:"Show",props:{obligacion:{},contrato:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canCreateChild:{type:Boolean},actividades:{},usuariosActividades:{}},setup(a){const x=a,{hasPermission:T}=st(),C=w("general"),d=w({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null,entregable_id:null}),f=w({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),z=[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"},{title:x.obligacion.titulo}],h=$(()=>x.obligacion.evidencias||[]),U=$(()=>{let l=h.value;return d.value.tipo&&(l=l.filter(t=>t.tipo_evidencia===d.value.tipo)),d.value.estado&&(l=l.filter(t=>t.estado===d.value.estado)),d.value.usuario_id&&(l=l.filter(t=>{var r;return((r=t.usuario)==null?void 0:r.id)===d.value.usuario_id})),d.value.entregable_id&&(l=l.filter(t=>{var r;return(r=t.entregables)==null?void 0:r.some(n=>n.id===d.value.entregable_id)})),(d.value.fecha_inicio||d.value.fecha_fin)&&(l=l.filter(t=>{const r=new Date(t.created_at);if(d.value.fecha_inicio){const n=new Date(d.value.fecha_inicio);if(r<n)return!1}if(d.value.fecha_fin){const n=new Date(d.value.fecha_fin);if(n.setHours(23,59,59,999),r>n)return!1}return!0})),l}),q=$(()=>{let l=x.actividades||[];return f.value.usuario_id&&(l=l.filter(t=>{var r;return((r=t.causer)==null?void 0:r.id)===f.value.usuario_id})),f.value.tipo_accion&&(l=l.filter(t=>t.event===f.value.tipo_accion)),(f.value.fecha_inicio||f.value.fecha_fin)&&(l=l.filter(t=>{const r=new Date(t.created_at);if(f.value.fecha_inicio){const n=new Date(f.value.fecha_inicio);if(r<n)return!1}if(f.value.fecha_fin){const n=new Date(f.value.fecha_fin);if(n.setHours(23,59,59,999),r>n)return!1}return!0})),l}),k=l=>{if(!l)return"Sin fecha";try{return P(N(l),"dd MMM yyyy HH:mm",{locale:S})}catch{return l}},G=l=>{if(!l)return"-";try{return P(N(l),"d 'de' MMMM 'de' yyyy",{locale:S})}catch{return l}};return(l,t)=>(m(),b(B,null,[i(e(J),{title:`Obligación - ${a.obligacion.titulo}`},null,8,["title"]),i(W,{breadcrumbs:z},{default:o(()=>[s("div",vt,[s("div",pt,[s("div",null,[s("h1",gt,c(a.obligacion.titulo),1),s("p",ht," Contrato: "+c(a.contrato.nombre),1)]),s("div",bt,[i(e(j),{href:`/admin/contratos/${a.contrato.id}`},{default:o(()=>[i(e(F),{variant:"outline",size:"sm"},{default:o(()=>[i(e(nt),{class:"h-4 w-4 mr-2"}),t[4]||(t[4]=u(" Ver Contrato ",-1))]),_:1})]),_:1},8,["href"]),a.canEdit?(m(),g(e(j),{key:0,href:l.route("admin.obligaciones.edit",a.obligacion.id)},{default:o(()=>[i(e(F),{variant:"outline",size:"sm"},{default:o(()=>[i(e(rt),{class:"h-4 w-4 mr-2"}),t[5]||(t[5]=u(" Editar ",-1))]),_:1})]),_:1},8,["href"])):v("",!0)])]),i(e(Z),{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=r=>C.value=r),class:"flex-1"},{default:o(()=>{var r;return[i(e(tt),null,{default:o(()=>{var n;return[i(e(_),{value:"general"},{default:o(()=>[i(e(dt),{class:"h-4 w-4 mr-2"}),t[6]||(t[6]=u(" General ",-1))]),_:1}),(n=a.obligacion.hijos)!=null&&n.length?(m(),g(e(_),{key:0,value:"hijos"},{default:o(()=>{var p;return[i(e(ft),{class:"h-4 w-4 mr-2"}),t[7]||(t[7]=u(" Obligaciones Hijas ",-1)),(p=a.obligacion.hijos)!=null&&p.length?(m(),g(e(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[u(c(a.obligacion.hijos.length),1)]),_:1})):v("",!0)]}),_:1})):v("",!0),i(e(_),{value:"evidencias"},{default:o(()=>[i(e(ct),{class:"h-4 w-4 mr-2"}),t[8]||(t[8]=u(" Evidencias ",-1)),h.value.length>0?(m(),g(e(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[u(c(h.value.length),1)]),_:1})):v("",!0)]),_:1}),i(e(_),{value:"actividad"},{default:o(()=>[i(e(ut),{class:"h-4 w-4 mr-2"}),t[9]||(t[9]=u(" Actividad ",-1)),a.actividades&&a.actividades.length>0?(m(),g(e(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[u(c(a.actividades.length),1)]),_:1})):v("",!0)]),_:1})]}),_:1}),i(e(y),{value:"general",class:"space-y-4 mt-6"},{default:o(()=>{var n;return[i(e(V),null,{default:o(()=>[i(e(A),null,{default:o(()=>[i(e(D),null,{default:o(()=>[...t[10]||(t[10]=[u("Información General",-1)])]),_:1})]),_:1}),i(e(I),{class:"space-y-4"},{default:o(()=>{var p,E,H,O;return[s("div",null,[i(e(L),null,{default:o(()=>[...t[11]||(t[11]=[u("Descripción",-1)])]),_:1}),s("p",_t,c(a.obligacion.descripcion||"Sin descripción"),1)]),s("div",yt,[i(e(L),null,{default:o(()=>[...t[12]||(t[12]=[u("Contrato",-1)])]),_:1}),i(e(j),{href:l.route("admin.contratos.show",a.contrato.id),class:"hover:underline"},{default:o(()=>[s("h3",xt,c(a.contrato.nombre),1)]),_:1},8,["href"]),s("p",kt,c((p=a.contrato.proyecto)==null?void 0:p.nombre),1)]),s("div",wt,[s("div",null,[t[13]||(t[13]=s("span",{class:"text-sm text-gray-600"},"Creado por:",-1)),s("p",$t,c(((E=a.obligacion.creador)==null?void 0:E.name)||"Sistema"),1),s("p",jt,c(k(a.obligacion.created_at)),1)]),a.obligacion.updated_at?(m(),b("div",Vt,[t[14]||(t[14]=s("span",{class:"text-sm text-gray-600"},"Última actualización:",-1)),s("p",At,c(((H=a.obligacion.actualizador)==null?void 0:H.name)||"Sistema"),1),s("p",Dt,c(k(a.obligacion.updated_at)),1)])):v("",!0),a.obligacion.cumplido_at?(m(),b("div",It,[t[15]||(t[15]=s("span",{class:"text-sm text-gray-600"},"Cumplido por:",-1)),s("p",Mt,c(((O=a.obligacion.cumplido_por_usuario)==null?void 0:O.name)||"Sistema"),1),s("p",Ct,c(k(a.obligacion.cumplido_at)),1)])):v("",!0)])]}),_:1})]),_:1}),(n=a.obligacion.archivos_adjuntos)!=null&&n.length?(m(),g(e(V),{key:0},{default:o(()=>[i(e(A),null,{default:o(()=>[i(e(D),null,{default:o(()=>[...t[16]||(t[16]=[u("Archivos Adjuntos",-1)])]),_:1})]),_:1}),i(e(I),null,{default:o(()=>[s("div",Et,[(m(!0),b(B,null,K(a.obligacion.archivos_adjuntos,p=>(m(),b("div",{key:p.ruta,class:"flex items-center gap-2"},[i(e(mt),{class:"h-4 w-4"}),s("a",{href:`/storage/${p.ruta}`,target:"_blank",class:"hover:underline text-sm"},c(p.nombre_original),9,Ht)]))),128))])]),_:1})]),_:1})):v("",!0)]}),_:1}),(r=a.obligacion.hijos)!=null&&r.length?(m(),g(e(y),{key:0,value:"hijos",class:"space-y-4 mt-6"},{default:o(()=>[i(e(V),null,{default:o(()=>[i(e(A),null,{default:o(()=>[i(e(D),null,{default:o(()=>[...t[17]||(t[17]=[u("Obligaciones Hijas",-1)])]),_:1}),i(e(Y),null,{default:o(()=>[...t[18]||(t[18]=[u(" Sub-obligaciones derivadas de esta obligación principal ",-1)])]),_:1})]),_:1}),i(e(I),null,{default:o(()=>[i(at,{obligaciones:a.obligacion.hijos,contratoId:a.obligacion.contrato_id,editable:e(T)("obligaciones.edit"),onEdit:t[0]||(t[0]=n=>e(Q).visit(l.route("admin.obligaciones.edit",n.id)))},null,8,["obligaciones","contratoId","editable"])]),_:1})]),_:1})]),_:1})):v("",!0),i(e(y),{value:"evidencias",class:"space-y-4 mt-6"},{default:o(()=>[h.value.length>0?(m(),g(et,{key:0,modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),contratos:[a.contrato],evidencias:h.value},null,8,["modelValue","contratos","evidencias"])):v("",!0),i(it,{mode:"simple",evidencias:U.value,contrato:a.contrato,"format-date":G,"card-title":"Evidencias Asociadas","card-description":"Evidencias cargadas para esta obligación"},null,8,["evidencias","contrato"])]),_:1}),i(e(y),{value:"actividad",class:"space-y-4 mt-6"},{default:o(()=>[a.actividades&&a.actividades.length>0?(m(),g(ot,{key:0,modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=n=>f.value=n),usuarios:a.usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):v("",!0),i(lt,{activities:q.value,title:"Historial de Actividad",description:"Registro de cambios y actividades relacionadas con esta obligación","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]}),_:1},8,["modelValue"])])]),_:1})],64))}});export{ii as default};
