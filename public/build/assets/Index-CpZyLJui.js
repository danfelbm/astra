import{_ as ze}from"./AdminLayout.vue_vue_type_script_setup_true_lang-IcTNYCqS.js";import{d as ae,r as T,c as ie,I as Ce,i as m,g as o,j as q,e as t,y as Ee,l as ge,f as e,n as N,b as y,h as r,t as v,w as a,F as j,k as R,m as i,o as Ve,a as xe,p as Ue,u as qe,q as je,s as re}from"./app-CXqeR4-a.js";import{_ as M,a as Y,b as Z,c as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-TyS-yRYh.js";import{_ as C}from"./createLucideIcon-CpLzXnUV.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-CGgKhCND.js";import{_ as J}from"./Label.vue_vue_type_script_setup_true_lang-CMq6Pfuh.js";import{_ as F}from"./index-CygHK_pP.js";import{_ as Pe,a as Le,b as te,c as W,d as Ae,e as I}from"./TableHeader.vue_vue_type_script_setup_true_lang-BVJnOh2_.js";import{C as De,_ as de,a as ue,b as ce,c as me,d as fe}from"./SelectValue.vue_vue_type_script_setup_true_lang-DUiQEXpy.js";import{t as S}from"./index-BAyl8pp2.js";import{_ as He,a as Be,b as Me,c as Re,d as Fe,e as ye}from"./index-Bdd1vx9C.js";import{_ as Oe,a as Ge,b as Xe}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DVlcjevx.js";import{C as ne}from"./chevron-right-BdTxjXhb.js";import{C as Se}from"./check-0OPOwJmX.js";import{C as Je}from"./chevrons-up-down-DQYtEDgI.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as Ke}from"./pen-DiQxtX2h.js";import{T as be}from"./trash-2-Dl1NliaY.js";import{u as Qe}from"./useEtiquetaHierarchy-DdMF6Bat.js";import{S as We}from"./search-Bt_YncZq.js";import{L as Ye}from"./loader-circle-ag-f-HGM.js";import{_ as Ze,a as et,b as he,c as ke}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Cl1j4KCW.js";import{P as ve}from"./plus-DUtB4BJC.js";import{S as se}from"./save-Kt7lsDhZ.js";import{X as oe}from"./x-BEuzp8MD.js";import{L as tt}from"./list-B38DWjaj.js";import{T as at}from"./tree-pine-r5ZIg8Yl.js";import{T as pe}from"./tag-C8VGfrhf.js";import{S as we}from"./square-pen-DBiqZ18w.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-p2jd-okk.js";import"./index-BH7gl6Ss.js";import"./floating-ui.vue-DAU4aHHe.js";import"./index-COvOW60f.js";import"./shield-FLxsrGPv.js";import"./user-CrbfBtOr.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C6eblcqN.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DLXfhP6o.js";import"./VisuallyHidden-BDq1908I.js";import"./index-YW3zb1ZU.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-4LtOKtkS.js";import"./circle-alert-iRJER3rF.js";import"./map-pin-CTYkmBKO.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Bwedse_w.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CMWjxFa0.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-lCEEPyK_.js";import"./users-DofqsMlh.js";import"./target-BfvmtbMU.js";import"./vote-Cx7z7cCy.js";import"./folder-open-Cz7TU5G7.js";import"./send-CNV79Cc9.js";import"./file-text-DJ4yUYAt.js";import"./briefcase-DtUjoyxL.js";import"./calendar-BhbA0VfK.js";import"./megaphone-CEscX79J.js";import"./user-check-D68eI8mt.js";import"./clipboard-list-DpkdxP2e.js";import"./mail-B1IK9ZRj.js";import"./message-square-liFODg4r.js";import"./external-link-D_WcZCRK.js";import"./panel-left-BNWoR6eC.js";import"./index-CTi6IpqL.js";import"./useKbd-kRIii9yh.js";import"./utils-Dfjd-tqd.js";import"./VisuallyHiddenInput-CBEv58p7.js";import"./RovingFocusItem-C-er15Ny.js";const lt={class:"flex items-center w-full"},st={key:1,class:"w-5"},ot={class:"flex-1 min-w-0"},it={class:"truncate"},nt={key:0,class:"text-xs text-muted-foreground ml-1"},rt={key:0,class:"text-xs text-muted-foreground ml-1"},dt=ae({__name:"EtiquetaTreeItem",props:{etiqueta:{},nivel:{default:0},selectedId:{},excludedId:{},showCategoria:{type:Boolean,default:!1}},emits:["select"],setup(s,{emit:H}){const x=s,z=H,b=T(x.nivel<2),k=ie(()=>x.excludedId?x.etiqueta.id===x.excludedId:!1),w=()=>{b.value=!b.value},D=E=>{k.value||z("select",E)};return(E,u)=>{const d=Ce("EtiquetaTreeItem",!0);return i(),m("div",null,[o("div",{class:N(["relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",{"opacity-50":k.value}]),onClick:u[0]||(u[0]=()=>!k.value&&D(s.etiqueta))},[o("div",lt,[o("span",{class:"flex-shrink-0",style:Ee({width:`${s.nivel*20}px`})},null,4),s.etiqueta.children&&s.etiqueta.children.length>0?(i(),m("button",{key:0,onClick:ge(w,["stop"]),class:"mr-1 p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ne),{class:N(["h-3 w-3 transition-transform",b.value?"rotate-90":""])},null,8,["class"])])):(i(),m("span",st)),t(e(Se),{class:N(["mr-2 h-4 w-4 flex-shrink-0",s.selectedId===s.etiqueta.id?"opacity-100":"opacity-0"])},null,8,["class"]),o("div",ot,[o("span",it,[r(v(s.etiqueta.nombre)+" ",1),s.showCategoria&&s.etiqueta.categoria?(i(),m("span",nt," ("+v(s.etiqueta.categoria.nombre)+") ",1)):q("",!0)]),s.etiqueta.children&&s.etiqueta.children.length>0?(i(),m("span",rt," ("+v(s.etiqueta.children.length)+") ",1)):q("",!0),s.etiqueta.usos_count>0?(i(),y(e(F),{key:1,variant:"secondary",class:"ml-2 text-xs"},{default:a(()=>[r(v(s.etiqueta.usos_count)+" usos ",1)]),_:1})):q("",!0)])])],2),b.value&&s.etiqueta.children?(i(!0),m(j,{key:0},R(s.etiqueta.children,_=>(i(),y(d,{key:_.id,etiqueta:_,nivel:s.nivel+1,"selected-id":s.selectedId,"excluded-id":s.excludedId,"show-categoria":s.showCategoria,onSelect:D},null,8,["etiqueta","nivel","selected-id","excluded-id","show-categoria"]))),128)):q("",!0)])}}}),ut={class:"etiqueta-hierarchy-selector"},ct={key:0,class:"truncate"},mt={key:0,class:"text-muted-foreground text-xs mr-1"},ft={key:1,class:"text-muted-foreground"},vt={key:0,class:"text-xs text-muted-foreground mt-1"},pt=ae({__name:"EtiquetaHierarchySelector",props:{modelValue:{},label:{default:"Etiqueta Padre"},placeholder:{default:"Seleccionar etiqueta padre..."},allowNull:{type:Boolean,default:!0},excludedId:{},categorias:{},id:{default:"etiqueta-padre"}},emits:["update:modelValue"],setup(s,{emit:H}){const x=s,z=H,b=T(!1),k=T(""),w=T([]),D=T(!1),E=ie(()=>x.modelValue&&w.value.find(p=>p.id===x.modelValue)||null),u=ie(()=>x.categorias?k.value?x.categorias.filter(p=>_(p.id).some(g=>g.nombre.toLowerCase().includes(k.value.toLowerCase())||g.descripcion&&g.descripcion.toLowerCase().includes(k.value.toLowerCase()))):x.categorias:[]),d=p=>w.value.filter(g=>g.categoria_etiqueta_id===p&&!g.parent_id&&g.id!==x.excludedId),_=p=>w.value.filter(g=>g.categoria_etiqueta_id===p&&g.id!==x.excludedId),K=p=>{const g=[p.nombre];let V=p;for(;V.parent_id;){const L=w.value.find(Q=>Q.id===V.parent_id);if(!L)break;g.unshift(L.nombre),V=L}return g.join(" / ")},P=async()=>{D.value=!0;try{const p=await xe.get("/admin/etiquetas/para-selector",{params:{excluir_id:x.excludedId}});p.data.success&&(w.value=p.data.etiquetas)}catch(p){console.error("Error cargando etiquetas:",p)}finally{D.value=!1}},U=p=>{z("update:modelValue",(p==null?void 0:p.id)||null),b.value=!1};return Ve(()=>{P()}),(p,g)=>(i(),m("div",ut,[t(e(J),{for:s.id},{default:a(()=>[r(v(s.label),1)]),_:1},8,["for"]),t(e(Oe),{open:b.value,"onUpdate:open":g[2]||(g[2]=V=>b.value=V)},{default:a(()=>[t(e(Ge),{asChild:""},{default:a(()=>[t(e(C),{id:s.id,variant:"outline",role:"combobox","aria-expanded":b.value,"aria-label":s.label,class:"w-full justify-between"},{default:a(()=>[E.value?(i(),m("span",ct,[E.value.parent?(i(),m("span",mt,v(E.value.parent.nombre)+" / ",1)):q("",!0),r(" "+v(E.value.nombre),1)])):(i(),m("span",ft,v(s.placeholder),1)),t(e(Je),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["id","aria-expanded","aria-label"])]),_:1}),t(e(Xe),{class:"w-[400px] p-0"},{default:a(()=>[t(e(He),null,{default:a(()=>[t(e(Be),{placeholder:"Buscar etiqueta...",modelValue:k.value,"onUpdate:modelValue":g[0]||(g[0]=V=>k.value=V)},null,8,["modelValue"]),t(e(Me),null,{default:a(()=>[t(e(Re),null,{default:a(()=>[...g[3]||(g[3]=[r("No se encontraron etiquetas.",-1)])]),_:1}),s.allowNull?(i(),y(e(ye),{key:0},{default:a(()=>[t(e(Fe),{value:"",onSelect:g[1]||(g[1]=V=>U(null))},{default:a(()=>[t(e(Se),{class:N(["mr-2 h-4 w-4",s.modelValue?"opacity-0":"opacity-100"])},null,8,["class"]),g[4]||(g[4]=o("span",{class:"text-muted-foreground"},"Sin etiqueta padre (raíz)",-1))]),_:1})]),_:1})):q("",!0),(i(!0),m(j,null,R(u.value,V=>(i(),y(e(ye),{key:V.id,heading:V.nombre},{default:a(()=>[(i(!0),m(j,null,R(d(V.id),L=>(i(),y(dt,{key:L.id,etiqueta:L,nivel:0,"selected-id":s.modelValue,"excluded-id":s.excludedId,onSelect:U},null,8,["etiqueta","selected-id","excluded-id"]))),128))]),_:2},1032,["heading"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),E.value?(i(),m("p",vt," Ruta: "+v(K(E.value)),1)):q("",!0)]))}}),$e=_e(pt,[["__scopeId","data-v-bcdf1be4"]]),gt={class:"tree-node"},xt={key:1,class:"w-5"},bt={class:"flex-1 font-medium"},_t={key:0,class:"text-xs text-muted-foreground ml-1"},qt={class:"flex gap-1"},yt={class:"flex gap-1"},ht={key:0},kt=ae({__name:"EtiquetaTreeNode",props:{etiqueta:{},nivel:{default:0},expandidos:{},dragDropHelpers:{}},emits:["toggle","edit","delete","drop"],setup(s,{emit:H}){const x=s,z=H,b=T(!1),k=d=>{d.dataTransfer.effectAllowed="move",x.dragDropHelpers.handleDragStart(x.etiqueta)},w=d=>{d.preventDefault(),d.dataTransfer.dropEffect="move",b.value=!0,x.dragDropHelpers.handleDragOver(d,x.etiqueta)},D=()=>{b.value=!1},E=d=>{d.preventDefault(),d.stopPropagation(),b.value=!1;const _=x.dragDropHelpers.handleDrop(d,x.etiqueta);_&&_.valido&&z("drop",_)},u=()=>{b.value=!1,x.dragDropHelpers.handleDragEnd()};return(d,_)=>{var P;const K=Ce("EtiquetaTreeNode",!0);return i(),m("div",gt,[o("div",{class:N(["flex items-center gap-2 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700","transition-colors cursor-move",b.value?"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-300":""]),style:Ee({paddingLeft:s.nivel*24+"px"}),draggable:"true",onDragstart:k,onDragover:w,onDrop:E,onDragend:u,onDragleave:D},[s.etiqueta.children&&s.etiqueta.children.length>0?(i(),m("button",{key:0,onClick:_[0]||(_[0]=U=>d.$emit("toggle",s.etiqueta.id)),class:"p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ne),{class:N(["h-4 w-4 transition-transform",s.expandidos.has(s.etiqueta.id)?"rotate-90":""])},null,8,["class"])])):(i(),m("span",xt)),(P=s.etiqueta.categoria)!=null&&P.color?(i(),m("div",{key:2,class:N(["w-3 h-3 rounded-full",s.etiqueta.categoria.color])},null,2)):q("",!0),o("span",bt,[r(v(s.etiqueta.nombre)+" ",1),s.etiqueta.categoria?(i(),m("span",_t," ("+v(s.etiqueta.categoria.nombre)+") ",1)):q("",!0)]),o("div",qt,[s.etiqueta.usos_count>0?(i(),y(e(F),{key:0,variant:"secondary",class:"text-xs"},{default:a(()=>[r(v(s.etiqueta.usos_count)+" usos ",1)]),_:1})):q("",!0),s.etiqueta.children&&s.etiqueta.children.length>0?(i(),y(e(F),{key:1,variant:"outline",class:"text-xs"},{default:a(()=>[r(v(s.etiqueta.children.length),1)]),_:1})):q("",!0)]),o("div",yt,[t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7",onClick:_[1]||(_[1]=ge(U=>d.$emit("edit",s.etiqueta),["stop"]))},{default:a(()=>[t(e(Ke),{class:"h-3 w-3"})]),_:1}),t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-500 hover:text-red-600",onClick:_[2]||(_[2]=ge(U=>d.$emit("delete",s.etiqueta),["stop"]))},{default:a(()=>[t(e(be),{class:"h-3 w-3"})]),_:1})])],38),s.expandidos.has(s.etiqueta.id)&&s.etiqueta.children?(i(),m("div",ht,[(i(!0),m(j,null,R(s.etiqueta.children,U=>(i(),y(K,{key:U.id,etiqueta:U,nivel:s.nivel+1,expandidos:s.expandidos,"drag-drop-helpers":s.dragDropHelpers,onToggle:_[3]||(_[3]=p=>d.$emit("toggle",p)),onEdit:_[4]||(_[4]=p=>d.$emit("edit",p)),onDelete:_[5]||(_[5]=p=>d.$emit("delete",p)),onDrop:_[6]||(_[6]=p=>d.$emit("drop",p))},null,8,["etiqueta","nivel","expandidos","drag-drop-helpers"]))),128))])):q("",!0)])}}}),wt=_e(kt,[["__scopeId","data-v-b5f23538"]]),$t={class:"etiqueta-tree-view"},Ct={class:"mb-4 flex gap-2 items-center"},Et={class:"ml-auto flex items-center gap-2"},Vt={class:"border rounded-lg p-4 bg-white dark:bg-gray-800"},Dt={key:0,class:"flex justify-center py-8"},St={key:1,class:"text-center py-8 text-muted-foreground"},Tt={key:2,class:"space-y-1"},It={key:0,class:"mt-4 grid grid-cols-4 gap-4"},Nt={class:"text-2xl font-bold"},zt={class:"text-2xl font-bold"},Ut={class:"text-2xl font-bold"},jt={class:"text-2xl font-bold"},Pt=ae({__name:"EtiquetaTreeView",props:{etiquetas:{},categoriaId:{},showStats:{type:Boolean,default:!1}},emits:["edit","delete","moved"],setup(s,{emit:H}){const x=s,z=H,b=T(!1),k=T(""),w=T([]),{etiquetas:D,expandidos:E,estadisticas:u,construirArbol:d,filtrarArbol:_,toggleExpansion:K,expandirTodos:P,colapsarTodos:U,dragDropHelpers:p}=Qe(w),g=async()=>{if(x.etiquetas){w.value=d(x.etiquetas);return}b.value=!0;try{const $=await xe.get("/admin/etiquetas/arbol",{params:{categoria_id:x.categoriaId}});$.data.success&&(w.value=$.data.arbol)}catch($){console.error("Error cargando árbol de etiquetas:",$),S.error("Error al cargar las etiquetas")}finally{b.value=!1}},V=ie(()=>k.value?_(k.value,D.value):D.value);let L;const Q=()=>{clearTimeout(L),L=setTimeout(()=>{},300)},le=async $=>{var h,O;if($.valido){b.value=!0;try{(await xe.post(`/admin/etiquetas/${$.hijoId}/establecer-padre`,{parent_id:$.padreId})).data.success&&(S.success("Etiqueta movida exitosamente"),z("moved",{etiquetaId:$.hijoId,nuevoPadreId:$.padreId}),await g())}catch(G){S.error(((O=(h=G.response)==null?void 0:h.data)==null?void 0:O.message)||"Error al mover la etiqueta")}finally{b.value=!1}}};return Ue(()=>x.etiquetas,$=>{$&&(w.value=d($))}),Ve(()=>{g()}),($,h)=>(i(),m("div",$t,[o("div",Ct,[t(e(B),{modelValue:k.value,"onUpdate:modelValue":h[0]||(h[0]=O=>k.value=O),placeholder:"Buscar etiquetas...",class:"max-w-sm",onInput:Q},{prefix:a(()=>[t(e(We),{class:"h-4 w-4 text-muted-foreground"})]),_:1},8,["modelValue"]),t(e(C),{variant:"outline",size:"sm",onClick:e(P)},{default:a(()=>[t(e(De),{class:"h-4 w-4 mr-1"}),h[3]||(h[3]=r(" Expandir todo ",-1))]),_:1},8,["onClick"]),t(e(C),{variant:"outline",size:"sm",onClick:e(U)},{default:a(()=>[t(e(ne),{class:"h-4 w-4 mr-1"}),h[4]||(h[4]=r(" Colapsar todo ",-1))]),_:1},8,["onClick"]),o("div",Et,[t(e(F),{variant:"secondary"},{default:a(()=>[r(v(e(u).totalNodos)+" etiquetas",1)]),_:1}),t(e(F),{variant:"outline"},{default:a(()=>[r(v(e(u).profundidadMaxima)+" niveles",1)]),_:1})])]),o("div",Vt,[b.value?(i(),m("div",Dt,[t(e(Ye),{class:"h-8 w-8 animate-spin text-muted-foreground"})])):V.value.length===0?(i(),m("div",St," No se encontraron etiquetas ")):(i(),m("div",Tt,[(i(!0),m(j,null,R(V.value,O=>(i(),y(wt,{key:O.id,etiqueta:O,nivel:0,expandidos:e(E),"drag-drop-helpers":e(p),onToggle:e(K),onEdit:h[1]||(h[1]=G=>$.$emit("edit",G)),onDelete:h[2]||(h[2]=G=>$.$emit("delete",G)),onDrop:le},null,8,["etiqueta","expandidos","drag-drop-helpers","onToggle"]))),128))]))]),s.showStats?(i(),m("div",It,[t(e(M),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...h[5]||(h[5]=[r("Total",-1)])]),_:1})]),_:1}),t(e(A),null,{default:a(()=>[o("div",Nt,v(e(u).totalNodos),1)]),_:1})]),_:1}),t(e(M),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...h[6]||(h[6]=[r("Raíces",-1)])]),_:1})]),_:1}),t(e(A),null,{default:a(()=>[o("div",zt,v(e(u).totalRaices),1)]),_:1})]),_:1}),t(e(M),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...h[7]||(h[7]=[r("Con hijos",-1)])]),_:1})]),_:1}),t(e(A),null,{default:a(()=>[o("div",Ut,v(e(u).totalConHijos),1)]),_:1})]),_:1}),t(e(M),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...h[8]||(h[8]=[r("Profundidad",-1)])]),_:1})]),_:1}),t(e(A),null,{default:a(()=>[o("div",jt,v(e(u).profundidadMaxima),1)]),_:1})]),_:1})])):q("",!0)]))}}),Lt=_e(Pt,[["__scopeId","data-v-e813d647"]]),At={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ht={class:"flex justify-between items-center"},Bt={key:0,class:"grid grid-cols-3 gap-4"},Mt={class:"text-2xl font-bold"},Rt={class:"text-2xl font-bold"},Ft={class:"text-2xl font-bold"},Ot={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Gt={key:0,class:"text-xs text-red-500 mt-1"},Xt={class:"flex items-center gap-2"},Jt={class:"flex items-center gap-2"},Kt={class:"md:col-span-2"},Qt={class:"flex gap-2 mt-4"},Wt={class:"flex items-center justify-between"},Yt={class:"flex items-center gap-2"},Zt={class:"flex items-center gap-2"},ea={class:"flex justify-end gap-2"},ta={class:"flex items-center gap-2"},aa={class:"flex items-center gap-2"},la={class:"flex items-center gap-2"},sa={class:"flex justify-end gap-2"},oa={class:"p-4 space-y-4"},ia={class:"flex items-center justify-between"},na={class:"font-medium flex items-center gap-2"},ra={class:"grid grid-cols-1 gap-4"},da={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ua={class:"flex gap-2 mt-4"},ca={key:1,class:"space-y-2"},ma={key:0,class:"flex-1"},fa={class:"grid grid-cols-2 gap-4 mb-2"},va={class:"flex gap-2 items-end"},pa={class:"flex-1"},ga={key:1,class:"flex-1 flex items-center justify-between"},xa={class:"flex items-center gap-2"},ba={class:"font-medium"},_a={key:0,class:"text-sm text-gray-500"},qa={key:1,class:"text-xs text-muted-foreground mt-1"},ya={class:"flex gap-2"},ha={key:2,class:"text-center py-8 text-gray-500"},zl=ae({__name:"Index",props:{categorias:{},estadisticas:{},colores:{},iconos:{}},setup(s){const H=s,x=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:"Categorías de Etiquetas",href:"/admin/categorias-etiquetas"}],z=T(null),b=T(!1),k=T(new Set),w=T(null),D=T(null),E=T("table"),u=qe({nombre:"",color:"gray",icono:"Tag",descripcion:"",orden:0}),d=qe({nombre:"",descripcion:"",categoria_etiqueta_id:0,parent_id:null}),_=()=>{b.value=!0,z.value=null,u.reset()},K=c=>{z.value=c.id,b.value=!1,u.nombre=c.nombre,u.color=c.color,u.icono=c.icono||"Tag",u.descripcion=c.descripcion||"",u.orden=c.orden},P=()=>{z.value=null,b.value=!1,u.reset()},U=()=>{u.post("/admin/categorias-etiquetas",{preserveScroll:!0,onSuccess:()=>{S.success("Categoría creada exitosamente"),P()},onError:()=>{S.error("Error al crear la categoría")}})},p=c=>{u.put(`/admin/categorias-etiquetas/${c}`,{preserveScroll:!0,onSuccess:()=>{S.success("Categoría actualizada"),P()},onError:()=>{S.error("Error al actualizar")}})},g=c=>{confirm(`¿Eliminar la categoría "${c.nombre}"? Las etiquetas se reasignarán.`)&&re.delete(`/admin/categorias-etiquetas/${c.id}`,{preserveScroll:!0,onSuccess:()=>{S.success("Categoría eliminada")}})},V=c=>{re.patch(`/admin/categorias-etiquetas/${c.id}/toggle-active`,{},{preserveScroll:!0,onSuccess:()=>{S.success(c.activo?"Categoría desactivada":"Categoría activada")}})},L=c=>{const l=k.value;l.has(c)?l.delete(c):l.add(c)},Q=c=>{w.value=c,D.value=null,d.reset(),d.categoria_etiqueta_id=c},le=c=>{D.value=c.id,w.value=null,d.nombre=c.nombre,d.descripcion=c.descripcion||"",d.categoria_etiqueta_id=c.categoria_etiqueta_id,d.parent_id=c.parent_id||null},$=()=>{w.value=null,D.value=null,d.reset()},h=()=>{d.post("/admin/etiquetas",{preserveScroll:!0,onSuccess:()=>{S.success("Etiqueta creada exitosamente"),$()},onError:()=>{S.error("Error al crear la etiqueta")}})},O=c=>{d.put(`/admin/etiquetas/${c}`,{preserveScroll:!0,onSuccess:()=>{S.success("Etiqueta actualizada exitosamente"),$()},onError:()=>{S.error("Error al actualizar la etiqueta")}})},G=c=>{confirm("¿Estás seguro de eliminar esta etiqueta?")&&re.delete(`/admin/etiquetas/${c}`,{preserveScroll:!0,onSuccess:()=>{S.success("Etiqueta eliminada exitosamente")},onError:()=>{S.error("Error al eliminar la etiqueta")}})},ee=c=>({gray:"bg-gray-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",yellow:"bg-yellow-500",lime:"bg-lime-500",green:"bg-green-500",emerald:"bg-emerald-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",blue:"bg-blue-500",indigo:"bg-indigo-500",violet:"bg-violet-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"})[c]||"bg-gray-500",Te=()=>{const c=[];return H.categorias.data.forEach(l=>{l.etiquetas&&l.etiquetas.forEach(n=>{c.push({...n,categoria:{id:l.id,nombre:l.nombre,color:l.color,icono:l.icono,descripcion:l.descripcion,orden:l.orden,activo:l.activo}})})}),c},Ie=c=>{const l=H.categorias.data.find(n=>n.id===c.categoria_etiqueta_id);l&&(k.value.add(l.id),E.value="table",le(c))},Ne=c=>{G(c.id)};return(c,l)=>(i(),m(j,null,[t(e(je),{title:"Categorías de Etiquetas"}),t(ze,{breadcrumbs:x},{default:a(()=>[o("div",At,[o("div",Ht,[l[16]||(l[16]=o("div",null,[o("h1",{class:"text-2xl font-bold"},"Categorías de Etiquetas"),o("p",{class:"text-sm text-muted-foreground mt-1"}," Administra las categorías para organizar las etiquetas de proyectos ")],-1)),b.value?q("",!0):(i(),y(e(C),{key:0,onClick:_},{default:a(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),l[15]||(l[15]=r(" Nueva Categoría ",-1))]),_:1}))]),s.estadisticas?(i(),m("div",Bt,[t(e(M),null,{default:a(()=>[t(e(A),{class:"pt-6"},{default:a(()=>[o("div",Mt,v(s.estadisticas.total_categorias),1),l[17]||(l[17]=o("p",{class:"text-xs text-muted-foreground"},"Categorías totales",-1))]),_:1})]),_:1}),t(e(M),null,{default:a(()=>[t(e(A),{class:"pt-6"},{default:a(()=>[o("div",Rt,v(s.estadisticas.categorias_activas),1),l[18]||(l[18]=o("p",{class:"text-xs text-muted-foreground"},"Categorías activas",-1))]),_:1})]),_:1}),t(e(M),null,{default:a(()=>[t(e(A),{class:"pt-6"},{default:a(()=>[o("div",Ft,v(s.estadisticas.total_etiquetas),1),l[19]||(l[19]=o("p",{class:"text-xs text-muted-foreground"},"Etiquetas totales",-1))]),_:1})]),_:1})])):q("",!0),b.value?(i(),y(e(M),{key:1},{default:a(()=>[t(e(Y),null,{default:a(()=>[t(e(Z),null,{default:a(()=>[...l[20]||(l[20]=[r("Nueva Categoría",-1)])]),_:1})]),_:1}),t(e(A),null,{default:a(()=>[o("div",Ot,[o("div",null,[t(e(J),null,{default:a(()=>[...l[21]||(l[21]=[r("Nombre *",-1)])]),_:1}),t(e(B),{modelValue:e(u).nombre,"onUpdate:modelValue":l[0]||(l[0]=n=>e(u).nombre=n),placeholder:"Nombre de la categoría",class:N({"border-red-500":e(u).errors.nombre})},null,8,["modelValue","class"]),e(u).errors.nombre?(i(),m("p",Gt,v(e(u).errors.nombre),1)):q("",!0)]),o("div",null,[t(e(J),null,{default:a(()=>[...l[22]||(l[22]=[r("Color",-1)])]),_:1}),t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[1]||(l[1]=n=>e(u).color=n)},{default:a(()=>[t(e(ue),null,{default:a(()=>[o("div",Xt,[o("div",{class:N([ee(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(ce),{placeholder:e(u).color},null,8,["placeholder"])])]),_:1}),t(e(me),null,{default:a(()=>[(i(!0),m(j,null,R(s.colores,n=>(i(),y(e(fe),{key:n,value:n},{default:a(()=>[o("div",Jt,[o("div",{class:N([ee(n),"w-4 h-4 rounded"])},null,2),r(" "+v(n),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",null,[t(e(J),null,{default:a(()=>[...l[23]||(l[23]=[r("Icono",-1)])]),_:1}),t(e(de),{modelValue:e(u).icono,"onUpdate:modelValue":l[2]||(l[2]=n=>e(u).icono=n)},{default:a(()=>[t(e(ue),null,{default:a(()=>[t(e(ce),{placeholder:e(u).icono},null,8,["placeholder"])]),_:1}),t(e(me),null,{default:a(()=>[(i(!0),m(j,null,R(s.iconos,n=>(i(),y(e(fe),{key:n,value:n},{default:a(()=>[r(v(n),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",null,[t(e(J),null,{default:a(()=>[...l[24]||(l[24]=[r("Orden",-1)])]),_:1}),t(e(B),{modelValue:e(u).orden,"onUpdate:modelValue":l[3]||(l[3]=n=>e(u).orden=n),modelModifiers:{number:!0},type:"number",placeholder:"0"},null,8,["modelValue"])]),o("div",Kt,[t(e(J),null,{default:a(()=>[...l[25]||(l[25]=[r("Descripción",-1)])]),_:1}),t(e(B),{modelValue:e(u).descripcion,"onUpdate:modelValue":l[4]||(l[4]=n=>e(u).descripcion=n),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),o("div",Qt,[t(e(C),{onClick:U,disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[26]||(l[26]=r(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:P},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[27]||(l[27]=r(" Cancelar ",-1))]),_:1})])]),_:1})]),_:1})):q("",!0),t(e(Ze),{modelValue:E.value,"onUpdate:modelValue":l[14]||(l[14]=n=>E.value=n)},{default:a(()=>[t(e(M),null,{default:a(()=>[t(e(Y),null,{default:a(()=>[o("div",Wt,[t(e(Z),null,{default:a(()=>[...l[28]||(l[28]=[r("Gestión de Etiquetas",-1)])]),_:1}),t(e(et),null,{default:a(()=>[t(e(he),{value:"table"},{default:a(()=>[t(e(tt),{class:"h-4 w-4 mr-2"}),l[29]||(l[29]=r(" Vista de Tabla ",-1))]),_:1}),t(e(he),{value:"tree"},{default:a(()=>[t(e(at),{class:"h-4 w-4 mr-2"}),l[30]||(l[30]=r(" Vista de Árbol ",-1))]),_:1})]),_:1})])]),_:1}),t(e(ke),{value:"table",class:"mt-0"},{default:a(()=>[t(e(A),{class:"p-0"},{default:a(()=>[t(e(Pe),null,{default:a(()=>[t(e(Le),null,{default:a(()=>[t(e(te),null,{default:a(()=>[t(e(W),null,{default:a(()=>[...l[31]||(l[31]=[r("Nombre",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[32]||(l[32]=[r("Color",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[33]||(l[33]=[r("Etiquetas",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[34]||(l[34]=[r("Orden",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[35]||(l[35]=[r("Estado",-1)])]),_:1}),t(e(W),{class:"text-right"},{default:a(()=>[...l[36]||(l[36]=[r("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(Ae),null,{default:a(()=>[(i(!0),m(j,null,R(s.categorias.data,n=>(i(),m(j,{key:n.id},[z.value===n.id?(i(),y(e(te),{key:0},{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(B),{modelValue:e(u).nombre,"onUpdate:modelValue":l[5]||(l[5]=f=>e(u).nombre=f),class:"w-full"},null,8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[6]||(l[6]=f=>e(u).color=f)},{default:a(()=>[t(e(ue),{class:"w-32"},{default:a(()=>[o("div",Yt,[o("div",{class:N([ee(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(ce))])]),_:1}),t(e(me),null,{default:a(()=>[(i(!0),m(j,null,R(s.colores,f=>(i(),y(e(fe),{key:f,value:f},{default:a(()=>[o("div",Zt,[o("div",{class:N([ee(f),"w-4 h-4 rounded"])},null,2),r(" "+v(f),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[r(v(n.etiquetas_count||0),1)]),_:2},1024),t(e(I),null,{default:a(()=>[t(e(B),{modelValue:e(u).orden,"onUpdate:modelValue":l[7]||(l[7]=f=>e(u).orden=f),modelModifiers:{number:!0},type:"number",class:"w-20"},null,8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[t(e(F),{variant:n.activo?"default":"secondary"},{default:a(()=>[r(v(n.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(I),{class:"text-right"},{default:a(()=>[o("div",ea,[t(e(C),{size:"sm",onClick:f=>p(n.id),disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:P},{default:a(()=>[t(e(oe),{class:"h-4 w-4"})]),_:1})])]),_:2},1024)]),_:2},1024)):(i(),y(e(te),{key:1},{default:a(()=>[t(e(I),{class:"font-medium"},{default:a(()=>[o("div",ta,[t(e(pe),{class:"h-4 w-4 text-muted-foreground"}),r(" "+v(n.nombre),1)])]),_:2},1024),t(e(I),null,{default:a(()=>[o("div",aa,[o("div",{class:N([ee(n.color),"w-4 h-4 rounded"])},null,2),r(" "+v(n.color),1)])]),_:2},1024),t(e(I),null,{default:a(()=>[o("div",la,[t(e(C),{variant:"ghost",size:"sm",onClick:f=>L(n.id),class:"p-1"},{default:a(()=>[k.value.has(n.id)?(i(),y(e(De),{key:1,class:"h-4 w-4"})):(i(),y(e(ne),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),t(e(F),{variant:"outline"},{default:a(()=>[r(v(n.etiquetas_count||0)+" etiquetas ",1)]),_:2},1024)])]),_:2},1024),t(e(I),null,{default:a(()=>[r(v(n.orden),1)]),_:2},1024),t(e(I),null,{default:a(()=>[t(e(F),{variant:n.activo?"default":"secondary",class:"cursor-pointer",onClick:f=>V(n)},{default:a(()=>[r(v(n.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant","onClick"])]),_:2},1024),t(e(I),{class:"text-right"},{default:a(()=>[o("div",sa,[t(e(C),{size:"sm",variant:"ghost",onClick:f=>K(n)},{default:a(()=>[t(e(we),{class:"h-4 w-4"})]),_:1},8,["onClick"]),t(e(C),{size:"sm",variant:"ghost",onClick:f=>g(n),class:"text-destructive hover:text-destructive"},{default:a(()=>[t(e(be),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024)),k.value.has(n.id)?(i(),y(e(te),{key:2,class:"bg-gray-50 dark:bg-gray-900/50"},{default:a(()=>[t(e(I),{colspan:"6",class:"p-0"},{default:a(()=>[o("div",oa,[o("div",ia,[o("h4",na,[t(e(pe),{class:"h-4 w-4"}),r(" Etiquetas de "+v(n.nombre),1)]),w.value!==n.id?(i(),y(e(C),{key:0,size:"sm",onClick:f=>Q(n.id)},{default:a(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),l[37]||(l[37]=r(" Nueva Etiqueta ",-1))]),_:1},8,["onClick"])):q("",!0)]),w.value===n.id?(i(),y(e(M),{key:0,class:"border-dashed"},{default:a(()=>[t(e(A),{class:"pt-4"},{default:a(()=>[o("div",ra,[o("div",da,[o("div",null,[t(e(J),null,{default:a(()=>[...l[38]||(l[38]=[r("Nombre *",-1)])]),_:1}),t(e(B),{modelValue:e(d).nombre,"onUpdate:modelValue":l[8]||(l[8]=f=>e(d).nombre=f),placeholder:"Nombre de la etiqueta",class:N({"border-red-500":e(d).errors.nombre})},null,8,["modelValue","class"])]),o("div",null,[t(e(J),null,{default:a(()=>[...l[39]||(l[39]=[r("Descripción",-1)])]),_:1}),t(e(B),{modelValue:e(d).descripcion,"onUpdate:modelValue":l[9]||(l[9]=f=>e(d).descripcion=f),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),o("div",null,[t($e,{modelValue:e(d).parent_id,"onUpdate:modelValue":l[10]||(l[10]=f=>e(d).parent_id=f),categorias:[n],label:"Etiqueta Padre (Opcional)",placeholder:"Seleccionar etiqueta padre..."},null,8,["modelValue","categorias"])])]),o("div",ua,[t(e(C),{onClick:h,disabled:e(d).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[40]||(l[40]=r(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:$},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[41]||(l[41]=r(" Cancelar ",-1))]),_:1})])]),_:2},1024)]),_:2},1024)):q("",!0),n.etiquetas&&n.etiquetas.length>0?(i(),m("div",ca,[(i(!0),m(j,null,R(n.etiquetas,f=>(i(),m("div",{key:f.id,class:"flex items-center justify-between p-3 border rounded-lg bg-white dark:bg-gray-800"},[D.value===f.id?(i(),m("div",ma,[o("div",fa,[t(e(B),{modelValue:e(d).nombre,"onUpdate:modelValue":l[11]||(l[11]=X=>e(d).nombre=X),placeholder:"Nombre"},null,8,["modelValue"]),t(e(B),{modelValue:e(d).descripcion,"onUpdate:modelValue":l[12]||(l[12]=X=>e(d).descripcion=X),placeholder:"Descripción"},null,8,["modelValue"])]),o("div",va,[o("div",pa,[t($e,{modelValue:e(d).parent_id,"onUpdate:modelValue":l[13]||(l[13]=X=>e(d).parent_id=X),categorias:[n],"excluded-id":f.id,label:"",placeholder:"Etiqueta padre..."},null,8,["modelValue","categorias","excluded-id"])]),t(e(C),{size:"sm",onClick:X=>O(f.id),disabled:e(d).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:$},{default:a(()=>[t(e(oe),{class:"h-4 w-4"})]),_:1})])])):(i(),m("div",ga,[o("div",null,[o("div",xa,[o("span",ba,v(f.nombre),1),f.parent?(i(),y(e(F),{key:0,variant:"outline",class:"text-xs"},{default:a(()=>[r(v(f.parent.nombre),1)]),_:2},1024)):q("",!0),f.tiene_hijos?(i(),y(e(F),{key:1,variant:"secondary",class:"text-xs"},{default:a(()=>[...l[42]||(l[42]=[r(" Tiene hijos ",-1)])]),_:1})):q("",!0)]),f.descripcion?(i(),m("p",_a,v(f.descripcion),1)):q("",!0),f.ruta_completa&&f.parent?(i(),m("p",qa," Ruta: "+v(f.ruta_completa),1)):q("",!0)]),o("div",ya,[t(e(C),{size:"sm",variant:"outline",onClick:X=>le(f)},{default:a(()=>[t(e(we),{class:"h-4 w-4"})]),_:1},8,["onClick"]),t(e(C),{size:"sm",variant:"outline",onClick:X=>G(f.id)},{default:a(()=>[t(e(be),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]))]))),128))])):w.value!==n.id?(i(),m("div",ha,[t(e(pe),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),l[44]||(l[44]=o("p",null,"No hay etiquetas en esta categoría",-1)),t(e(C),{variant:"outline",size:"sm",class:"mt-2",onClick:f=>Q(n.id)},{default:a(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),l[43]||(l[43]=r(" Crear primera etiqueta ",-1))]),_:1},8,["onClick"])])):q("",!0)])]),_:2},1024)]),_:2},1024)):q("",!0)],64))),128)),s.categorias.data.length===0?(i(),y(e(te),{key:0},{default:a(()=>[t(e(I),{colspan:"6",class:"text-center text-muted-foreground py-8"},{default:a(()=>[...l[45]||(l[45]=[r(" No hay categorías creadas. Crea una nueva para empezar. ",-1)])]),_:1})]),_:1})):q("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ke),{value:"tree",class:"mt-0"},{default:a(()=>[t(e(A),null,{default:a(()=>[t(Lt,{etiquetas:Te(),"show-stats":!0,onEdit:Ie,onDelete:Ne},null,8,["etiquetas"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{zl as default};
