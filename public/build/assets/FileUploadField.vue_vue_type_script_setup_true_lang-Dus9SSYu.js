import{d as te,r as b,c as C,i as m,g as o,e as f,j as v,w as h,h as _,t as c,f as i,n as T,F as D,k as A,m as n,b as F,l as $,y as se}from"./app-Dh3nIFdW.js";import{_ as V}from"./createLucideIcon-DQCWrJyc.js";import{c as ae,_ as B}from"./CardTitle.vue_vue_type_script_setup_true_lang-Bq80RZJS.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-Bl5S1g8y.js";import{u as le}from"./useFileUpload-CkvBTpoC.js";import{U as oe}from"./upload-Nx1GbgC1.js";import{F as L}from"./file-DDXxIrL4.js";import{E as ie}from"./eye-CtXurWMS.js";import{D as re}from"./download-DcmmPV1P.js";import{X as P}from"./x-BHPvN6Kg.js";const ne={class:"space-y-2"},de={key:0,class:"text-red-500 ml-1"},ce={key:0,class:"text-sm text-muted-foreground"},ue={class:"flex flex-col items-center justify-center text-center"},me={class:"text-sm font-medium mb-1"},ve={class:"text-xs text-muted-foreground"},pe=["multiple","accept","disabled"],fe={key:0,class:"space-y-2"},he={class:"space-y-2"},xe={class:"flex items-center justify-between"},ge={class:"flex items-center space-x-3 flex-1"},ye={class:"min-w-0 flex-1"},we={class:"text-sm font-medium truncate"},Fe={key:0,class:"text-xs text-muted-foreground"},be={class:"flex items-center space-x-2"},_e={key:1,class:"space-y-2"},ke={class:"space-y-2"},ze={class:"space-y-2"},Se={class:"flex items-center justify-between"},Ve={class:"flex items-center space-x-3 flex-1"},Ee=["src","alt"],Ce={class:"min-w-0 flex-1"},$e={class:"text-sm font-medium truncate"},Be={class:"text-xs text-muted-foreground"},Ue={key:0,class:"w-full space-y-1"},je={class:"flex justify-between text-xs text-muted-foreground"},Ie={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},Me={key:1,class:"text-xs text-red-600"},Te={key:2,class:"text-sm text-red-600"},De={key:3,class:"text-xs text-muted-foreground"},Ae={key:0},Ke=te({__name:"FileUploadField",props:{modelValue:{},label:{},description:{},required:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},maxFiles:{default:5},maxFileSize:{default:10},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"},error:{},disabled:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0},module:{default:"postulaciones"},fieldId:{default:"file"},autoUpload:{type:Boolean,default:!0}},emits:["update:modelValue","filesSelected"],setup(r,{expose:R,emit:N}){const l=r,S=N,{isUploading:E,uploadFiles:q,deleteFile:H,downloadFile:W,formatFileSize:j}=le(),I=b(),p=b([]),k=b(new Map),w=b(new Map),x=b(new Map);b(!1);const y=C(()=>l.modelValue?l.modelValue.length>0&&typeof l.modelValue[0]=="string"?l.modelValue.map((a,s)=>({id:`existing_${s}`,name:a.split("/").pop()||"archivo",size:0,path:a,url:`/storage/${a}`})):l.modelValue:[]),z=C(()=>{const a=y.value.length+p.value.length;return l.multiple?a<l.maxFiles:a===0}),X=C(()=>l.accept.split(",").map(a=>a.trim().toLowerCase())),G=()=>{var a;!l.disabled&&z.value&&((a=I.value)==null||a.click())},J=a=>{var d;if(l.accept.includes("/*")){const t=l.accept.split(",").map(u=>u.trim());for(const u of t)if(u.includes("/*")){const g=u.replace("/*","");if(a.type.startsWith(g+"/"))return!0}}const s="."+((d=a.name.split(".").pop())==null?void 0:d.toLowerCase());return X.value.some(t=>t===s)},K=a=>{const s=l.maxFileSize*1024*1024;return a.size<=s},O=async a=>{const s=a.target,e=Array.from(s.files||[]);x.value.clear();const d=[];if(e.forEach(t=>{if(!J(t)){x.value.set(t.name,`Tipo de archivo no permitido. Solo se permiten: ${l.accept}`);return}if(!K(t)){x.value.set(t.name,`El archivo excede el tamaño máximo de ${l.maxFileSize}MB`);return}const u=y.value.length+d.length;if(l.multiple&&u>=l.maxFiles){x.value.set(t.name,`Se ha alcanzado el límite de ${l.maxFiles} archivos`);return}if(d.push(t),t.type.startsWith("image/")&&l.showPreview){const g=new FileReader;g.onload=ee=>{var M;k.value.set(t.name,(M=ee.target)==null?void 0:M.result)},g.readAsDataURL(t)}}),l.multiple?p.value=[...p.value,...d]:p.value=d.slice(0,1),d.length>0&&(S("filesSelected",d),l.autoUpload&&l.module&&l.fieldId))try{const t=await q(d,{module:l.module,fieldId:l.fieldId,onProgress:(u,g)=>{w.value.set(u,g)},onSuccess:u=>{const g=[...y.value,...u];S("update:modelValue",g),p.value=[],k.value.clear()},onError:u=>{console.error("Error al subir archivos:",u),d.forEach(g=>{x.value.set(g.name,"Error al subir el archivo")})}})}catch(t){console.error("Error en carga automática:",t)}s.value=""},Q=a=>{const s=p.value[a];k.value.delete(s.name),w.value.delete(s.name),x.value.delete(s.name),p.value.splice(a,1)},Y=async a=>{var d;const s=y.value[a];if(s.path)try{await H(s.path)}catch(t){((d=t==null?void 0:t.response)==null?void 0:d.status)!==404&&(t==null?void 0:t.status)!==404&&console.error("Error al eliminar archivo del servidor:",t)}const e=[...y.value];if(e.splice(a,1),typeof l.modelValue[0]=="string"){const t=e.map(u=>u.path).filter(Boolean);S("update:modelValue",t)}else S("update:modelValue",e)},Z=a=>{window.open(a,"_blank")};return R({selectedFiles:p,uploadProgress:w,uploadErrors:x}),(a,s)=>(n(),m("div",ne,[o("div",null,[f(i(U),{class:"text-sm font-medium"},{default:h(()=>[_(c(r.label)+" ",1),r.required?(n(),m("span",de,"*")):v("",!0)]),_:1}),r.description?(n(),m("p",ce,c(r.description),1)):v("",!0)]),f(i(B),{class:T(["border-2 border-dashed hover:border-primary/50 transition-colors cursor-pointer",{"opacity-50 cursor-not-allowed":r.disabled||!z.value||i(E),"border-red-300":r.error}]),onClick:G},{default:h(()=>[f(i(ae),{class:"p-6"},{default:h(()=>[o("div",ue,[f(i(oe),{class:"h-10 w-10 text-muted-foreground mb-3"}),o("p",me,c(i(E)?"Subiendo archivos...":z.value?"Haz clic para seleccionar archivos":"Límite de archivos alcanzado"),1),o("p",ve,c(r.multiple?`Hasta ${r.maxFiles} archivos`:"Un archivo")+" • Máx. "+c(r.maxFileSize)+"MB • Formatos: "+c(r.accept),1)])]),_:1})]),_:1},8,["class"]),o("input",{ref_key:"fileInputRef",ref:I,type:"file",multiple:r.multiple,accept:r.accept,disabled:r.disabled||!z.value||i(E),onChange:O,class:"hidden"},null,40,pe),y.value.length>0?(n(),m("div",fe,[f(i(U),{class:"text-xs text-muted-foreground"},{default:h(()=>[...s[0]||(s[0]=[_("Archivos cargados:",-1)])]),_:1}),o("div",he,[(n(!0),m(D,null,A(y.value,(e,d)=>(n(),F(i(B),{key:e.id,class:"p-3"},{default:h(()=>[o("div",xe,[o("div",ge,[f(i(L),{class:"h-5 w-5 text-muted-foreground flex-shrink-0"}),o("div",ye,[o("p",we,c(e.name),1),e.size>0?(n(),m("p",Fe,c(i(j)(e.size)),1)):v("",!0)])]),o("div",be,[e.url?(n(),F(i(V),{key:0,type:"button",variant:"ghost",size:"sm",onClick:$(t=>Z(e.url),["stop"]),"aria-label":"Ver archivo"},{default:h(()=>[f(i(ie),{class:"h-4 w-4 mr-1"}),s[1]||(s[1]=_(" Ver ",-1))]),_:1},8,["onClick"])):v("",!0),e.url&&e.path?(n(),F(i(V),{key:1,type:"button",variant:"ghost",size:"sm",onClick:$(t=>i(W)(e.path,e.name),["stop"]),"aria-label":"Descargar archivo"},{default:h(()=>[f(i(re),{class:"h-4 w-4 mr-1"}),s[2]||(s[2]=_(" Descargar ",-1))]),_:1},8,["onClick"])):v("",!0),r.disabled?v("",!0):(n(),F(i(V),{key:2,type:"button",variant:"ghost",size:"sm",onClick:$(t=>Y(d),["stop"]),"aria-label":"Eliminar archivo"},{default:h(()=>[f(i(P),{class:"h-4 w-4 mr-1 text-destructive"}),s[3]||(s[3]=_(" Eliminar ",-1))]),_:1},8,["onClick"]))])])]),_:2},1024))),128))])])):v("",!0),p.value.length>0?(n(),m("div",_e,[f(i(U),{class:"text-xs text-muted-foreground"},{default:h(()=>[_(c(w.value.size>0?"Subiendo archivos...":"Archivos pendientes de carga:"),1)]),_:1}),o("div",ke,[(n(!0),m(D,null,A(p.value,(e,d)=>(n(),F(i(B),{key:e.name,class:T(["p-3",{"border-red-300":x.value.has(e.name)}])},{default:h(()=>[o("div",ze,[o("div",Se,[o("div",Ve,[k.value.has(e.name)&&r.showPreview?(n(),m("img",{key:0,src:k.value.get(e.name),alt:e.name,class:"h-10 w-10 object-cover rounded flex-shrink-0"},null,8,Ee)):(n(),F(i(L),{key:1,class:"h-5 w-5 text-muted-foreground flex-shrink-0"})),o("div",Ce,[o("p",$e,c(e.name),1),o("p",Be,c(i(j)(e.size)),1)])]),r.disabled?v("",!0):(n(),F(i(V),{key:0,type:"button",variant:"ghost",size:"sm",onClick:t=>Q(d)},{default:h(()=>[f(i(P),{class:"h-4 w-4 text-destructive"})]),_:1},8,["onClick"]))]),w.value.has(e.name)?(n(),m("div",Ue,[o("div",je,[s[4]||(s[4]=o("span",null,"Subiendo...",-1)),o("span",null,c(w.value.get(e.name))+"%",1)]),o("div",Ie,[o("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:se({width:`${w.value.get(e.name)}%`})},[...s[5]||(s[5]=[o("div",{class:"h-full bg-white/30 animate-pulse"},null,-1)])],4)])])):v("",!0),x.value.has(e.name)?(n(),m("p",Me,c(x.value.get(e.name)),1)):v("",!0)])]),_:2},1032,["class"]))),128))])])):v("",!0),r.error?(n(),m("p",Te,c(r.error),1)):v("",!0),!r.disabled&&z.value?(n(),m("div",De,[r.multiple?(n(),m("p",Ae,c(y.value.length+p.value.length)+" de "+c(r.maxFiles)+" archivos ",1)):v("",!0)])):v("",!0)]))}});export{Ke as _};
