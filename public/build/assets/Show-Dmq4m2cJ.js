import{d as R,r as w,c as $,i as b,e,f as i,q as J,w as o,g as s,t as c,b as g,j as v,v as j,h as u,m,F as B,k as K,s as Q}from"./app-DlmWAWLM.js";import{_ as W}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DxncPXbc.js";import{c as X,_ as F}from"./createLucideIcon-B8281_2z.js";import{_ as V,a as A,b as D,c as I}from"./CardTitle.vue_vue_type_script_setup_true_lang-AUjIYp68.js";import{_ as Y}from"./CardDescription.vue_vue_type_script_setup_true_lang-C5vEL4V-.js";import{_ as M}from"./index-CLy9LD5R.js";import{_ as L}from"./Label.vue_vue_type_script_setup_true_lang-BNREmH2a.js";import{_ as Z,a as tt,b as _,c as y}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Di9Vfu3X.js";import{_ as it}from"./AccordionContent.vue_vue_type_script_setup_true_lang-aR36WXVG.js";import{_ as et}from"./EvidenciasTable.vue_vue_type_script_setup_true_lang-D0159qOX.js";import{O as at}from"./ObligacionTree-Cm9FrST4.js";import{_ as ot,a as lt}from"./ActivityLog.vue_vue_type_script_setup_true_lang-CZB84FZN.js";import{u as st}from"./usePermissions-CC7_FkKZ.js";import{A as nt}from"./arrow-left-DVchKIoA.js";import{P as rt}from"./pencil-C4Zy7CdA.js";import{I as dt}from"./info-Cg6mbS-y.js";import{I as ct}from"./image-Fne6k6y7.js";import{A as ut}from"./activity-Cdl6XPlP.js";import{P as mt}from"./paperclip-BvvFQd7B.js";import{f as P,e as S}from"./es-BDPlFIsO.js";import{p as N}from"./parseISO-DFjB8F03.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-712Z3z2u.js";import"./index-CnXpICxy.js";import"./floating-ui.vue-K2irEoRr.js";import"./x-CVmak5cP.js";import"./Input.vue_vue_type_script_setup_true_lang-CbyCCRkc.js";import"./index-D5ctPQxb.js";import"./index-BpP68Equ.js";import"./shield-NI0CGFrA.js";import"./user-BjlKIRQo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Ds2nW1nv.js";import"./chevron-right-BldIB6XG.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CtEt8JZt.js";import"./VisuallyHidden-DQEdmkNH.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Bx32bmDw.js";import"./check-CsR91O3E.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BHiFKq2N.js";import"./index-DXikczT9.js";import"./circle-alert-0OWVYoS7.js";import"./map-pin-QIwnOWhZ.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-BETdGBx9.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-D3rNeb2E.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-Bd9iotnQ.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-C1BXh9TJ.js";import"./tag-CRQPaZEq.js";import"./users-DH2VmlmU.js";import"./target-Cs8flVeC.js";import"./vote-QgDOkUWJ.js";import"./folder-open-CFnipNvv.js";import"./send-CUcAd6ji.js";import"./file-text-BbNX5nDR.js";import"./briefcase-Ca9Q-rXk.js";import"./calendar-Dp255hQ3.js";import"./megaphone-CvBiTYXg.js";import"./user-check-BN_gx5pf.js";import"./clipboard-list-L3umFvaS.js";import"./mail-CRRh1C1x.js";import"./message-square-DQKztXGj.js";import"./external-link-B4z1LSry.js";import"./panel-left-C7VtaKld.js";import"./index-9YE0w0X4.js";import"./RovingFocusItem-4iGUKxwz.js";import"./utils-BkEKbG5R.js";import"./useArrowNavigation-B5rxJs06.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-uEuKSJFJ.js";import"./download-DLLWdfPq.js";import"./Separator.vue_vue_type_script_setup_true_lang-lZw601xT.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-BzVKQhYd.js";import"./circle-QuFlUOAf.js";import"./layers-B4BxQRMO.js";import"./plus-C6fGa2_f.js";import"./trash-2-6ImaLkH_.js";import"./loader-circle-BQGC-Ote.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Bcl2uFYm.js";import"./filter-uRtUK3pC.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=X("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),vt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},pt={class:"flex items-center justify-between"},gt={class:"text-3xl font-bold"},ht={class:"text-muted-foreground mt-2"},bt={class:"flex gap-2"},_t={class:"mt-1"},yt={class:"pt-4 border-t"},xt={class:"font-medium mt-1"},kt={class:"text-sm text-gray-600 mt-1"},wt={class:"pt-4 border-t space-y-3"},$t={class:"mt-1"},jt={class:"text-xs text-gray-500"},Vt={key:0},At={class:"mt-1"},Dt={class:"text-xs text-gray-500"},It={key:1},Mt={class:"mt-1"},Ct={class:"text-xs text-gray-500"},Et={class:"space-y-2"},Ht=["href"],ee=R({__name:"Show",props:{obligacion:{},contrato:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canCreateChild:{type:Boolean},actividades:{},usuariosActividades:{}},setup(a){const x=a,{hasPermission:T}=st(),C=w("general"),d=w({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null,entregable_id:null}),f=w({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),z=[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"},{title:x.obligacion.titulo}],h=$(()=>x.obligacion.evidencias||[]),U=$(()=>{let l=h.value;return d.value.tipo&&(l=l.filter(t=>t.tipo_evidencia===d.value.tipo)),d.value.estado&&(l=l.filter(t=>t.estado===d.value.estado)),d.value.usuario_id&&(l=l.filter(t=>{var r;return((r=t.usuario)==null?void 0:r.id)===d.value.usuario_id})),d.value.entregable_id&&(l=l.filter(t=>{var r;return(r=t.entregables)==null?void 0:r.some(n=>n.id===d.value.entregable_id)})),(d.value.fecha_inicio||d.value.fecha_fin)&&(l=l.filter(t=>{const r=new Date(t.created_at);if(d.value.fecha_inicio){const n=new Date(d.value.fecha_inicio);if(r<n)return!1}if(d.value.fecha_fin){const n=new Date(d.value.fecha_fin);if(n.setHours(23,59,59,999),r>n)return!1}return!0})),l}),q=$(()=>{let l=x.actividades||[];return f.value.usuario_id&&(l=l.filter(t=>{var r;return((r=t.causer)==null?void 0:r.id)===f.value.usuario_id})),f.value.tipo_accion&&(l=l.filter(t=>t.event===f.value.tipo_accion)),(f.value.fecha_inicio||f.value.fecha_fin)&&(l=l.filter(t=>{const r=new Date(t.created_at);if(f.value.fecha_inicio){const n=new Date(f.value.fecha_inicio);if(r<n)return!1}if(f.value.fecha_fin){const n=new Date(f.value.fecha_fin);if(n.setHours(23,59,59,999),r>n)return!1}return!0})),l}),k=l=>{if(!l)return"Sin fecha";try{return P(N(l),"dd MMM yyyy HH:mm",{locale:S})}catch{return l}},G=l=>{if(!l)return"-";try{return P(N(l),"d 'de' MMMM 'de' yyyy",{locale:S})}catch{return l}};return(l,t)=>(m(),b(B,null,[e(i(J),{title:`Obligación - ${a.obligacion.titulo}`},null,8,["title"]),e(W,{breadcrumbs:z},{default:o(()=>[s("div",vt,[s("div",pt,[s("div",null,[s("h1",gt,c(a.obligacion.titulo),1),s("p",ht," Contrato: "+c(a.contrato.nombre),1)]),s("div",bt,[e(i(j),{href:`/admin/contratos/${a.contrato.id}`},{default:o(()=>[e(i(F),{variant:"outline",size:"sm"},{default:o(()=>[e(i(nt),{class:"h-4 w-4 mr-2"}),t[4]||(t[4]=u(" Ver Contrato ",-1))]),_:1})]),_:1},8,["href"]),a.canEdit?(m(),g(i(j),{key:0,href:l.route("admin.obligaciones.edit",a.obligacion.id)},{default:o(()=>[e(i(F),{variant:"outline",size:"sm"},{default:o(()=>[e(i(rt),{class:"h-4 w-4 mr-2"}),t[5]||(t[5]=u(" Editar ",-1))]),_:1})]),_:1},8,["href"])):v("",!0)])]),e(i(Z),{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=r=>C.value=r),class:"flex-1"},{default:o(()=>{var r;return[e(i(tt),null,{default:o(()=>{var n;return[e(i(_),{value:"general"},{default:o(()=>[e(i(dt),{class:"h-4 w-4 mr-2"}),t[6]||(t[6]=u(" General ",-1))]),_:1}),(n=a.obligacion.hijos)!=null&&n.length?(m(),g(i(_),{key:0,value:"hijos"},{default:o(()=>{var p;return[e(i(ft),{class:"h-4 w-4 mr-2"}),t[7]||(t[7]=u(" Obligaciones Hijas ",-1)),(p=a.obligacion.hijos)!=null&&p.length?(m(),g(i(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[u(c(a.obligacion.hijos.length),1)]),_:1})):v("",!0)]}),_:1})):v("",!0),e(i(_),{value:"evidencias"},{default:o(()=>[e(i(ct),{class:"h-4 w-4 mr-2"}),t[8]||(t[8]=u(" Evidencias ",-1)),h.value.length>0?(m(),g(i(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[u(c(h.value.length),1)]),_:1})):v("",!0)]),_:1}),e(i(_),{value:"actividad"},{default:o(()=>[e(i(ut),{class:"h-4 w-4 mr-2"}),t[9]||(t[9]=u(" Actividad ",-1)),a.actividades&&a.actividades.length>0?(m(),g(i(M),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:o(()=>[u(c(a.actividades.length),1)]),_:1})):v("",!0)]),_:1})]}),_:1}),e(i(y),{value:"general",class:"space-y-4 mt-6"},{default:o(()=>{var n;return[e(i(V),null,{default:o(()=>[e(i(A),null,{default:o(()=>[e(i(D),null,{default:o(()=>[...t[10]||(t[10]=[u("Información General",-1)])]),_:1})]),_:1}),e(i(I),{class:"space-y-4"},{default:o(()=>{var p,E,H,O;return[s("div",null,[e(i(L),null,{default:o(()=>[...t[11]||(t[11]=[u("Descripción",-1)])]),_:1}),s("p",_t,c(a.obligacion.descripcion||"Sin descripción"),1)]),s("div",yt,[e(i(L),null,{default:o(()=>[...t[12]||(t[12]=[u("Contrato",-1)])]),_:1}),e(i(j),{href:l.route("admin.contratos.show",a.contrato.id),class:"hover:underline"},{default:o(()=>[s("h3",xt,c(a.contrato.nombre),1)]),_:1},8,["href"]),s("p",kt,c((p=a.contrato.proyecto)==null?void 0:p.nombre),1)]),s("div",wt,[s("div",null,[t[13]||(t[13]=s("span",{class:"text-sm text-gray-600"},"Creado por:",-1)),s("p",$t,c(((E=a.obligacion.creador)==null?void 0:E.name)||"Sistema"),1),s("p",jt,c(k(a.obligacion.created_at)),1)]),a.obligacion.updated_at?(m(),b("div",Vt,[t[14]||(t[14]=s("span",{class:"text-sm text-gray-600"},"Última actualización:",-1)),s("p",At,c(((H=a.obligacion.actualizador)==null?void 0:H.name)||"Sistema"),1),s("p",Dt,c(k(a.obligacion.updated_at)),1)])):v("",!0),a.obligacion.cumplido_at?(m(),b("div",It,[t[15]||(t[15]=s("span",{class:"text-sm text-gray-600"},"Cumplido por:",-1)),s("p",Mt,c(((O=a.obligacion.cumplido_por_usuario)==null?void 0:O.name)||"Sistema"),1),s("p",Ct,c(k(a.obligacion.cumplido_at)),1)])):v("",!0)])]}),_:1})]),_:1}),(n=a.obligacion.archivos_adjuntos)!=null&&n.length?(m(),g(i(V),{key:0},{default:o(()=>[e(i(A),null,{default:o(()=>[e(i(D),null,{default:o(()=>[...t[16]||(t[16]=[u("Archivos Adjuntos",-1)])]),_:1})]),_:1}),e(i(I),null,{default:o(()=>[s("div",Et,[(m(!0),b(B,null,K(a.obligacion.archivos_adjuntos,p=>(m(),b("div",{key:p.ruta,class:"flex items-center gap-2"},[e(i(mt),{class:"h-4 w-4"}),s("a",{href:p.ruta,target:"_blank",class:"hover:underline text-sm"},c(p.nombre_original),9,Ht)]))),128))])]),_:1})]),_:1})):v("",!0)]}),_:1}),(r=a.obligacion.hijos)!=null&&r.length?(m(),g(i(y),{key:0,value:"hijos",class:"space-y-4 mt-6"},{default:o(()=>[e(i(V),null,{default:o(()=>[e(i(A),null,{default:o(()=>[e(i(D),null,{default:o(()=>[...t[17]||(t[17]=[u("Obligaciones Hijas",-1)])]),_:1}),e(i(Y),null,{default:o(()=>[...t[18]||(t[18]=[u(" Sub-obligaciones derivadas de esta obligación principal ",-1)])]),_:1})]),_:1}),e(i(I),null,{default:o(()=>[e(at,{obligaciones:a.obligacion.hijos,contratoId:a.obligacion.contrato_id,editable:i(T)("obligaciones.edit"),onEdit:t[0]||(t[0]=n=>i(Q).visit(l.route("admin.obligaciones.edit",n.id)))},null,8,["obligaciones","contratoId","editable"])]),_:1})]),_:1})]),_:1})):v("",!0),e(i(y),{value:"evidencias",class:"space-y-4 mt-6"},{default:o(()=>[h.value.length>0?(m(),g(it,{key:0,modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),contratos:[a.contrato],evidencias:h.value},null,8,["modelValue","contratos","evidencias"])):v("",!0),e(et,{mode:"simple",evidencias:U.value,contrato:a.contrato,"format-date":G,"card-title":"Evidencias Asociadas","card-description":"Evidencias cargadas para esta obligación"},null,8,["evidencias","contrato"])]),_:1}),e(i(y),{value:"actividad",class:"space-y-4 mt-6"},{default:o(()=>[a.actividades&&a.actividades.length>0?(m(),g(ot,{key:0,modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=n=>f.value=n),usuarios:a.usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):v("",!0),e(lt,{activities:q.value,title:"Historial de Actividad",description:"Registro de cambios y actividades relacionadas con esta obligación","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]}),_:1},8,["modelValue"])])]),_:1})],64))}});export{ee as default};
