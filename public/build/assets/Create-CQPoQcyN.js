import{d as pe,C as _e,r as g,c as v,b as h,e as u,w as t,g as i,f as a,t as d,u as e,h as n,l as be,j as p,i as m,n as F,F as S,k as U,W as ge}from"./app-CjO7v5GQ.js";import{_ as ve}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BYpIZ_fq.js";import{_ as V,a as $,b as k,c as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-Bxwe7tUF.js";import{_ as B}from"./CardDescription.vue_vue_type_script_setup_true_lang-BVAAswS5.js";import{_ as x}from"./createLucideIcon-D-pKcP9Q.js";import{_ as T}from"./Input.vue_vue_type_script_setup_true_lang-B_nvdHN5.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-BW8_6eap.js";import{_ as H}from"./Textarea.vue_vue_type_script_setup_true_lang-HWX8WFPC.js";import{_ as O,a as W,b as X,c as J,d as K}from"./SelectValue.vue_vue_type_script_setup_true_lang-BtUYWEab.js";import{_ as Q}from"./index-B6TYaX6R.js";import{_ as Y,a as Z,b as ee}from"./index-VE8OALNU.js";import{_ as he,a as xe}from"./index-BRaYMiZy.js";import{_ as oe}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-DfmiIFHc.js";import{u as ye}from"./useToast-jPqZr8jW.js";import{F as Ve}from"./flag-CYXhVhqR.js";import{X as ae}from"./x-BH92W00E.js";import{U as se}from"./user-plus-CoxmBSVT.js";import{C as $e}from"./circle-alert-CCRajIhM.js";import{A as ke}from"./arrow-left-BVrvljyo.js";import{S as Ce}from"./save-CEix0_Ke.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BVMU7bwV.js";import"./index-DIHigTtG.js";import"./floating-ui.vue-DIPIQFyz.js";import"./shield-BQEaDxqE.js";import"./user-Co3VyLMP.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-2xSyQjeV.js";import"./chevron-right-Cu7pv3nH.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CeaU-cJS.js";import"./VisuallyHidden-CTbTB84I.js";import"./index-Cqupi6zH.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CBVCH0rS.js";import"./index-DtuMGbOf.js";import"./map-pin-DgRtAv6q.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-BGEkPemt.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-ArNvpFXc.js";import"./chevrons-up-down-DYGIKuiv.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CfhopTWT.js";import"./tag-sxC7-sSh.js";import"./users-BKGB3LXs.js";import"./target-Ok6GTNsy.js";import"./vote-B3S3fO6K.js";import"./folder-open-thq0c_kP.js";import"./send-BCIIWnZp.js";import"./file-text-Bp8iI4wb.js";import"./briefcase-CJBZbF6d.js";import"./calendar-DDBvtQmm.js";import"./megaphone-CIaTHaNl.js";import"./user-check-DC7m7x8J.js";import"./clipboard-list-CqMWKead.js";import"./mail-DPbCVbB_.js";import"./message-square-CaRueYKC.js";import"./external-link-l4IeB4ym.js";import"./panel-left-CyQdjetZ.js";import"./check-DGuODqTO.js";import"./index-CaapDUxs.js";import"./nullish-CHIgUVhi.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CWJT2xjP.js";import"./search-Bh9Nvbzy.js";import"./loader-circle-fzSEXKwB.js";import"./chevron-left-48vlw3IX.js";const Ne={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Se={class:"text-muted-foreground mt-2"},Ue={class:"grid gap-4 md:grid-cols-3"},Be={class:"font-medium"},Ee={class:"font-medium"},Ae={key:0,class:"text-sm text-red-600 mt-1"},De={key:0,class:"text-sm text-red-600 mt-1"},Re={class:"grid gap-4 md:grid-cols-2"},je={class:"flex items-center gap-2"},Ie={class:"grid gap-4 md:grid-cols-2"},Fe={key:0,class:"text-sm text-red-600 mt-1"},Te={key:0,class:"text-sm text-red-600 mt-1"},ze={class:"space-y-2"},qe={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},Pe={class:"flex items-center gap-2"},Le={class:"font-medium"},Me={class:"text-sm text-muted-foreground"},Ge={key:0,class:"text-sm text-red-600 mt-1"},He={class:"flex items-center justify-between mb-2"},Oe={key:0,class:"space-y-2 mt-3"},We={class:"flex items-center gap-2"},Xe={class:"font-medium"},Je={class:"text-sm text-muted-foreground"},Ke={key:1,class:"text-sm text-muted-foreground mt-3"};const Qe={class:"list-disc pl-4"},Ye={class:"flex justify-end gap-2"},Ze=pe({__name:"Create",props:{proyecto:{},hito:{},usuarios:{},estados:{},prioridades:{},siguienteOrden:{}},setup(te){const c=te,{toast:E}=ye(),s=_e({nombre:"",descripcion:"",fecha_inicio:"",fecha_fin:"",estado:"pendiente",prioridad:"media",responsable_id:null,usuarios_asignados:[],orden:c.siguienteOrden||1,notas:""});g(!1);const w=g(null),z=g("colaborador"),A=g(!1),D=g(!1),{route:q}=window,re=v(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:c.proyecto.nombre,href:`/admin/proyectos/${c.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${c.proyecto.id}/hitos`},{title:c.hito.nombre,href:`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}`},{title:"Entregables",href:`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`},{title:"Nuevo Entregable"}]),f=g(null),_=g(new Map);c.usuarios.forEach(l=>_.value.set(l.id,l));const le=v(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"colaborador",label:"Colaborador"},{value:"revisor",label:"Revisor"}],value:"colaborador",required:!0}]),ie=v(()=>{const l=s.usuarios_asignados.map(o=>o.user_id);return s.responsable_id&&l.push(s.responsable_id),l}),ne=l=>{if(l.userIds.length>0){const o=l.userIds[0];s.responsable_id=o,_.value.has(o)?f.value=_.value.get(o)||null:(f.value={id:o,name:`Usuario seleccionado (ID: ${o})`,email:"Se actualizará al guardar"},_.value.set(o,f.value))}},de=l=>{l.userIds.forEach(o=>{s.usuarios_asignados.some(N=>N.user_id===o)||(s.usuarios_asignados.push({user_id:o,rol:l.extraData.rol||"colaborador"}),_.value.has(o)||_.value.set(o,{id:o,name:`Usuario #${o}`,email:"Pendiente de actualizar"}))})},ue=()=>{const l={...s.data(),usuarios:s.usuarios_asignados};delete l.usuarios_asignados,s.transform(()=>l).post(`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`,{onSuccess:()=>{E.success("Entregable creado correctamente")},onError:()=>{E.error("Error al crear el entregable")}})},ce=()=>{ge.get(`/admin/proyectos/${c.proyecto.id}/hitos/${c.hito.id}/entregables`)},eo=()=>{if(!w.value)return;if(s.usuarios_asignados.some(o=>o.user_id===w.value)){E.warning("Este usuario ya está asignado");return}s.usuarios_asignados.push({user_id:w.value,rol:z.value}),w.value=null,z.value="colaborador"},me=l=>{const o=s.usuarios_asignados.findIndex(r=>r.user_id===l);o>-1&&s.usuarios_asignados.splice(o,1)},y=l=>_.value.has(l)?_.value.get(l):c.usuarios.find(o=>o.id===l),oo=v(()=>{const l=s.usuarios_asignados.map(o=>o.user_id);return s.responsable_id&&l.push(s.responsable_id),c.usuarios.filter(o=>!l.includes(o.id))}),R=v(()=>{const l=[];return s.nombre||l.push("El nombre es requerido"),s.nombre.length>255&&l.push("El nombre no puede exceder 255 caracteres"),s.fecha_inicio&&s.fecha_fin&&new Date(s.fecha_inicio)>new Date(s.fecha_fin)&&l.push("La fecha de inicio no puede ser posterior a la fecha de fin"),s.responsable_id||l.push("Debe asignar un responsable"),l}),fe=v(()=>R.value.length===0&&!s.processing);return(l,o)=>(u(),h(ve,{breadcrumbs:re.value},{default:t(()=>[i("div",Ne,[i("div",null,[o[14]||(o[14]=i("h2",{class:"text-3xl font-bold tracking-tight"},"Nuevo Entregable",-1)),i("p",Se,' Agregar un nuevo entregable al hito "'+d(l.hito.nombre)+'" ',1)]),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),{class:"text-base"},{default:t(()=>[...o[15]||(o[15]=[n("Información del Hito",-1)])]),_:1})]),_:1}),a(e(C),null,{default:t(()=>[i("div",Ue,[i("div",null,[o[16]||(o[16]=i("p",{class:"text-sm text-muted-foreground"},"Hito",-1)),i("p",Be,d(l.hito.nombre),1)]),i("div",null,[o[17]||(o[17]=i("p",{class:"text-sm text-muted-foreground"},"Estado",-1)),a(e(Q),null,{default:t(()=>[n(d(l.hito.estado_label||l.hito.estado),1)]),_:1})]),i("div",null,[o[18]||(o[18]=i("p",{class:"text-sm text-muted-foreground"},"Progreso",-1)),i("p",Ee,d(l.hito.porcentaje_completado||0)+"%",1)])])]),_:1})]),_:1}),i("form",{onSubmit:be(ue,["prevent"]),class:"space-y-6"},[a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[19]||(o[19]=[n("Información Básica",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[20]||(o[20]=[n(" Datos principales del entregable ",-1)])]),_:1})]),_:1}),a(e(C),{class:"space-y-4"},{default:t(()=>[i("div",null,[a(e(b),{for:"nombre",class:"required"},{default:t(()=>[...o[21]||(o[21]=[n(" Nombre del entregable ",-1)])]),_:1}),a(e(T),{id:"nombre",modelValue:e(s).nombre,"onUpdate:modelValue":o[0]||(o[0]=r=>e(s).nombre=r),placeholder:"Ej: Documento de diseño técnico",class:F({"border-red-500":e(s).errors.nombre})},null,8,["modelValue","class"]),e(s).errors.nombre?(u(),m("p",Ae,d(e(s).errors.nombre),1)):p("",!0)]),i("div",null,[a(e(b),{for:"descripcion"},{default:t(()=>[...o[22]||(o[22]=[n(" Descripción ",-1)])]),_:1}),a(e(H),{id:"descripcion",modelValue:e(s).descripcion,"onUpdate:modelValue":o[1]||(o[1]=r=>e(s).descripcion=r),placeholder:"Describe el entregable y sus objetivos...",rows:"4",class:F({"border-red-500":e(s).errors.descripcion})},null,8,["modelValue","class"]),e(s).errors.descripcion?(u(),m("p",De,d(e(s).errors.descripcion),1)):p("",!0)]),i("div",Re,[i("div",null,[a(e(b),{for:"estado"},{default:t(()=>[...o[23]||(o[23]=[n(" Estado inicial ",-1)])]),_:1}),a(e(O),{modelValue:e(s).estado,"onUpdate:modelValue":o[2]||(o[2]=r=>e(s).estado=r)},{default:t(()=>[a(e(W),null,{default:t(()=>[a(e(X),{placeholder:"Seleccionar estado"})]),_:1}),a(e(J),null,{default:t(()=>[(u(!0),m(S,null,U(l.estados,r=>(u(),h(e(K),{key:r.value,value:r.value},{default:t(()=>[n(d(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),i("div",null,[a(e(b),{for:"prioridad"},{default:t(()=>[...o[24]||(o[24]=[n(" Prioridad ",-1)])]),_:1}),a(e(O),{modelValue:e(s).prioridad,"onUpdate:modelValue":o[3]||(o[3]=r=>e(s).prioridad=r)},{default:t(()=>[a(e(W),null,{default:t(()=>[a(e(X),{placeholder:"Seleccionar prioridad"})]),_:1}),a(e(J),null,{default:t(()=>[(u(!0),m(S,null,U(l.prioridades,r=>(u(),h(e(K),{key:r.value,value:r.value},{default:t(()=>[i("div",je,[a(e(Ve),{class:F(["h-4 w-4",{"text-blue-500":r.value==="baja","text-yellow-500":r.value==="media","text-red-500":r.value==="alta"}])},null,8,["class"]),n(" "+d(r.label),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[25]||(o[25]=[n("Fechas",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[26]||(o[26]=[n(" Define el período de ejecución del entregable ",-1)])]),_:1})]),_:1}),a(e(C),{class:"space-y-4"},{default:t(()=>[i("div",Ie,[i("div",null,[a(e(b),{for:"fecha_inicio"},{default:t(()=>[...o[27]||(o[27]=[n(" Fecha de inicio ",-1)])]),_:1}),a(e(T),{id:"fecha_inicio",modelValue:e(s).fecha_inicio,"onUpdate:modelValue":o[4]||(o[4]=r=>e(s).fecha_inicio=r),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_inicio?(u(),m("p",Fe,d(e(s).errors.fecha_inicio),1)):p("",!0)]),i("div",null,[a(e(b),{for:"fecha_fin"},{default:t(()=>[...o[28]||(o[28]=[n(" Fecha de fin ",-1)])]),_:1}),a(e(T),{id:"fecha_fin",modelValue:e(s).fecha_fin,"onUpdate:modelValue":o[5]||(o[5]=r=>e(s).fecha_fin=r),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_fin?(u(),m("p",Te,d(e(s).errors.fecha_fin),1)):p("",!0)])])]),_:1})]),_:1}),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[29]||(o[29]=[n("Asignación",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[30]||(o[30]=[n(" Asigna un responsable y colaboradores al entregable ",-1)])]),_:1})]),_:1}),a(e(C),{class:"space-y-4"},{default:t(()=>[i("div",null,[a(e(b),{for:"responsable",class:"required"},{default:t(()=>[...o[31]||(o[31]=[n(" Responsable principal ",-1)])]),_:1}),i("div",ze,[f.value?(u(),m("div",qe,[i("div",Pe,[a(e(Y),{class:"h-8 w-8"},{default:t(()=>[f.value.avatar?(u(),h(e(Z),{key:0,src:f.value.avatar},null,8,["src"])):p("",!0),a(e(ee),null,{default:t(()=>[n(d(f.value.name.substring(0,2).toUpperCase()),1)]),_:1})]),_:1}),i("div",null,[i("p",Le,d(f.value.name),1),i("p",Me,d(f.value.email),1)])]),a(e(x),{type:"button",variant:"ghost",size:"sm",onClick:o[6]||(o[6]=r=>e(s).responsable_id=null)},{default:t(()=>[a(e(ae),{class:"h-4 w-4"})]),_:1})])):p("",!0),a(e(x),{type:"button",variant:"outline",onClick:o[7]||(o[7]=r=>A.value=!0),class:"w-full"},{default:t(()=>[a(e(se),{class:"h-4 w-4 mr-2"}),n(" "+d(f.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(s).errors.responsable_id?(u(),m("p",Ge,d(e(s).errors.responsable_id),1)):p("",!0)]),i("div",null,[i("div",He,[a(e(b),null,{default:t(()=>[...o[32]||(o[32]=[n(" Colaboradores adicionales ",-1)])]),_:1}),a(e(x),{type:"button",variant:"outline",size:"sm",onClick:o[8]||(o[8]=r=>D.value=!0)},{default:t(()=>[a(e(se),{class:"mr-2 h-4 w-4"}),o[33]||(o[33]=n(" Agregar colaboradores ",-1))]),_:1})]),e(s).usuarios_asignados.length>0?(u(),m("div",Oe,[(u(!0),m(S,null,U(e(s).usuarios_asignados,r=>{var N,j;return u(),m("div",{key:r.user_id,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},[i("div",We,[a(e(Y),{class:"h-8 w-8"},{default:t(()=>{var I,P;return[(I=y(r.user_id))!=null&&I.avatar?(u(),h(e(Z),{key:0,src:(P=y(r.user_id))==null?void 0:P.avatar},null,8,["src"])):p("",!0),a(e(ee),null,{default:t(()=>{var L,M,G;return[n(d(((G=(M=(L=y(r.user_id))==null?void 0:L.name)==null?void 0:M.substring(0,2))==null?void 0:G.toUpperCase())||"US"),1)]}),_:2},1024)]}),_:2},1024),i("div",null,[i("p",Xe,d(((N=y(r.user_id))==null?void 0:N.name)||`Usuario #${r.user_id}`),1),i("p",Je,d(((j=y(r.user_id))==null?void 0:j.email)||""),1)]),a(e(Q),{variant:"outline"},{default:t(()=>[n(d(r.rol),1)]),_:2},1024)]),a(e(x),{type:"button",variant:"ghost",size:"sm",onClick:I=>me(r.user_id)},{default:t(()=>[a(e(ae),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])}),128))])):(u(),m("div",Ke," No hay colaboradores asignados ")),p("",!0)])]),_:1})]),_:1}),a(e(V),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(k),null,{default:t(()=>[...o[39]||(o[39]=[n("Notas adicionales",-1)])]),_:1}),a(e(B),null,{default:t(()=>[...o[40]||(o[40]=[n(" Información adicional o consideraciones especiales ",-1)])]),_:1})]),_:1}),a(e(C),null,{default:t(()=>[a(e(H),{modelValue:e(s).notas,"onUpdate:modelValue":o[11]||(o[11]=r=>e(s).notas=r),placeholder:"Notas adicionales sobre el entregable...",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),R.value.length>0?(u(),h(e(he),{key:0,variant:"destructive"},{default:t(()=>[a(e($e),{class:"h-4 w-4"}),a(e(xe),null,{default:t(()=>[i("ul",Qe,[(u(!0),m(S,null,U(R.value,r=>(u(),m("li",{key:r},d(r),1))),128))])]),_:1})]),_:1})):p("",!0),i("div",Ye,[a(e(x),{type:"button",variant:"outline",onClick:ce},{default:t(()=>[a(e(ke),{class:"mr-2 h-4 w-4"}),o[41]||(o[41]=n(" Cancelar ",-1))]),_:1}),a(e(x),{type:"submit",disabled:!fe.value},{default:t(()=>[a(e(Ce),{class:"mr-2 h-4 w-4"}),n(" "+d(e(s).processing?"Creando...":"Crear Entregable"),1)]),_:1},8,["disabled"])])],32)]),a(oe,{modelValue:A.value,"onUpdate:modelValue":o[12]||(o[12]=r=>A.value=r),title:"Seleccionar Responsable Principal",description:"Selecciona el usuario que será el responsable principal del entregable","search-endpoint":e(q)("admin.proyectos.search-users"),"excluded-ids":e(s).responsable_id?[e(s).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:ne},null,8,["modelValue","search-endpoint","excluded-ids"]),a(oe,{modelValue:D.value,"onUpdate:modelValue":o[13]||(o[13]=r=>D.value=r),title:"Agregar Colaboradores",description:"Selecciona los usuarios que colaborarán en este entregable","search-endpoint":e(q)("admin.proyectos.search-users"),"excluded-ids":ie.value,"extra-fields":le.value,"submit-button-text":"Agregar Colaboradores","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:de},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"])]),_:1},8,["breadcrumbs"]))}}),ua=we(Ze,[["__scopeId","data-v-aa0fe1de"]]);export{ua as default};
