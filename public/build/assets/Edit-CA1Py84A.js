import{d as we,C as Pe,r as F,c as N,o as Ae,y as Fe,b as y,e as n,w as r,g as d,f as t,i as p,j as f,u as o,P as Ne,h as l,t as v,l as Ie,F as w,k as P,W as j}from"./app-CbA_dzrH.js";import{_ as De}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DjfisSTq.js";import{_ as h,a as S,b as E,c as k}from"./CardTitle.vue_vue_type_script_setup_true_lang-Dpl1EP6e.js";import{_ as U}from"./CardDescription.vue_vue_type_script_setup_true_lang-FdnBhRW4.js";import{_ as x}from"./createLucideIcon-0y3HvBb2.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-Dw2oMjuZ.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-BHOcaT7W.js";import{_ as te}from"./Textarea.vue_vue_type_script_setup_true_lang-DNuak2_2.js";import{_ as O,a as T,b as M,c as R,d as C}from"./SelectValue.vue_vue_type_script_setup_true_lang-C7VbuHoF.js";import{_ as ae,a as re}from"./index-CMryySum.js";import{_ as je,a as Oe,b as I,c as D}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-nmj-UEmO.js";import{u as Te}from"./useToast-BWn_kELr.js";import{u as Me,_ as Re}from"./FileUploadField.vue_vue_type_script_setup_true_lang-BS4pHahu.js";import{u as Le}from"./useAutoSave-BhCs4tUl.js";import{_ as X}from"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-D_g2sy2e.js";import{_ as se}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-CFvHKQ5j.js";import{A as qe}from"./arrow-left-DWk22nOp.js";import{T as Be}from"./trash-2-di4yGiJv.js";import{C as Ge}from"./clock-Bx6DQ-_s.js";import{C as Je}from"./circle-check-big-CTzKScww.js";import{C as H}from"./circle-alert-CfNQ3Vlu.js";import{X as le}from"./x-CxSWfWOJ.js";import{U as We}from"./user-plus-t2hm4xO_.js";import{U as ie}from"./users-DLZP89St.js";import{S as Xe}from"./save-CybCtRtH.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-C4x6rJ8B.js";import"./index-D-PGeZ3t.js";import"./floating-ui.vue-D3EH1Xba.js";import"./index-BGfSt6nP.js";import"./shield-yBic2gp-.js";import"./user-BnDczykq.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-H44qAxpr.js";import"./chevron-right-pq_ChJ0s.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-H8FdC1v8.js";import"./VisuallyHidden-BOU54Fpc.js";import"./index-DzUkqZxm.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-fWHHAQt9.js";import"./index-CXCj42Z3.js";import"./map-pin-B0r5dLQM.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-nF_8TJte.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CPMNIlI6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B4CsJOKK.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BZUuILpY.js";import"./tag-DBRua3DS.js";import"./target-B8OPFMH2.js";import"./vote-5ymqB6Fb.js";import"./folder-open-B03CPFE8.js";import"./send-BUC0oswk.js";import"./file-text-DINmkRZl.js";import"./briefcase-BEGziJue.js";import"./calendar-BOFnEXb6.js";import"./megaphone-CDZIxwTF.js";import"./user-check-B3Jm4jmh.js";import"./clipboard-list-wMp9Eq1A.js";import"./mail-I3hCy8Tx.js";import"./message-square-RBI0Tfwc.js";import"./external-link-CKKN5QSr.js";import"./panel-left-ivBXt___.js";import"./index-MuREUf8q.js";import"./check-8t2yOxAa.js";import"./index-DPtKDKxs.js";import"./nullish-CHIgUVhi.js";import"./RovingFocusItem-CIXcS1m3.js";import"./utils-D2aazO7p.js";import"./upload-D1gsNalI.js";import"./file-Dr1J4OKH.js";import"./eye-CuQC-PD5.js";import"./download-B_RhEBu7.js";import"./debounce-BMmXVQ06.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-mf8fWrST.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-C3DQB5Q7.js";import"./VisuallyHiddenInput-BL93f7Ht.js";import"./circle-CCE7nO6y.js";import"./search-BT-o3QIf.js";import"./loader-circle-BA_4hMzh.js";import"./chevron-left-R6JGwNmv.js";const He={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ke={class:"flex items-center justify-between"},Qe={class:"flex items-center gap-4"},Ye={class:"text-gray-600 mt-1"},Ze={class:"flex gap-2"},eo={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},oo={key:3},to={key:4},ao={key:5},ro={class:"flex gap-2"},so={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lo={key:0,class:"text-red-500 text-sm mt-1"},io={key:0,class:"text-red-500 text-sm mt-1"},no={key:0,class:"text-red-500 text-sm mt-1"},uo={key:0,class:"space-y-4 pt-4 border-t"},mo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},po={key:0,class:"text-red-500 text-sm mt-1"},co={key:0,class:"text-red-500 text-sm mt-1"},fo={key:0,class:"text-red-500 text-sm mt-1"},vo={key:0,class:"text-red-500 text-sm mt-1"},_o={key:0},bo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},go={key:0,class:"text-red-500 text-sm mt-1"},yo={key:0,class:"text-red-500 text-sm mt-1"},xo={key:0,class:"space-y-4 pt-4 border-t"},Co={class:"space-y-6"},Vo={class:"space-y-4"},ho={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},So={class:"font-medium"},Eo={class:"text-sm text-muted-foreground"},ko={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$o={class:"space-y-4"},Uo={key:0,class:"space-y-2"},zo={class:"flex items-center justify-between"},wo={class:"font-medium"},Po={class:"text-sm text-muted-foreground"},Ao={class:"flex items-center gap-2 mt-1"},Fo={class:"text-xs bg-primary/10 text-primary px-2 py-1 rounded"},No={key:0,class:"text-xs text-muted-foreground"},Io={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},Do={key:0,class:"text-red-500 text-sm mt-1"},jo={key:0,class:"space-y-4 pt-4 border-t"},Oo={key:0,class:"flex justify-end gap-4"},da=we({__name:"Edit",props:{contrato:{},proyectos:{},camposPersonalizados:{},valoresCampos:{},usuarios:{default:()=>[]}},setup(ne){var ee,oe;const u=ne,g=Te(),{uploadFiles:de}=Me(),ue=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:u.contrato.nombre,href:`/admin/contratos/${u.contrato.id}`},{title:"Editar",href:`/admin/contratos/${u.contrato.id}/edit`}],me=()=>!u.contrato.participantes||u.contrato.participantes.length===0?[]:u.contrato.participantes.map(i=>{var e,m,s;return{user_id:((e=i.pivot)==null?void 0:e.user_id)||i.user_id||i.id,rol:((m=i.pivot)==null?void 0:m.rol)||i.rol||"participante",notas:((s=i.pivot)==null?void 0:s.notas)||i.notas||""}}),a=Pe({proyecto_id:u.contrato.proyecto_id.toString(),nombre:u.contrato.nombre,descripcion:u.contrato.descripcion||"",fecha_inicio:u.contrato.fecha_inicio,fecha_fin:u.contrato.fecha_fin||"",estado:u.contrato.estado,tipo:u.contrato.tipo,monto_total:((ee=u.contrato.monto_total)==null?void 0:ee.toString())||"",moneda:u.contrato.moneda,responsable_id:((oe=u.contrato.responsable_id)==null?void 0:oe.toString())||"none",contraparte_user_id:u.contrato.contraparte_user_id||null,contraparte_nombre:u.contrato.contraparte_nombre||"",contraparte_identificacion:u.contrato.contraparte_identificacion||"",contraparte_email:u.contrato.contraparte_email||"",contraparte_telefono:u.contrato.contraparte_telefono||"",participantes:me(),archivo_pdf:null,archivos_paths:u.contrato.archivos_paths||[],archivos_nombres:u.contrato.archivos_nombres||[],tipos_archivos:u.contrato.tipos_archivos||{},observaciones:u.contrato.observaciones||"",campos_personalizados:u.valoresCampos||{},_method:"PUT"}),pe=F(u.contrato.archivo_pdf?"Archivo actual: "+u.contrato.archivo_pdf.split("/").pop():""),L=F((u.contrato.archivos_paths||[]).map((i,e)=>{var m,s;return{id:`existing_${e}`,name:((m=u.contrato.archivos_nombres)==null?void 0:m[e])||i.split("/").pop()||"archivo",size:0,path:i,url:`/storage/${i}`,mime_type:((s=u.contrato.tipos_archivos)==null?void 0:s[i])||"application/octet-stream",uploaded_at:u.contrato.updated_at}})),K=F("informacion");F(!1);const J=F(!1),W=F(!1),{route:$}=window,ce=[{value:"USD",label:"USD - Dólar Estadounidense"},{value:"EUR",label:"EUR - Euro"},{value:"MXN",label:"MXN - Peso Mexicano"},{value:"COP",label:"COP - Peso Colombiano"},{value:"ARS",label:"ARS - Peso Argentino"},{value:"CLP",label:"CLP - Peso Chileno"},{value:"PEN",label:"PEN - Sol Peruano"}],q=N(()=>{var i;return a.contraparte_user_id?(i=u.usuarios)==null?void 0:i.find(e=>e.id===a.contraparte_user_id):null}),fe=N(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"testigo",label:"Testigo"},{value:"revisor",label:"Revisor"},{value:"aprobador",label:"Aprobador"},{value:"observador",label:"Observador"}],value:"testigo",required:!0},{name:"notas",label:"Notas (opcional)",type:"text",value:"",required:!1}]),ve=N(()=>{const i=a.participantes.map(e=>e.user_id);return a.contraparte_user_id&&i.push(a.contraparte_user_id),i}),_e=i=>{var e;if(i.userIds.length>0){a.contraparte_user_id=i.userIds[0];const m=(e=u.usuarios)==null?void 0:e.find(s=>s.id===i.userIds[0]);m&&(a.contraparte_nombre=m.name,a.contraparte_email=m.email||"")}},be=i=>{i.userIds.forEach(e=>{a.participantes.some(s=>s.user_id===e)||a.participantes.push({user_id:e,rol:i.extraData.rol||"testigo",notas:i.extraData.notas||""})})},ge=i=>{const e=a.participantes.findIndex(m=>m.user_id===i);e>-1&&a.participantes.splice(e,1)},Q=i=>{var e;return(e=u.usuarios)==null?void 0:e.find(m=>m.id===i)},A=N(()=>{const i={informacion:[],financiero:[],otros:[]};return u.camposPersonalizados.forEach(e=>{e.slug.includes("financ")||e.slug.includes("monto")||e.slug.includes("precio")?i.financiero.push(e):e.slug.includes("info")||e.slug.includes("descrip")?i.informacion.push(e):i.otros.push(e)}),i}),c=N(()=>u.contrato.estado!=="finalizado"&&u.contrato.estado!=="cancelado"),ye=N(()=>a.data()),{state:xe,isSaving:Y,hasSaved:Z,hasError:B,startWatching:Ce,stopAutoSave:Ve}=Le(ye,{url:`/admin/contratos/${u.contrato.id}/autosave`,resourceId:u.contrato.id,debounceTime:3e3,showNotifications:!0,useLocalStorage:!1}),he=i=>{const e=i.target;e.files&&e.files[0]&&(a.archivo_pdf=e.files[0],pe.value="Nuevo archivo: "+e.files[0].name)},Se=async i=>{try{const e=await de(i,{module:"contratos",fieldId:"archivos",folder:"contratos",maxSize:10485760}),m=e.map(V=>V.path),s=e.map(V=>V.name),_={};e.forEach(V=>{_[V.path]=V.mime_type}),a.archivos_paths=[...a.archivos_paths,...m],a.archivos_nombres=[...a.archivos_nombres,...s],a.tipos_archivos={...a.tipos_archivos,..._},L.value=[...L.value,...e],g.success(`${e.length} archivo(s) agregado(s) exitosamente`)}catch(e){g.error(e.message||"Error al subir archivos")}},Ee=()=>{const i=[];return a.proyecto_id||i.push("Debe seleccionar un proyecto"),a.nombre.trim()||i.push("El nombre del contrato es obligatorio"),a.fecha_inicio||i.push("La fecha de inicio es obligatoria"),a.fecha_fin&&a.fecha_fin<a.fecha_inicio&&i.push("La fecha de fin debe ser posterior a la fecha de inicio"),u.camposPersonalizados.forEach(e=>{e.es_requerido&&!a.campos_personalizados[e.id]&&i.push(`El campo "${e.nombre}" es obligatorio`)}),i},ke=()=>{const i=Ee();if(i.length>0){i.forEach(m=>g.error(m));return}const e=new FormData;Object.keys(a.data()).forEach(m=>{m==="campos_personalizados"?Object.keys(a.campos_personalizados).forEach(s=>{const _=a.campos_personalizados[s];_!=null&&_!==""&&e.append(`campos_personalizados[${s}]`,_)}):m==="participantes"?a.participantes.forEach((s,_)=>{e.append(`participantes[${_}][user_id]`,s.user_id.toString()),e.append(`participantes[${_}][rol]`,s.rol),s.notas&&e.append(`participantes[${_}][notas]`,s.notas)}):m==="archivos_paths"||m==="archivos_nombres"||m==="tipos_archivos"?m==="archivos_paths"&&Array.isArray(a.archivos_paths)&&a.archivos_paths.length>0?e.append("archivos_paths",JSON.stringify(a.archivos_paths)):m==="archivos_nombres"&&Array.isArray(a.archivos_nombres)&&a.archivos_nombres.length>0?e.append("archivos_nombres",JSON.stringify(a.archivos_nombres)):m==="tipos_archivos"&&a.tipos_archivos&&Object.keys(a.tipos_archivos).length>0&&e.append("tipos_archivos",JSON.stringify(a.tipos_archivos)):m==="archivo_pdf"&&a.archivo_pdf?e.append("archivo_pdf",a.archivo_pdf):m==="responsable_id"&&a[m]==="none"||m!=="_method"&&a[m]!==null&&a[m]!==""&&e.append(m,a[m])}),e.append("_method","PUT"),j.post($("admin.contratos.update",u.contrato.id),e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{g.success("Contrato actualizado exitosamente")},onError:m=>{typeof m=="object"&&m!==null?Object.values(m).forEach(s=>{Array.isArray(s)?s.forEach(_=>g.error(String(_))):typeof s=="string"?g.error(s):g.error("Error al actualizar el contrato")}):g.error("Error al actualizar el contrato")}})},$e=()=>{confirm("¿Está seguro de eliminar este contrato? Esta acción no se puede deshacer.")&&j.delete($("admin.contratos.destroy",u.contrato.id),{onSuccess:()=>{g.success("Contrato eliminado exitosamente")},onError:()=>{g.error("Error al eliminar el contrato")}})},Ue=()=>{confirm("¿Desea duplicar este contrato?")&&j.post($("admin.contratos.duplicar",u.contrato.id),{},{onSuccess:()=>{g.success("Contrato duplicado exitosamente")},onError:()=>{g.error("Error al duplicar el contrato")}})},G=i=>{j.post($("admin.contratos.cambiar-estado",u.contrato.id),{estado:i},{onSuccess:()=>{a.estado=i,g.success("Estado actualizado exitosamente")},onError:()=>{g.error("Error al cambiar el estado")}})},ze=()=>{confirm("¿Está seguro de cancelar? Los cambios no guardados se perderán.")&&j.get($("admin.contratos.show",u.contrato.id))};return Ae(()=>{c.value&&Ce()}),Fe(()=>{Ve()}),(i,e)=>(n(),y(De,{breadcrumbs:ue},{default:r(()=>{var m;return[d("div",He,[d("div",Ke,[d("div",Qe,[t(o(Ne),{href:o($)("admin.contratos.index")},{default:r(()=>[t(o(x),{variant:"ghost",size:"sm"},{default:r(()=>[t(o(qe),{class:"h-4 w-4 mr-2"}),e[26]||(e[26]=l(" Volver ",-1))]),_:1})]),_:1},8,["href"]),d("div",null,[e[27]||(e[27]=d("h1",{class:"text-3xl font-bold"},"Editar Contrato",-1)),d("p",Ye,"Modificar información del contrato #"+v(i.contrato.id),1)])]),d("div",Ze,[t(o(x),{variant:"outline",onClick:Ue},{default:r(()=>[...e[28]||(e[28]=[l(" Duplicar ",-1)])]),_:1}),t(o(x),{variant:"destructive",onClick:$e},{default:r(()=>[t(o(Be),{class:"h-4 w-4 mr-2"}),e[29]||(e[29]=l(" Eliminar ",-1))]),_:1})])]),c.value?(n(),p("div",eo,[o(Y)?(n(),y(o(Ge),{key:0,class:"h-4 w-4 animate-spin"})):o(Z)&&!o(B)?(n(),y(o(Je),{key:1,class:"h-4 w-4 text-green-600"})):o(B)?(n(),y(o(H),{key:2,class:"h-4 w-4 text-amber-600"})):f("",!0),o(Y)?(n(),p("span",oo,"Guardando cambios...")):o(Z)&&!o(B)?(n(),p("span",to,"Guardado a las "+v((m=o(xe).lastSaved)==null?void 0:m.toLocaleTimeString()),1)):o(B)?(n(),p("span",ao,"Error al guardar")):f("",!0)])):f("",!0),c.value?f("",!0):(n(),y(o(ae),{key:1,variant:"warning"},{default:r(()=>[t(o(H),{class:"h-4 w-4"}),t(o(re),null,{default:r(()=>[l(" Este contrato está "+v(i.contrato.estado)+" y no puede ser editado. ",1),i.contrato.estado==="finalizado"?(n(),y(o(x),{key:0,variant:"link",size:"sm",onClick:e[0]||(e[0]=s=>G("activo")),class:"ml-2"},{default:r(()=>[...e[30]||(e[30]=[l(" Reactivar ",-1)])]),_:1})):f("",!0)]),_:1})]),_:1})),c.value?(n(),y(o(h),{key:2},{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),{class:"text-lg"},{default:r(()=>[...e[31]||(e[31]=[l("Cambio Rápido de Estado",-1)])]),_:1})]),_:1}),t(o(k),null,{default:r(()=>[d("div",ro,[o(a).estado==="borrador"?(n(),y(o(x),{key:0,variant:"outline",size:"sm",onClick:e[1]||(e[1]=s=>G("activo"))},{default:r(()=>[...e[32]||(e[32]=[l(" Activar Contrato ",-1)])]),_:1})):f("",!0),o(a).estado==="activo"?(n(),y(o(x),{key:1,variant:"outline",size:"sm",onClick:e[2]||(e[2]=s=>G("finalizado"))},{default:r(()=>[...e[33]||(e[33]=[l(" Finalizar Contrato ",-1)])]),_:1})):f("",!0),o(a).estado!=="cancelado"?(n(),y(o(x),{key:2,variant:"outline",size:"sm",class:"text-red-600",onClick:e[3]||(e[3]=s=>G("cancelado"))},{default:r(()=>[...e[34]||(e[34]=[l(" Cancelar Contrato ",-1)])]),_:1})):f("",!0)])]),_:1})]),_:1})):f("",!0),d("form",{onSubmit:Ie(ke,["prevent"]),class:"space-y-6"},[t(o(je),{modelValue:K.value,"onUpdate:modelValue":e[23]||(e[23]=s=>K.value=s)},{default:r(()=>[t(o(Oe),{class:"grid w-full grid-cols-6"},{default:r(()=>[t(o(I),{value:"informacion"},{default:r(()=>[...e[35]||(e[35]=[l("Información General",-1)])]),_:1}),t(o(I),{value:"fechas"},{default:r(()=>[...e[36]||(e[36]=[l("Fechas y Estado",-1)])]),_:1}),t(o(I),{value:"financiero"},{default:r(()=>[...e[37]||(e[37]=[l("Información Financiera",-1)])]),_:1}),t(o(I),{value:"contraparte"},{default:r(()=>[...e[38]||(e[38]=[l("Contraparte",-1)])]),_:1}),t(o(I),{value:"archivos"},{default:r(()=>[...e[39]||(e[39]=[l("Archivos",-1)])]),_:1}),t(o(I),{value:"adicional"},{default:r(()=>[...e[40]||(e[40]=[l("Información Adicional",-1)])]),_:1})]),_:1}),t(o(D),{value:"informacion"},{default:r(()=>[t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[41]||(e[41]=[l("Información General",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[42]||(e[42]=[l("Datos principales del contrato",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:r(()=>[d("div",so,[d("div",null,[t(o(b),{for:"proyecto_id"},{default:r(()=>[...e[43]||(e[43]=[l("Proyecto *",-1)])]),_:1}),t(o(O),{modelValue:o(a).proyecto_id,"onUpdate:modelValue":e[4]||(e[4]=s=>o(a).proyecto_id=s),disabled:!c.value},{default:r(()=>[t(o(T),null,{default:r(()=>[t(o(M),{placeholder:"Seleccione un proyecto"})]),_:1}),t(o(R),null,{default:r(()=>[(n(!0),p(w,null,P(i.proyectos,s=>(n(),y(o(C),{key:s.id,value:s.id.toString()},{default:r(()=>[l(v(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),o(a).errors.proyecto_id?(n(),p("div",lo,v(o(a).errors.proyecto_id),1)):f("",!0)]),d("div",null,[t(o(b),{for:"nombre"},{default:r(()=>[...e[44]||(e[44]=[l("Nombre del Contrato *",-1)])]),_:1}),t(o(z),{id:"nombre",modelValue:o(a).nombre,"onUpdate:modelValue":e[5]||(e[5]=s=>o(a).nombre=s),placeholder:"Ej: Contrato de servicios de consultoría",disabled:!c.value},null,8,["modelValue","disabled"]),o(a).errors.nombre?(n(),p("div",io,v(o(a).errors.nombre),1)):f("",!0)])]),d("div",null,[t(o(b),{for:"descripcion"},{default:r(()=>[...e[45]||(e[45]=[l("Descripción",-1)])]),_:1}),t(o(te),{id:"descripcion",modelValue:o(a).descripcion,"onUpdate:modelValue":e[6]||(e[6]=s=>o(a).descripcion=s),placeholder:"Descripción detallada del contrato...",rows:"4",disabled:!c.value},null,8,["modelValue","disabled"]),o(a).errors.descripcion?(n(),p("div",no,v(o(a).errors.descripcion),1)):f("",!0)]),A.value.informacion.length>0?(n(),p("div",uo,[e[46]||(e[46]=d("h3",{class:"font-medium"},"Información Complementaria",-1)),(n(!0),p(w,null,P(A.value.informacion,s=>(n(),p("div",{key:s.id},[t(X,{campo:s,modelValue:o(a).campos_personalizados[s.id],"onUpdate:modelValue":_=>o(a).campos_personalizados[s.id]=_,disabled:!c.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):f("",!0)]),_:1})]),_:1})]),_:1}),t(o(D),{value:"fechas"},{default:r(()=>[t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[47]||(e[47]=[l("Fechas y Estado",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[48]||(e[48]=[l("Configure las fechas y el estado del contrato",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:r(()=>[d("div",mo,[d("div",null,[t(o(b),{for:"fecha_inicio"},{default:r(()=>[...e[49]||(e[49]=[l("Fecha de Inicio *",-1)])]),_:1}),t(o(z),{id:"fecha_inicio",type:"date",modelValue:o(a).fecha_inicio,"onUpdate:modelValue":e[7]||(e[7]=s=>o(a).fecha_inicio=s),disabled:!c.value},null,8,["modelValue","disabled"]),o(a).errors.fecha_inicio?(n(),p("div",po,v(o(a).errors.fecha_inicio),1)):f("",!0)]),d("div",null,[t(o(b),{for:"fecha_fin"},{default:r(()=>[...e[50]||(e[50]=[l("Fecha de Fin",-1)])]),_:1}),t(o(z),{id:"fecha_fin",type:"date",modelValue:o(a).fecha_fin,"onUpdate:modelValue":e[8]||(e[8]=s=>o(a).fecha_fin=s),disabled:!c.value},null,8,["modelValue","disabled"]),o(a).errors.fecha_fin?(n(),p("div",co,v(o(a).errors.fecha_fin),1)):f("",!0)]),d("div",null,[t(o(b),{for:"estado"},{default:r(()=>[...e[51]||(e[51]=[l("Estado",-1)])]),_:1}),t(o(O),{modelValue:o(a).estado,"onUpdate:modelValue":e[9]||(e[9]=s=>o(a).estado=s),disabled:!c.value},{default:r(()=>[t(o(T),null,{default:r(()=>[t(o(M))]),_:1}),t(o(R),null,{default:r(()=>[t(o(C),{value:"borrador"},{default:r(()=>[...e[52]||(e[52]=[l("Borrador",-1)])]),_:1}),t(o(C),{value:"activo"},{default:r(()=>[...e[53]||(e[53]=[l("Activo",-1)])]),_:1}),t(o(C),{value:"finalizado"},{default:r(()=>[...e[54]||(e[54]=[l("Finalizado",-1)])]),_:1}),t(o(C),{value:"cancelado"},{default:r(()=>[...e[55]||(e[55]=[l("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(a).errors.estado?(n(),p("div",fo,v(o(a).errors.estado),1)):f("",!0)]),d("div",null,[t(o(b),{for:"tipo"},{default:r(()=>[...e[56]||(e[56]=[l("Tipo de Contrato *",-1)])]),_:1}),t(o(O),{modelValue:o(a).tipo,"onUpdate:modelValue":e[10]||(e[10]=s=>o(a).tipo=s),disabled:!c.value},{default:r(()=>[t(o(T),null,{default:r(()=>[t(o(M))]),_:1}),t(o(R),null,{default:r(()=>[t(o(C),{value:"servicio"},{default:r(()=>[...e[57]||(e[57]=[l("Servicio",-1)])]),_:1}),t(o(C),{value:"obra"},{default:r(()=>[...e[58]||(e[58]=[l("Obra",-1)])]),_:1}),t(o(C),{value:"suministro"},{default:r(()=>[...e[59]||(e[59]=[l("Suministro",-1)])]),_:1}),t(o(C),{value:"consultoria"},{default:r(()=>[...e[60]||(e[60]=[l("Consultoría",-1)])]),_:1}),t(o(C),{value:"otro"},{default:r(()=>[...e[61]||(e[61]=[l("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(a).errors.tipo?(n(),p("div",vo,v(o(a).errors.tipo),1)):f("",!0)])]),i.usuarios?(n(),p("div",_o,[t(o(b),{for:"responsable_id"},{default:r(()=>[...e[62]||(e[62]=[l("Responsable",-1)])]),_:1}),t(o(O),{modelValue:o(a).responsable_id,"onUpdate:modelValue":e[11]||(e[11]=s=>o(a).responsable_id=s),disabled:!c.value},{default:r(()=>[t(o(T),null,{default:r(()=>[t(o(M),{placeholder:"Seleccione un responsable"})]),_:1}),t(o(R),null,{default:r(()=>[t(o(C),{value:"none"},{default:r(()=>[...e[63]||(e[63]=[l("Sin responsable",-1)])]),_:1}),(n(!0),p(w,null,P(i.usuarios,s=>(n(),y(o(C),{key:s.id,value:s.id.toString()},{default:r(()=>[l(v(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])])):f("",!0)]),_:1})]),_:1})]),_:1}),t(o(D),{value:"financiero"},{default:r(()=>[t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[64]||(e[64]=[l("Información Financiera",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[65]||(e[65]=[l("Montos y detalles financieros del contrato",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:r(()=>[d("div",bo,[d("div",null,[t(o(b),{for:"monto_total"},{default:r(()=>[...e[66]||(e[66]=[l("Monto Total",-1)])]),_:1}),t(o(z),{id:"monto_total",type:"number",step:"0.01",modelValue:o(a).monto_total,"onUpdate:modelValue":e[12]||(e[12]=s=>o(a).monto_total=s),placeholder:"0.00",disabled:!c.value},null,8,["modelValue","disabled"]),o(a).errors.monto_total?(n(),p("div",go,v(o(a).errors.monto_total),1)):f("",!0)]),d("div",null,[t(o(b),{for:"moneda"},{default:r(()=>[...e[67]||(e[67]=[l("Moneda",-1)])]),_:1}),t(o(O),{modelValue:o(a).moneda,"onUpdate:modelValue":e[13]||(e[13]=s=>o(a).moneda=s),disabled:!c.value},{default:r(()=>[t(o(T),null,{default:r(()=>[t(o(M))]),_:1}),t(o(R),null,{default:r(()=>[(n(),p(w,null,P(ce,s=>t(o(C),{key:s.value,value:s.value},{default:r(()=>[l(v(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue","disabled"]),o(a).errors.moneda?(n(),p("div",yo,v(o(a).errors.moneda),1)):f("",!0)])]),A.value.financiero.length>0?(n(),p("div",xo,[e[68]||(e[68]=d("h3",{class:"font-medium"},"Campos Financieros Personalizados",-1)),(n(!0),p(w,null,P(A.value.financiero,s=>(n(),p("div",{key:s.id},[t(X,{campo:s,modelValue:o(a).campos_personalizados[s.id],"onUpdate:modelValue":_=>o(a).campos_personalizados[s.id]=_,disabled:!c.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):f("",!0)]),_:1})]),_:1})]),_:1}),t(o(D),{value:"contraparte"},{default:r(()=>[d("div",Co,[t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[69]||(e[69]=[l("Contraparte - Usuario del Sistema",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[70]||(e[70]=[l(" Seleccione un usuario del sistema como contraparte del contrato ",-1)])]),_:1})]),_:1}),t(o(k),null,{default:r(()=>[d("div",Vo,[d("div",null,[t(o(b),null,{default:r(()=>[...e[71]||(e[71]=[l("Usuario Contraparte",-1)])]),_:1}),e[72]||(e[72]=d("p",{class:"text-sm text-muted-foreground mb-2"}," Si la contraparte es un usuario registrado en el sistema, selecciónelo aquí ",-1))]),q.value?(n(),p("div",ho,[d("div",null,[d("p",So,v(q.value.name),1),d("p",Eo,v(q.value.email),1)]),t(o(x),{type:"button",variant:"ghost",size:"sm",onClick:e[14]||(e[14]=s=>{o(a).contraparte_user_id=null,o(a).contraparte_nombre="",o(a).contraparte_email=""}),disabled:!c.value},{default:r(()=>[t(o(le),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):f("",!0),t(o(x),{type:"button",variant:"outline",onClick:e[15]||(e[15]=s=>J.value=!0),class:"w-full",disabled:!c.value},{default:r(()=>[t(o(We),{class:"h-4 w-4 mr-2"}),l(" "+v(q.value?"Cambiar Contraparte":"Seleccionar Contraparte"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[73]||(e[73]=[l("Contraparte - Información Externa",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[74]||(e[74]=[l(" Complete estos campos si la contraparte no es un usuario del sistema ",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:r(()=>[o(a).contraparte_user_id?(n(),y(o(ae),{key:0,class:"mb-4"},{default:r(()=>[t(o(H),{class:"h-4 w-4"}),t(o(re),null,{default:r(()=>[...e[75]||(e[75]=[l(" Los campos de contraparte externa están deshabilitados porque ya se seleccionó un usuario del sistema. ",-1)])]),_:1})]),_:1})):f("",!0),d("div",ko,[d("div",null,[t(o(b),{for:"contraparte_nombre"},{default:r(()=>[...e[76]||(e[76]=[l("Nombre de la Contraparte",-1)])]),_:1}),t(o(z),{id:"contraparte_nombre",modelValue:o(a).contraparte_nombre,"onUpdate:modelValue":e[16]||(e[16]=s=>o(a).contraparte_nombre=s),placeholder:"Nombre de la empresa o persona",disabled:!c.value||!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])]),d("div",null,[t(o(b),{for:"contraparte_identificacion"},{default:r(()=>[...e[77]||(e[77]=[l("Identificación/RUC",-1)])]),_:1}),t(o(z),{id:"contraparte_identificacion",modelValue:o(a).contraparte_identificacion,"onUpdate:modelValue":e[17]||(e[17]=s=>o(a).contraparte_identificacion=s),placeholder:"Número de identificación",disabled:!c.value||!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])]),d("div",null,[t(o(b),{for:"contraparte_email"},{default:r(()=>[...e[78]||(e[78]=[l("Email de Contacto",-1)])]),_:1}),t(o(z),{id:"contraparte_email",type:"email",modelValue:o(a).contraparte_email,"onUpdate:modelValue":e[18]||(e[18]=s=>o(a).contraparte_email=s),placeholder:"email@ejemplo.com",disabled:!c.value||!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])]),d("div",null,[t(o(b),{for:"contraparte_telefono"},{default:r(()=>[...e[79]||(e[79]=[l("Teléfono de Contacto",-1)])]),_:1}),t(o(z),{id:"contraparte_telefono",modelValue:o(a).contraparte_telefono,"onUpdate:modelValue":e[19]||(e[19]=s=>o(a).contraparte_telefono=s),placeholder:"+1234567890",disabled:!c.value||!!o(a).contraparte_user_id},null,8,["modelValue","disabled"])])])]),_:1})]),_:1}),t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[80]||(e[80]=[l("Participantes del Contrato",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[81]||(e[81]=[l(" Agregue usuarios del sistema que participarán en este contrato con diferentes roles ",-1)])]),_:1})]),_:1}),t(o(k),null,{default:r(()=>[d("div",$o,[t(o(x),{type:"button",variant:"outline",onClick:e[20]||(e[20]=s=>W.value=!0),class:"w-full",disabled:!c.value},{default:r(()=>[t(o(ie),{class:"h-4 w-4 mr-2"}),e[82]||(e[82]=l(" Agregar Participantes ",-1))]),_:1},8,["disabled"]),o(a).participantes.length>0?(n(),p("div",Uo,[e[83]||(e[83]=d("p",{class:"text-sm font-medium text-muted-foreground"},"Participantes agregados:",-1)),(n(!0),p(w,null,P(o(a).participantes,s=>{var _,V;return n(),p("div",{key:s.user_id,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[d("div",zo,[d("div",null,[d("p",wo,v((_=Q(s.user_id))==null?void 0:_.name),1),d("p",Po,v((V=Q(s.user_id))==null?void 0:V.email),1),d("div",Ao,[d("span",Fo,v(s.rol),1),s.notas?(n(),p("span",No,v(s.notas),1)):f("",!0)])]),t(o(x),{type:"button",variant:"ghost",size:"sm",onClick:To=>ge(s.user_id),disabled:!c.value},{default:r(()=>[t(o(le),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])])])}),128))])):(n(),p("div",Io,[t(o(ie),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),e[84]||(e[84]=d("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))]))])]),_:1})]),_:1})])]),_:1}),t(o(D),{value:"archivos"},{default:r(()=>[t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[85]||(e[85]=[l("Archivos del Contrato",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[86]||(e[86]=[l("Sube múltiples archivos relacionados con el contrato (máximo 10)",-1)])]),_:1})]),_:1}),t(o(k),null,{default:r(()=>[t(Re,{modelValue:L.value,"onUpdate:modelValue":e[21]||(e[21]=s=>L.value=s),label:"Archivos",description:"Agrega archivos adicionales al contrato (PDF, imágenes, documentos)",onFilesSelected:Se,multiple:!0,maxFiles:10,maxFileSize:10,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.xls,.xlsx",autoUpload:!1,disabled:!c.value,module:"contratos",fieldId:"archivos"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(o(D),{value:"adicional"},{default:r(()=>[t(o(h),null,{default:r(()=>[t(o(S),null,{default:r(()=>[t(o(E),null,{default:r(()=>[...e[87]||(e[87]=[l("Información Adicional",-1)])]),_:1}),t(o(U),null,{default:r(()=>[...e[88]||(e[88]=[l("Observaciones y campos personalizados",-1)])]),_:1})]),_:1}),t(o(k),{class:"space-y-4"},{default:r(()=>[d("div",null,[t(o(b),{for:"observaciones"},{default:r(()=>[...e[89]||(e[89]=[l("Observaciones",-1)])]),_:1}),t(o(te),{id:"observaciones",modelValue:o(a).observaciones,"onUpdate:modelValue":e[22]||(e[22]=s=>o(a).observaciones=s),placeholder:"Notas u observaciones adicionales...",rows:"4",disabled:!c.value},null,8,["modelValue","disabled"]),o(a).errors.observaciones?(n(),p("div",Do,v(o(a).errors.observaciones),1)):f("",!0)]),A.value.otros.length>0?(n(),p("div",jo,[e[90]||(e[90]=d("h3",{class:"font-medium"},"Campos Personalizados",-1)),(n(!0),p(w,null,P(A.value.otros,s=>(n(),p("div",{key:s.id},[t(X,{campo:s,modelValue:o(a).campos_personalizados[s.id],"onUpdate:modelValue":_=>o(a).campos_personalizados[s.id]=_,disabled:!c.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),c.value?(n(),p("div",Oo,[t(o(x),{type:"button",variant:"outline",onClick:ze,disabled:o(a).processing},{default:r(()=>[...e[91]||(e[91]=[l(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(o(x),{type:"submit",disabled:o(a).processing},{default:r(()=>[t(o(Xe),{class:"h-4 w-4 mr-2"}),l(" "+v(o(a).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])):f("",!0)],32)]),d("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:he,class:"hidden"},null,544),t(se,{modelValue:J.value,"onUpdate:modelValue":e[24]||(e[24]=s=>J.value=s),title:"Seleccionar Contraparte",description:"Selecciona el usuario que será la contraparte del contrato","search-endpoint":o($)("admin.proyectos.search-users"),"excluded-ids":o(a).contraparte_user_id?[o(a).contraparte_user_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Contraparte","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:_e},null,8,["modelValue","search-endpoint","excluded-ids"]),t(se,{modelValue:W.value,"onUpdate:modelValue":e[25]||(e[25]=s=>W.value=s),title:"Agregar Participantes",description:"Selecciona los usuarios que participarán en este contrato y define su rol","search-endpoint":o($)("admin.proyectos.search-users"),"excluded-ids":ve.value,"extra-fields":fe.value,"submit-button-text":"Agregar Participantes","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:be},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"])]}),_:1}))}});export{da as default};
