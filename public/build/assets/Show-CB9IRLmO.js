import{_ as re}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dz6BU1WZ.js";import{d as te,r as L,c as O,b as h,e as n,w as r,f as a,u as s,g as e,j as g,h as u,t as d,i as f,F as N,k as U,n as B,q as se,s as ie,W as k,p as ne,P as C}from"./app-p-SM0Ops.js";import{a as D,b as q,c as S,_ as T}from"./CardTitle.vue_vue_type_script_setup_true_lang-DozlB1PY.js";import{_ as x}from"./createLucideIcon-MIg_mF3D.js";import{_ as A}from"./index-CYyE4abP.js";import{_ as Z}from"./Progress.vue_vue_type_script_setup_true_lang-BXlQYfAy.js";import{t as P}from"./index-BhJRJLQS.js";import{E as le}from"./EtiquetaDisplay-D5WZr5kN.js";import{E as de}from"./EtiquetaSelector-DgcVd9G8.js";import{_ as ce}from"./CardDescription.vue_vue_type_script_setup_true_lang-BhGQy1jY.js";import{_ as ue,a as me}from"./ScrollArea.vue_vue_type_script_setup_true_lang-De1gvssV.js";import{C as pe}from"./chevron-left-iYWTDPaa.js";import{C as W}from"./calendar-BUpz3t_q.js";import{C as fe}from"./chevron-right-BbAT6tF1.js";import{F as X}from"./file-text-jtWGolJY.js";import{C as ye}from"./circle-x-BNOKyZvF.js";import{C as Q}from"./circle-check-big-BNHkXK8a.js";import{C as ge}from"./circle-C6AoGhat.js";import{L as ve,H as he}from"./HitoCard-CF7YEW1-.js";import{S as J}from"./square-pen-BWVg_XIm.js";import{T as _e}from"./trash-2-DCkletDg.js";import{F as be}from"./flag-Dcqpm68F.js";import{C as xe}from"./clock-Dq08RDBb.js";import{T as we}from"./tag-CxhrnRvl.js";import{P as G}from"./plus-BIpQAtiE.js";import{T as K}from"./target-BcAOpLLG.js";import{U as ee}from"./user-DA3oYWTo.js";import{B as ke,C as $e}from"./circle-pause-BGGqYuLB.js";import{C as Ee}from"./circle-play-CoxgRVYk.js";import{C as Ce}from"./circle-alert-B1uyACGR.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-V1RlDTXZ.js";import"./index-CV2_GSGp.js";import"./floating-ui.vue-BUomiQTN.js";import"./x-DIIigy9X.js";import"./Input.vue_vue_type_script_setup_true_lang-K4vq7am0.js";import"./index-v7Q0x2oQ.js";import"./index-B8ZQ7oBZ.js";import"./shield-DhBDny61.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-IihS8Mqq.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BGm8qVny.js";import"./VisuallyHidden-xAPYqC-I.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-DmzPrX3Z.js";import"./check-BZs3ZfEg.js";import"./nullish-CHIgUVhi.js";import"./Label.vue_vue_type_script_setup_true_lang-DP74BK5K.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-RRitD80w.js";import"./map-pin-Bfx6LXpH.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DUTBsYNH.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CR-w-QPj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-DBABEqEn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DSG5kKOT.js";import"./users-CkPSsqjA.js";import"./vote-CVUS9BZZ.js";import"./folder-open-CCLrFQyu.js";import"./send-DdhYBIuO.js";import"./briefcase-BnY2GosT.js";import"./megaphone-5qsXSNwm.js";import"./user-check-BjIqumpS.js";import"./mail-DTHbsAgc.js";import"./message-square-DNZUf9k0.js";import"./external-link-CtMP5nJn.js";import"./panel-left-LG19zA78.js";import"./index-B7vJyW42.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DsrlcqOi.js";import"./layers-CmxSAPr7.js";import"./zap-D-7VuO05.js";import"./trending-up-BWwsn8oN.js";import"./award-mM1uxKDc.js";import"./hash-DpHSFTEj.js";import"./TabsTrigger.vue_vue_type_script_setup_true_lang-CjvxnSKP.js";import"./RovingFocusItem-DfjJacyF.js";import"./utils-C4hwUYix.js";import"./index-wTFukAZ3.js";import"./search-nFjyMy1p.js";import"./useKbd-kRIii9yh.js";import"./VisuallyHiddenInput-CylejRDg.js";import"./useEtiquetaHierarchy-rdKvmi-g.js";import"./list-C-bdkpgU.js";import"./tree-pine-CnaTjpiX.js";import"./CardFooter.vue_vue_type_script_setup_true_lang-Cw9gQ1y7.js";import"./ellipsis-B23Fgsj6.js";import"./pen-C4qa0iIv.js";import"./copy-BCJtg9ZO.js";import"./calendar-days-DTkm50hi.js";import"./eye-UAhQZ5GK.js";import"./es-BDPlFIsO.js";const De={class:"flex justify-between items-start"},qe={class:"flex items-center gap-2"},Se={key:0,class:"grid grid-cols-4 gap-4 mb-6"},Te={class:"text-center"},ze={class:"text-2xl font-bold text-green-600"},He={class:"text-center"},Pe={class:"text-2xl font-bold text-blue-600"},je={class:"text-center"},Me={class:"text-2xl font-bold text-gray-600"},Ve={class:"text-center"},Be={class:"text-2xl font-bold text-red-600"},Ae={key:1,class:"space-y-4"},Fe={key:0,class:"flex items-center justify-between mb-4"},Ne={class:"flex items-center gap-2"},Le={class:"font-medium"},Re={class:"flex gap-2"},Ie={class:"space-y-2"},Ue={key:0,class:"absolute left-5 top-8 w-0.5 h-full bg-border"},Oe={class:"relative z-10 flex-shrink-0"},Ge={class:"flex-1 min-w-0"},We={class:"flex items-start justify-between gap-4"},Xe={class:"font-semibold truncate"},Je={class:"flex items-center gap-4 mt-1 text-sm text-muted-foreground"},Ke={class:"flex items-center gap-1"},Qe={key:0,class:"flex items-center gap-1"},Ye={key:0,class:"text-right"},Ze={class:"font-semibold"},et={class:"text-xs text-muted-foreground"},tt={key:0,class:"mt-2"},st={class:"w-full bg-muted rounded-full h-2"},ot={key:2,class:"text-center py-8"},at=te({__name:"ContratoTimeline",props:{contratos:{},titulo:{},descripcion:{},mostrarMonto:{type:Boolean},compacto:{type:Boolean}},setup(b){const c=b,w=L(new Date),E=L(!1),H=O(()=>({activos:c.contratos.filter(l=>l.estado==="activo").length,finalizados:c.contratos.filter(l=>l.estado==="finalizado").length,borradores:c.contratos.filter(l=>l.estado==="borrador").length,cancelados:c.contratos.filter(l=>l.estado==="cancelado").length})),j=O(()=>[...c.contratos].sort((i,l)=>new Date(i.fecha_inicio).getTime()-new Date(l.fecha_inicio).getTime())),M=O(()=>{if(c.contratos.length===0)return null;const i=c.contratos.flatMap($=>[new Date($.fecha_inicio),$.fecha_fin?new Date($.fecha_fin):new Date($.fecha_inicio)]),l=new Date(Math.min(...i.map($=>$.getTime()))),p=new Date(Math.max(...i.map($=>$.getTime())));return{min:l,max:p}});O(()=>{if(!M.value)return[];const i=[],l=new Date(M.value.min);for(l.setDate(1);l<=M.value.max;)i.push(new Date(l)),l.setMonth(l.getMonth()+1);return i});const R=i=>({borrador:{color:"secondary",icon:X,label:"Borrador"},activo:{color:"success",icon:Q,label:"Activo"},finalizado:{color:"default",icon:Q,label:"Finalizado"},cancelado:{color:"destructive",icon:ye,label:"Cancelado"}})[i]||{color:"default",icon:ge,label:i},I=i=>i.toLocaleDateString("es-ES",{month:"long",year:"numeric"}),F=i=>new Date(i).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}),V=i=>i.estado!=="activo"||!i.fecha_fin?!1:new Date(i.fecha_fin)<new Date,z=i=>{if(i.estado!=="activo"||!i.fecha_fin)return!1;const l=Math.ceil((new Date(i.fecha_fin).getTime()-new Date().getTime())/(1e3*60*60*24));return l>0&&l<=30},v=()=>{const i=new Date(w.value);i.setMonth(i.getMonth()-1),w.value=i},m=()=>{const i=new Date(w.value);i.setMonth(i.getMonth()+1),w.value=i},_=()=>{w.value=new Date};return(i,l)=>(n(),h(s(T),null,{default:r(()=>[a(s(D),null,{default:r(()=>[e("div",De,[e("div",null,[a(s(q),null,{default:r(()=>[u(d(i.titulo||"Timeline de Contratos"),1)]),_:1}),i.descripcion?(n(),h(s(ce),{key:0},{default:r(()=>[u(d(i.descripcion),1)]),_:1})):g("",!0)]),e("div",qe,[a(s(A),{variant:"outline"},{default:r(()=>[u(d(i.contratos.length)+" contratos ",1)]),_:1}),i.compacto?g("",!0):(n(),h(s(x),{key:0,onClick:l[0]||(l[0]=p=>E.value=!E.value),size:"sm",variant:"outline"},{default:r(()=>[u(d(E.value?"Vista compacta":"Vista expandida"),1)]),_:1}))])])]),_:1}),a(s(S),null,{default:r(()=>[i.compacto?g("",!0):(n(),f("div",Se,[e("div",Te,[e("div",ze,d(H.value.activos),1),l[1]||(l[1]=e("div",{class:"text-xs text-muted-foreground"},"Activos",-1))]),e("div",He,[e("div",Pe,d(H.value.finalizados),1),l[2]||(l[2]=e("div",{class:"text-xs text-muted-foreground"},"Finalizados",-1))]),e("div",je,[e("div",Me,d(H.value.borradores),1),l[3]||(l[3]=e("div",{class:"text-xs text-muted-foreground"},"Borradores",-1))]),e("div",Ve,[e("div",Be,d(H.value.cancelados),1),l[4]||(l[4]=e("div",{class:"text-xs text-muted-foreground"},"Cancelados",-1))])])),i.contratos.length>0?(n(),f("div",Ae,[i.compacto?g("",!0):(n(),f("div",Fe,[a(s(x),{onClick:v,size:"sm",variant:"outline"},{default:r(()=>[a(s(pe),{class:"w-4 h-4"})]),_:1}),e("div",Ne,[a(s(W),{class:"w-4 h-4 text-muted-foreground"}),e("span",Le,d(I(w.value)),1)]),e("div",Re,[a(s(x),{onClick:_,size:"sm",variant:"outline"},{default:r(()=>[...l[5]||(l[5]=[u(" Hoy ",-1)])]),_:1}),a(s(x),{onClick:m,size:"sm",variant:"outline"},{default:r(()=>[a(s(fe),{class:"w-4 h-4"})]),_:1})])])),a(s(ue),{class:"w-full whitespace-nowrap"},{default:r(()=>[e("div",Ie,[(n(!0),f(N,null,U(j.value,(p,$)=>(n(),f("div",{key:p.id,class:"relative flex items-center gap-4 p-3 rounded-lg hover:bg-muted/50 transition-colors"},[$<j.value.length-1?(n(),f("div",Ue)):g("",!0),e("div",Oe,[e("div",{class:B(["w-10 h-10 rounded-full flex items-center justify-center",{"bg-green-100":p.estado==="activo","bg-blue-100":p.estado==="finalizado","bg-gray-100":p.estado==="borrador","bg-red-100":p.estado==="cancelado"}])},[(n(),h(se(R(p.estado).icon),{class:B(["w-5 h-5",{"text-green-600":p.estado==="activo","text-blue-600":p.estado==="finalizado","text-gray-600":p.estado==="borrador","text-red-600":p.estado==="cancelado"}])},null,8,["class"]))],2)]),e("div",Ge,[e("div",We,[e("div",null,[e("h4",Xe,d(p.nombre),1),e("div",Je,[e("span",Ke,[a(s(W),{class:"w-3 h-3"}),u(" "+d(F(p.fecha_inicio)),1)]),p.fecha_fin?(n(),f("span",Qe," → "+d(F(p.fecha_fin)),1)):g("",!0),V(p)?(n(),h(s(A),{key:1,variant:"destructive",class:"text-xs"},{default:r(()=>[...l[6]||(l[6]=[u(" Vencido ",-1)])]),_:1})):z(p)?(n(),h(s(A),{key:2,variant:"secondary",class:"text-xs"},{default:r(()=>[...l[7]||(l[7]=[u(" Próximo a vencer ",-1)])]),_:1})):g("",!0)])]),i.mostrarMonto&&p.monto_total?(n(),f("div",Ye,[e("div",Ze," $"+d(p.monto_total.toLocaleString()),1),e("div",et,d(p.moneda||"USD"),1)])):g("",!0)]),p.fecha_fin&&!i.compacto?(n(),f("div",tt,[e("div",st,[e("div",{class:B(["h-2 rounded-full transition-all",{"bg-green-500":p.estado==="activo"&&!V(p),"bg-red-500":V(p),"bg-orange-500":z(p),"bg-blue-500":p.estado==="finalizado","bg-gray-400":p.estado==="cancelado"}]),style:ie({width:`${Math.min(100,Math.max(0,(new Date().getTime()-new Date(p.fecha_inicio).getTime())/(new Date(p.fecha_fin).getTime()-new Date(p.fecha_inicio).getTime())*100))}%`})},null,6)])])):g("",!0)])]))),128))]),a(s(me),{orientation:"horizontal"})]),_:1})])):(n(),f("div",ot,[a(s(X),{class:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),l[8]||(l[8]=e("p",{class:"text-muted-foreground"},"No hay contratos para mostrar",-1))]))]),_:1})]),_:1}))}});function rt(){const b=L(!1),c=L(null);async function w(v,m){return b.value=!0,c.value=null,new Promise((_,i)=>{k.post(`/admin/proyectos/${v}/etiquetas`,{etiqueta_id:m},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b.value=!1,_(!0)},onError:l=>{b.value=!1,c.value=Object.values(l).join(", "),i(l)}})})}async function E(v,m){return b.value=!0,c.value=null,new Promise((_,i)=>{k.delete(`/admin/proyectos/${v}/etiquetas/${m}`,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b.value=!1,_(!0)},onError:l=>{b.value=!1,c.value="Error al quitar la etiqueta",i(l)}})})}async function H(v,m){return b.value=!0,c.value=null,new Promise((_,i)=>{k.put(`/admin/proyectos/${v}/etiquetas/sync`,{etiquetas:m},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b.value=!1,_(!0)},onError:l=>{b.value=!1,c.value="Error al sincronizar etiquetas",i(l)}})})}async function j(v){b.value=!0,c.value=null;try{const m=await fetch(`/admin/proyectos/${v}/etiquetas/suggest`);if(!m.ok)throw new Error("Error al obtener sugerencias");const _=await m.json();return b.value=!1,_.etiquetas||[]}catch(m){return b.value=!1,c.value="Error al obtener sugerencias de etiquetas",console.error(m),[]}}async function M(v){var m;b.value=!0,c.value=null;try{const _=await fetch("/admin/etiquetas",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content"))||""},body:JSON.stringify(v)});if(!_.ok){const l=await _.json();throw new Error(l.message||"Error al crear etiqueta")}const i=await _.json();return b.value=!1,i.data}catch(_){return b.value=!1,c.value=_.message||"Error al crear etiqueta",console.error(_),null}}async function R(v){if(v.length<2)return[];try{const m=await fetch(`/admin/etiquetas/search?q=${encodeURIComponent(v)}`);if(!m.ok)throw new Error("Error al buscar etiquetas");return(await m.json()).data||[]}catch(m){return console.error("Error buscando etiquetas:",m),[]}}function I(v){const m=new Map;return v.forEach(_=>{var l;const i=((l=_.categoria)==null?void 0:l.nombre)||"Sin categoría";m.has(i)||m.set(i,[]),m.get(i).push(_)}),m}function F(v){var m;return v.color||((m=v.categoria)==null?void 0:m.color)||"gray"}function V(v,m=10){return v<m}async function z(v,m){return b.value=!0,c.value=null,new Promise((_,i)=>{k.post(`/admin/proyectos/${v}/etiquetas/reorder`,{etiquetas:m},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b.value=!1,_(!0)},onError:l=>{b.value=!1,c.value="Error al reordenar etiquetas",i(l)}})})}return{isLoading:b,error:c,addEtiquetaToProyecto:w,removeEtiquetaFromProyecto:E,syncEtiquetasProyecto:H,getSugerenciasEtiquetas:j,reorderEtiquetas:z,createEtiqueta:M,searchEtiquetas:R,groupEtiquetasByCategoria:I,getEtiquetaColor:F,canAddMoreEtiquetas:V}}const it={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},nt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},lt={class:"text-2xl font-bold text-gray-900 dark:text-white"},dt={key:0,class:"mt-2 text-gray-600 dark:text-gray-400"},ct={class:"flex gap-2"},ut={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},mt={class:"lg:col-span-2 space-y-4"},pt={class:"flex items-center justify-between"},ft={class:"flex items-center gap-3"},yt={class:"flex items-center gap-3"},gt={class:"space-y-2"},vt={class:"flex justify-between text-sm"},ht={class:"font-medium"},_t={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2"},bt={class:"flex items-start gap-3"},xt={class:"font-medium"},wt={class:"text-xs text-gray-500"},kt={key:0,class:"flex items-start gap-3"},$t={class:"font-medium"},Et={class:"text-xs text-gray-500"},Ct={key:0,class:"flex items-center gap-3 pt-2"},Dt={class:"font-medium ml-2"},qt={key:0},St={key:1,class:"text-sm text-muted-foreground"},Tt={key:1,class:"space-y-4"},zt={class:"flex gap-2"},Ht={class:"space-y-3"},Pt={class:"text-sm text-gray-600 dark:text-gray-400"},jt={class:"font-medium"},Mt={key:0,class:"space-y-4"},Vt={class:"mt-4"},Bt={class:"text-sm text-muted-foreground mb-3"},At={class:"grid gap-2"},Ft={class:"flex items-start justify-between"},Nt={class:"font-medium"},Lt={class:"flex items-center gap-2 mt-1"},Rt={class:"text-xs text-muted-foreground"},It={key:0,class:"text-right"},Ut={class:"font-semibold"},Ot={class:"text-xs text-muted-foreground"},Gt={key:1,class:"text-center py-6"},Wt={class:"flex items-center gap-2"},Xt={key:0,class:"mb-6"},Jt={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},Kt={class:"text-center"},Qt={class:"text-2xl font-bold"},Yt={class:"text-center"},Zt={class:"text-2xl font-bold text-blue-500"},es={class:"text-center"},ts={class:"text-2xl font-bold text-green-500"},ss={class:"text-center"},os={class:"space-y-2"},as={class:"flex justify-between items-center text-sm"},rs={class:"font-medium"},is={key:1,class:"space-y-4"},ns={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},ls={key:2,class:"text-center py-6"},ds={class:"space-y-3"},cs={class:"w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},us={class:"flex-1"},ms={class:"text-sm"},ps={class:"font-medium"},fs={class:"text-xs text-gray-500 mt-1"},ys={class:"space-y-4"},gs={key:0,class:"flex items-center gap-3"},vs={class:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},hs={class:"font-medium"},_s={class:"text-sm text-gray-500"},bs={key:1,class:"text-gray-500"},xs={class:"font-mono"},ws={class:"font-medium"},ks={class:"text-sm"},$s={class:"text-sm"},ra=te({__name:"Show",props:{proyecto:{},categorias:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canManageTags:{type:Boolean},canViewContracts:{type:Boolean},canCreateContracts:{type:Boolean},canViewHitos:{type:Boolean},canCreateHitos:{type:Boolean},canEditHitos:{type:Boolean},canDeleteHitos:{type:Boolean},canManageEntregables:{type:Boolean},estadisticasHitos:{}},setup(b){const c=b,w=L(!1),E=L([]),{syncEtiquetasProyecto:H,isLoading:j}=rt();c.proyecto.etiquetas&&(E.value=c.proyecto.etiquetas.map(t=>t.id));const M=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:c.proyecto.nombre,href:`/admin/proyectos/${c.proyecto.id}`}],R=()=>{confirm(`¿Estás seguro de eliminar el proyecto "${c.proyecto.nombre}"?`)&&k.delete(`/admin/proyectos/${c.proyecto.id}`,{onSuccess:()=>{P.success("Proyecto eliminado exitosamente")},onError:()=>{P.error("Error al eliminar el proyecto")}})},I=t=>({planificacion:K,en_progreso:Ee,pausado:$e,completado:Q,cancelado:ke})[t]||Ce,F=t=>({planificacion:"bg-blue-100 text-blue-800",en_progreso:"bg-yellow-100 text-yellow-800",pausado:"bg-orange-100 text-orange-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",V=t=>({baja:"bg-gray-100 text-gray-800",media:"bg-blue-100 text-blue-800",alta:"bg-orange-100 text-orange-800",critica:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",z=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),v=t=>{const o=Math.floor((new Date(t).getTime()-new Date().getTime())/864e5);return o===0?"Hoy":o===1?"Mañana":o===-1?"Ayer":o>0?`En ${o} días`:`Hace ${Math.abs(o)} días`},m=async()=>{try{await H(c.proyecto.id,E.value),w.value=!1,P.success("Etiquetas actualizadas exitosamente"),k.reload({only:["proyecto"]})}catch{P.error("Error al actualizar las etiquetas")}},_=()=>{var t;E.value=((t=c.proyecto.etiquetas)==null?void 0:t.map(o=>o.id))||[],w.value=!1},i=t=>{k.visit(`/admin/proyectos/${c.proyecto.id}/hitos/${t.id}`)},l=t=>{k.visit(`/admin/proyectos/${c.proyecto.id}/hitos/${t.id}/edit`)},p=t=>{confirm(`¿Estás seguro de eliminar el hito "${t.nombre}"? Se eliminarán también todos sus entregables.`)&&k.delete(`/admin/proyectos/${c.proyecto.id}/hitos/${t.id}`,{onSuccess:()=>{P.success("Hito eliminado exitosamente"),k.reload({only:["proyecto"]})},onError:()=>{P.error("Error al eliminar el hito")}})},$=t=>{k.post(`/admin/proyectos/${c.proyecto.id}/hitos/${t.id}/duplicar`,{},{onSuccess:()=>{P.success("Hito duplicado exitosamente"),k.reload({only:["proyecto"]})},onError:()=>{P.error("Error al duplicar el hito")}})},oe=t=>{k.visit(`/admin/proyectos/${c.proyecto.id}/hitos/${t.id}/entregables/create`)},ae=t=>{k.visit(`/admin/proyectos/${c.proyecto.id}/hitos/${t.id}/entregables`)};return(t,o)=>(n(),f(N,null,[a(s(ne),{title:`Proyecto: ${t.proyecto.nombre}`},null,8,["title"]),a(re,{breadcrumbs:M},{default:r(()=>[e("div",it,[e("div",nt,[e("div",null,[e("h1",lt,d(t.proyecto.nombre),1),t.proyecto.descripcion?(n(),f("p",dt,d(t.proyecto.descripcion),1)):g("",!0)]),e("div",ct,[t.canEdit?(n(),h(s(C),{key:0,href:`/admin/proyectos/${t.proyecto.id}/edit`},{default:r(()=>[a(s(x),null,{default:r(()=>[a(s(J),{class:"mr-2 h-4 w-4"}),o[2]||(o[2]=u(" Editar ",-1))]),_:1})]),_:1},8,["href"])):g("",!0),t.canDelete?(n(),h(s(x),{key:1,variant:"destructive",onClick:R},{default:r(()=>[a(s(_e),{class:"mr-2 h-4 w-4"}),o[3]||(o[3]=u(" Eliminar ",-1))]),_:1})):g("",!0)])]),e("div",ut,[e("div",mt,[a(s(T),null,{default:r(()=>[a(s(D),null,{default:r(()=>[a(s(q),null,{default:r(()=>[...o[4]||(o[4]=[u("Estado del Proyecto",-1)])]),_:1})]),_:1}),a(s(S),{class:"space-y-4"},{default:r(()=>[e("div",pt,[e("div",ft,[(n(),h(se(I(t.proyecto.estado)),{class:"h-5 w-5 text-gray-500"})),o[5]||(o[5]=e("span",{class:"font-medium"},"Estado:",-1)),a(s(A),{class:B(F(t.proyecto.estado))},{default:r(()=>[u(d(t.proyecto.estado_label),1)]),_:1},8,["class"])]),e("div",yt,[a(s(be),{class:"h-5 w-5 text-gray-500"}),o[6]||(o[6]=e("span",{class:"font-medium"},"Prioridad:",-1)),a(s(A),{class:B(V(t.proyecto.prioridad))},{default:r(()=>[u(d(t.proyecto.prioridad_label),1)]),_:1},8,["class"])])]),e("div",gt,[e("div",vt,[o[7]||(o[7]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Progreso",-1)),e("span",ht,d(t.proyecto.porcentaje_completado)+"%",1)]),a(s(Z),{value:t.proyecto.porcentaje_completado,class:"h-2"},null,8,["value"])]),e("div",_t,[e("div",bt,[a(s(W),{class:"h-5 w-5 text-gray-500 mt-0.5"}),e("div",null,[o[8]||(o[8]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de inicio",-1)),e("p",xt,d(z(t.proyecto.fecha_inicio)),1),e("p",wt,d(v(t.proyecto.fecha_inicio)),1)])]),t.proyecto.fecha_fin?(n(),f("div",kt,[a(s(W),{class:"h-5 w-5 text-gray-500 mt-0.5"}),e("div",null,[o[9]||(o[9]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de fin",-1)),e("p",$t,d(z(t.proyecto.fecha_fin)),1),e("p",Et,d(v(t.proyecto.fecha_fin)),1)])])):g("",!0)]),t.proyecto.duracion_dias?(n(),f("div",Ct,[a(s(xe),{class:"h-5 w-5 text-gray-500"}),e("div",null,[o[10]||(o[10]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Duración total:",-1)),e("span",Dt,d(t.proyecto.duracion_dias)+" días",1)])])):g("",!0)]),_:1})]),_:1}),a(s(T),null,{default:r(()=>[a(s(D),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[a(s(q),{class:"flex items-center gap-2"},{default:r(()=>[a(s(we),{class:"h-5 w-5"}),o[11]||(o[11]=u(" Etiquetas ",-1))]),_:1}),t.canManageTags&&!w.value?(n(),h(s(x),{key:0,variant:"ghost",size:"sm",onClick:o[0]||(o[0]=y=>w.value=!0)},{default:r(()=>[a(s(J),{class:"h-4 w-4"})]),_:1})):g("",!0)]),_:1}),a(s(S),null,{default:r(()=>[w.value?(n(),f("div",Tt,[t.categorias?(n(),h(de,{key:0,modelValue:E.value,"onUpdate:modelValue":o[1]||(o[1]=y=>E.value=y),categorias:t.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas...",description:"Selecciona hasta 10 etiquetas para este proyecto"},null,8,["modelValue","categorias"])):g("",!0),e("div",zt,[a(s(x),{size:"sm",onClick:m,disabled:s(j)},{default:r(()=>[...o[12]||(o[12]=[u(" Guardar ",-1)])]),_:1},8,["disabled"]),a(s(x),{size:"sm",variant:"outline",onClick:_,disabled:s(j)},{default:r(()=>[...o[13]||(o[13]=[u(" Cancelar ",-1)])]),_:1},8,["disabled"])])])):(n(),f("div",qt,[t.proyecto.etiquetas&&t.proyecto.etiquetas.length>0?(n(),h(le,{key:0,etiquetas:t.proyecto.etiquetas,"show-categoria":!0,interactive:!0,size:"md"},null,8,["etiquetas"])):(n(),f("p",St," No hay etiquetas asignadas "))]))]),_:1})]),_:1}),t.proyecto.campos_personalizados&&t.proyecto.campos_personalizados.length>0?(n(),h(s(T),{key:0},{default:r(()=>[a(s(D),null,{default:r(()=>[a(s(q),null,{default:r(()=>[...o[14]||(o[14]=[u("Campos Personalizados",-1)])]),_:1})]),_:1}),a(s(S),null,{default:r(()=>[e("div",Ht,[(n(!0),f(N,null,U(t.proyecto.campos_personalizados,y=>(n(),f("div",{key:y.id,class:"flex justify-between py-2 border-b last:border-b-0"},[e("span",Pt,d(y.nombre),1),e("span",jt,d(y.valor_formateado||y.valor||"-"),1)]))),128))])]),_:1})]),_:1})):g("",!0),t.canViewContracts?(n(),h(s(T),{key:1},{default:r(()=>[a(s(D),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[a(s(q),{class:"flex items-center gap-2"},{default:r(()=>[a(s(X),{class:"h-5 w-5"}),o[15]||(o[15]=u(" Contratos ",-1))]),_:1}),t.canCreateContracts?(n(),h(s(C),{key:0,href:`/admin/proyectos/${t.proyecto.id}/contratos/create`},{default:r(()=>[a(s(x),{size:"sm"},{default:r(()=>[a(s(G),{class:"h-4 w-4 mr-2"}),o[16]||(o[16]=u(" Nuevo Contrato ",-1))]),_:1})]),_:1},8,["href"])):g("",!0)]),_:1}),a(s(S),null,{default:r(()=>[t.proyecto.contratos&&t.proyecto.contratos.length>0?(n(),f("div",Mt,[a(at,{contratos:t.proyecto.contratos,"mostrar-monto":!0,compacto:!0},null,8,["contratos"]),e("div",Vt,[e("p",Bt,d(t.proyecto.contratos.length)+" contrato(s) asociado(s) ",1),e("div",At,[(n(!0),f(N,null,U(t.proyecto.contratos.slice(0,3),y=>(n(),h(s(C),{key:y.id,href:`/admin/contratos/${y.id}`,class:"block p-3 rounded-lg border hover:bg-muted/50 transition-colors"},{default:r(()=>[e("div",Ft,[e("div",null,[e("p",Nt,d(y.nombre),1),e("div",Lt,[a(s(A),{variant:y.estado==="activo"?"default":y.estado==="finalizado"?"secondary":y.estado==="cancelado"?"destructive":"outline"},{default:r(()=>[u(d(y.estado),1)]),_:2},1032,["variant"]),e("span",Rt,d(new Date(y.fecha_inicio).toLocaleDateString()),1)])]),y.monto_total?(n(),f("div",It,[e("p",Ut,"$"+d(y.monto_total.toLocaleString()),1),e("p",Ot,d(y.moneda||"USD"),1)])):g("",!0)])]),_:2},1032,["href"]))),128))]),t.proyecto.contratos.length>3?(n(),h(s(C),{key:0,href:`/admin/contratos?proyecto_id=${t.proyecto.id}`,class:"block text-center mt-3 text-sm text-primary hover:underline"},{default:r(()=>[u(" Ver todos los contratos ("+d(t.proyecto.contratos.length)+") ",1)]),_:1},8,["href"])):g("",!0)])])):(n(),f("div",Gt,[a(s(X),{class:"h-10 w-10 mx-auto text-muted-foreground mb-3"}),o[18]||(o[18]=e("p",{class:"text-muted-foreground mb-3"},"No hay contratos asociados",-1)),t.canCreateContracts?(n(),h(s(C),{key:0,href:`/admin/proyectos/${t.proyecto.id}/contratos/create`},{default:r(()=>[a(s(x),{variant:"outline",size:"sm"},{default:r(()=>[a(s(G),{class:"h-4 w-4 mr-2"}),o[17]||(o[17]=u(" Crear Primer Contrato ",-1))]),_:1})]),_:1},8,["href"])):g("",!0)]))]),_:1})]),_:1})):g("",!0),t.canViewHitos?(n(),h(s(T),{key:2},{default:r(()=>[a(s(D),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:r(()=>[a(s(q),{class:"flex items-center gap-2"},{default:r(()=>[a(s(K),{class:"h-5 w-5"}),o[19]||(o[19]=u(" Hitos y Entregables ",-1))]),_:1}),e("div",Wt,[t.proyecto.hitos&&t.proyecto.hitos.length>0?(n(),h(s(C),{key:0,href:`/admin/proyectos/${t.proyecto.id}/hitos`},{default:r(()=>[a(s(x),{variant:"outline",size:"sm"},{default:r(()=>[a(s(ve),{class:"h-4 w-4 mr-2"}),o[20]||(o[20]=u(" Ver Todos ",-1))]),_:1})]),_:1},8,["href"])):g("",!0),t.canCreateHitos?(n(),h(s(C),{key:1,href:`/admin/proyectos/${t.proyecto.id}/hitos/create`},{default:r(()=>[a(s(x),{size:"sm"},{default:r(()=>[a(s(G),{class:"h-4 w-4 mr-2"}),o[21]||(o[21]=u(" Nuevo Hito ",-1))]),_:1})]),_:1},8,["href"])):g("",!0)])]),_:1}),a(s(S),null,{default:r(()=>[t.estadisticasHitos&&t.estadisticasHitos.total>0?(n(),f("div",Xt,[e("div",Jt,[e("div",Kt,[e("p",Qt,d(t.estadisticasHitos.total),1),o[22]||(o[22]=e("p",{class:"text-xs text-muted-foreground"},"Total Hitos",-1))]),e("div",Yt,[e("p",Zt,d(t.estadisticasHitos.en_progreso),1),o[23]||(o[23]=e("p",{class:"text-xs text-muted-foreground"},"En Progreso",-1))]),e("div",es,[e("p",ts,d(t.estadisticasHitos.completados),1),o[24]||(o[24]=e("p",{class:"text-xs text-muted-foreground"},"Completados",-1))]),e("div",ss,[e("p",{class:B(["text-2xl font-bold",{"text-red-500":t.estadisticasHitos.vencidos>0}])},d(t.estadisticasHitos.vencidos),3),o[25]||(o[25]=e("p",{class:"text-xs text-muted-foreground"},"Vencidos",-1))])]),e("div",os,[e("div",as,[o[26]||(o[26]=e("span",{class:"text-muted-foreground"},"Progreso General",-1)),e("span",rs,d(t.estadisticasHitos.progreso_general)+"%",1)]),a(s(Z),{value:t.estadisticasHitos.progreso_general,class:"h-2"},null,8,["value"])])])):g("",!0),t.proyecto.hitos&&t.proyecto.hitos.length>0?(n(),f("div",is,[e("div",ns,[(n(!0),f(N,null,U(t.proyecto.hitos.slice(0,6),y=>(n(),h(he,{key:y.id,hito:y,canEdit:t.canEditHitos,canDelete:t.canDeleteHitos,canManageDeliverables:t.canManageEntregables,showActions:!0,onView:i,onEdit:l,onDelete:p,onDuplicate:$,onAddEntregable:oe,onViewEntregables:ae},null,8,["hito","canEdit","canDelete","canManageDeliverables"]))),128))]),t.proyecto.hitos.length>6?(n(),h(s(C),{key:0,href:`/admin/proyectos/${t.proyecto.id}/hitos`,class:"block text-center mt-4 text-sm text-primary hover:underline"},{default:r(()=>[u(" Ver todos los hitos ("+d(t.proyecto.hitos.length)+") ",1)]),_:1},8,["href"])):g("",!0)])):(n(),f("div",ls,[a(s(K),{class:"h-10 w-10 mx-auto text-muted-foreground mb-3"}),o[28]||(o[28]=e("p",{class:"text-muted-foreground mb-3"},"No hay hitos definidos para este proyecto",-1)),t.canCreateHitos?(n(),h(s(C),{key:0,href:`/admin/proyectos/${t.proyecto.id}/hitos/create`},{default:r(()=>[a(s(x),{variant:"outline",size:"sm"},{default:r(()=>[a(s(G),{class:"h-4 w-4 mr-2"}),o[27]||(o[27]=u(" Crear Primer Hito ",-1))]),_:1})]),_:1},8,["href"])):g("",!0)]))]),_:1})]),_:1})):g("",!0),t.proyecto.activities&&t.proyecto.activities.length>0?(n(),h(s(T),{key:3},{default:r(()=>[a(s(D),null,{default:r(()=>[a(s(q),null,{default:r(()=>[...o[29]||(o[29]=[u("Actividad Reciente",-1)])]),_:1})]),_:1}),a(s(S),null,{default:r(()=>[e("div",ds,[(n(!0),f(N,null,U(t.proyecto.activities,y=>{var Y;return n(),f("div",{key:y.id,class:"flex items-start gap-3 pb-3 border-b last:border-b-0"},[e("div",cs,[a(s(ee),{class:"h-4 w-4 text-gray-500"})]),e("div",us,[e("p",ms,[e("span",ps,d(((Y=y.causer)==null?void 0:Y.name)||"Sistema"),1),u(" "+d(y.description),1)]),e("p",fs,d(v(y.created_at)),1)])])}),128))])]),_:1})]),_:1})):g("",!0)]),e("div",ys,[a(s(T),null,{default:r(()=>[a(s(D),null,{default:r(()=>[a(s(q),null,{default:r(()=>[...o[30]||(o[30]=[u("Responsable",-1)])]),_:1})]),_:1}),a(s(S),null,{default:r(()=>[t.proyecto.responsable?(n(),f("div",gs,[e("div",vs,[a(s(ee),{class:"h-5 w-5 text-gray-500"})]),e("div",null,[e("p",hs,d(t.proyecto.responsable.name),1),e("p",_s,d(t.proyecto.responsable.email),1)])])):(n(),f("p",bs,"Sin asignar"))]),_:1})]),_:1}),a(s(T),null,{default:r(()=>[a(s(D),null,{default:r(()=>[a(s(q),null,{default:r(()=>[...o[31]||(o[31]=[u("Información del Sistema",-1)])]),_:1})]),_:1}),a(s(S),{class:"space-y-3"},{default:r(()=>{var y;return[e("div",null,[o[32]||(o[32]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"ID del Proyecto",-1)),e("p",xs,"#"+d(t.proyecto.id),1)]),e("div",null,[o[33]||(o[33]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Estado",-1)),a(s(A),{class:B(t.proyecto.activo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800")},{default:r(()=>[u(d(t.proyecto.activo?"Activo":"Inactivo"),1)]),_:1},8,["class"])]),e("div",null,[o[34]||(o[34]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Creado por",-1)),e("p",ws,d(((y=t.proyecto.creador)==null?void 0:y.name)||"Sistema"),1)]),e("div",null,[o[35]||(o[35]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de creación",-1)),e("p",ks,d(z(t.proyecto.created_at)),1)]),e("div",null,[o[36]||(o[36]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Última actualización",-1)),e("p",$s,d(z(t.proyecto.updated_at)),1)])]}),_:1})]),_:1}),a(s(T),null,{default:r(()=>[a(s(D),null,{default:r(()=>[a(s(q),null,{default:r(()=>[...o[37]||(o[37]=[u("Acciones Rápidas",-1)])]),_:1})]),_:1}),a(s(S),{class:"space-y-2"},{default:r(()=>[a(s(C),{href:"/admin/proyectos"},{default:r(()=>[a(s(x),{variant:"outline",class:"w-full justify-start"},{default:r(()=>[...o[38]||(o[38]=[u(" Volver al listado ",-1)])]),_:1})]),_:1}),t.canEdit?(n(),h(s(C),{key:0,href:`/admin/proyectos/${t.proyecto.id}/edit`},{default:r(()=>[a(s(x),{variant:"outline",class:"w-full justify-start"},{default:r(()=>[a(s(J),{class:"mr-2 h-4 w-4"}),o[39]||(o[39]=u(" Editar proyecto ",-1))]),_:1})]),_:1},8,["href"])):g("",!0)]),_:1})]),_:1})])])])]),_:1})],64))}});export{ra as default};
