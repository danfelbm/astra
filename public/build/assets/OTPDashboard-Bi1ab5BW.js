import{_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DZYDPVQJ.js";import{d as L,r as h,c as g,o as H,B as X,b as f,w as o,e as a,g as s,f as e,q as G,t as i,h as n,n as K,m as r,i as b,j as R,a as q}from"./app-BrD2QGCV.js";import{_ as p,a as c,b as v,c as m}from"./CardTitle.vue_vue_type_script_setup_true_lang-DAXo-B_x.js";import{_ as z}from"./index-CNCNgiGH.js";import{_ as T}from"./createLucideIcon-CfvjSeOT.js";import{_ as N}from"./Progress.vue_vue_type_script_setup_true_lang-BGoEEFsA.js";import{_ as Y,a as Z}from"./index-CfmLS0H2.js";import{_ as tt}from"./AlertTitle.vue_vue_type_script_setup_true_lang-DTWM1toN.js";import{R as B}from"./refresh-cw-CYJwvihT.js";import{C as et}from"./circle-check-big-Cc-y2ree.js";import{C as F}from"./clock-4chQLfX0.js";import{T as st}from"./triangle-alert-CHMb4rEO.js";import{U as Q}from"./users-CKUBvxrh.js";import{T as at}from"./trending-up-B-Wn9pqv.js";import{C as ot}from"./circle-x-Bv80iK8e.js";import{M as P}from"./mail-CReXc2pr.js";import{M as A}from"./message-square-P8I4Nbh3.js";import{T as lt}from"./timer-D9FVmEKq.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Ym97pKSR.js";import"./index-CaxA_LAe.js";import"./floating-ui.vue-gLKKvGLM.js";import"./x-GbNmdtd1.js";import"./Input.vue_vue_type_script_setup_true_lang-q8xABjEX.js";import"./index-BUVuXDf0.js";import"./index-C-zWBZWq.js";import"./shield-B5Q6GdXO.js";import"./user-CFoGTRlH.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DyEz-uPK.js";import"./chevron-right-YNwTIyTL.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BUWxYp1-.js";import"./VisuallyHidden-nhjRayVb.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-r_ipOL3R.js";import"./check-DCLeEZ05.js";import"./Label.vue_vue_type_script_setup_true_lang-DZqq_eao.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CE6wF4w5.js";import"./index-DnzQ_biR.js";import"./circle-alert-C3pua8qZ.js";import"./map-pin-9JO26skO.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DYQJYrap.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-GBfMPHrO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-BhbJk3yE.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CzSE5pTM.js";import"./tag-Bb4Acpj2.js";import"./target-dK9v5UXZ.js";import"./vote-DlQ2_ROW.js";import"./folder-open-EMUKzbDY.js";import"./send-QuKJqBZV.js";import"./file-text-CTdhs6hj.js";import"./briefcase-CM5vbtF2.js";import"./calendar-CYwFKqbN.js";import"./megaphone-DKElQkZz.js";import"./user-check-DLvFRXOO.js";import"./clipboard-list-Br-bGukG.js";import"./external-link-BzGRET35.js";import"./panel-left-DBcB4ucU.js";import"./index-lazXCbFK.js";const it={class:"space-y-6"},nt={class:"flex items-center justify-between"},rt={class:"flex items-center gap-4"},dt={class:"text-sm text-muted-foreground"},ut={key:0},mt={key:1},ft={key:2},pt={key:3},ct={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},vt={class:"text-2xl font-bold"},_t={class:"text-2xl font-bold"},xt={class:"text-2xl font-bold"},gt={class:"text-2xl font-bold text-destructive"},bt={class:"grid gap-6 md:grid-cols-2"},wt={class:"grid gap-4 grid-cols-3"},ht={class:"text-center"},yt={class:"text-2xl font-bold"},jt={class:"text-center"},Ct={class:"text-2xl font-bold"},Tt={class:"text-center"},kt={class:"text-2xl font-bold text-destructive"},$t={key:0,class:"space-y-2"},Pt={class:"flex justify-between text-sm"},At={class:"font-medium"},Mt={class:"grid gap-4 grid-cols-3"},St={class:"text-center"},Ot={class:"text-2xl font-bold"},Dt={class:"text-center"},Et={class:"text-2xl font-bold"},Rt={class:"text-center"},qt={class:"text-2xl font-bold text-destructive"},zt={key:0,class:"space-y-2"},Nt={class:"flex justify-between text-sm"},Bt={class:"font-medium"},Ft={class:"grid gap-4 md:grid-cols-3"},Qt={class:"flex items-center gap-4"},Ut={class:"text-2xl font-bold"},Vt={class:"flex items-center gap-4"},Wt={class:"text-2xl font-bold"},It={class:"flex items-center gap-4"},Jt={class:"flex"},Lt={class:"text-2xl font-bold"},Ht={class:"flex flex-wrap gap-4"},Ye=L({__name:"OTPDashboard",props:{initialQueueMetrics:{default:()=>[]},initialOtpStats:{default:()=>({total_activos:0,total_expirados:0,total_usados:0,por_canal:{email:0,whatsapp:0,both:0}})}},setup(U){const M=U,x=h(M.initialQueueMetrics),w=h(M.initialOtpStats),y=h(!1),S=h(new Date),j=h(null),V=[{label:"Admin",href:route("admin.dashboard")},{label:"Dashboard OTP",href:route("admin.otp-dashboard")}],d=g(()=>x.value.find(l=>l.queue_name==="otp-emails")),u=g(()=>x.value.find(l=>l.queue_name==="otp-whatsapp")),C=g(()=>x.value.reduce((l,t)=>l+t.pending_jobs,0)),k=g(()=>x.value.reduce((l,t)=>l+t.processing_jobs,0)),$=g(()=>x.value.reduce((l,t)=>l+t.failed_jobs,0)),_=g(()=>$.value>10?{status:"error",label:"Crítico",color:"destructive"}:C.value>50?{status:"warning",label:"Sobrecargado",color:"warning"}:k.value>0?{status:"processing",label:"Procesando",color:"default"}:{status:"healthy",label:"Saludable",color:"success"}),O=async()=>{y.value=!0;try{const l=await q.get("/api/queue/status");l.data.success&&(x.value=l.data.data);const t=await q.get("/api/queue/otp/stats");t.data.success&&(w.value=t.data.data),S.value=new Date}catch(l){console.error("Error actualizando datos:",l)}finally{y.value=!1}},W=()=>{j.value=window.setInterval(O,1e4)},I=()=>{j.value&&(clearInterval(j.value),j.value=null)},D=l=>l<60?`${l}s`:l<3600?`${Math.round(l/60)}m`:`${Math.round(l/3600)}h`,E=l=>l.failed_jobs>5?"destructive":l.pending_jobs>25?"warning":"default";return H(()=>{W()}),X(()=>{I()}),(l,t)=>(r(),f(J,{breadcrumbs:V},{default:o(()=>[a(e(G),{title:"Dashboard OTP"}),s("div",it,[s("div",nt,[t[1]||(t[1]=s("div",null,[s("h1",{class:"text-3xl font-bold tracking-tight"},"Dashboard OTP"),s("p",{class:"text-muted-foreground"}," Monitoreo en tiempo real del sistema de colas OTP ")],-1)),s("div",rt,[s("div",dt," Última actualización: "+i(S.value.toLocaleTimeString()),1),a(e(T),{onClick:O,variant:"outline",size:"sm",disabled:y.value},{default:o(()=>[a(e(B),{class:K([{"animate-spin":y.value},"h-4 w-4 mr-2"])},null,8,["class"]),t[0]||(t[0]=n(" Actualizar ",-1))]),_:1},8,["disabled"])])]),a(e(Y),{variant:_.value.status==="error"?"destructive":"default"},{default:o(()=>[_.value.status==="healthy"?(r(),f(e(et),{key:0,class:"h-4 w-4"})):_.value.status==="processing"?(r(),f(e(F),{key:1,class:"h-4 w-4"})):(r(),f(e(st),{key:2,class:"h-4 w-4"})),a(e(tt),null,{default:o(()=>[n("Estado del Sistema: "+i(_.value.label),1)]),_:1}),a(e(Z),null,{default:o(()=>[_.value.status==="healthy"?(r(),b("span",ut," Todas las colas funcionan normalmente ")):_.value.status==="processing"?(r(),b("span",mt,i(k.value)+" trabajos en proceso, "+i(C.value)+" en cola ",1)):_.value.status==="warning"?(r(),b("span",ft," Cola sobrecargada: "+i(C.value)+" trabajos pendientes ",1)):(r(),b("span",pt," Sistema crítico: "+i($.value)+" trabajos fallidos requieren atención ",1))]),_:1})]),_:1},8,["variant"]),s("div",ct,[a(e(p),null,{default:o(()=>[a(e(c),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:o(()=>[a(e(v),{class:"text-sm font-medium"},{default:o(()=>[...t[2]||(t[2]=[n("OTPs Activos",-1)])]),_:1}),a(e(Q),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:o(()=>[s("div",vt,i(w.value.total_activos),1),t[3]||(t[3]=s("p",{class:"text-xs text-muted-foreground"}," Códigos válidos pendientes ",-1))]),_:1})]),_:1}),a(e(p),null,{default:o(()=>[a(e(c),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:o(()=>[a(e(v),{class:"text-sm font-medium"},{default:o(()=>[...t[4]||(t[4]=[n("En Cola",-1)])]),_:1}),a(e(F),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:o(()=>[s("div",_t,i(C.value),1),t[5]||(t[5]=s("p",{class:"text-xs text-muted-foreground"}," Envíos pendientes ",-1))]),_:1})]),_:1}),a(e(p),null,{default:o(()=>[a(e(c),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:o(()=>[a(e(v),{class:"text-sm font-medium"},{default:o(()=>[...t[6]||(t[6]=[n("Procesando",-1)])]),_:1}),a(e(at),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:o(()=>[s("div",xt,i(k.value),1),t[7]||(t[7]=s("p",{class:"text-xs text-muted-foreground"}," Envíos en curso ",-1))]),_:1})]),_:1}),a(e(p),null,{default:o(()=>[a(e(c),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:o(()=>[a(e(v),{class:"text-sm font-medium"},{default:o(()=>[...t[8]||(t[8]=[n("Fallidos",-1)])]),_:1}),a(e(ot),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:o(()=>[s("div",gt,i($.value),1),t[9]||(t[9]=s("p",{class:"text-xs text-muted-foreground"}," Requieren atención ",-1))]),_:1})]),_:1})]),s("div",bt,[a(e(p),null,{default:o(()=>[a(e(c),null,{default:o(()=>[a(e(v),{class:"flex items-center gap-2"},{default:o(()=>[a(e(P),{class:"h-5 w-5"}),t[10]||(t[10]=n(" Cola Email OTP ",-1)),a(e(z),{variant:d.value?E(d.value):"secondary"},{default:o(()=>[n(i(d.value?`${d.value.rate_limit}/seg`:"N/A"),1)]),_:1},8,["variant"])]),_:1})]),_:1}),d.value?(r(),f(e(m),{key:0,class:"space-y-4"},{default:o(()=>[s("div",wt,[s("div",ht,[s("div",yt,i(d.value.pending_jobs),1),t[11]||(t[11]=s("div",{class:"text-xs text-muted-foreground"},"En cola",-1))]),s("div",jt,[s("div",Ct,i(d.value.processing_jobs),1),t[12]||(t[12]=s("div",{class:"text-xs text-muted-foreground"},"Procesando",-1))]),s("div",Tt,[s("div",kt,i(d.value.failed_jobs),1),t[13]||(t[13]=s("div",{class:"text-xs text-muted-foreground"},"Fallidos",-1))])]),d.value.pending_jobs>0?(r(),b("div",$t,[s("div",Pt,[t[14]||(t[14]=s("span",null,"Tiempo estimado de espera",-1)),s("span",At,i(D(d.value.estimated_wait_seconds)),1)]),a(e(N),{value:Math.min(100,d.value.processing_jobs/(d.value.pending_jobs+d.value.processing_jobs)*100),class:"h-2"},null,8,["value"])])):R("",!0)]),_:1})):(r(),f(e(m),{key:1},{default:o(()=>[...t[15]||(t[15]=[s("p",{class:"text-muted-foreground text-center py-4"}," No hay datos disponibles para la cola de emails ",-1)])]),_:1}))]),_:1}),a(e(p),null,{default:o(()=>[a(e(c),null,{default:o(()=>[a(e(v),{class:"flex items-center gap-2"},{default:o(()=>[a(e(A),{class:"h-5 w-5"}),t[16]||(t[16]=n(" Cola WhatsApp OTP ",-1)),a(e(z),{variant:u.value?E(u.value):"secondary"},{default:o(()=>[n(i(u.value?`${u.value.rate_limit}/seg`:"N/A"),1)]),_:1},8,["variant"])]),_:1})]),_:1}),u.value?(r(),f(e(m),{key:0,class:"space-y-4"},{default:o(()=>[s("div",Mt,[s("div",St,[s("div",Ot,i(u.value.pending_jobs),1),t[17]||(t[17]=s("div",{class:"text-xs text-muted-foreground"},"En cola",-1))]),s("div",Dt,[s("div",Et,i(u.value.processing_jobs),1),t[18]||(t[18]=s("div",{class:"text-xs text-muted-foreground"},"Procesando",-1))]),s("div",Rt,[s("div",qt,i(u.value.failed_jobs),1),t[19]||(t[19]=s("div",{class:"text-xs text-muted-foreground"},"Fallidos",-1))])]),u.value.pending_jobs>0?(r(),b("div",zt,[s("div",Nt,[t[20]||(t[20]=s("span",null,"Tiempo estimado de espera",-1)),s("span",Bt,i(D(u.value.estimated_wait_seconds)),1)]),a(e(N),{value:Math.min(100,u.value.processing_jobs/(u.value.pending_jobs+u.value.processing_jobs)*100),class:"h-2"},null,8,["value"])])):R("",!0)]),_:1})):(r(),f(e(m),{key:1},{default:o(()=>[...t[21]||(t[21]=[s("p",{class:"text-muted-foreground text-center py-4"}," No hay datos disponibles para la cola de WhatsApp ",-1)])]),_:1}))]),_:1})]),a(e(p),null,{default:o(()=>[a(e(c),null,{default:o(()=>[a(e(v),null,{default:o(()=>[...t[22]||(t[22]=[n("Distribución de OTPs por Canal",-1)])]),_:1})]),_:1}),a(e(m),null,{default:o(()=>[s("div",Ft,[s("div",Qt,[a(e(P),{class:"h-8 w-8 text-blue-500"}),s("div",null,[s("div",Ut,i(w.value.por_canal.email),1),t[23]||(t[23]=s("div",{class:"text-sm text-muted-foreground"},"Solo Email",-1))])]),s("div",Vt,[a(e(A),{class:"h-8 w-8 text-green-500"}),s("div",null,[s("div",Wt,i(w.value.por_canal.whatsapp),1),t[24]||(t[24]=s("div",{class:"text-sm text-muted-foreground"},"Solo WhatsApp",-1))])]),s("div",It,[s("div",Jt,[a(e(P),{class:"h-8 w-8 text-blue-500"}),a(e(A),{class:"h-8 w-8 text-green-500 -ml-2"})]),s("div",null,[s("div",Lt,i(w.value.por_canal.both),1),t[25]||(t[25]=s("div",{class:"text-sm text-muted-foreground"},"Ambos Canales",-1))])])])]),_:1})]),_:1}),a(e(p),null,{default:o(()=>[a(e(c),null,{default:o(()=>[a(e(v),null,{default:o(()=>[...t[26]||(t[26]=[n("Acciones Administrativas",-1)])]),_:1})]),_:1}),a(e(m),null,{default:o(()=>[s("div",Ht,[a(e(T),{variant:"outline",size:"sm"},{default:o(()=>[a(e(lt),{class:"h-4 w-4 mr-2"}),t[27]||(t[27]=n(" Monitoreo en Tiempo Real ",-1))]),_:1}),a(e(T),{variant:"outline",size:"sm"},{default:o(()=>[a(e(B),{class:"h-4 w-4 mr-2"}),t[28]||(t[28]=n(" Reiniciar Cola Fallida ",-1))]),_:1}),a(e(T),{variant:"outline",size:"sm"},{default:o(()=>[a(e(Q),{class:"h-4 w-4 mr-2"}),t[29]||(t[29]=n(" Ver Logs Detallados ",-1))]),_:1})])]),_:1})]),_:1})])]),_:1}))}});export{Ye as default};
