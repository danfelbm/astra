import{T as W,_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BSAaXFBZ.js";import{d as X,k as G,j as $,o as d,e as a,b as e,f as o,u as t,m as K,t as i,g as n,n as Q,P as k,a as u,i as j,F as D,r as E,W as R}from"./app-DLtGX5Qt.js";import{_ as x}from"./createLucideIcon-Dkyf0ol9.js";import{_ as p,a as _,b as g,c}from"./CardTitle.vue_vue_type_script_setup_true_lang-Co41z9Fi.js";import{_ as T}from"./CardDescription.vue_vue_type_script_setup_true_lang-DbFs4sm5.js";import{_ as b}from"./index-Dd_mJrj8.js";import{_ as Y,a as Z,b as N,c as h,d as tt,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-lm_PRNa8.js";import{_ as et,a as st}from"./index-C9obqnHf.js";import{S as at,_ as lt}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-CTQpPgri.js";import{_ as ot,a as nt,b as S,c as C}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Bb2SrlnQ.js";import{_ as it}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DrSv8LPi.js";import{R as rt}from"./refresh-cw-DUmTHOb2.js";import{T as dt}from"./trash-oAcmFFii.js";import{S as ut}from"./square-pen-BGpnH1Ph.js";import{A as mt}from"./arrow-left-r7U85gMs.js";import{U as ft}from"./users-DveyALIl.js";import{C as pt}from"./calendar-Qt9nf8nq.js";import{H as _t}from"./hash-Bk2yg6h1.js";import{M as gt}from"./mail-DKLY00F_.js";import{U as ct}from"./user-B2Cpm2T0.js";import"./index-kXO2DGBO.js";import"./floating-ui.vue-BR3vkAxW.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-01xQeA0o.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-UwaVvoXl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BXSN56bN.js";import"./chevrons-up-down-BYf_a4BH.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BS5YH57z.js";import"./shield-CfmIBwYY.js";import"./vote-DqjfNPob.js";import"./file-text-Ct1bDYn7.js";import"./briefcase-CD3iSsTu.js";import"./megaphone-0WUdA7eo.js";import"./user-check-BdFLmkoN.js";import"./external-link-CNewaM4d.js";import"./panel-left-DDEhyo7S.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-D0xGkYSt.js";import"./VisuallyHidden-BoG3gtOX.js";import"./Input.vue_vue_type_script_setup_true_lang-7ZEMGRmn.js";import"./index-BvT5vxZ2.js";import"./PopperContent-BKTEdvgV.js";import"./check-CY0rU9Op.js";import"./nullish-CHIgUVhi.js";import"./index-B-3bJqdI.js";import"./index-VOVChzYe.js";import"./x-DatQfog6.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CKkCSvH1.js";import"./Label.vue_vue_type_script_setup_true_lang-DlQMMs8Q.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DUV-Q_i-.js";import"./circle-alert-ChcOZlmI.js";import"./map-pin-kb9yj2dv.js";import"./RovingFocusItem-Cbt3xgLf.js";import"./utils-DVLoAl8m.js";const vt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xt={class:"flex items-center justify-between"},yt={class:"flex items-center gap-4"},bt={class:"p-3 bg-primary/10 rounded-lg"},ht={class:"text-2xl font-bold tracking-tight"},wt={class:"flex items-center gap-2 mt-1"},$t={class:"flex gap-2"},kt={class:"grid gap-6 md:grid-cols-4"},St={class:"text-2xl font-bold"},Ct={class:"text-2xl font-bold"},jt={class:"text-sm font-bold"},Dt={class:"text-2xl font-bold"},Et={class:"flex items-center gap-3"},Tt={class:"font-medium"},Ut={class:"flex items-center gap-1"},At={class:"text-sm"},Rt={key:1,class:"text-center py-8 text-muted-foreground"},Nt={key:2,class:"mt-4 text-sm text-muted-foreground text-center"},Vt={key:0},Ft={class:"space-y-4"},Lt={class:"flex items-center justify-between"},Mt={class:"font-semibold"},Pt={class:"text-sm text-muted-foreground"},zt={key:1,class:"text-center py-8 text-muted-foreground"},Bt={key:0,class:"space-y-3"},qt={class:"font-semibold"},It={class:"text-sm text-muted-foreground"},Ot={key:1,class:"text-center py-8 text-muted-foreground"},Ht={class:"grid grid-cols-2 gap-4"},Wt={class:"text-sm font-mono"},Jt={class:"text-sm font-mono"},Xt={class:"text-sm"},Gt={class:"text-sm"},Kt={class:"text-sm"},Qt={key:0},Yt={class:"text-sm"},Ye=X({__name:"Show",props:{segment:{},users:{},metadata:{},isPaginated:{type:Boolean}},setup(V){const v=V,F=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:v.segment.name,href:"#"}],y=G(!1),L=l=>l.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2),M=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),U=l=>new Date(l).toLocaleString("es-ES"),P=l=>l<60?`${l} segundos`:l<3600?`${Math.floor(l/60)} minutos`:`${Math.floor(l/3600)} horas`,z=l=>l.split("\\").pop()||l,B=l=>l!=null&&l.last_calculated_at?new Date(l.last_calculated_at).toLocaleString():"Nunca",q=async()=>{var l;y.value=!0;try{(await(await fetch(`/admin/segments/${v.segment.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""}})).json()).success&&R.reload()}catch(s){console.error("Error evaluating segment:",s)}finally{y.value=!1}},I=()=>{R.post(`/admin/segments/${v.segment.id}/clear-cache`)},A=()=>v.isPaginated?v.users:{data:v.users},O=l=>Array.isArray(l)?l.join(", "):typeof l=="object"&&l!==null?JSON.stringify(l):String(l),H=l=>{if(!l||typeof l!="object")return[];const s=[];for(const[r,m]of Object.entries(l))m!=null&&s.push({field:r,value:m});return s};return(l,s)=>(d(),$(J,{breadcrumbs:F},{default:a(()=>[e(t(K),{title:`Segmento: ${l.segment.name}`},null,8,["title"]),o("div",vt,[o("div",xt,[o("div",yt,[o("div",bt,[e(t(W),{class:"h-8 w-8 text-primary"})]),o("div",null,[o("h2",ht,i(l.segment.name),1),o("div",wt,[e(t(b),{variant:l.segment.is_dynamic?"default":"secondary"},{default:a(()=>[n(i(l.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"]),e(t(b),{variant:"outline"},{default:a(()=>[n(i(z(l.segment.model_type)),1)]),_:1})])])]),o("div",$t,[e(t(x),{onClick:q,variant:"secondary",disabled:y.value},{default:a(()=>[e(t(rt),{class:Q(["mr-2 h-4 w-4",{"animate-spin":y.value}])},null,8,["class"]),n(" "+i(y.value?"Evaluando...":"Recalcular"),1)]),_:1},8,["disabled"]),e(t(x),{onClick:I,variant:"ghost"},{default:a(()=>[e(t(dt),{class:"mr-2 h-4 w-4"}),s[0]||(s[0]=n(" Limpiar Cache ",-1))]),_:1}),e(t(k),{href:`/admin/segments/${l.segment.id}/edit`},{default:a(()=>[e(t(x),null,{default:a(()=>[e(t(ut),{class:"mr-2 h-4 w-4"}),s[1]||(s[1]=n(" Editar ",-1))]),_:1})]),_:1},8,["href"]),e(t(k),{href:l.route("admin.segments.index")},{default:a(()=>[e(t(x),{variant:"outline"},{default:a(()=>[e(t(mt),{class:"mr-2 h-4 w-4"}),s[2]||(s[2]=n(" Volver ",-1))]),_:1})]),_:1},8,["href"])])]),o("div",kt,[e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>[...s[3]||(s[3]=[n("Usuarios Totales",-1)])]),_:1}),e(t(ft),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>{var r;return[o("div",St,i(((r=l.metadata)==null?void 0:r.contacts_count)||0),1),s[4]||(s[4]=o("p",{class:"text-xs text-muted-foreground"},"usuarios en este segmento",-1))]}),_:1})]),_:1}),e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>[...s[5]||(s[5]=[n("Cache",-1)])]),_:1}),e(t(at),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>[o("div",Ct,i(P(l.segment.cache_duration)),1),s[6]||(s[6]=o("p",{class:"text-xs text-muted-foreground"},"duración del cache",-1))]),_:1})]),_:1}),e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>[...s[7]||(s[7]=[n("Última Evaluación",-1)])]),_:1}),e(t(pt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>[o("div",jt,i(B(l.metadata)),1),s[8]||(s[8]=o("p",{class:"text-xs text-muted-foreground"},"última actualización",-1))]),_:1})]),_:1}),e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>[...s[9]||(s[9]=[n("Roles",-1)])]),_:1}),e(t(_t),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>{var r;return[o("div",Dt,i(((r=l.segment.roles)==null?void 0:r.length)||0),1),s[10]||(s[10]=o("p",{class:"text-xs text-muted-foreground"},"roles asociados",-1))]}),_:1})]),_:1})]),e(t(ot),{defaultValue:"users",class:"space-y-4"},{default:a(()=>[e(t(nt),null,{default:a(()=>[e(t(S),{value:"users"},{default:a(()=>[...s[11]||(s[11]=[n("Usuarios",-1)])]),_:1}),e(t(S),{value:"filters"},{default:a(()=>[...s[12]||(s[12]=[n("Filtros",-1)])]),_:1}),e(t(S),{value:"roles"},{default:a(()=>[...s[13]||(s[13]=[n("Roles",-1)])]),_:1}),e(t(S),{value:"details"},{default:a(()=>[...s[14]||(s[14]=[n("Detalles",-1)])]),_:1})]),_:1}),e(t(C),{value:"users"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>[...s[15]||(s[15]=[n("Usuarios en este Segmento",-1)])]),_:1}),e(t(T),null,{default:a(()=>[...s[16]||(s[16]=[n(" Lista de usuarios que cumplen con los criterios del segmento ",-1)])]),_:1})]),_:1}),e(t(c),null,{default:a(()=>{var r,m;return[(r=A().data)!=null&&r.length?(d(),$(t(Y),{key:0},{default:a(()=>[e(t(Z),null,{default:a(()=>[e(t(N),null,{default:a(()=>[e(t(h),null,{default:a(()=>[...s[17]||(s[17]=[n("Usuario",-1)])]),_:1}),e(t(h),null,{default:a(()=>[...s[18]||(s[18]=[n("Email",-1)])]),_:1}),e(t(h),null,{default:a(()=>[...s[19]||(s[19]=[n("Estado",-1)])]),_:1}),e(t(h),null,{default:a(()=>[...s[20]||(s[20]=[n("Registro",-1)])]),_:1}),e(t(h),{class:"text-right"},{default:a(()=>[...s[21]||(s[21]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(tt),null,{default:a(()=>[(d(!0),u(D,null,E(A().data,f=>(d(),$(t(N),{key:f.id},{default:a(()=>[e(t(w),null,{default:a(()=>[o("div",Et,[e(t(et),{class:"h-8 w-8"},{default:a(()=>[f.avatar?(d(),$(t(lt),{key:0,src:f.avatar,alt:f.name},null,8,["src","alt"])):j("",!0),e(t(st),null,{default:a(()=>[n(i(L(f.name)),1)]),_:2},1024)]),_:2},1024),o("span",Tt,i(f.name),1)])]),_:2},1024),e(t(w),null,{default:a(()=>[o("div",Ut,[e(t(gt),{class:"h-4 w-4 text-muted-foreground"}),o("span",At,i(f.email),1)])]),_:2},1024),e(t(w),null,{default:a(()=>[e(t(b),{variant:f.activo?"default":"secondary"},{default:a(()=>[n(i(f.activo?"Activo":"Inactivo"),1)]),_:2},1032,["variant"])]),_:2},1024),e(t(w),null,{default:a(()=>[n(i(M(f.created_at)),1)]),_:2},1024),e(t(w),{class:"text-right"},{default:a(()=>[e(t(k),{href:`/admin/users/${f.id}`},{default:a(()=>[e(t(x),{size:"sm",variant:"ghost"},{default:a(()=>[e(t(ct),{class:"mr-2 h-4 w-4"}),s[22]||(s[22]=n(" Ver Usuario ",-1))]),_:1})]),_:2},1032,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(d(),u("div",Rt," No hay usuarios en este segmento ")),l.isPaginated?(d(),u("div",Nt," Mostrando "+i((m=l.users.data)==null?void 0:m.length)+" de "+i(l.users.total)+" usuarios ",1)):j("",!0)]}),_:1})]),_:1})]),_:1}),e(t(C),{value:"filters"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>[...s[23]||(s[23]=[n("Criterios de Filtrado",-1)])]),_:1}),e(t(T),null,{default:a(()=>[...s[24]||(s[24]=[n(" Filtros aplicados para determinar los usuarios de este segmento ",-1)])]),_:1})]),_:1}),e(t(c),null,{default:a(()=>[l.segment.filters&&Object.keys(l.segment.filters).length>0?(d(),u("div",Vt,[e(t(it),{class:"h-[400px]"},{default:a(()=>[o("div",Ft,[(d(!0),u(D,null,E(H(l.segment.filters),r=>(d(),u("div",{key:r.field,class:"p-4 border rounded-lg"},[o("div",Lt,[o("div",null,[o("p",Mt,i(r.field),1),o("p",Pt,i(O(r.value)),1)]),e(t(b),{variant:"outline"},{default:a(()=>[n(i(typeof r.value=="object"?"Complejo":"Simple"),1)]),_:2},1024)])]))),128))])]),_:1})])):(d(),u("div",zt," No hay filtros definidos para este segmento "))]),_:1})]),_:1})]),_:1}),e(t(C),{value:"roles"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>[...s[25]||(s[25]=[n("Roles Asociados",-1)])]),_:1}),e(t(T),null,{default:a(()=>[...s[26]||(s[26]=[n(" Roles que utilizan este segmento para delimitar el alcance de datos ",-1)])]),_:1})]),_:1}),e(t(c),null,{default:a(()=>{var r;return[(r=l.segment.roles)!=null&&r.length?(d(),u("div",Bt,[(d(!0),u(D,null,E(l.segment.roles,m=>(d(),u("div",{key:m.id,class:"flex items-center justify-between p-4 border rounded-lg"},[o("div",null,[o("h4",qt,i(m.display_name),1),o("p",It,i(m.name),1)]),e(t(k),{href:`/admin/roles/${m.id}`},{default:a(()=>[e(t(x),{size:"sm",variant:"ghost"},{default:a(()=>[...s[27]||(s[27]=[n(" Ver Rol ",-1)])]),_:1})]),_:2},1032,["href"])]))),128))])):(d(),u("div",Ot," No hay roles asociados a este segmento "))]}),_:1})]),_:1})]),_:1}),e(t(C),{value:"details"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>[...s[28]||(s[28]=[n("Información del Segmento",-1)])]),_:1})]),_:1}),e(t(c),{class:"space-y-4"},{default:a(()=>{var r;return[o("div",Ht,[o("div",null,[s[29]||(s[29]=o("p",{class:"text-sm font-medium text-muted-foreground"},"ID del Segmento",-1)),o("p",Wt,i(l.segment.id),1)]),o("div",null,[s[30]||(s[30]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Modelo",-1)),o("p",Jt,i(l.segment.model_type),1)]),o("div",null,[s[31]||(s[31]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Creado por",-1)),o("p",Xt,i(((r=l.segment.created_by)==null?void 0:r.name)||"Sistema"),1)]),o("div",null,[s[32]||(s[32]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo",-1)),e(t(b),{variant:l.segment.is_dynamic?"default":"secondary"},{default:a(()=>[n(i(l.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"])]),o("div",null,[s[33]||(s[33]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Creado",-1)),o("p",Gt,i(U(l.segment.created_at)),1)]),o("div",null,[s[34]||(s[34]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Última Actualización",-1)),o("p",Kt,i(U(l.segment.updated_at)),1)])]),l.segment.description?(d(),u("div",Qt,[s[35]||(s[35]=o("p",{class:"text-sm font-medium text-muted-foreground mb-2"},"Descripción",-1)),o("p",Yt,i(l.segment.description),1)])):j("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}))}});export{Ye as default};
