import{d as Y,r as A,c as j,p as se,i as f,j as p,g as d,b as B,e as s,f as t,w as i,h as m,F as O,k as R,t as c,l as Z,n as L,m as n}from"./app-B9TOPmlt.js";import{a as q,b as H,c as K,_ as G}from"./CardTitle.vue_vue_type_script_setup_true_lang-8JbMmZ0-.js";import{_ as z}from"./Label.vue_vue_type_script_setup_true_lang-B_9lqbQW.js";import{_ as le}from"./Input.vue_vue_type_script_setup_true_lang-CvNMbvGN.js";import{_ as ie}from"./Textarea.vue_vue_type_script_setup_true_lang-Ch7dBgvo.js";import{_ as P}from"./createLucideIcon-DpBiCm_n.js";import{_ as oe,a as re,b as ne,c as de,d as W}from"./SelectValue.vue_vue_type_script_setup_true_lang-D3EwhHq3.js";import{_ as U}from"./InputError.vue_vue_type_script_setup_true_lang-DUBMe6Vn.js";import{_ as X}from"./index-BX3b2fLA.js";import{_ as ue,a as ce}from"./index-C3rdOr2P.js";import{U as J}from"./upload-CNhMs-i7.js";import{C as me}from"./circle-alert-DS5qv-mP.js";import{P as fe}from"./paperclip-Bss7YulS.js";import{X as Q}from"./x-Cei9FK_W.js";import{L as ve}from"./loader-circle-txzZleJg.js";const ge={class:"space-y-4"},pe={key:0,class:"space-y-2"},xe={class:"space-y-2"},be={class:"flex items-center gap-3 flex-1 min-w-0"},he={class:"min-w-0 flex-1"},_e={class:"text-sm font-medium truncate"},ye={key:0,class:"text-xs text-muted-foreground"},$e=["multiple","accept","disabled"],ke={class:"text-sm font-medium mb-1"},Fe={class:"text-xs text-muted-foreground"},we={class:"text-xs text-muted-foreground mt-1"},Be={key:0},Ce={key:1,class:"space-y-2"},ze={class:"space-y-2"},Me={class:"flex items-center gap-3 flex-1 min-w-0"},Se={class:"min-w-0 flex-1"},Ve={class:"text-sm font-medium truncate"},Ae={class:"text-xs text-muted-foreground"},je={key:3,class:"text-xs text-muted-foreground"},De={key:0,class:"text-destructive"},Ee=Y({__name:"FileAttachmentManager",props:{existingFiles:{default:()=>[]},label:{},description:{},multiple:{type:Boolean,default:!0},maxFiles:{default:10},maxSizeMB:{default:5},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},disabled:{type:Boolean,default:!1},error:{}},emits:["files-added","file-removed"],setup(a,{expose:N,emit:b}){const v=a,u=b,M=A(),_=A(!1),g=A([]),C=A(""),y=j(()=>v.existingFiles||[]),$=j(()=>y.value.length+g.value.length),D=j(()=>$.value<v.maxFiles),E=()=>{var o;!v.disabled&&D.value&&((o=M.value)==null||o.click())},I=o=>{const e=o.target;e.files&&(l(Array.from(e.files)),e.value="")},x=o=>{var r;if(o.preventDefault(),_.value=!1,v.disabled)return;const e=Array.from(((r=o.dataTransfer)==null?void 0:r.files)||[]);l(e)},l=o=>{C.value="";const e=v.maxFiles-$.value;if(o.length>e){C.value=`Solo puedes agregar ${e} archivo(s) más. Límite: ${v.maxFiles}`;return}const r=[],h=[];o.forEach(w=>{var T;const ee=v.maxSizeMB*1024*1024;if(w.size>ee){h.push(`${w.name}: excede ${v.maxSizeMB}MB`);return}const te=`.${(T=w.name.split(".").pop())==null?void 0:T.toLowerCase()}`;if(!v.accept.split(",").map(ae=>ae.trim().toLowerCase()).includes(te)){h.push(`${w.name}: formato no permitido`);return}r.push(w)}),h.length>0&&(C.value=h.join(", ")),r.length>0&&(v.multiple?g.value.push(...r):g.value=[r[0]],u("files-added",g.value))},k=o=>{g.value.splice(o,1),u("files-added",g.value)},F=o=>{const e=y.value[o];e&&confirm("¿Estás seguro de eliminar este archivo?")&&u("file-removed",e.ruta)},S=o=>{if(!o)return"0 KB";const e=["B","KB","MB","GB"],r=Math.floor(Math.log(o)/Math.log(1024));return`${(o/Math.pow(1024,r)).toFixed(1)} ${e[r]}`},V=o=>{var e;return((e=o.split(".").pop())==null?void 0:e.toUpperCase())||"FILE"};return N({newFiles:g,clearNewFiles:()=>{g.value=[]}}),se(()=>v.error,o=>{o||(C.value="")}),(o,e)=>(n(),f("div",ge,[y.value.length>0?(n(),f("div",pe,[s(t(z),{class:"text-sm font-medium"},{default:i(()=>[...e[2]||(e[2]=[m("Archivos actuales",-1)])]),_:1}),d("div",xe,[(n(!0),f(O,null,R(y.value,(r,h)=>(n(),f("div",{key:`existing-${h}`,class:"flex items-center justify-between p-3 bg-muted rounded-lg border border-border hover:bg-accent/50 transition-colors"},[d("div",be,[s(t(fe),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),d("div",he,[d("p",_e,c(r.nombre_original),1),r.tamaño?(n(),f("p",ye,c(S(r.tamaño)),1)):p("",!0)]),s(t(X),{variant:"outline",class:"flex-shrink-0"},{default:i(()=>[m(c(V(r.nombre_original)),1)]),_:2},1024)]),s(t(P),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10 flex-shrink-0",onClick:w=>F(h),disabled:a.disabled},{default:i(()=>[s(t(Q),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])]))),128))])])):p("",!0),d("div",null,[a.label?(n(),B(t(z),{key:0,class:"text-sm font-medium"},{default:i(()=>[m(c(a.label),1)]),_:1})):p("",!0),d("div",{onDrop:x,onDragover:e[0]||(e[0]=Z(r=>_.value=!0,["prevent"])),onDragleave:e[1]||(e[1]=r=>_.value=!1),onClick:E,class:"relative mt-2"},[d("input",{ref_key:"fileInput",ref:M,type:"file",multiple:a.multiple,accept:a.accept,disabled:a.disabled,class:"hidden",onChange:I},null,40,$e),d("div",{class:L(["border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-all",{"border-primary bg-primary/5 ring-2 ring-primary/20":_.value,"border-muted-foreground/25 hover:border-muted-foreground/50 hover:bg-muted/30":!_.value&&!a.disabled,"opacity-50 cursor-not-allowed":a.disabled,"border-destructive":a.error}])},[s(t(J),{class:L(["h-10 w-10 mx-auto mb-3 transition-colors",_.value?"text-primary":"text-muted-foreground"])},null,8,["class"]),d("p",ke,c(_.value?"Suelta los archivos aquí":"Haz clic o arrastra archivos aquí"),1),d("p",Fe,c(a.description||`Formatos: ${a.accept}`),1),d("p",we,[m(" Máximo "+c(a.maxSizeMB)+"MB por archivo ",1),a.multiple?(n(),f("span",Be," • Hasta "+c(a.maxFiles)+" archivos total",1)):p("",!0)])],2)],32)]),g.value.length>0?(n(),f("div",Ce,[s(t(z),{class:"text-sm font-medium"},{default:i(()=>[...e[3]||(e[3]=[m("Archivos a subir",-1)])]),_:1}),d("div",ze,[(n(!0),f(O,null,R(g.value,(r,h)=>(n(),f("div",{key:`new-${h}`,class:"flex items-center justify-between p-3 bg-accent rounded-lg border border-primary/20"},[d("div",Me,[s(t(J),{class:"h-4 w-4 text-primary flex-shrink-0"}),d("div",Se,[d("p",Ve,c(r.name),1),d("p",Ae,c(S(r.size)),1)]),s(t(X),{variant:"secondary",class:"flex-shrink-0"},{default:i(()=>[m(c(V(r.name)),1)]),_:2},1024)]),s(t(P),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 hover:bg-destructive/10 flex-shrink-0",onClick:w=>k(h),disabled:a.disabled},{default:i(()=>[s(t(Q),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])]))),128))])])):p("",!0),a.error?(n(),B(t(ue),{key:2,variant:"destructive"},{default:i(()=>[s(t(me),{class:"h-4 w-4"}),s(t(ce),null,{default:i(()=>[m(c(a.error),1)]),_:1})]),_:1})):p("",!0),!a.disabled&&(y.value.length>0||g.value.length>0)?(n(),f("div",je,[m(c($.value)+" de "+c(a.maxFiles)+" archivos ",1),$.value>=a.maxFiles?(n(),f("span",De," (límite alcanzado)")):p("",!0)])):p("",!0)]))}}),Ie={key:0},Le={class:"flex justify-end gap-2"},et=Y({__name:"ObligacionForm",props:{obligacion:{},contratoId:{},contratos:{default:()=>[]},parentId:{},posiblesPadres:{default:()=>[]},usuarios:{default:()=>[]},loading:{type:Boolean,default:!1},errors:{default:()=>({})}},emits:["submit","cancel"],setup(a,{emit:N}){var $,D,E,I;const b=a,v=N,u=A({contrato_id:b.contratoId||(($=b.obligacion)==null?void 0:$.contrato_id)||0,parent_id:b.parentId||((D=b.obligacion)==null?void 0:D.parent_id)||null,titulo:((E=b.obligacion)==null?void 0:E.titulo)||"",descripcion:((I=b.obligacion)==null?void 0:I.descripcion)||"",archivos:[],archivos_eliminar:[]}),M=j(()=>b.posiblesPadres||[]),_=j(()=>{var l;return(((l=b.obligacion)==null?void 0:l.archivos_adjuntos)||[]).filter(k=>{var F;return!((F=u.value.archivos_eliminar)!=null&&F.includes(k.ruta))})}),g=()=>{const x={...u.value};v("submit",x)},C=x=>{u.value.archivos=x},y=x=>{u.value.archivos_eliminar=u.value.archivos_eliminar||[],u.value.archivos_eliminar.includes(x)||u.value.archivos_eliminar.push(x)};return(x,l)=>(n(),f("form",{onSubmit:Z(g,["prevent"]),class:"space-y-4"},[s(t(G),null,{default:i(()=>[s(t(q),null,{default:i(()=>[s(t(H),null,{default:i(()=>[...l[4]||(l[4]=[m("Información Básica",-1)])]),_:1})]),_:1}),s(t(K),{class:"space-y-4"},{default:i(()=>{var k,F,S,V,o;return[d("div",null,[s(t(z),{for:"titulo",required:""},{default:i(()=>[...l[5]||(l[5]=[m("Título",-1)])]),_:1}),s(t(le),{id:"titulo",modelValue:u.value.titulo,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value.titulo=e),type:"text",placeholder:"Título de la obligación",class:L({"border-red-500":(k=a.errors)==null?void 0:k.titulo})},null,8,["modelValue","class"]),(F=a.errors)!=null&&F.titulo?(n(),B(U,{key:0,message:a.errors.titulo[0]},null,8,["message"])):p("",!0)]),d("div",null,[s(t(z),{for:"descripcion"},{default:i(()=>[...l[6]||(l[6]=[m("Descripción",-1)])]),_:1}),s(t(ie),{id:"descripcion",modelValue:u.value.descripcion,"onUpdate:modelValue":l[1]||(l[1]=e=>u.value.descripcion=e),placeholder:"Descripción detallada de la obligación",rows:3,class:L({"border-red-500":(S=a.errors)==null?void 0:S.descripcion})},null,8,["modelValue","class"]),(V=a.errors)!=null&&V.descripcion?(n(),B(U,{key:0,message:a.errors.descripcion[0]},null,8,["message"])):p("",!0)]),M.value.length>0?(n(),f("div",Ie,[s(t(z),{for:"parent_id"},{default:i(()=>[...l[7]||(l[7]=[m("Obligación Padre",-1)])]),_:1}),s(t(oe),{modelValue:u.value.parent_id,"onUpdate:modelValue":l[2]||(l[2]=e=>u.value.parent_id=e)},{default:i(()=>[s(t(re),{id:"parent_id"},{default:i(()=>[s(t(ne),{placeholder:"Seleccionar obligación padre (opcional)"})]),_:1}),s(t(de),null,{default:i(()=>[s(t(W),{value:null},{default:i(()=>[...l[8]||(l[8]=[m("Sin padre (raíz)",-1)])]),_:1}),(n(!0),f(O,null,R(M.value,e=>{var r;return n(),B(t(W),{key:e.id,value:e.id,disabled:e.id===((r=a.obligacion)==null?void 0:r.id)},{default:i(()=>[m(c("  ".repeat(e.nivel))+c(e.titulo),1)]),_:2},1032,["value","disabled"])}),128))]),_:1})]),_:1},8,["modelValue"]),(o=a.errors)!=null&&o.parent_id?(n(),B(U,{key:0,message:a.errors.parent_id[0]},null,8,["message"])):p("",!0)])):p("",!0)]}),_:1})]),_:1}),s(t(G),null,{default:i(()=>[s(t(q),null,{default:i(()=>[s(t(H),null,{default:i(()=>[...l[9]||(l[9]=[m("Archivos Adjuntos",-1)])]),_:1})]),_:1}),s(t(K),null,{default:i(()=>[s(Ee,{"existing-files":_.value,description:"Formatos: PDF, Word, Excel, Imágenes",multiple:!0,"max-files":20,"max-size-m-b":5,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",onFilesAdded:C,onFileRemoved:y},null,8,["existing-files"])]),_:1})]),_:1}),d("div",Le,[s(t(P),{type:"button",variant:"outline",onClick:l[3]||(l[3]=k=>x.$emit("cancel")),disabled:a.loading},{default:i(()=>[...l[10]||(l[10]=[m(" Cancelar ",-1)])]),_:1},8,["disabled"]),s(t(P),{type:"submit",disabled:a.loading||!u.value.titulo},{default:i(()=>[a.loading?(n(),B(t(ve),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):p("",!0),m(" "+c(a.obligacion?"Actualizar":"Crear")+" Obligación ",1)]),_:1},8,["disabled"])])],32))}});export{et as _};
