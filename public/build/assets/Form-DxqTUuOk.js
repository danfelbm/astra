import{d as He,k as H,c as U,w as oe,s as Qe,a as p,o as u,j as B,i as O,f as l,e as m,b as n,u as e,g as C,t as _,F as Y,r as Z,bT as rt,n as J,C as st,v as it,m as ot,W as nt,h as dt,Y as lt,bQ as ut,bG as ct,T as ft,X as mt}from"./app-BIMko_UV.js";import{_ as se}from"./AppLogo.vue_vue_type_script_setup_true_lang-oP2lgVHX.js";import{r as te,_ as ne,a as de,j as De,c as le,M as ie,C as Le,U as gt,af as j,b as Pe,d as pt,e as _t,f as vt,g as bt,h as yt,ag as ht,i as xt,ah as kt}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dh9MVSkT.js";import{_ as St}from"./Checkbox.vue_vue_type_script_setup_true_lang-Ctshw_eX.js";import{_ as ae,a as fe}from"./Label.vue_vue_type_script_setup_true_lang-zK94JE5K.js";import{_ as wt}from"./Progress.vue_vue_type_script_setup_true_lang-CLfJpaKS.js";import{_ as Ct}from"./Textarea.vue_vue_type_script_setup_true_lang-ypIKiO4t.js";import{u as $t,a as Et,_ as Tt,b as Vt,c as At,d as jt}from"./useConditionalFields-B2c5AULz.js";import{_ as Re}from"./CardDescription.vue_vue_type_script_setup_true_lang-BgfQxE3t.js";import{_ as Ot,a as Me}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-BUf04egm.js";import{a as ze,_ as We}from"./index-BpQtRk6v.js";import{_ as Ge}from"./AlertTitle.vue_vue_type_script_setup_true_lang-BpL03yzN.js";import{A as Ut}from"./arrow-left-PFosEoAp.js";import{C as me}from"./clock-DVlP3jnu.js";import{C as Ye}from"./circle-check-big-lts1pBOd.js";import{U as Ft}from"./user-Baz35Dnp.js";import{S as It}from"./save-KZOKPdhH.js";import"./index-Cla_L7s9.js";import"./VisuallyHidden-BFhvIiHO.js";import"./upload-BaEiHVX2.js";import"./eye-Dbzeht3I.js";import"./download-BNvuX1cc.js";import"./plus-CiYaRuu1.js";import"./grip-vertical-DcEjTpMT.js";import"./trash-2-BOzlUurD.js";import"./RovingFocusItem-D114ipG_.js";import"./VisuallyHiddenInput-DxuYOzr8.js";const Nt={class:"space-y-4"},qt={key:0,class:"text-center py-8"},Bt={key:2,class:"space-y-6"},Dt={key:0},Lt={class:"text-sm font-medium text-muted-foreground mb-3"},Pt={class:"space-y-3"},Rt={class:"flex items-start gap-3"},Mt={class:"flex-1"},zt={class:"flex items-center justify-between"},Wt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Gt={class:"flex items-center gap-2 text-muted-foreground"},Yt={class:"flex items-center gap-2 text-muted-foreground"},Jt={class:"flex items-center gap-2 text-muted-foreground"},Kt={key:0,class:"flex items-center gap-2 text-muted-foreground"},Xt={class:"mt-3 text-xs text-muted-foreground"},Ht={key:1},Qt={class:"text-sm font-medium text-muted-foreground mb-3"},Zt={class:"space-y-3"},ea={class:"flex items-start gap-3"},ta={class:"flex-1"},aa={class:"flex items-center justify-between"},ra={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},sa={class:"flex items-center gap-2 text-muted-foreground"},ia={class:"flex items-center gap-2 text-muted-foreground"},oa={class:"flex items-center gap-2 text-muted-foreground"},na={class:"mt-3 text-xs text-muted-foreground"},da={key:4,class:"mt-4 p-3 bg-muted/50 rounded-lg"},la={class:"text-sm text-muted-foreground"},ua=He({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(i,{emit:o}){var L;const $=i,V=o,S=H([]),A=H(!1),a=H(null),h=H((L=$.modelValue)==null?void 0:L.toString()),x=async()=>{A.value=!0,a.value=null;try{const k=await rt.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:$.filtrarPorUbicacion,incluir_futuras:!0}});S.value=k.data}catch(k){a.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",k)}finally{A.value=!1}},T=U(()=>{const k={abiertas:[],futuras:[]};return S.value.forEach(b=>{b.estado_temporal==="abierta"?k.abiertas.push(b):b.estado_temporal==="futura"&&k.futuras.push(b)}),k}),W=U(()=>S.value.find(k=>k.id===Number(h.value)));oe(h,k=>{V("update:modelValue",k?Number(k):void 0)}),oe(()=>$.modelValue,k=>{h.value=k==null?void 0:k.toString()});const D=k=>new Date(k).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=k=>{switch(k){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},R=k=>{switch(k){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Qe(()=>{x()}),(k,b)=>(u(),p("div",Nt,[A.value?(u(),p("div",qt,b[1]||(b[1]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),l("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):a.value?(u(),B(e(We),{key:1,variant:"destructive"},{default:m(()=>[n(e(te),{class:"h-4 w-4"}),n(e(Ge),null,{default:m(()=>b[2]||(b[2]=[C("Error")])),_:1}),n(e(ze),null,{default:m(()=>[C(_(a.value),1)]),_:1})]),_:1})):S.value.length>0?(u(),p("div",Bt,[n(e(Ot),{modelValue:h.value,"onUpdate:modelValue":b[0]||(b[0]=f=>h.value=f),disabled:k.disabled},{default:m(()=>[T.value.abiertas.length>0?(u(),p("div",Dt,[l("h4",Lt," Convocatorias Abiertas ("+_(T.value.abiertas.length)+") ",1),l("div",Pt,[(u(!0),p(Y,null,Z(T.value.abiertas,f=>(u(),B(e(ne),{key:f.id,class:J(["cursor-pointer hover:shadow-md transition-all duration-200",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":h.value===f.id.toString(),"hover:bg-muted/50":h.value!==f.id.toString()}]),onClick:M=>h.value=f.id.toString()},{default:m(()=>[n(e(de),{class:"pb-3"},{default:m(()=>[l("div",Rt,[n(e(Me),{value:f.id.toString(),id:`conv-${f.id}`},null,8,["value","id"]),l("div",Mt,[l("div",zt,[n(e(ae),{for:`conv-${f.id}`,class:"text-base font-semibold cursor-pointer"},{default:m(()=>[C(_(f.nombre),1)]),_:2},1032,["for"]),n(e(De),{class:J(F(f.estado_temporal))},{default:m(()=>[C(_(R(f.estado_temporal)),1)]),_:2},1032,["class"])]),n(e(Re),{class:"mt-1"},{default:m(()=>[C(_(f.descripcion),1)]),_:2},1024)])])]),_:2},1024),n(e(le),{class:"pt-0"},{default:m(()=>[l("div",Wt,[l("div",Gt,[n(e(ie),{class:"h-4 w-4"}),l("span",null,_(f.cargo.nombre),1)]),l("div",Yt,[n(e(Le),{class:"h-4 w-4"}),l("span",null,_(f.periodo_electoral.nombre),1)]),l("div",Jt,[n(e(ie),{class:"h-4 w-4"}),l("span",null,_(f.ubicacion),1)]),f.numero_postulaciones!==void 0?(u(),p("div",Kt,[n(e(gt),{class:"h-4 w-4"}),l("span",null,_(f.numero_postulaciones)+" postulaciones",1)])):O("",!0)]),l("div",Xt,[b[3]||(b[3]=l("span",{class:"font-medium"},"Cierre:",-1)),C(" "+_(D(f.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):O("",!0),T.value.futuras.length>0?(u(),p("div",Ht,[l("h4",Qt," Próximas Convocatorias ("+_(T.value.futuras.length)+") ",1),l("div",Zt,[(u(!0),p(Y,null,Z(T.value.futuras,f=>(u(),B(e(ne),{key:f.id,class:J(["cursor-pointer hover:shadow-md transition-all duration-200 opacity-90",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":h.value===f.id.toString(),"hover:bg-muted/50":h.value!==f.id.toString()}]),onClick:M=>h.value=f.id.toString()},{default:m(()=>[n(e(de),{class:"pb-3"},{default:m(()=>[l("div",ea,[n(e(Me),{value:f.id.toString(),id:`conv-${f.id}`},null,8,["value","id"]),l("div",ta,[l("div",aa,[n(e(ae),{for:`conv-${f.id}`,class:"text-base font-semibold cursor-pointer"},{default:m(()=>[C(_(f.nombre),1)]),_:2},1032,["for"]),n(e(De),{class:J(F(f.estado_temporal))},{default:m(()=>[C(_(R(f.estado_temporal)),1)]),_:2},1032,["class"])]),n(e(Re),{class:"mt-1"},{default:m(()=>[C(_(f.descripcion),1)]),_:2},1024)])])]),_:2},1024),n(e(le),{class:"pt-0"},{default:m(()=>[l("div",ra,[l("div",sa,[n(e(ie),{class:"h-4 w-4"}),l("span",null,_(f.cargo.nombre),1)]),l("div",ia,[n(e(Le),{class:"h-4 w-4"}),l("span",null,_(f.periodo_electoral.nombre),1)]),l("div",oa,[n(e(ie),{class:"h-4 w-4"}),l("span",null,_(f.ubicacion),1)])]),l("div",na,[b[4]||(b[4]=l("span",{class:"font-medium"},"Apertura:",-1)),C(" "+_(D(f.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):O("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),B(e(We),{key:3},{default:m(()=>[n(e(te),{class:"h-4 w-4"}),n(e(Ge),null,{default:m(()=>b[5]||(b[5]=[C("Sin convocatorias disponibles")])),_:1}),n(e(ze),null,{default:m(()=>b[6]||(b[6]=[C(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),W.value&&!k.disabled?(u(),p("div",da,[b[7]||(b[7]=l("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),l("p",la,_(W.value.nombre),1)])):O("",!0)]))}});var ca=typeof global=="object"&&global&&global.Object===Object&&global,fa=typeof self=="object"&&self&&self.Object===Object&&self,Ze=ca||fa||Function("return this")(),ue=Ze.Symbol,et=Object.prototype,ma=et.hasOwnProperty,ga=et.toString,ee=ue?ue.toStringTag:void 0;function pa(i){var o=ma.call(i,ee),$=i[ee];try{i[ee]=void 0;var V=!0}catch{}var S=ga.call(i);return V&&(o?i[ee]=$:delete i[ee]),S}var _a=Object.prototype,va=_a.toString;function ba(i){return va.call(i)}var ya="[object Null]",ha="[object Undefined]",Je=ue?ue.toStringTag:void 0;function xa(i){return i==null?i===void 0?ha:ya:Je&&Je in Object(i)?pa(i):ba(i)}function ka(i){return i!=null&&typeof i=="object"}var Sa="[object Symbol]";function wa(i){return typeof i=="symbol"||ka(i)&&xa(i)==Sa}var Ca=/\s/;function $a(i){for(var o=i.length;o--&&Ca.test(i.charAt(o)););return o}var Ea=/^\s+/;function Ta(i){return i&&i.slice(0,$a(i)+1).replace(Ea,"")}function pe(i){var o=typeof i;return i!=null&&(o=="object"||o=="function")}var Ke=NaN,Va=/^[-+]0x[0-9a-f]+$/i,Aa=/^0b[01]+$/i,ja=/^0o[0-7]+$/i,Oa=parseInt;function Xe(i){if(typeof i=="number")return i;if(wa(i))return Ke;if(pe(i)){var o=typeof i.valueOf=="function"?i.valueOf():i;i=pe(o)?o+"":o}if(typeof i!="string")return i===0?i:+i;i=Ta(i);var $=Aa.test(i);return $||ja.test(i)?Oa(i.slice(2),$?2:8):Va.test(i)?Ke:+i}var ge=function(){return Ze.Date.now()},Ua="Expected a function",Fa=Math.max,Ia=Math.min;function Na(i,o,$){var V,S,A,a,h,x,T=0,W=!1,D=!1,F=!0;if(typeof i!="function")throw new TypeError(Ua);o=Xe(o)||0,pe($)&&(W=!!$.leading,D="maxWait"in $,A=D?Fa(Xe($.maxWait)||0,o):A,F="trailing"in $?!!$.trailing:F);function R(w){var I=V,y=S;return V=S=void 0,T=w,a=i.apply(y,I),a}function L(w){return T=w,h=setTimeout(f,o),W?R(w):a}function k(w){var I=w-x,y=w-T,E=o-I;return D?Ia(E,A-y):E}function b(w){var I=w-x,y=w-T;return x===void 0||I>=o||I<0||D&&y>=A}function f(){var w=ge();if(b(w))return M(w);h=setTimeout(f,k(w))}function M(w){return h=void 0,F&&V?R(w):(V=S=void 0,a)}function X(){h!==void 0&&clearTimeout(h),T=0,V=x=S=h=void 0}function G(){return h===void 0?a:M(ge())}function K(){var w=ge(),I=b(w);if(V=arguments,S=this,x=w,I){if(h===void 0)return L(x);if(D)return clearTimeout(h),h=setTimeout(f,o),R(x)}return h===void 0&&(h=setTimeout(f,o)),a}return K.cancel=X,K.flush=G,K}function qa(i,o){const{url:$,candidaturaId:V=null,debounceTime:S=3e3,showNotifications:A=!0,useLocalStorage:a=!0,localStorageKey:h="candidatura_draft"}=o,x=H({status:"idle",lastSaved:null,lastError:null,candidaturaId:V}),T=U(()=>x.value.status==="saving"),W=U(()=>x.value.lastSaved!==null),D=U(()=>x.value.status==="error"),F=()=>{if(a)try{const y={formulario_data:i.value,timestamp:new Date().toISOString(),candidaturaId:x.value.candidaturaId};localStorage.setItem(h,JSON.stringify(y))}catch(y){console.error("Error guardando en localStorage:",y)}},R=()=>{if(!a)return null;try{const y=localStorage.getItem(h);if(y){const E=JSON.parse(y),N=new Date(E.timestamp);if((Date.now()-N.getTime())/(1e3*60*60)<24)return E;localStorage.removeItem(h)}}catch(y){console.error("Error cargando desde localStorage:",y)}return null},L=()=>{a&&localStorage.removeItem(h)},k=async()=>{try{const y=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(y.ok){const E=await y.text(),q=new DOMParser().parseFromString(E,"text/html").querySelector('meta[name="csrf-token"]');if(q){const Q=q.getAttribute("content"),z=document.querySelector('meta[name="csrf-token"]');if(z&&Q)return z.setAttribute("content",Q),Q}}}catch(y){console.error("Error renovando token CSRF:",y)}return null},b=async(y,E,N=0)=>{const P=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":E,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:i.value})});if(P.status===419&&N<1){const q=await k();if(q)return A&&j.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),b(y,q,N+1)}return P},f=async()=>{var y;if(x.value.status!=="saving"&&!(!i.value||Object.keys(i.value).length===0)){x.value.status="saving",x.value.lastError=null;try{const E=x.value.candidaturaId?$.replace("autosave",`${x.value.candidaturaId}/autosave`):$,N=((y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content"))||"";if(!N)throw new Error("Token CSRF no encontrado");const P=await b(E,N);if(!P.ok)throw new Error(`Error ${P.status}: ${P.statusText}`);const q=await P.json();if(q.success)x.value.status="saved",x.value.lastSaved=new Date,!x.value.candidaturaId&&q.candidatura_id&&(x.value.candidaturaId=q.candidatura_id),F(),A&&j.success("Cambios guardados",{description:`Autoguardado a las ${q.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(q.message||"Error al guardar")}catch(E){x.value.status="error",x.value.lastError=E instanceof Error?E.message:"Error desconocido",F(),E instanceof Error&&E.message.includes("419")?A&&j.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):A&&j.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",E)}}},M=Na(f,S),X=()=>(M.cancel(),f()),G=()=>oe(i,()=>{x.value.status!=="error"&&M()},{deep:!0}),K=()=>{M.cancel()},w=()=>{K(),x.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:V},L()},I=()=>{const y=R();return y&&y.formulario_data?(A&&j.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),y):null};return{state:U(()=>x.value),isSaving:T,hasSaved:W,hasError:D,saveNow:X,startWatching:G,stopAutoSave:K,reset:w,restoreDraft:I,clearLocalStorage:L}}const Ba={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 pb-24"},Da={class:"flex items-center justify-between"},La={class:"text-3xl font-bold"},Pa={class:"text-muted-foreground"},Ra={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Ma={key:0,class:"flex items-center gap-1.5"},za={key:1,class:"flex items-center gap-1.5"},Wa={key:2,class:"flex items-center gap-1.5 text-amber-600"},Ga={key:3,class:"flex items-center gap-1.5"},Ya={class:"text-blue-700 dark:text-blue-300"},Ja={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Ka={class:"flex items-start gap-3"},Xa={class:"text-sm text-blue-800"},Ha={key:0,class:"mt-1 text-blue-600"},Qa={key:0,class:"text-red-500"},Za={key:0,class:"text-sm text-muted-foreground"},er={key:6,class:"space-y-2"},tr=["id","name","value","onUpdate:modelValue"],ar={key:7,class:"space-y-2"},rr={key:8},sr={key:9},ir={key:0,class:"text-red-500 text-sm mt-1"},or={key:10},nr={key:11},dr={key:12},lr={key:13,class:"text-sm text-destructive"},ur={key:1,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},cr={class:"text-red-800 text-sm"},fr={key:0,class:"fixed bottom-0 left-0 right-0 z-50 px-2 sm:px-4 pb-2 sm:pb-4"},mr={class:"mx-auto max-w-7xl"},gr={class:"backdrop-blur-lg bg-tertiary-60 dark:bg-gray-900/80 border border-gray-200/50 dark:border-gray-700/50 rounded-xl sm:rounded-2xl shadow-2xl p-3 sm:p-4"},pr={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},_r={class:"hidden sm:flex items-center"},vr={class:"flex-1 sm:max-w-xs lg:max-w-sm mx-0 sm:mx-4"},br={class:"flex items-center gap-3"},yr={class:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap font-medium"},hr={class:"flex items-center gap-2 sm:gap-3"},xr={class:"ml-2 whitespace-nowrap"},kr=He({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(i){var _e,ve;const o=i,$=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:o.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:V}=$t(),S=H({});U(()=>{var v;if(!o.is_editing||!((v=o.candidatura)!=null&&v.formulario_data))return!1;const d=Object.keys(o.candidatura.formulario_data),s=o.configuracion_campos.map(t=>t.id),r=d.some(t=>!s.includes(t)),c=o.configuracion_campos.some(t=>t.required&&!o.candidatura.formulario_data[t.id]);return r||c});const a=st((()=>{var s;const d={};return o.configuracion_campos.forEach(r=>{r.type==="checkbox"?d[r.id]=[]:r.type==="file"?d[r.id]=[]:r.type==="convocatoria"?d[r.id]=void 0:r.type==="disclaimer"?d[r.id]=null:r.type==="repeater"?d[r.id]=[]:r.type==="datepicker"?d[r.id]=null:d[r.id]=""}),(s=o.candidatura)!=null&&s.formulario_data&&(Object.assign(d,o.candidatura.formulario_data),o.configuracion_campos.forEach(r=>{r.type==="file"&&d[r.id]&&(Array.isArray(d[r.id])||(d[r.id]=[d[r.id]]))})),{formulario_data:d}})()),h=H(o.configuracion_campos),x=U(()=>a.formulario_data),{visibleFields:T,clearHiddenFieldValues:W}=Et(h,x);oe(T,()=>{W()});const{state:D,isSaving:F,hasSaved:R,hasError:L,saveNow:k,startWatching:b,stopAutoSave:f,restoreDraft:M,clearLocalStorage:X}=qa(x,{url:"/candidaturas/autosave",candidaturaId:((_e=o.candidatura)==null?void 0:_e.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((ve=o.candidatura)==null?void 0:ve.id)||"new"}`});let G=null;Qe(()=>{const d=["borrador","rechazado"];if(!o.candidatura||d.includes(o.candidatura.estado)){if(!o.is_editing){const r=M();r&&r.formulario_data&&(j.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{X(),a.reset(),j.success("Borrador descartado")}},duration:5e3}),Object.assign(a.formulario_data,r.formulario_data))}G=b()}}),it(()=>{G&&G(),f()});const K=async()=>{if(F.value){j.warning("Ya se está guardando...");return}await k(),L.value||j.success("Borrador guardado manualmente")},w=U(()=>N.value.map(r=>{var t;if(!r.required)return{campo:r.id,valid:!0};const c=a.formulario_data[r.id];let v=!1;if(r.type==="checkbox")v=Array.isArray(c)&&c.length>0;else if(r.type==="file")(Array.isArray(c)&&c.length>0||S.value[r.id]&&S.value[r.id].length>0)&&(v=!0);else if(r.type==="convocatoria")v=c!=null&&c!=="";else if(r.type==="disclaimer")v=c&&c.accepted===!0;else if(r.type==="repeater"){const re=((t=r.repeaterConfig)==null?void 0:t.minItems)||0;v=Array.isArray(c)&&c.length>=re}else r.type==="datepicker"?v=c!=null&&c!=="":v=c&&c.toString().trim()!=="";return!v&&r.required,{campo:r.id,valid:v}}).every(r=>r.valid)),I=U(()=>{const d=N.value.length;let s=0;return N.value.forEach(r=>{const c=a.formulario_data[r.id];let v=!1;r.type==="checkbox"?v=Array.isArray(c)&&c.length>0:r.type==="file"?v=Array.isArray(c)&&c.length>0||S.value[r.id]&&S.value[r.id].length>0:r.type==="convocatoria"?v=c!=null&&c!=="":r.type==="disclaimer"?v=c&&c.accepted===!0:r.type==="repeater"?v=Array.isArray(c)&&c.length>0:r.type==="datepicker"?v=c!=null&&c!=="":v=c&&c.toString().trim()!=="",v&&s++}),{llenos:s,total:d,porcentaje:d>0?Math.round(s/d*100):0}}),y=U(()=>o.is_editing?"Editar Candidatura":"Crear Candidatura"),E=U(()=>{var d,s;return a.processing?"Guardando...":o.is_editing?((d=o.candidatura)==null?void 0:d.estado)==="rechazado"?"Reenviar Candidatura":((s=o.candidatura)==null?void 0:s.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),N=U(()=>{var s;let d=[...T.value];return o.is_editing&&o.candidatura&&["pendiente","aprobado"].includes(o.candidatura.estado)&&(d=d.filter(c=>c.type!=="convocatoria")),o.is_editing&&((s=o.candidatura)==null?void 0:s.estado)==="aprobado"&&(d=d.filter(r=>r.editable===!0)),d}),P=U(()=>{var r;if(!o.is_editing||!o.candidatura)return!1;let d=!1;if(["pendiente","aprobado"].includes(o.candidatura.estado)&&(d=o.configuracion_campos.some(c=>c.type==="convocatoria")),((r=o.candidatura)==null?void 0:r.estado)==="aprobado"){const c=o.configuracion_campos.some(v=>!v.editable&&v.type!=="convocatoria");return d||c}return d}),q=async(d,s)=>{if(S.value[d]=s,s&&s.length>0)try{j.info("Subiendo archivos...",{duration:2e3});const c=(await V(s,{module:"candidaturas",fieldId:d})).map(v=>v.path);Array.isArray(a.formulario_data[d]),a.formulario_data[d]=c,S.value[d]=[],j.success("Archivos subidos correctamente",{duration:2e3})}catch(r){console.error("Error al subir archivos:",r),j.error("Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else a.formulario_data[d]=[]},Q=async()=>{for(const[s,r]of Object.entries(S.value))if(r&&r.length>0)try{j.info("Subiendo archivos pendientes...",{duration:2e3});const c=await V(r,{module:"candidaturas",fieldId:s});a.formulario_data[s]=c.map(v=>v.path),S.value[s]=[]}catch(c){console.error("Error al subir archivos:",c),j.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const d={...a.formulario_data};o.configuracion_campos.forEach(s=>{const r=d[s.id];s.required||(r===""||r===void 0||Array.isArray(r)&&r.length===0&&s.type!=="checkbox"&&s.type!=="file")&&(d[s.id]=null)}),a.formulario_data=d,f(),o.is_editing?a.put(`/candidaturas/${o.candidatura.id}`,{onSuccess:()=>{X(),j.success("Candidatura actualizada exitosamente")},onError:s=>{console.error("Errores de validación:",s),(!o.candidatura||["borrador","rechazado"].includes(o.candidatura.estado))&&(G=b())}}):a.post("/candidaturas",{onSuccess:()=>{X(),j.success("Candidatura creada exitosamente")},onError:s=>{console.error("Errores de validación:",s),G=b()}})},z=d=>!!a.errors[`formulario_data.${d}`],tt=U(()=>!o.candidatura||["borrador","rechazado"].includes(o.candidatura.estado)),at=()=>{const d=document.querySelector('[data-sidebar="trigger"]');d&&d.click()};return(d,s)=>(u(),p(Y,null,[n(e(ot),{title:y.value},null,8,["title"]),n(xt,{breadcrumbs:$},{default:m(()=>{var r,c;return[l("div",Ba,[l("div",Da,[l("div",null,[l("h1",La,_(y.value),1),l("p",Pa,_(d.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),n(e(se),{variant:"outline",onClick:s[0]||(s[0]=v=>e(nt).visit("/candidaturas"))},{default:m(()=>[n(e(Ut),{class:"mr-2 h-4 w-4"}),s[1]||(s[1]=C(" Volver "))]),_:1})]),!d.candidatura||["borrador","rechazado"].includes(d.candidatura.estado)?(u(),p("div",Ra,[e(F)?(u(),p("div",Ma,[n(e(me),{class:"h-4 w-4 animate-spin"}),s[2]||(s[2]=l("span",null,"Guardando automáticamente...",-1))])):e(R)&&!e(L)?(u(),p("div",za,[n(e(Ye),{class:"h-4 w-4 text-green-600"}),l("span",null,"Guardado automáticamente a las "+_((r=e(D).lastSaved)==null?void 0:r.toLocaleTimeString()),1)])):e(L)?(u(),p("div",Wa,[n(e(te),{class:"h-4 w-4"}),s[3]||(s[3]=l("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),p("div",Ga,[n(e(me),{class:"h-4 w-4"}),s[4]||(s[4]=l("span",null,"Autoguardado activado",-1))]))])):O("",!0),d.is_editing&&((c=d.candidatura)!=null&&c.comentarios_admin)?(u(),B(e(ne),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:m(()=>[n(e(de),null,{default:m(()=>[n(e(Pe),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:m(()=>[n(e(te),{class:"h-5 w-5"}),s[5]||(s[5]=C(" Comentarios de la comisión "))]),_:1})]),_:1}),n(e(le),null,{default:m(()=>[l("p",Ya,_(d.candidatura.comentarios_admin),1)]),_:1})]),_:1})):O("",!0),n(e(ne),null,{default:m(()=>[n(e(de),null,{default:m(()=>[n(e(Pe),{class:"flex items-center gap-2"},{default:m(()=>[n(e(Ft),{class:"h-5 w-5"}),s[6]||(s[6]=C(" Información de Candidatura "))]),_:1})]),_:1}),n(e(le),null,{default:m(()=>{var v;return[l("form",{onSubmit:dt(Q,["prevent"]),class:"space-y-6"},[d.is_editing&&((v=d.candidatura)==null?void 0:v.estado)==="aprobado"?(u(),p("div",Ja,[l("div",Ka,[n(e(te),{class:"h-5 w-5 text-blue-600 mt-0.5"}),l("div",Xa,[s[7]||(s[7]=l("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),s[8]||(s[8]=l("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),P.value?(u(),p("p",Ha," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):O("",!0)])])])):O("",!0),n(lt,{name:"fade-field",tag:"div",class:"space-y-6"},{default:m(()=>[(u(!0),p(Y,null,Z(N.value,t=>{var re,be,ye,he,xe,ke,Se,we,Ce,$e,Ee,Te,Ve,Ae,je,Oe,Ue,Fe,Ie,Ne,qe;return u(),p("div",{key:t.id,class:"space-y-2"},[n(e(ae),{for:t.id,class:"flex items-center gap-1"},{default:m(()=>[C(_(t.title)+" ",1),t.required?(u(),p("span",Qa,"*")):O("",!0)]),_:2},1032,["for"]),t.description?(u(),p("p",Za,_(t.description),1)):O("",!0),t.type==="text"||t.type==="email"?(u(),B(e(fe),{key:1,id:t.id,type:t.type,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,placeholder:t.placeholder||"",class:J({"border-destructive":z(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(u(),B(e(Ct),{key:2,id:t.id,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,placeholder:t.placeholder||"",rows:4,class:J({"border-destructive":z(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(u(),B(e(fe),{key:3,id:t.id,type:"number",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,placeholder:t.placeholder||"",class:J({"border-destructive":z(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(u(),B(e(fe),{key:4,id:t.id,type:"date",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,class:J({"border-destructive":z(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(u(),B(e(pt),{key:5,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g},{default:m(()=>[n(e(_t),{class:J({"border-destructive":z(t.id)})},{default:m(()=>[n(e(vt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),n(e(bt),null,{default:m(()=>[(u(!0),p(Y,null,Z(t.options,g=>(u(),B(e(yt),{key:g,value:g},{default:m(()=>[C(_(g),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(u(),p("div",er,[(u(!0),p(Y,null,Z(t.options,g=>(u(),p("div",{key:g,class:"flex items-center space-x-2"},[ut(l("input",{id:`${t.id}_${g}`,name:t.id,type:"radio",value:g,"onUpdate:modelValue":ce=>e(a).formulario_data[t.id]=ce,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,tr),[[ct,e(a).formulario_data[t.id]]]),n(e(ae),{for:`${t.id}_${g}`,class:"text-sm font-normal"},{default:m(()=>[C(_(g),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(u(),p("div",ar,[(u(!0),p(Y,null,Z(t.options,g=>(u(),p("div",{key:g,class:"flex items-center space-x-2"},[n(e(St),{id:`${t.id}_${g}`,checked:e(a).formulario_data[t.id].includes(g),"onUpdate:checked":ce=>{if(ce)e(a).formulario_data[t.id].includes(g)||e(a).formulario_data[t.id].push(g);else{const Be=e(a).formulario_data[t.id].indexOf(g);Be>-1&&e(a).formulario_data[t.id].splice(Be,1)}}},null,8,["id","checked","onUpdate:checked"]),n(e(ae),{for:`${t.id}_${g}`,class:"text-sm font-normal"},{default:m(()=>[C(_(g),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(u(),p("div",rr,[n(Tt,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,onFilesSelected:g=>q(t.id,g),label:"",description:"",required:t.required,multiple:((re=t.fileConfig)==null?void 0:re.multiple)||!1,"max-files":((be=t.fileConfig)==null?void 0:be.maxFiles)||5,"max-file-size":((ye=t.fileConfig)==null?void 0:ye.maxFileSize)||10,accept:((he=t.fileConfig)==null?void 0:he.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(a).errors[`formulario_data.${t.id}`],disabled:e(a).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(u(),p("div",sr,[n(ua,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,required:t.required,disabled:e(a).processing||d.is_editing&&((xe=d.candidatura)==null?void 0:xe.estado)!=="borrador","filtrar-por-ubicacion":((ke=t.convocatoriaConfig)==null?void 0:ke.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),z(t.id)?(u(),p("div",ir,_(e(a).errors[`formulario_data.${t.id}`]),1)):O("",!0)])):t.type==="datepicker"?(u(),p("div",or,[n(Vt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-date":(Se=t.datepickerConfig)==null?void 0:Se.minDate,"max-date":(we=t.datepickerConfig)==null?void 0:we.maxDate,format:((Ce=t.datepickerConfig)==null?void 0:Ce.format)||"DD/MM/YYYY","allow-past-dates":(($e=t.datepickerConfig)==null?void 0:$e.allowPastDates)??!0,"allow-future-dates":((Ee=t.datepickerConfig)==null?void 0:Ee.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(u(),p("div",nr,[n(At,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"disclaimer-text":((Te=t.disclaimerConfig)==null?void 0:Te.disclaimerText)||"","modal-title":((Ve=t.disclaimerConfig)==null?void 0:Ve.modalTitle)||"Términos y Condiciones","accept-button-text":((Ae=t.disclaimerConfig)==null?void 0:Ae.acceptButtonText)||"Acepto","decline-button-text":((je=t.disclaimerConfig)==null?void 0:je.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(u(),p("div",dr,[n(jt,{"model-value":e(a).formulario_data[t.id]||[],"onUpdate:modelValue":g=>e(a).formulario_data[t.id]=g,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-items":((Oe=t.repeaterConfig)==null?void 0:Oe.minItems)||0,"max-items":((Ue=t.repeaterConfig)==null?void 0:Ue.maxItems)||10,"item-name":((Fe=t.repeaterConfig)==null?void 0:Fe.itemName)||"Elemento","add-button-text":((Ie=t.repeaterConfig)==null?void 0:Ie.addButtonText)||"Agregar elemento","remove-button-text":((Ne=t.repeaterConfig)==null?void 0:Ne.removeButtonText)||"Eliminar",fields:((qe=t.repeaterConfig)==null?void 0:qe.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):O("",!0),z(t.id)?(u(),p("p",lr,_(e(a).errors[`formulario_data.${t.id}`]),1)):O("",!0)])}),128))]),_:1}),e(a).errors.general?(u(),p("div",ur,[l("p",cr,_(e(a).errors.general),1)])):O("",!0),s[9]||(s[9]=l("div",{class:"h-4"},null,-1))],32)]}),_:1})]),_:1})]),(u(),B(ft,{to:"body"},[n(mt,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-4 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-4 opacity-0"},{default:m(()=>[(u(),p("div",fr,[l("div",mr,[l("div",gr,[l("div",pr,[l("div",_r,[n(e(se),{variant:"outline",type:"button",onClick:at,class:"backdrop-blur-sm flex-shrink-0 text-xs sm:text-sm py-2 px-3"},{default:m(()=>[n(e(ht),{class:"h-4 w-4"}),s[10]||(s[10]=l("span",{class:"ml-2"},"Ocultar sidebar",-1))]),_:1})]),l("div",vr,[l("div",br,[n(e(wt),{modelValue:I.value.porcentaje,class:"flex-1"},null,8,["modelValue"]),l("span",yr,_(I.value.llenos)+" / "+_(I.value.total),1)]),s[11]||(s[11]=l("p",{class:"text-xs text-muted-foreground mt-1 text-center hidden sm:block"}," Campos completados ",-1))]),l("div",hr,[tt.value?(u(),B(e(se),{key:0,onClick:K,disabled:e(F),variant:"outline",class:"backdrop-blur-sm flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:m(()=>[e(F)?(u(),p(Y,{key:0},[n(e(me),{class:"mr-2 h-4 w-4 animate-spin"}),s[12]||(s[12]=C(" Guardando... "))],64)):(u(),p(Y,{key:1},[n(e(It),{class:"mr-2 h-4 w-4"}),s[13]||(s[13]=C(" Guardar borrador "))],64))]),_:1},8,["disabled"])):O("",!0),n(e(se),{onClick:Q,disabled:!w.value||e(a).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400 flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:m(()=>[n(e(Ye),{class:"h-4 w-4"}),l("span",xr,_(E.value),1)]),_:1},8,["disabled"])])])])])]))]),_:1})]))]}),_:1})],64))}}),Xr=kt(kr,[["__scopeId","data-v-f1dcb621"]]);export{Xr as default};
