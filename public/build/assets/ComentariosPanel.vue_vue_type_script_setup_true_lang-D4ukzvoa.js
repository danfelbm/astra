import{r as R,c as A,d as Z,i as x,e as a,g as _,f as e,t as M,m as s,p as xe,b as E,w as u,j as $,n as ie,h as I,F as H,k as K,x as Me,I as Se,o as Pe}from"./app-BfPvEkA-.js";import{_ as be,c as ke,a as je,b as ze}from"./CardTitle.vue_vue_type_script_setup_true_lang-BSnzyO3E.js";import{_ as Te}from"./CardDescription.vue_vue_type_script_setup_true_lang-S1t_LPFF.js";import{c as ae,_ as P}from"./createLucideIcon-GRWsbGen.js";import{_ as fe}from"./Skeleton.vue_vue_type_script_setup_true_lang-DAItyfnL.js";import{C as ye,_ as qe,a as Le,b as Ie,c as Ue,d as Ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-B_ZtV9MM.js";import{R as Ve}from"./RichTextEditor-GaiYFO3_.js";import{_ as De}from"./FileUploadField.vue_vue_type_script_setup_true_lang-e2lCDiuI.js";import{X as we}from"./x-Dw4t4IDb.js";import{P as Xe}from"./paperclip-CHN2eyUX.js";import{L as Be}from"./loader-circle-C_tvD8Ml.js";import{S as Fe}from"./send-BFfzLRJ5.js";import{b as Ne,_ as Oe}from"./index-BF541tzt.js";import{_ as Ce}from"./index-CxtQmOvh.js";import{b as He,c as Qe,g as _e,d as We}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CP_MrTjg.js";import{_ as Ke,a as Ge,b as Je}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-PZKBniHF.js";import{e as Ze,_ as Ye,a as ea,b as aa}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Wgj1Iu2M.js";import{E as ta}from"./external-link-DQIY_jE4.js";import{D as ve}from"./download-6X8x3Dia.js";import{I as sa}from"./image-kk1OcnwQ.js";import{F as na}from"./file-text-DCJ8hQH1.js";import{C as oa}from"./clock-DPnnatu6.js";import{M as ge}from"./message-square-BckQ1ppN.js";import{E as ra}from"./ellipsis-CT6d6gCG.js";import{S as la}from"./square-pen-Bqnbj1Se.js";import{T as ia}from"./trash-2-BEnHvTNO.js";import{C as $e}from"./chevron-right-D9aoj9_l.js";import{t as N}from"./index-C1jn35iD.js";import{C as ca}from"./chevron-left-Blooa28p.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=ae("ArrowUpDownIcon",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=ae("ChevronsLeftIcon",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=ae("ChevronsRightIcon",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=ae("FileSpreadsheetIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=ae("QuoteIcon",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=ae("SmilePlusIcon",[["path",{d:"M22 11v1a10 10 0 1 1-9-10",key:"ew0xw9"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}],["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}]]);function va(t,V,g={}){const{paginaInicial:f=1,urlParam:S="pagina",sincronizarUrl:w=!0}=g,h=R([]),y=R(!1),k=R(null),o=R(f),b=R(1),l=R(0),D=R(0),U=R(0),j=R([]),C=R("recientes"),X={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},B=`/api/comentarios/${t}/${V}`,te=d=>{if(!w)return;const v=new URL(window.location.href);d>1?v.searchParams.set(S,String(d)):v.searchParams.delete(S),window.history.replaceState({},"",v.toString())},W=async(d,v=!0)=>{const i=d??o.value;y.value=!0,k.value=null;try{const c=new URLSearchParams({page:String(i),sort:C.value}),n=await(await fetch(`${B}?${c}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();if(n.success&&n.data)h.value=n.data.data,o.value=n.data.current_page,b.value=n.data.last_page,l.value=n.data.total,D.value=n.data.from||0,U.value=n.data.to||0,j.value=n.data.links||[],v&&te(i);else throw new Error(n.message||"Error al cargar comentarios")}catch(c){k.value=c instanceof Error?c.message:"Error desconocido",console.error("Error cargando comentarios:",c)}finally{y.value=!1}},Y=async d=>{d!==C.value&&(C.value=d,await W(1))},ee=async d=>{d>=1&&d<=b.value&&d!==o.value&&await W(d)},se=async()=>{o.value<b.value&&await W(o.value+1)},ne=async()=>{o.value>1&&await W(o.value-1)},oe=async d=>{y.value=!0,k.value=null;try{const i=await(await fetch(B,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":q()},credentials:"same-origin",body:JSON.stringify(d)})).json();return i.success&&i.comentario&&(d.parent_id?F(d.parent_id,i.comentario):(h.value=[i.comentario,...h.value],l.value++)),i}catch(v){const i=v instanceof Error?v.message:"Error al crear comentario";return k.value=i,{success:!1,message:i}}finally{y.value=!1}},re=async(d,v)=>{y.value=!0,k.value=null;try{const c=await(await fetch(`/api/comentarios/${d}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":q()},credentials:"same-origin",body:JSON.stringify(v)})).json();return c.success&&c.comentario&&Q(c.comentario),c}catch(i){const c=i instanceof Error?i.message:"Error al actualizar comentario";return k.value=c,{success:!1,message:c}}finally{y.value=!1}},le=async d=>{y.value=!0,k.value=null;try{const i=await(await fetch(`/api/comentarios/${d}`,{method:"DELETE",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":q()},credentials:"same-origin"})).json();return i.success&&(G(d),l.value--),i}catch(v){const i=v instanceof Error?v.message:"Error al eliminar comentario";return k.value=i,{success:!1,message:i}}finally{y.value=!1}},T=async(d,v)=>{try{const c=await(await fetch(`/api/comentarios/${d}/reaccion`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":q()},credentials:"same-origin",body:JSON.stringify({emoji:v})})).json();return c.success&&c.reacciones&&ce(d,c.reacciones),c}catch(i){return{success:!1,message:i instanceof Error?i.message:"Error al agregar reacciÃ³n"}}},m=async(d,v=0,i=10)=>{try{const c=new URLSearchParams({offset:String(v),limit:String(i)}),n=await(await fetch(`/api/comentarios/${d}/respuestas?${c}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json();return n.success&&n.data&&L(d,n.data),n}catch(c){return{success:!1,message:c instanceof Error?c.message:"Error al cargar respuestas"}}},q=()=>{var v;return((v=document.querySelector('meta[name="csrf-token"]'))==null?void 0:v.getAttribute("content"))||""},z=d=>d.respuestas||d.respuestas_limitadas||[],F=(d,v)=>{const i=c=>{for(const r of c){if(r.id===d){!r.respuestas&&!r.respuestas_limitadas&&(r.respuestas=[]);const p=r.respuestas||r.respuestas_limitadas;return p==null||p.push(v),!0}const n=z(r);if(n.length>0&&i(n))return!0}return!1};i(h.value)},L=(d,v)=>{const i=c=>{for(const r of c){if(r.id===d){!r.respuestas&&!r.respuestas_limitadas&&(r.respuestas=[]);const p=r.respuestas||r.respuestas_limitadas;return p&&p.push(...v),r.total_respuestas_anidadas!==void 0&&(r.total_respuestas_anidadas=Math.max(0,r.total_respuestas_anidadas-v.length)),!0}const n=z(r);if(n.length>0&&i(n))return!0}return!1};i(h.value)},Q=d=>{const v=i=>{for(let c=0;c<i.length;c++){if(i[c].id===d.id)return i[c]={...d,respuestas:i[c].respuestas,respuestas_limitadas:i[c].respuestas_limitadas},!0;const r=z(i[c]);if(r.length>0&&v(r))return!0}return!1};v(h.value)},G=d=>{const v=i=>i.filter(c=>c.id!==d).map(c=>(z(c),{...c,respuestas:c.respuestas?v(c.respuestas):void 0,respuestas_limitadas:c.respuestas_limitadas?v(c.respuestas_limitadas):void 0}));h.value=v(h.value)},ce=(d,v)=>{const i=c=>{for(const r of c){if(r.id===d)return r.reacciones_resumen=v,!0;const n=z(r);if(n.length>0&&i(n))return!0}return!1};i(h.value)},ue=A(()=>h.value.length>0),de=A(()=>b.value>1),me=A(()=>o.value>1),pe=A(()=>o.value<b.value);return{comentarios:h,loading:y,error:k,currentPage:o,lastPage:b,total:l,from:D,to:U,links:j,emojis:X,sortBy:C,tieneComentarios:ue,tienePaginacion:de,puedePaginaAnterior:me,puedePaginaSiguiente:pe,cargar:W,irAPagina:ee,paginaSiguiente:se,paginaAnterior:ne,crear:oe,editar:re,eliminar:le,toggleReaccion:T,cambiarOrden:Y,cargarRespuestasAdicionales:m}}const ga={class:"flex items-start gap-2 p-3 bg-muted/50 rounded-md border-l-4 border-primary/30 text-sm"},ha={class:"flex-1 min-w-0"},ya={class:"flex items-center gap-2 mb-1"},_a={class:"font-medium text-xs"},xa={class:"text-xs text-muted-foreground"},ba=["innerHTML"],Ee=Z({__name:"ComentarioQuote",props:{comentario:{}},setup(t){return(V,g)=>{var f;return s(),x("div",ga,[a(e(Re),{class:"h-4 w-4 text-muted-foreground flex-shrink-0 mt-0.5"}),_("div",ha,[_("div",ya,[_("span",_a,M(((f=t.comentario.autor)==null?void 0:f.name)||"Usuario"),1),_("span",xa,M(t.comentario.fecha_relativa),1)]),_("p",{class:"text-muted-foreground line-clamp-2",innerHTML:t.comentario.contenido_truncado||t.comentario.contenido_plain},null,8,ba)])])}}}),ka={key:1,class:"flex items-center gap-2 text-sm text-muted-foreground"},wa={class:"font-medium"},Ca={key:2,class:"mt-2"},$a={class:"flex items-center justify-between gap-2"},Ra={key:0,class:"ml-1 text-xs"},Ea={class:"flex items-center gap-2"},he=Z({__name:"ComentarioForm",props:{mode:{default:"create"},comentarioEditar:{default:null},comentarioCitar:{default:null},comentarioResponder:{default:null},loading:{type:Boolean,default:!1},placeholder:{default:"Escribe un comentario..."}},emits:["submit","cancel"],setup(t,{expose:V,emit:g}){const f=t,S=g,w=R(""),h=R([]),y=R(!1);xe(()=>f.comentarioEditar,j=>{j&&(w.value=j.contenido,j.archivos_info&&j.archivos_info.length>0&&(h.value=j.archivos_info.map((C,X)=>({id:`existing_${X}`,name:C.nombre,size:0,path:C.path,url:C.url,mime_type:C.tipo,uploaded_at:""})),y.value=!0))},{immediate:!0});const k=A(()=>{switch(f.mode){case"edit":return"Guardar cambios";case"reply":return"Responder";case"quote":return"Comentar";default:return"Comentar"}}),o=A(()=>{var j,C;switch(f.mode){case"reply":return`Responder a ${((C=(j=f.comentarioResponder)==null?void 0:j.autor)==null?void 0:C.name)||"usuario"}...`;case"quote":return"Escribe tu comentario sobre la cita...";default:return f.placeholder}}),b=A(()=>w.value.replace(/<[^>]*>/g,"").trim().length>0),l=()=>{var X,B;if(!b.value||f.loading)return;const j=f.mode==="reply"&&((X=f.comentarioResponder)==null?void 0:X.id)||null,C=f.mode==="quote"&&((B=f.comentarioCitar)==null?void 0:B.id)||null;S("submit",w.value,j,C,h.value),f.mode!=="edit"&&(w.value="",h.value=[],y.value=!1)},D=()=>{w.value="",h.value=[],y.value=!1,S("cancel")},U=()=>{y.value=!y.value};return V({clear:()=>{w.value="",h.value=[],y.value=!1}}),(j,C)=>(s(),E(e(be),{class:"border-0 shadow-none"},{default:u(()=>[a(e(ke),{class:"p-0 space-y-3"},{default:u(()=>{var X;return[t.mode==="quote"&&t.comentarioCitar?(s(),E(Ee,{key:0,comentario:t.comentarioCitar},null,8,["comentario"])):$("",!0),t.mode==="reply"&&t.comentarioResponder?(s(),x("div",ka,[C[2]||(C[2]=_("span",null,"Respondiendo a",-1)),_("span",wa,M((X=t.comentarioResponder.autor)==null?void 0:X.name),1),a(e(P),{variant:"ghost",size:"sm",class:"h-5 w-5 p-0 ml-auto",onClick:D},{default:u(()=>[a(e(we),{class:"h-3 w-3"})]),_:1})])):$("",!0),a(Ve,{modelValue:w.value,"onUpdate:modelValue":C[0]||(C[0]=B=>w.value=B),placeholder:o.value,rows:3},null,8,["modelValue","placeholder"]),y.value?(s(),x("div",Ca,[a(De,{modelValue:h.value,"onUpdate:modelValue":C[1]||(C[1]=B=>h.value=B),label:"Archivos adjuntos",description:"MÃ¡ximo 3 archivos de 10MB cada uno",module:"comentarios","field-id":"archivos",multiple:!0,"max-files":3,"max-file-size":10,accept:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.xls,.xlsx","auto-upload":!0},null,8,["modelValue"])])):$("",!0),_("div",$a,[a(e(P),{variant:"ghost",size:"sm",type:"button",onClick:U,class:ie({"text-primary":y.value||h.value.length>0}),title:"Adjuntar archivos"},{default:u(()=>[a(e(Xe),{class:"h-4 w-4"}),h.value.length>0?(s(),x("span",Ra," ("+M(h.value.length)+") ",1)):$("",!0)]),_:1},8,["class"]),_("div",Ea,[t.mode!=="create"?(s(),E(e(P),{key:0,variant:"ghost",size:"sm",onClick:D,disabled:t.loading},{default:u(()=>[...C[3]||(C[3]=[I(" Cancelar ",-1)])]),_:1},8,["disabled"])):$("",!0),a(e(P),{size:"sm",onClick:l,disabled:!b.value||t.loading},{default:u(()=>[t.loading?(s(),E(e(Be),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):(s(),E(e(Fe),{key:1,class:"h-4 w-4 mr-2"})),I(" "+M(k.value),1)]),_:1},8,["disabled"])])])]}),_:1})]),_:1}))}}),Ma={class:"flex items-center gap-1.5 flex-wrap"},Sa={class:"text-muted-foreground"},Pa={class:"flex gap-1"},ja=Z({__name:"ComentarioReacciones",props:{reacciones:{default:()=>[]},canReact:{type:Boolean,default:!0}},emits:["toggle"],setup(t,{emit:V}){const g=t,f=V,S={thumbs_up:"ðŸ‘",thumbs_down:"ðŸ‘Ž",heart:"â¤ï¸",laugh:"ðŸ˜„",clap:"ðŸ‘",fire:"ðŸ”¥",check:"âœ…",eyes:"ðŸ‘€"},w=R(!1),h=A(()=>[...g.reacciones].sort((o,b)=>b.count-o.count)),y=o=>{const b=g.reacciones.find(l=>l.emoji===o);return(b==null?void 0:b.usuario_actual_reacciono)||!1},k=o=>{f("toggle",o),w.value=!1};return(o,b)=>(s(),x("div",Ma,[(s(!0),x(H,null,K(h.value,l=>(s(),E(e(P),{key:l.emoji,variant:"ghost",size:"sm",class:ie(["h-7 px-2 text-xs gap-1",{"bg-primary/10 hover:bg-primary/20":l.usuario_actual_reacciono}]),onClick:D=>k(l.emoji),disabled:!t.canReact},{default:u(()=>[_("span",null,M(l.simbolo),1),_("span",Sa,M(l.count),1)]),_:2},1032,["class","onClick","disabled"]))),128)),t.canReact?(s(),E(e(Ke),{key:0,open:w.value,"onUpdate:open":b[0]||(b[0]=l=>w.value=l)},{default:u(()=>[a(e(Ge),{asChild:""},{default:u(()=>[a(e(P),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:u(()=>[a(e(fa),{class:"h-4 w-4 text-muted-foreground"})]),_:1})]),_:1}),a(e(Je),{class:"w-auto p-2",align:"start"},{default:u(()=>[_("div",Pa,[(s(),x(H,null,K(S,(l,D)=>a(e(P),{key:D,variant:"ghost",size:"sm",class:ie(["h-8 w-8 p-0 text-lg hover:scale-125 transition-transform",{"bg-primary/10":y(D)}]),onClick:U=>k(D)},{default:u(()=>[I(M(l),1)]),_:2},1032,["class","onClick"])),64))])]),_:1})]),_:1},8,["open"])):$("",!0)]))}}),za={class:"flex items-center justify-between"},Ta={class:"flex items-center gap-1"},qa={class:"flex items-center justify-center p-4 bg-muted/30 min-h-[300px] max-h-[calc(90vh-80px)] overflow-auto"},La=["src","alt"],Ia=Z({__name:"ImagePreviewModal",props:{open:{type:Boolean},archivo:{}},emits:["update:open"],setup(t,{emit:V}){const g=t,f=V,S=A({get:()=>g.open,set:k=>f("update:open",k)}),w=()=>{S.value=!1},h=()=>{var k;(k=g.archivo)!=null&&k.url&&window.open(g.archivo.url,"_blank")},y=()=>{var k;if((k=g.archivo)!=null&&k.url){const o=document.createElement("a");o.href=g.archivo.url,o.download=g.archivo.nombre,document.body.appendChild(o),o.click(),document.body.removeChild(o)}};return(k,o)=>(s(),E(e(Ze),{open:S.value,"onUpdate:open":o[1]||(o[1]=b=>S.value=b)},{default:u(()=>[a(e(Ye),{class:"max-w-4xl max-h-[90vh] p-0 overflow-hidden"},{default:u(()=>{var b;return[a(e(ea),{class:"p-4 pb-0"},{default:u(()=>[_("div",za,[a(e(aa),{class:"text-sm font-medium truncate pr-4"},{default:u(()=>{var l;return[I(M(((l=t.archivo)==null?void 0:l.nombre)||"Imagen"),1)]}),_:1}),_("div",Ta,[a(e(P),{variant:"ghost",size:"sm",onClick:h,title:"Abrir en nueva pestaÃ±a"},{default:u(()=>[a(e(ta),{class:"h-4 w-4"})]),_:1}),a(e(P),{variant:"ghost",size:"sm",onClick:y,title:"Descargar"},{default:u(()=>[a(e(ve),{class:"h-4 w-4"})]),_:1}),a(e(P),{variant:"ghost",size:"sm",onClick:w,title:"Cerrar"},{default:u(()=>[a(e(we),{class:"h-4 w-4"})]),_:1})])])]),_:1}),_("div",qa,[(b=t.archivo)!=null&&b.url?(s(),x("img",{key:0,src:t.archivo.url,alt:t.archivo.nombre,class:"max-w-full max-h-full object-contain rounded",onError:o[0]||(o[0]=l=>l.target.src="/images/placeholder.png")},null,40,La)):$("",!0)])]}),_:1})]),_:1},8,["open"]))}}),Ua={key:0,class:"mt-2"},Aa={class:"flex flex-wrap gap-2"},Va=["onClick"],Da={key:0,class:"relative w-20 h-20 rounded-md overflow-hidden border bg-muted/30 hover:ring-2 hover:ring-primary transition-all"},Xa=["src","alt"],Ba={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},Fa={key:1,class:"flex items-center gap-2 px-3 py-2 rounded-md border bg-muted/30 hover:bg-muted/50 transition-colors max-w-[200px]"},Na={class:"flex-1 min-w-0"},Oa={class:"text-xs font-medium truncate"},Ha=Z({__name:"ComentarioAdjuntos",props:{archivos:{}},setup(t){const V=R(!1),g=R(null),f=o=>{g.value=o,V.value=!0},S=o=>{window.open(o.url,"_blank")},w=o=>{o.es_imagen?f(o):S(o)},h=o=>["jpg","jpeg","png","gif","webp"].includes(o)?sa:["xls","xlsx"].includes(o)?pa:na,y=o=>["jpg","jpeg","png","gif","webp"].includes(o)?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":["pdf"].includes(o)?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":["doc","docx"].includes(o)?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":["xls","xlsx"].includes(o)?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",k=(o,b)=>{b.stopPropagation();const l=document.createElement("a");l.href=o.url,l.download=o.nombre,document.body.appendChild(l),l.click(),document.body.removeChild(l)};return(o,b)=>t.archivos&&t.archivos.length>0?(s(),x("div",Ua,[_("div",Aa,[(s(!0),x(H,null,K(t.archivos,(l,D)=>(s(),x("div",{key:D,class:"group relative cursor-pointer",onClick:U=>w(l)},[l.es_imagen?(s(),x("div",Da,[_("img",{src:l.url,alt:l.nombre,class:"w-full h-full object-cover",onError:b[0]||(b[0]=U=>U.target.style.display="none")},null,40,Xa),_("div",Ba,[a(e(ve),{class:"h-5 w-5 text-white hover:scale-110 transition-transform",onClick:U=>k(l,U)},null,8,["onClick"])])])):(s(),x("div",Fa,[(s(),E(Me(h(l.extension)),{class:"h-5 w-5 flex-shrink-0 text-muted-foreground"})),_("div",Na,[_("p",Oa,M(l.nombre),1),a(e(Ce),{class:ie([y(l.extension),"text-[10px] px-1"])},{default:u(()=>[I(M(l.extension.toUpperCase()),1)]),_:2},1032,["class"])]),a(e(ve),{class:"h-4 w-4 text-muted-foreground hover:text-foreground transition-colors flex-shrink-0",onClick:U=>k(l,U)},null,8,["onClick"])]))],8,Va))),128))]),a(Ia,{open:V.value,"onUpdate:open":b[1]||(b[1]=l=>V.value=l),archivo:g.value},null,8,["open","archivo"])])):$("",!0)}}),Qa={class:"group/item flex gap-3"},Wa={class:"flex-1 min-w-0"},Ka={class:"flex items-center gap-2 flex-wrap"},Ga={class:"font-medium text-sm"},Ja={class:"text-xs text-muted-foreground"},Za={key:1,class:"text-xs text-muted-foreground flex items-center gap-1"},Ya={key:0,class:"mt-2"},et=["innerHTML"],at={class:"mt-2 flex items-center gap-2 flex-wrap"},tt={class:"flex items-center gap-1 opacity-0 group-hover/item:opacity-100 transition-opacity"},st={key:2,class:"mt-3"},nt={key:0,class:"mt-3 space-y-3"},ot={key:1,class:"mt-2 ml-6 pl-4"},rt=Z({__name:"ComentarioItem",props:{comentario:{},nivel:{default:0},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0}},emits:["reply","quote","edit","delete","toggleReaccion","submitReply","cargarMasRespuestas"],setup(t,{emit:V}){const g=t,f=V,S=R(!1),w=R(!1),h=R(!1),y=R(!1),k=R(!1),o=A(()=>g.comentario.respuestas||g.comentario.respuestas_limitadas||[]),b=A(()=>{const T=m=>{const q=m.respuestas||m.respuestas_limitadas||[];let z=q.length;return q.forEach(F=>{z+=T(F)}),z};return T(g.comentario)}),l=A(()=>o.value.length>0),D=A(()=>(g.comentario.total_respuestas_anidadas||0)>0),U=A(()=>{var m;return(((m=g.comentario.autor)==null?void 0:m.name)||"U").substring(0,2).toUpperCase()}),j=A(()=>g.comentario.es_editable||!1),C=A(()=>{const T=g.comentario.tiempo_restante_edicion;if(!T||T<=0)return null;const m=Math.floor(T/60),q=T%60;return m>0?`${m}h ${q}m para editar`:`${q}m para editar`}),X=()=>{S.value=!S.value},B=()=>{w.value=!0},te=(T,m,q,z=[])=>{f("submitReply",T,g.comentario.id,z),w.value=!1},W=()=>{w.value=!1},Y=()=>{f("quote",g.comentario)},ee=()=>{h.value=!0},se=(T,m,q,z=[])=>{f("edit",g.comentario,T,z),h.value=!1},ne=()=>{h.value=!1},oe=()=>{y.value?(f("delete",g.comentario),y.value=!1):(y.value=!0,setTimeout(()=>{y.value=!1},3e3))},re=T=>{f("toggleReaccion",g.comentario.id,T)},le=()=>{k.value=!0,f("cargarMasRespuestas",g.comentario.id),setTimeout(()=>{k.value=!1},2e3)};return(T,m)=>{var z;const q=Se("ComentarioItem",!0);return s(),x("div",{class:ie({"ml-6 border-l-2 border-muted pl-4":t.nivel>0})},[_("div",Qa,[a(e(Oe),{class:"h-8 w-8 flex-shrink-0"},{default:u(()=>[a(e(Ne),{class:"text-xs"},{default:u(()=>[I(M(U.value),1)]),_:1})]),_:1}),_("div",Wa,[_("div",Ka,[_("span",Ga,M(((z=t.comentario.autor)==null?void 0:z.name)||"Usuario"),1),_("span",Ja,M(t.comentario.fecha_relativa),1),t.comentario.es_editado?(s(),E(e(Ce),{key:0,variant:"outline",class:"text-xs h-5"},{default:u(()=>[...m[8]||(m[8]=[I(" editado ",-1)])]),_:1})):$("",!0),C.value?(s(),x("span",Za,[a(e(oa),{class:"h-3 w-3"}),I(" "+M(C.value),1)])):$("",!0)]),h.value?(s(),x("div",Ya,[a(he,{mode:"edit","comentario-editar":t.comentario,onSubmit:m[0]||(m[0]=F=>se(F)),onCancel:ne},null,8,["comentario-editar"])])):(s(),x(H,{key:1},[t.comentario.comentario_citado?(s(),E(Ee,{key:0,comentario:t.comentario.comentario_citado,class:"mt-2"},null,8,["comentario"])):$("",!0),_("div",{class:"mt-1 text-sm prose prose-sm dark:prose-invert max-w-none",innerHTML:t.comentario.contenido},null,8,et),t.comentario.archivos_info&&t.comentario.archivos_info.length>0?(s(),E(Ha,{key:1,archivos:t.comentario.archivos_info},null,8,["archivos"])):$("",!0),_("div",at,[a(ja,{reacciones:t.comentario.reacciones_resumen||[],"can-react":t.canReact,onToggle:re},null,8,["reacciones","can-react"]),_("div",tt,[t.canCreate?(s(),E(e(P),{key:0,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:B},{default:u(()=>[a(e(ge),{class:"h-3 w-3 mr-1"}),m[9]||(m[9]=I(" Responder ",-1))]),_:1})):$("",!0),t.canCreate?(s(),E(e(P),{key:1,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:Y},{default:u(()=>[a(e(Re),{class:"h-3 w-3 mr-1"}),m[10]||(m[10]=I(" Citar ",-1))]),_:1})):$("",!0),j.value||t.comentario.es_eliminable?(s(),E(e(He),{key:2},{default:u(()=>[a(e(Qe),{asChild:""},{default:u(()=>[a(e(P),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0"},{default:u(()=>[a(e(ra),{class:"h-4 w-4"})]),_:1})]),_:1}),a(e(We),{align:"end"},{default:u(()=>[t.comentario.es_editable?(s(),E(e(_e),{key:0,onClick:ee},{default:u(()=>[a(e(la),{class:"h-4 w-4 mr-2"}),m[11]||(m[11]=I(" Editar ",-1))]),_:1})):$("",!0),t.comentario.es_eliminable?(s(),E(e(_e),{key:1,class:"text-destructive",onClick:oe},{default:u(()=>[a(e(ia),{class:"h-4 w-4 mr-2"}),I(" "+M(y.value?"Confirmar eliminaciÃ³n":"Eliminar"),1)]),_:1})):$("",!0)]),_:1})]),_:1})):$("",!0),l.value?(s(),E(e(P),{key:3,variant:"ghost",size:"sm",class:"h-7 text-xs",onClick:X},{default:u(()=>[S.value?(s(),E(e($e),{key:1,class:"h-3 w-3 mr-1"})):(s(),E(e(ye),{key:0,class:"h-3 w-3 mr-1"})),I(" "+M(S.value?`Mostrar ${b.value}`:"Ocultar"),1)]),_:1})):$("",!0)])])],64)),w.value?(s(),x("div",st,[a(he,{mode:"reply","comentario-responder":t.comentario,onSubmit:te,onCancel:W},null,8,["comentario-responder"])])):$("",!0)])]),l.value&&!S.value?(s(),x("div",nt,[(s(!0),x(H,null,K(o.value,F=>(s(),E(q,{key:F.id,comentario:F,nivel:t.nivel+1,"can-create":t.canCreate,"can-react":t.canReact,onReply:m[1]||(m[1]=L=>f("reply",L)),onQuote:m[2]||(m[2]=L=>f("quote",L)),onEdit:m[3]||(m[3]=(L,Q,G)=>f("edit",L,Q,G)),onDelete:m[4]||(m[4]=L=>f("delete",L)),onToggleReaccion:m[5]||(m[5]=(L,Q)=>f("toggleReaccion",L,Q)),onSubmitReply:m[6]||(m[6]=(L,Q,G)=>f("submitReply",L,Q,G)),onCargarMasRespuestas:m[7]||(m[7]=L=>f("cargarMasRespuestas",L))},null,8,["comentario","nivel","can-create","can-react"]))),128))])):$("",!0),D.value&&!S.value?(s(),x("div",ot,[a(e(P),{variant:"ghost",size:"sm",class:"h-7 text-xs text-muted-foreground",disabled:k.value,onClick:le},{default:u(()=>[a(e(ye),{class:"h-3 w-3 mr-1"}),I(" "+M(k.value?"Cargando...":`Cargar ${t.comentario.total_respuestas_anidadas} respuestas mÃ¡s`),1)]),_:1},8,["disabled"])])):$("",!0)],2)}}}),lt={class:"flex items-center justify-between"},it={key:0},ct={key:1,class:"space-y-4"},ut={class:"flex-1 space-y-2"},dt={key:2,class:"text-center py-8 text-destructive"},mt={key:3,class:"text-center py-8"},pt={key:0,class:"text-sm text-muted-foreground mt-1"},ft={key:4,class:"space-y-4"},vt={key:0,class:"flex flex-col items-center gap-3 pt-4 border-t"},gt={class:"text-sm text-muted-foreground"},ht={class:"flex items-center gap-1"},yt={key:0,class:"px-2 text-muted-foreground"},Wt=Z({__name:"ComentariosPanel",props:{commentableType:{},commentableId:{},canCreate:{type:Boolean,default:!0},canReact:{type:Boolean,default:!0}},setup(t){const V=[{value:"recientes",label:"MÃ¡s recientes"},{value:"antiguos",label:"MÃ¡s antiguos"},{value:"populares",label:"MÃ¡s populares"}],g=t,f=()=>{const n=new URLSearchParams(window.location.search).get("pagina");return n?parseInt(n,10):1},{comentarios:S,loading:w,error:h,total:y,lastPage:k,from:o,to:b,links:l,tienePaginacion:D,puedePaginaAnterior:U,puedePaginaSiguiente:j,sortBy:C,cargar:X,irAPagina:B,paginaSiguiente:te,paginaAnterior:W,crear:Y,editar:ee,eliminar:se,toggleReaccion:ne,cambiarOrden:oe,cargarRespuestasAdicionales:re}=va(g.commentableType,g.commentableId,{paginaInicial:f(),urlParam:"pagina",sincronizarUrl:!0}),le=A(()=>!l.value||l.value.length<=3?[]:l.value),T=r=>{if(!r.url||r.active)return;const n=new URL(r.url,window.location.origin),p=parseInt(n.searchParams.get("page")||"1",10);B(p)},m=R("create"),q=R(null),z=R(null),F=R(null),L=R(!1),Q=R(null);Pe(()=>{X()}),xe(()=>[g.commentableType,g.commentableId],()=>{X()});const G=async(r,n,p,O=[])=>{L.value=!0;try{if(m.value==="edit"&&F.value){const J=await ee(F.value.id,{contenido:r,archivos:O});J.success?(N.success(J.message),i()):N.error(J.message||"Error al actualizar")}else{const J=await Y({contenido:r,parent_id:n,quoted_comentario_id:p,archivos:O});J.success?(N.success(J.message),i()):N.error(J.message||"Error al publicar")}}finally{L.value=!1}},ce=r=>{m.value="reply",q.value=r,z.value=null,F.value=null},ue=r=>{m.value="quote",z.value=r,q.value=null,F.value=null},de=async(r,n,p=[])=>{const O=await ee(r.id,{contenido:n,archivos:p});O.success?N.success(O.message):N.error(O.message||"Error al actualizar")},me=async r=>{const n=await se(r.id);n.success?N.success(n.message):N.error(n.message||"Error al eliminar")},pe=async(r,n)=>{const p=await ne(r,n);p.success||N.error(p.message||"Error al agregar reacciÃ³n")},d=async(r,n,p=[])=>{const O=await Y({contenido:r,parent_id:n,quoted_comentario_id:null,archivos:p});O.success?N.success(O.message):N.error(O.message||"Error al enviar respuesta")},v=async r=>{const n=await re(r);n.success||N.error(n.message||"Error al cargar respuestas")},i=()=>{var r;m.value="create",q.value=null,z.value=null,F.value=null,(r=Q.value)==null||r.clear()},c=()=>{i()};return(r,n)=>(s(),E(e(be),null,{default:u(()=>[a(e(je),null,{default:u(()=>[_("div",lt,[_("div",null,[a(e(ze),{class:"flex items-center gap-2"},{default:u(()=>[a(e(ge),{class:"h-5 w-5"}),n[3]||(n[3]=I(" Comentarios ",-1))]),_:1}),e(y)>0?(s(),E(e(Te),{key:0},{default:u(()=>[I(M(e(y))+" "+M(e(y)===1?"comentario":"comentarios"),1)]),_:1})):$("",!0)]),e(y)>1?(s(),E(e(qe),{key:0,"model-value":e(C),"onUpdate:modelValue":e(oe)},{default:u(()=>[a(e(Le),{class:"w-[160px] h-8 text-xs"},{default:u(()=>[a(e(ua),{class:"h-3 w-3 mr-1"}),a(e(Ie))]),_:1}),a(e(Ue),null,{default:u(()=>[(s(),x(H,null,K(V,p=>a(e(Ae),{key:p.value,value:p.value},{default:u(()=>[I(M(p.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):$("",!0)])]),_:1}),a(e(ke),{class:"space-y-6"},{default:u(()=>[t.canCreate?(s(),x("div",it,[a(he,{ref_key:"formRef",ref:Q,mode:m.value,"comentario-editar":F.value,"comentario-citar":z.value,"comentario-responder":q.value,loading:L.value,onSubmit:G,onCancel:c},null,8,["mode","comentario-editar","comentario-citar","comentario-responder","loading"])])):$("",!0),e(w)&&e(S).length===0?(s(),x("div",ct,[(s(),x(H,null,K(3,p=>_("div",{key:p,class:"flex gap-3"},[a(e(fe),{class:"h-8 w-8 rounded-full"}),_("div",ut,[a(e(fe),{class:"h-4 w-32"}),a(e(fe),{class:"h-16 w-full"})])])),64))])):e(h)?(s(),x("div",dt,[_("p",null,M(e(h)),1),a(e(P),{variant:"outline",size:"sm",class:"mt-2",onClick:n[0]||(n[0]=p=>e(X)())},{default:u(()=>[...n[4]||(n[4]=[I(" Reintentar ",-1)])]),_:1})])):e(S).length===0?(s(),x("div",mt,[a(e(ge),{class:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),n[5]||(n[5]=_("p",{class:"text-muted-foreground"},"No hay comentarios todavÃ­a",-1)),t.canCreate?(s(),x("p",pt," SÃ© el primero en comentar ")):$("",!0)])):(s(),x("div",ft,[(s(!0),x(H,null,K(e(S),p=>(s(),E(rt,{key:p.id,comentario:p,"can-create":t.canCreate,"can-react":t.canReact,onReply:ce,onQuote:ue,onEdit:de,onDelete:me,onToggleReaccion:pe,onSubmitReply:d,onCargarMasRespuestas:v},null,8,["comentario","can-create","can-react"]))),128)),e(D)?(s(),x("div",vt,[_("div",gt," Mostrando "+M(e(o))+" a "+M(e(b))+" de "+M(e(y))+" comentarios ",1),_("div",ht,[a(e(P),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(U)||e(w),onClick:n[1]||(n[1]=p=>e(B)(1)),title:"Primera pÃ¡gina"},{default:u(()=>[a(e(da),{class:"h-4 w-4"})]),_:1},8,["disabled"]),a(e(P),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(U)||e(w),onClick:e(W),title:"PÃ¡gina anterior"},{default:u(()=>[a(e(ca),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),(s(!0),x(H,null,K(le.value,p=>(s(),x(H,{key:p.label},[!p.label.includes("Previous")&&!p.label.includes("Next")&&!p.label.includes("previous")&&!p.label.includes("next")?(s(),x(H,{key:0},[p.label==="..."?(s(),x("span",yt," ... ")):(s(),E(e(P),{key:1,variant:p.active?"default":"outline",size:"sm",class:"h-8 min-w-[32px] px-2",disabled:e(w)||p.active,onClick:O=>T(p)},{default:u(()=>[I(M(p.label),1)]),_:2},1032,["variant","disabled","onClick"]))],64)):$("",!0)],64))),128)),a(e(P),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(j)||e(w),onClick:e(te),title:"PÃ¡gina siguiente"},{default:u(()=>[a(e($e),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"]),a(e(P),{variant:"outline",size:"sm",class:"h-8 w-8 p-0",disabled:!e(j)||e(w),onClick:n[2]||(n[2]=p=>e(B)(e(k))),title:"Ãšltima pÃ¡gina"},{default:u(()=>[a(e(ma),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])):$("",!0)]))]),_:1})]),_:1}))}});export{Wt as _};
