import{_ as D}from"./index-Bv2D6OQs.js";import{_ as g}from"./createLucideIcon-DpqMcHcs.js";import{_ as J,c as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-CXc292e6.js";import{_ as Q}from"./Switch.vue_vue_type_script_setup_true_lang-BIn1iS3a.js";import{_ as R,a as K,b as x,c as v,d as X,e as c}from"./TableHeader.vue_vue_type_script_setup_true_lang-D40BEwBz.js";import{_ as k,a as y,b as $,c as C,d as w,e as z,f as S,g as E}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BT87YhiW.js";import{_ as F}from"./AlertDialogTrigger.vue_vue_type_script_setup_true_lang-zKeAec8z.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BeDoGI8L.js";import{d as Z,c as tt,i as f,e as n,f as e,u as t,p as et,w as a,g as r,b as p,j as m,P as L,h as i,F as V,k as N,t as d,n as at,W as h}from"./app-CR-2XB3C.js";import{_ as st}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-C6RoN2Lr.js";import{P as ot}from"./plus-DafQFHWU.js";import{U as it}from"./users-2q8ym3rK.js";import{F as lt}from"./file-text-bOjPW4fi.js";import{C as nt}from"./chart-column-Bvg1Yr32.js";import{S as rt}from"./square-pen-DE73kWOA.js";import{T as dt}from"./trash-2-Ba23kG3g.js";import"./index-B_J_AOJU.js";import"./VisuallyHidden-BWbUvSRY.js";import"./Input.vue_vue_type_script_setup_true_lang-87jkhHIN.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-e9C0UTAB.js";import"./check-COi2Akip.js";import"./floating-ui.vue-BhiDC_BV.js";import"./nullish-CHIgUVhi.js";import"./VisuallyHiddenInput-y0SKat9x.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Dfpf6sX3.js";import"./x-BtC0hBQf.js";import"./DialogTrigger-C04ibuWy.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Ert7fISp.js";import"./index-BZs2h2K_.js";import"./index-E07s-QL0.js";import"./shield-4oMICjJq.js";import"./user-DHtFWwAY.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang--Zg1QsWs.js";import"./Label.vue_vue_type_script_setup_true_lang-CTFOyKy8.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-y6H-OSrV.js";import"./index-DEPFt58J.js";import"./circle-alert-Ce-R__0b.js";import"./map-pin-CH_1kWrL.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-D_zYDN4Z.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-D4bt_NVp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-DnobICLq.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DspZ-Okb.js";import"./target-PRmdjiaM.js";import"./vote-BGunVfqa.js";import"./folder-open-B73Z5LJI.js";import"./send-DrZ9C7tM.js";import"./briefcase-VNV3HxYQ.js";import"./calendar-K2tiWc-j.js";import"./megaphone-B1ul-h89.js";import"./user-check-DqzH6i1N.js";import"./mail-mHQkAKOp.js";import"./message-square-CKxkeyaY.js";import"./external-link-BksJeFVg.js";import"./panel-left-C66hQ-oC.js";import"./index-CuEHpEfT.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-CghfIXbW.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BfwY53vC.js";import"./chevron-left-Cync7Ff1.js";import"./es-nEe0wmoQ.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-c-e-5YRY.js";import"./loader-circle-Dz5wQVS9.js";import"./search-BvkZDDxZ.js";import"./filter-ZoD1lLMh.js";import"./history-x5vLRDe0.js";import"./save-fZDcFWE3.js";const ut={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},mt={class:"flex items-center justify-between"},ft={class:"relative min-h-[50vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border"},ct={class:"rounded-md border"},pt={class:"font-medium"},_t={key:0,class:"text-sm text-muted-foreground"},vt={class:"flex items-center gap-3"},gt={key:0,class:"flex items-center gap-2"},ht={key:0,class:"text-xs text-orange-600 mr-2",title:"Asigna votantes antes de activar"},bt={key:0},xt={key:1},kt={key:0,class:"text-orange-600 font-medium"},yt={class:"text-xs text-muted-foreground"},$t={key:1,class:"ml-2"},Ct={key:2,class:"text-xs text-muted-foreground"},wt={class:"flex items-center gap-1"},zt={class:"flex justify-end gap-2"},St={key:0,class:"flex items-center justify-between mt-4"},Et={class:"text-sm text-muted-foreground"},Ft={class:"flex gap-2"},Ge=Z({__name:"Index",props:{votaciones:{},categorias:{},filters:{},filterFieldsConfig:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canManageVoters:{type:Boolean}},setup(T){const u=T,q=[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"}],M={fields:u.filterFieldsConfig||[],showQuickSearch:!0,quickSearchPlaceholder:"Buscar por título o descripción...",quickSearchFields:["titulo","descripcion"],maxNestingLevel:2,allowSaveFilters:!0,debounceTime:500,autoApply:!1},P=l=>{h.get(`/admin/votaciones/${l}/imports`)},j=l=>{h.get(`/votaciones/${l}/resultados`)},{route:b}=window,I=tt(()=>({quickSearch:u.filters.search,rootGroup:u.filters.advanced_filters?JSON.parse(u.filters.advanced_filters):void 0})),G=l=>{h.delete(`/admin/votaciones/${l}`,{onSuccess:()=>{}})},H=l=>{const o=l.estado==="borrador"?"activa":"borrador";h.post(b("admin.votaciones.toggle-status",l.id),{estado:o},{preserveScroll:!0,onSuccess:()=>{},onError:s=>{console.error("Error toggling status:",s),s!=null&&s.message&&alert(s.message)}})},U=l=>{h.post(b("admin.votaciones.toggle-status",l.id),{estado:"finalizada"},{preserveScroll:!0,onSuccess:()=>{},onError:o=>{console.error("Error finalizando votación:",o),o!=null&&o.message&&alert(o.message)}})},W=l=>{switch(l){case"borrador":return"secondary";case"activa":return"default";case"finalizada":return"outline";default:return"secondary"}},A=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(l,o)=>(n(),f(V,null,[e(t(et),{title:"Gestión de Votaciones"}),e(Y,{breadcrumbs:q},{default:a(()=>[r("div",ut,[r("div",mt,[o[1]||(o[1]=r("div",null,[r("h1",{class:"text-3xl font-bold"},"Gestión de Votaciones"),r("p",{class:"text-muted-foreground"}," Administra todas las votaciones del sistema ")],-1)),l.canCreate?(n(),p(t(g),{key:0,"as-child":""},{default:a(()=>[e(t(L),{href:t(b)("admin.votaciones.create")},{default:a(()=>[e(t(ot),{class:"mr-2 h-4 w-4"}),o[0]||(o[0]=i(" Nueva Votación ",-1))]),_:1},8,["href"])]),_:1})):m("",!0)]),e(st,{config:M,route:t(b)("admin.votaciones.index"),"initial-filters":I.value},null,8,["route","initial-filters"]),r("div",ft,[e(t(J),{class:"border-0 shadow-none h-full"},{default:a(()=>[e(t(O),{class:"pt-6"},{default:a(()=>[r("div",ct,[e(t(R),null,{default:a(()=>[e(t(K),null,{default:a(()=>[e(t(x),null,{default:a(()=>[e(t(v),null,{default:a(()=>[...o[2]||(o[2]=[i("Título",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...o[3]||(o[3]=[i("Categoría",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...o[4]||(o[4]=[i("Estado",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...o[5]||(o[5]=[i("Activar/Desactivar",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...o[6]||(o[6]=[i("Fecha Inicio",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...o[7]||(o[7]=[i("Fecha Fin",-1)])]),_:1}),e(t(v),null,{default:a(()=>[...o[8]||(o[8]=[i("Votantes",-1)])]),_:1}),e(t(v),{class:"text-right"},{default:a(()=>[...o[9]||(o[9]=[i("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(X),null,{default:a(()=>[u.votaciones.data.length===0?(n(),p(t(x),{key:0},{default:a(()=>[e(t(c),{colspan:8,class:"text-center py-8 text-muted-foreground"},{default:a(()=>[...o[10]||(o[10]=[i(" No se encontraron votaciones ",-1)])]),_:1})]),_:1})):m("",!0),(n(!0),f(V,null,N(u.votaciones.data,s=>(n(),p(t(x),{key:s.id},{default:a(()=>[e(t(c),null,{default:a(()=>{var _,B;return[r("div",null,[r("p",pt,d(s.titulo),1),s.descripcion?(n(),f("p",_t,d((_=s.descripcion)==null?void 0:_.substring(0,60))+d(((B=s.descripcion)==null?void 0:B.length)>60?"...":""),1)):m("",!0)])]}),_:2},1024),e(t(c),null,{default:a(()=>[e(t(D),{variant:"outline"},{default:a(()=>[i(d(s.categoria.nombre),1)]),_:2},1024)]),_:2},1024),e(t(c),null,{default:a(()=>[e(t(D),{variant:W(s.estado)},{default:a(()=>[i(d(s.estado),1)]),_:2},1032,["variant"])]),_:2},1024),e(t(c),null,{default:a(()=>[r("div",vt,[s.estado!=="finalizada"?(n(),f("div",gt,[s.estado==="borrador"&&(!s.votantes_count||s.votantes_count===0)?(n(),f("div",ht," ⚠️ Sin votantes ")):m("",!0),l.canEdit?(n(),p(t(k),{key:1},{default:a(()=>[e(t(F),{"as-child":""},{default:a(()=>[e(t(Q),{checked:s.estado==="activa",disabled:!1},null,8,["checked"])]),_:2},1024),e(t(y),null,{default:a(()=>[e(t($),null,{default:a(()=>[e(t(C),null,{default:a(()=>[i(d(s.estado==="activa"?"Desactivar votación":"Activar votación"),1)]),_:2},1024),e(t(w),null,{default:a(()=>[s.estado==="activa"?(n(),f("span",bt,' La votación "'+d(s.titulo)+'" será desactivada y volverá al estado borrador. Los votantes no podrán acceder hasta que la actives nuevamente. ',1)):(n(),f("span",xt,[!s.votantes_count||s.votantes_count===0?(n(),f("span",kt,[...o[11]||(o[11]=[i(" ⚠️ Advertencia: Esta votación no tiene votantes asignados. Debes asignar votantes antes de poder activarla. ",-1),r("br",null,null,-1),r("br",null,null,-1)])])):m("",!0),i(' La votación "'+d(s.titulo)+'" será activada y los votantes podrán empezar a votar. Asegúrate de que la configuración esté completa. ',1)]))]),_:2},1024)]),_:2},1024),e(t(z),null,{default:a(()=>[e(t(S),null,{default:a(()=>[...o[12]||(o[12]=[i("Cancelar",-1)])]),_:1}),e(t(E),{onClick:_=>H(s),class:at((!s.votantes_count||s.votantes_count===0)&&s.estado==="borrador"?"bg-orange-600 hover:bg-orange-700":"")},{default:a(()=>[i(d(s.estado==="activa"?"Desactivar":"Activar"),1)]),_:2},1032,["onClick","class"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):m("",!0),r("span",yt,d(s.estado==="activa"?"Activa":"Inactiva"),1)])):m("",!0),s.estado==="activa"&&l.canEdit?(n(),f("div",$t,[e(t(k),null,{default:a(()=>[e(t(F),{"as-child":""},{default:a(()=>[e(t(g),{variant:"outline",size:"sm",class:"text-orange-600 hover:text-orange-700"},{default:a(()=>[...o[13]||(o[13]=[i(" Finalizar ",-1)])]),_:1})]),_:1}),e(t(y),null,{default:a(()=>[e(t($),null,{default:a(()=>[e(t(C),null,{default:a(()=>[...o[14]||(o[14]=[i("Finalizar votación",-1)])]),_:1}),e(t(w),null,{default:a(()=>[i(' La votación "'+d(s.titulo)+'" será finalizada permanentemente. Esta acción no se puede deshacer y los votantes ya no podrán votar. ',1)]),_:2},1024)]),_:2},1024),e(t(z),null,{default:a(()=>[e(t(S),null,{default:a(()=>[...o[15]||(o[15]=[i("Cancelar",-1)])]),_:1}),e(t(E),{onClick:_=>U(s),class:"bg-orange-600 text-white hover:bg-orange-700"},{default:a(()=>[...o[16]||(o[16]=[i(" Finalizar ",-1)])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])):m("",!0),s.estado==="finalizada"?(n(),f("div",Ct," Finalizada ")):m("",!0)])]),_:2},1024),e(t(c),null,{default:a(()=>[i(d(A(s.fecha_inicio)),1)]),_:2},1024),e(t(c),null,{default:a(()=>[i(d(A(s.fecha_fin)),1)]),_:2},1024),e(t(c),null,{default:a(()=>[r("div",wt,[e(t(it),{class:"h-4 w-4 text-muted-foreground"}),r("span",null,d(s.votantes_count||0),1)])]),_:2},1024),e(t(c),{class:"text-right"},{default:a(()=>[r("div",zt,[l.canManageVoters?(n(),p(t(g),{key:0,variant:"ghost",size:"sm",onClick:_=>P(s.id),title:"Ver historial de importaciones"},{default:a(()=>[e(t(lt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):m("",!0),s.resultados_publicos?(n(),p(t(g),{key:1,variant:"ghost",size:"sm",onClick:_=>j(s.id),title:"Ver resultados",class:"text-blue-600 hover:text-blue-700"},{default:a(()=>[e(t(nt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):m("",!0),s.estado!=="finalizada"&&l.canEdit?(n(),p(t(g),{key:2,variant:"ghost",size:"sm","as-child":""},{default:a(()=>[e(t(L),{href:t(b)("admin.votaciones.edit",s.id)},{default:a(()=>[e(t(rt),{class:"h-4 w-4"})]),_:2},1032,["href"])]),_:2},1024)):m("",!0),s.estado==="borrador"&&l.canDelete?(n(),p(t(k),{key:3},{default:a(()=>[e(t(F),{"as-child":""},{default:a(()=>[e(t(g),{variant:"ghost",size:"sm"},{default:a(()=>[e(t(dt),{class:"h-4 w-4 text-destructive"})]),_:1})]),_:1}),e(t(y),null,{default:a(()=>[e(t($),null,{default:a(()=>[e(t(C),null,{default:a(()=>[...o[17]||(o[17]=[i("¿Eliminar votación?",-1)])]),_:1}),e(t(w),null,{default:a(()=>[i(' Esta acción no se puede deshacer. Se eliminará permanentemente la votación "'+d(s.titulo)+'" y todos sus datos asociados. ',1)]),_:2},1024)]),_:2},1024),e(t(z),null,{default:a(()=>[e(t(S),null,{default:a(()=>[...o[18]||(o[18]=[i("Cancelar",-1)])]),_:1}),e(t(E),{onClick:_=>G(s.id),class:"bg-destructive text-destructive-foreground hover:bg-destructive/90"},{default:a(()=>[...o[19]||(o[19]=[i(" Eliminar ",-1)])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):m("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),u.votaciones.last_page>1?(n(),f("div",St,[r("p",Et," Mostrando "+d((u.votaciones.current_page-1)*u.votaciones.per_page+1)+" a "+d(Math.min(u.votaciones.current_page*u.votaciones.per_page,u.votaciones.total))+" de "+d(u.votaciones.total)+" resultados ",1),r("div",Ft,[(n(!0),f(V,null,N(u.votaciones.links,s=>(n(),p(t(g),{key:s.label,variant:s.active?"default":"outline",disabled:!s.url,size:"sm",onClick:_=>s.url&&t(h).get(s.url),innerHTML:s.label},null,8,["variant","disabled","onClick","innerHTML"]))),128))])])):m("",!0)]),_:1})]),_:1})])])]),_:1})],64))}});export{Ge as default};
