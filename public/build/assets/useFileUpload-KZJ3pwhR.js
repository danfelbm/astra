import{r as p,a as c}from"./app-DDUuJmlD.js";function S(){const d=p(!1),u=p({}),f=p(new Map),i=()=>{const r=window.location.pathname;return r.startsWith("/admin")?"/admin":r.startsWith("/miembro")?"/miembro":""};return{isUploading:d,uploadProgress:u,uploadErrors:f,uploadFiles:async(r,e)=>{var n,o;d.value=!0,f.value.clear();const a=new FormData;r.forEach(t=>{a.append("files[]",t)}),a.append("module",e.module),a.append("field_id",e.fieldId),e.folder&&a.append("folder",e.folder),e.maxSize&&a.append("max_size",e.maxSize.toString()),e.proyectoId&&a.append("proyecto_id",e.proyectoId.toString()),e.hitoId&&a.append("hito_id",e.hitoId.toString()),e.entregableId&&a.append("entregable_id",e.entregableId.toString());try{const t=await c.post(`${i()}/api/files/upload`,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s=>{if(s.total){const l=Math.round(s.loaded*100/s.total);r.forEach(m=>{u.value[m.name]=l,e.onProgress&&e.onProgress(m.name,l)})}}});if(t.data.success)return e.onSuccess&&e.onSuccess(t.data.files),t.data.files;throw new Error(t.data.message||"Error al subir archivos")}catch(t){const s=((o=(n=t.response)==null?void 0:n.data)==null?void 0:o.message)||t.message||"Error desconocido al subir archivos";throw r.forEach(l=>{f.value.set(l.name,s)}),e.onError&&e.onError(t),t}finally{d.value=!1,setTimeout(()=>{u.value={}},2e3)}},deleteFile:async r=>{try{return(await c.delete(`${i()}/api/files/delete`,{data:{path:r}})).data.success}catch(e){return console.error("Error al eliminar archivo:",e),!1}},downloadFile:async(r,e)=>{try{const a=await c.get(`${i()}/api/files/download`,{params:{path:r},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([a.data])),o=document.createElement("a");o.href=n,o.setAttribute("download",e||r.split("/").pop()||"archivo"),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(n)}catch(a){throw console.error("Error al descargar archivo:",a),a}},getFileInfo:async r=>{try{const e=await c.get(`${i()}/api/files/info`,{params:{path:r}});return e.data.success?e.data.file:null}catch(e){return console.error("Error al obtener informaciÃ³n del archivo:",e),null}},validateFileType:(r,e)=>{var o;const a=e.split(",").map(t=>t.trim().toLowerCase()),n="."+((o=r.name.split(".").pop())==null?void 0:o.toLowerCase());return a.some(t=>t===n)},validateFileSize:(r,e)=>{const a=e*1024*1024;return r.size<=a},formatFileSize:r=>{if(r===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(r)/Math.log(e));return Math.round(r/Math.pow(e,n)*100)/100+" "+a[n]}}}export{S as u};
