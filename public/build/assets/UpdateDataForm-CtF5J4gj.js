import{d as le,r as x,c as ne,i as g,e as c,f as o,u as a,p as re,w as n,g as t,h as d,t as m,F as L,l as J,x as de,j as D,b as N,n as ue,k as Q,a as me}from"./app-BxMQdeji.js";import{_ as ce}from"./GuestLayout.vue_vue_type_script_setup_true_lang-COd2tEBN.js";import{_ as pe}from"./GeographicSelector.vue_vue_type_script_setup_true_lang-Rc0j_Ts0.js";import{_ as fe,a as ve,b as ge,c as _e}from"./CardTitle.vue_vue_type_script_setup_true_lang-BnCOEwdG.js";import{_ as be}from"./CardDescription.vue_vue_type_script_setup_true_lang-ToL2SzCT.js";import{_ as w}from"./createLucideIcon-C-UWYrfi.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-BlmtfhYq.js";import{_ as T}from"./Label.vue_vue_type_script_setup_true_lang-Cv61jd0z.js";import{_ as F,a as V}from"./index-BSf8eefq.js";import{_ as xe}from"./SPhoneInput.vue_vue_type_script_setup_true_lang-PbQYUkso.js";import{_ as ye}from"./Progress.vue_vue_type_script_setup_true_lang-BF0Ctj7D.js";import{t as j}from"./index-uuqfgDZR.js";import{C as M}from"./circle-check-big-C20rPwS_.js";import{M as he}from"./map-pin-BSO3mLrr.js";import{U as we}from"./upload-CVF3WOvj.js";import{F as ke}from"./file-text-BnGFyr0l.js";import{X as Ce}from"./x-CtZ-Yk1L.js";import{C as H}from"./circle-alert----6uGyB.js";import{L as $e}from"./loader-circle-DBrkq7WX.js";import"./index-De6-LhcB.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CtZNhcn0.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-C_cC4TmA.js";import"./VisuallyHidden-BU7kxpuH.js";import"./index-gViH2lvq.js";import"./check-Df8aIUSG.js";import"./floating-ui.vue-8MwpQwna.js";import"./nullish-CHIgUVhi.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-B3HbiEjo.js";import"./index-DlUGQz7I.js";import"./search-BH_bEnIt.js";import"./useKbd-kRIii9yh.js";import"./utils-CDNySjiA.js";import"./VisuallyHiddenInput-DFI-nItV.js";import"./chevrons-up-down-3z313Cuu.js";const je={class:"max-w-2xl mx-auto"},Se={key:0,class:"space-y-6"},ze={class:"bg-muted p-4 rounded-lg"},De={class:"space-y-3"},Ne={class:"flex items-start gap-3"},Te={class:"rounded-full bg-primary/10 p-1 mt-0.5"},Fe={class:"flex items-start gap-3"},Ve={class:"rounded-full bg-primary/10 p-1 mt-0.5"},Me={class:"flex items-start gap-3"},Ae={class:"rounded-full bg-primary/10 p-1 mt-0.5"},Ue={class:"flex flex-col sm:flex-row gap-3"},Be={key:1,class:"space-y-6"},Ee={class:"bg-muted p-4 rounded-lg"},Pe={class:"space-y-2"},Le={class:"flex justify-between items-center"},Oe={class:"font-medium"},Ge={class:"flex justify-between items-center"},Ke={class:"font-medium"},Re={class:"flex justify-between items-center"},Ie={class:"font-medium"},We={class:"flex justify-between items-center"},Xe={class:"font-medium"},Je={class:"flex flex-col sm:flex-row gap-3"},Qe={class:"bg-muted p-4 rounded-lg mb-6"},qe={class:"space-y-1 text-sm"},He={class:"space-y-3"},Ye={key:0,class:"space-y-2"},Ze={class:"flex justify-between text-sm text-muted-foreground"},et={class:"flex items-center gap-2"},tt={class:"text-sm text-muted-foreground"},st={key:1,class:"space-y-2"},at={class:"flex items-center gap-2 flex-1 min-w-0"},ot={class:"min-w-0"},it={class:"text-sm truncate"},lt={class:"text-xs text-muted-foreground"},nt={class:"list-disc list-inside"},rt={class:"flex gap-3"},G=5,dt=10*1024*1024,Rt=le({__name:"UpdateDataForm",props:{verification:{},user:{}},setup(Y){const r=Y,K=s=>s?s.split(" ").map(l=>{if(l.length<=2)return l;const u=l.substring(0,2),p="*".repeat(l.length-2);return u+p}).join(" "):"",R=s=>{if(!s)return"";const[e,l]=s.split("@");if(!l)return s;const[u,...p]=l.split("."),h=p.join(".");let $;if(e.length<=3)$=e;else{const B=e.substring(0,2),E=e.substring(e.length-1),P="*".repeat(e.length-3);$=B+P+E}const U=u[0]+"*".repeat(u.length-1);return`${$}@${U}.${h}`},I=s=>{if(!s)return"";if(s.length<=6)return s;const e=s.substring(0,5),l=s.substring(s.length-1),u="*".repeat(s.length-6);return e+u+l},b=x(!1),k=x(!r.verification.is_verified),A=x(!1),i=x({email:"",telefono:"",territorio_id:r.user.territorio_id||void 0,departamento_id:r.user.departamento_id||void 0,municipio_id:r.user.municipio_id||void 0,localidad_id:r.user.localidad_id||void 0}),Z=ne(()=>{var e,l,u;const s=[];return(e=r.user.departamento)!=null&&e.nombre&&s.push(r.user.departamento.nombre),(l=r.user.municipio)!=null&&l.nombre&&s.push(r.user.municipio.nombre),(u=r.user.localidad)!=null&&u.nombre&&s.push(r.user.localidad.nombre),s.length>0?s.join(", "):"No definida"}),ee=s=>{i.value.territorio_id=s.territorio_id,i.value.departamento_id=s.departamento_id,i.value.municipio_id=s.municipio_id,i.value.localidad_id=s.localidad_id},v=x([]),y=x([]),S=x(0),C=x(!1),te=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg"],W=["pdf","doc","docx","png","jpg","jpeg"],se=s=>{var u;const e=s.target,l=Array.from(e.files||[]);if(y.value=[],v.value.length+l.length>G){y.value.push(`Máximo ${G} archivos permitidos`);return}for(const p of l){if(p.size>dt){y.value.push(`${p.name} excede el tamaño máximo de 10MB`);continue}const h=(u=p.name.split(".").pop())==null?void 0:u.toLowerCase();if(!te.includes(p.type)&&(!h||!W.includes(h))){y.value.push(`${p.name} tiene un formato no permitido`);continue}v.value.push(p)}e.value=""},ae=s=>{v.value.splice(s,1),y.value=[]},oe=s=>{if(s===0)return"0 Bytes";const e=1024,l=["Bytes","KB","MB"],u=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,u)*100)/100+" "+l[u]},ie=async()=>{var u,p,h,$,U,B,E,P;if(v.value.length===0){j.error("Por favor adjunta al menos un documento de soporte");return}const s=i.value.email&&i.value.email!==r.user.email,e=i.value.telefono&&i.value.telefono!==r.user.telefono,l=i.value.territorio_id!==r.user.territorio_id||i.value.departamento_id!==r.user.departamento_id||i.value.municipio_id!==r.user.municipio_id||i.value.localidad_id!==r.user.localidad_id;if(!s&&!e&&!l&&v.value.length===0){j.error("No se detectaron cambios para actualizar");return}if(i.value.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.value.email)){j.error("Por favor ingresa un email válido");return}b.value=!0,C.value=!0,S.value=0;try{const f=new FormData;f.append("verification_id",r.verification.id.toString()),i.value.email&&i.value.email!==r.user.email&&f.append("email",i.value.email),i.value.telefono&&i.value.telefono!==r.user.telefono&&f.append("telefono",i.value.telefono),i.value.territorio_id!==r.user.territorio_id&&f.append("territorio_id",((u=i.value.territorio_id)==null?void 0:u.toString())||""),i.value.departamento_id!==r.user.departamento_id&&f.append("departamento_id",((p=i.value.departamento_id)==null?void 0:p.toString())||""),i.value.municipio_id!==r.user.municipio_id&&f.append("municipio_id",((h=i.value.municipio_id)==null?void 0:h.toString())||""),i.value.localidad_id!==r.user.localidad_id&&f.append("localidad_id",(($=i.value.localidad_id)==null?void 0:$.toString())||""),v.value.forEach((_,z)=>{f.append(`documentos[${z}]`,_)}),(await me.post("/confirmar-registro/actualizar-datos",f,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:_=>{const z=_.total?Math.round(_.loaded*100/_.total):0;S.value=z}})).data.success&&(j.success("Solicitud enviada correctamente",{description:"Te notificaremos cuando sea procesada"}),A.value=!0,k.value=!1)}catch(f){const X=((B=(U=f.response)==null?void 0:U.data)==null?void 0:B.message)||"Error al enviar la solicitud",_=(P=(E=f.response)==null?void 0:E.data)==null?void 0:P.errors;_&&Array.isArray(_)?_.forEach(z=>j.error(z)):j.error(X)}finally{b.value=!1,C.value=!1,S.value=0}},O=()=>{window.location.href="/confirmar-registro"};return(s,e)=>(c(),g(L,null,[o(a(re),{title:"Actualizar Datos"}),o(ce,{title:"Actualizar Datos de Contacto",description:s.verification.is_verified?"Tu identidad ha sido verificada. Puedes actualizar tus datos.":"Actualiza tus datos adjuntando documentación de soporte."},{default:n(()=>[t("div",je,[o(a(fe),{class:"shadow-lg"},{default:n(()=>[o(a(ve),null,{default:n(()=>[o(a(ge),{class:"flex items-center gap-2"},{default:n(()=>[d(m(A.value?"✅ Solicitud Enviada":s.verification.is_verified&&!k.value?"✅ Identidad Verificada":"📝 Actualización de Datos"),1)]),_:1}),o(a(be),null,{default:n(()=>[d(m(A.value?"Tu solicitud ha sido recibida exitosamente":s.verification.is_verified&&!k.value?"Tu identidad ha sido confirmada exitosamente":"Actualiza tu información de contacto para mantener tus datos al día"),1)]),_:1})]),_:1}),o(a(_e),null,{default:n(()=>[A.value?(c(),g("div",Se,[o(a(F),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:n(()=>[o(a(M),{class:"h-4 w-4 text-green-600 dark:text-green-400"}),o(a(V),{class:"text-green-800 dark:text-green-200"},{default:n(()=>[...e[5]||(e[5]=[t("strong",null,"¡Solicitud enviada exitosamente!",-1),t("br",null,null,-1),d(" Tu solicitud de actualización de datos ha sido enviada correctamente. ",-1)])]),_:1})]),_:1}),t("div",ze,[e[9]||(e[9]=t("h3",{class:"font-semibold mb-3 text-lg"},"¿Qué sigue ahora?",-1)),t("div",De,[t("div",Ne,[t("div",Te,[o(a(M),{class:"h-4 w-4 text-primary"})]),e[6]||(e[6]=t("div",null,[t("p",{class:"font-medium"},"Revisión administrativa"),t("p",{class:"text-sm text-muted-foreground"},"Tu solicitud será revisada por un administrador")],-1))]),t("div",Fe,[t("div",Ve,[o(a(M),{class:"h-4 w-4 text-primary"})]),e[7]||(e[7]=t("div",null,[t("p",{class:"font-medium"},"Notificación por email y WhatsApp"),t("p",{class:"text-sm text-muted-foreground"},"Te informaremos cuando tu solicitud sea procesada")],-1))]),t("div",Me,[t("div",Ae,[o(a(M),{class:"h-4 w-4 text-primary"})]),e[8]||(e[8]=t("div",null,[t("p",{class:"font-medium"},"Actualización de datos"),t("p",{class:"text-sm text-muted-foreground"},"Si es aprobada, tus datos serán actualizados automáticamente")],-1))])])]),t("div",Ue,[o(a(w),{onClick:O,type:"button",variant:"default",class:"flex-1"},{default:n(()=>[...e[10]||(e[10]=[d(" Volver al inicio ",-1)])]),_:1})])])):s.verification.is_verified&&!k.value?(c(),g("div",Be,[o(a(F),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:n(()=>[o(a(M),{class:"h-4 w-4 text-green-600 dark:text-green-400"}),o(a(V),{class:"text-green-800 dark:text-green-200"},{default:n(()=>[...e[11]||(e[11]=[t("strong",null,"¡Verificación exitosa!",-1),t("br",null,null,-1),d(" Tu identidad ha sido confirmada correctamente. ",-1)])]),_:1})]),_:1}),t("div",Ee,[e[16]||(e[16]=t("h3",{class:"font-semibold mb-3 text-lg"},"Datos Verificados",-1)),t("div",Pe,[t("p",Le,[e[12]||(e[12]=t("span",{class:"text-muted-foreground"},"Nombre:",-1)),t("span",Oe,m(K(s.user.name)),1)]),t("p",Ge,[e[13]||(e[13]=t("span",{class:"text-muted-foreground"},"Documento:",-1)),t("span",Ke,m(s.user.documento_identidad),1)]),t("p",Re,[e[14]||(e[14]=t("span",{class:"text-muted-foreground"},"Email:",-1)),t("span",Ie,m(s.user.email?R(s.user.email):"No registrado"),1)]),t("p",We,[e[15]||(e[15]=t("span",{class:"text-muted-foreground"},"Teléfono:",-1)),t("span",Xe,m(s.user.telefono?I(s.user.telefono):"No registrado"),1)])])]),t("div",Je,[o(a(w),{onClick:e[0]||(e[0]=l=>k.value=!0),type:"button",variant:"outline",class:"flex-1"},{default:n(()=>[...e[17]||(e[17]=[d(" ¿Deseas actualizar datos? ",-1)])]),_:1}),o(a(w),{onClick:O,type:"button",variant:"default",class:"flex-1"},{default:n(()=>[...e[18]||(e[18]=[d(" Finalizar ",-1)])]),_:1})])])):(c(),g(L,{key:2},[t("div",Qe,[e[24]||(e[24]=t("h3",{class:"font-semibold mb-2"},"Datos Actuales",-1)),t("div",qe,[t("p",null,[e[19]||(e[19]=t("strong",null,"Nombre:",-1)),d(" "+m(K(s.user.name)),1)]),t("p",null,[e[20]||(e[20]=t("strong",null,"Documento:",-1)),d(" "+m(s.user.documento_identidad),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"Email:",-1)),d(" "+m(s.user.email?R(s.user.email):"No registrado"),1)]),t("p",null,[e[22]||(e[22]=t("strong",null,"Teléfono:",-1)),d(" "+m(s.user.telefono?I(s.user.telefono):"No registrado"),1)]),t("p",null,[e[23]||(e[23]=t("strong",null,"Ubicación:",-1)),d(" "+m(Z.value),1)])])]),t("form",{onSubmit:J(ie,["prevent"]),class:"space-y-6"},[t("div",null,[o(a(T),{for:"email"},{default:n(()=>[...e[25]||(e[25]=[d("Nuevo Email",-1)])]),_:1}),o(a(q),{id:"email",modelValue:i.value.email,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.email=l),type:"email",placeholder:"ejemplo@correo.com",class:"mt-1"},null,8,["modelValue"]),e[26]||(e[26]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Deja vacío si no deseas cambiar el email ",-1))]),t("div",null,[o(a(T),{for:"telefono"},{default:n(()=>[...e[27]||(e[27]=[d("Nuevo Teléfono",-1)])]),_:1}),o(a(xe),{id:"telefono",modelValue:i.value.telefono,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.telefono=l),"default-country":"CO",placeholder:"300 123 4567",class:"mt-1",onKeydown:e[3]||(e[3]=de(J(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"]),e[28]||(e[28]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Deja vacío si no deseas cambiar el teléfono ",-1))]),t("div",null,[o(a(T),{class:"mb-2 flex items-center gap-2"},{default:n(()=>[o(a(he),{class:"h-4 w-4"}),e[29]||(e[29]=d(" Nueva Ubicación de Residencia ",-1))]),_:1}),o(pe,{"model-value":{territorio_id:i.value.territorio_id,departamento_id:i.value.departamento_id,municipio_id:i.value.municipio_id,localidad_id:i.value.localidad_id},"onUpdate:modelValue":ee,mode:"single","show-card":!1,disabled:b.value},null,8,["model-value","disabled"]),e[30]||(e[30]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Selecciona tu ubicación actual si ha cambiado ",-1))]),t("div",null,[o(a(T),null,{default:n(()=>[...e[31]||(e[31]=[d("Documentos de Soporte ",-1),t("span",{class:"text-red-500"},"*",-1),d(" (Obligatorio)",-1)])]),_:1}),e[35]||(e[35]=t("p",{class:"text-sm text-muted-foreground mb-2"}," Debes adjuntar al menos un documento de identidad o comprobante para validar la actualización ",-1)),t("div",He,[C.value?(c(),g("div",Ye,[t("div",Ze,[e[32]||(e[32]=t("span",null,"Subiendo archivos...",-1)),t("span",null,m(S.value)+"%",1)]),o(a(ye),{value:S.value,class:"w-full"},null,8,["value"])])):D("",!0),t("div",et,[o(a(q),{type:"file",onChange:se,accept:W.map(l=>`.${l}`).join(","),multiple:"",disabled:C.value,class:"hidden",id:"file-input"},null,8,["accept","disabled"]),o(a(T),{for:"file-input",class:ue(["inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background h-10 px-4 py-2",C.value?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-accent hover:text-accent-foreground"])},{default:n(()=>[o(a(we),{class:"mr-2 h-4 w-4"}),d(" "+m(C.value?"Subiendo...":"Seleccionar archivos"),1)]),_:1},8,["class"]),t("span",tt,m(v.value.length)+"/"+m(G)+" archivos ",1)]),v.value.length>0?(c(),g("div",st,[(c(!0),g(L,null,Q(v.value,(l,u)=>(c(),g("div",{key:u,class:"flex items-center justify-between p-2 bg-muted rounded-md"},[t("div",at,[o(a(ke),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),t("div",ot,[t("p",it,m(l.name),1),t("p",lt,m(oe(l.size)),1)])]),o(a(w),{onClick:p=>ae(u),type:"button",variant:"ghost",size:"sm",class:"h-8 w-8 p-0"},{default:n(()=>[o(a(Ce),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]))),128))])):D("",!0),y.value.length>0?(c(),N(a(F),{key:2,variant:"destructive"},{default:n(()=>[o(a(H),{class:"h-4 w-4"}),o(a(V),null,{default:n(()=>[t("ul",nt,[(c(!0),g(L,null,Q(y.value,l=>(c(),g("li",{key:l},m(l),1))),128))])]),_:1})]),_:1})):D("",!0),v.value.length===0?(c(),N(a(F),{key:3,variant:"default",class:"border-orange-200 bg-orange-50 dark:bg-orange-900/20"},{default:n(()=>[o(a(H),{class:"h-4 w-4 text-orange-600"}),o(a(V),{class:"text-orange-800 dark:text-orange-200"},{default:n(()=>[...e[33]||(e[33]=[t("strong",null,"Importante:",-1),d(" Debes adjuntar al menos un documento para procesar tu solicitud. ",-1)])]),_:1})]),_:1})):D("",!0),e[34]||(e[34]=t("p",{class:"text-xs text-muted-foreground"}," Formatos permitidos: PDF, DOC, DOCX, PNG, JPG. Máximo 10MB por archivo. ",-1))])]),o(a(F),null,{default:n(()=>[o(a(V),{class:"text-foreground"},{default:n(()=>[...e[36]||(e[36]=[d(" Tu solicitud será revisada por un administrador. Recibirás una notificación por email y WhatsApp cuando sea procesada. ",-1)])]),_:1})]),_:1}),t("div",rt,[o(a(w),{type:"submit",disabled:b.value,class:"flex-1"},{default:n(()=>[b.value?(c(),N(a($e),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):D("",!0),d(" "+m(b.value?"Enviando...":"Enviar Solicitud"),1)]),_:1},8,["disabled"]),s.verification.is_verified?(c(),N(a(w),{key:0,onClick:e[4]||(e[4]=l=>k.value=!1),type:"button",variant:"outline",disabled:b.value},{default:n(()=>[...e[37]||(e[37]=[d(" Volver ",-1)])]),_:1},8,["disabled"])):(c(),N(a(w),{key:1,onClick:O,type:"button",variant:"outline",disabled:b.value},{default:n(()=>[...e[38]||(e[38]=[d(" Cancelar ",-1)])]),_:1},8,["disabled"]))])],32)],64))]),_:1})]),_:1})])]),_:1},8,["description"])],64))}});export{Rt as default};
