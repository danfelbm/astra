import{d as Ie,u as Ne,r as y,c as M,p as de,U as De,o as je,M as Be,B as Re,b as A,w as r,g as n,e as a,f as o,v as Oe,h as l,j as _,i as m,m as p,t as f,l as Me,F as D,k as j,s as Q}from"./app-BDg7E49x.js";import{_ as Te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DQtw_HzK.js";import{_ as C,a as S,b as U,c as k}from"./CardTitle.vue_vue_type_script_setup_true_lang-PGdupcIB.js";import{_ as $}from"./CardDescription.vue_vue_type_script_setup_true_lang-BkVVIKEx.js";import{_ as x}from"./createLucideIcon-BdVmm7P_.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-DdSjcwnl.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-np36qPXZ.js";import{_ as ue}from"./Textarea.vue_vue_type_script_setup_true_lang-D-ysd6cn.js";import{_ as T,a as L,b as q,c as G,d as h}from"./SelectValue.vue_vue_type_script_setup_true_lang-tpq5Hvrt.js";import{_ as Le,a as qe}from"./index-BEZytBRS.js";import{_ as Ge,a as Je,b as B,c as R}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-C0jSUZbI.js";import{u as Xe}from"./useToast-CqK2hGSh.js";import{u as Ke}from"./useFileUpload-DLFKqthu.js";import{u as We}from"./useAutoSave-D7HP1TE6.js";import{_ as Y}from"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-Dc1uN_Jn.js";import{_ as Z}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-BB2nGN51.js";import{_ as He}from"./FileUploadField.vue_vue_type_script_setup_true_lang-DIhzcU9q.js";import{A as Qe}from"./arrow-left-CpbS6NHc.js";import{C as Ye}from"./clock-BrpEYgjg.js";import{C as Ze}from"./circle-check-big-BAoFNt74.js";import{C as pe}from"./circle-alert-D2_vXx_s.js";import{X as ee}from"./x-G0LZP78x.js";import{U as me}from"./user-plus-DDlUl2-2.js";import{U as ce}from"./users-B4eDDANw.js";import{T as eo}from"./trash-2-2fe4ym2B.js";import{S as oo}from"./save-BSnvqq-9.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-B3xcxErQ.js";import"./index-DwmLcJQk.js";import"./floating-ui.vue-BdF4JOJl.js";import"./index-Cp6BehJD.js";import"./shield-47ee-sAU.js";import"./user-DFclF7qW.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CbQ9dhwM.js";import"./chevron-right-DbDOw8_f.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CssOazgJ.js";import"./VisuallyHidden-CaM2o_WC.js";import"./index-A85eAGP1.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DmLL_yNx.js";import"./index-ClqqlYCG.js";import"./map-pin-CcReoaeK.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Bf2ruFqZ.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-fbrGXwCx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-C_zyeJPb.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-gLQTMRvN.js";import"./tag-DQ85ruQd.js";import"./target-SmQeNmiJ.js";import"./vote-DLVjarZJ.js";import"./folder-open-Lae0pyJG.js";import"./send-BMsH3-Hb.js";import"./file-text-Dsaay5EU.js";import"./briefcase-BBbisQqT.js";import"./calendar-DCovRqU-.js";import"./megaphone-BpECQaLq.js";import"./user-check-lWsW8r3F.js";import"./clipboard-list-C9DnNK0q.js";import"./mail-C-MCuTK7.js";import"./message-square-BZT_4IMP.js";import"./external-link-q6POtaVR.js";import"./panel-left-Bq0PqqJ4.js";import"./index-DjS2Yj2q.js";import"./check-BSXmPTLR.js";import"./index--7yEigtK.js";import"./RovingFocusItem-0WOfKQtF.js";import"./utils-ph3EFn2z.js";import"./debounce-Cr3Ce_A8.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BpkxS9nt.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-_QWWnjmh.js";import"./VisuallyHiddenInput-8UdSZeuv.js";import"./circle-BDP3EDNk.js";import"./search--W7ScXI1.js";import"./loader-circle-CFcShzm_.js";import"./chevron-left-lwuLPeVA.js";import"./upload-BMz4EZoE.js";import"./file-bvbmHkT5.js";import"./eye-C8tnSqng.js";import"./download-wkf9oGDK.js";const to={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ao={class:"flex items-center justify-between"},ro={class:"flex items-center gap-4"},so={class:"flex items-center gap-2 text-sm text-muted-foreground"},lo={key:3},io={key:4},no={key:5},uo={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-blue-600 rounded-full"},po={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},mo={key:0,class:"text-red-500 text-sm mt-1"},co={key:0,class:"text-red-500 text-sm mt-1"},fo={key:0,class:"text-red-500 text-sm mt-1"},_o={key:0,class:"space-y-4 pt-4 border-t"},vo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},bo={key:0,class:"text-red-500 text-sm mt-1"},go={key:0,class:"text-red-500 text-sm mt-1"},ho={key:0,class:"text-red-500 text-sm mt-1"},yo={key:0,class:"text-red-500 text-sm mt-1"},xo={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between mb-2"},Vo={class:"font-medium"},Co={class:"text-sm text-muted-foreground"},So={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},Uo={key:0,class:"text-red-500 text-sm mt-1"},ko={key:0,class:"text-red-500 text-sm mt-1"},$o={key:0,class:"space-y-4 pt-4 border-t"},wo={class:"space-y-6"},Eo={class:"space-y-4"},Ao={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},Po={class:"font-medium"},zo={class:"text-sm text-muted-foreground"},Fo={class:"grid grid-cols-1 md:grid-cols-1 gap-4"},Io={class:"space-y-4"},No={key:0,class:"space-y-2"},Do={class:"flex items-center justify-between"},jo={class:"font-medium"},Bo={class:"text-sm text-muted-foreground"},Ro={class:"flex items-center gap-2 mt-1"},Oo={class:"text-xs bg-primary/10 text-primary px-2 py-1 rounded"},Mo={key:0,class:"text-xs text-muted-foreground"},To={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},Lo={key:0,class:"text-red-500 text-sm mt-1"},qo={key:0,class:"space-y-4 pt-4 border-t"},Go={class:"flex justify-between items-center gap-4"},Jo={key:1},Xo={class:"flex gap-4"},ba=Ie({__name:"Create",props:{proyecto:{},proyectos:{},camposPersonalizados:{},responsable:{default:null},contraparte:{default:null},borrador:{default:void 0}},setup(oe){var ie;const c=oe,g=Xe(),{uploadFiles:fe}=Ke(),_e=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:"Crear Contrato",href:"/admin/contratos/create"}],t=Ne({proyecto_id:((ie=c.proyecto)==null?void 0:ie.id)||"",nombre:"",descripcion:"",fecha_inicio:"",fecha_fin:"",estado:"borrador",tipo:"servicio",monto_total:"",moneda:"USD",responsable_id:"none",contraparte_user_id:null,contraparte_nombre:"",contraparte_identificacion:"",contraparte_email:"",contraparte_telefono:"",participantes:[],archivo_pdf:null,archivos_paths:[],archivos_nombres:[],tipos_archivos:{},observaciones:"",campos_personalizados:{}}),ve=y(""),P=y([]),J=y("informacion"),z=y([]),X=y(!1),K=y(!1),W=y(!1),{route:E}=window,F=y(c.contraparte||null),V=y(c.responsable||null),be=M(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"testigo",label:"Testigo"},{value:"revisor",label:"Revisor"},{value:"aprobador",label:"Aprobador"},{value:"observador",label:"Observador"}],value:"testigo",required:!0},{name:"notas",label:"Notas (opcional)",type:"text",value:"",required:!1}]),ge=M(()=>{const i=t.participantes.map(e=>e.user_id);return t.contraparte_user_id&&i.push(t.contraparte_user_id),i}),he=M(()=>t.data()),{state:ye,isSaving:te,hasSaved:ae,hasError:O,startWatching:xe,stopAutoSave:re,restoreDraft:Ve,clearLocalStorage:se}=We(he,{url:"/admin/contratos/autosave",resourceIdField:"contrato_id",debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:"contrato_draft_create"}),Ce=[{value:"USD",label:"USD - Dólar Estadounidense"},{value:"EUR",label:"EUR - Euro"},{value:"MXN",label:"MXN - Peso Mexicano"},{value:"COP",label:"COP - Peso Colombiano"},{value:"ARS",label:"ARS - Peso Argentino"},{value:"CLP",label:"CLP - Peso Chileno"},{value:"PEN",label:"PEN - Sol Peruano"}],I=M(()=>{const i={informacion:[],financiero:[],otros:[]};return c.camposPersonalizados.forEach(e=>{e.slug.includes("financ")||e.slug.includes("monto")||e.slug.includes("precio")?i.financiero.push(e):e.slug.includes("info")||e.slug.includes("descrip")?i.informacion.push(e):i.otros.push(e)}),i}),Se=i=>{const e=i.target;e.files&&e.files[0]&&(t.archivo_pdf=e.files[0],ve.value=e.files[0].name)},Ue=async i=>{try{const e=await fe(i,{module:"contratos",fieldId:"archivos",folder:"contratos",maxSize:10485760}),d=e.map(v=>v.path),s=e.map(v=>v.name),u={};e.forEach(v=>{u[v.path]=v.mime_type}),t.archivos_paths=[...t.archivos_paths,...d],t.archivos_nombres=[...t.archivos_nombres,...s],t.tipos_archivos={...t.tipos_archivos,...u},P.value=[...P.value,...e],g.success(`${e.length} archivo(s) subido(s) exitosamente`)}catch(e){g.error(e.message||"Error al subir archivos")}},ke=()=>{const i=[];return t.proyecto_id||i.push("Debe seleccionar un proyecto"),t.nombre.trim()||i.push("El nombre del contrato es obligatorio"),t.fecha_inicio||i.push("La fecha de inicio es obligatoria"),t.fecha_fin&&t.fecha_fin<t.fecha_inicio&&i.push("La fecha de fin debe ser posterior a la fecha de inicio"),c.camposPersonalizados.forEach(e=>{e.es_requerido&&!t.campos_personalizados[e.id]&&i.push(`El campo "${e.nombre}" es obligatorio`)}),i},$e=i=>{if(i.userIds.length>0&&(t.contraparte_user_id=i.userIds[0],i.users&&i.users.length>0)){const e=i.users[0];t.contraparte_nombre=e.name,t.contraparte_email=e.email||"",F.value=e}},we=i=>{i.userIds.length>0&&(t.responsable_id=i.userIds[0],i.users&&i.users.length>0&&(V.value=i.users[0]))},Ee=i=>{i.userIds.forEach((e,d)=>{t.participantes.some(u=>u.user_id===e)||(t.participantes.push({user_id:e,rol:i.extraData.rol||"testigo",notas:i.extraData.notas||""}),i.users&&i.users[d]&&H.value.set(e,i.users[d]))})},Ae=i=>{const e=t.participantes.findIndex(d=>d.user_id===i);e>-1&&t.participantes.splice(e,1)},H=y(new Map),le=i=>H.value.get(i),Pe=()=>{const i=ke();if(i.length>0){i.forEach(d=>g.error(d));return}const e=new FormData;Object.keys(t.data()).forEach(d=>{d==="campos_personalizados"?Object.keys(t.campos_personalizados).forEach(s=>{const u=t.campos_personalizados[s];u!=null&&u!==""&&e.append(`campos_personalizados[${s}]`,u)}):d==="participantes"?t.participantes.forEach((s,u)=>{e.append(`participantes[${u}][user_id]`,s.user_id.toString()),e.append(`participantes[${u}][rol]`,s.rol),s.notas&&e.append(`participantes[${u}][notas]`,s.notas)}):d==="archivos_paths"||d==="archivos_nombres"||d==="tipos_archivos"?d==="archivos_paths"&&Array.isArray(t.archivos_paths)&&t.archivos_paths.length>0?e.append("archivos_paths",JSON.stringify(t.archivos_paths)):d==="archivos_nombres"&&Array.isArray(t.archivos_nombres)&&t.archivos_nombres.length>0?e.append("archivos_nombres",JSON.stringify(t.archivos_nombres)):d==="tipos_archivos"&&t.tipos_archivos&&Object.keys(t.tipos_archivos).length>0&&e.append("tipos_archivos",JSON.stringify(t.tipos_archivos)):d==="archivo_pdf"&&t.archivo_pdf?e.append("archivo_pdf",t.archivo_pdf):d==="responsable_id"&&t[d]==="none"||t[d]!==null&&t[d]!==""&&e.append(d,t[d])}),Q.post(E("admin.contratos.store"),e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{re(),se(),g.success("Contrato creado exitosamente")},onError:d=>{typeof d=="object"&&d!==null?Object.values(d).forEach(s=>{Array.isArray(s)?s.forEach(u=>g.error(String(u))):typeof s=="string"?g.error(s):g.error("Error al crear el contrato")}):g.error("Error al crear el contrato")}})},ze=()=>{confirm("¿Está seguro de cancelar? Los cambios no guardados se perderán.")&&Q.get(E("admin.contratos.index"))},Fe=()=>{confirm("¿Está seguro de descartar el borrador? Esta acción no se puede deshacer.")&&Q.delete(E("admin.contratos.borrador"),{preserveScroll:!1,onFinish:()=>{se()}})};return de(J,i=>{i==="archivos"&&z.value.length>0&&De(()=>{P.value=z.value,z.value=[]})}),de(P,i=>{t.archivos_paths=i.map(d=>d.path).filter(Boolean),t.archivos_nombres=i.map(d=>d.name).filter(Boolean);const e={};i.forEach(d=>{d.path&&d.mime_type&&(e[d.path]=d.mime_type)}),t.tipos_archivos=e},{deep:!0}),je(()=>{var e,d,s;const i=Be();if((e=i.props.flash)!=null&&e.success&&g.success(i.props.flash.success),(d=i.props.flash)!=null&&d.error&&g.error(i.props.flash.error),c.borrador){if(t.proyecto_id=((s=c.borrador.proyecto_id)==null?void 0:s.toString())||"",t.nombre=c.borrador.nombre||"",t.descripcion=c.borrador.descripcion||"",t.fecha_inicio=c.borrador.fecha_inicio||"",t.fecha_fin=c.borrador.fecha_fin||"",t.tipo=c.borrador.tipo||"servicio",t.monto_total=c.borrador.monto_total||"",t.moneda=c.borrador.moneda||"USD",t.responsable_id=c.borrador.responsable_id||"none",t.contraparte_user_id=c.borrador.contraparte_user_id||null,t.contraparte_nombre=c.borrador.contraparte_nombre||"",t.contraparte_identificacion=c.borrador.contraparte_identificacion||"",t.contraparte_email=c.borrador.contraparte_email||"",t.contraparte_telefono=c.borrador.contraparte_telefono||"",t.observaciones=c.borrador.observaciones||"",t.archivos_paths=c.borrador.archivos_paths||[],t.archivos_nombres=c.borrador.archivos_nombres||[],t.tipos_archivos=c.borrador.tipos_archivos||{},t.archivos_paths.length>0){const u=t.archivos_paths.map((v,N)=>({id:`borrador_${N}`,name:t.archivos_nombres[N]||v.split("/").pop()||"archivo",size:0,path:v,url:`/storage/${v}`,mime_type:t.tipos_archivos[v]||"application/octet-stream"}));z.value=u}c.borrador.participantes&&Array.isArray(c.borrador.participantes)&&(t.participantes=c.borrador.participantes.map(u=>{var v,N,ne;return{user_id:((v=u.pivot)==null?void 0:v.user_id)||u.id,rol:((N=u.pivot)==null?void 0:N.rol)||"testigo",notas:((ne=u.pivot)==null?void 0:ne.notas)||""}}),c.borrador.participantes.forEach(u=>{H.value.set(u.id,{id:u.id,name:u.name,email:u.email})})),g.success("Borrador recuperado",{description:`Borrador del servidor cargado (${t.archivos_paths.length} archivo(s), ${t.participantes.length} participante(s))`})}else{const u=Ve();u&&u.data&&(Object.assign(t,u.data),g.info("Borrador recuperado",{description:"Se recuperaron tus cambios del navegador"}))}xe()}),Re(()=>{re()}),(i,e)=>(p(),A(Te,{breadcrumbs:_e},{default:r(()=>{var d;return[n("div",to,[n("div",ao,[n("div",ro,[a(o(Oe),{href:o(E)("admin.contratos.index")},{default:r(()=>[a(o(x),{variant:"ghost",size:"sm"},{default:r(()=>[a(o(Qe),{class:"h-4 w-4 mr-2"}),e[24]||(e[24]=l(" Volver ",-1))]),_:1})]),_:1},8,["href"]),e[25]||(e[25]=n("div",null,[n("h1",{class:"text-3xl font-bold"},"Crear Contrato"),n("p",{class:"text-gray-600 mt-1"},"Complete la información para crear un nuevo contrato")],-1))]),n("div",so,[o(te)?(p(),A(o(Ye),{key:0,class:"h-4 w-4 animate-spin"})):o(ae)&&!o(O)?(p(),A(o(Ze),{key:1,class:"h-4 w-4 text-green-600"})):o(O)?(p(),A(o(pe),{key:2,class:"h-4 w-4 text-amber-600"})):_("",!0),o(te)?(p(),m("span",lo,"Guardando borrador...")):o(ae)&&!o(O)?(p(),m("span",io,"Borrador guardado a las "+f((d=o(ye).lastSaved)==null?void 0:d.toLocaleTimeString()),1)):o(O)?(p(),m("span",no,"Guardado localmente")):_("",!0)])]),n("form",{onSubmit:Me(Pe,["prevent"]),class:"space-y-6"},[a(o(Ge),{modelValue:J.value,"onUpdate:modelValue":e[20]||(e[20]=s=>J.value=s)},{default:r(()=>[a(o(Je),{class:"grid w-full grid-cols-6"},{default:r(()=>[a(o(B),{value:"informacion"},{default:r(()=>[...e[26]||(e[26]=[l("Información General",-1)])]),_:1}),a(o(B),{value:"fechas"},{default:r(()=>[...e[27]||(e[27]=[l("Fechas y Estado",-1)])]),_:1}),a(o(B),{value:"financiero"},{default:r(()=>[...e[28]||(e[28]=[l("Información Financiera",-1)])]),_:1}),a(o(B),{value:"contraparte"},{default:r(()=>[...e[29]||(e[29]=[l("Contraparte",-1)])]),_:1}),a(o(B),{value:"archivos"},{default:r(()=>[e[30]||(e[30]=l(" Archivos ",-1)),z.value.length>0?(p(),m("span",uo,f(z.value.length),1)):_("",!0)]),_:1}),a(o(B),{value:"adicional"},{default:r(()=>[...e[31]||(e[31]=[l("Información Adicional",-1)])]),_:1})]),_:1}),a(o(R),{value:"informacion"},{default:r(()=>[a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[32]||(e[32]=[l("Información General",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[33]||(e[33]=[l("Datos principales del contrato",-1)])]),_:1})]),_:1}),a(o(k),{class:"space-y-4"},{default:r(()=>[n("div",po,[n("div",null,[a(o(b),{for:"proyecto_id"},{default:r(()=>[...e[34]||(e[34]=[l("Proyecto *",-1)])]),_:1}),a(o(T),{modelValue:o(t).proyecto_id,"onUpdate:modelValue":e[0]||(e[0]=s=>o(t).proyecto_id=s),disabled:!!c.proyecto},{default:r(()=>[a(o(L),null,{default:r(()=>[a(o(q),{placeholder:"Seleccione un proyecto"})]),_:1}),a(o(G),null,{default:r(()=>[(p(!0),m(D,null,j(oe.proyectos,s=>(p(),A(o(h),{key:s.id,value:s.id.toString()},{default:r(()=>[l(f(s.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),o(t).errors.proyecto_id?(p(),m("div",mo,f(o(t).errors.proyecto_id),1)):_("",!0)]),n("div",null,[a(o(b),{for:"nombre"},{default:r(()=>[...e[35]||(e[35]=[l("Nombre del Contrato *",-1)])]),_:1}),a(o(w),{id:"nombre",modelValue:o(t).nombre,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).nombre=s),placeholder:"Ej: Contrato de servicios de consultoría"},null,8,["modelValue"]),o(t).errors.nombre?(p(),m("div",co,f(o(t).errors.nombre),1)):_("",!0)])]),n("div",null,[a(o(b),{for:"descripcion"},{default:r(()=>[...e[36]||(e[36]=[l("Descripción",-1)])]),_:1}),a(o(ue),{id:"descripcion",modelValue:o(t).descripcion,"onUpdate:modelValue":e[2]||(e[2]=s=>o(t).descripcion=s),placeholder:"Descripción detallada del contrato...",rows:"4"},null,8,["modelValue"]),o(t).errors.descripcion?(p(),m("div",fo,f(o(t).errors.descripcion),1)):_("",!0)]),I.value.informacion.length>0?(p(),m("div",_o,[e[37]||(e[37]=n("h3",{class:"font-medium"},"Información Complementaria",-1)),(p(!0),m(D,null,j(I.value.informacion,s=>(p(),m("div",{key:s.id},[a(Y,{campo:s,modelValue:o(t).campos_personalizados[s.id],"onUpdate:modelValue":u=>o(t).campos_personalizados[s.id]=u},null,8,["campo","modelValue","onUpdate:modelValue"])]))),128))])):_("",!0)]),_:1})]),_:1})]),_:1}),a(o(R),{value:"fechas"},{default:r(()=>[a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[38]||(e[38]=[l("Fechas y Estado",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[39]||(e[39]=[l("Configure las fechas y el estado del contrato",-1)])]),_:1})]),_:1}),a(o(k),{class:"space-y-4"},{default:r(()=>[n("div",vo,[n("div",null,[a(o(b),{for:"fecha_inicio"},{default:r(()=>[...e[40]||(e[40]=[l("Fecha de Inicio *",-1)])]),_:1}),a(o(w),{id:"fecha_inicio",type:"date",modelValue:o(t).fecha_inicio,"onUpdate:modelValue":e[3]||(e[3]=s=>o(t).fecha_inicio=s)},null,8,["modelValue"]),o(t).errors.fecha_inicio?(p(),m("div",bo,f(o(t).errors.fecha_inicio),1)):_("",!0)]),n("div",null,[a(o(b),{for:"fecha_fin"},{default:r(()=>[...e[41]||(e[41]=[l("Fecha de Fin",-1)])]),_:1}),a(o(w),{id:"fecha_fin",type:"date",modelValue:o(t).fecha_fin,"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).fecha_fin=s)},null,8,["modelValue"]),o(t).errors.fecha_fin?(p(),m("div",go,f(o(t).errors.fecha_fin),1)):_("",!0)]),n("div",null,[a(o(b),{for:"estado"},{default:r(()=>[...e[42]||(e[42]=[l("Estado",-1)])]),_:1}),a(o(T),{modelValue:o(t).estado,"onUpdate:modelValue":e[5]||(e[5]=s=>o(t).estado=s)},{default:r(()=>[a(o(L),null,{default:r(()=>[a(o(q))]),_:1}),a(o(G),null,{default:r(()=>[a(o(h),{value:"borrador"},{default:r(()=>[...e[43]||(e[43]=[l("Borrador",-1)])]),_:1}),a(o(h),{value:"activo"},{default:r(()=>[...e[44]||(e[44]=[l("Activo",-1)])]),_:1}),a(o(h),{value:"finalizado"},{default:r(()=>[...e[45]||(e[45]=[l("Finalizado",-1)])]),_:1}),a(o(h),{value:"cancelado"},{default:r(()=>[...e[46]||(e[46]=[l("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(t).errors.estado?(p(),m("div",ho,f(o(t).errors.estado),1)):_("",!0)]),n("div",null,[a(o(b),{for:"tipo"},{default:r(()=>[...e[47]||(e[47]=[l("Tipo de Contrato *",-1)])]),_:1}),a(o(T),{modelValue:o(t).tipo,"onUpdate:modelValue":e[6]||(e[6]=s=>o(t).tipo=s)},{default:r(()=>[a(o(L),null,{default:r(()=>[a(o(q))]),_:1}),a(o(G),null,{default:r(()=>[a(o(h),{value:"servicio"},{default:r(()=>[...e[48]||(e[48]=[l("Servicio",-1)])]),_:1}),a(o(h),{value:"obra"},{default:r(()=>[...e[49]||(e[49]=[l("Obra",-1)])]),_:1}),a(o(h),{value:"suministro"},{default:r(()=>[...e[50]||(e[50]=[l("Suministro",-1)])]),_:1}),a(o(h),{value:"consultoria"},{default:r(()=>[...e[51]||(e[51]=[l("Consultoría",-1)])]),_:1}),a(o(h),{value:"otro"},{default:r(()=>[...e[52]||(e[52]=[l("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(t).errors.tipo?(p(),m("div",yo,f(o(t).errors.tipo),1)):_("",!0)])]),n("div",null,[a(o(b),{for:"responsable_id"},{default:r(()=>[...e[53]||(e[53]=[l("Responsable",-1)])]),_:1}),e[54]||(e[54]=n("p",{class:"text-sm text-muted-foreground mb-2"}," Asigna un usuario responsable de este contrato ",-1)),V.value?(p(),m("div",xo,[n("div",null,[n("p",Vo,f(V.value.name),1),n("p",Co,f(V.value.email),1)]),a(o(x),{type:"button",variant:"ghost",size:"sm",onClick:e[7]||(e[7]=s=>{V.value=null,o(t).responsable_id="none"})},{default:r(()=>[a(o(ee),{class:"h-4 w-4"})]),_:1})])):_("",!0),a(o(x),{type:"button",variant:"outline",onClick:e[8]||(e[8]=s=>W.value=!0),class:"w-full"},{default:r(()=>[a(o(me),{class:"h-4 w-4 mr-2"}),l(" "+f(V.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})])]),_:1})]),_:1})]),_:1}),a(o(R),{value:"financiero"},{default:r(()=>[a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[55]||(e[55]=[l("Información Financiera",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[56]||(e[56]=[l("Montos y detalles financieros del contrato",-1)])]),_:1})]),_:1}),a(o(k),{class:"space-y-4"},{default:r(()=>[n("div",So,[n("div",null,[a(o(b),{for:"monto_total"},{default:r(()=>[...e[57]||(e[57]=[l("Monto Total",-1)])]),_:1}),a(o(w),{id:"monto_total",type:"number",step:"0.01",modelValue:o(t).monto_total,"onUpdate:modelValue":e[9]||(e[9]=s=>o(t).monto_total=s),placeholder:"0.00"},null,8,["modelValue"]),o(t).errors.monto_total?(p(),m("div",Uo,f(o(t).errors.monto_total),1)):_("",!0)]),n("div",null,[a(o(b),{for:"moneda"},{default:r(()=>[...e[58]||(e[58]=[l("Moneda",-1)])]),_:1}),a(o(T),{modelValue:o(t).moneda,"onUpdate:modelValue":e[10]||(e[10]=s=>o(t).moneda=s)},{default:r(()=>[a(o(L),null,{default:r(()=>[a(o(q))]),_:1}),a(o(G),null,{default:r(()=>[(p(),m(D,null,j(Ce,s=>a(o(h),{key:s.value,value:s.value},{default:r(()=>[l(f(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"]),o(t).errors.moneda?(p(),m("div",ko,f(o(t).errors.moneda),1)):_("",!0)])]),I.value.financiero.length>0?(p(),m("div",$o,[e[59]||(e[59]=n("h3",{class:"font-medium"},"Campos Financieros Personalizados",-1)),(p(!0),m(D,null,j(I.value.financiero,s=>(p(),m("div",{key:s.id},[a(Y,{campo:s,modelValue:o(t).campos_personalizados[s.id],"onUpdate:modelValue":u=>o(t).campos_personalizados[s.id]=u},null,8,["campo","modelValue","onUpdate:modelValue"])]))),128))])):_("",!0)]),_:1})]),_:1})]),_:1}),a(o(R),{value:"contraparte"},{default:r(()=>[n("div",wo,[a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[60]||(e[60]=[l("Contraparte - Usuario del Sistema",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[61]||(e[61]=[l(" Seleccione un usuario del sistema como contraparte del contrato ",-1)])]),_:1})]),_:1}),a(o(k),null,{default:r(()=>[n("div",Eo,[n("div",null,[a(o(b),null,{default:r(()=>[...e[62]||(e[62]=[l("Usuario Contraparte",-1)])]),_:1}),e[63]||(e[63]=n("p",{class:"text-sm text-muted-foreground mb-2"}," Si la contraparte es un usuario registrado en el sistema, selecciónelo aquí ",-1))]),F.value?(p(),m("div",Ao,[n("div",null,[n("p",Po,f(F.value.name),1),n("p",zo,f(F.value.email),1)]),a(o(x),{type:"button",variant:"ghost",size:"sm",onClick:e[11]||(e[11]=s=>{o(t).contraparte_user_id=null,o(t).contraparte_nombre="",o(t).contraparte_email="",F.value=null})},{default:r(()=>[a(o(ee),{class:"h-4 w-4"})]),_:1})])):_("",!0),a(o(x),{type:"button",variant:"outline",onClick:e[12]||(e[12]=s=>X.value=!0),class:"w-full"},{default:r(()=>[a(o(me),{class:"h-4 w-4 mr-2"}),l(" "+f(F.value?"Cambiar Contraparte":"Seleccionar Contraparte"),1)]),_:1})])]),_:1})]),_:1}),a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[64]||(e[64]=[l("Contraparte - Información Externa",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[65]||(e[65]=[l(" Complete estos campos si la contraparte no es un usuario del sistema ",-1)])]),_:1})]),_:1}),a(o(k),{class:"space-y-4"},{default:r(()=>[o(t).contraparte_user_id?(p(),A(o(Le),{key:0,class:"mb-4"},{default:r(()=>[a(o(pe),{class:"h-4 w-4"}),a(o(qe),null,{default:r(()=>[...e[66]||(e[66]=[l(" Los campos de contraparte externa están deshabilitados porque ya se seleccionó un usuario del sistema. ",-1)])]),_:1})]),_:1})):_("",!0),n("div",Fo,[n("div",null,[a(o(b),{for:"contraparte_nombre"},{default:r(()=>[...e[67]||(e[67]=[l("Nombre de la Contraparte",-1)])]),_:1}),a(o(w),{id:"contraparte_nombre",modelValue:o(t).contraparte_nombre,"onUpdate:modelValue":e[13]||(e[13]=s=>o(t).contraparte_nombre=s),placeholder:"Nombre de la empresa o persona",disabled:!!o(t).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[a(o(b),{for:"contraparte_identificacion"},{default:r(()=>[...e[68]||(e[68]=[l("Identificación/RUC",-1)])]),_:1}),a(o(w),{id:"contraparte_identificacion",modelValue:o(t).contraparte_identificacion,"onUpdate:modelValue":e[14]||(e[14]=s=>o(t).contraparte_identificacion=s),placeholder:"Número de identificación",disabled:!!o(t).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[a(o(b),{for:"contraparte_email"},{default:r(()=>[...e[69]||(e[69]=[l("Email de Contacto",-1)])]),_:1}),a(o(w),{id:"contraparte_email",type:"email",modelValue:o(t).contraparte_email,"onUpdate:modelValue":e[15]||(e[15]=s=>o(t).contraparte_email=s),placeholder:"email@ejemplo.com",disabled:!!o(t).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[a(o(b),{for:"contraparte_telefono"},{default:r(()=>[...e[70]||(e[70]=[l("Teléfono de Contacto",-1)])]),_:1}),a(o(w),{id:"contraparte_telefono",modelValue:o(t).contraparte_telefono,"onUpdate:modelValue":e[16]||(e[16]=s=>o(t).contraparte_telefono=s),placeholder:"+1234567890",disabled:!!o(t).contraparte_user_id},null,8,["modelValue","disabled"])])])]),_:1})]),_:1}),a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[71]||(e[71]=[l("Participantes del Contrato",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[72]||(e[72]=[l(" Agregue usuarios del sistema que participarán en este contrato con diferentes roles ",-1)])]),_:1})]),_:1}),a(o(k),null,{default:r(()=>[n("div",Io,[a(o(x),{type:"button",variant:"outline",onClick:e[17]||(e[17]=s=>K.value=!0),class:"w-full"},{default:r(()=>[a(o(ce),{class:"h-4 w-4 mr-2"}),e[73]||(e[73]=l(" Agregar Participantes ",-1))]),_:1}),o(t).participantes.length>0?(p(),m("div",No,[e[74]||(e[74]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Participantes agregados:",-1)),(p(!0),m(D,null,j(o(t).participantes,s=>{var u,v;return p(),m("div",{key:s.user_id,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[n("div",Do,[n("div",null,[n("p",jo,f((u=le(s.user_id))==null?void 0:u.name),1),n("p",Bo,f((v=le(s.user_id))==null?void 0:v.email),1),n("div",Ro,[n("span",Oo,f(s.rol),1),s.notas?(p(),m("span",Mo,f(s.notas),1)):_("",!0)])]),a(o(x),{type:"button",variant:"ghost",size:"sm",onClick:N=>Ae(s.user_id)},{default:r(()=>[a(o(ee),{class:"h-4 w-4"})]),_:1},8,["onClick"])])])}),128))])):(p(),m("div",To,[a(o(ce),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),e[75]||(e[75]=n("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))]))])]),_:1})]),_:1})])]),_:1}),a(o(R),{value:"archivos"},{default:r(()=>[a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[76]||(e[76]=[l("Archivos del Contrato",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[77]||(e[77]=[l("Sube múltiples archivos relacionados con el contrato (máximo 10)",-1)])]),_:1})]),_:1}),a(o(k),null,{default:r(()=>[a(He,{modelValue:P.value,"onUpdate:modelValue":e[18]||(e[18]=s=>P.value=s),label:"Archivos",description:"Sube archivos del contrato (PDF, imágenes, documentos)",onFilesSelected:Ue,multiple:!0,maxFiles:10,maxFileSize:10,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.xls,.xlsx",autoUpload:!1,module:"contratos",fieldId:"archivos"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(o(R),{value:"adicional"},{default:r(()=>[a(o(C),null,{default:r(()=>[a(o(S),null,{default:r(()=>[a(o(U),null,{default:r(()=>[...e[78]||(e[78]=[l("Información Adicional",-1)])]),_:1}),a(o($),null,{default:r(()=>[...e[79]||(e[79]=[l("Observaciones y campos personalizados",-1)])]),_:1})]),_:1}),a(o(k),{class:"space-y-4"},{default:r(()=>[n("div",null,[a(o(b),{for:"observaciones"},{default:r(()=>[...e[80]||(e[80]=[l("Observaciones",-1)])]),_:1}),a(o(ue),{id:"observaciones",modelValue:o(t).observaciones,"onUpdate:modelValue":e[19]||(e[19]=s=>o(t).observaciones=s),placeholder:"Notas u observaciones adicionales...",rows:"4"},null,8,["modelValue"]),o(t).errors.observaciones?(p(),m("div",Lo,f(o(t).errors.observaciones),1)):_("",!0)]),I.value.otros.length>0?(p(),m("div",qo,[e[81]||(e[81]=n("h3",{class:"font-medium"},"Campos Personalizados",-1)),(p(!0),m(D,null,j(I.value.otros,s=>(p(),m("div",{key:s.id},[a(Y,{campo:s,modelValue:o(t).campos_personalizados[s.id],"onUpdate:modelValue":u=>o(t).campos_personalizados[s.id]=u},null,8,["campo","modelValue","onUpdate:modelValue"])]))),128))])):_("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",Go,[c.borrador?(p(),A(o(x),{key:0,variant:"destructive",type:"button",onClick:Fe,disabled:o(t).processing},{default:r(()=>[a(o(eo),{class:"h-4 w-4 mr-2"}),e[82]||(e[82]=l(" Descartar Borrador ",-1))]),_:1},8,["disabled"])):(p(),m("div",Jo)),n("div",Xo,[a(o(x),{type:"button",variant:"outline",onClick:ze,disabled:o(t).processing},{default:r(()=>[...e[83]||(e[83]=[l(" Cancelar ",-1)])]),_:1},8,["disabled"]),a(o(x),{type:"submit",disabled:o(t).processing},{default:r(()=>[a(o(oo),{class:"h-4 w-4 mr-2"}),l(" "+f(o(t).processing?"Guardando...":"Guardar Contrato"),1)]),_:1},8,["disabled"])])])],32)]),n("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:Se,class:"hidden"},null,544),a(Z,{modelValue:X.value,"onUpdate:modelValue":e[21]||(e[21]=s=>X.value=s),title:"Seleccionar Contraparte",description:"Selecciona el usuario que será la contraparte del contrato","search-endpoint":o(E)("admin.proyectos.search-users"),"excluded-ids":o(t).contraparte_user_id?[o(t).contraparte_user_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Contraparte","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:$e},null,8,["modelValue","search-endpoint","excluded-ids"]),a(Z,{modelValue:K.value,"onUpdate:modelValue":e[22]||(e[22]=s=>K.value=s),title:"Agregar Participantes",description:"Selecciona los usuarios que participarán en este contrato y define su rol","search-endpoint":o(E)("admin.proyectos.search-users"),"excluded-ids":ge.value,"extra-fields":be.value,"submit-button-text":"Agregar Participantes","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:Ee},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"]),a(Z,{modelValue:W.value,"onUpdate:modelValue":e[23]||(e[23]=s=>W.value=s),title:"Seleccionar Responsable",description:"Selecciona el usuario que será responsable de este contrato","search-endpoint":o(E)("admin.proyectos.search-users"),"excluded-ids":V.value?[V.value.id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:we},null,8,["modelValue","search-endpoint","excluded-ids"])]}),_:1}))}});export{ba as default};
