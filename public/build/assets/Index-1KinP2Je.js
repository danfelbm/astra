import{d as N,i as m,e,w as o,f as t,h as d,F as Z,k as tt,g as n,m as r,b,j as u,y as et,v as J,t as y,r as A,c as q,s as $,n as H}from"./app-FZoHOgaH.js";import{_ as ot}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BMnM7jZE.js";import{c as st,_ as x}from"./createLucideIcon-pi43BedF.js";import{_ as z,c as B,a as at,b as it}from"./CardTitle.vue_vue_type_script_setup_true_lang-djiwawAA.js";import{O as lt}from"./ObligacionTree-DD-DWcpp.js";import{_ as G}from"./index-B8DuVZ6-.js";import{a as nt,b as Q,c as E,d as rt,_ as ct,e as V}from"./TableHeader.vue_vue_type_script_setup_true_lang-B8pSMG1P.js";import{u as K}from"./usePermissions--nnq2hKn.js";import{C as dt}from"./circle-alert-C2ek-4S9.js";import{E as mt}from"./eye-BU_rTPjC.js";import{P as ut}from"./pencil-VIJCyoU0.js";import{T as ft}from"./trash-2-uQ-v_aYU.js";import{_ as pt}from"./Input.vue_vue_type_script_setup_true_lang-BEgEQ1Ma.js";import{_ as X}from"./Label.vue_vue_type_script_setup_true_lang-waJVfnmL.js";import{_ as vt}from"./AddContratosModal.vue_vue_type_script_setup_true_lang-Du8NDh-n.js";import{S as gt}from"./search-CSHDnqRM.js";import{F as D}from"./file-text-C7Yp1Ly8.js";import{X as T}from"./x-Bg3XxnFA.js";import{_ as bt}from"./Pagination.vue_vue_type_script_setup_true_lang-DjfstFM1.js";import{t as I}from"./index-CvxOO9P_.js";import{l as xt}from"./lodash-DdJWEkOP.js";import{D as ht}from"./download-OnXi1Gpt.js";import{P as yt}from"./plus-DIWpweCj.js";import{T as _t}from"./tree-pine-Bk4IQ43g.js";import{L as kt}from"./list-ZpQp6T7L.js";import"./useFlashMessages-Bm7N6KRp.js";import"./index-axiiZVyU.js";import"./floating-ui.vue-C3D9D25A.js";import"./index-ybiiC-LH.js";import"./shield-Dq12MYkj.js";import"./user-CPzkR__l.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BUkxjj6a.js";import"./chevron-right-BmPlSaC-.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CuJ5linQ.js";import"./VisuallyHidden-Dbnz2TNK.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Bm5Gj1mI.js";import"./index-Cc-BeIiM.js";import"./check-D8MJB2af.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CIHwSdjR.js";import"./map-pin-DMngM3dy.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-BiptSxHd.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DbGRc_BL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-Da_6ahJg.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DA-dsnb1.js";import"./tag-uDee8c9E.js";import"./users-D06yuiCC.js";import"./target-ChjALuOe.js";import"./vote-Guhs9Ix2.js";import"./folder-open-CyZnsmsD.js";import"./send-B68USuYn.js";import"./briefcase-C7xhbZjB.js";import"./calendar-tvCvxrpC.js";import"./megaphone-Bf3YxDyR.js";import"./user-check-D5fucGr0.js";import"./clipboard-list-CmSzLpIl.js";import"./mail-BOH-fMhV.js";import"./message-square-CiGRX4EB.js";import"./external-link-M3oE2-QG.js";import"./panel-left-DxDlnwDZ.js";import"./index-Bpcp85lZ.js";import"./Separator.vue_vue_type_script_setup_true_lang-DAY9Myhx.js";import"./circle-ColgQmTg.js";import"./layers-D3jAcUEw.js";import"./paperclip-D4eGl2to.js";import"./loader-circle-CVL0aAJ-.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Ck6NxbaQ.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BJpWr-JC.js";import"./index-DJoFS3H9.js";import"./useKbd-kRIii9yh.js";import"./utils-DZWDk1Lp.js";import"./VisuallyHiddenInput-C4IojIA_.js";import"./contratos-BiUTbrRP.js";import"./chevron-left-C0qEKhAp.js";import"./es-BDPlFIsO.js";import"./parseISO-DFjB8F03.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=st("CornerDownRightIcon",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),$t={key:0},Ct={class:"flex items-center"},St={class:"text-sm text-gray-600"},Ft={key:0,class:"text-sm"},Ot={key:1,class:"text-sm text-gray-400"},jt={class:"flex items-center justify-end gap-1"},Et={key:1,class:"text-center py-8 text-gray-500"},Vt=N({__name:"ObligacionTable",props:{obligaciones:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1}},emits:["view","edit","delete"],setup(s,{emit:g}){const _=g,{hasPermission:f}=K();return(h,a)=>(r(),m("div",null,[s.obligaciones&&s.obligaciones.length>0?(r(),m("div",$t,[e(t(ct),null,{default:o(()=>[e(t(nt),null,{default:o(()=>[e(t(Q),null,{default:o(()=>[e(t(E),null,{default:o(()=>[...a[0]||(a[0]=[d("Título",-1)])]),_:1}),e(t(E),null,{default:o(()=>[...a[1]||(a[1]=[d("Descripción",-1)])]),_:1}),e(t(E),null,{default:o(()=>[...a[2]||(a[2]=[d("Archivos",-1)])]),_:1}),e(t(E),{class:"text-right"},{default:o(()=>[...a[3]||(a[3]=[d("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(rt),null,{default:o(()=>[(r(!0),m(Z,null,tt(s.obligaciones,i=>(r(),b(t(Q),{key:i.id},{default:o(()=>[e(t(V),{class:"font-medium"},{default:o(()=>[n("div",Ct,[i.nivel>0?(r(),m("span",{key:0,class:"flex items-center text-muted-foreground mr-2",style:et({paddingLeft:`${(i.nivel-1)*12}px`})},[e(t(wt),{class:"h-4 w-4"})],4)):u("",!0),n("div",null,[e(t(J),{href:`/admin/obligaciones/${i.id}`,class:"hover:text-blue-600 hover:underline"},{default:o(()=>[d(y(i.titulo),1)]),_:2},1032,["href"]),i.padre?(r(),b(t(G),{key:0,variant:"secondary",class:"ml-2 text-xs"},{default:o(()=>[...a[4]||(a[4]=[d(" Hija ",-1)])]),_:1})):u("",!0),i.tiene_hijos?(r(),b(t(G),{key:1,variant:"outline",class:"ml-1 text-xs"},{default:o(()=>[d(y(i.total_hijos)+" hijos ",1)]),_:2},1024)):u("",!0)])])]),_:2},1024),e(t(V),null,{default:o(()=>[n("span",St,y(i.descripcion?i.descripcion.length>100?i.descripcion.substring(0,100)+"...":i.descripcion:"Sin descripción"),1)]),_:2},1024),e(t(V),null,{default:o(()=>{var k;return[(k=i.archivos_adjuntos)!=null&&k.length?(r(),m("span",Ft,y(i.archivos_adjuntos.length)+" archivo(s) ",1)):(r(),m("span",Ot,"Sin archivos"))]}),_:2},1024),e(t(V),{class:"text-right"},{default:o(()=>[n("div",jt,[e(t(x),{variant:"ghost",size:"sm",class:"h-8 px-2",onClick:k=>_("view",i)},{default:o(()=>[e(t(mt),{class:"h-4 w-4 mr-1"}),a[5]||(a[5]=d(" Ver ",-1))]),_:1},8,["onClick"]),s.canEdit||t(f)("obligaciones.edit")?(r(),b(t(x),{key:0,variant:"ghost",size:"sm",class:"h-8 px-2",onClick:k=>_("edit",i)},{default:o(()=>[e(t(ut),{class:"h-4 w-4 mr-1"}),a[6]||(a[6]=d(" Editar ",-1))]),_:1},8,["onClick"])):u("",!0),s.canDelete||t(f)("obligaciones.delete")?(r(),b(t(x),{key:1,variant:"ghost",size:"sm",class:"h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:k=>_("delete",i)},{default:o(()=>[e(t(ft),{class:"h-4 w-4 mr-1"}),a[7]||(a[7]=d(" Eliminar ",-1))]),_:1},8,["onClick"])):u("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(r(),m("div",Et,[e(t(dt),{class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),a[8]||(a[8]=n("p",null,"No se encontraron obligaciones",-1)),a[9]||(a[9]=n("p",{class:"text-sm mt-1"},"Crea una nueva obligación para comenzar",-1))]))]))}}),zt={class:"flex flex-col sm:flex-row gap-4"},Bt={class:"flex-1"},Dt={class:"relative"},Tt={key:0,class:"w-full sm:w-auto"},At={key:0,class:"flex items-center gap-2 px-3 py-2 bg-muted rounded-lg"},Lt={class:"flex-1 min-w-0"},Pt={class:"font-medium text-sm truncate"},It={key:0,class:"text-xs text-muted-foreground truncate"},Nt={key:1,class:"flex items-center gap-2 px-3 py-2 bg-muted rounded-lg"},Mt={class:"flex-1 min-w-0"},Rt={class:"font-medium text-sm"},Ut=N({__name:"ObligacionFilters",props:{modelValue:{},proyectos:{default:()=>[]},loading:{type:Boolean,default:!1},showContratoFilter:{type:Boolean,default:!0},contratoSeleccionado:{default:null}},emits:["update:modelValue","update:contratoSeleccionado","filter","clear"],setup(s,{emit:g}){const _=s,f=g,h=A(!1),a=A(_.contratoSeleccionado),i=q({get:()=>_.modelValue,set:p=>f("update:modelValue",p)}),k=q(()=>i.value.search||_.showContratoFilter&&i.value.contrato_id),L=p=>{i.value={...i.value,search:p},f("filter")},P=p=>{p.contratoIds.length>0&&(i.value={...i.value,contrato_id:p.contratoIds[0]},p.contratos&&p.contratos.length>0&&(a.value=p.contratos[0],f("update:contratoSeleccionado",p.contratos[0])),f("filter"))},S=()=>{i.value={...i.value,contrato_id:null},a.value=null,f("update:contratoSeleccionado",null),f("filter")},F=()=>{i.value={search:"",contrato_id:null},a.value=null,f("update:contratoSeleccionado",null),f("clear")};return(p,v)=>(r(),b(t(z),null,{default:o(()=>[e(t(B),{class:"pt-6"},{default:o(()=>[n("div",zt,[n("div",Bt,[e(t(X),{for:"search",class:"sr-only"},{default:o(()=>[...v[2]||(v[2]=[d("Buscar",-1)])]),_:1}),n("div",Dt,[e(t(gt),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e(t(pt),{id:"search","model-value":i.value.search,type:"text",placeholder:"Buscar por título o descripción...",class:"pl-10",disabled:s.loading,"onUpdate:modelValue":L},null,8,["model-value","disabled"])])]),s.showContratoFilter?(r(),m("div",Tt,[e(t(X),{for:"contrato_filter",class:"sr-only"},{default:o(()=>[...v[3]||(v[3]=[d("Contrato",-1)])]),_:1}),a.value?(r(),m("div",At,[e(t(D),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),n("div",Lt,[n("p",Pt,y(a.value.nombre),1),a.value.proyecto?(r(),m("p",It,y(a.value.proyecto.nombre),1)):u("",!0)]),e(t(x),{type:"button",variant:"ghost",size:"sm",class:"h-6 w-6 p-0 flex-shrink-0",onClick:S},{default:o(()=>[e(t(T),{class:"h-4 w-4"})]),_:1})])):i.value.contrato_id?(r(),m("div",Nt,[e(t(D),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),n("div",Mt,[n("p",Rt,"Contrato #"+y(i.value.contrato_id),1),v[4]||(v[4]=n("p",{class:"text-xs text-muted-foreground"},"Filtro activo",-1))]),e(t(x),{type:"button",variant:"ghost",size:"sm",class:"h-6 w-6 p-0 flex-shrink-0",onClick:S},{default:o(()=>[e(t(T),{class:"h-4 w-4"})]),_:1})])):(r(),b(t(x),{key:2,type:"button",variant:"outline",onClick:v[0]||(v[0]=O=>h.value=!0),disabled:s.loading,class:"w-full sm:w-auto"},{default:o(()=>[e(t(D),{class:"h-4 w-4 mr-2"}),v[5]||(v[5]=d(" Filtrar por Contrato ",-1))]),_:1},8,["disabled"])),e(vt,{modelValue:h.value,"onUpdate:modelValue":v[1]||(v[1]=O=>h.value=O),title:"Filtrar por Contrato",description:"Selecciona el contrato para filtrar las obligaciones","search-endpoint":"/admin/contratos/search",proyectos:s.proyectos,"excluded-ids":[],"max-selection":1,"submit-button-text":"Aplicar Filtro",onSubmit:P},null,8,["modelValue","proyectos"])])):u("",!0),k.value?(r(),b(t(x),{key:1,variant:"ghost",size:"icon",disabled:s.loading,onClick:F,title:"Limpiar filtros"},{default:o(()=>[e(t(T),{class:"h-4 w-4"})]),_:1},8,["disabled"])):u("",!0)])]),_:1})]),_:1}))}}),qt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ht={class:"flex items-center justify-between"},Gt={class:"text-3xl font-bold"},Qt={key:0,class:"text-sm text-gray-600"},Xt={class:"flex items-center gap-2"},Jt={class:"flex items-center justify-between"},Kt={class:"flex items-center gap-2"},Wt={class:"text-sm text-blue-800"},Yt={class:"font-medium"},Zt={key:0,class:"text-blue-600"},te={class:"text-2xl font-bold"},ee={class:"flex items-center justify-between"},oe={class:"flex items-center gap-2"},se={key:0},ae={key:1},ie={key:0,class:"mt-4 flex justify-center"},jo=N({__name:"Index",props:{obligaciones:{},estadisticas:{},filters:{},contrato:{},proyectos:{},estadisticasResponsables:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canExport:{type:Boolean}},setup(s){var M,R,U;const g=s,_=g.contrato?[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:g.contrato.nombre,href:`/admin/contratos/${g.contrato.id}`},{title:"Obligaciones",href:"#"}]:[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"}],{hasPermission:f}=K(),h=A("tabla"),a=A({search:((M=g.filters)==null?void 0:M.search)||"",contrato_id:((R=g.filters)==null?void 0:R.contrato_id)||((U=g.contrato)==null?void 0:U.id)||null}),i=xt.debounce(()=>{$.get(route("admin.obligaciones.index"),a.value,{preserveState:!0,preserveScroll:!0})},300),k=()=>{var c;a.value={search:"",contrato_id:((c=g.contrato)==null?void 0:c.id)||null},i()},L=()=>{$.get(route("admin.obligaciones.index"),{search:a.value.search},{preserveState:!1})},P=()=>{var c;$.visit(route("admin.obligaciones.create",{contrato_id:(c=g.contrato)==null?void 0:c.id}))},S=c=>{$.visit(route("admin.obligaciones.show",c.id))},F=c=>{$.visit(route("admin.obligaciones.edit",c.id))},p=c=>{const l=c.tiene_hijos?`¿Estás seguro de eliminar "${c.titulo}" y todas sus obligaciones hijas?`:`¿Estás seguro de eliminar "${c.titulo}"?`;confirm(l)&&$.delete(route("admin.obligaciones.destroy",c.id),{preserveScroll:!0,onSuccess:()=>{I.success("Obligación eliminada exitosamente")}})},v=c=>{$.post(route("admin.obligaciones.completar",c.id),{},{preserveScroll:!0,onSuccess:()=>{I.success("Obligación marcada como cumplida")}})},O=c=>{$.visit(route("admin.obligaciones.create",{contrato_id:c.contrato_id,parent_id:c.id}))},W=(c,l,j)=>{$.post(route("admin.obligaciones.mover",c.id),{nuevo_parent_id:l,nuevo_orden:j},{preserveScroll:!0,onSuccess:()=>{I.success("Obligación movida exitosamente")}})},Y=()=>{window.open(route("admin.obligaciones.exportar",a.value),"_blank")};return(c,l)=>(r(),b(ot,{breadcrumbs:t(_)},{default:o(()=>{var j;return[n("div",qt,[n("div",Ht,[n("div",null,[n("h1",Gt,[l[3]||(l[3]=d(" Obligaciones ",-1)),s.contrato?(r(),m("span",Qt," - "+y(s.contrato.nombre),1)):u("",!0)]),l[4]||(l[4]=n("p",{class:"text-gray-600 mt-1"},"Gestiona las obligaciones de los contratos",-1))]),n("div",Xt,[s.canExport||t(f)("obligaciones.export")?(r(),b(t(x),{key:0,variant:"outline",size:"sm",onClick:Y},{default:o(()=>[e(t(ht),{class:"h-4 w-4 mr-2"}),l[5]||(l[5]=d(" Exportar ",-1))]),_:1})):u("",!0),s.canCreate||t(f)("obligaciones.create")?(r(),b(t(J),{key:1,href:c.route("admin.obligaciones.create",{contrato_id:(j=s.contrato)==null?void 0:j.id})},{default:o(()=>[e(t(x),null,{default:o(()=>[e(t(yt),{class:"h-4 w-4 mr-2"}),l[6]||(l[6]=d(" Nueva Obligación ",-1))]),_:1})]),_:1},8,["href"])):u("",!0)])]),s.contrato?(r(),b(t(z),{key:0,class:"border-blue-200 bg-blue-50"},{default:o(()=>[e(t(B),{class:"py-3"},{default:o(()=>[n("div",Jt,[n("div",Kt,[e(t(D),{class:"h-4 w-4 text-blue-600"}),n("span",Wt,[l[7]||(l[7]=d(" Filtrando por contrato: ",-1)),n("span",Yt,y(s.contrato.nombre),1),s.contrato.proyecto?(r(),m("span",Zt," ("+y(s.contrato.proyecto.nombre)+")",1)):u("",!0)])]),e(t(x),{variant:"ghost",size:"sm",class:"h-8 text-blue-700 hover:text-blue-900 hover:bg-blue-100",onClick:L},{default:o(()=>[e(t(T),{class:"h-4 w-4 mr-1"}),l[8]||(l[8]=d(" Quitar filtro ",-1))]),_:1})])]),_:1})]),_:1})):u("",!0),e(Ut,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=w=>a.value=w),proyectos:s.proyectos||[],"show-contrato-filter":!s.contrato,onFilter:t(i),onClear:k},null,8,["modelValue","proyectos","show-contrato-filter","onFilter"]),e(t(z),null,{default:o(()=>[e(t(B),{class:"pt-6"},{default:o(()=>{var w,C;return[n("div",te,y(((C=(w=s.obligaciones)==null?void 0:w.data)==null?void 0:C.length)||0),1),l[9]||(l[9]=n("p",{class:"text-sm text-gray-600"},"Total Obligaciones",-1))]}),_:1})]),_:1}),e(t(z),{class:"flex-1"},{default:o(()=>[e(t(at),null,{default:o(()=>[n("div",ee,[e(t(it),null,{default:o(()=>[...l[10]||(l[10]=[d("Lista de Obligaciones",-1)])]),_:1}),n("div",oe,[e(t(x),{variant:"ghost",size:"sm",class:H({"bg-gray-100":h.value==="arbol"}),onClick:l[1]||(l[1]=w=>h.value="arbol")},{default:o(()=>[e(t(_t),{class:"h-4 w-4 mr-1"}),l[11]||(l[11]=d(" Árbol ",-1))]),_:1},8,["class"]),e(t(x),{variant:"ghost",size:"sm",class:H({"bg-gray-100":h.value==="tabla"}),onClick:l[2]||(l[2]=w=>h.value="tabla")},{default:o(()=>[e(t(kt),{class:"h-4 w-4 mr-1"}),l[12]||(l[12]=d(" Tabla ",-1))]),_:1},8,["class"])])])]),_:1}),e(t(B),null,{default:o(()=>{var w,C;return[h.value==="arbol"&&s.obligaciones.data&&s.obligaciones.data.length>0?(r(),m("div",se,[e(lt,{obligaciones:s.obligaciones.data,contratoId:(w=s.contrato)==null?void 0:w.id,editable:!0,onCreate:P,onEdit:F,onDelete:p,onComplete:v,onAddChild:O,onMove:W},null,8,["obligaciones","contratoId"])])):h.value==="tabla"?(r(),m("div",ae,[e(Vt,{obligaciones:s.obligaciones.data||[],"can-edit":s.canEdit,"can-delete":s.canDelete,onView:S,onEdit:F,onDelete:p},null,8,["obligaciones","can-edit","can-delete"]),s.obligaciones.links&&((C=s.obligaciones.data)!=null&&C.length)?(r(),m("div",ie,[e(bt,{links:s.obligaciones.links,meta:s.obligaciones.meta},null,8,["links","meta"])])):u("",!0)])):u("",!0)]}),_:1})]),_:1})])]}),_:1},8,["breadcrumbs"]))}});export{jo as default};
