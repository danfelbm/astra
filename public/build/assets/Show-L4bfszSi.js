import{_ as W}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CiEBtCld.js";import{d as J,r as X,b as $,e as d,w as l,f as e,g as o,u as t,p as G,t as r,h as n,n as K,P as k,i as u,j,F as D,k as E,W as R}from"./app-BxMQdeji.js";import{_ as x}from"./createLucideIcon-C-UWYrfi.js";import{_ as p,a as _,b as g,c}from"./CardTitle.vue_vue_type_script_setup_true_lang-BnCOEwdG.js";import{_ as T}from"./CardDescription.vue_vue_type_script_setup_true_lang-ToL2SzCT.js";import{_ as b}from"./index-BV26-s10.js";import{_ as Q,a as Y,b as N,c as h,d as Z,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-CXfuZCdx.js";import{_ as tt,a as et,b as st}from"./index-CniBkxSN.js";import{_ as lt,a as at,b as S,c as C}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-w_SIyey3.js";import{_ as ot}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DS8BXeGq.js";import{T as nt}from"./target-DGdssVnK.js";import{R as rt}from"./refresh-cw-ynvWF7VY.js";import{T as it}from"./trash-C03hX6rf.js";import{S as dt}from"./square-pen-CzbKDqjO.js";import{A as ut}from"./arrow-left-D5jKR-4B.js";import{U as mt}from"./users-CvN1Zex9.js";import{S as ft}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-HaYR--Vk.js";import{C as pt}from"./calendar-DgdSvpAx.js";import{H as _t}from"./hash-BQlYV7AQ.js";import{M as gt}from"./mail-DqZLMO2Y.js";import{U as ct}from"./user-y-oKgZ0r.js";import"./index-DyBffbvj.js";import"./floating-ui.vue-8MwpQwna.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-vmsnnBVQ.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-D23-rq2T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevron-right-Fu6i2V5H.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CwQxj27i.js";import"./chevrons-up-down-3z313Cuu.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CtZNhcn0.js";import"./tag-DPKMgGKR.js";import"./shield-BWgGyosQ.js";import"./vote-BLA5af_M.js";import"./folder-open-B7m9IzBm.js";import"./send-oS9jU0xl.js";import"./file-text-BnGFyr0l.js";import"./briefcase-WEKIfwBg.js";import"./megaphone-4hd08Cg7.js";import"./user-check-B_HPyobX.js";import"./message-square-DEtIPXL4.js";import"./external-link-B-I99Qkx.js";import"./panel-left-CpkWwX9C.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-C_cC4TmA.js";import"./VisuallyHidden-BU7kxpuH.js";import"./Input.vue_vue_type_script_setup_true_lang-BlmtfhYq.js";import"./index-gViH2lvq.js";import"./check-Df8aIUSG.js";import"./nullish-CHIgUVhi.js";import"./index-De6-LhcB.js";import"./index-uuqfgDZR.js";import"./RovingFocusItem-CUafydao.js";import"./utils-CDNySjiA.js";import"./x-CtZ-Yk1L.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-XGwxgqGh.js";import"./Label.vue_vue_type_script_setup_true_lang-Cv61jd0z.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Rc0j_Ts0.js";import"./circle-alert----6uGyB.js";import"./map-pin-BSO3mLrr.js";const vt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xt={class:"flex items-center justify-between"},yt={class:"flex items-center gap-4"},bt={class:"p-3 bg-primary/10 rounded-lg"},ht={class:"text-2xl font-bold tracking-tight"},wt={class:"flex items-center gap-2 mt-1"},$t={class:"flex gap-2"},kt={class:"grid gap-6 md:grid-cols-4"},St={class:"text-2xl font-bold"},Ct={class:"text-2xl font-bold"},jt={class:"text-sm font-bold"},Dt={class:"text-2xl font-bold"},Et={class:"flex items-center gap-3"},Tt={class:"font-medium"},Ut={class:"flex items-center gap-1"},At={class:"text-sm"},Rt={key:1,class:"text-center py-8 text-muted-foreground"},Nt={key:2,class:"mt-4 text-sm text-muted-foreground text-center"},Vt={key:0},Ft={class:"space-y-4"},Lt={class:"flex items-center justify-between"},Mt={class:"font-semibold"},Pt={class:"text-sm text-muted-foreground"},zt={key:1,class:"text-center py-8 text-muted-foreground"},Bt={key:0,class:"space-y-3"},qt={class:"font-semibold"},It={class:"text-sm text-muted-foreground"},Ot={key:1,class:"text-center py-8 text-muted-foreground"},Ht={class:"grid grid-cols-2 gap-4"},Wt={class:"text-sm font-mono"},Jt={class:"text-sm font-mono"},Xt={class:"text-sm"},Gt={class:"text-sm"},Kt={class:"text-sm"},Qt={key:0},Yt={class:"text-sm"},ls=J({__name:"Show",props:{segment:{},users:{},metadata:{},isPaginated:{type:Boolean}},setup(V){const v=V,F=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:v.segment.name,href:"#"}],y=X(!1),L=a=>a.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2),M=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),U=a=>new Date(a).toLocaleString("es-ES"),P=a=>a<60?`${a} segundos`:a<3600?`${Math.floor(a/60)} minutos`:`${Math.floor(a/3600)} horas`,z=a=>a.split("\\").pop()||a,B=a=>a!=null&&a.last_calculated_at?new Date(a.last_calculated_at).toLocaleString():"Nunca",q=async()=>{var a;y.value=!0;try{(await(await fetch(`/admin/segments/${v.segment.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""}})).json()).success&&R.reload()}catch(s){console.error("Error evaluating segment:",s)}finally{y.value=!1}},I=()=>{R.post(`/admin/segments/${v.segment.id}/clear-cache`)},A=()=>v.isPaginated?v.users:{data:v.users},O=a=>Array.isArray(a)?a.join(", "):typeof a=="object"&&a!==null?JSON.stringify(a):String(a),H=a=>{if(!a||typeof a!="object")return[];const s=[];for(const[i,m]of Object.entries(a))m!=null&&s.push({field:i,value:m});return s};return(a,s)=>(d(),$(W,{breadcrumbs:F},{default:l(()=>[e(t(G),{title:`Segmento: ${a.segment.name}`},null,8,["title"]),o("div",vt,[o("div",xt,[o("div",yt,[o("div",bt,[e(t(nt),{class:"h-8 w-8 text-primary"})]),o("div",null,[o("h2",ht,r(a.segment.name),1),o("div",wt,[e(t(b),{variant:a.segment.is_dynamic?"default":"secondary"},{default:l(()=>[n(r(a.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"]),e(t(b),{variant:"outline"},{default:l(()=>[n(r(z(a.segment.model_type)),1)]),_:1})])])]),o("div",$t,[e(t(x),{onClick:q,variant:"secondary",disabled:y.value},{default:l(()=>[e(t(rt),{class:K(["mr-2 h-4 w-4",{"animate-spin":y.value}])},null,8,["class"]),n(" "+r(y.value?"Evaluando...":"Recalcular"),1)]),_:1},8,["disabled"]),e(t(x),{onClick:I,variant:"ghost"},{default:l(()=>[e(t(it),{class:"mr-2 h-4 w-4"}),s[0]||(s[0]=n(" Limpiar Cache ",-1))]),_:1}),e(t(k),{href:`/admin/segments/${a.segment.id}/edit`},{default:l(()=>[e(t(x),null,{default:l(()=>[e(t(dt),{class:"mr-2 h-4 w-4"}),s[1]||(s[1]=n(" Editar ",-1))]),_:1})]),_:1},8,["href"]),e(t(k),{href:a.route("admin.segments.index")},{default:l(()=>[e(t(x),{variant:"outline"},{default:l(()=>[e(t(ut),{class:"mr-2 h-4 w-4"}),s[2]||(s[2]=n(" Volver ",-1))]),_:1})]),_:1},8,["href"])])]),o("div",kt,[e(t(p),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(g),{class:"text-sm font-medium"},{default:l(()=>[...s[3]||(s[3]=[n("Usuarios Totales",-1)])]),_:1}),e(t(mt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:l(()=>{var i;return[o("div",St,r(((i=a.metadata)==null?void 0:i.contacts_count)||0),1),s[4]||(s[4]=o("p",{class:"text-xs text-muted-foreground"},"usuarios en este segmento",-1))]}),_:1})]),_:1}),e(t(p),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(g),{class:"text-sm font-medium"},{default:l(()=>[...s[5]||(s[5]=[n("Cache",-1)])]),_:1}),e(t(ft),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:l(()=>[o("div",Ct,r(P(a.segment.cache_duration)),1),s[6]||(s[6]=o("p",{class:"text-xs text-muted-foreground"},"duración del cache",-1))]),_:1})]),_:1}),e(t(p),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(g),{class:"text-sm font-medium"},{default:l(()=>[...s[7]||(s[7]=[n("Última Evaluación",-1)])]),_:1}),e(t(pt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:l(()=>[o("div",jt,r(B(a.metadata)),1),s[8]||(s[8]=o("p",{class:"text-xs text-muted-foreground"},"última actualización",-1))]),_:1})]),_:1}),e(t(p),null,{default:l(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[e(t(g),{class:"text-sm font-medium"},{default:l(()=>[...s[9]||(s[9]=[n("Roles",-1)])]),_:1}),e(t(_t),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:l(()=>{var i;return[o("div",Dt,r(((i=a.segment.roles)==null?void 0:i.length)||0),1),s[10]||(s[10]=o("p",{class:"text-xs text-muted-foreground"},"roles asociados",-1))]}),_:1})]),_:1})]),e(t(lt),{defaultValue:"users",class:"space-y-4"},{default:l(()=>[e(t(at),null,{default:l(()=>[e(t(S),{value:"users"},{default:l(()=>[...s[11]||(s[11]=[n("Usuarios",-1)])]),_:1}),e(t(S),{value:"filters"},{default:l(()=>[...s[12]||(s[12]=[n("Filtros",-1)])]),_:1}),e(t(S),{value:"roles"},{default:l(()=>[...s[13]||(s[13]=[n("Roles",-1)])]),_:1}),e(t(S),{value:"details"},{default:l(()=>[...s[14]||(s[14]=[n("Detalles",-1)])]),_:1})]),_:1}),e(t(C),{value:"users"},{default:l(()=>[e(t(p),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(g),null,{default:l(()=>[...s[15]||(s[15]=[n("Usuarios en este Segmento",-1)])]),_:1}),e(t(T),null,{default:l(()=>[...s[16]||(s[16]=[n(" Lista de usuarios que cumplen con los criterios del segmento ",-1)])]),_:1})]),_:1}),e(t(c),null,{default:l(()=>{var i,m;return[(i=A().data)!=null&&i.length?(d(),$(t(Q),{key:0},{default:l(()=>[e(t(Y),null,{default:l(()=>[e(t(N),null,{default:l(()=>[e(t(h),null,{default:l(()=>[...s[17]||(s[17]=[n("Usuario",-1)])]),_:1}),e(t(h),null,{default:l(()=>[...s[18]||(s[18]=[n("Email",-1)])]),_:1}),e(t(h),null,{default:l(()=>[...s[19]||(s[19]=[n("Estado",-1)])]),_:1}),e(t(h),null,{default:l(()=>[...s[20]||(s[20]=[n("Registro",-1)])]),_:1}),e(t(h),{class:"text-right"},{default:l(()=>[...s[21]||(s[21]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(Z),null,{default:l(()=>[(d(!0),u(D,null,E(A().data,f=>(d(),$(t(N),{key:f.id},{default:l(()=>[e(t(w),null,{default:l(()=>[o("div",Et,[e(t(tt),{class:"h-8 w-8"},{default:l(()=>[f.avatar_url?(d(),$(t(et),{key:0,src:f.avatar_url,alt:f.name},null,8,["src","alt"])):j("",!0),e(t(st),null,{default:l(()=>[n(r(L(f.name)),1)]),_:2},1024)]),_:2},1024),o("span",Tt,r(f.name),1)])]),_:2},1024),e(t(w),null,{default:l(()=>[o("div",Ut,[e(t(gt),{class:"h-4 w-4 text-muted-foreground"}),o("span",At,r(f.email),1)])]),_:2},1024),e(t(w),null,{default:l(()=>[e(t(b),{variant:f.activo?"default":"secondary"},{default:l(()=>[n(r(f.activo?"Activo":"Inactivo"),1)]),_:2},1032,["variant"])]),_:2},1024),e(t(w),null,{default:l(()=>[n(r(M(f.created_at)),1)]),_:2},1024),e(t(w),{class:"text-right"},{default:l(()=>[e(t(k),{href:`/admin/users/${f.id}`},{default:l(()=>[e(t(x),{size:"sm",variant:"ghost"},{default:l(()=>[e(t(ct),{class:"mr-2 h-4 w-4"}),s[22]||(s[22]=n(" Ver Usuario ",-1))]),_:1})]),_:2},1032,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(d(),u("div",Rt," No hay usuarios en este segmento ")),a.isPaginated?(d(),u("div",Nt," Mostrando "+r((m=a.users.data)==null?void 0:m.length)+" de "+r(a.users.total)+" usuarios ",1)):j("",!0)]}),_:1})]),_:1})]),_:1}),e(t(C),{value:"filters"},{default:l(()=>[e(t(p),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(g),null,{default:l(()=>[...s[23]||(s[23]=[n("Criterios de Filtrado",-1)])]),_:1}),e(t(T),null,{default:l(()=>[...s[24]||(s[24]=[n(" Filtros aplicados para determinar los usuarios de este segmento ",-1)])]),_:1})]),_:1}),e(t(c),null,{default:l(()=>[a.segment.filters&&Object.keys(a.segment.filters).length>0?(d(),u("div",Vt,[e(t(ot),{class:"h-[400px]"},{default:l(()=>[o("div",Ft,[(d(!0),u(D,null,E(H(a.segment.filters),i=>(d(),u("div",{key:i.field,class:"p-4 border rounded-lg"},[o("div",Lt,[o("div",null,[o("p",Mt,r(i.field),1),o("p",Pt,r(O(i.value)),1)]),e(t(b),{variant:"outline"},{default:l(()=>[n(r(typeof i.value=="object"?"Complejo":"Simple"),1)]),_:2},1024)])]))),128))])]),_:1})])):(d(),u("div",zt," No hay filtros definidos para este segmento "))]),_:1})]),_:1})]),_:1}),e(t(C),{value:"roles"},{default:l(()=>[e(t(p),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(g),null,{default:l(()=>[...s[25]||(s[25]=[n("Roles Asociados",-1)])]),_:1}),e(t(T),null,{default:l(()=>[...s[26]||(s[26]=[n(" Roles que utilizan este segmento para delimitar el alcance de datos ",-1)])]),_:1})]),_:1}),e(t(c),null,{default:l(()=>{var i;return[(i=a.segment.roles)!=null&&i.length?(d(),u("div",Bt,[(d(!0),u(D,null,E(a.segment.roles,m=>(d(),u("div",{key:m.id,class:"flex items-center justify-between p-4 border rounded-lg"},[o("div",null,[o("h4",qt,r(m.display_name),1),o("p",It,r(m.name),1)]),e(t(k),{href:`/admin/roles/${m.id}`},{default:l(()=>[e(t(x),{size:"sm",variant:"ghost"},{default:l(()=>[...s[27]||(s[27]=[n(" Ver Rol ",-1)])]),_:1})]),_:2},1032,["href"])]))),128))])):(d(),u("div",Ot," No hay roles asociados a este segmento "))]}),_:1})]),_:1})]),_:1}),e(t(C),{value:"details"},{default:l(()=>[e(t(p),null,{default:l(()=>[e(t(_),null,{default:l(()=>[e(t(g),null,{default:l(()=>[...s[28]||(s[28]=[n("Información del Segmento",-1)])]),_:1})]),_:1}),e(t(c),{class:"space-y-4"},{default:l(()=>{var i;return[o("div",Ht,[o("div",null,[s[29]||(s[29]=o("p",{class:"text-sm font-medium text-muted-foreground"},"ID del Segmento",-1)),o("p",Wt,r(a.segment.id),1)]),o("div",null,[s[30]||(s[30]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Modelo",-1)),o("p",Jt,r(a.segment.model_type),1)]),o("div",null,[s[31]||(s[31]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Creado por",-1)),o("p",Xt,r(((i=a.segment.created_by)==null?void 0:i.name)||"Sistema"),1)]),o("div",null,[s[32]||(s[32]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo",-1)),e(t(b),{variant:a.segment.is_dynamic?"default":"secondary"},{default:l(()=>[n(r(a.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"])]),o("div",null,[s[33]||(s[33]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Creado",-1)),o("p",Gt,r(U(a.segment.created_at)),1)]),o("div",null,[s[34]||(s[34]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Última Actualización",-1)),o("p",Kt,r(U(a.segment.updated_at)),1)])]),a.segment.description?(d(),u("div",Qt,[s[35]||(s[35]=o("p",{class:"text-sm font-medium text-muted-foreground mb-2"},"Descripción",-1)),o("p",Yt,r(a.segment.description),1)])):j("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}))}});export{ls as default};
