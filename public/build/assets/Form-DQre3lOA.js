import{d as re,i as d,e as n,f as a,j as m,u as e,w as l,h as c,t as u,F as j,k as B,b as h,r as $,c as E,m as te,g as r,n as W,l as _e,C as ge,o as xe,p as be,L as he,q as ye,W as q}from"./app-BMyT8npG.js";import{_ as pe}from"./index-CBG0Dxc6.js";import{c as ke,_ as k}from"./createLucideIcon-KBqbhxXl.js";import{_ as F,c as L,a as R,b as G}from"./CardTitle.vue_vue_type_script_setup_true_lang--o-W0VD2.js";import{_ as $e}from"./Checkbox.vue_vue_type_script_setup_true_lang-CXeJvqS0.js";import{_ as Ve}from"./Input.vue_vue_type_script_setup_true_lang-B-ZayioL.js";import{_ as w}from"./Label.vue_vue_type_script_setup_true_lang-CB_veUhw.js";import{_ as ae,a as oe,b as se,c as le,d as ie}from"./SelectValue.vue_vue_type_script_setup_true_lang-DvImVwo1.js";import{_ as we,a as Ce,b as Y,c as ee}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-D6cCKRsg.js";import{_ as ne}from"./Textarea.vue_vue_type_script_setup_true_lang-1vl64RXQ.js";import{_ as O}from"./DateTimePicker.vue_vue_type_script_setup_true_lang-DTdt-vs5.js";import{_ as Se}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BFIlw7hr.js";import{L as je,a as Ue,_ as Ee}from"./DynamicFormBuilder.vue_vue_type_script_setup_true_lang-ZL497BdE.js";import{_ as ze}from"./CsvImportWizard.vue_vue_type_script_setup_true_lang-D05ZX6K_.js";import{_ as Ae,a as Ie,b as Be,c as Me,d as De,e as Fe}from"./index-DvRKPG4o.js";import{_ as Le,a as Ne,b as Pe}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CMlrocX5.js";import{u as qe}from"./useDebounce-BKmqnErE.js";import{C as Te}from"./chevrons-up-down-D2f7lX-5.js";import{L as de}from"./loader-circle-CXxpg-3P.js";import{U as ue}from"./user-B0uyQIKj.js";import{U as He}from"./user-plus-B17B05N0.js";import{X as Re}from"./x-C1dlUGaj.js";import{M as Ge}from"./mail-DlN17-1f.js";import{P as Oe}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BA6Cgh2E.js";import{C as We}from"./check-Coe3h_QS.js";import{C as Xe}from"./circle-alert-VjwGmEyY.js";import{U as ce}from"./upload-C6aDKbIK.js";import{P as Ze}from"./plus-CHpeS1sR.js";import{H as me}from"./history-1HoI-8qZ.js";import{T as Qe}from"./trash-2-DqA_0V_8.js";import{C as Je}from"./circle-x-DHRlEs6N.js";import{C as Ke}from"./circle-check-big-Bc7p1dMw.js";import{C as fe}from"./clock-DQbpIyMi.js";import"./index-E8S-vfjq.js";import"./index-BtG7D9fB.js";import"./floating-ui.vue-QqVgEqqM.js";import"./VisuallyHidden-Cd7_xZHo.js";import"./PopperContent-CeEbOoWX.js";import"./nullish-CHIgUVhi.js";import"./RovingFocusItem-r_gCmu-w.js";import"./utils--qJLDrju.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-CjMmW5fl.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-nxzX4U3P.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BzWm_IXp.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DQ4SyRm2.js";import"./users-C3Sf9FM4.js";import"./shield-D8bNww_e.js";import"./vote-B1OhdZRu.js";import"./file-text-BVkT7trW.js";import"./calendar-BhQnpxaC.js";import"./briefcase-_l6bVYfj.js";import"./megaphone-CSKz-P1T.js";import"./user-check-DAYhf5V0.js";import"./external-link-D8smFMAE.js";import"./panel-left-D-Xnf09n.js";import"./index-BWb2ElnP.js";import"./index-Bh0tNFO1.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Ds30fID4.js";import"./VisuallyHiddenInput-Dv1Uxz5I.js";import"./grip-vertical-Bw0zfChB.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-gbXepL8P.js";import"./eye-CC06bo2c.js";import"./git-branch-Cf63Jgtm.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-DsRYrW4G.js";import"./index-lBLRWVDn.js";import"./search-Kb6HAga-.js";import"./index-DTvzeguX.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Os_yaXt-.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DTP_M3gs.js";import"./map-pin-9xqBHUrI.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ke("CreditCardIcon",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),et={key:0,class:"text-red-500"},tt={key:0,class:"text-sm text-destructive mt-1"},at={key:1,class:"text-xs text-muted-foreground mt-1"},ot=re({__name:"TimezoneSelector",props:{modelValue:{},disabled:{type:Boolean,default:!1},label:{default:"Zona Horaria"},placeholder:{default:"Seleccionar zona horaria"},description:{default:"Las fechas de apertura y cierre se aplicarán según esta zona horaria"},required:{type:Boolean,default:!1},error:{}},emits:["update:modelValue"],setup(T,{emit:f}){const v=f,N=x=>{v("update:modelValue",x)};return(x,V)=>(n(),d("div",null,[a(e(w),null,{default:l(()=>[c(u(x.label)+" ",1),x.required?(n(),d("span",et,"*")):m("",!0)]),_:1}),a(e(ae),{"model-value":x.modelValue,"onUpdate:modelValue":N,disabled:x.disabled},{default:l(()=>[a(e(oe),null,{default:l(()=>[a(e(se),{placeholder:x.placeholder},null,8,["placeholder"])]),_:1}),a(e(le),null,{default:l(()=>[(n(!0),d(j,null,B(e(je),o=>(n(),h(e(ie),{key:o.value,value:o.value},{default:l(()=>[c(u(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"]),x.error?(n(),d("p",tt,u(x.error),1)):x.description?(n(),d("p",at,u(x.description),1)):m("",!0)]))}}),st={class:"space-y-3"},lt={key:0,class:"flex flex-wrap gap-2"},it={class:"text-xs"},rt={class:"flex gap-2"},nt={key:0,class:"py-6 text-center text-sm"},dt={class:"py-6 text-center text-sm"},ut={key:2,class:"py-6 text-center text-sm text-muted-foreground"},ct={key:0,class:"px-2 py-1.5 text-xs text-muted-foreground"},mt={class:"flex items-start justify-between w-full"},ft={class:"flex-1 min-w-0"},pt={class:"flex items-center gap-2"},vt={class:"font-medium truncate"},_t={class:"flex items-center gap-2 mt-1"},gt={class:"text-xs text-muted-foreground truncate"},xt={class:"flex items-center gap-4 mt-1"},bt={key:0,class:"flex items-center gap-1"},ht={class:"text-xs text-muted-foreground"},yt={key:1,class:"flex items-center gap-1"},kt={class:"text-xs text-muted-foreground"},$t={key:1,class:"p-2"},Vt={key:2,class:"p-2 text-center"},wt=re({__name:"UserMultiSelectCombobox",props:{votacionId:{},placeholder:{default:"Buscar usuarios..."},disabled:{type:Boolean,default:!1}},emits:["add-users"],setup(T,{emit:f}){const v=T,N=f,x=$(!1),V=$(""),o=$(!1),b=$([]),z=$(!1),M=$(1),_=$([]),C=$(0),{debounce:A}=qe(),S=E(()=>_.value.length===0?v.placeholder:`${_.value.length} usuario${_.value.length!==1?"s":""} seleccionado${_.value.length!==1?"s":""}`),U=E(()=>_.value.length>0),I=async(g,p=1)=>{if(g.length<2){b.value=[],C.value=0,z.value=!1;return}o.value=!0;try{const t=await(await fetch(`/admin/votaciones/${v.votacionId}/search-users?query=${encodeURIComponent(g)}&page=${p}`)).json();p===1?b.value=t.users||[]:b.value=[...b.value,...t.users||[]],z.value=t.has_more||!1,C.value=t.total||0,M.value=t.page||1}catch(s){console.error("Error buscando usuarios:",s),b.value=[],z.value=!1,C.value=0}finally{o.value=!1}},H=A(g=>{M.value=1,I(g,1)},300);te(V,g=>{H(g)});const P=g=>_.value.some(p=>p.id===g.id),X=g=>{P(g)?_.value=_.value.filter(p=>p.id!==g.id):_.value.push(g)},D=g=>{_.value=_.value.filter(p=>p.id!==g.id)},Z=()=>{!z.value||o.value||I(V.value,M.value+1)},Q=()=>{_.value.length!==0&&(N("add-users",[..._.value]),_.value=[],V.value="",b.value=[],x.value=!1)},J=()=>{_.value=[]},K=g=>g?g.length>4?`***${g.slice(-4)}`:"****":"";return(g,p)=>(n(),d("div",st,[_.value.length>0?(n(),d("div",lt,[(n(!0),d(j,null,B(_.value,s=>(n(),h(e(pe),{key:s.id,variant:"secondary",class:"pl-2 pr-1 py-1"},{default:l(()=>[r("span",it,u(s.name),1),a(e(k),{variant:"ghost",size:"sm",class:"h-4 w-4 p-0 ml-2 hover:bg-transparent",onClick:t=>D(s)},{default:l(()=>[a(e(Re),{class:"h-3 w-3"})]),_:2},1032,["onClick"])]),_:2},1024))),128)),_.value.length>0?(n(),h(e(k),{key:0,variant:"ghost",size:"sm",class:"h-6 px-2 text-xs",onClick:J},{default:l(()=>[...p[2]||(p[2]=[c(" Limpiar todo ",-1)])]),_:1})):m("",!0)])):m("",!0),r("div",rt,[a(e(Le),{open:x.value,"onUpdate:open":p[1]||(p[1]=s=>x.value=s)},{default:l(()=>[a(e(Ne),{"as-child":""},{default:l(()=>[a(e(k),{variant:"outline",role:"combobox","aria-expanded":x.value,disabled:g.disabled,class:"flex-1 justify-between"},{default:l(()=>[r("span",{class:W(U.value?"":"text-muted-foreground")},u(S.value),3),a(e(Te),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","disabled"])]),_:1}),a(e(Pe),{class:"w-[400px] p-0",align:"start"},{default:l(()=>[a(e(Ae),null,{default:l(()=>[a(e(Ie),{modelValue:V.value,"onUpdate:modelValue":p[0]||(p[0]=s=>V.value=s),placeholder:"Buscar por nombre, email, cédula o teléfono...",class:"h-9"},null,8,["modelValue"]),a(e(Be),null,{default:l(()=>[o.value&&b.value.length===0?(n(),d("div",nt,[a(e(de),{class:"h-4 w-4 animate-spin mx-auto mb-2"}),p[3]||(p[3]=r("p",null,"Buscando usuarios...",-1))])):V.value.length>=2&&b.value.length===0&&!o.value?(n(),h(e(Me),{key:1},{default:l(()=>[r("div",dt,[a(e(ue),{class:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),p[4]||(p[4]=r("p",null,"No se encontraron usuarios",-1)),p[5]||(p[5]=r("p",{class:"text-xs text-muted-foreground mt-1"}," Intenta con otro término de búsqueda ",-1))])]),_:1})):V.value.length<2?(n(),d("div",ut,[...p[6]||(p[6]=[r("p",null,"Escribe al menos 2 caracteres para buscar",-1)])])):(n(),h(e(De),{key:3},{default:l(()=>[C.value>0?(n(),d("div",ct,u(C.value)+" "+u(C.value===1?"resultado":"resultados"),1)):m("",!0),(n(!0),d(j,null,B(b.value,s=>(n(),h(e(Fe),{key:s.id,value:s.id.toString(),onSelect:t=>X(s),class:W(["cursor-pointer",P(s)?"bg-accent":""])},{default:l(()=>[r("div",mt,[r("div",ft,[r("div",pt,[a(e(ue),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",vt,u(s.name),1)]),r("div",_t,[a(e(Ge),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",gt,u(s.email),1)]),r("div",xt,[s.documento_identidad?(n(),d("div",bt,[a(e(Ye),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",ht,u(K(s.documento_identidad)),1)])):m("",!0),s.telefono?(n(),d("div",yt,[a(e(Oe),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",kt,u(s.telefono),1)])):m("",!0)])]),P(s)?(n(),h(e(We),{key:0,class:"h-4 w-4 text-primary shrink-0 ml-2"})):m("",!0)])]),_:2},1032,["value","onSelect","class"]))),128)),z.value&&!o.value?(n(),d("div",$t,[a(e(k),{variant:"ghost",size:"sm",class:"w-full",onClick:_e(Z,["stop"])},{default:l(()=>[...p[7]||(p[7]=[c(" Cargar más resultados ",-1)])]),_:1})])):m("",!0),o.value&&b.value.length>0?(n(),d("div",Vt,[a(e(de),{class:"h-4 w-4 animate-spin mx-auto"})])):m("",!0)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(e(k),{onClick:Q,disabled:!U.value,variant:"default"},{default:l(()=>[a(e(He),{class:"mr-2 h-4 w-4"}),c(" Agregar "+u(_.value.length||""),1)]),_:1},8,["disabled"])])]))}}),Ct={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},St={class:"flex items-center justify-between"},jt={class:"text-3xl font-bold"},Ut={class:"text-muted-foreground"},Et={class:"relative min-h-[70vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border"},zt={class:"grid gap-6 md:grid-cols-2"},At={class:"space-y-4"},It={key:0,class:"text-sm text-destructive mt-1"},Bt={key:0,class:"text-sm text-destructive mt-1"},Mt={key:0,class:"text-sm text-destructive mt-1"},Dt={class:"space-y-4"},Ft={key:0,class:"text-sm text-destructive mt-1"},Lt={key:0,class:"text-sm text-destructive mt-1"},Nt={key:1,class:"text-sm text-destructive mt-1"},Pt={class:"flex items-center space-x-2"},qt={key:0,class:"space-y-2"},Tt={key:0,class:"text-sm text-destructive mt-1"},Ht={key:0},Rt={key:0,class:"text-sm text-destructive mt-1"},Gt={class:"flex justify-between"},Ot={class:"flex gap-2"},Wt={class:"flex justify-between"},Xt={class:"flex gap-2"},Zt={class:"flex items-center space-x-2 text-yellow-700"},Qt={class:"space-y-4"},Jt={class:"flex items-center gap-2"},Kt={key:0,class:"text-center py-6 text-muted-foreground"},Yt={key:1,class:"space-y-3"},ea=["onClick"],ta={class:"flex items-center gap-3"},aa={class:"font-medium text-sm"},oa={class:"text-xs text-muted-foreground"},sa={class:"flex items-center gap-2"},la={key:0,class:"text-xs text-muted-foreground"},ia={key:0},ra={key:1,class:"text-xs text-muted-foreground"},na={key:0,class:"text-center py-8 text-muted-foreground"},da={key:1,class:"space-y-2"},ua={class:"font-medium"},ca={class:"text-sm text-muted-foreground"},ma={class:"flex justify-between"},zo=re({__name:"Form",props:{categorias:{},votacion:{},cargos:{},periodosElectorales:{},convocatorias:{},canManageVoters:{type:Boolean}},setup(T){var p;const f=T,v=E(()=>!!f.votacion),N=E(()=>{var s;return v.value&&((s=f.votacion)==null?void 0:s.estado)==="borrador"&&f.canManageVoters}),x=[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"},{title:v.value?"Editar":"Crear",href:"#"}],V=()=>{if(!f.votacion)return{titulo:"",descripcion:"",categoria_id:"",fecha_inicio:null,fecha_fin:null,estado:"borrador",resultados_publicos:!1,fecha_publicacion_resultados:null,limite_censo:null,mensaje_limite_censo:"",formulario_config:[],timezone:"America/Bogota",territorios_ids:[],departamentos_ids:[],municipios_ids:[],localidades_ids:[]};const s=f.votacion;return{titulo:s.titulo||"",descripcion:s.descripcion||"",categoria_id:s.categoria_id?String(s.categoria_id):"",fecha_inicio:s.fecha_inicio||null,fecha_fin:s.fecha_fin||null,estado:s.estado||"borrador",resultados_publicos:!!s.resultados_publicos,fecha_publicacion_resultados:s.fecha_publicacion_resultados||null,limite_censo:s.limite_censo||null,mensaje_limite_censo:s.mensaje_limite_censo||"",formulario_config:s.formulario_config||[],timezone:s.timezone||"America/Bogota",territorios_ids:s.territorios_ids||[],departamentos_ids:s.departamentos_ids||[],municipios_ids:s.municipios_ids||[],localidades_ids:s.localidades_ids||[]}},o=ge(V()),b=$("basicos"),z=[{value:"borrador",label:"Borrador"},{value:"activa",label:"Activa"},{value:"finalizada",label:"Finalizada"}],M=E({get:()=>({territorios_ids:o.territorios_ids||[],departamentos_ids:o.departamentos_ids||[],municipios_ids:o.municipios_ids||[],localidades_ids:o.localidades_ids||[]}),set:s=>{o.territorios_ids=s.territorios_ids,o.departamentos_ids=s.departamentos_ids,o.municipios_ids=s.municipios_ids,o.localidades_ids=s.localidades_ids}}),_=E(()=>!o.fecha_fin||!o.fecha_inicio?"":o.fecha_fin<=o.fecha_inicio?"La fecha de fin debe ser posterior a la fecha de inicio":""),C=()=>{if(!A.value){b.value="basicos",alert('Por favor completa todos los campos requeridos en la pestaña "Datos Básicos" antes de crear la votación.');return}if(o.formulario_config.length===0){alert("Por favor agrega al menos un campo al formulario antes de crear la votación.");return}v.value?o.put(`/admin/votaciones/${f.votacion.id}`,{onError:s=>{const t=Object.values(s)[0];t&&alert(`Error: ${Array.isArray(t)?t[0]:t}`)}}):o.post("/admin/votaciones",{onError:s=>{const t=Object.values(s)[0];t&&alert(`Error: ${Array.isArray(t)?t[0]:t}`)}})},A=E(()=>o.titulo&&o.categoria_id&&o.fecha_inicio&&o.fecha_fin&&o.timezone);E(()=>A.value&&o.formulario_config.length>0);const S=$(((p=f.votacion)==null?void 0:p.votantes)||[]),U=$(!1),I=$([]),H=async()=>{var s;if(!(!v.value||!((s=f.votacion)!=null&&s.id)))try{const t=await fetch(`/admin/votaciones/${f.votacion.id}/imports/recent`);if(t.ok){const i=await t.json();I.value=i}}catch(t){console.error("Error loading recent imports:",t)}},P=s=>{q.get(`/admin/imports/${s}`)},X=()=>{var s;(s=f.votacion)!=null&&s.id&&q.get(`/admin/votaciones/${f.votacion.id}/imports`)},D=s=>{switch(s){case"pending":return{icon:fe,label:"Pendiente",class:"text-yellow-600"};case"processing":return{icon:fe,label:"Procesando",class:"text-blue-600"};case"completed":return{icon:Ke,label:"Completada",class:"text-green-600"};case"failed":return{icon:Je,label:"Fallida",class:"text-red-600"}}},Z=s=>new Date(s).toLocaleString("es-ES",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Q=s=>{var i;if(!s||s.length===0||!v.value||!((i=f.votacion)!=null&&i.id))return;const t=s.map(y=>y.id.toString());q.post(`/admin/votaciones/${f.votacion.id}/votantes`,{votante_ids:t},{preserveScroll:!0,onSuccess:()=>{s.forEach(y=>{S.value.some(ve=>ve.id===y.id)||S.value.push({id:y.id,name:y.name,email:y.email})})},onError:y=>{console.error("Error adding votantes:",y),alert("Error al agregar votantes")}})},J=s=>{var t;!v.value||!((t=f.votacion)!=null&&t.id)||q.delete(`/admin/votaciones/${f.votacion.id}/votantes`,{data:{votante_id:s},preserveScroll:!0,onSuccess:()=>{S.value=S.value.filter(i=>i.id!==s)},onError:i=>{console.error("Error removing votante:",i),alert("Error al remover votante")}})},K=s=>{U.value=!1,H(),q.get(`/admin/imports/${s}`)},g=()=>{U.value=!1};return te(()=>f.votacion,s=>{if(s){const t=V();o.titulo=t.titulo,o.descripcion=t.descripcion,o.categoria_id=t.categoria_id,o.fecha_inicio=t.fecha_inicio,o.fecha_fin=t.fecha_fin,o.estado=t.estado,o.resultados_publicos=t.resultados_publicos,o.fecha_publicacion_resultados=t.fecha_publicacion_resultados,o.formulario_config=t.formulario_config,o.timezone=t.timezone,v.value&&H()}},{immediate:!0,deep:!0}),te(()=>o.resultados_publicos,s=>{console.log("resultados_publicos changed to:",s)},{immediate:!0}),xe(()=>{}),(s,t)=>(n(),d(j,null,[a(e(be),{title:v.value?"Editar Votación":"Nueva Votación"},null,8,["title"]),a(Se,{breadcrumbs:x},{default:l(()=>[r("div",Ct,[r("div",St,[r("div",null,[r("h1",jt,u(v.value?"Editar Votación":"Nueva Votación"),1),r("p",Ut,u(v.value?"Modifica los datos de la votación":"Crea una nueva votación paso a paso"),1)])]),r("div",Et,[a(e(F),{class:"border-0 shadow-none h-full"},{default:l(()=>[a(e(L),{class:"p-6"},{default:l(()=>[a(e(we),{modelValue:b.value,"onUpdate:modelValue":t[18]||(t[18]=i=>b.value=i),class:"w-full"},{default:l(()=>[a(e(Ce),{class:"grid w-full grid-cols-3"},{default:l(()=>[a(e(Y),{value:"basicos"},{default:l(()=>[...t[19]||(t[19]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"1"),c(" Datos Básicos ")],-1)])]),_:1}),a(e(Y),{value:"formulario",disabled:!v.value&&!A.value},{default:l(()=>[...t[20]||(t[20]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"2"),c(" Formulario ")],-1)])]),_:1},8,["disabled"]),a(e(Y),{value:"votantes",disabled:!v.value},{default:l(()=>[...t[21]||(t[21]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"3"),c(" Votantes ")],-1)])]),_:1},8,["disabled"])]),_:1}),a(e(ee),{value:"basicos",class:"space-y-6"},{default:l(()=>[r("div",zt,[r("div",At,[r("div",null,[a(e(w),{for:"titulo"},{default:l(()=>[...t[22]||(t[22]=[c("Título *",-1)])]),_:1}),a(e(Ve),{id:"titulo",modelValue:e(o).titulo,"onUpdate:modelValue":t[0]||(t[0]=i=>e(o).titulo=i),placeholder:"Nombre de la votación",error:e(o).errors.titulo},null,8,["modelValue","error"]),e(o).errors.titulo?(n(),d("p",It,u(e(o).errors.titulo),1)):m("",!0)]),r("div",null,[a(e(w),{for:"descripcion"},{default:l(()=>[...t[23]||(t[23]=[c("Descripción",-1)])]),_:1}),a(e(ne),{id:"descripcion",modelValue:e(o).descripcion,"onUpdate:modelValue":t[1]||(t[1]=i=>e(o).descripcion=i),placeholder:"Descripción detallada de la votación",rows:"4"},null,8,["modelValue"]),e(o).errors.descripcion?(n(),d("p",Bt,u(e(o).errors.descripcion),1)):m("",!0)]),r("div",null,[a(e(w),{for:"categoria"},{default:l(()=>[...t[24]||(t[24]=[c("Categoría *",-1)])]),_:1}),a(e(ae),{modelValue:e(o).categoria_id,"onUpdate:modelValue":t[2]||(t[2]=i=>e(o).categoria_id=i)},{default:l(()=>[a(e(oe),null,{default:l(()=>[a(e(se),{placeholder:"Seleccionar categoría"})]),_:1}),a(e(le),null,{default:l(()=>[(n(!0),d(j,null,B(s.categorias,i=>(n(),h(e(ie),{key:i.id,value:i.id.toString()},{default:l(()=>[c(u(i.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(o).errors.categoria_id?(n(),d("p",Mt,u(e(o).errors.categoria_id),1)):m("",!0)]),a(Ue,{modelValue:M.value,"onUpdate:modelValue":t[3]||(t[3]=i=>M.value=i)},null,8,["modelValue"])]),r("div",Dt,[r("div",null,[a(e(w),{for:"fecha_inicio"},{default:l(()=>[...t[25]||(t[25]=[c("Fecha y Hora de Inicio *",-1)])]),_:1}),a(e(O),{modelValue:e(o).fecha_inicio,"onUpdate:modelValue":t[4]||(t[4]=i=>e(o).fecha_inicio=i),placeholder:"Seleccionar fecha y hora de inicio"},null,8,["modelValue"]),e(o).errors.fecha_inicio?(n(),d("p",Ft,u(e(o).errors.fecha_inicio),1)):m("",!0)]),r("div",null,[a(e(w),{for:"fecha_fin"},{default:l(()=>[...t[26]||(t[26]=[c("Fecha y Hora de Fin *",-1)])]),_:1}),a(e(O),{modelValue:e(o).fecha_fin,"onUpdate:modelValue":t[5]||(t[5]=i=>e(o).fecha_fin=i),placeholder:"Seleccionar fecha y hora de fin"},null,8,["modelValue"]),_.value?(n(),d("p",Lt,u(_.value),1)):m("",!0),e(o).errors.fecha_fin?(n(),d("p",Nt,u(e(o).errors.fecha_fin),1)):m("",!0)]),r("div",null,[a(e(w),{for:"estado"},{default:l(()=>[...t[27]||(t[27]=[c("Estado",-1)])]),_:1}),a(e(ae),{modelValue:e(o).estado,"onUpdate:modelValue":t[6]||(t[6]=i=>e(o).estado=i)},{default:l(()=>[a(e(oe),null,{default:l(()=>[a(e(se))]),_:1}),a(e(le),null,{default:l(()=>[(n(),d(j,null,B(z,i=>a(e(ie),{key:i.value,value:i.value},{default:l(()=>[c(u(i.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])]),a(ot,{modelValue:e(o).timezone,"onUpdate:modelValue":t[7]||(t[7]=i=>e(o).timezone=i),required:"",error:e(o).errors.timezone},null,8,["modelValue","error"]),r("div",Pt,[a(e($e),{id:"resultados_publicos",checked:e(o).resultados_publicos,"onUpdate:checked":t[8]||(t[8]=i=>e(o).resultados_publicos=i)},null,8,["checked"]),a(e(w),{for:"resultados_publicos"},{default:l(()=>[...t[28]||(t[28]=[c(" Resultados públicos ",-1)])]),_:1})]),a(he,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:l(()=>[e(o).resultados_publicos?(n(),d("div",qt,[a(e(w),{for:"fecha_publicacion_resultados"},{default:l(()=>[...t[29]||(t[29]=[c(" Fecha de publicación de resultados (opcional) ",-1)])]),_:1}),a(e(O),{id:"fecha_publicacion_resultados",modelValue:e(o).fecha_publicacion_resultados,"onUpdate:modelValue":t[9]||(t[9]=i=>e(o).fecha_publicacion_resultados=i),placeholder:"Dejar vacío para publicar al finalizar la votación"},null,8,["modelValue"]),t[30]||(t[30]=r("p",{class:"text-xs text-muted-foreground"}," Si se especifica una fecha, los resultados serán visibles desde esa fecha. Si se deja vacío, los resultados solo serán visibles después de que termine la votación. ",-1))])):m("",!0)]),_:1}),r("div",null,[a(e(w),{for:"limite_censo"},{default:l(()=>[...t[31]||(t[31]=[c("Límite del Censo (opcional)",-1)])]),_:1}),a(e(O),{id:"limite_censo",modelValue:e(o).limite_censo,"onUpdate:modelValue":t[10]||(t[10]=i=>e(o).limite_censo=i),placeholder:"Seleccionar fecha límite del censo"},null,8,["modelValue"]),t[32]||(t[32]=r("p",{class:"text-xs text-muted-foreground"}," Fecha de referencia para determinar disponibilidad de la votación según criterios externos como fecha de inscripción. ",-1)),e(o).errors.limite_censo?(n(),d("p",Tt,u(e(o).errors.limite_censo),1)):m("",!0)]),e(o).limite_censo?(n(),d("div",Ht,[a(e(w),{for:"mensaje_limite_censo"},{default:l(()=>[...t[33]||(t[33]=[c(" Mensaje de notificación sobre límite de censo (opcional) ",-1)])]),_:1}),a(e(ne),{id:"mensaje_limite_censo",modelValue:e(o).mensaje_limite_censo,"onUpdate:modelValue":t[11]||(t[11]=i=>e(o).mensaje_limite_censo=i),placeholder:"Mensaje a mostrar cuando un usuario no cumple con el límite del censo",rows:"3",class:"mt-1"},null,8,["modelValue"]),t[34]||(t[34]=r("p",{class:"text-xs text-muted-foreground mt-1"}," Este mensaje se mostrará si un usuario intenta registrarse pero su fecha de inscripción es posterior al límite del censo configurado. ",-1)),e(o).errors.mensaje_limite_censo?(n(),d("p",Rt,u(e(o).errors.mensaje_limite_censo),1)):m("",!0)])):m("",!0)])]),r("div",Gt,[t[36]||(t[36]=r("div",null,null,-1)),r("div",Ot,[v.value?(n(),h(e(k),{key:0,onClick:C,disabled:e(o).processing||!A.value,variant:"default"},{default:l(()=>[c(u(e(o).processing?"Actualizando...":"Actualizar Votación"),1)]),_:1},8,["disabled"])):m("",!0),a(e(k),{onClick:t[12]||(t[12]=i=>b.value="formulario"),disabled:!A.value,variant:"outline"},{default:l(()=>[...t[35]||(t[35]=[c(" Siguiente: Configurar Formulario ",-1)])]),_:1},8,["disabled"])])])]),_:1}),a(e(ee),{value:"formulario",class:"space-y-6"},{default:l(()=>{var i;return[a(Ee,{modelValue:e(o).formulario_config,"onUpdate:modelValue":t[13]||(t[13]=y=>e(o).formulario_config=y),title:"Constructor de Formulario",description:"Agrega los campos que aparecerán en la votación","show-perfil-candidatura-config":!0,"show-convocatoria-config":!0,cargos:((i=f.cargos)==null?void 0:i.filter(y=>y.es_cargo))||[],"periodos-electorales":f.periodosElectorales||[],convocatorias:f.convocatorias||[],context:"votacion"},null,8,["modelValue","cargos","periodos-electorales","convocatorias"]),r("div",Wt,[a(e(k),{variant:"outline",onClick:t[14]||(t[14]=y=>b.value="basicos")},{default:l(()=>[...t[37]||(t[37]=[c(" Anterior ",-1)])]),_:1}),r("div",Xt,[N.value&&f.canManageVoters?(n(),h(e(k),{key:0,variant:"outline",onClick:t[15]||(t[15]=y=>b.value="votantes"),disabled:e(o).formulario_config.length===0},{default:l(()=>[...t[38]||(t[38]=[c(" Siguiente: Gestionar Votantes ",-1)])]),_:1},8,["disabled"])):m("",!0),a(e(k),{onClick:C,disabled:e(o).processing||e(o).formulario_config.length===0},{default:l(()=>[c(u(e(o).processing?"Guardando...":v.value?"Actualizar":"Crear")+" Votación ",1)]),_:1},8,["disabled"])])])]}),_:1}),a(e(ee),{value:"votantes",class:"space-y-6"},{default:l(()=>[t[52]||(t[52]=r("div",null,[r("h3",{class:"text-lg font-semibold"},"Gestión de Votantes"),r("p",{class:"text-sm text-muted-foreground"}," Asigna los usuarios que podrán participar en esta votación ")],-1)),f.canManageVoters?m("",!0):(n(),h(e(F),{key:0,class:"border-yellow-200 bg-yellow-50"},{default:l(()=>[a(e(L),{class:"pt-6"},{default:l(()=>[r("div",Zt,[a(e(Xe),{class:"h-5 w-5"}),t[39]||(t[39]=r("p",{class:"font-semibold"},"Sin permisos para manejar censo electoral",-1))]),t[40]||(t[40]=r("p",{class:"mt-2 text-sm text-gray-600"}," No tienes los permisos necesarios para gestionar el censo electoral de esta votación. Contacta a un administrador si necesitas acceso a esta funcionalidad. ",-1))]),_:1})]),_:1})),f.canManageVoters?(n(),d(j,{key:1},[U.value?m("",!0):(n(),h(e(F),{key:0},{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),{class:"flex items-center gap-2"},{default:l(()=>[a(e(ce),{class:"h-5 w-5"}),t[41]||(t[41]=c(" Importar Votantes ",-1))]),_:1})]),_:1}),a(e(L),null,{default:l(()=>[r("div",Qt,[t[43]||(t[43]=r("p",{class:"text-sm text-muted-foreground"}," Importa votantes desde un archivo CSV con mapeo dinámico de campos. Los usuarios importados serán asignados automáticamente a esta votación. ",-1)),t[44]||(t[44]=r("p",{class:"text-sm text-blue-600"},[r("a",{href:"/ejemplo-usuarios.csv",download:"",class:"underline"}," 📥 Descargar plantilla CSV de ejemplo ")],-1)),a(e(k),{variant:"outline",onClick:t[16]||(t[16]=i=>U.value=!0)},{default:l(()=>[a(e(ce),{class:"mr-2 h-4 w-4"}),t[42]||(t[42]=c(" Iniciar Importación ",-1))]),_:1})])]),_:1})]),_:1})),U.value&&v.value&&s.votacion?(n(),h(ze,{key:1,mode:"votacion","votacion-id":s.votacion.id,"votacion-titulo":s.votacion.titulo,"redirect-on-success":!1,onSuccess:K,onCancel:g},null,8,["votacion-id","votacion-titulo"])):m("",!0),v.value?(n(),h(e(F),{key:2},{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),{class:"flex items-center gap-2"},{default:l(()=>[a(e(Ze),{class:"h-5 w-5"}),t[45]||(t[45]=c(" Agregar Votantes ",-1))]),_:1})]),_:1}),a(e(L),null,{default:l(()=>{var i;return[(i=f.votacion)!=null&&i.id?(n(),h(e(wt),{key:0,"votacion-id":f.votacion.id,placeholder:"Buscar usuarios por nombre, email, cédula o teléfono...",onAddUsers:Q},null,8,["votacion-id"])):m("",!0)]}),_:1})]),_:1})):m("",!0),v.value?(n(),h(e(F),{key:3},{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),{class:"flex items-center justify-between"},{default:l(()=>[r("span",Jt,[a(e(me),{class:"h-5 w-5"}),t[46]||(t[46]=c(" Historial de Importaciones ",-1))]),I.value.length>0?(n(),h(e(k),{key:0,variant:"outline",size:"sm",onClick:X},{default:l(()=>[...t[47]||(t[47]=[c(" Ver Todas ",-1)])]),_:1})):m("",!0)]),_:1})]),_:1}),a(e(L),null,{default:l(()=>[I.value.length===0?(n(),d("div",Kt,[a(e(me),{class:"mx-auto h-8 w-8 mb-2"}),t[48]||(t[48]=r("p",null,"No hay importaciones registradas",-1)),t[49]||(t[49]=r("p",{class:"text-sm"},"Las importaciones aparecerán aquí una vez que subas archivos CSV",-1))])):(n(),d("div",Yt,[(n(!0),d(j,null,B(I.value,i=>(n(),d("div",{key:i.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:y=>P(i.id)},[r("div",ta,[(n(),h(ye(D(i.status).icon),{class:W(["h-4 w-4",D(i.status).class])},null,8,["class"])),r("div",null,[r("p",aa,u(i.original_filename),1),r("p",oa," Por "+u(i.created_by.name)+" • "+u(Z(i.created_at)),1)])]),r("div",sa,[a(e(pe),{variant:"outline",class:W(D(i.status).class)},{default:l(()=>[c(u(D(i.status).label),1)]),_:2},1032,["class"]),i.status==="completed"?(n(),d("div",la,[c(u(i.successful_rows)+" exitosos ",1),i.failed_rows>0?(n(),d("span",ia,", "+u(i.failed_rows)+" errores",1)):m("",!0)])):i.status==="processing"?(n(),d("div",ra,u(i.progress_percentage)+"% ",1)):m("",!0)])],8,ea))),128))]))]),_:1})]),_:1})):m("",!0),a(e(F),null,{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),null,{default:l(()=>[c("Votantes Asignados ("+u(S.value.length)+")",1)]),_:1})]),_:1}),a(e(L),null,{default:l(()=>[S.value.length===0?(n(),d("div",na,[...t[50]||(t[50]=[r("p",null,"No hay votantes asignados a esta votación",-1),r("p",{class:"text-sm"},"Importa un archivo CSV o agrega votantes manualmente",-1)])])):(n(),d("div",da,[(n(!0),d(j,null,B(S.value,i=>(n(),d("div",{key:i.id,class:"flex items-center justify-between p-3 border rounded-lg"},[r("div",null,[r("p",ua,u(i.name),1),r("p",ca,u(i.email),1)]),a(e(k),{variant:"ghost",size:"sm",onClick:y=>J(i.id)},{default:l(()=>[a(e(Qe),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1}),r("div",ma,[a(e(k),{variant:"outline",onClick:t[17]||(t[17]=i=>b.value="formulario")},{default:l(()=>[...t[51]||(t[51]=[c(" Anterior ",-1)])]),_:1}),a(e(k),{onClick:C,disabled:e(o).processing},{default:l(()=>[c(u(e(o).processing?"Guardando...":"Actualizar")+" Votación ",1)]),_:1},8,["disabled"])])],64)):m("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])])]),_:1})],64))}});export{zo as default};
