import{d as L,c as $,r as j,s as u,p as R,b as C,w as s,g as l,e as o,i as A,j as S,t as d,f as t,v as T,h as f,m as h,F as U,k as G}from"./app-DOAvpdpy.js";import{_ as q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-D9tk40Ze.js";import{_ as x,a as w,b as E,c as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-CHzHcBJD.js";import{_ as k}from"./createLucideIcon-B8d5bW74.js";import{_ as J}from"./Progress.vue_vue_type_script_setup_true_lang-DUc7kvfq.js";import{u as K}from"./useToast-CSNNStAV.js";import{l as O}from"./lodash-eXUsfpVb.js";import{_ as Q,a as W}from"./EntregablesFilters.vue_vue_type_script_setup_true_lang-C_YxZWFs.js";import{A as X}from"./arrow-left-IvdYDnHe.js";import{P as Y}from"./plus-CaIcTwOd.js";import{T as Z}from"./target-6lEdwcHB.js";import{C as ee}from"./circle-check-BcB3K9cq.js";import{C as te}from"./clock-_CclVdPa.js";import{C as oe}from"./circle-alert-C9j6pIWM.js";import"./useFlashMessages-DpAT9twl.js";import"./index-CmGaHOMg.js";import"./floating-ui.vue-DHJPTVzt.js";import"./x-BDylcitt.js";import"./Input.vue_vue_type_script_setup_true_lang-DpiZrk6F.js";import"./index-ceuENFtx.js";import"./index-ByelLgwr.js";import"./shield-CPsGM_xd.js";import"./user-BCblXEQx.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CVJnMnVh.js";import"./chevron-right-CCRsFGH5.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Cep9uJW9.js";import"./VisuallyHidden-BSG4PTdC.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-BXZrnX9E.js";import"./check-qkM_pq-n.js";import"./Label.vue_vue_type_script_setup_true_lang-D3G2L01q.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Cxybq1SB.js";import"./index-D4UxCdcO.js";import"./map-pin-Bo0BxocW.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-ehaQzMDU.js";import"./chevrons-up-down-sU9lYEz6.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-vM-5-Mr4.js";import"./tag-DfZyNgGs.js";import"./users-lrz85sQ8.js";import"./vote-d-PWMwPO.js";import"./folder-open-1fOQ0rtw.js";import"./send-VqVT7m78.js";import"./file-text-D373kHVE.js";import"./briefcase-uiBroSEx.js";import"./calendar-CD2D2UbU.js";import"./megaphone-CVBqqCSC.js";import"./user-check-CAi1ivNh.js";import"./clipboard-list-De5Ng5v1.js";import"./mail-CNihFBrW.js";import"./message-square-JJ7kxV2X.js";import"./external-link-fEEnYwkp.js";import"./panel-left-DMAuoSSS.js";import"./index-BEwAULqp.js";import"./index-B0zyg-lg.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-C-z1Ih5O.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BkvbipgT.js";import"./StatusChangeModal.vue_vue_type_script_setup_true_lang-CZ2X4Z-Q.js";import"./Switch.vue_vue_type_script_setup_true_lang-71QEUPTl.js";import"./VisuallyHiddenInput-ZIuX-4z0.js";import"./ComentarioContextoInput.vue_vue_type_script_setup_true_lang-BsFE5JFL.js";import"./RichTextEditor-BS_71c2M.js";import"./italic-CCAMh8fV.js";import"./list-3sKdXja_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FileUploadField.vue_vue_type_script_setup_true_lang-DUYEWGxD.js";import"./useFileUpload-Dhflcu_G.js";import"./upload-KZqVpSl6.js";import"./file-D4t4Yig_.js";import"./eye-DPdWlF5i.js";import"./download-SKf2EK9a.js";import"./paperclip-Dxvb9AKd.js";import"./circle-x-BwZ4OB4t.js";import"./circle-check-big-Bp-GPbzd.js";import"./loader-circle-CaHzj4tA.js";import"./square-pen-BlJ2VD3E.js";import"./trash-2-U0flC5IV.js";import"./filter-D0DhnpYH.js";import"./search-BiD4ugt-.js";const re={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},se={class:"flex items-center justify-between"},ae={class:"text-muted-foreground mt-2"},ie={class:"flex gap-2"},le={class:"grid gap-4 md:grid-cols-4"},ne={class:"text-2xl font-bold"},de={class:"text-xs text-muted-foreground mt-2"},me={class:"text-2xl font-bold"},ce={class:"text-xs text-muted-foreground"},pe={class:"text-2xl font-bold"},ue={class:"text-2xl font-bold"},fe={key:0,class:"flex items-center justify-between"},ge={class:"text-sm text-muted-foreground"},be={class:"flex gap-2"},It=L({__name:"Index",props:{proyecto:{},hito:{},entregables:{},filters:{},resumenUsuarios:{},estados:{},prioridades:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canAssign:{type:Boolean}},setup(i){var V,P,B,D;const r=i,{toast:g}=K(),m=$(()=>Array.isArray(r.entregables)?{data:r.entregables,current_page:1,last_page:1,per_page:r.entregables.length,total:r.entregables.length,from:1,to:r.entregables.length}:r.entregables),c=j({search:((V=r.filters)==null?void 0:V.search)||null,estado:((P=r.filters)==null?void 0:P.estado)||null,prioridad:((B=r.filters)==null?void 0:B.prioridad)||null,responsable_id:((D=r.filters)==null?void 0:D.responsable_id)||null,fecha_inicio:null,fecha_fin:null});j([]);const N=$(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:r.proyecto.nombre,href:`/admin/proyectos/${r.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${r.proyecto.id}/hitos`},{title:r.hito.nombre,href:`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}`},{title:"Entregables"}]),F=O.debounce(()=>{u.get(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables`,{search:c.value.search,estado:c.value.estado,prioridad:c.value.prioridad,responsable_id:c.value.responsable_id,page:1},{preserveState:!0,preserveScroll:!0})},300);R(c,()=>{F()},{deep:!0});const M=(a,e)=>{r.canComplete&&u.post(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables/${a.id}/completar`,{notas:e},{onSuccess:()=>{g.success("Entregable marcado como completado")},onError:()=>{g.error("Error al marcar el entregable como completado")}})},z=a=>{r.canDelete&&confirm(`¿Estás seguro de eliminar el entregable "${a.nombre}"?`)&&u.delete(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables/${a.id}`,{onSuccess:()=>{g.success("Entregable eliminado correctamente")},onError:()=>{g.error("Error al eliminar el entregable")}})},H=(a,e)=>{r.canEdit&&u.post(`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables/${a.id}/actualizar-estado`,{estado:"en_progreso",observaciones:e},{onSuccess:()=>{g.success("Entregable marcado como en progreso")},onError:()=>{g.error("Error al actualizar el estado del entregable")}})},v=a=>{if(!a)return null;const e=new Date,_=new Date(a).getTime()-e.getTime();return Math.ceil(_/(1e3*60*60*24))};$(()=>m.value.data.map(a=>({...a,diasRestantes:v(a.fecha_fin),estaVencido:a.fecha_fin&&v(a.fecha_fin)<0,estaProximoVencer:a.fecha_fin&&v(a.fecha_fin)>=0&&v(a.fecha_fin)<=7})));const p=$(()=>{const a=m.value.data,e=m.value.total,n=a.filter(b=>b.estado==="completado").length,_=a.filter(b=>b.estado==="en_progreso").length,I=a.filter(b=>b.estado==="pendiente").length;return{total:e,completados:n,enProgreso:_,pendientes:I,progreso:e>0?Math.round(n/e*100):0}});return(a,e)=>(h(),C(q,{breadcrumbs:N.value},{default:s(()=>[l("div",re,[l("div",se,[l("div",null,[e[3]||(e[3]=l("h2",{class:"text-3xl font-bold tracking-tight"},"Entregables del Hito",-1)),l("p",ae,d(i.hito.nombre)+" - "+d(i.proyecto.nombre),1)]),l("div",ie,[o(t(T),{href:`/admin/proyectos/${i.proyecto.id}/hitos`,as:"button"},{default:s(()=>[o(t(k),{variant:"outline"},{default:s(()=>[o(t(X),{class:"mr-2 h-4 w-4"}),e[4]||(e[4]=f(" Volver a Hitos ",-1))]),_:1})]),_:1},8,["href"]),i.canCreate?(h(),C(t(T),{key:0,href:`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables/create`,as:"button"},{default:s(()=>[o(t(k),null,{default:s(()=>[o(t(Y),{class:"mr-2 h-4 w-4"}),e[5]||(e[5]=f(" Nuevo Entregable ",-1))]),_:1})]),_:1},8,["href"])):S("",!0)])]),l("div",le,[o(t(x),null,{default:s(()=>[o(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(t(E),{class:"text-sm font-medium"},{default:s(()=>[...e[6]||(e[6]=[f("Total Entregables",-1)])]),_:1}),o(t(Z),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),o(t(y),null,{default:s(()=>[l("div",ne,d(p.value.total),1),o(t(J),{value:p.value.progreso,class:"mt-2"},null,8,["value"]),l("p",de,d(p.value.progreso)+"% completado ",1)]),_:1})]),_:1}),o(t(x),null,{default:s(()=>[o(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(t(E),{class:"text-sm font-medium"},{default:s(()=>[...e[7]||(e[7]=[f("Completados",-1)])]),_:1}),o(t(ee),{class:"h-4 w-4 text-green-600"})]),_:1}),o(t(y),null,{default:s(()=>[l("div",me,d(p.value.completados),1),l("p",ce," de "+d(p.value.total)+" entregables ",1)]),_:1})]),_:1}),o(t(x),null,{default:s(()=>[o(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(t(E),{class:"text-sm font-medium"},{default:s(()=>[...e[8]||(e[8]=[f("En Progreso",-1)])]),_:1}),o(t(te),{class:"h-4 w-4 text-blue-600"})]),_:1}),o(t(y),null,{default:s(()=>[l("div",pe,d(p.value.enProgreso),1),e[9]||(e[9]=l("p",{class:"text-xs text-muted-foreground"}," actualmente activos ",-1))]),_:1})]),_:1}),o(t(x),null,{default:s(()=>[o(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(t(E),{class:"text-sm font-medium"},{default:s(()=>[...e[10]||(e[10]=[f("Pendientes",-1)])]),_:1}),o(t(oe),{class:"h-4 w-4 text-orange-600"})]),_:1}),o(t(y),null,{default:s(()=>[l("div",ue,d(p.value.pendientes),1),e[11]||(e[11]=l("p",{class:"text-xs text-muted-foreground"}," por iniciar ",-1))]),_:1})]),_:1})]),o(Q,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=n=>c.value=n)},null,8,["modelValue"]),o(t(x),null,{default:s(()=>[o(t(y),{class:"p-0"},{default:s(()=>[o(W,{entregables:m.value.data,"proyecto-id":i.proyecto.id,"hito-id":i.hito.id,"can-edit":i.canEdit,"can-delete":i.canDelete,"can-complete":i.canComplete,onView:e[1]||(e[1]=n=>t(u).visit(`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables/${n.id}`)),onEdit:e[2]||(e[2]=n=>t(u).visit(`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables/${n.id}/edit`)),onComplete:M,onMarkInProgress:H,onDelete:z},null,8,["entregables","proyecto-id","hito-id","can-edit","can-delete","can-complete"])]),_:1})]),_:1}),m.value.last_page>1?(h(),A("div",fe,[l("div",ge," Mostrando "+d(m.value.from)+" a "+d(m.value.to)+" de "+d(m.value.total)+" entregables ",1),l("div",be,[(h(!0),A(U,null,G(m.value.last_page,n=>(h(),C(t(k),{key:n,variant:"outline",size:"sm",disabled:n===m.value.current_page,onClick:_=>t(u).get(`/admin/proyectos/${i.proyecto.id}/hitos/${i.hito.id}/entregables?page=${n}`)},{default:s(()=>[f(d(n),1)]),_:2},1032,["disabled","onClick"]))),128))])])):S("",!0)])]),_:1},8,["breadcrumbs"]))}});export{It as default};
