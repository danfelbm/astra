import{d as X,C as Y,c as h,k as Z,w as K,j as D,o as u,e as a,b as l,f as n,u as e,m as ee,P as R,g as t,h as se,a as m,F as v,r as b,t as c,i as le}from"./app-B77ccTjn.js";import{d as ae,T as ie,_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-BvBOaTU9.js";import{_ as x}from"./createLucideIcon-DDkPG2Rx.js";import{_ as k,a as $,b as P,c as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-CTQSEJni.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-B1b37HX6.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-CS7-wUGb.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-D2xSgxzA.js";import{_ as te}from"./Textarea.vue_vue_type_script_setup_true_lang-BEMBAQOP.js";import{_ as V}from"./Checkbox.vue_vue_type_script_setup_true_lang-CwgdAwdw.js";import{_ as L}from"./index-BIYbvm3e.js";import{_ as re,a as ne,b as C,c as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-B1fQIsA5.js";import{_ as de}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DG1lcL5d.js";import{_ as ue}from"./Switch.vue_vue_type_script_setup_true_lang-Bo5Mzmd-.js";import{_ as me,a as ce,b as pe,c as fe,d as _e}from"./SelectValue.vue_vue_type_script_setup_true_lang-CXBvmCjL.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-BLNSRfT0.js";import{A as ge}from"./arrow-left-N4OjROs_.js";import{L as ve}from"./lock-D0uBJ7NZ.js";import{U as be}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BS2hC7Dl.js";import{H as xe}from"./house-nQ3oFDnA.js";import{S as ye}from"./save-ClyCbAWX.js";import"./index-CUP-ao-g.js";import"./check-CNFJRLqV.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BYXXTpJk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-l7ybE-_d.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BBcB5kWO.js";import"./index-B8g8ZX0h.js";import"./calendar-DbxCvWy3.js";import"./map-pin-HlX81OCc.js";import"./VisuallyHidden-Brv048Yl.js";import"./RovingFocusItem-CzR2phkA.js";import"./utils-ZIsWQDMG.js";import"./VisuallyHiddenInput-Bg8hzY3I.js";const he={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ke={class:"flex items-center justify-between"},$e={class:"space-y-2"},Pe={class:"space-y-2"},Se={class:"space-y-2"},we={class:"space-y-2"},Ve={class:"flex items-center justify-between"},Ce={class:"space-y-0.5"},Ue={class:"space-y-2"},je={class:"flex gap-2 mt-4"},De={class:"space-y-6"},Oe={class:"flex items-center space-x-2 pb-2 border-b"},Ae={class:"grid grid-cols-2 gap-3 pl-6"},Re={class:"grid grid-cols-2 gap-4"},Fe={key:0,class:"space-y-3"},Le={class:"flex-1"},Ne={class:"text-xs text-muted-foreground mt-1"},Me={key:1,class:"text-center py-8 text-muted-foreground"},Te={class:"flex justify-end gap-4"},ys=X({__name:"Create",props:{segments:{},availablePermissions:{},modules:{}},setup(N){const y=N,M=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Crear Rol",href:"#"}],i=Y({name:"",display_name:"",description:"",is_administrative:!0,redirect_after_login:"",permissions:[],allowed_modules:[],segment_ids:[]}),O=[{value:"",label:"Por defecto (según tipo de rol)"},{value:"admin.dashboard",label:"Dashboard Administrativo",group:"admin"},{value:"admin.candidaturas.dashboard",label:"Dashboard Candidaturas",group:"admin"},{value:"dashboard",label:"Dashboard Usuario",group:"user"},{value:"votaciones.index",label:"Votaciones",group:"user"},{value:"asambleas.index",label:"Asambleas",group:"user"},{value:"formularios.index",label:"Formularios",group:"user"},{value:"postulaciones.index",label:"Postulaciones",group:"user"},{value:"admin.otp-dashboard",label:"Dashboard OTP",group:"admin"},{value:"admin.configuracion.index",label:"Configuración",group:"admin"},{value:"admin.users.index",label:"Usuarios",group:"admin"},{value:"admin.roles.index",label:"Roles y Permisos",group:"admin"},{value:"admin.candidaturas.index",label:"Candidaturas (Lista)",group:"admin"}],T=h(()=>i.is_administrative?O:O.filter(r=>r.group!=="admin"||r.value===""));Z({});const g=h(()=>i.is_administrative?y.availablePermissions.administrative:y.availablePermissions.frontend),G=h(()=>i.is_administrative?y.modules.administrative:y.modules.frontend),A=r=>{const s=g.value[r];return s?Object.keys(s.permissions).every(d=>i.permissions.includes(d)):!1},z=r=>{const s=g.value[r];if(!s)return!1;const o=Object.keys(s.permissions),d=o.filter(p=>i.permissions.includes(p)).length;return d>0&&d<o.length},B=r=>{const s=i.permissions.indexOf(r);s>-1?i.permissions.splice(s,1):i.permissions.push(r)},E=r=>{const s=g.value[r];if(!s)return;const o=Object.keys(s.permissions);A(r)?i.permissions=i.permissions.filter(p=>!o.includes(p)):o.forEach(p=>{i.permissions.includes(p)||i.permissions.push(p)})},q=r=>{const s=i.allowed_modules.indexOf(r);s>-1?i.allowed_modules.splice(s,1):i.allowed_modules.push(r)},H=r=>{const s=i.segment_ids.indexOf(r);s>-1?i.segment_ids.splice(s,1):i.segment_ids.push(r)},I=()=>{i.post("/admin/roles",{preserveScroll:!0,onSuccess:()=>{}})},J=()=>{const r=[];Object.values(g.value).forEach(s=>{Object.keys(s.permissions).forEach(o=>{r.push(o)})}),i.permissions=r},Q=()=>{i.permissions=[]};K(()=>i.is_administrative,(r,s)=>{s!==void 0&&r!==s&&(i.permissions=[],i.allowed_modules=[])});const W=h(()=>i.permissions.length);return(r,s)=>(u(),D(oe,{breadcrumbs:M},{default:a(()=>[l(e(ee),{title:"Crear Rol"}),n("div",he,[n("div",ke,[s[6]||(s[6]=n("div",null,[n("h2",{class:"text-2xl font-bold tracking-tight"},"Crear Nuevo Rol"),n("p",{class:"text-muted-foreground"}," Define un nuevo rol con permisos específicos ")],-1)),l(e(R),{href:r.route("admin.roles.index")},{default:a(()=>[l(e(x),{variant:"outline"},{default:a(()=>[l(e(ge),{class:"mr-2 h-4 w-4"}),s[5]||(s[5]=t(" Volver "))]),_:1})]),_:1},8,["href"])]),n("form",{onSubmit:se(I,["prevent"]),class:"space-y-6"},[l(e(re),{defaultValue:"general",class:"space-y-4"},{default:a(()=>[l(e(ne),{class:"grid w-full grid-cols-4"},{default:a(()=>[l(e(C),{value:"general"},{default:a(()=>[l(e(ae),{class:"mr-2 h-4 w-4"}),s[7]||(s[7]=t(" General "))]),_:1}),l(e(C),{value:"permissions"},{default:a(()=>[l(e(ve),{class:"mr-2 h-4 w-4"}),s[8]||(s[8]=t(" Permisos "))]),_:1}),l(e(C),{value:"modules"},{default:a(()=>[l(e(be),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=t(" Módulos "))]),_:1}),l(e(C),{value:"segments"},{default:a(()=>[l(e(ie),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=t(" Segmentos "))]),_:1})]),_:1}),l(e(U),{value:"general"},{default:a(()=>[l(e(k),null,{default:a(()=>[l(e($),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[11]||(s[11]=[t("Información General")])),_:1}),l(e(w),null,{default:a(()=>s[12]||(s[12]=[t(" Define el nombre y descripción del rol ")])),_:1})]),_:1}),l(e(S),{class:"space-y-4"},{default:a(()=>[n("div",$e,[l(e(f),{htmlFor:"name"},{default:a(()=>s[13]||(s[13]=[t("Nombre del Rol (interno)")])),_:1}),l(e(F),{id:"name",modelValue:e(i).name,"onUpdate:modelValue":s[0]||(s[0]=o=>e(i).name=o),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos"},null,8,["modelValue"]),s[14]||(s[14]=n("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),l(_,{message:e(i).errors.name},null,8,["message"])]),n("div",Pe,[l(e(f),{htmlFor:"display_name"},{default:a(()=>s[15]||(s[15]=[t("Nombre a Mostrar")])),_:1}),l(e(F),{id:"display_name",modelValue:e(i).display_name,"onUpdate:modelValue":s[1]||(s[1]=o=>e(i).display_name=o),placeholder:"Administrador Regional"},null,8,["modelValue"]),l(_,{message:e(i).errors.display_name},null,8,["message"])]),n("div",Se,[l(e(f),{htmlFor:"description"},{default:a(()=>s[16]||(s[16]=[t("Descripción")])),_:1}),l(e(te),{id:"description",modelValue:e(i).description,"onUpdate:modelValue":s[2]||(s[2]=o=>e(i).description=o),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),l(_,{message:e(i).errors.description},null,8,["message"])]),n("div",we,[n("div",Ve,[n("div",Ce,[l(e(f),{htmlFor:"is_administrative"},{default:a(()=>s[17]||(s[17]=[t("Rol Administrativo")])),_:1}),s[18]||(s[18]=n("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),l(e(ue),{id:"is_administrative",modelValue:e(i).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=o=>e(i).is_administrative=o)},null,8,["modelValue"])]),l(_,{message:e(i).errors.is_administrative},null,8,["message"])]),n("div",Ue,[l(e(f),{htmlFor:"redirect_after_login"},{default:a(()=>[l(e(xe),{class:"inline-block h-4 w-4 mr-1"}),s[19]||(s[19]=t(" Página de Inicio Después del Login "))]),_:1}),l(e(me),{modelValue:e(i).redirect_after_login,"onUpdate:modelValue":s[4]||(s[4]=o=>e(i).redirect_after_login=o)},{default:a(()=>[l(e(ce),{id:"redirect_after_login"},{default:a(()=>[l(e(pe),{placeholder:"Seleccione la página de destino"})]),_:1}),l(e(fe),null,{default:a(()=>[(u(!0),m(v,null,b(T.value,o=>(u(),D(e(_e),{key:o.value,value:o.value},{default:a(()=>[t(c(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),s[20]||(s[20]=n("p",{class:"text-xs text-muted-foreground"}," Define a qué página se redirigirá al usuario después de autenticarse. Si no se especifica, usará el comportamiento por defecto. ",-1)),l(_,{message:e(i).errors.redirect_after_login},null,8,["message"])])]),_:1})]),_:1})]),_:1}),l(e(U),{value:"permissions"},{default:a(()=>[l(e(k),null,{default:a(()=>[l(e($),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[21]||(s[21]=[t("Matriz de Permisos")])),_:1}),l(e(w),null,{default:a(()=>[t(c(e(i).is_administrative?"Selecciona los permisos administrativos para este rol":"Selecciona los permisos de usuario para este rol"),1)]),_:1}),n("div",je,[l(e(x),{type:"button",size:"sm",variant:"outline",onClick:J},{default:a(()=>s[22]||(s[22]=[t(" Seleccionar Todos ")])),_:1}),l(e(x),{type:"button",size:"sm",variant:"outline",onClick:Q},{default:a(()=>s[23]||(s[23]=[t(" Limpiar Todos ")])),_:1}),l(e(L),{variant:"secondary",class:"ml-auto"},{default:a(()=>[t(c(W.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),l(e(S),null,{default:a(()=>[l(e(de),{class:"h-[500px] pr-4"},{default:a(()=>[n("div",De,[(u(!0),m(v,null,b(g.value,(o,d)=>(u(),m("div",{key:d,class:"space-y-3"},[n("div",Oe,[l(e(V),{checked:A(d),indeterminate:z(d),"onUpdate:checked":p=>E(d)},null,8,["checked","indeterminate","onUpdate:checked"]),l(e(f),{class:"text-sm font-semibold"},{default:a(()=>[t(c(o.label),1)]),_:2},1024)]),n("div",Ae,[(u(!0),m(v,null,b(o.permissions,(p,j)=>(u(),m("div",{key:j,class:"flex items-center space-x-2"},[l(e(V),{checked:e(i).permissions.includes(j),"onUpdate:checked":Ge=>B(j)},null,8,["checked","onUpdate:checked"]),l(e(f),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[t(c(p),1)]),_:2},1024)]))),128))])]))),128))])]),_:1}),l(_,{message:e(i).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(U),{value:"modules"},{default:a(()=>[l(e(k),null,{default:a(()=>[l(e($),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[24]||(s[24]=[t("Módulos Permitidos")])),_:1}),l(e(w),null,{default:a(()=>[t(c(e(i).is_administrative?"Selecciona los módulos administrativos a los que tendrá acceso este rol":"Selecciona los módulos del portal público a los que tendrá acceso este rol"),1)]),_:1})]),_:1}),l(e(S),null,{default:a(()=>[n("div",Re,[(u(!0),m(v,null,b(G.value,(o,d)=>(u(),m("div",{key:d,class:"flex items-center space-x-2"},[l(e(V),{checked:e(i).allowed_modules.includes(d),"onUpdate:checked":p=>q(d)},null,8,["checked","onUpdate:checked"]),l(e(f),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[t(c(o),1)]),_:2},1024)]))),128))]),l(_,{message:e(i).errors.allowed_modules},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(U),{value:"segments"},{default:a(()=>[l(e(k),null,{default:a(()=>[l(e($),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[25]||(s[25]=[t("Segmentos de Datos")])),_:1}),l(e(w),null,{default:a(()=>s[26]||(s[26]=[t(" Asocia segmentos para limitar el alcance de datos visibles ")])),_:1})]),_:1}),l(e(S),null,{default:a(()=>[r.segments.length>0?(u(),m("div",Fe,[(u(!0),m(v,null,b(r.segments,o=>(u(),m("div",{key:o.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[l(e(V),{checked:e(i).segment_ids.includes(o.id),"onUpdate:checked":d=>H(o.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),n("div",Le,[l(e(f),{class:"text-sm font-medium cursor-pointer"},{default:a(()=>[t(c(o.name),1)]),_:2},1024),n("p",Ne,c(o.description||"Sin descripción"),1),o.user_count?(u(),D(e(L),{key:0,variant:"outline",class:"mt-2"},{default:a(()=>[t(c(o.user_count)+" usuarios ",1)]),_:2},1024)):le("",!0)])]))),128))])):(u(),m("div",Me," No hay segmentos disponibles ")),l(_,{message:e(i).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),n("div",Te,[l(e(R),{href:r.route("admin.roles.index")},{default:a(()=>[l(e(x),{type:"button",variant:"outline"},{default:a(()=>s[27]||(s[27]=[t(" Cancelar ")])),_:1})]),_:1},8,["href"]),l(e(x),{type:"submit",disabled:e(i).processing},{default:a(()=>[l(e(ye),{class:"mr-2 h-4 w-4"}),t(" "+c(e(i).processing?"Creando...":"Crear Rol"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{ys as default};
