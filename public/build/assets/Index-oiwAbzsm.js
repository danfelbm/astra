import{d as he,c as F,r as x,W as j,m as ye,b as f,e as i,w as a,g as r,f as t,i as c,j as p,t as d,u as e,P as A,h as n,F as U,k as M,l as J,q as xe,G as be}from"./app-Dt2sukkq.js";import{_ as $e}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BAX2dDyG.js";import{_ as b,a as P,b as S,c as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-D3D16Ztn.js";import{c as ke,_ as k}from"./createLucideIcon-ADYiFz1p.js";import{_ as we}from"./Input.vue_vue_type_script_setup_true_lang-B3JXaiF3.js";import{_ as K}from"./index-DZUQ23bj.js";import{_ as Ce,a as Ee,b as I,c as g,d as Ve,e as _}from"./TableHeader.vue_vue_type_script_setup_true_lang-VWehj9vh.js";import{_ as Q,a as X,b as Y,c as Z,d as N,e as Pe,C as Se}from"./SelectValue.vue_vue_type_script_setup_true_lang-XTf0O-lR.js";import{_ as De,a as Te,b as Be,d as Fe,e as ee,c as L}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Ch_KWbnG.js";import{_ as te}from"./Checkbox.vue_vue_type_script_setup_true_lang-C9CiF85Y.js";import{_ as je}from"./Progress.vue_vue_type_script_setup_true_lang-DLCooW4I.js";import{_ as Ae,a as Ue,b as Me}from"./index-C_zthh-d.js";import{u as Ne}from"./useToast-hhFFdGxp.js";import{l as Re}from"./lodash-Cilq29IB.js";import{A as Ie}from"./arrow-left-CcnTTf_x.js";import{P as Le}from"./plus-C-zod1mM.js";import{T as qe}from"./target-BlHWusLl.js";import{C as se}from"./circle-check-DE_RZp-W.js";import{C as He}from"./clock-CqEtmu8F.js";import{C as q}from"./circle-alert-Bny28mZr.js";import{F as ze}from"./filter-DU9mvn47.js";import{S as Ge}from"./search-BkHaPo1l.js";import{C as Oe}from"./calendar-CJYt0g6k.js";import{U as We}from"./users-ARKz5o5z.js";import{E as Je}from"./ellipsis-CYCkV2Pa.js";import{S as Ke}from"./square-pen-CgZnJT5s.js";import{T as Qe}from"./trash-2-Dt0_aFzc.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Dk5ovgNn.js";import"./index-DYtBqwXi.js";import"./floating-ui.vue-DhUnkJfc.js";import"./x-BpcUsJXn.js";import"./shield-Cyievtug.js";import"./user-Ca0ja34E.js";import"./chevron-right-CkT1ue1I.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-V01rVzxA.js";import"./VisuallyHidden-H3fpmsLx.js";import"./index-YHYyGAco.js";import"./Label.vue_vue_type_script_setup_true_lang-DCZhrf2e.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CwNj20AO.js";import"./index-CTkeagVR.js";import"./map-pin-D1rtVCPc.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-TmplCPgM.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BlnKZeFr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-CLsbi7q1.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BcP5joWp.js";import"./tag-euMStffd.js";import"./vote-D-ho2Upj.js";import"./folder-open-BwpEZUDw.js";import"./send-D6GePUDU.js";import"./file-text-CrhgvIVS.js";import"./briefcase-CdnBkwVO.js";import"./megaphone-BWKT3hAA.js";import"./user-check-Cjdi1Rn1.js";import"./clipboard-list-DeVxPgd5.js";import"./mail-Cjqn3QRK.js";import"./message-square-CtTij58U.js";import"./external-link-GRGCmSzE.js";import"./panel-left-CvMlf3oX.js";import"./check-DzU-qwfx.js";import"./index-C5GM-A1h.js";import"./nullish-CHIgUVhi.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=ke("CircleDotIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),Ye={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ze={class:"flex items-center justify-between"},et={class:"text-muted-foreground mt-2"},tt={class:"flex gap-2"},st={class:"grid gap-4 md:grid-cols-4"},at={class:"text-2xl font-bold"},ot={class:"text-xs text-muted-foreground mt-2"},lt={class:"text-2xl font-bold"},rt={class:"text-xs text-muted-foreground"},nt={class:"text-2xl font-bold"},it={class:"text-2xl font-bold"},dt={class:"flex items-center justify-between"},ut={class:"grid gap-4 md:grid-cols-4"},mt={class:"relative"},ft={class:"font-medium"},ct={key:0,class:"text-sm text-muted-foreground"},pt={key:1,class:"flex items-center gap-1 mt-1"},_t={class:"text-xs text-red-600"},vt={key:2,class:"flex items-center gap-1 mt-1"},gt={class:"text-xs text-orange-600"},ht={key:0,class:"flex items-center gap-2"},yt={class:"text-sm"},xt={key:1,class:"text-sm text-muted-foreground"},bt={class:"flex items-center gap-1"},$t={class:"text-sm"},kt={key:0,class:"flex items-center gap-1"},wt={class:"text-sm"},Ct={key:1,class:"text-sm text-muted-foreground"},Et={key:0,class:"flex items-center justify-between"},Vt={class:"text-sm text-muted-foreground"},Pt={class:"flex gap-2"},Ms=he({__name:"Index",props:{proyecto:{},hito:{},entregables:{},filters:{},resumenUsuarios:{},estados:{},prioridades:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canAssign:{type:Boolean}},setup(ae){var H,z,G,O,W;const u=ae,{toast:D}=Ne(),m=F(()=>Array.isArray(u.entregables)?{data:u.entregables,current_page:1,last_page:1,per_page:u.entregables.length,total:u.entregables.length,from:1,to:u.entregables.length}:u.entregables),w=x(((H=u.filters)==null?void 0:H.search)||""),C=x(((z=u.filters)==null?void 0:z.estado)||""),E=x(((G=u.filters)==null?void 0:G.prioridad)||""),R=x(((W=(O=u.filters)==null?void 0:O.responsable_id)==null?void 0:W.toString())||""),v=x([]),T=x(!1),oe=F(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:u.proyecto.nombre,href:`/admin/proyectos/${u.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${u.proyecto.id}/hitos`},{title:u.hito.nombre,href:`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}`},{title:"Entregables"}]),le=Re.debounce(()=>{j.get(`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}/entregables`,{search:w.value,estado:C.value,prioridad:E.value,responsable_id:R.value,page:1},{preserveState:!0,preserveScroll:!0})},300);ye([w,C,E,R],()=>{le()});const re=()=>{w.value="",C.value="",E.value="",R.value=""},ne=()=>{v.value.length===m.value.data.length?v.value=[]:v.value=m.value.data.map(o=>o.id)},ie=o=>v.value.includes(o),de=o=>{const s=v.value.indexOf(o);s>-1?v.value.splice(s,1):v.value.push(o)},ue=o=>{u.canComplete&&j.post(`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}/entregables/${o.id}/completar`,{notas_completado:`Completado por ${be().props.auth.user.name}`},{onSuccess:()=>{D.success("Entregable marcado como completado")},onError:()=>{D.error("Error al marcar el entregable como completado")}})},me=o=>{u.canDelete&&confirm(`¿Estás seguro de eliminar el entregable "${o.nombre}"?`)&&j.delete(`/admin/proyectos/${u.proyecto.id}/hitos/${u.hito.id}/entregables/${o.id}`,{onSuccess:()=>{D.success("Entregable eliminado correctamente")},onError:()=>{D.error("Error al eliminar el entregable")}})},fe=o=>({pendiente:"secondary",en_progreso:"default",completado:"success",cancelado:"destructive"})[o]||"secondary",ce=o=>({baja:"outline",media:"default",alta:"destructive"})[o]||"outline",pe=o=>o==="alta"?Pe:o==="baja"?Se:Xe,_e=o=>o?new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-",B=o=>{if(!o)return null;const s=new Date,y=new Date(o).getTime()-s.getTime();return Math.ceil(y/(1e3*60*60*24))},ve=F(()=>m.value.data.map(o=>({...o,diasRestantes:B(o.fecha_fin),estaVencido:o.fecha_fin&&B(o.fecha_fin)<0,estaProximoVencer:o.fecha_fin&&B(o.fecha_fin)>=0&&B(o.fecha_fin)<=7}))),h=F(()=>{const o=m.value.data,s=m.value.total,l=o.filter(V=>V.estado==="completado").length,y=o.filter(V=>V.estado==="en_progreso").length,ge=o.filter(V=>V.estado==="pendiente").length;return{total:s,completados:l,enProgreso:y,pendientes:ge,progreso:s>0?Math.round(l/s*100):0}});return(o,s)=>(i(),f($e,{breadcrumbs:oe.value},{default:a(()=>[r("div",Ye,[r("div",Ze,[r("div",null,[s[6]||(s[6]=r("h2",{class:"text-3xl font-bold tracking-tight"},"Entregables del Hito",-1)),r("p",et,d(o.hito.nombre)+" - "+d(o.proyecto.nombre),1)]),r("div",tt,[t(e(A),{href:`/admin/proyectos/${o.proyecto.id}/hitos`,as:"button"},{default:a(()=>[t(e(k),{variant:"outline"},{default:a(()=>[t(e(Ie),{class:"mr-2 h-4 w-4"}),s[7]||(s[7]=n(" Volver a Hitos ",-1))]),_:1})]),_:1},8,["href"]),o.canCreate?(i(),f(e(A),{key:0,href:`/admin/proyectos/${o.proyecto.id}/hitos/${o.hito.id}/entregables/create`,as:"button"},{default:a(()=>[t(e(k),null,{default:a(()=>[t(e(Le),{class:"mr-2 h-4 w-4"}),s[8]||(s[8]=n(" Nuevo Entregable ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])]),r("div",st,[t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[9]||(s[9]=[n("Total Entregables",-1)])]),_:1}),t(e(qe),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e($),null,{default:a(()=>[r("div",at,d(h.value.total),1),t(e(je),{value:h.value.progreso,class:"mt-2"},null,8,["value"]),r("p",ot,d(h.value.progreso)+"% completado ",1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[10]||(s[10]=[n("Completados",-1)])]),_:1}),t(e(se),{class:"h-4 w-4 text-green-600"})]),_:1}),t(e($),null,{default:a(()=>[r("div",lt,d(h.value.completados),1),r("p",rt," de "+d(h.value.total)+" entregables ",1)]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[11]||(s[11]=[n("En Progreso",-1)])]),_:1}),t(e(He),{class:"h-4 w-4 text-blue-600"})]),_:1}),t(e($),null,{default:a(()=>[r("div",nt,d(h.value.enProgreso),1),s[12]||(s[12]=r("p",{class:"text-xs text-muted-foreground"}," actualmente activos ",-1))]),_:1})]),_:1}),t(e(b),null,{default:a(()=>[t(e(P),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(S),{class:"text-sm font-medium"},{default:a(()=>[...s[13]||(s[13]=[n("Pendientes",-1)])]),_:1}),t(e(q),{class:"h-4 w-4 text-orange-600"})]),_:1}),t(e($),null,{default:a(()=>[r("div",it,d(h.value.pendientes),1),s[14]||(s[14]=r("p",{class:"text-xs text-muted-foreground"}," por iniciar ",-1))]),_:1})]),_:1})]),t(e(b),null,{default:a(()=>[t(e(P),null,{default:a(()=>[r("div",dt,[t(e(S),null,{default:a(()=>[...s[15]||(s[15]=[n("Entregables",-1)])]),_:1}),t(e(k),{variant:"outline",size:"sm",onClick:s[0]||(s[0]=l=>T.value=!T.value)},{default:a(()=>[t(e(ze),{class:"mr-2 h-4 w-4"}),n(" "+d(T.value?"Ocultar":"Mostrar")+" Filtros ",1)]),_:1})])]),_:1}),T.value?(i(),f(e($),{key:0,class:"space-y-4"},{default:a(()=>[r("div",ut,[r("div",null,[s[16]||(s[16]=r("label",{class:"text-sm font-medium"},"Buscar",-1)),r("div",mt,[t(e(Ge),{class:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),t(e(we),{modelValue:w.value,"onUpdate:modelValue":s[1]||(s[1]=l=>w.value=l),placeholder:"Buscar entregable...",class:"pl-8"},null,8,["modelValue"])])]),r("div",null,[s[18]||(s[18]=r("label",{class:"text-sm font-medium"},"Estado",-1)),t(e(Q),{modelValue:C.value,"onUpdate:modelValue":s[2]||(s[2]=l=>C.value=l)},{default:a(()=>[t(e(X),null,{default:a(()=>[t(e(Y),{placeholder:"Todos los estados"})]),_:1}),t(e(Z),null,{default:a(()=>[t(e(N),{value:""},{default:a(()=>[...s[17]||(s[17]=[n("Todos los estados",-1)])]),_:1}),(i(!0),c(U,null,M(o.estados,l=>(i(),f(e(N),{key:l.value,value:l.value},{default:a(()=>[n(d(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),r("div",null,[s[20]||(s[20]=r("label",{class:"text-sm font-medium"},"Prioridad",-1)),t(e(Q),{modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=l=>E.value=l)},{default:a(()=>[t(e(X),null,{default:a(()=>[t(e(Y),{placeholder:"Todas las prioridades"})]),_:1}),t(e(Z),null,{default:a(()=>[t(e(N),{value:""},{default:a(()=>[...s[19]||(s[19]=[n("Todas las prioridades",-1)])]),_:1}),(i(!0),c(U,null,M(o.prioridades,l=>(i(),f(e(N),{key:l.value,value:l.value},{default:a(()=>[n(d(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),r("div",null,[s[22]||(s[22]=r("label",{class:"text-sm font-medium"}," ",-1)),t(e(k),{onClick:re,variant:"outline",class:"w-full"},{default:a(()=>[...s[21]||(s[21]=[n(" Limpiar Filtros ",-1)])]),_:1})])])]),_:1})):p("",!0)]),_:1}),t(e(b),null,{default:a(()=>[t(e($),{class:"p-0"},{default:a(()=>[t(e(Ce),null,{default:a(()=>[t(e(Ee),null,{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(g),{class:"w-[40px]"},{default:a(()=>[t(e(te),{checked:v.value.length===m.value.data.length&&m.value.data.length>0,"onUpdate:checked":ne},null,8,["checked"])]),_:1}),t(e(g),null,{default:a(()=>[...s[23]||(s[23]=[n("Entregable",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[24]||(s[24]=[n("Responsable",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[25]||(s[25]=[n("Estado",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[26]||(s[26]=[n("Prioridad",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[27]||(s[27]=[n("Fecha Fin",-1)])]),_:1}),t(e(g),null,{default:a(()=>[...s[28]||(s[28]=[n("Colaboradores",-1)])]),_:1}),t(e(g),{class:"text-right"},{default:a(()=>[...s[29]||(s[29]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(Ve),null,{default:a(()=>[(i(!0),c(U,null,M(ve.value,l=>(i(),f(e(I),{key:l.id,class:"cursor-pointer hover:bg-muted/50"},{default:a(()=>[t(e(_),{onClick:s[4]||(s[4]=J(()=>{},["stop"]))},{default:a(()=>[t(e(te),{checked:ie(l.id),"onUpdate:checked":()=>de(l.id)},null,8,["checked","onUpdate:checked"])]),_:2},1024),t(e(A),{href:`/admin/proyectos/${o.proyecto.id}/hitos/${o.hito.id}/entregables/${l.id}`,class:"contents"},{default:a(()=>[t(e(_),null,{default:a(()=>[r("div",null,[r("p",ft,d(l.nombre),1),l.descripcion?(i(),c("p",ct,d(l.descripcion),1)):p("",!0),l.estaVencido?(i(),c("div",pt,[t(e(q),{class:"h-3 w-3 text-red-600"}),r("span",_t,"Vencido hace "+d(Math.abs(l.diasRestantes))+" días",1)])):l.estaProximoVencer?(i(),c("div",vt,[t(e(q),{class:"h-3 w-3 text-orange-600"}),r("span",gt,"Vence en "+d(l.diasRestantes)+" días",1)])):p("",!0)])]),_:2},1024),t(e(_),null,{default:a(()=>[l.responsable?(i(),c("div",ht,[t(e(Ae),{class:"h-8 w-8"},{default:a(()=>[l.responsable.avatar?(i(),f(e(Ue),{key:0,src:l.responsable.avatar},null,8,["src"])):p("",!0),t(e(Me),null,{default:a(()=>[n(d(l.responsable.name.substring(0,2).toUpperCase()),1)]),_:2},1024)]),_:2},1024),r("span",yt,d(l.responsable.name),1)])):(i(),c("span",xt,"Sin asignar"))]),_:2},1024),t(e(_),null,{default:a(()=>[t(e(K),{variant:fe(l.estado)},{default:a(()=>[n(d(l.estado_label),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(_),null,{default:a(()=>[t(e(K),{variant:ce(l.prioridad)},{default:a(()=>[(i(),f(xe(pe(l.prioridad)),{class:"mr-1 h-3 w-3"})),n(" "+d(l.prioridad_label),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(_),null,{default:a(()=>[r("div",bt,[t(e(Oe),{class:"h-4 w-4 text-muted-foreground"}),r("span",$t,d(_e(l.fecha_fin)),1)])]),_:2},1024),t(e(_),null,{default:a(()=>[l.usuarios&&l.usuarios.length>0?(i(),c("div",kt,[t(e(We),{class:"h-4 w-4 text-muted-foreground"}),r("span",wt,d(l.usuarios.length),1)])):(i(),c("span",Ct,"-"))]),_:2},1024)]),_:2},1032,["href"]),t(e(_),{class:"text-right",onClick:s[5]||(s[5]=J(()=>{},["stop"]))},{default:a(()=>[t(e(De),null,{default:a(()=>[t(e(Te),{"as-child":""},{default:a(()=>[t(e(k),{variant:"ghost",class:"h-8 w-8 p-0"},{default:a(()=>[s[30]||(s[30]=r("span",{class:"sr-only"},"Abrir menú",-1)),t(e(Je),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(Be),{align:"end"},{default:a(()=>[t(e(Fe),null,{default:a(()=>[...s[31]||(s[31]=[n("Acciones",-1)])]),_:1}),t(e(ee)),o.canEdit?(i(),f(e(A),{key:0,href:`/admin/proyectos/${o.proyecto.id}/hitos/${o.hito.id}/entregables/${l.id}/edit`,as:"button",class:"w-full"},{default:a(()=>[t(e(L),null,{default:a(()=>[t(e(Ke),{class:"mr-2 h-4 w-4"}),s[32]||(s[32]=n(" Editar ",-1))]),_:1})]),_:2},1032,["href"])):p("",!0),o.canComplete&&l.estado!=="completado"?(i(),f(e(L),{key:1,onClick:y=>ue(l)},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),s[33]||(s[33]=n(" Marcar como completado ",-1))]),_:2},1032,["onClick"])):p("",!0),o.canDelete?(i(),f(e(ee),{key:2})):p("",!0),o.canDelete?(i(),f(e(L),{key:3,onClick:y=>me(l),class:"text-red-600"},{default:a(()=>[t(e(Qe),{class:"mr-2 h-4 w-4"}),s[34]||(s[34]=n(" Eliminar ",-1))]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),m.value.data.length===0?(i(),f(e(I),{key:0},{default:a(()=>[t(e(_),{colspan:"8",class:"text-center py-8"},{default:a(()=>[...s[35]||(s[35]=[r("p",{class:"text-muted-foreground"},"No se encontraron entregables",-1)])]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),m.value.last_page>1?(i(),c("div",Et,[r("div",Vt," Mostrando "+d(m.value.from)+" a "+d(m.value.to)+" de "+d(m.value.total)+" entregables ",1),r("div",Pt,[(i(!0),c(U,null,M(m.value.last_page,l=>(i(),f(e(k),{key:l,variant:"outline",size:"sm",disabled:l===m.value.current_page,onClick:y=>e(j).get(`/admin/proyectos/${o.proyecto.id}/hitos/${o.hito.id}/entregables?page=${l}`)},{default:a(()=>[n(d(l),1)]),_:2},1032,["disabled","onClick"]))),128))])])):p("",!0)])]),_:1},8,["breadcrumbs"]))}});export{Ms as default};
