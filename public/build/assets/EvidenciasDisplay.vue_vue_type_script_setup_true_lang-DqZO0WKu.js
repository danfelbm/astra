import{c as M,_ as A}from"./createLucideIcon-BObe4JvD.js";import{d as J,r as b,c as V,i as g,F as D,b as v,j as h,e as t,f as a,w as s,k as j,g as r,h as i,t as u,s as z,m as c,v as q,l as K,n as Q}from"./app-CuPKNjRO.js";import{c as N,_ as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-B5M2cVcm.js";import{_ as I}from"./index-Dqfh2IyD.js";import{_ as W,a as X,b as U,c as p,d as Y,e as y}from"./TableHeader.vue_vue_type_script_setup_true_lang-BaMWRpbE.js";import{_ as Z,a as ee,b as ae,c as te,d as se}from"./AccordionContent.vue_vue_type_script_setup_true_lang-CbwP3dWK.js";import{e as oe,_ as le,a as ne,b as re,c as ie,d as de}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DKwkyUyS.js";import{_ as ue,a as ce,b as fe,c as me,d as B}from"./SelectValue.vue_vue_type_script_setup_true_lang-DLLNMJzF.js";import{_ as _e}from"./Textarea.vue_vue_type_script_setup_true_lang-PtJl9XZy.js";import{_ as ve}from"./Label.vue_vue_type_script_setup_true_lang-DWZMRsHf.js";import{t as F}from"./index-PFTinW9B.js";import{I as L}from"./image-C9xtCgLh.js";import{F as pe}from"./file-text-CjkSuqdh.js";import{E as ye}from"./external-link-D_zLUZe-.js";import{E as be}from"./eye-BtR-cUP7.js";import{D as xe}from"./download-C-96n0Y5.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=M("BanIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=M("CirclePauseIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=M("MilestoneIcon",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M4 6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h13a2 2 0 0 0 1.152-.365l3.424-2.317a1 1 0 0 0 0-1.635l-3.424-2.318A2 2 0 0 0 17 6z",key:"1btarq"}]]),ge={key:1,class:"mt-4"},he={class:"flex items-center justify-between w-full pr-4"},$e={class:"flex items-center gap-3"},ke={class:"text-left"},Ee={class:"font-semibold"},we={class:"text-sm text-gray-500"},ze={class:"flex items-center gap-3"},Ce={class:"text-sm text-gray-600"},Ve={class:"text-sm"},De={class:"flex items-center justify-end gap-2"},Ie=["href"],Be={class:"text-center"},Fe={class:"text-center"},Me={class:"space-y-4 py-4"},Ze=J({__name:"EvidenciasDisplay",props:{contratos:{default:()=>[]},proyectoId:{},modo:{},puedeGestionarEstado:{type:Boolean,default:!1},formatDate:{}},setup(m){const _=m,d=b({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),$=b(!1),C=b(null),f=b(null),k=b(""),x=b(!1),E=V(()=>{const o=[];return _.contratos&&_.contratos.forEach(e=>{e.obligaciones&&e.obligaciones.forEach(l=>{l.evidencias&&l.evidencias.forEach(n=>{o.push({...n,contrato_id:e.id,contrato_numero:e.numero_contrato,contrato_nombre:e.nombre,obligacion_titulo:l.titulo,_contrato:e})})})}),o}),R=V(()=>{let o=E.value;return d.value.contrato_id&&(o=o.filter(e=>e.contrato_id===d.value.contrato_id)),d.value.tipo&&(o=o.filter(e=>e.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(e=>e.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(e=>{var l;return((l=e.usuario)==null?void 0:l.id)===d.value.usuario_id})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(e=>{const l=new Date(e.created_at);if(d.value.fecha_inicio){const n=new Date(d.value.fecha_inicio);if(l<n)return!1}if(d.value.fecha_fin){const n=new Date(d.value.fecha_fin);if(n.setHours(23,59,59,999),l>n)return!1}return!0})),o}),S=V(()=>{const o={};return R.value.forEach(e=>{o[e.contrato_id]||(o[e.contrato_id]={contrato:e._contrato,evidencias:[]}),o[e.contrato_id].evidencias.push(e)}),Object.values(o)}),O=o=>_.modo==="admin"?`/admin/contratos/${o}`:`/miembro/mis-contratos/${o}`,T=(o,e)=>_.modo==="admin"?`/admin/contratos/${o}/evidencias/${e}`:`/miembro/mis-contratos/${o}/evidencias/${e}`,G=async()=>{if(!C.value||!f.value)return;x.value=!0;const o=`/api/proyectos/${_.proyectoId}/evidencias/${C.value.id}/${f.value}`;z.post(o,{observaciones:k.value||null},{preserveScroll:!0,onSuccess:()=>{F.success(f.value==="aprobar"?"Evidencia aprobada exitosamente":"Evidencia rechazada"),$.value=!1,C.value=null,f.value=null,k.value="",z.reload({only:["proyecto"]})},onError:e=>{F.error("Error al cambiar el estado de la evidencia"),console.error(e)},onFinish:()=>{x.value=!1}})},H=(o,e)=>{if(e===o.estado)return;const l=_.modo==="admin"?`/admin/proyectos/${_.proyectoId}/evidencias/${o.id}/cambiar-estado`:`/miembro/mis-proyectos/${_.proyectoId}/evidencias/${o.id}/cambiar-estado`;z.post(l,{estado:e,observaciones:null},{preserveScroll:!0,onSuccess:n=>{z.reload({only:["proyecto"]})},onError:n=>{F.error("Error al cambiar el estado"),console.error(n)}})};return(o,e)=>(c(),g(D,null,[E.value.length>0?(c(),v(Z,{key:0,modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),contratos:m.contratos||[],evidencias:E.value},null,8,["modelValue","contratos","evidencias"])):h("",!0),S.value.length>0?(c(),g("div",ge,[t(a(ee),{type:"multiple",class:"space-y-4",collapsible:""},{default:s(()=>[(c(!0),g(D,null,j(S.value,l=>(c(),v(a(ae),{key:l.contrato.id,value:`contrato-${l.contrato.id}`,class:"border rounded-lg bg-card"},{default:s(()=>[t(a(te),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:s(()=>[r("div",he,[r("div",$e,[t(a(pe),{class:"h-5 w-5 text-gray-500"}),r("div",ke,[r("div",Ee,u(l.contrato.nombre),1),r("div",we,u(l.contrato.numero_contrato||"Sin número"),1)])]),r("div",ze,[t(a(I),{variant:"secondary"},{default:s(()=>[i(u(l.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),t(a(q),{href:O(l.contrato.id),onClick:e[1]||(e[1]=K(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:s(()=>[e[5]||(e[5]=i(" Ver contrato ",-1)),t(a(ye),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),t(a(se),{class:"px-4 pb-4"},{default:s(()=>[t(a(W),null,{default:s(()=>[t(a(X),null,{default:s(()=>[t(a(U),null,{default:s(()=>[t(a(p),null,{default:s(()=>[...e[6]||(e[6]=[i("Tipo",-1)])]),_:1}),t(a(p),null,{default:s(()=>[...e[7]||(e[7]=[i("Obligación",-1)])]),_:1}),t(a(p),null,{default:s(()=>[...e[8]||(e[8]=[i("Descripción",-1)])]),_:1}),m.modo==="admin"?(c(),v(a(p),{key:0},{default:s(()=>[...e[9]||(e[9]=[i("Usuario",-1)])]),_:1})):h("",!0),t(a(p),null,{default:s(()=>[...e[10]||(e[10]=[i("Estado",-1)])]),_:1}),t(a(p),null,{default:s(()=>[...e[11]||(e[11]=[i("Fecha",-1)])]),_:1}),t(a(p),{class:"text-right"},{default:s(()=>[...e[12]||(e[12]=[i("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(a(Y),null,{default:s(()=>[(c(!0),g(D,null,j(l.evidencias,n=>(c(),v(a(U),{key:n.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:s(()=>[t(a(y),null,{default:s(()=>[t(a(I),{variant:"outline"},{default:s(()=>[i(u(n.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(a(y),null,{default:s(()=>[i(u(n.obligacion_titulo),1)]),_:2},1024),t(a(y),null,{default:s(()=>[r("span",Ce,u(n.descripcion||"-"),1)]),_:2},1024),m.modo==="admin"?(c(),v(a(y),{key:0},{default:s(()=>{var w;return[r("span",Ve,u(((w=n.usuario)==null?void 0:w.name)||"-"),1)]}),_:2},1024)):h("",!0),t(a(y),null,{default:s(()=>[t(a(I),{class:Q({"bg-yellow-100 text-yellow-800":n.estado==="pendiente","bg-green-100 text-green-800":n.estado==="aprobada","bg-red-100 text-red-800":n.estado==="rechazada"})},{default:s(()=>[i(u(n.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(a(y),null,{default:s(()=>[i(u(m.formatDate(n.created_at)),1)]),_:2},1024),t(a(y),{class:"text-right"},{default:s(()=>[r("div",De,[t(a(q),{href:T(n.contrato_id,n.id),class:"inline-flex items-center text-blue-600 hover:text-blue-800"},{default:s(()=>[t(a(be),{class:"h-4 w-4"})]),_:1},8,["href"]),n.archivo_url?(c(),g("a",{key:0,href:n.archivo_url,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800"},[t(a(xe),{class:"h-4 w-4"})],8,Ie)):h("",!0),m.modo==="admin"||m.modo==="user"&&m.puedeGestionarEstado?(c(),v(a(ue),{key:1,"model-value":n.estado,"onUpdate:modelValue":w=>H(n,w)},{default:s(()=>[t(a(ce),{class:"h-8 w-32"},{default:s(()=>[t(a(fe))]),_:1}),t(a(me),null,{default:s(()=>[t(a(B),{value:"pendiente"},{default:s(()=>[...e[13]||(e[13]=[r("span",{class:"text-yellow-600"},"Pendiente",-1)])]),_:1}),t(a(B),{value:"aprobada"},{default:s(()=>[...e[14]||(e[14]=[r("span",{class:"text-green-600"},"Aprobada",-1)])]),_:1}),t(a(B),{value:"rechazada"},{default:s(()=>[...e[15]||(e[15]=[r("span",{class:"text-red-600"},"Rechazada",-1)])]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):h("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):E.value.length===0?(c(),v(a(P),{key:2,class:"mt-4"},{default:s(()=>[t(a(N),{class:"py-8"},{default:s(()=>[r("div",Be,[t(a(L),{class:"mx-auto h-12 w-12 text-gray-400"}),e[16]||(e[16]=r("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias cargadas",-1)),e[17]||(e[17]=r("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(c(),v(a(P),{key:3,class:"mt-4"},{default:s(()=>[t(a(N),{class:"py-8"},{default:s(()=>[r("div",Fe,[t(a(L),{class:"mx-auto h-12 w-12 text-gray-400"}),e[18]||(e[18]=r("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),e[19]||(e[19]=r("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1})),t(a(oe),{open:$.value,"onUpdate:open":e[4]||(e[4]=l=>$.value=l)},{default:s(()=>[t(a(le),null,{default:s(()=>[t(a(ne),null,{default:s(()=>[t(a(re),null,{default:s(()=>[i(u(f.value==="aprobar"?"Aprobar Evidencia":"Rechazar Evidencia"),1)]),_:1}),t(a(ie),null,{default:s(()=>[i(u(f.value==="aprobar"?"Estás a punto de aprobar esta evidencia. Puedes agregar observaciones opcionales.":"Estás a punto de rechazar esta evidencia. Es recomendable agregar el motivo del rechazo."),1)]),_:1})]),_:1}),r("div",Me,[r("div",null,[t(a(ve),{for:"observaciones"},{default:s(()=>[i(" Observaciones "+u(f.value==="rechazar"?"(recomendado)":"(opcional)"),1)]),_:1}),t(a(_e),{id:"observaciones",modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=l=>k.value=l),placeholder:f.value==="rechazar"?"Explica el motivo del rechazo...":"Agrega comentarios adicionales...",rows:"4",class:"mt-2"},null,8,["modelValue","placeholder"])])]),t(a(de),null,{default:s(()=>[t(a(A),{variant:"outline",onClick:e[3]||(e[3]=l=>$.value=!1),disabled:x.value},{default:s(()=>[...e[20]||(e[20]=[i(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(a(A),{variant:f.value==="aprobar"?"default":"destructive",onClick:G,disabled:x.value},{default:s(()=>[i(u(x.value?"Procesando...":f.value==="aprobar"?"Aprobar":"Rechazar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])],64))}});export{We as B,Xe as C,Ye as M,Ze as _};
