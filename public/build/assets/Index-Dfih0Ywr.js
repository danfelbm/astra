import{_ as ze}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BJpgPWDW.js";import{d as ae,r as T,c as re,I as Ce,i as f,g as n,j as y,e as t,y as Ee,l as ge,f as e,n as N,b as _,h as r,t as v,w as a,F as P,k as M,m as o,o as Ve,a as be,p as Ue,u as ye,q as je,s as ie}from"./app-DsXE2pWc.js";import{_ as K,a as Y,b as te,c as X}from"./CardTitle.vue_vue_type_script_setup_true_lang-xy0V8ZYM.js";import{_ as C}from"./createLucideIcon-DouqM7Af.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-CZjvqwkd.js";import{_ as G}from"./Label.vue_vue_type_script_setup_true_lang-BTG0OZau.js";import{_ as R}from"./index-y46K_9sH.js";import{_ as Pe,a as Le,b as ee,c as W,d as Ae,e as I}from"./TableHeader.vue_vue_type_script_setup_true_lang-B19sEPdQ.js";import{C as De,_ as de,a as ue,b as ce,c as me,d as fe}from"./SelectValue.vue_vue_type_script_setup_true_lang-D3WTtkQ-.js";import{t as S}from"./index-m72Zk-4d.js";import{_ as He,a as Be,b as Me,c as Re,d as Fe,e as _e}from"./index-HQdd8uCJ.js";import{_ as Oe,a as Ge,b as Xe}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-C65_02EH.js";import{C as ne}from"./chevron-right-B6Xp79RV.js";import{C as Se}from"./check-D5piUvgk.js";import{C as Je}from"./chevrons-up-down-BPosUKQo.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as Ke}from"./pen-BfM-LOqM.js";import{T as xe}from"./trash-2-DYWzh1AW.js";import{u as Qe}from"./useEtiquetaHierarchy-X13mFDOt.js";import{S as We}from"./search-BN_4pExK.js";import{L as Ye}from"./loader-circle-mh6hscsc.js";import{_ as Ze,a as et,b as he,c as ke}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-D0nylEol.js";import{P as ve}from"./plus-dUDcGxZl.js";import{S as se}from"./save-DE_--76W.js";import{X as oe}from"./x-yKNShXT9.js";import{L as tt}from"./list-BCgqv5bX.js";import{T as at}from"./tree-pine-aPzpyjPF.js";import{T as pe}from"./tag-BkqJ0RJe.js";import{S as $e}from"./square-pen-BeM5JM7c.js";import"./useFlashMessages-CGfrcOeM.js";import"./index-DAR7lzPI.js";import"./floating-ui.vue-DzTgyoI6.js";import"./index-CeQoWpaA.js";import"./shield-DACf9x8q.js";import"./user-DCuOmdtA.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DjLWJI2c.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-RKJOy7-G.js";import"./VisuallyHidden-CMJYJfaX.js";import"./index-t5DUeMD0.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CM1CkMqd.js";import"./circle-alert-BRENL4vk.js";import"./map-pin-B6p31ase.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-D5oklv-b.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-CwKfbOu2.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-hHg2FrHb.js";import"./users-BYEo5yWZ.js";import"./target-JnPkIZyO.js";import"./vote-D7d78Kwy.js";import"./folder-open-CijtWzyH.js";import"./send-CB1yZuS_.js";import"./file-text-DfLCxJYs.js";import"./briefcase-BJhP6bZE.js";import"./calendar-DIP-jwI8.js";import"./megaphone-BvWbwmeA.js";import"./user-check-5cFJ_Y_Z.js";import"./clipboard-list-D4NcI0fM.js";import"./mail-Ch1JxZzN.js";import"./message-square-C7bp91Te.js";import"./external-link-Cmz6L_Z6.js";import"./panel-left-BiPU9AaT.js";import"./index-BUTl1shx.js";import"./useKbd-kRIii9yh.js";import"./utils-BNLTfb3r.js";import"./VisuallyHiddenInput-ozqQFXsy.js";import"./RovingFocusItem-K_X8Xq8j.js";const lt={class:"flex items-center w-full"},st={key:1,class:"w-5"},ot={class:"flex-1 min-w-0"},rt={class:"truncate"},nt={key:0,class:"text-xs text-muted-foreground ml-1"},it={key:0,class:"text-xs text-muted-foreground ml-1"},dt=ae({__name:"EtiquetaTreeItem",props:{etiqueta:{},nivel:{default:0},selectedId:{},excludedId:{},showCategoria:{type:Boolean,default:!1}},emits:["select"],setup(s,{emit:H}){const b=s,z=H,x=T(b.nivel<2),k=re(()=>b.excludedId?b.etiqueta.id===b.excludedId:!1),$=()=>{x.value=!x.value},D=E=>{k.value||z("select",E)};return(E,u)=>{const d=Ce("EtiquetaTreeItem",!0);return o(),f("div",null,[n("div",{class:N(["relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",{"opacity-50":k.value}]),onClick:u[0]||(u[0]=()=>!k.value&&D(s.etiqueta))},[n("div",lt,[n("span",{class:"flex-shrink-0",style:Ee({width:`${s.nivel*20}px`})},null,4),s.etiqueta.children&&s.etiqueta.children.length>0?(o(),f("button",{key:0,onClick:ge($,["stop"]),class:"mr-1 p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ne),{class:N(["h-3 w-3 transition-transform",x.value?"rotate-90":""])},null,8,["class"])])):(o(),f("span",st)),t(e(Se),{class:N(["mr-2 h-4 w-4 flex-shrink-0",s.selectedId===s.etiqueta.id?"opacity-100":"opacity-0"])},null,8,["class"]),n("div",ot,[n("span",rt,[r(v(s.etiqueta.nombre)+" ",1),s.showCategoria&&s.etiqueta.categoria?(o(),f("span",nt," ("+v(s.etiqueta.categoria.nombre)+") ",1)):y("",!0)]),s.etiqueta.children&&s.etiqueta.children.length>0?(o(),f("span",it," ("+v(s.etiqueta.children.length)+") ",1)):y("",!0),s.etiqueta.usos_count>0?(o(),_(e(R),{key:1,variant:"secondary",class:"ml-2 text-xs"},{default:a(()=>[r(v(s.etiqueta.usos_count)+" usos ",1)]),_:1})):y("",!0)])])],2),x.value&&s.etiqueta.children?(o(!0),f(P,{key:0},M(s.etiqueta.children,q=>(o(),_(d,{key:q.id,etiqueta:q,nivel:s.nivel+1,"selected-id":s.selectedId,"excluded-id":s.excludedId,"show-categoria":s.showCategoria,onSelect:D},null,8,["etiqueta","nivel","selected-id","excluded-id","show-categoria"]))),128)):y("",!0)])}}}),ut={class:"etiqueta-hierarchy-selector"},ct={key:0,class:"truncate"},mt={key:0,class:"text-muted-foreground text-xs mr-1"},ft={key:1,class:"text-muted-foreground"},vt={key:0,class:"text-xs text-muted-foreground mt-1"},pt=ae({__name:"EtiquetaHierarchySelector",props:{modelValue:{},label:{default:"Etiqueta Padre"},placeholder:{default:"Seleccionar etiqueta padre..."},allowNull:{type:Boolean,default:!0},excludedId:{},categorias:{},id:{default:"etiqueta-padre"}},emits:["update:modelValue"],setup(s,{emit:H}){const b=s,z=H,x=T(!1),k=T(""),$=T([]),D=T(!1),E=re(()=>b.modelValue&&$.value.find(p=>p.id===b.modelValue)||null),u=re(()=>b.categorias?k.value?b.categorias.filter(p=>q(p.id).some(g=>g.nombre.toLowerCase().includes(k.value.toLowerCase())||g.descripcion&&g.descripcion.toLowerCase().includes(k.value.toLowerCase()))):b.categorias:[]),d=p=>$.value.filter(g=>g.categoria_etiqueta_id===p&&!g.parent_id&&g.id!==b.excludedId),q=p=>$.value.filter(g=>g.categoria_etiqueta_id===p&&g.id!==b.excludedId),J=p=>{const g=[p.nombre];let V=p;for(;V.parent_id;){const A=$.value.find(Q=>Q.id===V.parent_id);if(!A)break;g.unshift(A.nombre),V=A}return g.join(" / ")},L=async()=>{D.value=!0;try{const p=await be.get("/admin/etiquetas/para-selector",{params:{excluir_id:b.excludedId}});p.data.success&&($.value=p.data.etiquetas)}catch(p){console.error("Error cargando etiquetas:",p)}finally{D.value=!1}},U=p=>{z("update:modelValue",(p==null?void 0:p.id)||null),x.value=!1};return Ve(()=>{L()}),(p,g)=>(o(),f("div",ut,[t(e(G),{for:s.id},{default:a(()=>[r(v(s.label),1)]),_:1},8,["for"]),t(e(Oe),{open:x.value,"onUpdate:open":g[2]||(g[2]=V=>x.value=V)},{default:a(()=>[t(e(Ge),{asChild:""},{default:a(()=>[t(e(C),{id:s.id,variant:"outline",role:"combobox","aria-expanded":x.value,"aria-label":s.label,class:"w-full justify-between"},{default:a(()=>[E.value?(o(),f("span",ct,[E.value.parent?(o(),f("span",mt,v(E.value.parent.nombre)+" / ",1)):y("",!0),r(" "+v(E.value.nombre),1)])):(o(),f("span",ft,v(s.placeholder),1)),t(e(Je),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["id","aria-expanded","aria-label"])]),_:1}),t(e(Xe),{class:"w-[400px] p-0"},{default:a(()=>[t(e(He),null,{default:a(()=>[t(e(Be),{placeholder:"Buscar etiqueta...",modelValue:k.value,"onUpdate:modelValue":g[0]||(g[0]=V=>k.value=V)},null,8,["modelValue"]),t(e(Me),null,{default:a(()=>[t(e(Re),null,{default:a(()=>[...g[3]||(g[3]=[r("No se encontraron etiquetas.",-1)])]),_:1}),s.allowNull?(o(),_(e(_e),{key:0},{default:a(()=>[t(e(Fe),{value:"",onSelect:g[1]||(g[1]=V=>U(null))},{default:a(()=>[t(e(Se),{class:N(["mr-2 h-4 w-4",s.modelValue?"opacity-0":"opacity-100"])},null,8,["class"]),g[4]||(g[4]=n("span",{class:"text-muted-foreground"},"Sin etiqueta padre (raíz)",-1))]),_:1})]),_:1})):y("",!0),(o(!0),f(P,null,M(u.value,V=>(o(),_(e(_e),{key:V.id,heading:V.nombre},{default:a(()=>[(o(!0),f(P,null,M(d(V.id),A=>(o(),_(dt,{key:A.id,etiqueta:A,nivel:0,"selected-id":s.modelValue,"excluded-id":s.excludedId,onSelect:U},null,8,["etiqueta","selected-id","excluded-id"]))),128))]),_:2},1032,["heading"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),E.value?(o(),f("p",vt," Ruta: "+v(J(E.value)),1)):y("",!0)]))}}),we=qe(pt,[["__scopeId","data-v-bcdf1be4"]]),gt={class:"tree-node"},bt={key:1,class:"w-5"},xt={class:"flex-1 font-medium"},qt={key:0,class:"text-xs text-muted-foreground ml-1"},yt={class:"flex gap-1"},_t={class:"flex gap-1"},ht={key:0},kt=ae({__name:"EtiquetaTreeNode",props:{etiqueta:{},nivel:{default:0},expandidos:{},dragDropHelpers:{}},emits:["toggle","edit","delete","drop"],setup(s,{emit:H}){const b=s,z=H,x=T(!1),k=d=>{d.dataTransfer.effectAllowed="move",b.dragDropHelpers.handleDragStart(b.etiqueta)},$=d=>{d.preventDefault(),d.dataTransfer.dropEffect="move",x.value=!0,b.dragDropHelpers.handleDragOver(d,b.etiqueta)},D=()=>{x.value=!1},E=d=>{d.preventDefault(),d.stopPropagation(),x.value=!1;const q=b.dragDropHelpers.handleDrop(d,b.etiqueta);q&&q.valido&&z("drop",q)},u=()=>{x.value=!1,b.dragDropHelpers.handleDragEnd()};return(d,q)=>{var L;const J=Ce("EtiquetaTreeNode",!0);return o(),f("div",gt,[n("div",{class:N(["flex items-center gap-2 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700","transition-colors cursor-move",x.value?"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-300":""]),style:Ee({paddingLeft:s.nivel*24+"px"}),draggable:"true",onDragstart:k,onDragover:$,onDrop:E,onDragend:u,onDragleave:D},[s.etiqueta.children&&s.etiqueta.children.length>0?(o(),f("button",{key:0,onClick:q[0]||(q[0]=U=>d.$emit("toggle",s.etiqueta.id)),class:"p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ne),{class:N(["h-4 w-4 transition-transform",s.expandidos.has(s.etiqueta.id)?"rotate-90":""])},null,8,["class"])])):(o(),f("span",bt)),(L=s.etiqueta.categoria)!=null&&L.color?(o(),f("div",{key:2,class:N(["w-3 h-3 rounded-full",s.etiqueta.categoria.color])},null,2)):y("",!0),n("span",xt,[r(v(s.etiqueta.nombre)+" ",1),s.etiqueta.categoria?(o(),f("span",qt," ("+v(s.etiqueta.categoria.nombre)+") ",1)):y("",!0)]),n("div",yt,[s.etiqueta.usos_count>0?(o(),_(e(R),{key:0,variant:"secondary",class:"text-xs"},{default:a(()=>[r(v(s.etiqueta.usos_count)+" usos ",1)]),_:1})):y("",!0),s.etiqueta.children&&s.etiqueta.children.length>0?(o(),_(e(R),{key:1,variant:"outline",class:"text-xs"},{default:a(()=>[r(v(s.etiqueta.children.length),1)]),_:1})):y("",!0)]),n("div",_t,[t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7",onClick:q[1]||(q[1]=ge(U=>d.$emit("edit",s.etiqueta),["stop"]))},{default:a(()=>[t(e(Ke),{class:"h-3 w-3"})]),_:1}),t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-500 hover:text-red-600",onClick:q[2]||(q[2]=ge(U=>d.$emit("delete",s.etiqueta),["stop"]))},{default:a(()=>[t(e(xe),{class:"h-3 w-3"})]),_:1})])],38),s.expandidos.has(s.etiqueta.id)&&s.etiqueta.children?(o(),f("div",ht,[(o(!0),f(P,null,M(s.etiqueta.children,U=>(o(),_(J,{key:U.id,etiqueta:U,nivel:s.nivel+1,expandidos:s.expandidos,"drag-drop-helpers":s.dragDropHelpers,onToggle:q[3]||(q[3]=p=>d.$emit("toggle",p)),onEdit:q[4]||(q[4]=p=>d.$emit("edit",p)),onDelete:q[5]||(q[5]=p=>d.$emit("delete",p)),onDrop:q[6]||(q[6]=p=>d.$emit("drop",p))},null,8,["etiqueta","nivel","expandidos","drag-drop-helpers"]))),128))])):y("",!0)])}}}),$t=qe(kt,[["__scopeId","data-v-b5f23538"]]),wt={class:"etiqueta-tree-view"},Ct={class:"mb-4 flex gap-2 items-center"},Et={class:"ml-auto flex items-center gap-2"},Vt={class:"border rounded-lg p-4 bg-white dark:bg-gray-800"},Dt={key:0,class:"flex justify-center py-8"},St={key:1,class:"text-center py-8 text-muted-foreground"},Tt={key:2,class:"space-y-1"},It={key:0,class:"mt-4 grid grid-cols-4 gap-4"},Nt={class:"text-2xl font-bold"},zt={class:"text-2xl font-bold"},Ut={class:"text-2xl font-bold"},jt={class:"text-2xl font-bold"},Pt=ae({__name:"EtiquetaTreeView",props:{etiquetas:{},categoriaId:{},showStats:{type:Boolean,default:!1}},emits:["edit","delete","moved"],setup(s,{emit:H}){const b=s,z=H,x=T(!1),k=T(""),$=T([]),{etiquetas:D,expandidos:E,estadisticas:u,construirArbol:d,filtrarArbol:q,toggleExpansion:J,expandirTodos:L,colapsarTodos:U,dragDropHelpers:p}=Qe($),g=async()=>{if(b.etiquetas){$.value=d(b.etiquetas);return}x.value=!0;try{const w=await be.get("/admin/etiquetas/arbol",{params:{categoria_id:b.categoriaId}});w.data.success&&($.value=w.data.arbol)}catch(w){console.error("Error cargando árbol de etiquetas:",w),S.error("Error al cargar las etiquetas")}finally{x.value=!1}},V=re(()=>k.value?q(k.value,D.value):D.value);let A;const Q=()=>{clearTimeout(A),A=setTimeout(()=>{},300)},le=async w=>{var h,F;if(w.valido){x.value=!0;try{(await be.post(`/admin/etiquetas/${w.hijoId}/establecer-padre`,{parent_id:w.padreId})).data.success&&(S.success("Etiqueta movida exitosamente"),z("moved",{etiquetaId:w.hijoId,nuevoPadreId:w.padreId}),await g())}catch(O){S.error(((F=(h=O.response)==null?void 0:h.data)==null?void 0:F.message)||"Error al mover la etiqueta")}finally{x.value=!1}}};return Ue(()=>b.etiquetas,w=>{w&&($.value=d(w))}),Ve(()=>{g()}),(w,h)=>(o(),f("div",wt,[n("div",Ct,[t(e(B),{modelValue:k.value,"onUpdate:modelValue":h[0]||(h[0]=F=>k.value=F),placeholder:"Buscar etiquetas...",class:"max-w-sm",onInput:Q},{prefix:a(()=>[t(e(We),{class:"h-4 w-4 text-muted-foreground"})]),_:1},8,["modelValue"]),t(e(C),{variant:"outline",size:"sm",onClick:e(L)},{default:a(()=>[t(e(De),{class:"h-4 w-4 mr-1"}),h[3]||(h[3]=r(" Expandir todo ",-1))]),_:1},8,["onClick"]),t(e(C),{variant:"outline",size:"sm",onClick:e(U)},{default:a(()=>[t(e(ne),{class:"h-4 w-4 mr-1"}),h[4]||(h[4]=r(" Colapsar todo ",-1))]),_:1},8,["onClick"]),n("div",Et,[t(e(R),{variant:"secondary"},{default:a(()=>[r(v(e(u).totalNodos)+" etiquetas",1)]),_:1}),t(e(R),{variant:"outline"},{default:a(()=>[r(v(e(u).profundidadMaxima)+" niveles",1)]),_:1})])]),n("div",Vt,[x.value?(o(),f("div",Dt,[t(e(Ye),{class:"h-8 w-8 animate-spin text-muted-foreground"})])):V.value.length===0?(o(),f("div",St," No se encontraron etiquetas ")):(o(),f("div",Tt,[(o(!0),f(P,null,M(V.value,F=>(o(),_($t,{key:F.id,etiqueta:F,nivel:0,expandidos:e(E),"drag-drop-helpers":e(p),onToggle:e(J),onEdit:h[1]||(h[1]=O=>w.$emit("edit",O)),onDelete:h[2]||(h[2]=O=>w.$emit("delete",O)),onDrop:le},null,8,["etiqueta","expandidos","drag-drop-helpers","onToggle"]))),128))]))]),s.showStats?(o(),f("div",It,[t(e(K),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(te),{class:"text-sm font-medium"},{default:a(()=>[...h[5]||(h[5]=[r("Total",-1)])]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[n("div",Nt,v(e(u).totalNodos),1)]),_:1})]),_:1}),t(e(K),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(te),{class:"text-sm font-medium"},{default:a(()=>[...h[6]||(h[6]=[r("Raíces",-1)])]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[n("div",zt,v(e(u).totalRaices),1)]),_:1})]),_:1}),t(e(K),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(te),{class:"text-sm font-medium"},{default:a(()=>[...h[7]||(h[7]=[r("Con hijos",-1)])]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[n("div",Ut,v(e(u).totalConHijos),1)]),_:1})]),_:1}),t(e(K),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(te),{class:"text-sm font-medium"},{default:a(()=>[...h[8]||(h[8]=[r("Profundidad",-1)])]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[n("div",jt,v(e(u).profundidadMaxima),1)]),_:1})]),_:1})])):y("",!0)]))}}),Lt=qe(Pt,[["__scopeId","data-v-e813d647"]]),At={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ht={class:"flex justify-between items-center"},Bt={class:"space-y-4"},Mt={key:0,class:"text-xs text-red-500 mt-1"},Rt={class:"flex items-center gap-2"},Ft={class:"flex items-center gap-2"},Ot={class:"flex gap-2 mt-4"},Gt={class:"flex items-center"},Xt={class:"flex items-center gap-2"},Jt={class:"flex items-center gap-2"},Kt={class:"flex justify-end gap-2"},Qt={class:"flex items-center gap-2"},Wt={class:"flex items-center gap-2"},Yt={class:"flex justify-end gap-2"},Zt={class:"p-4 space-y-4"},ea={class:"flex items-center justify-between"},ta={class:"font-medium flex items-center gap-2"},aa={class:"space-y-4"},la={class:"flex gap-2 mt-4"},sa={key:1,class:"space-y-2"},oa={key:0,class:"flex-1"},ra={class:"space-y-4"},na={class:"flex gap-2"},ia={key:1,class:"flex-1 flex items-center justify-between"},da={class:"flex items-center gap-2"},ua={class:"font-medium"},ca={key:0,class:"text-sm text-gray-500"},ma={key:1,class:"text-xs text-muted-foreground mt-1"},fa={class:"flex gap-2"},va={key:2,class:"text-center py-8 text-gray-500"},Cl=ae({__name:"Index",props:{categorias:{},estadisticas:{},colores:{},iconos:{}},setup(s){const H=s,b=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:"Categorías de Etiquetas",href:"/admin/categorias-etiquetas"}],z=T(null),x=T(!1),k=T(new Set),$=T(null),D=T(null),E=T("table"),u=ye({nombre:"",color:"gray",icono:"Tag",descripcion:"",orden:0}),d=ye({nombre:"",descripcion:"",categoria_etiqueta_id:0,parent_id:null}),q=()=>{x.value=!0,z.value=null,u.reset()},J=m=>{z.value=m.id,x.value=!1,u.nombre=m.nombre,u.color=m.color,u.icono=m.icono||"Tag",u.descripcion=m.descripcion||"",u.orden=m.orden},L=()=>{z.value=null,x.value=!1,u.reset()},U=()=>{u.post("/admin/categorias-etiquetas",{preserveScroll:!0,onSuccess:()=>{S.success("Categoría creada exitosamente"),L()},onError:()=>{S.error("Error al crear la categoría")}})},p=m=>{u.put(`/admin/categorias-etiquetas/${m}`,{preserveScroll:!0,onSuccess:()=>{S.success("Categoría actualizada"),L()},onError:()=>{S.error("Error al actualizar")}})},g=m=>{confirm(`¿Eliminar la categoría "${m.nombre}"? Las etiquetas se reasignarán.`)&&ie.delete(`/admin/categorias-etiquetas/${m.id}`,{preserveScroll:!0,onSuccess:()=>{S.success("Categoría eliminada")}})},V=m=>{ie.patch(`/admin/categorias-etiquetas/${m.id}/toggle-active`,{},{preserveScroll:!0,onSuccess:()=>{S.success(m.activo?"Categoría desactivada":"Categoría activada")}})},A=m=>{const l=k.value;l.has(m)?l.delete(m):l.add(m)},Q=m=>{$.value=m,D.value=null,d.reset(),d.categoria_etiqueta_id=m},le=m=>{D.value=m.id,$.value=null,d.nombre=m.nombre,d.descripcion=m.descripcion||"",d.categoria_etiqueta_id=m.categoria_etiqueta_id,d.parent_id=m.parent_id||null},w=()=>{$.value=null,D.value=null,d.reset()},h=()=>{d.post("/admin/etiquetas",{preserveScroll:!0,onSuccess:()=>{S.success("Etiqueta creada exitosamente"),w()},onError:()=>{S.error("Error al crear la etiqueta")}})},F=m=>{d.put(`/admin/etiquetas/${m}`,{preserveScroll:!0,onSuccess:()=>{S.success("Etiqueta actualizada exitosamente"),w()},onError:()=>{S.error("Error al actualizar la etiqueta")}})},O=m=>{confirm("¿Estás seguro de eliminar esta etiqueta?")&&ie.delete(`/admin/etiquetas/${m}`,{preserveScroll:!0,onSuccess:()=>{S.success("Etiqueta eliminada exitosamente")},onError:()=>{S.error("Error al eliminar la etiqueta")}})},Z=m=>({gray:"bg-gray-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",yellow:"bg-yellow-500",lime:"bg-lime-500",green:"bg-green-500",emerald:"bg-emerald-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",blue:"bg-blue-500",indigo:"bg-indigo-500",violet:"bg-violet-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"})[m]||"bg-gray-500",Te=()=>{const m=[];return H.categorias.data.forEach(l=>{l.etiquetas&&l.etiquetas.forEach(i=>{m.push({...i,categoria:{id:l.id,nombre:l.nombre,color:l.color,icono:l.icono,descripcion:l.descripcion,orden:l.orden,activo:l.activo}})})}),m},Ie=m=>{const l=H.categorias.data.find(i=>i.id===m.categoria_etiqueta_id);l&&(k.value.add(l.id),E.value="table",le(m))},Ne=m=>{O(m.id)};return(m,l)=>(o(),f(P,null,[t(e(je),{title:"Categorías de Etiquetas"}),t(ze,{breadcrumbs:b},{default:a(()=>[n("div",At,[n("div",Ht,[l[16]||(l[16]=n("div",null,[n("h1",{class:"text-2xl font-bold"},"Categorías de Etiquetas"),n("p",{class:"text-sm text-muted-foreground mt-1"}," Administra las categorías para organizar las etiquetas de proyectos ")],-1)),x.value?y("",!0):(o(),_(e(C),{key:0,onClick:q},{default:a(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),l[15]||(l[15]=r(" Nueva Categoría ",-1))]),_:1}))]),x.value?(o(),_(e(K),{key:0},{default:a(()=>[t(e(Y),null,{default:a(()=>[t(e(te),null,{default:a(()=>[...l[17]||(l[17]=[r("Nueva Categoría",-1)])]),_:1})]),_:1}),t(e(X),null,{default:a(()=>[n("div",Bt,[n("div",null,[t(e(G),null,{default:a(()=>[...l[18]||(l[18]=[r("Nombre *",-1)])]),_:1}),t(e(B),{modelValue:e(u).nombre,"onUpdate:modelValue":l[0]||(l[0]=i=>e(u).nombre=i),placeholder:"Nombre de la categoría",class:N({"border-red-500":e(u).errors.nombre})},null,8,["modelValue","class"]),e(u).errors.nombre?(o(),f("p",Mt,v(e(u).errors.nombre),1)):y("",!0)]),n("div",null,[t(e(G),null,{default:a(()=>[...l[19]||(l[19]=[r("Color",-1)])]),_:1}),t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[1]||(l[1]=i=>e(u).color=i)},{default:a(()=>[t(e(ue),null,{default:a(()=>[n("div",Rt,[n("div",{class:N([Z(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(ce),{placeholder:e(u).color},null,8,["placeholder"])])]),_:1}),t(e(me),null,{default:a(()=>[(o(!0),f(P,null,M(s.colores,(i,c)=>(o(),_(e(fe),{key:c,value:c},{default:a(()=>[n("div",Ft,[n("div",{class:N([Z(c),"w-4 h-4 rounded"])},null,2),r(" "+v(i),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),n("div",null,[t(e(G),null,{default:a(()=>[...l[20]||(l[20]=[r("Icono",-1)])]),_:1}),t(e(de),{modelValue:e(u).icono,"onUpdate:modelValue":l[2]||(l[2]=i=>e(u).icono=i)},{default:a(()=>[t(e(ue),null,{default:a(()=>[t(e(ce),{placeholder:e(u).icono},null,8,["placeholder"])]),_:1}),t(e(me),null,{default:a(()=>[(o(!0),f(P,null,M(s.iconos,(i,c)=>(o(),_(e(fe),{key:c,value:c},{default:a(()=>[r(v(i),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),n("div",null,[t(e(G),null,{default:a(()=>[...l[21]||(l[21]=[r("Orden",-1)])]),_:1}),t(e(B),{modelValue:e(u).orden,"onUpdate:modelValue":l[3]||(l[3]=i=>e(u).orden=i),modelModifiers:{number:!0},type:"number",placeholder:"0"},null,8,["modelValue"])]),n("div",null,[t(e(G),null,{default:a(()=>[...l[22]||(l[22]=[r("Descripción",-1)])]),_:1}),t(e(B),{modelValue:e(u).descripcion,"onUpdate:modelValue":l[4]||(l[4]=i=>e(u).descripcion=i),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),n("div",Ot,[t(e(C),{onClick:U,disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[23]||(l[23]=r(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:L},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[24]||(l[24]=r(" Cancelar ",-1))]),_:1})])]),_:1})]),_:1})):y("",!0),t(e(Ze),{modelValue:E.value,"onUpdate:modelValue":l[14]||(l[14]=i=>E.value=i)},{default:a(()=>[t(e(K),null,{default:a(()=>[t(e(Y),null,{default:a(()=>[n("div",Gt,[t(e(et),null,{default:a(()=>[t(e(he),{value:"table"},{default:a(()=>[t(e(tt),{class:"h-4 w-4 mr-2"}),l[25]||(l[25]=r(" Vista de Tabla ",-1))]),_:1}),t(e(he),{value:"tree"},{default:a(()=>[t(e(at),{class:"h-4 w-4 mr-2"}),l[26]||(l[26]=r(" Vista de Árbol ",-1))]),_:1})]),_:1})])]),_:1}),t(e(ke),{value:"table",class:"mt-0"},{default:a(()=>[t(e(X),{class:"p-0"},{default:a(()=>[t(e(Pe),null,{default:a(()=>[t(e(Le),null,{default:a(()=>[t(e(ee),null,{default:a(()=>[t(e(W),null,{default:a(()=>[...l[27]||(l[27]=[r("Nombre",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[28]||(l[28]=[r("Color",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[29]||(l[29]=[r("Etiquetas",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[30]||(l[30]=[r("Orden",-1)])]),_:1}),t(e(W),null,{default:a(()=>[...l[31]||(l[31]=[r("Estado",-1)])]),_:1}),t(e(W),{class:"text-right"},{default:a(()=>[...l[32]||(l[32]=[r("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(Ae),null,{default:a(()=>[(o(!0),f(P,null,M(s.categorias.data,i=>(o(),f(P,{key:i.id},[z.value===i.id?(o(),_(e(ee),{key:0},{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(B),{modelValue:e(u).nombre,"onUpdate:modelValue":l[5]||(l[5]=c=>e(u).nombre=c),class:"w-full"},null,8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[6]||(l[6]=c=>e(u).color=c)},{default:a(()=>[t(e(ue),{class:"w-32"},{default:a(()=>[n("div",Xt,[n("div",{class:N([Z(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(ce))])]),_:1}),t(e(me),null,{default:a(()=>[(o(!0),f(P,null,M(s.colores,(c,j)=>(o(),_(e(fe),{key:j,value:j},{default:a(()=>[n("div",Jt,[n("div",{class:N([Z(j),"w-4 h-4 rounded"])},null,2),r(" "+v(c),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[r(v(i.etiquetas_count||0),1)]),_:2},1024),t(e(I),null,{default:a(()=>[t(e(B),{modelValue:e(u).orden,"onUpdate:modelValue":l[7]||(l[7]=c=>e(u).orden=c),modelModifiers:{number:!0},type:"number",class:"w-20"},null,8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[t(e(R),{variant:i.activo?"default":"secondary"},{default:a(()=>[r(v(i.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(I),{class:"text-right"},{default:a(()=>[n("div",Kt,[t(e(C),{size:"sm",onClick:c=>p(i.id),disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4 mr-2"}),l[33]||(l[33]=r(" Guardar ",-1))]),_:1},8,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:L},{default:a(()=>[t(e(oe),{class:"h-4 w-4 mr-2"}),l[34]||(l[34]=r(" Cancelar ",-1))]),_:1})])]),_:2},1024)]),_:2},1024)):(o(),_(e(ee),{key:1},{default:a(()=>[t(e(I),{class:"font-medium"},{default:a(()=>[n("div",Qt,[t(e(pe),{class:"h-4 w-4 text-muted-foreground"}),r(" "+v(i.nombre),1)])]),_:2},1024),t(e(I),null,{default:a(()=>[n("div",Wt,[n("div",{class:N([Z(i.color),"w-4 h-4 rounded"])},null,2),r(" "+v(i.color),1)])]),_:2},1024),t(e(I),null,{default:a(()=>[t(e(R),{variant:"outline"},{default:a(()=>[r(v(i.etiquetas_count||0)+" etiquetas ",1)]),_:2},1024)]),_:2},1024),t(e(I),null,{default:a(()=>[r(v(i.orden),1)]),_:2},1024),t(e(I),null,{default:a(()=>[t(e(R),{variant:i.activo?"default":"secondary",class:"cursor-pointer",onClick:c=>V(i)},{default:a(()=>[r(v(i.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant","onClick"])]),_:2},1024),t(e(I),{class:"text-right"},{default:a(()=>[n("div",Yt,[t(e(C),{size:"sm",variant:"outline",onClick:c=>A(i.id)},{default:a(()=>[k.value.has(i.id)?(o(),_(e(De),{key:1,class:"h-4 w-4 mr-2"})):(o(),_(e(ne),{key:0,class:"h-4 w-4 mr-2"})),l[35]||(l[35]=r(" Ver y añadir etiquetas ",-1))]),_:2},1032,["onClick"]),t(e(C),{size:"sm",variant:"ghost",onClick:c=>J(i)},{default:a(()=>[t(e($e),{class:"h-4 w-4 mr-2"}),l[36]||(l[36]=r(" Editar ",-1))]),_:1},8,["onClick"]),t(e(C),{size:"sm",variant:"ghost",onClick:c=>g(i),class:"text-destructive hover:text-destructive"},{default:a(()=>[t(e(xe),{class:"h-4 w-4 mr-2"}),l[37]||(l[37]=r(" Eliminar ",-1))]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024)),k.value.has(i.id)?(o(),_(e(ee),{key:2,class:"bg-gray-50 dark:bg-gray-900/50"},{default:a(()=>[t(e(I),{colspan:"6",class:"p-0"},{default:a(()=>[n("div",Zt,[n("div",ea,[n("h4",ta,[t(e(pe),{class:"h-4 w-4"}),r(" Etiquetas de "+v(i.nombre),1)]),$.value!==i.id?(o(),_(e(C),{key:0,size:"sm",onClick:c=>Q(i.id)},{default:a(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),l[38]||(l[38]=r(" Nueva Etiqueta ",-1))]),_:1},8,["onClick"])):y("",!0)]),$.value===i.id?(o(),_(e(K),{key:0,class:"border-dashed"},{default:a(()=>[t(e(X),{class:"pt-4"},{default:a(()=>[n("div",aa,[n("div",null,[t(e(G),null,{default:a(()=>[...l[39]||(l[39]=[r("Nombre *",-1)])]),_:1}),t(e(B),{modelValue:e(d).nombre,"onUpdate:modelValue":l[8]||(l[8]=c=>e(d).nombre=c),placeholder:"Nombre de la etiqueta",class:N({"border-red-500":e(d).errors.nombre})},null,8,["modelValue","class"])]),n("div",null,[t(e(G),null,{default:a(()=>[...l[40]||(l[40]=[r("Descripción",-1)])]),_:1}),t(e(B),{modelValue:e(d).descripcion,"onUpdate:modelValue":l[9]||(l[9]=c=>e(d).descripcion=c),placeholder:"Descripción opcional"},null,8,["modelValue"])]),n("div",null,[t(we,{modelValue:e(d).parent_id,"onUpdate:modelValue":l[10]||(l[10]=c=>e(d).parent_id=c),categorias:[i],label:"Etiqueta Padre (Opcional)",placeholder:"Seleccionar etiqueta padre..."},null,8,["modelValue","categorias"])])]),n("div",la,[t(e(C),{onClick:h,disabled:e(d).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[41]||(l[41]=r(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:w},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[42]||(l[42]=r(" Cancelar ",-1))]),_:1})])]),_:2},1024)]),_:2},1024)):y("",!0),i.etiquetas&&i.etiquetas.length>0?(o(),f("div",sa,[(o(!0),f(P,null,M(i.etiquetas,c=>(o(),f("div",{key:c.id,class:"flex items-center justify-between p-3 border rounded-lg bg-white dark:bg-gray-800"},[D.value===c.id?(o(),f("div",oa,[n("div",ra,[t(e(B),{modelValue:e(d).nombre,"onUpdate:modelValue":l[11]||(l[11]=j=>e(d).nombre=j),placeholder:"Nombre"},null,8,["modelValue"]),t(e(B),{modelValue:e(d).descripcion,"onUpdate:modelValue":l[12]||(l[12]=j=>e(d).descripcion=j),placeholder:"Descripción"},null,8,["modelValue"]),t(we,{modelValue:e(d).parent_id,"onUpdate:modelValue":l[13]||(l[13]=j=>e(d).parent_id=j),categorias:[i],"excluded-id":c.id,label:"",placeholder:"Etiqueta padre..."},null,8,["modelValue","categorias","excluded-id"]),n("div",na,[t(e(C),{size:"sm",onClick:j=>F(c.id),disabled:e(d).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4 mr-2"}),l[43]||(l[43]=r(" Guardar ",-1))]),_:1},8,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:w},{default:a(()=>[t(e(oe),{class:"h-4 w-4 mr-2"}),l[44]||(l[44]=r(" Cancelar ",-1))]),_:1})])])])):(o(),f("div",ia,[n("div",null,[n("div",da,[n("span",ua,v(c.nombre),1),c.parent?(o(),_(e(R),{key:0,variant:"outline",class:"text-xs"},{default:a(()=>[r(v(c.parent.nombre),1)]),_:2},1024)):y("",!0),c.tiene_hijos?(o(),_(e(R),{key:1,variant:"secondary",class:"text-xs"},{default:a(()=>[...l[45]||(l[45]=[r(" Tiene hijos ",-1)])]),_:1})):y("",!0)]),c.descripcion?(o(),f("p",ca,v(c.descripcion),1)):y("",!0),c.ruta_completa&&c.parent?(o(),f("p",ma," Ruta: "+v(c.ruta_completa),1)):y("",!0)]),n("div",fa,[t(e(C),{size:"sm",variant:"outline",onClick:j=>le(c)},{default:a(()=>[t(e($e),{class:"h-4 w-4 mr-2"}),l[46]||(l[46]=r(" Editar ",-1))]),_:1},8,["onClick"]),t(e(C),{size:"sm",variant:"outline",onClick:j=>O(c.id)},{default:a(()=>[t(e(xe),{class:"h-4 w-4 mr-2"}),l[47]||(l[47]=r(" Eliminar ",-1))]),_:1},8,["onClick"])])]))]))),128))])):$.value!==i.id?(o(),f("div",va,[t(e(pe),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),l[49]||(l[49]=n("p",null,"No hay etiquetas en esta categoría",-1)),t(e(C),{variant:"outline",size:"sm",class:"mt-2",onClick:c=>Q(i.id)},{default:a(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),l[48]||(l[48]=r(" Crear primera etiqueta ",-1))]),_:1},8,["onClick"])])):y("",!0)])]),_:2},1024)]),_:2},1024)):y("",!0)],64))),128)),s.categorias.data.length===0?(o(),_(e(ee),{key:0},{default:a(()=>[t(e(I),{colspan:"6",class:"text-center text-muted-foreground py-8"},{default:a(()=>[...l[50]||(l[50]=[r(" No hay categorías creadas. Crea una nueva para empezar. ",-1)])]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ke),{value:"tree",class:"mt-0"},{default:a(()=>[t(e(X),null,{default:a(()=>[t(Lt,{etiquetas:Te(),"show-stats":!0,onEdit:Ie,onDelete:Ne},null,8,["etiquetas"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{Cl as default};
