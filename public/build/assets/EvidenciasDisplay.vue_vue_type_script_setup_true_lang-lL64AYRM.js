import{c as M,_ as j}from"./createLucideIcon-CYpPVXVf.js";import{d as J,r as y,c as D,i as g,F as I,b as v,j as h,e as t,f as e,w as s,k as A,g as r,h as i,t as u,s as z,m as c,v as P,l as K,n as Q}from"./app-CJ1MU9dT.js";import{c as q,_ as N}from"./CardTitle.vue_vue_type_script_setup_true_lang-B8xlQso1.js";import{_ as B}from"./index-j7j0QxXc.js";import{_ as W,a as X,b as U,c as p,d as Y,e as b}from"./TableHeader.vue_vue_type_script_setup_true_lang--avSyMiH.js";import{_ as Z,a as aa,b as ea,c as ta,d as sa}from"./AccordionContent.vue_vue_type_script_setup_true_lang-Di9hokXZ.js";import{e as oa,_ as la,a as na,b as ra,c as ia,d as da}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DhvwrcqR.js";import{_ as ua,a as ca,b as fa,c as ma,d as F}from"./SelectValue.vue_vue_type_script_setup_true_lang-C3ruv6H_.js";import{_ as _a}from"./Textarea.vue_vue_type_script_setup_true_lang-Cc2fwdkb.js";import{_ as va}from"./Label.vue_vue_type_script_setup_true_lang-CqPPdNPG.js";import{t as C}from"./index-V-Kq1BVm.js";import{I as L}from"./image-Dm-7UY79.js";import{F as pa}from"./file-text-BVOVvTTJ.js";import{E as ba}from"./external-link-BjKTwymI.js";import{E as ya}from"./eye-s5qWvbZ-.js";import{D as xa}from"./download-Ccsm4vNl.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=M("BanIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=M("CirclePauseIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=M("MilestoneIcon",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M4 6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h13a2 2 0 0 0 1.152-.365l3.424-2.317a1 1 0 0 0 0-1.635l-3.424-2.318A2 2 0 0 0 17 6z",key:"1btarq"}]]),ga={key:1,class:"mt-4"},ha={class:"flex items-center justify-between w-full pr-4"},$a={class:"flex items-center gap-3"},Ea={class:"text-left"},ka={class:"font-semibold"},wa={class:"text-sm text-gray-500"},za={class:"flex items-center gap-3"},Ca={class:"text-sm text-gray-600"},Va={class:"text-sm"},Da={class:"flex items-center justify-end gap-2"},Ia=["href"],Ba={class:"text-center"},Fa={class:"text-center"},Ma={class:"space-y-4 py-4"},Za=J({__name:"EvidenciasDisplay",props:{contratos:{default:()=>[]},proyectoId:{},modo:{},puedeGestionarEstado:{type:Boolean,default:!1},formatDate:{}},setup(m){const _=m,d=y({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),$=y(!1),V=y(null),f=y(null),E=y(""),x=y(!1),k=D(()=>{const o=[];return _.contratos&&_.contratos.forEach(a=>{a.obligaciones&&a.obligaciones.forEach(n=>{n.evidencias&&n.evidencias.forEach(l=>{o.push({...l,contrato_id:a.id,contrato_numero:a.numero_contrato,contrato_nombre:a.nombre,obligacion_titulo:n.titulo,_contrato:a})})})}),o}),R=D(()=>{let o=k.value;return d.value.contrato_id&&(o=o.filter(a=>a.contrato_id===d.value.contrato_id)),d.value.tipo&&(o=o.filter(a=>a.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(a=>a.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(a=>{var n;return((n=a.usuario)==null?void 0:n.id)===d.value.usuario_id})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(a=>{const n=new Date(a.created_at);if(d.value.fecha_inicio){const l=new Date(d.value.fecha_inicio);if(n<l)return!1}if(d.value.fecha_fin){const l=new Date(d.value.fecha_fin);if(l.setHours(23,59,59,999),n>l)return!1}return!0})),o}),S=D(()=>{const o={};return R.value.forEach(a=>{o[a.contrato_id]||(o[a.contrato_id]={contrato:a._contrato,evidencias:[]}),o[a.contrato_id].evidencias.push(a)}),Object.values(o)}),O=o=>_.modo==="admin"?`/admin/contratos/${o}`:`/miembro/mis-contratos/${o}`,T=(o,a)=>_.modo==="admin"?`/admin/contratos/${o}/evidencias/${a}`:`/miembro/mis-contratos/${o}/evidencias/${a}`,G=async()=>{if(!V.value||!f.value)return;x.value=!0;const o=`/api/proyectos/${_.proyectoId}/evidencias/${V.value.id}/${f.value}`;z.post(o,{observaciones:E.value||null},{preserveScroll:!0,onSuccess:()=>{C.success(f.value==="aprobar"?"Evidencia aprobada exitosamente":"Evidencia rechazada"),$.value=!1,V.value=null,f.value=null,E.value="",z.reload({only:["proyecto"]})},onError:a=>{C.error("Error al cambiar el estado de la evidencia"),console.error(a)},onFinish:()=>{x.value=!1}})},H=(o,a)=>{if(a===o.estado)return;const n=_.modo==="admin"?`/admin/proyectos/${_.proyectoId}/evidencias/${o.id}/cambiar-estado`:`/miembro/mis-proyectos/${_.proyectoId}/evidencias/${o.id}/cambiar-estado`;z.post(n,{estado:a,observaciones:null},{preserveScroll:!0,onSuccess:()=>{const l={pendiente:"Estado cambiado a Pendiente",aprobada:"Evidencia aprobada",rechazada:"Evidencia rechazada"};C.success(l[a]||"Estado actualizado"),z.reload({only:["proyecto"]})},onError:l=>{C.error("Error al cambiar el estado"),console.error(l)}})};return(o,a)=>(c(),g(I,null,[k.value.length>0?(c(),v(Z,{key:0,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=n=>d.value=n),contratos:m.contratos||[],evidencias:k.value},null,8,["modelValue","contratos","evidencias"])):h("",!0),S.value.length>0?(c(),g("div",ga,[t(e(aa),{type:"multiple",class:"space-y-4",collapsible:""},{default:s(()=>[(c(!0),g(I,null,A(S.value,n=>(c(),v(e(ea),{key:n.contrato.id,value:`contrato-${n.contrato.id}`,class:"border rounded-lg bg-card"},{default:s(()=>[t(e(ta),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:s(()=>[r("div",ha,[r("div",$a,[t(e(pa),{class:"h-5 w-5 text-gray-500"}),r("div",Ea,[r("div",ka,u(n.contrato.nombre),1),r("div",wa,u(n.contrato.numero_contrato||"Sin número"),1)])]),r("div",za,[t(e(B),{variant:"secondary"},{default:s(()=>[i(u(n.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),t(e(P),{href:O(n.contrato.id),onClick:a[1]||(a[1]=K(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:s(()=>[a[5]||(a[5]=i(" Ver contrato ",-1)),t(e(ba),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),t(e(sa),{class:"px-4 pb-4"},{default:s(()=>[t(e(W),null,{default:s(()=>[t(e(X),null,{default:s(()=>[t(e(U),null,{default:s(()=>[t(e(p),null,{default:s(()=>[...a[6]||(a[6]=[i("Tipo",-1)])]),_:1}),t(e(p),null,{default:s(()=>[...a[7]||(a[7]=[i("Obligación",-1)])]),_:1}),t(e(p),null,{default:s(()=>[...a[8]||(a[8]=[i("Descripción",-1)])]),_:1}),m.modo==="admin"?(c(),v(e(p),{key:0},{default:s(()=>[...a[9]||(a[9]=[i("Usuario",-1)])]),_:1})):h("",!0),t(e(p),null,{default:s(()=>[...a[10]||(a[10]=[i("Estado",-1)])]),_:1}),t(e(p),null,{default:s(()=>[...a[11]||(a[11]=[i("Fecha",-1)])]),_:1}),t(e(p),{class:"text-right"},{default:s(()=>[...a[12]||(a[12]=[i("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(Y),null,{default:s(()=>[(c(!0),g(I,null,A(n.evidencias,l=>(c(),v(e(U),{key:l.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:s(()=>[t(e(b),null,{default:s(()=>[t(e(B),{variant:"outline"},{default:s(()=>[i(u(l.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(e(b),null,{default:s(()=>[i(u(l.obligacion_titulo),1)]),_:2},1024),t(e(b),null,{default:s(()=>[r("span",Ca,u(l.descripcion||"-"),1)]),_:2},1024),m.modo==="admin"?(c(),v(e(b),{key:0},{default:s(()=>{var w;return[r("span",Va,u(((w=l.usuario)==null?void 0:w.name)||"-"),1)]}),_:2},1024)):h("",!0),t(e(b),null,{default:s(()=>[t(e(B),{class:Q({"bg-yellow-100 text-yellow-800":l.estado==="pendiente","bg-green-100 text-green-800":l.estado==="aprobada","bg-red-100 text-red-800":l.estado==="rechazada"})},{default:s(()=>[i(u(l.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(e(b),null,{default:s(()=>[i(u(m.formatDate(l.created_at)),1)]),_:2},1024),t(e(b),{class:"text-right"},{default:s(()=>[r("div",Da,[t(e(P),{href:T(l.contrato_id,l.id),class:"inline-flex items-center text-blue-600 hover:text-blue-800"},{default:s(()=>[t(e(ya),{class:"h-4 w-4"})]),_:1},8,["href"]),l.archivo_url?(c(),g("a",{key:0,href:l.archivo_url,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800"},[t(e(xa),{class:"h-4 w-4"})],8,Ia)):h("",!0),m.modo==="admin"||m.modo==="user"&&m.puedeGestionarEstado?(c(),v(e(ua),{key:1,"model-value":l.estado,"onUpdate:modelValue":w=>H(l,w)},{default:s(()=>[t(e(ca),{class:"h-8 w-32"},{default:s(()=>[t(e(fa))]),_:1}),t(e(ma),null,{default:s(()=>[t(e(F),{value:"pendiente"},{default:s(()=>[...a[13]||(a[13]=[r("span",{class:"text-yellow-600"},"Pendiente",-1)])]),_:1}),t(e(F),{value:"aprobada"},{default:s(()=>[...a[14]||(a[14]=[r("span",{class:"text-green-600"},"Aprobada",-1)])]),_:1}),t(e(F),{value:"rechazada"},{default:s(()=>[...a[15]||(a[15]=[r("span",{class:"text-red-600"},"Rechazada",-1)])]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):h("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):k.value.length===0?(c(),v(e(N),{key:2,class:"mt-4"},{default:s(()=>[t(e(q),{class:"py-8"},{default:s(()=>[r("div",Ba,[t(e(L),{class:"mx-auto h-12 w-12 text-gray-400"}),a[16]||(a[16]=r("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias cargadas",-1)),a[17]||(a[17]=r("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(c(),v(e(N),{key:3,class:"mt-4"},{default:s(()=>[t(e(q),{class:"py-8"},{default:s(()=>[r("div",Fa,[t(e(L),{class:"mx-auto h-12 w-12 text-gray-400"}),a[18]||(a[18]=r("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),a[19]||(a[19]=r("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1})),t(e(oa),{open:$.value,"onUpdate:open":a[4]||(a[4]=n=>$.value=n)},{default:s(()=>[t(e(la),null,{default:s(()=>[t(e(na),null,{default:s(()=>[t(e(ra),null,{default:s(()=>[i(u(f.value==="aprobar"?"Aprobar Evidencia":"Rechazar Evidencia"),1)]),_:1}),t(e(ia),null,{default:s(()=>[i(u(f.value==="aprobar"?"Estás a punto de aprobar esta evidencia. Puedes agregar observaciones opcionales.":"Estás a punto de rechazar esta evidencia. Es recomendable agregar el motivo del rechazo."),1)]),_:1})]),_:1}),r("div",Ma,[r("div",null,[t(e(va),{for:"observaciones"},{default:s(()=>[i(" Observaciones "+u(f.value==="rechazar"?"(recomendado)":"(opcional)"),1)]),_:1}),t(e(_a),{id:"observaciones",modelValue:E.value,"onUpdate:modelValue":a[2]||(a[2]=n=>E.value=n),placeholder:f.value==="rechazar"?"Explica el motivo del rechazo...":"Agrega comentarios adicionales...",rows:"4",class:"mt-2"},null,8,["modelValue","placeholder"])])]),t(e(da),null,{default:s(()=>[t(e(j),{variant:"outline",onClick:a[3]||(a[3]=n=>$.value=!1),disabled:x.value},{default:s(()=>[...a[20]||(a[20]=[i(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(e(j),{variant:f.value==="aprobar"?"default":"destructive",onClick:G,disabled:x.value},{default:s(()=>[i(u(x.value?"Procesando...":f.value==="aprobar"?"Aprobar":"Rechazar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])],64))}});export{Wa as B,Xa as C,Ya as M,Za as _};
