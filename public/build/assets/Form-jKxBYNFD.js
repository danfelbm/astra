import{d as Xe,k as H,c as I,w as oe,s as Qe,a as m,o as u,j as R,i as j,f as l,e as c,b as s,u as e,g as S,t as v,F as Y,r as X,bT as aa,n as J,C as ta,v as ra,m as sa,h as ia,Z as oa,bQ as da,bG as na,Y as la}from"./app-Ds26iX9R.js";import{_ as se}from"./AppLogo.vue_vue_type_script_setup_true_lang-DNyimiy1.js";import{r as Q,_ as de,a as ne,j as Be,c as le,M as ie,C as Le,U as ua,af as U,b as Pe,d as ca,e as fa,f as ma,g as _a,h as ga,i as pa,ag as va}from"./AppLayout.vue_vue_type_script_setup_true_lang-C3fdEij9.js";import{_ as ba}from"./Checkbox.vue_vue_type_script_setup_true_lang-wPcqA1MM.js";import{_ as te,a as fe}from"./Label.vue_vue_type_script_setup_true_lang-aw07jv8z.js";import{_ as ya}from"./Textarea.vue_vue_type_script_setup_true_lang-CfsBvtld.js";import{u as ha,a as xa,_ as ka,b as Sa,c as wa,d as $a}from"./useConditionalFields-CQQOmHGZ.js";import{_ as ze}from"./CardDescription.vue_vue_type_script_setup_true_lang-ibSplSGH.js";import{_ as Ca,a as Re}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-DmqUIJhW.js";import{a as Me,_ as Ge}from"./index-BkWJXtiJ.js";import{_ as We}from"./AlertTitle.vue_vue_type_script_setup_true_lang-DbySWKov.js";import{A as Ea}from"./arrow-left-bpvY5JZ-.js";import{C as me}from"./clock-lcC_4lDq.js";import{C as Ta}from"./circle-check-big-CKcuc2bi.js";import{U as Va}from"./user-Bvqz6m9o.js";import{S as Ye}from"./save-BuMcsQhS.js";import"./index-DKljZNKx.js";import"./VisuallyHidden-D7kGmBGU.js";import"./upload-DCghJbo-.js";import"./eye-CYXzlu9S.js";import"./download-Dm6Ewh8r.js";import"./plus-kQl5Glma.js";import"./grip-vertical-DmH6FBUM.js";import"./trash-2-BobbqLUd.js";import"./RovingFocusItem-3lmBRLjP.js";import"./VisuallyHiddenInput-CESC7Zv0.js";const Aa={class:"space-y-4"},ja={key:0,class:"text-center py-8"},Ua={key:2,class:"space-y-6"},Oa={key:0},Fa={class:"text-sm font-medium text-muted-foreground mb-3"},Ia={class:"space-y-3"},qa={class:"flex items-start gap-3"},Na={class:"flex-1"},Da={class:"flex items-center justify-between"},Ba={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},La={class:"flex items-center gap-2 text-muted-foreground"},Pa={class:"flex items-center gap-2 text-muted-foreground"},za={class:"flex items-center gap-2 text-muted-foreground"},Ra={key:0,class:"flex items-center gap-2 text-muted-foreground"},Ma={class:"mt-3 text-xs text-muted-foreground"},Ga={key:1},Wa={class:"text-sm font-medium text-muted-foreground mb-3"},Ya={class:"space-y-3"},Ja={class:"flex items-start gap-3"},Ka={class:"flex-1"},Ha={class:"flex items-center justify-between"},Xa={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Qa={class:"flex items-center gap-2 text-muted-foreground"},Za={class:"flex items-center gap-2 text-muted-foreground"},et={class:"flex items-center gap-2 text-muted-foreground"},at={class:"mt-3 text-xs text-muted-foreground"},tt={key:4,class:"mt-4 p-3 bg-muted/50 rounded-lg"},rt={class:"text-sm text-muted-foreground"},st=Xe({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(r,{emit:i}){const $=r,V=i,w=H([]),E=H(!1),A=H(null),t=H($.modelValue),b=async()=>{E.value=!0,A.value=null;try{const h=await aa.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:$.filtrarPorUbicacion,incluir_futuras:!0}});w.value=h.data}catch(h){A.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",h)}finally{E.value=!1}},T=I(()=>{const h={abiertas:[],futuras:[]};return w.value.forEach(y=>{y.estado_temporal==="abierta"?h.abiertas.push(y):y.estado_temporal==="futura"&&h.futuras.push(y)}),h}),M=I(()=>w.value.find(h=>h.id===t.value));oe(t,h=>{V("update:modelValue",h)}),oe(()=>$.modelValue,h=>{t.value=h});const q=h=>new Date(h).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=h=>{switch(h){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},O=h=>{switch(h){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Qe(()=>{b()}),(h,y)=>(u(),m("div",Aa,[E.value?(u(),m("div",ja,y[1]||(y[1]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),l("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):A.value?(u(),R(e(Ge),{key:1,variant:"destructive"},{default:c(()=>[s(e(Q),{class:"h-4 w-4"}),s(e(We),null,{default:c(()=>y[2]||(y[2]=[S("Error")])),_:1}),s(e(Me),null,{default:c(()=>[S(v(A.value),1)]),_:1})]),_:1})):w.value.length>0?(u(),m("div",Ua,[s(e(Ca),{modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=_=>t.value=_),disabled:h.disabled},{default:c(()=>[T.value.abiertas.length>0?(u(),m("div",Oa,[l("h4",Fa," Convocatorias Abiertas ("+v(T.value.abiertas.length)+") ",1),l("div",Ia,[(u(!0),m(Y,null,X(T.value.abiertas,_=>(u(),R(e(de),{key:_.id,class:J(["cursor-pointer hover:shadow-md transition-shadow",{"ring-2 ring-primary":t.value===_.id}])},{default:c(()=>[s(e(ne),{class:"pb-3"},{default:c(()=>[l("div",qa,[s(e(Re),{value:_.id.toString(),id:`conv-${_.id}`},null,8,["value","id"]),l("div",Na,[l("div",Da,[s(e(te),{for:`conv-${_.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[S(v(_.nombre),1)]),_:2},1032,["for"]),s(e(Be),{class:J(B(_.estado_temporal))},{default:c(()=>[S(v(O(_.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(ze),{class:"mt-1"},{default:c(()=>[S(v(_.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(le),{class:"pt-0"},{default:c(()=>[l("div",Ba,[l("div",La,[s(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.cargo.nombre),1)]),l("div",Pa,[s(e(Le),{class:"h-4 w-4"}),l("span",null,v(_.periodo_electoral.nombre),1)]),l("div",za,[s(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.ubicacion),1)]),_.numero_postulaciones!==void 0?(u(),m("div",Ra,[s(e(ua),{class:"h-4 w-4"}),l("span",null,v(_.numero_postulaciones)+" postulaciones",1)])):j("",!0)]),l("div",Ma,[y[3]||(y[3]=l("span",{class:"font-medium"},"Cierre:",-1)),S(" "+v(q(_.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):j("",!0),T.value.futuras.length>0?(u(),m("div",Ga,[l("h4",Wa," Próximas Convocatorias ("+v(T.value.futuras.length)+") ",1),l("div",Ya,[(u(!0),m(Y,null,X(T.value.futuras,_=>(u(),R(e(de),{key:_.id,class:J(["cursor-pointer hover:shadow-md transition-shadow opacity-90",{"ring-2 ring-primary":t.value===_.id}])},{default:c(()=>[s(e(ne),{class:"pb-3"},{default:c(()=>[l("div",Ja,[s(e(Re),{value:_.id.toString(),id:`conv-${_.id}`},null,8,["value","id"]),l("div",Ka,[l("div",Ha,[s(e(te),{for:`conv-${_.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[S(v(_.nombre),1)]),_:2},1032,["for"]),s(e(Be),{class:J(B(_.estado_temporal))},{default:c(()=>[S(v(O(_.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(ze),{class:"mt-1"},{default:c(()=>[S(v(_.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(le),{class:"pt-0"},{default:c(()=>[l("div",Xa,[l("div",Qa,[s(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.cargo.nombre),1)]),l("div",Za,[s(e(Le),{class:"h-4 w-4"}),l("span",null,v(_.periodo_electoral.nombre),1)]),l("div",et,[s(e(ie),{class:"h-4 w-4"}),l("span",null,v(_.ubicacion),1)])]),l("div",at,[y[4]||(y[4]=l("span",{class:"font-medium"},"Apertura:",-1)),S(" "+v(q(_.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):j("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),R(e(Ge),{key:3},{default:c(()=>[s(e(Q),{class:"h-4 w-4"}),s(e(We),null,{default:c(()=>y[5]||(y[5]=[S("Sin convocatorias disponibles")])),_:1}),s(e(Me),null,{default:c(()=>y[6]||(y[6]=[S(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),M.value&&!h.disabled?(u(),m("div",tt,[y[7]||(y[7]=l("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),l("p",rt,v(M.value.nombre),1)])):j("",!0)]))}});var it=typeof global=="object"&&global&&global.Object===Object&&global,ot=typeof self=="object"&&self&&self.Object===Object&&self,Ze=it||ot||Function("return this")(),ue=Ze.Symbol,ea=Object.prototype,dt=ea.hasOwnProperty,nt=ea.toString,ae=ue?ue.toStringTag:void 0;function lt(r){var i=dt.call(r,ae),$=r[ae];try{r[ae]=void 0;var V=!0}catch{}var w=nt.call(r);return V&&(i?r[ae]=$:delete r[ae]),w}var ut=Object.prototype,ct=ut.toString;function ft(r){return ct.call(r)}var mt="[object Null]",_t="[object Undefined]",Je=ue?ue.toStringTag:void 0;function gt(r){return r==null?r===void 0?_t:mt:Je&&Je in Object(r)?lt(r):ft(r)}function pt(r){return r!=null&&typeof r=="object"}var vt="[object Symbol]";function bt(r){return typeof r=="symbol"||pt(r)&&gt(r)==vt}var yt=/\s/;function ht(r){for(var i=r.length;i--&&yt.test(r.charAt(i)););return i}var xt=/^\s+/;function kt(r){return r&&r.slice(0,ht(r)+1).replace(xt,"")}function ge(r){var i=typeof r;return r!=null&&(i=="object"||i=="function")}var Ke=NaN,St=/^[-+]0x[0-9a-f]+$/i,wt=/^0b[01]+$/i,$t=/^0o[0-7]+$/i,Ct=parseInt;function He(r){if(typeof r=="number")return r;if(bt(r))return Ke;if(ge(r)){var i=typeof r.valueOf=="function"?r.valueOf():r;r=ge(i)?i+"":i}if(typeof r!="string")return r===0?r:+r;r=kt(r);var $=wt.test(r);return $||$t.test(r)?Ct(r.slice(2),$?2:8):St.test(r)?Ke:+r}var _e=function(){return Ze.Date.now()},Et="Expected a function",Tt=Math.max,Vt=Math.min;function At(r,i,$){var V,w,E,A,t,b,T=0,M=!1,q=!1,B=!0;if(typeof r!="function")throw new TypeError(Et);i=He(i)||0,ge($)&&(M=!!$.leading,q="maxWait"in $,E=q?Tt(He($.maxWait)||0,i):E,B="trailing"in $?!!$.trailing:B);function O(k){var D=V,p=w;return V=w=void 0,T=k,A=r.apply(p,D),A}function h(k){return T=k,t=setTimeout(L,i),M?O(k):A}function y(k){var D=k-b,p=k-T,C=i-D;return q?Vt(C,E-p):C}function _(k){var D=k-b,p=k-T;return b===void 0||D>=i||D<0||q&&p>=E}function L(){var k=_e();if(_(k))return W(k);t=setTimeout(L,y(k))}function W(k){return t=void 0,B&&V?O(k):(V=w=void 0,A)}function Z(){t!==void 0&&clearTimeout(t),T=0,V=b=w=t=void 0}function K(){return t===void 0?A:W(_e())}function N(){var k=_e(),D=_(k);if(V=arguments,w=this,b=k,D){if(t===void 0)return h(b);if(q)return clearTimeout(t),t=setTimeout(L,i),O(b)}return t===void 0&&(t=setTimeout(L,i)),A}return N.cancel=Z,N.flush=K,N}function jt(r,i){const{url:$,candidaturaId:V=null,debounceTime:w=3e3,showNotifications:E=!0,useLocalStorage:A=!0,localStorageKey:t="candidatura_draft"}=i,b=H({status:"idle",lastSaved:null,lastError:null,candidaturaId:V}),T=I(()=>b.value.status==="saving"),M=I(()=>b.value.lastSaved!==null),q=I(()=>b.value.status==="error"),B=()=>{if(A)try{const p={formulario_data:r.value,timestamp:new Date().toISOString(),candidaturaId:b.value.candidaturaId};localStorage.setItem(t,JSON.stringify(p))}catch(p){console.error("Error guardando en localStorage:",p)}},O=()=>{if(!A)return null;try{const p=localStorage.getItem(t);if(p){const C=JSON.parse(p),P=new Date(C.timestamp);if((Date.now()-P.getTime())/(1e3*60*60)<24)return C;localStorage.removeItem(t)}}catch(p){console.error("Error cargando desde localStorage:",p)}return null},h=()=>{A&&localStorage.removeItem(t)},y=async()=>{try{const p=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(p.ok){const C=await p.text(),F=new DOMParser().parseFromString(C,"text/html").querySelector('meta[name="csrf-token"]');if(F){const ee=F.getAttribute("content"),G=document.querySelector('meta[name="csrf-token"]');if(G&&ee)return G.setAttribute("content",ee),ee}}}catch(p){console.error("Error renovando token CSRF:",p)}return null},_=async(p,C,P=0)=>{const z=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":C,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:r.value})});if(z.status===419&&P<1){const F=await y();if(F)return E&&U.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),_(p,F,P+1)}return z},L=async()=>{var p;if(b.value.status!=="saving"&&!(!r.value||Object.keys(r.value).length===0)){b.value.status="saving",b.value.lastError=null;try{const C=b.value.candidaturaId?$.replace("autosave",`${b.value.candidaturaId}/autosave`):$,P=((p=document.querySelector('meta[name="csrf-token"]'))==null?void 0:p.getAttribute("content"))||"";if(!P)throw new Error("Token CSRF no encontrado");const z=await _(C,P);if(!z.ok)throw new Error(`Error ${z.status}: ${z.statusText}`);const F=await z.json();if(F.success)b.value.status="saved",b.value.lastSaved=new Date,!b.value.candidaturaId&&F.candidatura_id&&(b.value.candidaturaId=F.candidatura_id),B(),E&&U.success("Cambios guardados",{description:`Autoguardado a las ${F.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(F.message||"Error al guardar")}catch(C){b.value.status="error",b.value.lastError=C instanceof Error?C.message:"Error desconocido",B(),C instanceof Error&&C.message.includes("419")?E&&U.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):E&&U.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",C)}}},W=At(L,w),Z=()=>(W.cancel(),L()),K=()=>oe(r,()=>{b.value.status!=="error"&&W()},{deep:!0}),N=()=>{W.cancel()},k=()=>{N(),b.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:V},h()},D=()=>{const p=O();return p&&p.formulario_data?(E&&U.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),p):null};return{state:I(()=>b.value),isSaving:T,hasSaved:M,hasError:q,saveNow:Z,startWatching:K,stopAutoSave:N,reset:k,restoreDraft:D,clearLocalStorage:h}}const Ut={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ot={class:"flex items-center justify-between"},Ft={class:"text-3xl font-bold"},It={class:"text-muted-foreground"},qt={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Nt={key:0,class:"flex items-center gap-1.5"},Dt={key:1,class:"flex items-center gap-1.5"},Bt={key:2,class:"flex items-center gap-1.5 text-amber-600"},Lt={key:3,class:"flex items-center gap-1.5"},Pt={class:"text-blue-700 dark:text-blue-300"},zt={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Rt={class:"flex items-start gap-3"},Mt={class:"text-sm text-blue-800"},Gt={key:0,class:"mt-1 text-blue-600"},Wt={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},Yt={class:"flex items-start gap-3"},Jt={key:0,class:"text-red-500"},Kt={key:0,class:"text-sm text-muted-foreground"},Ht={key:6,class:"space-y-2"},Xt=["id","name","value","onUpdate:modelValue"],Qt={key:7,class:"space-y-2"},Zt={key:8},er={key:9},ar={key:0,class:"text-red-500 text-sm mt-1"},tr={key:10},rr={key:11},sr={key:12},ir={key:13,class:"text-sm text-destructive"},or={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},dr={class:"text-red-800 text-sm"},nr={class:"flex justify-between pt-6"},lr={key:0,class:"fixed bottom-12 right-80 z-50"},ur=Xe({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(r){var pe,ve;const i=r,$=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:i.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:V}=ha(),w=H({}),E=I(()=>{var x;if(!i.is_editing||!((x=i.candidatura)!=null&&x.formulario_data))return!1;const n=Object.keys(i.candidatura.formulario_data),d=i.configuracion_campos.map(a=>a.id),o=n.some(a=>!d.includes(a)),g=i.configuracion_campos.some(a=>a.required&&!i.candidatura.formulario_data[a.id]);return o||g}),t=ta((()=>{var d;const n={};return i.configuracion_campos.forEach(o=>{o.type==="checkbox"?n[o.id]=[]:o.type==="file"?n[o.id]=[]:o.type==="convocatoria"?n[o.id]=void 0:o.type==="disclaimer"?n[o.id]=null:o.type==="repeater"?n[o.id]=[]:o.type==="datepicker"?n[o.id]=null:n[o.id]=""}),(d=i.candidatura)!=null&&d.formulario_data&&(Object.assign(n,i.candidatura.formulario_data),i.configuracion_campos.forEach(o=>{o.type==="file"&&n[o.id]&&(Array.isArray(n[o.id])||(n[o.id]=[n[o.id]]))})),{formulario_data:n}})()),b=H(i.configuracion_campos),T=I(()=>t.formulario_data),{visibleFields:M,clearHiddenFieldValues:q}=xa(b,T);oe(M,()=>{q()});const{state:B,isSaving:O,hasSaved:h,hasError:y,saveNow:_,startWatching:L,stopAutoSave:W,restoreDraft:Z,clearLocalStorage:K}=jt(T,{url:"/candidaturas/autosave",candidaturaId:((pe=i.candidatura)==null?void 0:pe.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((ve=i.candidatura)==null?void 0:ve.id)||"new"}`});let N=null;Qe(()=>{const n=["borrador","rechazado"];if(!i.candidatura||n.includes(i.candidatura.estado)){if(!i.is_editing){const o=Z();o&&o.formulario_data&&(U.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{K(),t.reset(),U.success("Borrador descartado")}},duration:5e3}),Object.assign(t.formulario_data,o.formulario_data))}N=L()}}),ra(()=>{N&&N(),W()});const k=async()=>{if(O.value){U.warning("Ya se está guardando...");return}await _(),y.value||U.success("Borrador guardado manualmente")},D=I(()=>P.value.map(o=>{var a;if(!o.required)return{campo:o.id,valid:!0};const g=t.formulario_data[o.id];let x=!1;if(o.type==="checkbox")x=Array.isArray(g)&&g.length>0;else if(o.type==="file")(Array.isArray(g)&&g.length>0||w.value[o.id]&&w.value[o.id].length>0)&&(x=!0);else if(o.type==="convocatoria")x=g!=null&&g!=="";else if(o.type==="disclaimer")x=g&&g.accepted===!0;else if(o.type==="repeater"){const re=((a=o.repeaterConfig)==null?void 0:a.minItems)||0;x=Array.isArray(g)&&g.length>=re}else o.type==="datepicker"?x=g!=null&&g!=="":x=g&&g.toString().trim()!=="";return!x&&o.required,{campo:o.id,valid:x}}).every(o=>o.valid)),p=I(()=>i.is_editing?"Editar Candidatura":"Crear Candidatura"),C=I(()=>{var n,d;return t.processing?"Guardando...":i.is_editing?((n=i.candidatura)==null?void 0:n.estado)==="rechazado"?"Reenviar Candidatura":((d=i.candidatura)==null?void 0:d.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),P=I(()=>{var d;let n=[...M.value];return i.is_editing&&i.candidatura&&["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=n.filter(g=>g.type!=="convocatoria")),i.is_editing&&((d=i.candidatura)==null?void 0:d.estado)==="aprobado"&&(n=n.filter(o=>o.editable===!0)),n}),z=I(()=>{var o;if(!i.is_editing||!i.candidatura)return!1;let n=!1;if(["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=i.configuracion_campos.some(g=>g.type==="convocatoria")),((o=i.candidatura)==null?void 0:o.estado)==="aprobado"){const g=i.configuracion_campos.some(x=>!x.editable&&x.type!=="convocatoria");return n||g}return n}),F=async(n,d)=>{if(w.value[n]=d,d&&d.length>0)try{U.info("Subiendo archivos...",{duration:2e3});const g=(await V(d,{module:"candidaturas",fieldId:n})).map(x=>x.path);Array.isArray(t.formulario_data[n]),t.formulario_data[n]=g,w.value[n]=[],U.success("Archivos subidos correctamente",{duration:2e3})}catch(o){console.error("Error al subir archivos:",o),U.error("Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else t.formulario_data[n]=[]},ee=async()=>{for(const[d,o]of Object.entries(w.value))if(o&&o.length>0)try{U.info("Subiendo archivos pendientes...",{duration:2e3});const g=await V(o,{module:"candidaturas",fieldId:d});t.formulario_data[d]=g.map(x=>x.path),w.value[d]=[]}catch(g){console.error("Error al subir archivos:",g),U.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const n={...t.formulario_data};i.configuracion_campos.forEach(d=>{const o=n[d.id];d.required||(o===""||o===void 0||Array.isArray(o)&&o.length===0&&d.type!=="checkbox"&&d.type!=="file")&&(n[d.id]=null)}),t.formulario_data=n,W(),i.is_editing?t.put(`/candidaturas/${i.candidatura.id}`,{onSuccess:()=>{K(),U.success("Candidatura actualizada exitosamente")},onError:d=>{console.error("Errores de validación:",d),(!i.candidatura||["borrador","rechazado"].includes(i.candidatura.estado))&&(N=L())}}):t.post("/candidaturas",{onSuccess:()=>{K(),U.success("Candidatura creada exitosamente")},onError:d=>{console.error("Errores de validación:",d),N=L()}})},G=n=>!!t.errors[`formulario_data.${n}`];return(n,d)=>(u(),m(Y,null,[s(e(sa),{title:p.value},null,8,["title"]),s(pa,{breadcrumbs:$},{default:c(()=>{var o,g;return[l("div",Ut,[l("div",Ot,[l("div",null,[l("h1",Ft,v(p.value),1),l("p",It,v(n.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),s(e(se),{variant:"outline",onClick:d[0]||(d[0]=x=>n.$inertia.visit("/candidaturas"))},{default:c(()=>[s(e(Ea),{class:"mr-2 h-4 w-4"}),d[2]||(d[2]=S(" Volver "))]),_:1})]),!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)?(u(),m("div",qt,[e(O)?(u(),m("div",Nt,[s(e(me),{class:"h-4 w-4 animate-spin"}),d[3]||(d[3]=l("span",null,"Guardando automáticamente...",-1))])):e(h)&&!e(y)?(u(),m("div",Dt,[s(e(Ta),{class:"h-4 w-4 text-green-600"}),l("span",null,"Guardado automáticamente a las "+v((o=e(B).lastSaved)==null?void 0:o.toLocaleTimeString()),1)])):e(y)?(u(),m("div",Bt,[s(e(Q),{class:"h-4 w-4"}),d[4]||(d[4]=l("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),m("div",Lt,[s(e(me),{class:"h-4 w-4"}),d[5]||(d[5]=l("span",null,"Autoguardado activado",-1))]))])):j("",!0),n.is_editing&&((g=n.candidatura)!=null&&g.comentarios_admin)?(u(),R(e(de),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:c(()=>[s(e(ne),null,{default:c(()=>[s(e(Pe),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:c(()=>[s(e(Q),{class:"h-5 w-5"}),d[6]||(d[6]=S(" Comentarios de la comisión "))]),_:1})]),_:1}),s(e(le),null,{default:c(()=>[l("p",Pt,v(n.candidatura.comentarios_admin),1)]),_:1})]),_:1})):j("",!0),s(e(de),null,{default:c(()=>[s(e(ne),null,{default:c(()=>[s(e(Pe),{class:"flex items-center gap-2"},{default:c(()=>[s(e(Va),{class:"h-5 w-5"}),d[7]||(d[7]=S(" Información de Candidatura "))]),_:1})]),_:1}),s(e(le),null,{default:c(()=>{var x;return[l("form",{onSubmit:ia(ee,["prevent"]),class:"space-y-6"},[n.is_editing&&((x=n.candidatura)==null?void 0:x.estado)==="aprobado"?(u(),m("div",zt,[l("div",Rt,[s(e(Q),{class:"h-5 w-5 text-blue-600 mt-0.5"}),l("div",Mt,[d[8]||(d[8]=l("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),d[9]||(d[9]=l("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),z.value?(u(),m("p",Gt," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):j("",!0)])])])):j("",!0),E.value?(u(),m("div",Wt,[l("div",Yt,[s(e(Q),{class:"h-5 w-5 text-amber-600 mt-0.5"}),d[10]||(d[10]=l("div",{class:"text-sm text-amber-800"},[l("p",{class:"font-medium"},"Formulario Actualizado"),l("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):j("",!0),s(oa,{name:"fade-field",tag:"div",class:"space-y-6"},{default:c(()=>[(u(!0),m(Y,null,X(P.value,a=>{var re,be,ye,he,xe,ke,Se,we,$e,Ce,Ee,Te,Ve,Ae,je,Ue,Oe,Fe,Ie,qe,Ne;return u(),m("div",{key:a.id,class:"space-y-2"},[s(e(te),{for:a.id,class:"flex items-center gap-1"},{default:c(()=>[S(v(a.title)+" ",1),a.required?(u(),m("span",Jt,"*")):j("",!0)]),_:2},1032,["for"]),a.description?(u(),m("p",Kt,v(a.description),1)):j("",!0),a.type==="text"||a.type==="email"?(u(),R(e(fe),{key:1,id:a.id,type:a.type,modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,placeholder:a.placeholder||"",class:J({"border-destructive":G(a.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="textarea"?(u(),R(e(ya),{key:2,id:a.id,modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,placeholder:a.placeholder||"",rows:4,class:J({"border-destructive":G(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="number"?(u(),R(e(fe),{key:3,id:a.id,type:"number",modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,placeholder:a.placeholder||"",class:J({"border-destructive":G(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="date"?(u(),R(e(fe),{key:4,id:a.id,type:"date",modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,class:J({"border-destructive":G(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):a.type==="select"?(u(),R(e(ca),{key:5,modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f},{default:c(()=>[s(e(fa),{class:J({"border-destructive":G(a.id)})},{default:c(()=>[s(e(ma),{placeholder:a.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),s(e(_a),null,{default:c(()=>[(u(!0),m(Y,null,X(a.options,f=>(u(),R(e(ga),{key:f,value:f},{default:c(()=>[S(v(f),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):a.type==="radio"?(u(),m("div",Ht,[(u(!0),m(Y,null,X(a.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[da(l("input",{id:`${a.id}_${f}`,name:a.id,type:"radio",value:f,"onUpdate:modelValue":ce=>e(t).formulario_data[a.id]=ce,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Xt),[[na,e(t).formulario_data[a.id]]]),s(e(te),{for:`${a.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[S(v(f),1)]),_:2},1032,["for"])]))),128))])):a.type==="checkbox"?(u(),m("div",Qt,[(u(!0),m(Y,null,X(a.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[s(e(ba),{id:`${a.id}_${f}`,checked:e(t).formulario_data[a.id].includes(f),"onUpdate:checked":ce=>{if(ce)e(t).formulario_data[a.id].includes(f)||e(t).formulario_data[a.id].push(f);else{const De=e(t).formulario_data[a.id].indexOf(f);De>-1&&e(t).formulario_data[a.id].splice(De,1)}}},null,8,["id","checked","onUpdate:checked"]),s(e(te),{for:`${a.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[S(v(f),1)]),_:2},1032,["for"])]))),128))])):a.type==="file"?(u(),m("div",Zt,[s(ka,{modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,onFilesSelected:f=>F(a.id,f),label:"",description:"",required:a.required,multiple:((re=a.fileConfig)==null?void 0:re.multiple)||!1,"max-files":((be=a.fileConfig)==null?void 0:be.maxFiles)||5,"max-file-size":((ye=a.fileConfig)==null?void 0:ye.maxFileSize)||10,accept:((he=a.fileConfig)==null?void 0:he.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(t).errors[`formulario_data.${a.id}`],disabled:e(t).processing,module:"candidaturas","field-id":a.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):a.type==="convocatoria"?(u(),m("div",er,[s(st,{modelValue:e(t).formulario_data[a.id],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,required:a.required,disabled:e(t).processing||n.is_editing&&((xe=n.candidatura)==null?void 0:xe.estado)!=="borrador","filtrar-por-ubicacion":((ke=a.convocatoriaConfig)==null?void 0:ke.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),G(a.id)?(u(),m("div",ar,v(e(t).errors[`formulario_data.${a.id}`]),1)):j("",!0)])):a.type==="datepicker"?(u(),m("div",tr,[s(Sa,{"model-value":e(t).formulario_data[a.id]||null,"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(t).processing,error:e(t).errors[`formulario_data.${a.id}`],"min-date":(Se=a.datepickerConfig)==null?void 0:Se.minDate,"max-date":(we=a.datepickerConfig)==null?void 0:we.maxDate,format:(($e=a.datepickerConfig)==null?void 0:$e.format)||"DD/MM/YYYY","allow-past-dates":((Ce=a.datepickerConfig)==null?void 0:Ce.allowPastDates)??!0,"allow-future-dates":((Ee=a.datepickerConfig)==null?void 0:Ee.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):a.type==="disclaimer"?(u(),m("div",rr,[s(wa,{"model-value":e(t).formulario_data[a.id]||null,"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(t).processing,error:e(t).errors[`formulario_data.${a.id}`],"disclaimer-text":((Te=a.disclaimerConfig)==null?void 0:Te.disclaimerText)||"","modal-title":((Ve=a.disclaimerConfig)==null?void 0:Ve.modalTitle)||"Términos y Condiciones","accept-button-text":((Ae=a.disclaimerConfig)==null?void 0:Ae.acceptButtonText)||"Acepto","decline-button-text":((je=a.disclaimerConfig)==null?void 0:je.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):a.type==="repeater"?(u(),m("div",sr,[s($a,{"model-value":e(t).formulario_data[a.id]||[],"onUpdate:modelValue":f=>e(t).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(t).processing,error:e(t).errors[`formulario_data.${a.id}`],"min-items":((Ue=a.repeaterConfig)==null?void 0:Ue.minItems)||0,"max-items":((Oe=a.repeaterConfig)==null?void 0:Oe.maxItems)||10,"item-name":((Fe=a.repeaterConfig)==null?void 0:Fe.itemName)||"Elemento","add-button-text":((Ie=a.repeaterConfig)==null?void 0:Ie.addButtonText)||"Agregar elemento","remove-button-text":((qe=a.repeaterConfig)==null?void 0:qe.removeButtonText)||"Eliminar",fields:((Ne=a.repeaterConfig)==null?void 0:Ne.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):j("",!0),G(a.id)?(u(),m("p",ir,v(e(t).errors[`formulario_data.${a.id}`]),1)):j("",!0)])}),128))]),_:1}),e(t).errors.general?(u(),m("div",or,[l("p",dr,v(e(t).errors.general),1)])):j("",!0),l("div",nr,[s(e(se),{variant:"outline",type:"button",onClick:d[1]||(d[1]=a=>n.$inertia.visit("/candidaturas"))},{default:c(()=>d[11]||(d[11]=[S(" Cancelar ")])),_:1}),s(e(se),{type:"submit",disabled:!D.value||e(t).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400"},{default:c(()=>[s(e(Ye),{class:"mr-2 h-4 w-4"}),S(" "+v(C.value),1)]),_:1},8,["disabled"])])],32)]}),_:1})]),_:1})]),s(la,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:c(()=>[(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&!e(t).processing?(u(),m("div",lr,[s(e(se),{onClick:k,disabled:e(O),size:"lg",class:"shadow-lg hover:shadow-xl transition-shadow duration-200"},{default:c(()=>[e(O)?(u(),m(Y,{key:0},[s(e(me),{class:"mr-2 h-5 w-5 animate-spin"}),d[12]||(d[12]=S(" Guardando... "))],64)):(u(),m(Y,{key:1},[s(e(Ye),{class:"mr-2 h-5 w-5"}),d[13]||(d[13]=S(" Guardar como borrador "))],64))]),_:1},8,["disabled"])])):j("",!0)]),_:1})]}),_:1})],64))}}),Nr=va(ur,[["__scopeId","data-v-9e52d48f"]]);export{Nr as default};
