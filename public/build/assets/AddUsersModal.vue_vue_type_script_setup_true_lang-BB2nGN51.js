import{_ as O,a as Q,b as G,c as H,d as J,e as K}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CssOazgJ.js";import{_ as w}from"./createLucideIcon-BdVmm7P_.js";import{_ as I}from"./Input.vue_vue_type_script_setup_true_lang-DdSjcwnl.js";import{_ as W}from"./Checkbox.vue_vue_type_script_setup_true_lang-BpkxS9nt.js";import{_ as X,a as Y,b as Z,c as ee,d as ae}from"./SelectValue.vue_vue_type_script_setup_true_lang-tpq5Hvrt.js";import{d as se,c as te,r as p,p as N,b as U,w as c,e as n,f as s,g as l,h as b,t as d,n as le,i,F as T,k as M,j as k,a as j,m as o}from"./app-BDg7E49x.js";import{t as C}from"./index-ClqqlYCG.js";import{S as oe}from"./search--W7ScXI1.js";import{L as z}from"./loader-circle-CFcShzm_.js";import{U as ne}from"./users-B4eDDANw.js";import{C as ue}from"./chevron-left-lwuLPeVA.js";import{C as de}from"./chevron-right-DbDOw8_f.js";const ie={class:"space-y-4"},re={class:"text-sm font-medium"},ce={class:"relative"},me={class:"border rounded-lg"},ve={class:"max-h-96 overflow-y-auto p-4"},fe={key:0,class:"flex items-center justify-center py-8"},pe={key:1,class:"space-y-2"},_e=["for"],he={class:"font-medium"},xe={class:"text-sm text-muted-foreground space-y-1"},ge={class:"flex gap-3"},ye={key:0},be={key:1},ke={key:2,class:"text-center py-8"},$e={class:"text-muted-foreground"},Ue={key:0,class:"border-t px-4 py-3"},Ve={class:"flex items-center justify-between"},we={class:"text-sm text-muted-foreground"},Ce={key:0},Ee={class:"flex gap-2"},Se={class:"flex items-center justify-between w-full"},Be={class:"text-sm text-muted-foreground"},Fe={key:0,class:"font-medium text-foreground"},Pe={key:1},Te={class:"flex gap-2"},Me={key:1},He=se({__name:"AddUsersModal",props:{modelValue:{type:Boolean},title:{default:"Añadir Usuarios"},description:{default:"Selecciona los usuarios que deseas añadir"},searchEndpoint:{},addEndpoint:{},excludedIds:{},extraFields:{},maxSelection:{},submitButtonText:{default:"Añadir"},searchPlaceholder:{default:"Buscar por nombre, email, documento o teléfono..."},emptyMessage:{default:"Escribe para buscar usuarios disponibles"},noResultsMessage:{default:"No se encontraron usuarios con esa búsqueda"}},emits:["update:modelValue","submit"],setup(f,{emit:D}){const m=f,E=D,x=te({get:()=>m.modelValue,set:t=>E("update:modelValue",t)}),g=p(""),_=p([]),u=p([]),S=p(!1),V=p(!1),B=p(!1),v=p(1),y=p(1),$=p(0),h=p({});m.extraFields&&m.extraFields.forEach(t=>{h.value[t.name]=t.value});const F=async(t=1)=>{S.value=!0;try{const a={page:t,search:g.value};m.excludedIds&&m.excludedIds.length>0&&(a.excluded_ids=m.excludedIds);const e=await j.get(m.searchEndpoint,{params:a});if(e.data.participantes_disponibles){const r=e.data.participantes_disponibles;_.value=r.data||[],v.value=r.current_page||1,y.value=r.last_page||1,$.value=r.total||0}else e.data.users?(_.value=e.data.users||[],v.value=e.data.current_page||1,y.value=e.data.last_page||1,$.value=e.data.total||0):(_.value=e.data.data||[],v.value=e.data.current_page||1,y.value=e.data.last_page||1,$.value=e.data.total||0)}catch(a){console.error("Error buscando usuarios:",a),C.error("Error al buscar usuarios",{description:"Por favor intenta nuevamente",duration:3e3}),_.value=[]}finally{S.value=!1}};let P=null;N(g,()=>{P&&clearTimeout(P),P=setTimeout(()=>{x.value&&(v.value=1,F(1))},500)}),N(x,t=>{t&&!B.value&&(B.value=!0,F(1)),t||(u.value=[],g.value="",_.value=[],v.value=1,B.value=!1)});const L=(t,a)=>{if(a){if(m.maxSelection&&u.value.length>=m.maxSelection){C.warning(`Máximo ${m.maxSelection} usuarios permitidos`);return}u.value.includes(t)||u.value.push(t)}else{const e=u.value.indexOf(t);e>-1&&u.value.splice(e,1)}},A=t=>u.value.includes(t),q=t=>{v.value=t,F(t)},R=async()=>{if(u.value.length===0)return;const t=_.value.filter(a=>u.value.includes(a.id));if(m.addEndpoint){V.value=!0;try{const a={user_ids:u.value,...h.value};await j.post(m.addEndpoint,a),C.success(`${u.value.length} usuario(s) añadido(s) exitosamente`,{duration:2e3}),x.value=!1,E("submit",{userIds:u.value,extraData:h.value,users:t})}catch(a){console.error("Error añadiendo usuarios:",a),C.error("Error al añadir usuarios",{description:"Por favor intenta nuevamente",duration:3e3})}finally{V.value=!1}}else E("submit",{userIds:u.value,extraData:h.value,users:t}),x.value=!1};return(t,a)=>(o(),U(s(K),{open:x.value,"onUpdate:open":a[4]||(a[4]=e=>x.value=e)},{default:c(()=>[n(s(O),{class:"max-w-2xl"},{default:c(()=>[n(s(Q),null,{default:c(()=>[n(s(G),null,{default:c(()=>[b(d(f.title),1)]),_:1}),n(s(H),null,{default:c(()=>[b(d(f.description),1)]),_:1})]),_:1}),l("div",ie,[l("div",{class:le(["grid gap-4",f.extraFields&&f.extraFields.length>0?"md:grid-cols-2":""])},[(o(!0),i(T,null,M(f.extraFields,e=>(o(),i("div",{key:e.name},[l("label",re,d(e.label),1),e.type==="select"?(o(),U(s(X),{key:0,modelValue:h.value[e.name],"onUpdate:modelValue":r=>h.value[e.name]=r},{default:c(()=>[n(s(Y),null,{default:c(()=>[n(s(Z))]),_:1}),n(s(ee),null,{default:c(()=>[(o(!0),i(T,null,M(e.options,r=>(o(),U(s(ae),{key:r.value,value:r.value},{default:c(()=>[b(d(r.label),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):(o(),U(s(I),{key:1,modelValue:h.value[e.name],"onUpdate:modelValue":r=>h.value[e.name]=r,type:e.type,required:e.required},null,8,["modelValue","onUpdate:modelValue","type","required"]))]))),128)),l("div",null,[a[5]||(a[5]=l("label",{class:"text-sm font-medium"},"Buscar Usuarios",-1)),l("div",ce,[n(s(oe),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),n(s(I),{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),placeholder:f.searchPlaceholder,type:"text",class:"pl-10"},null,8,["modelValue","placeholder"])])])],2),l("div",me,[l("div",ve,[S.value?(o(),i("div",fe,[n(s(z),{class:"h-8 w-8 animate-spin text-muted-foreground"}),a[6]||(a[6]=l("span",{class:"ml-2 text-muted-foreground"},"Buscando usuarios...",-1))])):_.value.length>0?(o(),i("div",pe,[(o(!0),i(T,null,M(_.value,e=>(o(),i("div",{key:e.id,class:"flex items-start space-x-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded px-2 transition-colors"},[n(s(W),{id:`user-${e.id}`,checked:A(e.id),"onUpdate:checked":r=>L(e.id,r),class:"mt-1"},null,8,["id","checked","onUpdate:checked"]),l("label",{for:`user-${e.id}`,class:"flex-1 cursor-pointer"},[l("div",he,d(e.name),1),l("div",xe,[l("div",null,d(e.email),1),l("div",ge,[e.documento_identidad?(o(),i("span",ye," Doc: "+d(e.documento_identidad),1)):k("",!0),e.telefono?(o(),i("span",be," Tel: "+d(e.telefono),1)):k("",!0)])])],8,_e)]))),128))])):(o(),i("div",ke,[n(s(ne),{class:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),l("p",$e,d(g.value?f.noResultsMessage:f.emptyMessage),1)]))]),y.value>1?(o(),i("div",Ue,[l("div",Ve,[l("span",we,[b(" Página "+d(v.value)+" de "+d(y.value)+" ",1),$.value>0?(o(),i("span",Ce," ("+d($.value)+" usuarios disponibles) ",1)):k("",!0)]),l("div",Ee,[n(s(w),{variant:"outline",size:"sm",disabled:v.value===1,onClick:a[1]||(a[1]=e=>q(v.value-1))},{default:c(()=>[n(s(ue),{class:"h-4 w-4"})]),_:1},8,["disabled"]),n(s(w),{variant:"outline",size:"sm",disabled:v.value===y.value,onClick:a[2]||(a[2]=e=>q(v.value+1))},{default:c(()=>[n(s(de),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])])):k("",!0)])]),n(s(J),null,{default:c(()=>[l("div",Se,[l("span",Be,[u.value.length>0?(o(),i("span",Fe,d(u.value.length)+" usuario(s) seleccionado(s) ",1)):(o(),i("span",Pe," Selecciona usuarios para continuar "))]),l("div",Te,[n(s(w),{variant:"outline",onClick:a[3]||(a[3]=e=>x.value=!1)},{default:c(()=>[...a[7]||(a[7]=[b(" Cancelar ",-1)])]),_:1}),n(s(w),{onClick:R,disabled:u.value.length===0||V.value},{default:c(()=>[V.value?(o(),U(s(z),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):k("",!0),b(" "+d(f.submitButtonText)+" ",1),u.value.length>0?(o(),i("span",Me," ("+d(u.value.length)+") ",1)):k("",!0)]),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{He as _};
