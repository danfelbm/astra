import{d as Q,r as F,c as I,m as G,i as c,e as u,f as a,g as l,w as o,u as e,h as d,A as se,E as le,l as V,t as p,j as C,F as T,k as D,b as M,n as J,C as oe,D as re,p as ne,W as ie}from"./app-MhRkZYda.js";import{c as X,_ as h}from"./createLucideIcon-CtoO_Kiv.js";import{a as B,b as N,c as S,_ as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-l03Rvke8.js";import{_ as K}from"./CardDescription.vue_vue_type_script_setup_true_lang-TWLMKxTH.js";import{_ as de}from"./Input.vue_vue_type_script_setup_true_lang-BIqg1Ebh.js";import{_ as z}from"./Label.vue_vue_type_script_setup_true_lang-dAqUlvBp.js";import{_ as Y}from"./Textarea.vue_vue_type_script_setup_true_lang-BYdeO-01.js";import{_ as ue}from"./Switch.vue_vue_type_script_setup_true_lang-KHOChy3H.js";import{_ as O,a as q}from"./index-8IM6hFwH.js";import{_ as pe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-s8UCj-v6.js";import{_ as me}from"./index-D9cSDYZw.js";import{u as ce,V as fe}from"./useTemplateVariables-DdOF5mqW.js";import{E as ve}from"./eye-CSWGUBTC.js";import{B as _e,I as be}from"./italic-Db39sYbe.js";import{S as Z}from"./smartphone-7ePRLdJx.js";import{I as ee}from"./info-Co3Y9UqI.js";import{t as E}from"./index-C4AhATEj.js";import{A as ge}from"./arrow-left-CREz2KBm.js";import{S as xe}from"./save-BCqaoal8.js";import{C as he}from"./circle-alert-Crskc4s_.js";import"./index-D1N0p-74.js";import"./VisuallyHidden-ClD0DDsS.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Cw5PJOxU.js";import"./check-DIKoOxln.js";import"./floating-ui.vue-Jtid5Cir.js";import"./nullish-CHIgUVhi.js";import"./VisuallyHiddenInput-Bw6ddUlF.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-D128fxVw.js";import"./index-CKzDzxRj.js";import"./x-DDu6o8kn.js";import"./index-CGlb_uG-.js";import"./shield-C7We-wCE.js";import"./user-ByVghZe9.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-ZgmtTIfd.js";import"./chevron-right-CLygI0q1.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BtbY9BuF.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-ZdbDwAbT.js";import"./map-pin-B5DXokRd.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-ZZIvmMj6.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BqmWBxIU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B_e-HSmn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DoAxHmi0.js";import"./target-B9U4ycgp.js";import"./users-jwOqaBj3.js";import"./vote-BbOfLgcg.js";import"./folder-open-CJtFOPOB.js";import"./send-B-3fqeSw.js";import"./file-text-CSf3KGSt.js";import"./briefcase-BhQcV9fE.js";import"./calendar-G1jntOAT.js";import"./megaphone-l3pQSHwh.js";import"./user-check-TX_Nop_V.js";import"./mail-D2iFew9f.js";import"./message-square-DqgXAPvJ.js";import"./external-link-D5LXOYvq.js";import"./panel-left-Bv2yObtj.js";import"./index-DhGDRjjN.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=X("CodeIcon",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=X("StrikethroughIcon",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]),ke={class:"space-y-4"},$e={class:"flex justify-between items-center"},Ve={class:"flex gap-2"},Ce={class:"flex items-center gap-2 text-sm"},Ae={class:"space-y-2"},Ee={key:0,class:"flex items-center gap-2 p-2 border rounded-md bg-muted/30"},Me={key:1},We={key:2,class:"min-h-[240px] p-4 border rounded-md bg-gray-50"},Fe={class:"max-w-sm mx-auto"},Se={class:"bg-white rounded-lg shadow p-3"},Pe={class:"flex items-center gap-2 mb-2"},je=["innerHTML"],Ue={class:"space-y-3"},ze={class:"text-sm font-medium mb-2"},Ie={class:"flex flex-wrap gap-2"},Te={class:"space-y-2"},De={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},Be={class:"ml-2 font-medium"},Ne={class:"ml-2 font-medium"},Le=Q({__name:"WhatsAppTemplateEditor",props:{modelValue:{default:""},usaFormato:{type:Boolean,default:!0},placeholder:{default:"Escribe tu mensaje de WhatsApp..."}},emits:["update:modelValue","update:usaFormato","update:variables"],setup(L,{emit:_}){const f=L,W=_,{variableCategories:n,extractUsedVariables:A,replaceWithExamples:H,estimateLength:R}=ce(),m=F(f.modelValue),w=F(!1),y=F(null),k=F(f.usaFormato),$=r=>{if(!y.value)return;const t=y.value.$el;if(!t)return;const s=t.selectionStart??0,g=t.selectionEnd??0,i=m.value||"",b=i.substring(s,g);if(!b)return;let x="";switch(r){case"bold":x=`*${b}*`;break;case"italic":x=`_${b}_`;break;case"strikethrough":x=`~${b}~`;break;case"monospace":x=`\`\`\`${b}\`\`\``;break}const te=i.substring(0,s),ae=i.substring(g);m.value=te+x+ae,setTimeout(()=>{t&&(t.selectionStart=s,t.selectionEnd=s+x.length,t.focus())},0)},j=r=>{if(!y.value)return;const t=y.value.$el;if(!t)return;const s=t.selectionStart??0,g=m.value||"",i=g.substring(0,s),b=g.substring(s);m.value=i+r+b,setTimeout(()=>{if(t){const x=s+r.length;t.selectionStart=x,t.selectionEnd=x,t.focus()}},0)},U=I(()=>{let r=H(m.value);return k.value&&(r=r.replace(/\*(.*?)\*/g,"<strong>$1</strong>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/~(.*?)~/g,"<del>$1</del>").replace(/```(.*?)```/g,"<code>$1</code>").replace(/\n/g,"<br>")),r}),v=I(()=>{const r=R(m.value),t=A(m.value);return{charactersMin:r.min,charactersMax:r.max,charactersAvg:r.avg,variables:t.length,warningMax:r.max>4096,warningAvg:r.avg>4096}});return G(m,r=>{W("update:modelValue",r),W("update:variables",A(r))}),G(k,r=>{W("update:usaFormato",r)}),G(()=>f.modelValue,r=>{r!==m.value&&(m.value=r)}),(r,t)=>(u(),c("div",ke,[a(e(P),null,{default:o(()=>[a(e(B),null,{default:o(()=>[l("div",$e,[a(e(N),null,{default:o(()=>[...t[7]||(t[7]=[d("Mensaje de WhatsApp",-1)])]),_:1}),l("div",Ve,[l("label",Ce,[se(l("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=s=>k.value=s),class:"rounded"},null,512),[[le,k.value]]),t[8]||(t[8]=l("span",null,"Usar formato WhatsApp",-1))]),a(e(h),{type:"button",variant:"outline",size:"sm",onClick:t[1]||(t[1]=V(s=>w.value=!w.value,["prevent","stop"]))},{default:o(()=>[a(e(ve),{class:"w-4 h-4 mr-2"}),d(" "+p(w.value?"Editar":"Vista previa"),1)]),_:1})])])]),_:1}),a(e(S),null,{default:o(()=>[l("div",Ae,[k.value&&!w.value?(u(),c("div",Ee,[a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[2]||(t[2]=V(s=>$("bold"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(_e),{class:"h-4 w-4 mr-1"}),t[9]||(t[9]=d(" *texto* ",-1))]),_:1}),a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[3]||(t[3]=V(s=>$("italic"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(be),{class:"h-4 w-4 mr-1"}),t[10]||(t[10]=d(" _texto_ ",-1))]),_:1}),a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[4]||(t[4]=V(s=>$("strikethrough"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(ye),{class:"h-4 w-4 mr-1"}),t[11]||(t[11]=d(" ~texto~ ",-1))]),_:1}),a(e(h),{type:"button",variant:"ghost",size:"sm",onClick:t[5]||(t[5]=V(s=>$("monospace"),["prevent","stop"])),class:"h-8 px-2"},{default:o(()=>[a(e(we),{class:"h-4 w-4 mr-1"}),t[12]||(t[12]=d(" ```texto``` ",-1))]),_:1})])):C("",!0),w.value?(u(),c("div",We,[l("div",Fe,[l("div",Se,[l("div",Pe,[a(e(Z),{class:"w-4 h-4 text-green-600"}),t[13]||(t[13]=l("span",{class:"text-sm font-medium"},"Vista previa WhatsApp",-1))]),l("div",{class:"text-sm whitespace-pre-wrap",innerHTML:U.value},null,8,je)])])])):(u(),c("div",Me,[a(e(Y),{ref_key:"textareaRef",ref:y,modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=s=>m.value=s),placeholder:r.placeholder,rows:"10",class:"w-full font-mono"},null,8,["modelValue","placeholder"])]))])]),_:1})]),_:1}),a(e(P),null,{default:o(()=>[a(e(B),null,{default:o(()=>[a(e(N),{class:"text-base"},{default:o(()=>[...t[14]||(t[14]=[d("Variables Disponibles",-1)])]),_:1})]),_:1}),a(e(S),null,{default:o(()=>[l("div",Ue,[(u(!0),c(T,null,D(e(n),(s,g)=>(u(),c("div",{key:g},[l("h4",ze,p(s.label),1),l("div",Ie,[(u(!0),c(T,null,D(s.variables,i=>(u(),M(e(me),{key:i.key,variant:"outline",class:"cursor-pointer hover:bg-accent",onClick:V(b=>j(i.key),["prevent","stop"])},{default:o(()=>[a(e(fe),{class:"w-3 h-3 mr-1"}),d(" "+p(i.key),1)]),_:2},1032,["onClick"]))),128))])]))),128))])]),_:1})]),_:1}),l("div",Te,[v.value.warningAvg?(u(),M(e(O),{key:0,variant:"warning"},{default:o(()=>[a(e(ee),{class:"h-4 w-4"}),a(e(q),null,{default:o(()=>[d(" El mensaje podría exceder el límite de 4096 caracteres de WhatsApp (promedio estimado: "+p(v.value.charactersAvg)+" caracteres) ",1)]),_:1})]),_:1})):C("",!0),a(e(P),null,{default:o(()=>[a(e(S),{class:"pt-6"},{default:o(()=>[l("div",De,[l("div",null,[t[15]||(t[15]=l("span",{class:"text-muted-foreground"},"Variables:",-1)),l("span",Be,p(v.value.variables),1)]),l("div",null,[t[16]||(t[16]=l("span",{class:"text-muted-foreground"},"Mín:",-1)),l("span",Ne,p(v.value.charactersMin)+" car.",1)]),l("div",null,[t[17]||(t[17]=l("span",{class:"text-muted-foreground"},"Máx:",-1)),l("span",{class:J(["ml-2 font-medium",{"text-red-600":v.value.warningMax}])},p(v.value.charactersMax)+" car. ",3)]),l("div",null,[t[18]||(t[18]=l("span",{class:"text-muted-foreground"},"Promedio:",-1)),l("span",{class:J(["ml-2 font-medium",{"text-yellow-600":v.value.warningAvg}])},p(v.value.charactersAvg)+" car. ",3)])])]),_:1})]),_:1})])]))}}),He={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Re={class:"flex justify-between items-center"},Ge={class:"text-3xl font-bold"},Oe={class:"text-muted-foreground mt-1"},qe={class:"flex gap-2"},Je={class:"list-disc pl-4"},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qe={key:0,class:"text-sm text-destructive mt-1"},Xe={class:"flex items-center space-x-2 mt-2"},Ye={key:0,class:"text-sm text-destructive mt-1"},Ze={class:"flex flex-wrap gap-2"},la=Q({__name:"Form",props:{plantilla:{},variablesDisponibles:{}},setup(L){var $,j,U,v,r;const _=L,f=I(()=>{var t;return!!((t=_.plantilla)!=null&&t.id)}),W=[{title:"Admin",href:"/admin/dashboard"},{title:"Campañas",href:"/admin/campanas"},{title:"Plantillas WhatsApp",href:"/admin/campanas/plantillas-whatsapp"},{title:f.value?"Editar Plantilla":"Nueva Plantilla",href:"#"}],n=oe({nombre:(($=_.plantilla)==null?void 0:$.nombre)||"",descripcion:((j=_.plantilla)==null?void 0:j.descripcion)||"",contenido:((U=_.plantilla)==null?void 0:U.contenido)||"",usa_formato:((v=_.plantilla)==null?void 0:v.usa_formato)??!0,es_activa:((r=_.plantilla)==null?void 0:r.es_activa)??!0}),A=F([]),H=t=>{n.contenido=t},R=t=>{n.usa_formato=t},m=t=>{A.value=t},w=()=>{var t;f.value?n.put(`/admin/campanas/plantillas-whatsapp/${(t=_.plantilla)==null?void 0:t.id}`,{onSuccess:()=>{E.success("Plantilla actualizada exitosamente")},onError:()=>{E.error("Error al actualizar la plantilla")}}):n.post("/admin/campanas/plantillas-whatsapp",{onSuccess:()=>{E.success("Plantilla creada exitosamente")},onError:()=>{E.error("Error al crear la plantilla")}})},y=I(()=>n.nombre&&n.contenido&&!n.processing),k=()=>{var s;const t=prompt("Ingresa el número de WhatsApp para la prueba (con código de país):");t&&ie.post(`/admin/campanas/plantillas-whatsapp/${((s=_.plantilla)==null?void 0:s.id)||"preview"}/test`,{phone:t,...n.data()},{onSuccess:()=>{E.success(`Mensaje de prueba enviado a ${t}`)},onError:()=>{E.error("Error al enviar el mensaje de prueba")}})};return(t,s)=>{const g=re("router-link");return u(),M(pe,{breadcrumbs:W},{default:o(()=>[a(e(ne),{title:f.value?"Editar Plantilla WhatsApp":"Nueva Plantilla WhatsApp"},null,8,["title"]),l("div",He,[l("form",{onSubmit:V(w,["prevent"]),class:"space-y-6"},[l("div",Re,[l("div",null,[l("h1",Ge,p(f.value?"Editar Plantilla":"Nueva Plantilla de WhatsApp"),1),l("p",Oe,p(f.value?"Modifica los detalles de la plantilla de WhatsApp":"Crea una nueva plantilla para tus campañas de WhatsApp"),1)]),l("div",qe,[a(g,{href:"/admin/campanas/plantillas-whatsapp"},{default:o(()=>[a(e(h),{type:"button",variant:"outline"},{default:o(()=>[a(e(ge),{class:"w-4 h-4 mr-2"}),s[3]||(s[3]=d(" Cancelar ",-1))]),_:1})]),_:1}),f.value?(u(),M(e(h),{key:0,type:"button",variant:"outline",onClick:k},{default:o(()=>[a(e(Z),{class:"w-4 h-4 mr-2"}),s[4]||(s[4]=d(" Enviar Prueba ",-1))]),_:1})):C("",!0),a(e(h),{type:"submit",disabled:!y.value},{default:o(()=>[a(e(xe),{class:"w-4 h-4 mr-2"}),d(" "+p(f.value?"Actualizar":"Guardar")+" Plantilla ",1)]),_:1},8,["disabled"])])]),Object.keys(e(n).errors).length>0?(u(),M(e(O),{key:0,variant:"destructive"},{default:o(()=>[a(e(he),{class:"h-4 w-4"}),a(e(q),null,{default:o(()=>[l("ul",Je,[(u(!0),c(T,null,D(e(n).errors,(i,b)=>(u(),c("li",{key:b},p(i),1))),128))])]),_:1})]),_:1})):C("",!0),a(e(P),null,{default:o(()=>[a(e(B),null,{default:o(()=>[a(e(N),null,{default:o(()=>[...s[5]||(s[5]=[d("Información Básica",-1)])]),_:1}),a(e(K),null,{default:o(()=>[...s[6]||(s[6]=[d(" Define el nombre y descripción de la plantilla ",-1)])]),_:1})]),_:1}),a(e(S),{class:"space-y-4"},{default:o(()=>[l("div",Ke,[l("div",null,[a(e(z),{htmlFor:"nombre"},{default:o(()=>[...s[7]||(s[7]=[d(" Nombre de la Plantilla ",-1),l("span",{class:"text-destructive"},"*",-1)])]),_:1}),a(e(de),{id:"nombre",modelValue:e(n).nombre,"onUpdate:modelValue":s[0]||(s[0]=i=>e(n).nombre=i),placeholder:"Ej: Recordatorio de evento",error:e(n).errors.nombre},null,8,["modelValue","error"]),e(n).errors.nombre?(u(),c("p",Qe,p(e(n).errors.nombre),1)):C("",!0)]),l("div",null,[a(e(z),{htmlFor:"es_activa"},{default:o(()=>[...s[8]||(s[8]=[d("Estado",-1)])]),_:1}),l("div",Xe,[a(e(ue),{id:"es_activa",modelValue:e(n).es_activa,"onUpdate:modelValue":s[1]||(s[1]=i=>e(n).es_activa=i)},null,8,["modelValue"]),a(e(z),{for:"es_activa",class:"cursor-pointer"},{default:o(()=>[d(p(e(n).es_activa?"Activa":"Inactiva"),1)]),_:1})])])]),l("div",null,[a(e(z),{htmlFor:"descripcion"},{default:o(()=>[...s[9]||(s[9]=[d("Descripción",-1)])]),_:1}),a(e(Y),{id:"descripcion",modelValue:e(n).descripcion,"onUpdate:modelValue":s[2]||(s[2]=i=>e(n).descripcion=i),placeholder:"Describe el propósito de esta plantilla...",rows:"3"},null,8,["modelValue"])])]),_:1})]),_:1}),a(e(P),null,{default:o(()=>[a(e(B),null,{default:o(()=>[a(e(N),null,{default:o(()=>[...s[10]||(s[10]=[d("Contenido del Mensaje",-1)])]),_:1}),a(e(K),null,{default:o(()=>[...s[11]||(s[11]=[d(" Define el contenido del mensaje de WhatsApp ",-1)])]),_:1})]),_:1}),a(e(S),null,{default:o(()=>[a(Le,{modelValue:e(n).contenido,usaFormato:e(n).usa_formato,"onUpdate:modelValue":H,"onUpdate:usaFormato":R,"onUpdate:variables":m},null,8,["modelValue","usaFormato"]),e(n).errors.contenido?(u(),c("p",Ye,p(e(n).errors.contenido),1)):C("",!0)]),_:1})]),_:1}),A.value.length>0?(u(),M(e(O),{key:1},{default:o(()=>[a(e(ee),{class:"h-4 w-4"}),a(e(q),null,{default:o(()=>[s[12]||(s[12]=l("p",{class:"font-medium mb-2"},"Variables utilizadas:",-1)),l("div",Ze,[(u(!0),c(T,null,D(A.value,i=>(u(),c("code",{key:i,class:"px-2 py-1 bg-muted rounded text-sm"},p(i),1))),128))])]),_:1})]),_:1})):C("",!0)],32)])]),_:1})}}});export{la as default};
