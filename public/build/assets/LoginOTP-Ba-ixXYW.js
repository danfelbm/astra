import{d as M,r as k,c as R,o as O,B as N,b as m,m as t,O as H,w as u,i as o,j as g,e as l,f as e,h as i,t as d,g as n,a as Q,u as q,q as X,l as P,n as D,F as G,k as J}from"./app-B8akDo5X.js";import{_ as B}from"./InputError.vue_vue_type_script_setup_true_lang-CteY9xj2.js";import{a as K,b as Y,c as Z,_ as ee}from"./CardTitle.vue_vue_type_script_setup_true_lang-VAG0deZE.js";import{_ as te,a as ae}from"./index-CP2JwLSi.js";import{_ as se}from"./AlertTitle.vue_vue_type_script_setup_true_lang-D3vq6XCq.js";import{_ as S}from"./createLucideIcon-CRQ99TGv.js";import{_ as F}from"./Skeleton.vue_vue_type_script_setup_true_lang-DVHFajMS.js";import{L as E}from"./loader-circle-NK4mQeBk.js";import{C as oe}from"./clock-DZGwd0ij.js";import{C as U}from"./check-j4eDw8Me.js";import{C as ne}from"./circle-alert-CTs4Wwq6.js";import{R as le}from"./refresh-cw-D5y4wKxB.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as re}from"./Input.vue_vue_type_script_setup_true_lang-BT--LyGg.js";import{_ as L}from"./Label.vue_vue_type_script_setup_true_lang-Cl05gzIl.js";import{_ as de,a as ue,b as ce}from"./PinInputSlot.vue_vue_type_script_setup_true_lang-CxaouSjJ.js";import{_ as pe}from"./AuthLayout.vue_vue_type_script_setup_true_lang-DOfIRbz_.js";import{M as me}from"./mail-D13J0FZB.js";import"./index-CiK5heoQ.js";import"./VisuallyHidden-BYTEKKJx.js";import"./useArrowNavigation-B5rxJs06.js";import"./VisuallyHiddenInput-cs_Av7lW.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-B9UspFrS.js";const ve={key:0,class:"mt-4"},fe={key:0,class:"space-y-3"},_e={key:1,class:"space-y-4"},ge={key:0,class:"text-xs text-muted-foreground space-y-1"},he={class:"flex items-center gap-2"},ye={class:"flex items-center gap-2"},ke={key:2,class:"text-center py-4"},xe=M({__name:"OTPQueueStatus",props:{identifier:{},autoRefresh:{type:Boolean,default:!0},refreshInterval:{default:3e3}},emits:["statusUpdate","error"],setup(I,{emit:v}){const h=I,C=v,r=k(!1),y=k(!1),s=k(""),x=k(""),c=k(!1),b=k(!1),f=k(null),V=R(()=>s.value==="sent"?"Código enviado con éxito":s.value==="processing"?"Procesando tu solicitud":"Verificando estado..."),W=R(()=>s.value==="sent"?x.value==="both"?"Tu código ha sido enviado por correo electrónico y WhatsApp":x.value==="whatsapp"?"Tu código ha sido enviado por WhatsApp":"Tu código ha sido enviado por correo electrónico":s.value==="processing"?"Tu código está siendo enviado en este momento...":""),$=async()=>{r.value=!0;try{const w=await Q.get(`/api/queue/otp/position/${encodeURIComponent(h.identifier)}`);if(w.data.success&&w.data.data){const _=w.data.data;s.value=_.status,x.value=_.canal||"email",c.value=_.email_sent||!1,b.value=_.whatsapp_sent||!1,y.value=!0,C("statusUpdate",s.value),s.value==="sent"&&A()}}catch(w){console.error("Error verificando estado:",w),C("error",w)}finally{r.value=!1}},j=()=>{h.autoRefresh&&(f.value=window.setInterval(()=>{$()},h.refreshInterval))},A=()=>{f.value&&(clearInterval(f.value),f.value=null)};return O(()=>{$(),j()}),N(()=>{A()}),(w,_)=>(t(),m(H,{name:"fade"},{default:u(()=>[y.value?(t(),o("div",ve,[l(e(ee),null,{default:u(()=>[l(e(K),null,{default:u(()=>[l(e(Y),{class:"flex items-center gap-2"},{default:u(()=>[r.value?(t(),m(e(E),{key:0,class:"h-4 w-4 animate-spin"})):g("",!0),!r.value&&s.value==="processing"?(t(),m(e(oe),{key:1,class:"h-4 w-4"})):g("",!0),!r.value&&s.value==="sent"?(t(),m(e(U),{key:2,class:"h-4 w-4 text-green-600"})):g("",!0),_[0]||(_[0]=i(" Estado de envío de tu código ",-1))]),_:1})]),_:1}),l(e(Z),null,{default:u(()=>[r.value?(t(),o("div",fe,[l(e(F),{class:"h-4 w-full"}),l(e(F),{class:"h-4 w-3/4"})])):s.value?(t(),o("div",_e,[l(e(te),{variant:(s.value==="sent","default")},{default:u(()=>[s.value==="processing"?(t(),m(e(ne),{key:0,class:"h-4 w-4"})):g("",!0),s.value==="sent"?(t(),m(e(U),{key:1,class:"h-4 w-4"})):g("",!0),l(e(se),null,{default:u(()=>[i(d(V.value),1)]),_:1}),l(e(ae),null,{default:u(()=>[i(d(W.value),1)]),_:1})]),_:1},8,["variant"]),x.value==="both"?(t(),o("div",ge,[n("div",he,[c.value?(t(),m(e(U),{key:0,class:"h-3 w-3 text-green-600"})):(t(),m(e(E),{key:1,class:"h-3 w-3 animate-spin"})),n("span",null,"Correo electrónico "+d(c.value?"enviado":"procesando"),1)]),n("div",ye,[b.value?(t(),m(e(U),{key:0,class:"h-3 w-3 text-green-600"})):(t(),m(e(E),{key:1,class:"h-3 w-3 animate-spin"})),n("span",null,"WhatsApp "+d(b.value?"enviado":"procesando"),1)])])):g("",!0)])):(t(),o("div",ke,[_[2]||(_[2]=n("p",{class:"text-sm text-muted-foreground"}," No se pudo obtener el estado ",-1)),l(e(S),{onClick:$,variant:"ghost",size:"sm",class:"mt-2"},{default:u(()=>[l(e(le),{class:"h-3 w-3 mr-2"}),_[1]||(_[1]=i(" Reintentar ",-1))]),_:1})]))]),_:1})]),_:1})])):g("",!0)]),_:1}))}}),be=ie(xe,[["__scopeId","data-v-ba142cd6"]]),Ce={key:0,class:"mb-4 text-center text-muted-foreground"},we={key:0},$e={key:0},Ie={key:1},Ee={key:2},Te={key:3},Se={key:1},Re={key:1,class:"mb-4 text-center text-muted-foreground"},Ve={key:0},Ae={key:1},Ue={key:2},We={key:2,class:"mb-4 text-center text-sm font-medium text-green-600"},je={class:"grid gap-6"},qe={class:"grid gap-2"},Pe={class:"relative"},Be={class:"grid gap-6"},Fe={class:"text-center"},Le={class:"text-sm text-muted-foreground"},Me={key:0},Oe={key:0},Ne={class:"font-medium"},ze={key:1},He={class:"font-medium"},Qe={key:2},Xe={class:"font-medium"},De={key:1},Ge={key:0},Je={class:"font-medium"},Ke={key:1},Ye={class:"font-medium"},Ze={class:"font-medium"},et={key:2},tt={class:"font-medium"},at={class:"font-medium"},st={class:"grid gap-2"},ot={class:"flex justify-center"},nt={class:"flex flex-col gap-3"},lt={class:"flex flex-col gap-2 text-center"},it={class:"mt-6 text-center text-xs text-muted-foreground"},rt={key:0},dt={key:1},ut=["innerHTML"],Wt=M({__name:"LoginOTP",props:{status:{},authConfig:{},censoredEmail:{},otpCredential:{},otpChannel:{},whatsappEnabled:{type:Boolean},intendedUrl:{}},setup(I){const v=I,h=k(v.censoredEmail?"otp":"credential"),C=k(v.censoredEmail||""),r=R(()=>v.authConfig||{login_type:"email",input_type:"email",placeholder:"correo@ejemplo.com",pattern:null,label:"Correo Electrónico"}),y=q({credential:""}),s=q({credential:v.otpCredential||"",otp_code:[]}),x=q({credential:"",otp_code:""}),c=k(!1),b=k(0),f=k(null),V=R(()=>b.value===0),W=R(()=>b.value>0?`Reenviar en ${b.value}s`:"Reenviar código"),$=(p=60)=>{b.value=p,f.value&&clearInterval(f.value),f.value=window.setInterval(()=>{b.value--,b.value<=0&&(clearInterval(f.value),f.value=null)},1e3)},j=()=>{c.value||y.processing||(c.value=!0,y.post(route("auth.request-otp"),{onSuccess:p=>{p.props&&p.props.censoredEmail&&(C.value=p.props.censoredEmail),h.value="otp",s.credential=y.credential,s.clearErrors(),$(60)},onError:()=>{},onFinish:()=>{c.value=!1}}))},A=()=>{const p=s.otp_code.join("");x.credential=s.credential,x.otp_code=p,x.post(route("auth.verify-otp"),{onSuccess:()=>{},onError:()=>{s.otp_code=[]}})},w=()=>{!V.value||c.value||s.processing||(c.value=!0,s.post(route("auth.resend-otp"),{onSuccess:p=>{p.props&&p.props.censoredEmail&&(C.value=p.props.censoredEmail),$(60)},onFinish:()=>{c.value=!1}}))},_=()=>{h.value="credential",s.reset(),f.value&&(clearInterval(f.value),f.value=null),b.value=0};return O(()=>{h.value==="otp"&&$(60);const p=localStorage.getItem("intendedUrl");p&&!v.intendedUrl&&fetch("/login?intended="+encodeURIComponent(p),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{localStorage.removeItem("intendedUrl")})}),N(()=>{f.value&&clearInterval(f.value)}),(p,a)=>(t(),m(pe,{title:h.value==="credential"?"Iniciar Sesión":"Verificar Código"},{default:u(()=>[l(e(X),{title:"Iniciar Sesión"}),h.value==="credential"?(t(),o("div",Ce,[r.value.login_type==="documento"?(t(),o("p",we,[a[2]||(a[2]=i(" Ingresa tu documento de identidad para recibir el código de verificación ",-1)),I.whatsappEnabled?v.otpChannel==="whatsapp"?(t(),o("strong",Ie,"vía WhatsApp")):v.otpChannel==="both"?(t(),o("strong",Ee,"vía correo electrónico y WhatsApp")):(t(),o("strong",Te,"vía correo electrónico")):(t(),o("strong",$e,"vía correo electrónico"))])):(t(),o("p",Se," Ingresa tu "+d(r.value.label.toLowerCase())+" para recibir el código de verificación ",1))])):(t(),o("div",Re,[v.otpChannel==="whatsapp"?(t(),o("p",Ve,[...a[3]||(a[3]=[i(" Ingresa el código de 6 dígitos enviado a tu ",-1),n("strong",null,"WhatsApp",-1)])])):v.otpChannel==="both"?(t(),o("p",Ae,[...a[4]||(a[4]=[i(" Ingresa el código de 6 dígitos enviado a tu ",-1),n("strong",null,"correo y WhatsApp",-1)])])):(t(),o("p",Ue,[...a[5]||(a[5]=[i(" Ingresa el código de 6 dígitos enviado a tu ",-1),n("strong",null,"correo",-1)])]))])),I.status?(t(),o("div",We,d(I.status),1)):g("",!0),h.value==="credential"?(t(),o("form",{key:3,onSubmit:P(j,["prevent"]),class:"flex flex-col gap-6"},[n("div",je,[n("div",qe,[l(e(L),{for:"credential"},{default:u(()=>[i(d(r.value.label),1)]),_:1}),n("div",Pe,[r.value.login_type==="email"?(t(),m(e(me),{key:0,class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})):g("",!0),l(e(re),{id:"credential",type:r.value.input_type,required:"",autofocus:"",tabindex:"1",autocomplete:r.value.login_type==="email"?"email":"off",inputmode:r.value.login_type==="documento"?"numeric":void 0,modelValue:e(y).credential,"onUpdate:modelValue":a[0]||(a[0]=T=>e(y).credential=T),placeholder:r.value.placeholder,pattern:r.value.pattern,class:D({"pl-10":r.value.login_type==="email"})},null,8,["type","autocomplete","inputmode","modelValue","placeholder","pattern","class"])]),l(B,{message:e(y).errors.credential},null,8,["message"])]),l(e(S),{type:"submit",class:"mt-4 w-full",tabindex:"2",disabled:e(y).processing||c.value},{default:u(()=>[e(y).processing||c.value?(t(),m(e(E),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):g("",!0),i(" "+d(e(y).processing||c.value?"Enviando...":"Enviar Código"),1)]),_:1},8,["disabled"])])],32)):(t(),o("form",{key:4,onSubmit:P(A,["prevent"]),class:"flex flex-col gap-6"},[n("div",Be,[n("div",Fe,[n("p",Le,[r.value.login_type==="email"?(t(),o("span",Me,[v.otpChannel==="whatsapp"?(t(),o("span",Oe,[a[6]||(a[6]=i(" Código enviado por WhatsApp al número asociado con ",-1)),n("span",Ne,d(C.value||e(s).credential),1)])):v.otpChannel==="both"?(t(),o("span",ze,[a[7]||(a[7]=i(" Código enviado al email ",-1)),n("span",He,d(C.value||e(s).credential),1),a[8]||(a[8]=i(" y WhatsApp ",-1))])):(t(),o("span",Qe,[a[9]||(a[9]=i(" Código enviado al email ",-1)),n("span",Xe,d(C.value||e(s).credential),1)]))])):(t(),o("span",De,[v.otpChannel==="whatsapp"?(t(),o("span",Ge,[a[10]||(a[10]=i(" Código enviado por WhatsApp al número asociado con el documento ",-1)),n("span",Je,d(e(s).credential),1)])):v.otpChannel==="both"?(t(),o("span",Ke,[a[11]||(a[11]=i(" Código enviado al email ",-1)),n("span",Ye,d(C.value),1),a[12]||(a[12]=i(" y WhatsApp asociados al documento ",-1)),n("span",Ze,d(e(s).credential),1)])):(t(),o("span",et,[a[13]||(a[13]=i(" Código enviado al email ",-1)),n("span",tt,d(C.value),1),a[14]||(a[14]=i(" asociado al documento ",-1)),n("span",at,d(e(s).credential),1)]))]))])]),n("div",st,[l(e(L),{class:"text-center"},{default:u(()=>[...a[15]||(a[15]=[i("Código de Verificación",-1)])]),_:1}),n("div",ot,[l(e(de),{modelValue:e(s).otp_code,"onUpdate:modelValue":a[1]||(a[1]=T=>e(s).otp_code=T),length:6,type:"text",placeholder:"0",class:"gap-2"},{default:u(()=>[l(e(ue),null,{default:u(()=>[(t(),o(G,null,J(6,(T,z)=>l(e(ce),{key:T,index:z,class:"h-12 w-12 text-lg font-medium",inputmode:"numeric"},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue"])]),l(B,{message:e(s).errors.otp_code},null,8,["message"])]),n("div",nt,[l(e(S),{type:"submit",class:"w-full",disabled:e(x).processing||e(s).otp_code.join("").length!==6},{default:u(()=>[e(x).processing?(t(),m(e(E),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):g("",!0),i(" "+d(e(x).processing?"Verificando...":"Verificar Código"),1)]),_:1},8,["disabled"]),n("div",lt,[l(e(S),{type:"button",variant:"ghost",size:"sm",onClick:w,disabled:!V.value||c.value},{default:u(()=>[c.value?(t(),m(e(E),{key:0,class:"mr-2 h-3 w-3 animate-spin"})):g("",!0),i(" "+d(c.value?"Enviando...":W.value),1)]),_:1},8,["disabled"]),l(e(S),{type:"button",variant:"ghost",size:"sm",onClick:_},{default:u(()=>[i(d(r.value.login_type==="email"?"Cambiar correo electrónico":"Cambiar documento"),1)]),_:1})])])])],32)),h.value==="otp"?(t(),m(be,{key:5,identifier:e(s).credential},null,8,["identifier"])):g("",!0),n("div",it,[h.value==="credential"?(t(),o("p",rt," Solo personas registradas como militantes pueden acceder al sistema. ")):(t(),o("p",dt," El código expira en 10 minutos. Si no lo recibes, verifica tu bandeja de spam. ")),a[16]||(a[16]=n("br",null,null,-1)),n("p",{innerHTML:p.$page.props.config["auth.mensaje_login"]||"Si necesitas ayuda escribe a <b>soporte@colombiahumana.co</b> para soporte sobre la plataforma. Para inquietudes jurídicas a <b>juridicoelectoral@colombiahumana.co</b>"},null,8,ut)])]),_:1},8,["title"]))}});export{Wt as default};
