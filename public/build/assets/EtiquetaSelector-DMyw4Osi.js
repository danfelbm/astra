import{_ as G}from"./createLucideIcon-BzCZ4Ux9.js";import{_ as R}from"./index-BFz4Rjr1.js";import{_ as ee}from"./Label.vue_vue_type_script_setup_true_lang-DXnOW2ZY.js";import{_ as te}from"./Input.vue_vue_type_script_setup_true_lang-DEoN5cyd.js";import{_ as ae,a as se,b as le}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-YQlb3DeH.js";import{_ as oe,a as ne,b as M,c as j}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-kODy9m7A.js";import{_ as re,a as ie,c as ue,b as de,e as ce,d as me}from"./index-Dki1LRYW.js";import{u as fe}from"./useEtiquetaHierarchy-DQ_1ZSWk.js";import{d as X,c as x,D as pe,i as d,e as l,g,j as f,f as n,b as v,l as ge,u as s,n as N,h as _,t as c,w as u,s as ve,F as C,k as $,r as E,m as Q,q as Z}from"./app-D8b1iyhG.js";import{C as _e}from"./chevron-right-C1p0_YAD.js";import{C as J}from"./check-DAlbwhOo.js";import{C as he}from"./chevrons-up-down-C6uCeRcr.js";import{L as be}from"./list-Czoe5px5.js";import{T as ye}from"./tree-pine-90pzmY-u.js";import{P as xe}from"./plus-uXDWVO4e.js";import{X as qe}from"./x-Di3hRZd2.js";import{G as ke,B as we,P as Ee,Z as Ce,H as $e,S as Ve,a as Se}from"./zap-ramnlgGB.js";import{L as Te}from"./layers-DLpoyZYZ.js";import{F as Be,T as z}from"./tag-DOh8ybwv.js";import{T as Ie}from"./trending-up-CeBLQsDt.js";import{A as Le}from"./award-DxuGRY3S.js";import{T as Fe}from"./target-9B9VxhTw.js";import{F as Ne}from"./flag-lhl3rH4D.js";import{H as Ue}from"./hash-BCfguDS2.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const De={key:1,class:"w-4"},He={class:"flex-1 text-sm"},Pe={key:0,class:"text-xs text-muted-foreground ml-1"},Ge={key:0},Me=X({__name:"EtiquetaSelectorTreeItem",props:{etiqueta:{},nivel:{default:0},selectedIds:{},expandidos:{},isSelectable:{}},emits:["toggle-expand","toggle-select"],setup(B,{emit:I}){const o=B,q=I,p=x(()=>o.expandidos.has(o.etiqueta.id)),m=x(()=>o.selectedIds.includes(o.etiqueta.id)),h=x(()=>o.etiqueta.children&&o.etiqueta.children.length>0),k=()=>{q("toggle-expand",o.etiqueta.id)},V=()=>{o.isSelectable(o.etiqueta)&&q("toggle-select",o.etiqueta)};return(i,b)=>{const L=pe("EtiquetaSelectorTreeItem",!0);return l(),d("div",null,[g("div",{class:"flex items-center gap-1 py-1 px-2 hover:bg-accent rounded cursor-pointer select-none",style:ve({paddingLeft:i.nivel*20+8+"px"}),onClick:V},[h.value?(l(),d("button",{key:0,onClick:ge(k,["stop"]),class:"p-0.5 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",type:"button"},[n(s(_e),{class:N(["h-3 w-3 transition-transform",p.value?"rotate-90":""])},null,8,["class"])])):(l(),d("span",De)),n(s(J),{class:N(["h-4 w-4 flex-shrink-0",m.value?"opacity-100":"opacity-0"])},null,8,["class"]),g("span",He,[_(c(i.etiqueta.nombre)+" ",1),i.etiqueta.categoria?(l(),d("span",Pe," ("+c(i.etiqueta.categoria.nombre)+") ",1)):f("",!0)]),i.etiqueta.usos_count>0?(l(),v(s(R),{key:2,variant:"secondary",class:"text-xs"},{default:u(()=>[_(c(i.etiqueta.usos_count),1)]),_:1})):f("",!0)],4),p.value&&h.value?(l(),d("div",Ge,[(l(!0),d(C,null,$(i.etiqueta.children,S=>(l(),v(L,{key:S.id,etiqueta:S,nivel:i.nivel+1,"selected-ids":i.selectedIds,expandidos:i.expandidos,"is-selectable":i.isSelectable,onToggleExpand:b[0]||(b[0]=w=>i.$emit("toggle-expand",w)),onToggleSelect:b[1]||(b[1]=w=>i.$emit("toggle-select",w))},null,8,["etiqueta","nivel","selected-ids","expandidos","is-selectable"]))),128))])):f("",!0)])}}}),je={class:"space-y-2"},Qe={key:0,class:"flex justify-between items-center"},Ze={class:"text-xs text-muted-foreground"},ze={class:"text-left truncate"},Re={class:"border-b px-3 pt-3"},Xe={class:"p-2 text-sm"},Je={key:1,class:"text-xs text-muted-foreground ml-1"},Ke={key:2,class:"ml-auto text-xs text-muted-foreground"},Oe={class:"p-2"},We={class:"max-h-[300px] overflow-y-auto border rounded-lg p-2"},Ye={key:0,class:"p-4 text-center text-sm text-muted-foreground"},et={key:1},tt={key:1,class:"flex flex-wrap gap-1.5"},at=["onClick","disabled"],st={key:2,class:"text-sm text-muted-foreground"},lt=X({__name:"EtiquetaSelector",props:{modelValue:{},categorias:{},maxEtiquetas:{default:10},placeholder:{default:"Seleccionar etiquetas..."},disabled:{type:Boolean,default:!1},allowCreate:{type:Boolean,default:!1},label:{default:""},description:{default:""}},emits:["update:modelValue","create"],setup(B,{emit:I}){const o=B,q=I,p=E(!1),m=E(""),h=E(""),k=E("list"),V=`etiqueta-selector-${Math.random().toString(36).substr(2,9)}`,i=E([]),{expandidos:b,construirArbol:L,filtrarArbol:S,toggleExpansion:w}=fe(i),K=x(()=>{if(!m.value)return o.categorias;const a=m.value.toLowerCase();return o.categorias.map(e=>{var t;return{...e,etiquetas:((t=e.etiquetas)==null?void 0:t.filter(r=>{var T;return r.nombre.toLowerCase().includes(a)||((T=r.descripcion)==null?void 0:T.toLowerCase().includes(a))}))||[]}}).filter(e=>e.etiquetas.length>0)}),y=x(()=>{const a=[];return o.categorias.forEach(e=>{var t;(t=e.etiquetas)==null||t.forEach(r=>{o.modelValue.includes(r.id)&&a.push({...r,categoria:e})})}),a});function F(a){return o.modelValue.includes(a)}function U(a){return o.disabled?!1:F(a.id)?!0:o.modelValue.length<o.maxEtiquetas}function A(a){const e=a.id;let t=[...o.modelValue];if(F(e))t=t.filter(r=>r!==e);else if(t.length<o.maxEtiquetas)t.push(e);else return;q("update:modelValue",t)}function O(a){const e=o.modelValue.filter(t=>t!==a);q("update:modelValue",e)}function W(){var e;if(!o.allowCreate||!m.value)return;const a=(e=o.categorias[0])==null?void 0:e.id;a&&(q("create",m.value,a),m.value="",p.value=!1)}function D(a){return{Tag:z,Hash:Ue,Bookmark:Se,Flag:Ne,Star:Ve,Heart:$e,Zap:Ce,Target:Fe,Award:Le,TrendingUp:Ie,Folder:Be,Package:Ee,Box:we,Layers:Te,Grid:ke}[a]||z}const Y=x(()=>y.value.length===0?o.placeholder:y.value.length===1?y.value[0].nombre:`${y.value.length} etiquetas seleccionadas`),H=x(()=>h.value?S(h.value,i.value):i.value);Q(p,a=>{a&&k.value==="tree"&&P()}),Q(k,a=>{a==="tree"&&p.value&&P()});function P(){const a=[];o.categorias.forEach(e=>{e.etiquetas&&e.etiquetas.forEach(t=>{a.push({...t,categoria:e})})}),i.value=L(a),i.value.forEach(e=>{e.children&&e.children.length>0&&b.value.add(e.id)})}return(a,e)=>(l(),d("div",je,[a.label?(l(),d("div",Qe,[n(s(ee),{for:V},{default:u(()=>[_(c(a.label),1)]),_:1}),g("span",Ze,c(y.value.length)+" / "+c(a.maxEtiquetas)+" seleccionadas ",1)])):f("",!0),n(s(ae),{open:p.value,"onUpdate:open":e[3]||(e[3]=t=>p.value=t)},{default:u(()=>[n(s(se),{asChild:""},{default:u(()=>[n(s(G),{id:V,variant:"outline",role:"combobox","aria-expanded":p.value,disabled:a.disabled,class:"w-full justify-between"},{default:u(()=>[g("span",ze,c(Y.value),1),n(s(he),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","disabled"])]),_:1}),n(s(le),{class:"w-full p-0",align:"start"},{default:u(()=>[n(s(oe),{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=t=>k.value=t),class:"w-full"},{default:u(()=>[g("div",Re,[n(s(ne),{class:"grid w-full grid-cols-2"},{default:u(()=>[n(s(M),{value:"list"},{default:u(()=>[n(s(be),{class:"h-4 w-4 mr-2"}),e[4]||(e[4]=_(" Lista ",-1))]),_:1}),n(s(M),{value:"tree"},{default:u(()=>[n(s(ye),{class:"h-4 w-4 mr-2"}),e[5]||(e[5]=_(" Árbol ",-1))]),_:1})]),_:1})]),n(s(j),{value:"list",class:"mt-0"},{default:u(()=>[n(s(re),null,{default:u(()=>[n(s(ie),{placeholder:"Buscar etiqueta...",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t)},null,8,["modelValue"]),n(s(ue),null,{default:u(()=>[g("div",Xe,[e[6]||(e[6]=_(" No se encontraron etiquetas. ",-1)),a.allowCreate&&m.value.length>2?(l(),v(s(G),{key:0,onClick:W,variant:"ghost",size:"sm",class:"w-full mt-1"},{default:u(()=>[n(s(xe),{class:"mr-2 h-3 w-3"}),_(' Crear "'+c(m.value)+'" ',1)]),_:1})):f("",!0)])]),_:1}),n(s(de),null,{default:u(()=>[(l(!0),d(C,null,$(K.value,t=>(l(),v(s(ce),{key:t.id,heading:t.nombre},{default:u(()=>[(l(!0),d(C,null,$(t.etiquetas,r=>(l(),v(s(me),{key:r.id,value:r,onSelect:T=>A(r),disabled:!U(r),class:"cursor-pointer"},{default:u(()=>[n(s(J),{class:N(["mr-2 h-4 w-4",F(r.id)?"opacity-100":"opacity-0"])},null,8,["class"]),t.icono?(l(),v(Z(D(t.icono)),{key:0,class:"mr-2 h-3 w-3 opacity-60"})):f("",!0),_(" "+c(r.nombre)+" ",1),r.parent?(l(),d("span",Je," ("+c(r.parent.nombre)+") ",1)):f("",!0),r.descripcion?(l(),d("span",Ke,c(r.descripcion),1)):f("",!0)]),_:2},1032,["value","onSelect","disabled"]))),128))]),_:2},1032,["heading"]))),128))]),_:1})]),_:1})]),_:1}),n(s(j),{value:"tree",class:"mt-0"},{default:u(()=>[g("div",Oe,[n(s(te),{placeholder:"Buscar en árbol...",modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),class:"mb-2"},null,8,["modelValue"]),g("div",We,[H.value.length===0?(l(),d("div",Ye," No se encontraron etiquetas ")):(l(),d("div",et,[(l(!0),d(C,null,$(H.value,t=>(l(),v(Me,{key:t.id,etiqueta:t,nivel:0,"selected-ids":a.modelValue,expandidos:s(b),"is-selectable":U,onToggleExpand:s(w),onToggleSelect:A},null,8,["etiqueta","selected-ids","expandidos","onToggleExpand"]))),128))]))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["open"]),y.value.length>0?(l(),d("div",tt,[(l(!0),d(C,null,$(y.value,t=>(l(),v(s(R),{key:t.id,variant:"secondary",class:"pr-1"},{default:u(()=>{var r;return[(r=t.categoria)!=null&&r.icono?(l(),v(Z(D(t.categoria.icono)),{key:0,class:"mr-1 h-3 w-3"})):f("",!0),_(" "+c(t.nombre)+" ",1),g("button",{onClick:T=>O(t.id),disabled:a.disabled,class:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[n(s(qe),{class:"h-3 w-3 hover:opacity-80"})],8,at)]}),_:2},1024))),128))])):f("",!0),a.description?(l(),d("p",st,c(a.description),1)):f("",!0)]))}}),Tt=Ae(lt,[["__scopeId","data-v-5b4760bd"]]);export{Tt as E};
