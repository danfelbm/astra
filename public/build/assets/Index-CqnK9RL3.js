import{d as ee,c as B,r as v,s as p,p as te,b,w as s,g as a,e as o,i as F,j,t as d,f as e,v as R,h as m,m as c,F as A,k as M,M as oe}from"./app-BrD2QGCV.js";import{_ as se}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DZYDPVQJ.js";import{_ as x,a as E,b as C,c as y}from"./CardTitle.vue_vue_type_script_setup_true_lang-DAXo-B_x.js";import{_ as k}from"./createLucideIcon-CfvjSeOT.js";import{_ as ae}from"./Input.vue_vue_type_script_setup_true_lang-q8xABjEX.js";import{_ as I,a as G,b as O,c as q,d as S}from"./SelectValue.vue_vue_type_script_setup_true_lang-r_ipOL3R.js";import{_ as le}from"./Progress.vue_vue_type_script_setup_true_lang-BGoEEFsA.js";import{u as re}from"./useToast-BA3VBq6S.js";import{l as ie}from"./lodash-DrEDXzHS.js";import{_ as ne}from"./EntregablesTable.vue_vue_type_script_setup_true_lang-B-oCllUt.js";import{A as de}from"./arrow-left-DFkojAHR.js";import{P as me}from"./plus-CnnTpAtf.js";import{T as ue}from"./target-dK9v5UXZ.js";import{C as ce}from"./circle-check-BqkTo4ZH.js";import{C as fe}from"./clock-4chQLfX0.js";import{C as pe}from"./circle-alert-C3pua8qZ.js";import{F as ge}from"./filter-nxNxH-UA.js";import{S as ve}from"./search-CqiX6YvP.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Ym97pKSR.js";import"./index-CaxA_LAe.js";import"./floating-ui.vue-gLKKvGLM.js";import"./x-GbNmdtd1.js";import"./index-C-zWBZWq.js";import"./shield-B5Q6GdXO.js";import"./user-CFoGTRlH.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DyEz-uPK.js";import"./chevron-right-YNwTIyTL.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BUWxYp1-.js";import"./VisuallyHidden-nhjRayVb.js";import"./index-BUVuXDf0.js";import"./Label.vue_vue_type_script_setup_true_lang-DZqq_eao.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CE6wF4w5.js";import"./index-DnzQ_biR.js";import"./map-pin-9JO26skO.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DYQJYrap.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-GBfMPHrO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-BhbJk3yE.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CzSE5pTM.js";import"./tag-Bb4Acpj2.js";import"./users-CKUBvxrh.js";import"./vote-DlQ2_ROW.js";import"./folder-open-EMUKzbDY.js";import"./send-QuKJqBZV.js";import"./file-text-CTdhs6hj.js";import"./briefcase-CM5vbtF2.js";import"./calendar-CYwFKqbN.js";import"./megaphone-DKElQkZz.js";import"./user-check-DLvFRXOO.js";import"./clipboard-list-Br-bGukG.js";import"./mail-CReXc2pr.js";import"./message-square-P8I4Nbh3.js";import"./external-link-BzGRET35.js";import"./panel-left-DBcB4ucU.js";import"./index-CNCNgiGH.js";import"./check-DCLeEZ05.js";import"./index-lazXCbFK.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-ByXequ3_.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Bsdl3ZMu.js";import"./eye-CJEUMqxr.js";import"./square-pen-CirwZveB.js";import"./trash-2-CDmVNBir.js";const be={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xe={class:"flex items-center justify-between"},ye={class:"text-muted-foreground mt-2"},he={class:"flex gap-2"},_e={class:"grid gap-4 md:grid-cols-4"},$e={class:"text-2xl font-bold"},we={class:"text-xs text-muted-foreground mt-2"},Ee={class:"text-2xl font-bold"},Ce={class:"text-xs text-muted-foreground"},ke={class:"text-2xl font-bold"},Ve={class:"text-2xl font-bold"},Pe={class:"flex items-center justify-between"},Te={class:"grid gap-4 md:grid-cols-4"},Be={class:"relative"},Fe={key:0,class:"flex items-center justify-between"},Se={class:"text-sm text-muted-foreground"},De={class:"flex gap-2"},Rt=ee({__name:"Index",props:{proyecto:{},hito:{},entregables:{},filters:{},resumenUsuarios:{},estados:{},prioridades:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canAssign:{type:Boolean}},setup(n){var N,z,U,H,L;const l=n,{toast:g}=re(),u=B(()=>Array.isArray(l.entregables)?{data:l.entregables,current_page:1,last_page:1,per_page:l.entregables.length,total:l.entregables.length,from:1,to:l.entregables.length}:l.entregables),h=v(((N=l.filters)==null?void 0:N.search)||""),_=v(((z=l.filters)==null?void 0:z.estado)||""),$=v(((U=l.filters)==null?void 0:U.prioridad)||""),D=v(((L=(H=l.filters)==null?void 0:H.responsable_id)==null?void 0:L.toString())||"");v([]);const V=v(!1),J=B(()=>[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:l.proyecto.nombre,href:`/admin/proyectos/${l.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${l.proyecto.id}/hitos`},{title:l.hito.nombre,href:`/admin/proyectos/${l.proyecto.id}/hitos/${l.hito.id}`},{title:"Entregables"}]),K=ie.debounce(()=>{p.get(`/admin/proyectos/${l.proyecto.id}/hitos/${l.hito.id}/entregables`,{search:h.value,estado:_.value,prioridad:$.value,responsable_id:D.value,page:1},{preserveState:!0,preserveScroll:!0})},300);te([h,_,$,D],()=>{K()});const Q=()=>{h.value="",_.value="",$.value="",D.value=""},W=i=>{l.canComplete&&p.post(`/admin/proyectos/${l.proyecto.id}/hitos/${l.hito.id}/entregables/${i.id}/completar`,{notas_completado:`Completado por ${oe().props.auth.user.name}`},{onSuccess:()=>{g.success("Entregable marcado como completado")},onError:()=>{g.error("Error al marcar el entregable como completado")}})},X=i=>{l.canDelete&&confirm(`¿Estás seguro de eliminar el entregable "${i.nombre}"?`)&&p.delete(`/admin/proyectos/${l.proyecto.id}/hitos/${l.hito.id}/entregables/${i.id}`,{onSuccess:()=>{g.success("Entregable eliminado correctamente")},onError:()=>{g.error("Error al eliminar el entregable")}})},Y=i=>{l.canEdit&&p.post(`/admin/proyectos/${l.proyecto.id}/hitos/${l.hito.id}/entregables/${i.id}/actualizar-estado`,{estado:"en_progreso"},{onSuccess:()=>{g.success("Entregable marcado como en progreso")},onError:()=>{g.error("Error al actualizar el estado del entregable")}})},P=i=>{if(!i)return null;const t=new Date,T=new Date(i).getTime()-t.getTime();return Math.ceil(T/(1e3*60*60*24))};B(()=>u.value.data.map(i=>({...i,diasRestantes:P(i.fecha_fin),estaVencido:i.fecha_fin&&P(i.fecha_fin)<0,estaProximoVencer:i.fecha_fin&&P(i.fecha_fin)>=0&&P(i.fecha_fin)<=7})));const f=B(()=>{const i=u.value.data,t=u.value.total,r=i.filter(w=>w.estado==="completado").length,T=i.filter(w=>w.estado==="en_progreso").length,Z=i.filter(w=>w.estado==="pendiente").length;return{total:t,completados:r,enProgreso:T,pendientes:Z,progreso:t>0?Math.round(r/t*100):0}});return(i,t)=>(c(),b(se,{breadcrumbs:J.value},{default:s(()=>[a("div",be,[a("div",xe,[a("div",null,[t[6]||(t[6]=a("h2",{class:"text-3xl font-bold tracking-tight"},"Entregables del Hito",-1)),a("p",ye,d(n.hito.nombre)+" - "+d(n.proyecto.nombre),1)]),a("div",he,[o(e(R),{href:`/admin/proyectos/${n.proyecto.id}/hitos`,as:"button"},{default:s(()=>[o(e(k),{variant:"outline"},{default:s(()=>[o(e(de),{class:"mr-2 h-4 w-4"}),t[7]||(t[7]=m(" Volver a Hitos ",-1))]),_:1})]),_:1},8,["href"]),n.canCreate?(c(),b(e(R),{key:0,href:`/admin/proyectos/${n.proyecto.id}/hitos/${n.hito.id}/entregables/create`,as:"button"},{default:s(()=>[o(e(k),null,{default:s(()=>[o(e(me),{class:"mr-2 h-4 w-4"}),t[8]||(t[8]=m(" Nuevo Entregable ",-1))]),_:1})]),_:1},8,["href"])):j("",!0)])]),a("div",_e,[o(e(x),null,{default:s(()=>[o(e(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(e(C),{class:"text-sm font-medium"},{default:s(()=>[...t[9]||(t[9]=[m("Total Entregables",-1)])]),_:1}),o(e(ue),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),o(e(y),null,{default:s(()=>[a("div",$e,d(f.value.total),1),o(e(le),{value:f.value.progreso,class:"mt-2"},null,8,["value"]),a("p",we,d(f.value.progreso)+"% completado ",1)]),_:1})]),_:1}),o(e(x),null,{default:s(()=>[o(e(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(e(C),{class:"text-sm font-medium"},{default:s(()=>[...t[10]||(t[10]=[m("Completados",-1)])]),_:1}),o(e(ce),{class:"h-4 w-4 text-green-600"})]),_:1}),o(e(y),null,{default:s(()=>[a("div",Ee,d(f.value.completados),1),a("p",Ce," de "+d(f.value.total)+" entregables ",1)]),_:1})]),_:1}),o(e(x),null,{default:s(()=>[o(e(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(e(C),{class:"text-sm font-medium"},{default:s(()=>[...t[11]||(t[11]=[m("En Progreso",-1)])]),_:1}),o(e(fe),{class:"h-4 w-4 text-blue-600"})]),_:1}),o(e(y),null,{default:s(()=>[a("div",ke,d(f.value.enProgreso),1),t[12]||(t[12]=a("p",{class:"text-xs text-muted-foreground"}," actualmente activos ",-1))]),_:1})]),_:1}),o(e(x),null,{default:s(()=>[o(e(E),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:s(()=>[o(e(C),{class:"text-sm font-medium"},{default:s(()=>[...t[13]||(t[13]=[m("Pendientes",-1)])]),_:1}),o(e(pe),{class:"h-4 w-4 text-orange-600"})]),_:1}),o(e(y),null,{default:s(()=>[a("div",Ve,d(f.value.pendientes),1),t[14]||(t[14]=a("p",{class:"text-xs text-muted-foreground"}," por iniciar ",-1))]),_:1})]),_:1})]),o(e(x),null,{default:s(()=>[o(e(E),null,{default:s(()=>[a("div",Pe,[o(e(C),null,{default:s(()=>[...t[15]||(t[15]=[m("Entregables",-1)])]),_:1}),o(e(k),{variant:"outline",size:"sm",onClick:t[0]||(t[0]=r=>V.value=!V.value)},{default:s(()=>[o(e(ge),{class:"mr-2 h-4 w-4"}),m(" "+d(V.value?"Ocultar":"Mostrar")+" Filtros ",1)]),_:1})])]),_:1}),V.value?(c(),b(e(y),{key:0,class:"space-y-4"},{default:s(()=>[a("div",Te,[a("div",null,[t[16]||(t[16]=a("label",{class:"text-sm font-medium"},"Buscar",-1)),a("div",Be,[o(e(ve),{class:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),o(e(ae),{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=r=>h.value=r),placeholder:"Buscar entregable...",class:"pl-8"},null,8,["modelValue"])])]),a("div",null,[t[18]||(t[18]=a("label",{class:"text-sm font-medium"},"Estado",-1)),o(e(I),{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=r=>_.value=r)},{default:s(()=>[o(e(G),null,{default:s(()=>[o(e(O),{placeholder:"Todos los estados"})]),_:1}),o(e(q),null,{default:s(()=>[o(e(S),{value:""},{default:s(()=>[...t[17]||(t[17]=[m("Todos los estados",-1)])]),_:1}),(c(!0),F(A,null,M(n.estados,r=>(c(),b(e(S),{key:r.value,value:r.value},{default:s(()=>[m(d(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),a("div",null,[t[20]||(t[20]=a("label",{class:"text-sm font-medium"},"Prioridad",-1)),o(e(I),{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=r=>$.value=r)},{default:s(()=>[o(e(G),null,{default:s(()=>[o(e(O),{placeholder:"Todas las prioridades"})]),_:1}),o(e(q),null,{default:s(()=>[o(e(S),{value:""},{default:s(()=>[...t[19]||(t[19]=[m("Todas las prioridades",-1)])]),_:1}),(c(!0),F(A,null,M(n.prioridades,r=>(c(),b(e(S),{key:r.value,value:r.value},{default:s(()=>[m(d(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),a("div",null,[t[22]||(t[22]=a("label",{class:"text-sm font-medium"}," ",-1)),o(e(k),{onClick:Q,variant:"outline",class:"w-full"},{default:s(()=>[...t[21]||(t[21]=[m(" Limpiar Filtros ",-1)])]),_:1})])])]),_:1})):j("",!0)]),_:1}),o(e(x),null,{default:s(()=>[o(e(y),{class:"p-0"},{default:s(()=>[o(ne,{entregables:u.value.data,"proyecto-id":n.proyecto.id,"hito-id":n.hito.id,"can-edit":n.canEdit,"can-delete":n.canDelete,"can-complete":n.canComplete,onView:t[4]||(t[4]=r=>e(p).visit(`/admin/proyectos/${n.proyecto.id}/hitos/${n.hito.id}/entregables/${r.id}`)),onEdit:t[5]||(t[5]=r=>e(p).visit(`/admin/proyectos/${n.proyecto.id}/hitos/${n.hito.id}/entregables/${r.id}/edit`)),onComplete:W,onMarkInProgress:Y,onDelete:X},null,8,["entregables","proyecto-id","hito-id","can-edit","can-delete","can-complete"])]),_:1})]),_:1}),u.value.last_page>1?(c(),F("div",Fe,[a("div",Se," Mostrando "+d(u.value.from)+" a "+d(u.value.to)+" de "+d(u.value.total)+" entregables ",1),a("div",De,[(c(!0),F(A,null,M(u.value.last_page,r=>(c(),b(e(k),{key:r,variant:"outline",size:"sm",disabled:r===u.value.current_page,onClick:T=>e(p).get(`/admin/proyectos/${n.proyecto.id}/hitos/${n.hito.id}/entregables?page=${r}`)},{default:s(()=>[m(d(r),1)]),_:2},1032,["disabled","onClick"]))),128))])])):j("",!0)])]),_:1},8,["breadcrumbs"]))}});export{Rt as default};
