import{d as N,B as oe,c as I,k as R,w as Z,j as E,o as m,e as w,y as z,b as h,u as e,z as O,s as se,v as ee,A as j,x as ne,C as J,a as A,i as F,f as x,m as re,t as M,h as Q,g as S,n as ie,F as ue,r as de}from"./app-Te3PPdHD.js";import{_ as W}from"./InputError.vue_vue_type_script_setup_true_lang-CMVmZ85N.js";import{P as K,a as U,_ as T}from"./AppLogo.vue_vue_type_script_setup_true_lang-W_DjSbgJ.js";import{_ as ce}from"./Input.vue_vue_type_script_setup_true_lang-COevQvbw.js";import{_ as Y}from"./Label.vue_vue_type_script_setup_true_lang-CddxUDHY.js";import{u as pe,c as fe,g as me,b as ve,a as te}from"./usePrimitiveElement-Wv9UFbsD.js";import{c as ge}from"./createContext-DitPrlKu.js";import{u as _e}from"./useForwardExpose-DjCGcjBS.js";import{V as he}from"./VisuallyHiddenInput-BuryYdd7.js";import{u as ye,r as H}from"./index-ibpswyNf.js";import{L,_ as be}from"./AuthLayout.vue_vue_type_script_setup_true_lang-s_9PkSNy.js";import{M as xe}from"./mail-BSI-T53A.js";import"./VisuallyHidden-CHPAlaQV.js";const we=["INPUT","TEXTAREA"];function Ve(n,r,a,l={}){if(!r||l.enableIgnoredElement&&we.includes(r.nodeName))return null;const{arrowKeyOptions:i="both",attributeName:o="[data-reka-collection-item]",itemsArray:c=[],loop:p=!0,dir:f="ltr",preventScroll:P=!0,focus:$=!1}=l,[V,y,q,k,B,g]=[n.key==="ArrowRight",n.key==="ArrowLeft",n.key==="ArrowUp",n.key==="ArrowDown",n.key==="Home",n.key==="End"],u=q||k,d=V||y;if(!B&&!g&&(!u&&!d||i==="vertical"&&d||i==="horizontal"&&u))return null;const _=c;if(!_.length)return null;P&&n.preventDefault();let b=null;return d||u?b=ae(_,r,{goForward:u?k:f==="ltr"?V:y,loop:p}):B?b=_.at(0)||null:g&&(b=_.at(-1)||null),$&&(b==null||b.focus()),b}function ae(n,r,a,l=n.length){if(--l===0)return null;const i=n.indexOf(r),o=a.goForward?i+1:i-1;if(!a.loop&&(o<0||o>=n.length))return null;const c=(o+n.length)%n.length,p=n[c];return p?p.hasAttribute("disabled")&&p.getAttribute("disabled")!=="false"?ae(n,p,a,l):p:null}const[ke,Ce]=ge("PinInputRoot");var Ie=N({inheritAttrs:!1,__name:"PinInputRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:Array,required:!1},placeholder:{type:String,required:!1,default:""},mask:{type:Boolean,required:!1},otp:{type:Boolean,required:!1},type:{type:null,required:!1,default:"text"},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},id:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:modelValue","complete"],setup(n,{emit:r}){const a=n,l=r,{mask:i,otp:o,placeholder:c,type:p,disabled:f,dir:P}=oe(a),{forwardRef:$}=_e(),V=pe(P),y=ye(a,"modelValue",l,{defaultValue:a.defaultValue??[],passive:a.modelValue===void 0}),q=I(()=>Array.isArray(y.value)?[...y.value]:[]),k=R(new Set);function B(d){k.value.add(d)}const g=I(()=>a.type==="number"),u=I(()=>q.value.filter(_=>!!_||g.value&&_===0).length===k.value.size);return Z(y,()=>{u.value&&l("complete",y.value)},{deep:!0}),Ce({modelValue:y,currentModelValue:q,mask:i,otp:o,placeholder:c,type:p,dir:V,disabled:f,isCompleted:u,inputElements:k,onInputElementChange:B,isNumericMode:g}),(d,_)=>(m(),E(e(K),O(d.$attrs,{ref:e($),dir:e(V),"data-complete":u.value?"":void 0,"data-disabled":e(f)?"":void 0}),{default:w(()=>[z(d.$slots,"default",{modelValue:e(y)}),h(he,{id:d.id,as:"input",feature:"focusable",tabindex:"-1",value:q.value.join(""),name:d.name??"",disabled:e(f),required:d.required,onFocus:_[0]||(_[0]=b=>{var t,s;return(s=(t=Array.from(k.value))==null?void 0:t[0])==null?void 0:s.focus()})},null,8,["id","value","name","disabled","required"])]),_:3},16,["dir","data-complete","data-disabled"]))}}),Pe=Ie,Ee=N({__name:"PinInputInput",props:{index:{type:Number,required:!0},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"input"}},setup(n){const r=n,a=ke(),l=I(()=>Array.from(a.inputElements.value)),i=I(()=>a.currentModelValue.value[r.index]),o=I(()=>r.disabled||a.disabled.value),c=I(()=>a.otp.value),p=I(()=>a.mask.value),{primitiveElement:f,currentElement:P}=fe();function $(t){var C;const s=t.target;if((((C=t.data)==null?void 0:C.length)??0)>1){d(s.value);return}if(a.isNumericMode.value&&!/^\d*$/.test(s.value)){s.value=s.value.replace(/\D/g,"");return}s.value=t.data??"",b(r.index,s.value);const v=l.value[r.index+1];v&&v.focus()}function V(){const t=P.value;ne(()=>{t&&!t.value&&(t.placeholder=a.placeholder.value)})}function y(t){Ve(t,me(),void 0,{itemsArray:l.value,focus:!0,loop:!1,arrowKeyOptions:"horizontal",dir:a.dir.value})}function q(t){if(t.preventDefault(),t.target.value)b(r.index,"");else{const C=l.value[r.index-1];C&&(C.focus(),b(r.index-1,""))}}function k(t){t.key==="Delete"&&(t.preventDefault(),b(r.index,""))}function B(t){const s=t.target;s.setSelectionRange(1,1),s.value||(s.placeholder="")}function g(t){V()}function u(t){t.preventDefault();const s=t.clipboardData;if(!s)return;const v=s.getData("text");d(v)}function d(t){var G;const s=[...a.currentModelValue.value],v=t.length>=l.value.length?0:r.index,C=Math.min(v+t.length,l.value.length);for(let D=v;D<C;D++){const le=l.value[D],X=t[D-v];a.isNumericMode.value&&!/^\d*$/.test(X)||(s[D]=X,le.focus())}a.modelValue.value=s,(G=l.value[C])==null||G.focus()}function _(t){let s=t.length-1;for(;s>=0&&t[s]==="";)t.pop(),s--;return t}function b(t,s){const v=[...a.currentModelValue.value];if(a.isNumericMode.value){const C=+s;s===""||isNaN(C)?delete v[t]:v[t]=C}else v[t]=s;a.modelValue.value=_(v)}return Z(i,()=>{i.value||V()}),se(()=>{a.onInputElementChange(P.value)}),ee(()=>{var t;(t=a.inputElements)==null||t.value.delete(P.value)}),(t,s)=>(m(),E(e(K),{ref_key:"primitiveElement",ref:f,autocapitalize:"none",as:t.as,"as-child":t.asChild,autocomplete:c.value?"one-time-code":"false",type:p.value?"password":"text",inputmode:e(a).isNumericMode.value?"numeric":"text",pattern:e(a).isNumericMode.value?"[0-9]*":void 0,placeholder:e(a).placeholder.value,value:i.value,disabled:o.value,"data-disabled":o.value?"":void 0,"data-complete":e(a).isCompleted.value?"":void 0,"aria-label":`pin input ${t.index+1} of ${l.value.length}`,onInput:s[0]||(s[0]=v=>$(v)),onKeydown:[j(y,["left","right","up","down","home","end"]),j(q,["backspace"]),j(k,["delete"])],onFocus:B,onBlur:g,onPaste:u},{default:w(()=>[z(t.$slots,"default")]),_:3},8,["as","as-child","autocomplete","type","inputmode","pattern","placeholder","value","disabled","data-disabled","data-complete","aria-label"]))}}),qe=Ee;const Be=N({__name:"PinInput",props:{modelValue:{default:()=>[]},defaultValue:{},placeholder:{},mask:{type:Boolean},otp:{type:Boolean},type:{},dir:{},disabled:{type:Boolean},id:{},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean},class:{}},emits:["update:modelValue","complete"],setup(n,{emit:r}){const a=n,l=r,i=H(a,"class"),o=ve(i,l);return(c,p)=>(m(),E(e(Pe),O({"data-slot":"pin-input"},e(o),{class:e(U)("flex items-center gap-2 has-disabled:opacity-50 disabled:cursor-not-allowed",a.class)}),{default:w(()=>[z(c.$slots,"default")]),_:3},16,["class"]))}}),Ae=N({__name:"PinInputGroup",props:{asChild:{type:Boolean},as:{},class:{}},setup(n){const r=n,a=H(r,"class"),l=te(a);return(i,o)=>(m(),E(e(K),O({"data-slot":"pin-input-group"},e(l),{class:e(U)("flex items-center",r.class)}),{default:w(()=>[z(i.$slots,"default")]),_:3},16,["class"]))}}),Me=N({__name:"PinInputSlot",props:{index:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(n){const r=n,a=H(r,"class"),l=te(a);return(i,o)=>(m(),E(e(qe),O({"data-slot":"pin-input-slot"},e(l),{class:e(U)("border-input focus:border-ring focus:ring-ring/50 focus:aria-invalid:ring-destructive/20 dark:bg-input/30 dark:focus:aria-invalid:ring-destructive/40 aria-invalid:border-destructive focus:aria-invalid:border-destructive relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none text-center first:rounded-l-md first:border-l last:rounded-r-md focus:z-10 focus:ring-[3px]",r.class)}),null,16,["class"]))}}),Se={key:0,class:"mb-4 text-center text-sm font-medium text-green-600"},$e={class:"grid gap-6"},Ne={class:"grid gap-2"},De={class:"relative"},Fe={class:"grid gap-6"},Re={class:"text-center"},Te={class:"text-sm text-muted-foreground"},ze={key:0},Oe={class:"font-medium"},je={key:1},Le={class:"font-medium"},Ke={class:"grid gap-2"},Ue={class:"flex justify-center"},He={class:"flex flex-col gap-3"},Ge={class:"flex flex-col gap-2 text-center"},Xe={class:"mt-6 text-center text-xs text-muted-foreground"},Je={key:0},Qe={key:1},dt=N({__name:"LoginOTP",props:{status:{},authConfig:{}},setup(n){const r=n,a=R("credential"),l=I(()=>r.authConfig||{login_type:"email",input_type:"email",placeholder:"correo@ejemplo.com",pattern:null,label:"Correo Electrónico"}),i=J({credential:""}),o=J({credential:"",otp_code:""}),c=R(!1),p=R(0),f=R(null),P=I(()=>p.value===0),$=I(()=>p.value>0?`Reenviar en ${p.value}s`:"Reenviar código"),V=(g=60)=>{p.value=g,f.value&&clearInterval(f.value),f.value=setInterval(()=>{p.value--,p.value<=0&&(clearInterval(f.value),f.value=null)},1e3)},y=()=>{c.value=!0,i.post(route("auth.request-otp"),{onSuccess:()=>{a.value="otp",o.credential=i.credential,o.clearErrors(),V(60)},onError:()=>{},onFinish:()=>{c.value=!1}})},q=()=>{const g=Array.isArray(o.otp_code)?o.otp_code.join(""):String(o.otp_code);o.otp_code=g,o.post(route("auth.verify-otp"),{onSuccess:u=>{},onError:()=>{o.otp_code=""}})},k=()=>{P.value&&(c.value=!0,o.post(route("auth.resend-otp"),{onSuccess:()=>{V(60)},onFinish:()=>{c.value=!1}}))},B=()=>{a.value="credential",o.reset(),f.value&&(clearInterval(f.value),f.value=null),p.value=0};return ee(()=>{f.value&&clearInterval(f.value)}),(g,u)=>(m(),E(be,{title:a.value==="credential"?"Iniciar Sesión":"Verificar Código",description:a.value==="credential"?`Ingresa tu ${l.value.label.toLowerCase()} para recibir el código de verificación`:"Ingresa el código de 6 dígitos enviado a tu correo"},{default:w(()=>[h(e(re),{title:"Iniciar Sesión"}),g.status?(m(),A("div",Se,M(g.status),1)):F("",!0),a.value==="credential"?(m(),A("form",{key:1,onSubmit:Q(y,["prevent"]),class:"flex flex-col gap-6"},[x("div",$e,[x("div",Ne,[h(e(Y),{for:"credential"},{default:w(()=>[S(M(l.value.label),1)]),_:1}),x("div",De,[l.value.login_type==="email"?(m(),E(e(xe),{key:0,class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})):F("",!0),h(e(ce),{id:"credential",type:l.value.input_type,required:"",autofocus:"",tabindex:"1",autocomplete:l.value.login_type==="email"?"email":"off",modelValue:e(i).credential,"onUpdate:modelValue":u[0]||(u[0]=d=>e(i).credential=d),placeholder:l.value.placeholder,pattern:l.value.pattern,class:ie({"pl-10":l.value.login_type==="email"})},null,8,["type","autocomplete","modelValue","placeholder","pattern","class"])]),h(W,{message:e(i).errors.credential},null,8,["message"])]),h(e(T),{type:"submit",class:"mt-4 w-full",tabindex:"2",disabled:e(i).processing||c.value},{default:w(()=>[e(i).processing||c.value?(m(),E(e(L),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):F("",!0),S(" "+M(e(i).processing||c.value?"Enviando...":"Enviar Código"),1)]),_:1},8,["disabled"])])],32)):(m(),A("form",{key:2,onSubmit:Q(q,["prevent"]),class:"flex flex-col gap-6"},[x("div",Fe,[x("div",Re,[x("p",Te,[l.value.login_type==="email"?(m(),A("span",ze,[u[2]||(u[2]=S(" Código enviado a: ")),x("span",Oe,M(e(o).credential),1)])):(m(),A("span",je,[u[3]||(u[3]=S(" Código enviado al email asociado al documento: ")),x("span",Le,M(e(o).credential),1)]))])]),x("div",Ke,[h(e(Y),{class:"text-center"},{default:w(()=>u[4]||(u[4]=[S("Código de Verificación")])),_:1}),x("div",Ue,[h(e(Be),{modelValue:e(o).otp_code,"onUpdate:modelValue":u[1]||(u[1]=d=>e(o).otp_code=d),length:6,type:"text",placeholder:"0",class:"gap-2"},{default:w(()=>[h(e(Ae),null,{default:w(()=>[(m(),A(ue,null,de(6,(d,_)=>h(e(Me),{key:d,index:_,class:"h-12 w-12 text-lg font-medium"},null,8,["index"])),64))]),_:1})]),_:1},8,["modelValue"])]),h(W,{message:e(o).errors.otp_code},null,8,["message"])]),x("div",He,[h(e(T),{type:"submit",class:"w-full",disabled:e(o).processing||e(o).otp_code.length!==6},{default:w(()=>[e(o).processing?(m(),E(e(L),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):F("",!0),S(" "+M(e(o).processing?"Verificando...":"Verificar Código"),1)]),_:1},8,["disabled"]),x("div",Ge,[h(e(T),{type:"button",variant:"ghost",size:"sm",onClick:k,disabled:!P.value||c.value},{default:w(()=>[c.value?(m(),E(e(L),{key:0,class:"mr-2 h-3 w-3 animate-spin"})):F("",!0),S(" "+M(c.value?"Enviando...":$.value),1)]),_:1},8,["disabled"]),h(e(T),{type:"button",variant:"ghost",size:"sm",onClick:B},{default:w(()=>[S(M(l.value.login_type==="email"?"Cambiar correo electrónico":"Cambiar documento"),1)]),_:1})])])])],32)),x("div",Xe,[a.value==="credential"?(m(),A("p",Je," Solo usuarios autorizados pueden acceder al sistema de votaciones. ")):(m(),A("p",Qe," El código expira en 10 minutos. Si no lo recibes, verifica tu bandeja de spam. "))])]),_:1},8,["title","description"]))}});export{dt as default};
