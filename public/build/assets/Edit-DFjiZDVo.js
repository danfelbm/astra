import{d as Z,C as K,c as y,w as ee,j as h,o as d,e as a,b as i,f as o,u as e,m as se,i as P,g as n,P as O,h as ie,t as m,a as f,F as k,r as $,W as ae}from"./app-Bqj6cabU.js";import{T as te,_ as le}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dpu4Wpcj.js";import{_ as v}from"./createLucideIcon-C8o-8vKY.js";import{_ as V,a as D,b as w,c as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-CE7ACGrx.js";import{_ as j}from"./CardDescription.vue_vue_type_script_setup_true_lang-D4-66thX.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-BgUqW2xn.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-CrvKdd-Q.js";import{_ as oe}from"./Textarea.vue_vue_type_script_setup_true_lang-MKDg5lmq.js";import{_ as U}from"./Checkbox.vue_vue_type_script_setup_true_lang-rVbSBCWG.js";import{_ as G}from"./index-B1hFReqZ.js";import{_ as re,a as ne,b as A,c as E}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-B06zph4k.js";import{_ as de}from"./ScrollArea.vue_vue_type_script_setup_true_lang-KE-abxg0.js";import{_ as me,a as ue}from"./index-CjSw6k4b.js";import{_ as pe}from"./Switch.vue_vue_type_script_setup_true_lang-CUcgEOWv.js";import{_ as ce,a as fe,b as _e,c as ge,d as ve}from"./SelectValue.vue_vue_type_script_setup_true_lang-Bqrud0Vz.js";import{_ as g}from"./InputError.vue_vue_type_script_setup_true_lang-BGy8FS3b.js";import{A as be}from"./arrow-left-DEsi1gZY.js";import{C as xe}from"./circle-alert-C1YWw91b.js";import{S as ye}from"./shield-B6qXhAif.js";import{L as he}from"./lock-PK0xRHzp.js";import{H as ke}from"./house-CD20V8kq.js";import{S as $e}from"./save-CvFoKHL0.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-1zoq1_ge.js";import"./index-BKc_ekQU.js";import"./floating-ui.vue-JANudi2O.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CFEiplAu.js";import"./VisuallyHidden-DgAOoJOt.js";import"./index-_CXItz_H.js";import"./user-DxJeGoXE.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-abXnMk-o.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CtdU0Fle.js";import"./index-CLO0EMv4.js";import"./map-pin-C8oba01p.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Z9DdC44R.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-TgHQxhTl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-C3NlMLpT.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-W66iioUR.js";import"./users-BPHT5OHo.js";import"./vote-BfMb807g.js";import"./file-text-DXUAiP0m.js";import"./calendar-BUIf-xWA.js";import"./briefcase-DiZT2dcr.js";import"./megaphone-CYLoROL6.js";import"./user-check-BxFSLWxT.js";import"./external-link-Cu0H_uKm.js";import"./panel-left-D7zZdbo5.js";import"./check-JsU3fe4g.js";import"./index-CwsEjmb9.js";import"./RovingFocusItem-BtRrMv86.js";import"./utils-sCil7wCw.js";import"./VisuallyHiddenInput-BqQIydg1.js";const Se={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Pe={class:"flex items-center justify-between"},Ve={class:"flex gap-2"},De={class:"space-y-2"},we={class:"space-y-2"},Ce={class:"space-y-2"},je={class:"space-y-2"},Ue={class:"flex items-center justify-between"},Ae={class:"space-y-0.5"},Ee={class:"text-xs text-muted-foreground"},Re={class:"space-y-2"},Le={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},Oe={class:"flex gap-2 mt-4"},Fe={class:"space-y-6"},Ge={class:"flex items-center space-x-2 pb-2 border-b"},Ne={class:"grid grid-cols-2 gap-3 pl-6"},Te={key:0,class:"space-y-3"},ze={class:"flex-1"},Be={class:"text-xs text-muted-foreground mt-1"},Me={key:1,class:"text-center py-8 text-muted-foreground"},qe={class:"flex justify-end gap-4"},qs=Z({__name:"Edit",props:{role:{},segments:{},availablePermissions:{},selectedSegments:{}},setup(N){const u=N,T=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Editar Rol",href:"#"}],t=K({name:u.role.name,display_name:u.role.display_name,description:u.role.description||"",is_administrative:!!u.role.is_administrative,redirect_after_login:u.role.redirect_after_login||"default",permissions:u.role.permissions||[],segment_ids:u.selectedSegments||[]}),R=[{value:"default",label:"Por defecto (según tipo de rol)"},{value:"admin.dashboard",label:"Dashboard Administrativo",group:"admin"},{value:"admin.candidaturas.dashboard",label:"Dashboard Candidaturas",group:"admin"},{value:"dashboard",label:"Dashboard Usuario",group:"user"},{value:"votaciones.index",label:"Votaciones",group:"user"},{value:"asambleas.index",label:"Asambleas",group:"user"},{value:"formularios.index",label:"Formularios",group:"user"},{value:"postulaciones.index",label:"Postulaciones",group:"user"},{value:"admin.otp-dashboard",label:"Dashboard OTP",group:"admin"},{value:"admin.configuracion.index",label:"Configuración",group:"admin"},{value:"admin.users.index",label:"Usuarios",group:"admin"},{value:"admin.roles.index",label:"Roles y Permisos",group:"admin"},{value:"admin.candidaturas.index",label:"Candidaturas (Lista)",group:"admin"}],z=y(()=>t.is_administrative?R:R.filter(r=>r.group!=="admin"||r.value==="default")),b=y(()=>["super_admin","admin","manager","user","end_customer"].includes(u.role.name)),x=y(()=>t.is_administrative?u.availablePermissions.administrative:u.availablePermissions.frontend),L=r=>{const s=x.value[r];return s?Object.keys(s.permissions).every(p=>t.permissions.includes(p)):!1},B=r=>{const s=x.value[r];if(!s)return!1;const l=Object.keys(s.permissions),p=l.filter(c=>t.permissions.includes(c)).length;return p>0&&p<l.length},M=r=>{const s=t.permissions.indexOf(r);s>-1?t.permissions.splice(s,1):t.permissions.push(r)},q=r=>{const s=x.value[r];if(!s)return;const l=Object.keys(s.permissions);L(r)?t.permissions=t.permissions.filter(c=>!l.includes(c)):l.forEach(c=>{t.permissions.includes(c)||t.permissions.push(c)})},H=r=>{const s=t.segment_ids.indexOf(r);s>-1?t.segment_ids.splice(s,1):t.segment_ids.push(r)},I=()=>{t.put(`/admin/roles/${u.role.id}`,{preserveScroll:!0,onSuccess:()=>{}})},W=()=>{confirm(`¿Estás seguro de eliminar el rol "${u.role.display_name}"? Esta acción no se puede deshacer.`)&&ae.delete(`/admin/roles/${u.role.id}`)},J=()=>{const r=[];Object.values(x.value).forEach(s=>{Object.keys(s.permissions).forEach(l=>{r.push(l)})}),t.permissions=r},Q=()=>{t.permissions=[]};ee(()=>t.is_administrative,(r,s)=>{s!==void 0&&r!==s&&(t.permissions=[])});const X=y(()=>t.permissions.length),Y=y(()=>!b.value);return(r,s)=>(d(),h(le,{breadcrumbs:T},{default:a(()=>[i(e(se),{title:"Editar Rol"}),o("div",Se,[o("div",Pe,[s[7]||(s[7]=o("div",null,[o("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Rol"),o("p",{class:"text-muted-foreground"}," Modifica los permisos y configuración del rol ")],-1)),o("div",Ve,[Y.value?(d(),h(e(v),{key:0,onClick:W,variant:"destructive",type:"button"},{default:a(()=>s[5]||(s[5]=[n(" Eliminar Rol ")])),_:1})):P("",!0),i(e(O),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(v),{variant:"outline"},{default:a(()=>[i(e(be),{class:"mr-2 h-4 w-4"}),s[6]||(s[6]=n(" Volver "))]),_:1})]),_:1},8,["href"])])]),b.value?(d(),h(e(me),{key:0},{default:a(()=>[i(e(xe),{class:"h-4 w-4"}),i(e(ue),null,{default:a(()=>s[8]||(s[8]=[n(" Este es un rol del sistema. Algunas configuraciones pueden estar restringidas. ")])),_:1})]),_:1})):P("",!0),o("form",{onSubmit:ie(I,["prevent"]),class:"space-y-6"},[i(e(re),{defaultValue:"general",class:"space-y-4"},{default:a(()=>[i(e(ne),{class:"grid w-full grid-cols-3"},{default:a(()=>[i(e(A),{value:"general"},{default:a(()=>[i(e(ye),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=n(" General "))]),_:1}),i(e(A),{value:"permissions"},{default:a(()=>[i(e(he),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=n(" Permisos "))]),_:1}),i(e(A),{value:"segments"},{default:a(()=>[i(e(te),{class:"mr-2 h-4 w-4"}),s[11]||(s[11]=n(" Segmentos "))]),_:1})]),_:1}),i(e(E),{value:"general"},{default:a(()=>[i(e(V),null,{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(w),null,{default:a(()=>s[12]||(s[12]=[n("Información General")])),_:1}),i(e(j),null,{default:a(()=>s[13]||(s[13]=[n(" Define el nombre y descripción del rol ")])),_:1})]),_:1}),i(e(C),{class:"space-y-4"},{default:a(()=>[o("div",De,[i(e(_),{htmlFor:"name"},{default:a(()=>s[14]||(s[14]=[n("Nombre del Rol (interno)")])),_:1}),i(e(F),{id:"name",modelValue:e(t).name,"onUpdate:modelValue":s[0]||(s[0]=l=>e(t).name=l),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos",disabled:b.value},null,8,["modelValue","disabled"]),s[15]||(s[15]=o("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),i(g,{message:e(t).errors.name},null,8,["message"])]),o("div",we,[i(e(_),{htmlFor:"display_name"},{default:a(()=>s[16]||(s[16]=[n("Nombre a Mostrar")])),_:1}),i(e(F),{id:"display_name",modelValue:e(t).display_name,"onUpdate:modelValue":s[1]||(s[1]=l=>e(t).display_name=l),placeholder:"Administrador Regional"},null,8,["modelValue"]),i(g,{message:e(t).errors.display_name},null,8,["message"])]),o("div",Ce,[i(e(_),{htmlFor:"description"},{default:a(()=>s[17]||(s[17]=[n("Descripción")])),_:1}),i(e(oe),{id:"description",modelValue:e(t).description,"onUpdate:modelValue":s[2]||(s[2]=l=>e(t).description=l),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),i(g,{message:e(t).errors.description},null,8,["message"])]),o("div",je,[o("div",Ue,[o("div",Ae,[i(e(_),{htmlFor:"is_administrative"},{default:a(()=>s[18]||(s[18]=[n("Rol Administrativo")])),_:1}),s[19]||(s[19]=o("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),i(e(pe),{id:"is_administrative",modelValue:e(t).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=l=>e(t).is_administrative=l),disabled:b.value},null,8,["modelValue","disabled"])]),i(g,{message:e(t).errors.is_administrative},null,8,["message"]),o("div",Ee," Debug: is_administrative = "+m(e(t).is_administrative)+" ("+m(typeof e(t).is_administrative)+") ",1)]),o("div",Re,[i(e(_),{htmlFor:"redirect_after_login"},{default:a(()=>[i(e(ke),{class:"inline-block h-4 w-4 mr-1"}),s[20]||(s[20]=n(" Página de Inicio Después del Login "))]),_:1}),i(e(ce),{modelValue:e(t).redirect_after_login,"onUpdate:modelValue":s[4]||(s[4]=l=>e(t).redirect_after_login=l),disabled:b.value},{default:a(()=>[i(e(fe),{id:"redirect_after_login"},{default:a(()=>[i(e(_e),{placeholder:"Seleccione la página de destino"})]),_:1}),i(e(ge),null,{default:a(()=>[(d(!0),f(k,null,$(z.value,l=>(d(),h(e(ve),{key:l.value,value:l.value},{default:a(()=>[n(m(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),s[21]||(s[21]=o("p",{class:"text-xs text-muted-foreground"}," Define a qué página se redirigirá al usuario después de autenticarse. Si no se especifica, usará el comportamiento por defecto. ",-1)),i(g,{message:e(t).errors.redirect_after_login},null,8,["message"])]),o("div",Le,[o("p",null,"ID del Rol: "+m(r.role.id),1),o("p",null,"Creado: "+m(new Date(r.role.created_at).toLocaleDateString()),1),o("p",null,"Última actualización: "+m(new Date(r.role.updated_at).toLocaleDateString()),1)])]),_:1})]),_:1})]),_:1}),i(e(E),{value:"permissions"},{default:a(()=>[i(e(V),null,{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(w),null,{default:a(()=>s[22]||(s[22]=[n("Matriz de Permisos")])),_:1}),i(e(j),null,{default:a(()=>[n(m(e(t).is_administrative?"Selecciona los permisos administrativos para este rol":"Selecciona los permisos de usuario para este rol"),1)]),_:1}),o("div",Oe,[i(e(v),{type:"button",size:"sm",variant:"outline",onClick:J},{default:a(()=>s[23]||(s[23]=[n(" Seleccionar Todos ")])),_:1}),i(e(v),{type:"button",size:"sm",variant:"outline",onClick:Q},{default:a(()=>s[24]||(s[24]=[n(" Limpiar Todos ")])),_:1}),i(e(G),{variant:"secondary",class:"ml-auto"},{default:a(()=>[n(m(X.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),i(e(C),null,{default:a(()=>[i(e(de),{class:"h-[500px] pr-4"},{default:a(()=>[o("div",Fe,[(d(!0),f(k,null,$(x.value,(l,p)=>(d(),f("div",{key:p,class:"space-y-3"},[o("div",Ge,[i(e(U),{checked:L(p),indeterminate:B(p),"onUpdate:checked":c=>q(p)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(_),{class:"text-sm font-semibold"},{default:a(()=>[n(m(l.label),1)]),_:2},1024)]),o("div",Ne,[(d(!0),f(k,null,$(l.permissions,(c,S)=>(d(),f("div",{key:S,class:"flex items-center space-x-2"},[i(e(U),{checked:e(t).permissions.includes(S),"onUpdate:checked":He=>M(S)},null,8,["checked","onUpdate:checked"]),i(e(_),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[n(m(c),1)]),_:2},1024)]))),128))])]))),128))])]),_:1}),i(g,{message:e(t).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),i(e(E),{value:"segments"},{default:a(()=>[i(e(V),null,{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(w),null,{default:a(()=>s[25]||(s[25]=[n("Segmentos de Datos")])),_:1}),i(e(j),null,{default:a(()=>s[26]||(s[26]=[n(" Asocia segmentos para limitar el alcance de datos visibles ")])),_:1})]),_:1}),i(e(C),null,{default:a(()=>[r.segments.length>0?(d(),f("div",Te,[(d(!0),f(k,null,$(r.segments,l=>(d(),f("div",{key:l.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[i(e(U),{checked:e(t).segment_ids.includes(l.id),"onUpdate:checked":p=>H(l.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),o("div",ze,[i(e(_),{class:"text-sm font-medium cursor-pointer"},{default:a(()=>[n(m(l.name),1)]),_:2},1024),o("p",Be,m(l.description||"Sin descripción"),1),l.user_count?(d(),h(e(G),{key:0,variant:"outline",class:"mt-2"},{default:a(()=>[n(m(l.user_count)+" usuarios ",1)]),_:2},1024)):P("",!0)])]))),128))])):(d(),f("div",Me," No hay segmentos disponibles ")),i(g,{message:e(t).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),o("div",qe,[i(e(O),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(v),{type:"button",variant:"outline"},{default:a(()=>s[27]||(s[27]=[n(" Cancelar ")])),_:1})]),_:1},8,["href"]),i(e(v),{type:"submit",disabled:e(t).processing},{default:a(()=>[i(e($e),{class:"mr-2 h-4 w-4"}),n(" "+m(e(t).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{qs as default};
