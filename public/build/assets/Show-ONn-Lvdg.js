import{d as K,r as $,p as Q,s as H,c as j,i as h,e as a,f as e,q as W,w as l,g as n,t as c,b as g,j as p,v as I,h as u,m,F as O,k as X}from"./app-qOPHKlU8.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BXJoEEnx.js";import{c as Z,_ as T}from"./createLucideIcon-BWo8psn6.js";import{_ as V,a as A,b as D,c as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-BTxXkXND.js";import{_ as tt}from"./CardDescription.vue_vue_type_script_setup_true_lang-CVdsOpXT.js";import{_ as C}from"./index-Ci6BdDi-.js";import{_ as B}from"./Label.vue_vue_type_script_setup_true_lang-CGcEA0js.js";import{_ as et,a as at,b as _,c as x}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Yx-YbTYg.js";import{A as it,_ as ot,a as lt,b as st,c as nt}from"./ActivityLog.vue_vue_type_script_setup_true_lang-DSADLNup.js";import{O as rt}from"./ObligacionTree-DrEZoHud.js";import{u as dt}from"./usePermissions-CmhbPwd8.js";import{A as ct}from"./arrow-left-CSwuCYEv.js";import{P as ut}from"./pencil-qQ679UZv.js";import{I as mt}from"./info-91euE2Cb.js";import{I as ft}from"./image-CXbVFgQl.js";import{P as vt}from"./paperclip-Cf8iC-zJ.js";import{f as F,e as L}from"./es-SykclP7y.js";import{p as N}from"./parseISO-D9CBQlQ_.js";import"./useFlashMessages-B8XEsggg.js";import"./index-DbRkB4yL.js";import"./floating-ui.vue-DI3iRE2X.js";import"./x-BzW6WZnU.js";import"./Input.vue_vue_type_script_setup_true_lang-BPKIkcAz.js";import"./index-DgbQ7tEQ.js";import"./index-lyAb6PTT.js";import"./shield-QnzmP7kW.js";import"./user-CItJBnh3.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CqVS9jES.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-C9wVVdzY.js";import"./VisuallyHidden-67GKucQt.js";import"./check-CaJbCGlz.js";import"./chevron-right-BY06Tniz.js";import"./house-XihPr5GD.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-C5iCtxBM.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CEdWjIzE.js";import"./index-Bp2Wlz9S.js";import"./circle-alert-cqc9KHz5.js";import"./map-pin-C_T4_lty.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-BWT5d4Br.js";import"./chevrons-up-down-D9bYAOoS.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-L5UJa9de.js";import"./target-Foqs84xh.js";import"./users-BfzI9gF_.js";import"./vote-FH_kN1jR.js";import"./folder-open-CP38sIru.js";import"./send-BmU-jRMn.js";import"./file-text-DM4vF-b0.js";import"./briefcase-Co-IBDir.js";import"./calendar-9aloSFVd.js";import"./megaphone-DTjoLJ2P.js";import"./user-check-CoV0VVR_.js";import"./clipboard-list-D9U4n72V.js";import"./mail-BfUT6rT4.js";import"./message-square-CfBUaoOK.js";import"./external-link-C-2iu5nh.js";import"./panel-left-CzjomTeO.js";import"./index-BVeWtLm1.js";import"./RovingFocusItem-DGX8dLTQ.js";import"./utils-1pq4A4um.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-DjLQ6Ofn.js";import"./useArrowNavigation-B5rxJs06.js";import"./eye-CMHXOxJn.js";import"./download-hw4B5Tzv.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DhKzfp42.js";import"./filter-Bm1-uSOK.js";import"./arrow-right-DrbKBG_i.js";import"./Separator.vue_vue_type_script_setup_true_lang-CSCvzkjb.js";import"./circle-BR2wFMHx.js";import"./layers-BBCCXNFe.js";import"./plus-Cs908sEW.js";import"./trash-2-C4M-XSG1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./loader-circle-B4H9kPTr.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Z("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),gt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},bt={class:"flex items-center justify-between"},ht={class:"text-3xl font-bold"},yt={class:"text-muted-foreground mt-2"},_t={class:"flex gap-2"},xt={class:"mt-1"},wt={class:"pt-4 border-t"},kt={class:"font-medium mt-1"},$t={class:"text-sm text-gray-600 mt-1"},jt={class:"pt-4 border-t space-y-3"},It={class:"mt-1"},Vt={class:"text-xs text-gray-500"},At={key:0},Dt={class:"mt-1"},Mt={class:"text-xs text-gray-500"},Ct={key:1},Et={class:"mt-1"},Pt={class:"text-xs text-gray-500"},St={class:"space-y-2"},Ht=["href"],aa=K({__name:"Show",props:{obligacion:{},contrato:{},canEdit:{type:Boolean},canDelete:{type:Boolean},canCreateChild:{type:Boolean},actividades:{},usuariosActividades:{}},setup(i){const y=i,{hasPermission:U}=dt(),z=["general","hijos","evidencias","actividad"],w=$((()=>{const t=new URLSearchParams(window.location.search).get("tab");return t&&z.includes(t)?t:"general"})());Q(w,o=>{const t=`/admin/obligaciones/${y.obligacion.id}?tab=${o}`;H.get(t,{},{preserveState:!0,preserveScroll:!0,replace:!0,only:[]})});const d=$({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null,entregable_id:null}),f=$({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),q=[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"},{title:y.obligacion.titulo}],b=j(()=>y.obligacion.evidencias||[]),G=j(()=>{let o=b.value;return d.value.tipo&&(o=o.filter(t=>t.tipo_evidencia===d.value.tipo)),d.value.estado&&(o=o.filter(t=>t.estado===d.value.estado)),d.value.usuario_id&&(o=o.filter(t=>{var r;return((r=t.usuario)==null?void 0:r.id)===d.value.usuario_id})),d.value.entregable_id&&(o=o.filter(t=>{var r;return(r=t.entregables)==null?void 0:r.some(s=>s.id===d.value.entregable_id)})),(d.value.fecha_inicio||d.value.fecha_fin)&&(o=o.filter(t=>{const r=new Date(t.created_at);if(d.value.fecha_inicio){const s=new Date(d.value.fecha_inicio);if(r<s)return!1}if(d.value.fecha_fin){const s=new Date(d.value.fecha_fin);if(s.setHours(23,59,59,999),r>s)return!1}return!0})),o}),R=j(()=>{let o=y.actividades||[];return f.value.usuario_id&&(o=o.filter(t=>{var r;return((r=t.causer)==null?void 0:r.id)===f.value.usuario_id})),f.value.tipo_accion&&(o=o.filter(t=>t.event===f.value.tipo_accion)),(f.value.fecha_inicio||f.value.fecha_fin)&&(o=o.filter(t=>{const r=new Date(t.created_at);if(f.value.fecha_inicio){const s=new Date(f.value.fecha_inicio);if(r<s)return!1}if(f.value.fecha_fin){const s=new Date(f.value.fecha_fin);if(s.setHours(23,59,59,999),r>s)return!1}return!0})),o}),k=o=>{if(!o)return"Sin fecha";try{return F(N(o),"dd MMM yyyy HH:mm",{locale:L})}catch{return o}},J=o=>{if(!o)return"-";try{return F(N(o),"d 'de' MMMM 'de' yyyy",{locale:L})}catch{return o}};return(o,t)=>(m(),h(O,null,[a(e(W),{title:`Obligación - ${i.obligacion.titulo}`},null,8,["title"]),a(Y,{breadcrumbs:q},{default:l(()=>[n("div",gt,[n("div",bt,[n("div",null,[n("h1",ht,c(i.obligacion.titulo),1),n("p",yt," Contrato: "+c(i.contrato.nombre),1)]),n("div",_t,[a(e(I),{href:`/admin/contratos/${i.contrato.id}`},{default:l(()=>[a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(ct),{class:"h-4 w-4 mr-2"}),t[4]||(t[4]=u(" Ver Contrato ",-1))]),_:1})]),_:1},8,["href"]),i.canEdit?(m(),g(e(I),{key:0,href:o.route("admin.obligaciones.edit",i.obligacion.id)},{default:l(()=>[a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(ut),{class:"h-4 w-4 mr-2"}),t[5]||(t[5]=u(" Editar ",-1))]),_:1})]),_:1},8,["href"])):p("",!0)])]),a(e(et),{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=r=>w.value=r),class:"flex-1"},{default:l(()=>{var r;return[a(e(at),null,{default:l(()=>{var s;return[a(e(_),{value:"general"},{default:l(()=>[a(e(mt),{class:"h-4 w-4 mr-2"}),t[6]||(t[6]=u(" General ",-1))]),_:1}),(s=i.obligacion.hijos)!=null&&s.length?(m(),g(e(_),{key:0,value:"hijos"},{default:l(()=>{var v;return[a(e(pt),{class:"h-4 w-4 mr-2"}),t[7]||(t[7]=u(" Obligaciones Hijas ",-1)),(v=i.obligacion.hijos)!=null&&v.length?(m(),g(e(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[u(c(i.obligacion.hijos.length),1)]),_:1})):p("",!0)]}),_:1})):p("",!0),a(e(_),{value:"evidencias"},{default:l(()=>[a(e(ft),{class:"h-4 w-4 mr-2"}),t[8]||(t[8]=u(" Evidencias ",-1)),b.value.length>0?(m(),g(e(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[u(c(b.value.length),1)]),_:1})):p("",!0)]),_:1}),a(e(_),{value:"actividad"},{default:l(()=>[a(e(it),{class:"h-4 w-4 mr-2"}),t[9]||(t[9]=u(" Actividad ",-1)),i.actividades&&i.actividades.length>0?(m(),g(e(C),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[u(c(i.actividades.length),1)]),_:1})):p("",!0)]),_:1})]}),_:1}),a(e(x),{value:"general",class:"space-y-4 mt-6"},{default:l(()=>{var s;return[a(e(V),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[10]||(t[10]=[u("Información General",-1)])]),_:1})]),_:1}),a(e(M),{class:"space-y-4"},{default:l(()=>{var v,E,P,S;return[n("div",null,[a(e(B),null,{default:l(()=>[...t[11]||(t[11]=[u("Descripción",-1)])]),_:1}),n("p",xt,c(i.obligacion.descripcion||"Sin descripción"),1)]),n("div",wt,[a(e(B),null,{default:l(()=>[...t[12]||(t[12]=[u("Contrato",-1)])]),_:1}),a(e(I),{href:o.route("admin.contratos.show",i.contrato.id),class:"hover:underline"},{default:l(()=>[n("h3",kt,c(i.contrato.nombre),1)]),_:1},8,["href"]),n("p",$t,c((v=i.contrato.proyecto)==null?void 0:v.nombre),1)]),n("div",jt,[n("div",null,[t[13]||(t[13]=n("span",{class:"text-sm text-gray-600"},"Creado por:",-1)),n("p",It,c(((E=i.obligacion.creador)==null?void 0:E.name)||"Sistema"),1),n("p",Vt,c(k(i.obligacion.created_at)),1)]),i.obligacion.updated_at?(m(),h("div",At,[t[14]||(t[14]=n("span",{class:"text-sm text-gray-600"},"Última actualización:",-1)),n("p",Dt,c(((P=i.obligacion.actualizador)==null?void 0:P.name)||"Sistema"),1),n("p",Mt,c(k(i.obligacion.updated_at)),1)])):p("",!0),i.obligacion.cumplido_at?(m(),h("div",Ct,[t[15]||(t[15]=n("span",{class:"text-sm text-gray-600"},"Cumplido por:",-1)),n("p",Et,c(((S=i.obligacion.cumplido_por_usuario)==null?void 0:S.name)||"Sistema"),1),n("p",Pt,c(k(i.obligacion.cumplido_at)),1)])):p("",!0)])]}),_:1})]),_:1}),(s=i.obligacion.archivos_adjuntos)!=null&&s.length?(m(),g(e(V),{key:0},{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[16]||(t[16]=[u("Archivos Adjuntos",-1)])]),_:1})]),_:1}),a(e(M),null,{default:l(()=>[n("div",St,[(m(!0),h(O,null,X(i.obligacion.archivos_adjuntos,v=>(m(),h("div",{key:v.ruta,class:"flex items-center gap-2"},[a(e(vt),{class:"h-4 w-4"}),n("a",{href:`/storage/${v.ruta}`,target:"_blank",class:"hover:underline text-sm"},c(v.nombre_original),9,Ht)]))),128))])]),_:1})]),_:1})):p("",!0)]}),_:1}),(r=i.obligacion.hijos)!=null&&r.length?(m(),g(e(x),{key:0,value:"hijos",class:"space-y-4 mt-6"},{default:l(()=>[a(e(V),null,{default:l(()=>[a(e(A),null,{default:l(()=>[a(e(D),null,{default:l(()=>[...t[17]||(t[17]=[u("Obligaciones Hijas",-1)])]),_:1}),a(e(tt),null,{default:l(()=>[...t[18]||(t[18]=[u(" Sub-obligaciones derivadas de esta obligación principal ",-1)])]),_:1})]),_:1}),a(e(M),null,{default:l(()=>[a(rt,{obligaciones:i.obligacion.hijos,contratoId:i.obligacion.contrato_id,editable:e(U)("obligaciones.edit"),onEdit:t[0]||(t[0]=s=>e(H).visit(o.route("admin.obligaciones.edit",s.id)))},null,8,["obligaciones","contratoId","editable"])]),_:1})]),_:1})]),_:1})):p("",!0),a(e(x),{value:"evidencias",class:"space-y-4 mt-6"},{default:l(()=>{var s;return[b.value.length>0?(m(),g(ot,{key:0,modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=v=>d.value=v),contratos:[i.contrato],evidencias:b.value},null,8,["modelValue","contratos","evidencias"])):p("",!0),a(lt,{mode:"simple",modo:"admin",evidencias:G.value,contrato:i.contrato,"proyecto-id":(s=i.contrato.proyecto)==null?void 0:s.id,"puede-gestionar-estado":!0,"format-date":J,"card-title":"Evidencias Asociadas","card-description":"Evidencias cargadas para esta obligación"},null,8,["evidencias","contrato","proyecto-id"])]}),_:1}),a(e(x),{value:"actividad",class:"space-y-4 mt-6"},{default:l(()=>[i.actividades&&i.actividades.length>0?(m(),g(st,{key:0,modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=s=>f.value=s),usuarios:i.usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):p("",!0),a(nt,{activities:R.value,title:"Historial de Actividad",description:"Registro de cambios y actividades relacionadas con esta obligación","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]}),_:1},8,["modelValue"])])]),_:1})],64))}});export{aa as default};
