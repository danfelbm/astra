import{d as le,r as y,c as ne,i as x,e as s,f as a,q as re,w as n,g as t,h as d,t as m,m as f,F as O,l as J,A as de,j as N,b as T,n as ue,k as Q,a as me}from"./app-qOPHKlU8.js";import{_ as ce}from"./GuestLayout.vue_vue_type_script_setup_true_lang-DnDGoyAv.js";import{_ as fe}from"./GeographicSelector.vue_vue_type_script_setup_true_lang-CEdWjIzE.js";import{_ as pe,a as ve,b as ge,c as xe}from"./CardTitle.vue_vue_type_script_setup_true_lang-BTxXkXND.js";import{_ as be}from"./CardDescription.vue_vue_type_script_setup_true_lang-CVdsOpXT.js";import{_ as k}from"./createLucideIcon-BWo8psn6.js";import{_ as H}from"./Input.vue_vue_type_script_setup_true_lang-BPKIkcAz.js";import{_ as F}from"./Label.vue_vue_type_script_setup_true_lang-CGcEA0js.js";import{_ as V,a as M}from"./index-BaeeJCWs.js";import{_ as _e}from"./SPhoneInput.vue_vue_type_script_setup_true_lang-CC5l4S6s.js";import{_ as ye}from"./Progress.vue_vue_type_script_setup_true_lang-BDobS0H2.js";import{t as S}from"./index-Bp2Wlz9S.js";import{C as A}from"./circle-check-big-BBU1skko.js";import{M as he}from"./map-pin-C_T4_lty.js";import{U as we}from"./upload-CO2R7jy3.js";import{F as ke}from"./file-text-DM4vF-b0.js";import{X as Ce}from"./x-BzW6WZnU.js";import{C as Y}from"./circle-alert-cqc9KHz5.js";import{L as $e}from"./loader-circle-B4H9kPTr.js";import"./index-BVeWtLm1.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-L5UJa9de.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-C9wVVdzY.js";import"./VisuallyHidden-67GKucQt.js";import"./index-DgbQ7tEQ.js";import"./check-CaJbCGlz.js";import"./floating-ui.vue-DI3iRE2X.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DhKzfp42.js";import"./index-wswZDd4p.js";import"./search-CHr_4xx3.js";import"./useKbd-kRIii9yh.js";import"./utils-1pq4A4um.js";import"./VisuallyHiddenInput-BoAuYAGg.js";import"./chevrons-up-down-D9bYAOoS.js";const je={class:"max-w-2xl mx-auto"},Se={key:0,class:"space-y-6"},ze={class:"bg-muted p-4 rounded-lg"},De={class:"space-y-3"},Ne={class:"flex items-start gap-3"},Te={class:"rounded-full bg-primary/10 p-1 mt-0.5"},Fe={class:"flex items-start gap-3"},Ve={class:"rounded-full bg-primary/10 p-1 mt-0.5"},Me={class:"flex items-start gap-3"},Ae={class:"rounded-full bg-primary/10 p-1 mt-0.5"},Ue={class:"flex flex-col sm:flex-row gap-3"},Be={key:1,class:"space-y-6"},Ee={class:"bg-muted p-4 rounded-lg"},Pe={class:"space-y-2"},Le={class:"flex justify-between items-center"},Oe={class:"font-medium"},Ge={class:"flex justify-between items-center"},Ke={class:"font-medium"},Re={class:"flex justify-between items-center"},Ie={class:"font-medium"},We={class:"flex justify-between items-center"},Xe={class:"font-medium"},qe={class:"flex flex-col sm:flex-row gap-3"},Je={class:"bg-muted p-4 rounded-lg mb-6"},Qe={class:"space-y-1 text-sm"},He={class:"space-y-3"},Ye={key:0,class:"space-y-2"},Ze={class:"flex justify-between text-sm text-muted-foreground"},et={class:"flex items-center gap-2"},tt={class:"text-sm text-muted-foreground"},at={key:1,class:"space-y-2"},st={class:"flex items-center gap-2 flex-1 min-w-0"},it={class:"min-w-0"},ot={class:"text-sm truncate"},lt={class:"text-xs text-muted-foreground"},nt={class:"list-disc list-inside"},rt={class:"flex gap-3"},K=5,dt=10*1024*1024,Kt=le({__name:"UpdateDataForm",props:{verification:{},user:{}},setup(c){const r=c,R=o=>o?o.split(" ").map(l=>{if(l.length<=2)return l;const u=l.substring(0,2),p="*".repeat(l.length-2);return u+p}).join(" "):"",I=o=>{if(!o)return"";const[e,l]=o.split("@");if(!l)return o;const[u,...p]=l.split("."),w=p.join(".");let j;if(e.length<=3)j=e;else{const E=e.substring(0,2),P=e.substring(e.length-1),L="*".repeat(e.length-3);j=E+L+P}const B=u[0]+"*".repeat(u.length-1);return`${j}@${B}.${w}`},W=o=>{if(!o)return"";if(o.length<=6)return o;const e=o.substring(0,5),l=o.substring(o.length-1),u="*".repeat(o.length-6);return e+u+l},_=y(!1),C=y(!r.verification.is_verified),U=y(!1),i=y({email:"",telefono:"",territorio_id:r.user.territorio_id||void 0,departamento_id:r.user.departamento_id||void 0,municipio_id:r.user.municipio_id||void 0,localidad_id:r.user.localidad_id||void 0}),Z=ne(()=>{var e,l,u;const o=[];return(e=r.user.departamento)!=null&&e.nombre&&o.push(r.user.departamento.nombre),(l=r.user.municipio)!=null&&l.nombre&&o.push(r.user.municipio.nombre),(u=r.user.localidad)!=null&&u.nombre&&o.push(r.user.localidad.nombre),o.length>0?o.join(", "):"No definida"}),ee=o=>{i.value.territorio_id=o.territorio_id,i.value.departamento_id=o.departamento_id,i.value.municipio_id=o.municipio_id,i.value.localidad_id=o.localidad_id},g=y([]),h=y([]),z=y(0),$=y(!1),te=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg"],X=["pdf","doc","docx","png","jpg","jpeg"],ae=o=>{var u;const e=o.target,l=Array.from(e.files||[]);if(h.value=[],g.value.length+l.length>K){h.value.push(`MÃ¡ximo ${K} archivos permitidos`);return}for(const p of l){if(p.size>dt){h.value.push(`${p.name} excede el tamaÃ±o mÃ¡ximo de 10MB`);continue}const w=(u=p.name.split(".").pop())==null?void 0:u.toLowerCase();if(!te.includes(p.type)&&(!w||!X.includes(w))){h.value.push(`${p.name} tiene un formato no permitido`);continue}g.value.push(p)}e.value=""},se=o=>{g.value.splice(o,1),h.value=[]},ie=o=>{if(o===0)return"0 Bytes";const e=1024,l=["Bytes","KB","MB"],u=Math.floor(Math.log(o)/Math.log(e));return Math.round(o/Math.pow(e,u)*100)/100+" "+l[u]},oe=async()=>{var u,p,w,j,B,E,P,L;if(g.value.length===0){S.error("Por favor adjunta al menos un documento de soporte");return}const o=i.value.email&&i.value.email!==r.user.email,e=i.value.telefono&&i.value.telefono!==r.user.telefono,l=i.value.territorio_id!==r.user.territorio_id||i.value.departamento_id!==r.user.departamento_id||i.value.municipio_id!==r.user.municipio_id||i.value.localidad_id!==r.user.localidad_id;if(!o&&!e&&!l&&g.value.length===0){S.error("No se detectaron cambios para actualizar");return}if(i.value.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.value.email)){S.error("Por favor ingresa un email vÃ¡lido");return}_.value=!0,$.value=!0,z.value=0;try{const v=new FormData;v.append("verification_id",r.verification.id.toString()),i.value.email&&i.value.email!==r.user.email&&v.append("email",i.value.email),i.value.telefono&&i.value.telefono!==r.user.telefono&&v.append("telefono",i.value.telefono),i.value.territorio_id!==r.user.territorio_id&&v.append("territorio_id",((u=i.value.territorio_id)==null?void 0:u.toString())||""),i.value.departamento_id!==r.user.departamento_id&&v.append("departamento_id",((p=i.value.departamento_id)==null?void 0:p.toString())||""),i.value.municipio_id!==r.user.municipio_id&&v.append("municipio_id",((w=i.value.municipio_id)==null?void 0:w.toString())||""),i.value.localidad_id!==r.user.localidad_id&&v.append("localidad_id",((j=i.value.localidad_id)==null?void 0:j.toString())||""),g.value.forEach((b,D)=>{v.append(`documentos[${D}]`,b)}),(await me.post("/confirmar-registro/actualizar-datos",v,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:b=>{const D=b.total?Math.round(b.loaded*100/b.total):0;z.value=D}})).data.success&&(S.success("Solicitud enviada correctamente",{description:"Te notificaremos cuando sea procesada"}),U.value=!0,C.value=!1)}catch(v){const q=((E=(B=v.response)==null?void 0:B.data)==null?void 0:E.message)||"Error al enviar la solicitud",b=(L=(P=v.response)==null?void 0:P.data)==null?void 0:L.errors;b&&Array.isArray(b)?b.forEach(D=>S.error(D)):S.error(q)}finally{_.value=!1,$.value=!1,z.value=0}},G=()=>{window.location.href="/confirmar-registro"};return(o,e)=>(f(),x(O,null,[s(a(re),{title:"Actualizar Datos"}),s(ce,{title:"Actualizar Datos de Contacto",description:c.verification.is_verified?"Tu identidad ha sido verificada. Puedes actualizar tus datos.":"Actualiza tus datos adjuntando documentaciÃ³n de soporte."},{default:n(()=>[t("div",je,[s(a(pe),{class:"shadow-lg"},{default:n(()=>[s(a(ve),null,{default:n(()=>[s(a(ge),{class:"flex items-center gap-2"},{default:n(()=>[d(m(U.value?"âœ… Solicitud Enviada":c.verification.is_verified&&!C.value?"âœ… Identidad Verificada":"ðŸ“ ActualizaciÃ³n de Datos"),1)]),_:1}),s(a(be),null,{default:n(()=>[d(m(U.value?"Tu solicitud ha sido recibida exitosamente":c.verification.is_verified&&!C.value?"Tu identidad ha sido confirmada exitosamente":"Actualiza tu informaciÃ³n de contacto para mantener tus datos al dÃ­a"),1)]),_:1})]),_:1}),s(a(xe),null,{default:n(()=>[U.value?(f(),x("div",Se,[s(a(V),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:n(()=>[s(a(A),{class:"h-4 w-4 text-green-600 dark:text-green-400"}),s(a(M),{class:"text-green-800 dark:text-green-200"},{default:n(()=>[...e[5]||(e[5]=[t("strong",null,"Â¡Solicitud enviada exitosamente!",-1),t("br",null,null,-1),d(" Tu solicitud de actualizaciÃ³n de datos ha sido enviada correctamente. ",-1)])]),_:1})]),_:1}),t("div",ze,[e[9]||(e[9]=t("h3",{class:"font-semibold mb-3 text-lg"},"Â¿QuÃ© sigue ahora?",-1)),t("div",De,[t("div",Ne,[t("div",Te,[s(a(A),{class:"h-4 w-4 text-primary"})]),e[6]||(e[6]=t("div",null,[t("p",{class:"font-medium"},"RevisiÃ³n administrativa"),t("p",{class:"text-sm text-muted-foreground"},"Tu solicitud serÃ¡ revisada por un administrador")],-1))]),t("div",Fe,[t("div",Ve,[s(a(A),{class:"h-4 w-4 text-primary"})]),e[7]||(e[7]=t("div",null,[t("p",{class:"font-medium"},"NotificaciÃ³n por email y WhatsApp"),t("p",{class:"text-sm text-muted-foreground"},"Te informaremos cuando tu solicitud sea procesada")],-1))]),t("div",Me,[t("div",Ae,[s(a(A),{class:"h-4 w-4 text-primary"})]),e[8]||(e[8]=t("div",null,[t("p",{class:"font-medium"},"ActualizaciÃ³n de datos"),t("p",{class:"text-sm text-muted-foreground"},"Si es aprobada, tus datos serÃ¡n actualizados automÃ¡ticamente")],-1))])])]),t("div",Ue,[s(a(k),{onClick:G,type:"button",variant:"default",class:"flex-1"},{default:n(()=>[...e[10]||(e[10]=[d(" Volver al inicio ",-1)])]),_:1})])])):c.verification.is_verified&&!C.value?(f(),x("div",Be,[s(a(V),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:n(()=>[s(a(A),{class:"h-4 w-4 text-green-600 dark:text-green-400"}),s(a(M),{class:"text-green-800 dark:text-green-200"},{default:n(()=>[...e[11]||(e[11]=[t("strong",null,"Â¡VerificaciÃ³n exitosa!",-1),t("br",null,null,-1),d(" Tu identidad ha sido confirmada correctamente. ",-1)])]),_:1})]),_:1}),t("div",Ee,[e[16]||(e[16]=t("h3",{class:"font-semibold mb-3 text-lg"},"Datos Verificados",-1)),t("div",Pe,[t("p",Le,[e[12]||(e[12]=t("span",{class:"text-muted-foreground"},"Nombre:",-1)),t("span",Oe,m(R(c.user.name)),1)]),t("p",Ge,[e[13]||(e[13]=t("span",{class:"text-muted-foreground"},"Documento:",-1)),t("span",Ke,m(c.user.documento_identidad),1)]),t("p",Re,[e[14]||(e[14]=t("span",{class:"text-muted-foreground"},"Email:",-1)),t("span",Ie,m(c.user.email?I(c.user.email):"No registrado"),1)]),t("p",We,[e[15]||(e[15]=t("span",{class:"text-muted-foreground"},"TelÃ©fono:",-1)),t("span",Xe,m(c.user.telefono?W(c.user.telefono):"No registrado"),1)])])]),t("div",qe,[s(a(k),{onClick:e[0]||(e[0]=l=>C.value=!0),type:"button",variant:"outline",class:"flex-1"},{default:n(()=>[...e[17]||(e[17]=[d(" Â¿Deseas actualizar datos? ",-1)])]),_:1}),s(a(k),{onClick:G,type:"button",variant:"default",class:"flex-1"},{default:n(()=>[...e[18]||(e[18]=[d(" Finalizar ",-1)])]),_:1})])])):(f(),x(O,{key:2},[t("div",Je,[e[24]||(e[24]=t("h3",{class:"font-semibold mb-2"},"Datos Actuales",-1)),t("div",Qe,[t("p",null,[e[19]||(e[19]=t("strong",null,"Nombre:",-1)),d(" "+m(R(c.user.name)),1)]),t("p",null,[e[20]||(e[20]=t("strong",null,"Documento:",-1)),d(" "+m(c.user.documento_identidad),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"Email:",-1)),d(" "+m(c.user.email?I(c.user.email):"No registrado"),1)]),t("p",null,[e[22]||(e[22]=t("strong",null,"TelÃ©fono:",-1)),d(" "+m(c.user.telefono?W(c.user.telefono):"No registrado"),1)]),t("p",null,[e[23]||(e[23]=t("strong",null,"UbicaciÃ³n:",-1)),d(" "+m(Z.value),1)])])]),t("form",{onSubmit:J(oe,["prevent"]),class:"space-y-6"},[t("div",null,[s(a(F),{for:"email"},{default:n(()=>[...e[25]||(e[25]=[d("Nuevo Email",-1)])]),_:1}),s(a(H),{id:"email",modelValue:i.value.email,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.email=l),type:"email",placeholder:"ejemplo@correo.com",class:"mt-1"},null,8,["modelValue"]),e[26]||(e[26]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Deja vacÃ­o si no deseas cambiar el email ",-1))]),t("div",null,[s(a(F),{for:"telefono"},{default:n(()=>[...e[27]||(e[27]=[d("Nuevo TelÃ©fono",-1)])]),_:1}),s(a(_e),{id:"telefono",modelValue:i.value.telefono,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.telefono=l),"default-country":"CO",placeholder:"300 123 4567",class:"mt-1",onKeydown:e[3]||(e[3]=de(J(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"]),e[28]||(e[28]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Deja vacÃ­o si no deseas cambiar el telÃ©fono ",-1))]),t("div",null,[s(a(F),{class:"mb-2 flex items-center gap-2"},{default:n(()=>[s(a(he),{class:"h-4 w-4"}),e[29]||(e[29]=d(" Nueva UbicaciÃ³n de Residencia ",-1))]),_:1}),s(fe,{"model-value":{territorio_id:i.value.territorio_id,departamento_id:i.value.departamento_id,municipio_id:i.value.municipio_id,localidad_id:i.value.localidad_id},"onUpdate:modelValue":ee,mode:"single","show-card":!1,disabled:_.value},null,8,["model-value","disabled"]),e[30]||(e[30]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Selecciona tu ubicaciÃ³n actual si ha cambiado ",-1))]),t("div",null,[s(a(F),null,{default:n(()=>[...e[31]||(e[31]=[d("Documentos de Soporte ",-1),t("span",{class:"text-red-500"},"*",-1),d(" (Obligatorio)",-1)])]),_:1}),e[35]||(e[35]=t("p",{class:"text-sm text-muted-foreground mb-2"}," Debes adjuntar al menos un documento de identidad o comprobante para validar la actualizaciÃ³n ",-1)),t("div",He,[$.value?(f(),x("div",Ye,[t("div",Ze,[e[32]||(e[32]=t("span",null,"Subiendo archivos...",-1)),t("span",null,m(z.value)+"%",1)]),s(a(ye),{value:z.value,class:"w-full"},null,8,["value"])])):N("",!0),t("div",et,[s(a(H),{type:"file",onChange:ae,accept:X.map(l=>`.${l}`).join(","),multiple:"",disabled:$.value,class:"hidden",id:"file-input"},null,8,["accept","disabled"]),s(a(F),{for:"file-input",class:ue(["inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background h-10 px-4 py-2",$.value?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-accent hover:text-accent-foreground"])},{default:n(()=>[s(a(we),{class:"mr-2 h-4 w-4"}),d(" "+m($.value?"Subiendo...":"Seleccionar archivos"),1)]),_:1},8,["class"]),t("span",tt,m(g.value.length)+"/"+m(K)+" archivos ",1)]),g.value.length>0?(f(),x("div",at,[(f(!0),x(O,null,Q(g.value,(l,u)=>(f(),x("div",{key:u,class:"flex items-center justify-between p-2 bg-muted rounded-md"},[t("div",st,[s(a(ke),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),t("div",it,[t("p",ot,m(l.name),1),t("p",lt,m(ie(l.size)),1)])]),s(a(k),{onClick:p=>se(u),type:"button",variant:"ghost",size:"sm",class:"h-8 w-8 p-0"},{default:n(()=>[s(a(Ce),{class:"h-4 w-4"})]),_:1},8,["onClick"])]))),128))])):N("",!0),h.value.length>0?(f(),T(a(V),{key:2,variant:"destructive"},{default:n(()=>[s(a(Y),{class:"h-4 w-4"}),s(a(M),null,{default:n(()=>[t("ul",nt,[(f(!0),x(O,null,Q(h.value,l=>(f(),x("li",{key:l},m(l),1))),128))])]),_:1})]),_:1})):N("",!0),g.value.length===0?(f(),T(a(V),{key:3,variant:"default",class:"border-orange-200 bg-orange-50 dark:bg-orange-900/20"},{default:n(()=>[s(a(Y),{class:"h-4 w-4 text-orange-600"}),s(a(M),{class:"text-orange-800 dark:text-orange-200"},{default:n(()=>[...e[33]||(e[33]=[t("strong",null,"Importante:",-1),d(" Debes adjuntar al menos un documento para procesar tu solicitud. ",-1)])]),_:1})]),_:1})):N("",!0),e[34]||(e[34]=t("p",{class:"text-xs text-muted-foreground"}," Formatos permitidos: PDF, DOC, DOCX, PNG, JPG. MÃ¡ximo 10MB por archivo. ",-1))])]),s(a(V),null,{default:n(()=>[s(a(M),{class:"text-foreground"},{default:n(()=>[...e[36]||(e[36]=[d(" Tu solicitud serÃ¡ revisada por un administrador. RecibirÃ¡s una notificaciÃ³n por email y WhatsApp cuando sea procesada. ",-1)])]),_:1})]),_:1}),t("div",rt,[s(a(k),{type:"submit",disabled:_.value,class:"flex-1"},{default:n(()=>[_.value?(f(),T(a($e),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):N("",!0),d(" "+m(_.value?"Enviando...":"Enviar Solicitud"),1)]),_:1},8,["disabled"]),c.verification.is_verified?(f(),T(a(k),{key:0,onClick:e[4]||(e[4]=l=>C.value=!1),type:"button",variant:"outline",disabled:_.value},{default:n(()=>[...e[37]||(e[37]=[d(" Volver ",-1)])]),_:1},8,["disabled"])):(f(),T(a(k),{key:1,onClick:G,type:"button",variant:"outline",disabled:_.value},{default:n(()=>[...e[38]||(e[38]=[d(" Cancelar ",-1)])]),_:1},8,["disabled"]))])],32)],64))]),_:1})]),_:1})])]),_:1},8,["description"])],64))}});export{Kt as default};
