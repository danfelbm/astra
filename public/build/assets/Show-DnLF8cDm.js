import{d as ts,J as os,r as M,c as R,b as h,e as l,w as d,f as a,g as o,u as t,p as as,h as n,t as r,n as C,i as c,j as m,F as P,k as j,W as D}from"./app-CGDcXcXm.js";import{_ as is}from"./UserLayout.vue_vue_type_script_setup_true_lang-CK2bSkKT.js";import{_ as L,a as W,b as G,c as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-BudF5sLg.js";import{_ as q}from"./CardDescription.vue_vue_type_script_setup_true_lang-B32gJRul.js";import{_ as v}from"./createLucideIcon-DanALmEC.js";import{_ as x}from"./index-BsPs8wxd.js";import{_ as ls}from"./Progress.vue_vue_type_script_setup_true_lang-D6-mmuZ1.js";import{_ as I}from"./Textarea.vue_vue_type_script_setup_true_lang-BZVMoSLu.js";import{_ as rs,a as ns}from"./index-3LFn1my6.js";import{u as ds}from"./useToast-BGmBO9X2.js";import{A as cs}from"./arrow-left-GVkRhu4l.js";import{C as b}from"./calendar-BTZmtWlZ.js";import{C as N}from"./clock-CRCIQO9f.js";import{U as $}from"./user-CyfX3Swe.js";import{C as K}from"./circle-alert-CaBwTfyT.js";import{C as S}from"./chevron-right-Ch7F_p_y.js";import{C as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-BAaIhJ0J.js";import{C as V}from"./circle-check-big-r-NobB5n.js";import{F as ms}from"./file-text-ByNZVhOA.js";import{f as O,e as Q}from"./es-BDPlFIsO.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-_Nm3H6S4.js";import"./index-BBAsWOFq.js";import"./floating-ui.vue-36zNgrSP.js";import"./x-BDmXRx4n.js";import"./Input.vue_vue_type_script_setup_true_lang-De2JuYAO.js";import"./index-D4d4TGf0.js";import"./index-CcR8_wTx.js";import"./shield-Bejn5muX.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BBLyUXDE.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Blow8o_p.js";import"./VisuallyHidden-5PoN3-2b.js";import"./Label.vue_vue_type_script_setup_true_lang-ucIShhqX.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-o2J4dePs.js";import"./index-D3sE_pCs.js";import"./map-pin-Cz6bXU5Q.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-C7YVKPpr.js";import"./square-check-big-DJvqSVRt.js";import"./users-CsdoQTZz.js";import"./folder-open-ByFFqHS3.js";import"./index-HHRqvbiQ.js";import"./nullish-CHIgUVhi.js";import"./check-WUsKeayf.js";const ps={class:"space-y-6"},us={class:"flex items-center gap-4"},fs={class:"flex items-start justify-between"},_s={class:"space-y-2"},hs={key:0},vs={class:"text-sm text-muted-foreground"},gs={class:"flex items-center justify-between mb-2"},ys={class:"text-sm font-medium"},xs={class:"text-sm text-muted-foreground mt-2"},ks={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},ws={class:"space-y-1"},Cs={class:"text-sm text-muted-foreground flex items-center gap-1"},bs={class:"text-sm font-medium"},$s={class:"space-y-1"},Vs={class:"text-sm text-muted-foreground flex items-center gap-1"},Es={class:"text-sm font-medium"},zs={class:"space-y-1"},Ms={class:"text-sm text-muted-foreground flex items-center gap-1"},Ps={class:"space-y-1"},js={class:"text-sm text-muted-foreground flex items-center gap-1"},Ds={class:"text-sm font-medium"},Ns={key:1,class:"mt-4"},Ss={class:"space-y-6"},Us={key:0},Bs={class:"font-semibold mb-3 flex items-center gap-2"},Ts={class:"space-y-2"},Fs={class:"flex items-start justify-between"},As={class:"flex-1 space-y-2"},Hs={class:"flex items-center gap-2"},Rs={class:"font-medium"},Ls={key:0,class:"ml-6 space-y-3"},Ws={key:0,class:"text-sm text-muted-foreground"},Gs={class:"flex items-center gap-4 text-sm text-muted-foreground"},Js={class:"flex items-center gap-1"},qs={key:0,class:"flex items-center gap-1"},Is={key:1,class:"border-t pt-3 space-y-2"},Ks={class:"flex gap-2"},Os={key:1},Qs={class:"font-semibold mb-3 flex items-center gap-2"},Xs={class:"space-y-2"},Ys={class:"flex items-start justify-between"},Zs={class:"flex-1 space-y-2"},se={class:"flex items-center gap-2"},ee={class:"font-medium"},te={key:0,class:"ml-6 space-y-3"},oe={key:0,class:"text-sm text-muted-foreground"},ae={class:"flex items-center gap-4 text-sm text-muted-foreground"},ie={class:"flex items-center gap-1"},le={key:0,class:"flex items-center gap-1"},re={key:1,class:"border-t pt-3 space-y-2"},ne={key:2},de={class:"font-semibold mb-3 flex items-center gap-2"},ce={class:"space-y-2"},me={class:"flex items-start justify-between"},pe={class:"flex-1 space-y-2"},ue={class:"flex items-center gap-2"},fe={class:"font-medium line-through text-muted-foreground"},_e={key:0,class:"ml-6 space-y-2 text-sm text-muted-foreground"},he={key:0},ve={class:"flex items-center gap-4"},ge={class:"flex items-center gap-1"},ye={key:0,class:"flex items-center gap-1"},xe={key:1,class:"italic"},ke={key:3,class:"text-center py-8"},ct=ts({__name:"Show",props:{hito:{},canComplete:{type:Boolean},canUpdateProgress:{type:Boolean}},setup(X){const u=X;os();const{success:B,error:T}=ds(),_=M({}),g=M({}),y=M({}),E=s=>{_.value[s]=!_.value[s]},F=s=>{y.value[s.id]||(y.value[s.id]=!0,D.post(route("user.mis-hitos.completar",{hito:u.hito.id,entregable:s.id}),{notas:g.value[s.id]||""},{preserveScroll:!0,onSuccess:()=>{B("Entregable marcado como completado"),g.value[s.id]="",y.value[s.id]=!1},onError:()=>{T("Error al completar el entregable"),y.value[s.id]=!1}}))},Y=(s,i)=>{u.canUpdateProgress&&D.put(route("user.mis-hitos.actualizar-estado",{hito:u.hito.id,entregable:s.id}),{estado:i},{preserveScroll:!0,onSuccess:()=>{B("Estado actualizado correctamente")},onError:()=>{T("Error al actualizar el estado")}})},Z=()=>{D.visit(route("user.mis-hitos.index"))},k=s=>s?O(new Date(s),"dd MMM yyyy",{locale:Q}):"No definida",ss=s=>s?O(new Date(s),"dd MMM yyyy 'a las' HH:mm",{locale:Q}):"No definida",es=s=>({pendiente:"bg-gray-100 text-gray-800",en_progreso:"bg-blue-100 text-blue-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",A=s=>({baja:"bg-gray-100 text-gray-600",media:"bg-yellow-100 text-yellow-800",alta:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-600",z=s=>{if(!s)return null;const i=Math.ceil((new Date(s).getTime()-new Date().getTime())/(1e3*60*60*24));return i<0?`Vencido hace ${Math.abs(i)} días`:i===0?"Vence hoy":i===1?"Vence mañana":`${i} días restantes`},f=R(()=>u.hito.entregables?{pendientes:u.hito.entregables.filter(s=>s.estado==="pendiente"),en_progreso:u.hito.entregables.filter(s=>s.estado==="en_progreso"),completados:u.hito.entregables.filter(s=>s.estado==="completado")}:{pendientes:[],en_progreso:[],completados:[]}),w=R(()=>{if(!u.hito.entregables)return{total:0,completados:0,porcentaje:0};const s=u.hito.entregables.length,i=u.hito.entregables.filter(p=>p.estado==="completado").length,e=s>0?Math.round(i/s*100):0;return{total:s,completados:i,porcentaje:e}});return(s,i)=>(l(),h(is,null,{default:d(()=>[a(t(as),{title:`Hito: ${s.hito.nombre}`},null,8,["title"]),o("div",ps,[o("div",us,[a(t(v),{onClick:Z,variant:"ghost",size:"sm",class:"gap-2"},{default:d(()=>[a(t(cs),{class:"h-4 w-4"}),i[0]||(i[0]=n(" Volver a Mis Hitos ",-1))]),_:1})]),a(t(L),null,{default:d(()=>[a(t(W),null,{default:d(()=>[o("div",fs,[o("div",_s,[a(t(G),{class:"text-2xl"},{default:d(()=>[n(r(s.hito.nombre),1)]),_:1}),a(t(q),null,{default:d(()=>{var e;return[n(" Proyecto: "+r(((e=s.hito.proyecto)==null?void 0:e.nombre)||"Sin proyecto"),1)]}),_:1})]),a(t(x),{class:C([es(s.hito.estado),"ml-4"])},{default:d(()=>[n(r(s.hito.estado),1)]),_:1},8,["class"])])]),_:1}),a(t(J),{class:"space-y-6"},{default:d(()=>{var e,p,H;return[s.hito.descripcion?(l(),c("div",hs,[i[1]||(i[1]=o("h3",{class:"font-semibold mb-2"},"Descripción",-1)),o("p",vs,r(s.hito.descripcion),1)])):m("",!0),o("div",null,[o("div",gs,[i[2]||(i[2]=o("h3",{class:"font-semibold"},"Progreso General",-1)),o("span",ys,r(w.value.porcentaje)+"%",1)]),a(t(ls),{value:w.value.porcentaje,class:"h-2"},null,8,["value"]),o("p",xs,r(w.value.completados)+" de "+r(w.value.total)+" entregables completados ",1)]),o("div",ks,[o("div",ws,[o("p",Cs,[a(t(b),{class:"h-4 w-4"}),i[3]||(i[3]=n(" Fecha de Inicio ",-1))]),o("p",bs,r(k(s.hito.fecha_inicio)),1)]),o("div",$s,[o("p",Vs,[a(t(b),{class:"h-4 w-4"}),i[4]||(i[4]=n(" Fecha de Fin ",-1))]),o("p",Es,r(k(s.hito.fecha_fin)),1)]),o("div",zs,[o("p",Ms,[a(t(N),{class:"h-4 w-4"}),i[5]||(i[5]=n(" Tiempo Restante ",-1))]),o("p",{class:C(["text-sm font-medium",{"text-red-600":s.hito.estado!=="completado"&&((e=z(s.hito.fecha_fin))==null?void 0:e.includes("Vencido"))}])},r(z(s.hito.fecha_fin)||"Sin fecha límite"),3)]),o("div",Ps,[o("p",js,[a(t($),{class:"h-4 w-4"}),i[6]||(i[6]=n(" Responsable ",-1))]),o("p",Ds,r(((p=s.hito.responsable)==null?void 0:p.name)||"Sin responsable"),1)])]),(H=z(s.hito.fecha_fin))!=null&&H.includes("Vencido")&&s.hito.estado!=="completado"?(l(),c("div",Ns,[a(t(rs),{variant:"destructive"},{default:d(()=>[a(t(K),{class:"h-4 w-4"}),a(t(ns),null,{default:d(()=>[...i[7]||(i[7]=[n(" Este hito está vencido. Por favor, actualiza su estado o contacta a tu supervisor. ",-1)])]),_:1})]),_:1})])):m("",!0)]}),_:1})]),_:1}),a(t(L),null,{default:d(()=>[a(t(W),null,{default:d(()=>[a(t(G),null,{default:d(()=>[...i[8]||(i[8]=[n("Entregables",-1)])]),_:1}),a(t(q),null,{default:d(()=>[...i[9]||(i[9]=[n(" Lista de entregables asociados a este hito ",-1)])]),_:1})]),_:1}),a(t(J),null,{default:d(()=>[o("div",Ss,[f.value.pendientes.length>0?(l(),c("div",Us,[o("h3",Bs,[a(t(K),{class:"h-5 w-5 text-yellow-600"}),n(" Pendientes ("+r(f.value.pendientes.length)+") ",1)]),o("div",Ts,[(l(!0),c(P,null,j(f.value.pendientes,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 hover:bg-gray-50 transition-colors"},[o("div",Fs,[o("div",As,[o("div",Hs,[a(t(v),{onClick:p=>E(e.id),variant:"ghost",size:"sm",class:"p-0 h-auto"},{default:d(()=>[_.value[e.id]?(l(),h(t(U),{key:1,class:"h-4 w-4"})):(l(),h(t(S),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),o("h4",Rs,r(e.nombre),1),a(t(x),{class:C(A(e.prioridad)),variant:"outline"},{default:d(()=>[n(r(e.prioridad),1)]),_:2},1032,["class"])]),_.value[e.id]?(l(),c("div",Ls,[e.descripcion?(l(),c("p",Ws,r(e.descripcion),1)):m("",!0),o("div",Gs,[o("span",Js,[a(t(b),{class:"h-3 w-3"}),n(" Vence: "+r(k(e.fecha_fin)),1)]),e.responsable?(l(),c("span",qs,[a(t($),{class:"h-3 w-3"}),n(" "+r(e.responsable.name),1)])):m("",!0)]),s.canComplete?(l(),c("div",Is,[a(t(I),{modelValue:g.value[e.id],"onUpdate:modelValue":p=>g.value[e.id]=p,placeholder:"Notas al completar (opcional)...",class:"text-sm",rows:"2"},null,8,["modelValue","onUpdate:modelValue"]),o("div",Ks,[a(t(v),{onClick:p=>F(e),disabled:y.value[e.id],size:"sm",class:"gap-2"},{default:d(()=>[a(t(V),{class:"h-4 w-4"}),i[10]||(i[10]=n(" Marcar como Completado ",-1))]),_:2},1032,["onClick","disabled"]),s.canUpdateProgress?(l(),h(t(v),{key:0,onClick:p=>Y(e,"en_progreso"),variant:"outline",size:"sm",class:"gap-2"},{default:d(()=>[a(t(N),{class:"h-4 w-4"}),i[11]||(i[11]=n(" En Progreso ",-1))]),_:2},1032,["onClick"])):m("",!0)])])):m("",!0)])):m("",!0)])])]))),128))])])):m("",!0),f.value.en_progreso.length>0?(l(),c("div",Os,[o("h3",Qs,[a(t(N),{class:"h-5 w-5 text-blue-600"}),n(" En Progreso ("+r(f.value.en_progreso.length)+") ",1)]),o("div",Xs,[(l(!0),c(P,null,j(f.value.en_progreso,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 hover:bg-gray-50 transition-colors"},[o("div",Ys,[o("div",Zs,[o("div",se,[a(t(v),{onClick:p=>E(e.id),variant:"ghost",size:"sm",class:"p-0 h-auto"},{default:d(()=>[_.value[e.id]?(l(),h(t(U),{key:1,class:"h-4 w-4"})):(l(),h(t(S),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),o("h4",ee,r(e.nombre),1),a(t(x),{class:C(A(e.prioridad)),variant:"outline"},{default:d(()=>[n(r(e.prioridad),1)]),_:2},1032,["class"]),a(t(x),{class:"bg-blue-100 text-blue-800"},{default:d(()=>[...i[12]||(i[12]=[n(" En Progreso ",-1)])]),_:1})]),_.value[e.id]?(l(),c("div",te,[e.descripcion?(l(),c("p",oe,r(e.descripcion),1)):m("",!0),o("div",ae,[o("span",ie,[a(t(b),{class:"h-3 w-3"}),n(" Vence: "+r(k(e.fecha_fin)),1)]),e.responsable?(l(),c("span",le,[a(t($),{class:"h-3 w-3"}),n(" "+r(e.responsable.name),1)])):m("",!0)]),s.canComplete?(l(),c("div",re,[a(t(I),{modelValue:g.value[e.id],"onUpdate:modelValue":p=>g.value[e.id]=p,placeholder:"Notas al completar (opcional)...",class:"text-sm",rows:"2"},null,8,["modelValue","onUpdate:modelValue"]),a(t(v),{onClick:p=>F(e),disabled:y.value[e.id],size:"sm",class:"gap-2"},{default:d(()=>[a(t(V),{class:"h-4 w-4"}),i[13]||(i[13]=n(" Marcar como Completado ",-1))]),_:2},1032,["onClick","disabled"])])):m("",!0)])):m("",!0)])])]))),128))])])):m("",!0),f.value.completados.length>0?(l(),c("div",ne,[o("h3",de,[a(t(V),{class:"h-5 w-5 text-green-600"}),n(" Completados ("+r(f.value.completados.length)+") ",1)]),o("div",ce,[(l(!0),c(P,null,j(f.value.completados,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 bg-green-50/50"},[o("div",me,[o("div",pe,[o("div",ue,[a(t(v),{onClick:p=>E(e.id),variant:"ghost",size:"sm",class:"p-0 h-auto"},{default:d(()=>[_.value[e.id]?(l(),h(t(U),{key:1,class:"h-4 w-4"})):(l(),h(t(S),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),o("h4",fe,r(e.nombre),1),a(t(x),{class:"bg-green-100 text-green-800"},{default:d(()=>[...i[14]||(i[14]=[n(" Completado ",-1)])]),_:1})]),_.value[e.id]?(l(),c("div",_e,[e.descripcion?(l(),c("p",he,r(e.descripcion),1)):m("",!0),o("div",ve,[o("span",ge,[a(t(V),{class:"h-3 w-3"}),n(" Completado: "+r(ss(e.completado_at)),1)]),e.completado_por_usuario?(l(),c("span",ye,[a(t($),{class:"h-3 w-3"}),n(" Por: "+r(e.completado_por_usuario.name),1)])):m("",!0)]),e.notas_completado?(l(),c("p",xe," Notas: "+r(e.notas_completado),1)):m("",!0)])):m("",!0)])])]))),128))])])):m("",!0),!s.hito.entregables||s.hito.entregables.length===0?(l(),c("div",ke,[a(t(ms),{class:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),i[15]||(i[15]=o("p",{class:"text-muted-foreground"},"No hay entregables asignados a este hito",-1))])):m("",!0)])]),_:1})]),_:1})])]),_:1}))}});export{ct as default};
