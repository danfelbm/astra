import{d as G,k,j as f,o as i,e as s,b as t,f as n,u as e,m as I,i as _,P as y,g as o,a as $,R as Q,t as d,F as D,r as B,n as X,W as h}from"./app-Bqj6cabU.js";import{T as J,_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Dpu4Wpcj.js";import{_ as C}from"./createLucideIcon-C8o-8vKY.js";import{_ as F,a as U,b as L,c as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-CE7ACGrx.js";import{_ as Z}from"./CardDescription.vue_vue_type_script_setup_true_lang-D4-66thX.js";import{_ as ee,a as te,b as w,c,d as se,e as p}from"./TableHeader.vue_vue_type_script_setup_true_lang-D2Tj3Sp7.js";import{_ as S}from"./index-B1hFReqZ.js";import{_ as ae}from"./Input.vue_vue_type_script_setup_true_lang-BgUqW2xn.js";import{_ as le,a as re,b as oe,c as ne,d as T}from"./SelectValue.vue_vue_type_script_setup_true_lang-Bqrud0Vz.js";import{_ as ie}from"./AdvancedFilters.vue_vue_type_script_setup_true_lang-B_H5Fi-i.js";import{_ as ue,a as de,b as me,c as g}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-abXnMk-o.js";import{P as fe}from"./plus-BLlcKvw3.js";import{U as pe}from"./users-BPHT5OHo.js";import{E as _e}from"./ellipsis-DteYqyyU.js";import{E as ce}from"./eye-Zef7jzZl.js";import{R as ge}from"./refresh-cw-B1X4Sl6N.js";import{T as ve}from"./trash-BiHfBFkZ.js";import{S as xe}from"./square-pen-C6g5z6Z4.js";import{T as ye}from"./trash-2-DZx14x3r.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-1zoq1_ge.js";import"./index-BKc_ekQU.js";import"./floating-ui.vue-JANudi2O.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CFEiplAu.js";import"./VisuallyHidden-DgAOoJOt.js";import"./index-_CXItz_H.js";import"./shield-B6qXhAif.js";import"./user-DxJeGoXE.js";import"./Label.vue_vue_type_script_setup_true_lang-CrvKdd-Q.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CtdU0Fle.js";import"./index-CLO0EMv4.js";import"./circle-alert-C1YWw91b.js";import"./map-pin-C8oba01p.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-Z9DdC44R.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-TgHQxhTl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-C3NlMLpT.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-W66iioUR.js";import"./vote-BfMb807g.js";import"./file-text-DXUAiP0m.js";import"./calendar-BUIf-xWA.js";import"./briefcase-DiZT2dcr.js";import"./megaphone-CYLoROL6.js";import"./user-check-BxFSLWxT.js";import"./external-link-Cu0H_uKm.js";import"./panel-left-D7zZdbo5.js";import"./check-JsU3fe4g.js";import"./index-CwsEjmb9.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-ClaqeSjv.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DrPOJGi-.js";import"./es-DfN3vIXC.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-P28DQP-x.js";import"./loader-circle-Dwmj8osf.js";import"./search-kSiJLLM7.js";import"./history-4O-5Tph_.js";import"./save-CvFoKHL0.js";const $e={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},he={class:"flex items-center justify-between"},Ce={class:"flex gap-4"},be={class:"flex-1"},ke={class:"w-48"},we={key:0},Se={class:"flex items-center gap-2"},Te={class:"font-semibold"},Ee={class:"text-xs text-muted-foreground max-w-xs truncate"},Ve={class:"text-xs"},De={class:"flex items-center gap-1"},Be={class:"text-sm font-medium"},Fe={class:"text-xs text-muted-foreground"},Ue={key:0,class:"flex items-center justify-center space-x-2 mt-6"},Le={class:"flex gap-1"},Nt=G({__name:"Index",props:{segments:{},filters:{},filterFieldsConfig:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean}},setup(N){const u=N,R=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"}],b=k(u.filters.search||""),v=k(u.filters.is_dynamic||"all"),x=k(!1),j=l=>l?"default":"secondary",P=l=>l?"Dinámico":"Estático",A=l=>l.split("\\").pop()||l,z=l=>l!=null&&l.last_calculated_at?new Date(l.last_calculated_at).toLocaleString():"Nunca",q=l=>l<60?`${l}s`:l<3600?`${Math.floor(l/60)}m`:`${Math.floor(l/3600)}h`,E=()=>{const l={search:b.value};v.value!=="all"&&(l.is_dynamic=v.value),h.get("/admin/segments",l,{preserveState:!0,preserveScroll:!0})},H=l=>{confirm(`¿Estás seguro de eliminar el segmento "${l.name}"?`)&&h.delete(`/admin/segments/${l.id}`)},K=async l=>{var a;try{(await(await fetch(`/admin/segments/${l.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""}})).json()).success&&h.reload()}catch(r){console.error("Error evaluating segment:",r)}},O=l=>{h.post(`/admin/segments/${l.id}/clear-cache`)},W=l=>u.canDelete?!l.roles||l.roles.length===0:!1;return(l,a)=>(i(),f(Y,{breadcrumbs:R},{default:s(()=>[t(e(I),{title:"Segmentos"}),n("div",$e,[n("div",he,[a[4]||(a[4]=n("div",null,[n("h2",{class:"text-2xl font-bold tracking-tight"},"Segmentos de Usuarios"),n("p",{class:"text-muted-foreground"}," Gestiona segmentos dinámicos basados en filtros avanzados ")],-1)),u.canCreate?(i(),f(e(y),{key:0,href:l.route("admin.segments.create")},{default:s(()=>[t(e(C),null,{default:s(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),a[3]||(a[3]=o(" Nuevo Segmento "))]),_:1})]),_:1},8,["href"])):_("",!0)]),t(e(F),null,{default:s(()=>[t(e(U),null,{default:s(()=>[t(e(L),{class:"text-base"},{default:s(()=>a[5]||(a[5]=[o("Filtros")])),_:1})]),_:1}),t(e(M),{class:"space-y-4"},{default:s(()=>[n("div",Ce,[n("div",be,[t(e(ae),{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=r=>b.value=r),placeholder:"Buscar por nombre o descripción...",onKeyup:Q(E,["enter"])},null,8,["modelValue"])]),n("div",ke,[t(e(le),{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=r=>v.value=r)},{default:s(()=>[t(e(re),null,{default:s(()=>[t(e(oe),{placeholder:"Tipo de segmento"})]),_:1}),t(e(ne),null,{default:s(()=>[t(e(T),{value:"all"},{default:s(()=>a[6]||(a[6]=[o("Todos")])),_:1}),t(e(T),{value:"true"},{default:s(()=>a[7]||(a[7]=[o("Dinámicos")])),_:1}),t(e(T),{value:"false"},{default:s(()=>a[8]||(a[8]=[o("Estáticos")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),t(e(C),{onClick:E,variant:"secondary"},{default:s(()=>a[9]||(a[9]=[o(" Buscar ")])),_:1}),t(e(C),{onClick:a[2]||(a[2]=r=>x.value=!x.value),variant:"outline"},{default:s(()=>[o(d(x.value?"Ocultar":"Mostrar")+" Filtros Avanzados ",1)]),_:1})]),x.value?(i(),$("div",we,[t(ie,{fieldsConfig:l.filterFieldsConfig,baseUrl:"/admin/segments"},null,8,["fieldsConfig"])])):_("",!0)]),_:1})]),_:1}),t(e(F),null,{default:s(()=>[t(e(U),null,{default:s(()=>[t(e(L),null,{default:s(()=>a[10]||(a[10]=[o("Segmentos Registrados")])),_:1}),t(e(Z),null,{default:s(()=>[o(" Total de "+d(u.segments.total)+" segmentos configurados ",1)]),_:1})]),_:1}),t(e(M),null,{default:s(()=>[t(e(ee),null,{default:s(()=>[t(e(te),null,{default:s(()=>[t(e(w),null,{default:s(()=>[t(e(c),null,{default:s(()=>a[11]||(a[11]=[o("Segmento")])),_:1}),t(e(c),null,{default:s(()=>a[12]||(a[12]=[o("Tipo")])),_:1}),t(e(c),null,{default:s(()=>a[13]||(a[13]=[o("Modelo")])),_:1}),t(e(c),null,{default:s(()=>a[14]||(a[14]=[o("Usuarios")])),_:1}),t(e(c),null,{default:s(()=>a[15]||(a[15]=[o("Cache")])),_:1}),t(e(c),null,{default:s(()=>a[16]||(a[16]=[o("Última Evaluación")])),_:1}),t(e(c),null,{default:s(()=>a[17]||(a[17]=[o("Roles")])),_:1}),t(e(c),{class:"text-right"},{default:s(()=>a[18]||(a[18]=[o("Acciones")])),_:1})]),_:1})]),_:1}),t(e(se),null,{default:s(()=>[(i(!0),$(D,null,B(u.segments.data,r=>(i(),f(e(w),{key:r.id},{default:s(()=>[t(e(p),{class:"font-medium"},{default:s(()=>[n("div",Se,[t(e(J),{class:"h-4 w-4 text-muted-foreground"}),n("div",null,[n("p",Te,d(r.name),1),n("p",Ee,d(r.description||"Sin descripción"),1)])])]),_:2},1024),t(e(p),null,{default:s(()=>[t(e(S),{variant:j(r.is_dynamic)},{default:s(()=>[o(d(P(r.is_dynamic)),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(p),null,{default:s(()=>[n("code",Ve,d(A(r.model_type)),1)]),_:2},1024),t(e(p),null,{default:s(()=>{var m;return[n("div",De,[t(e(pe),{class:"h-4 w-4 text-muted-foreground"}),n("span",Be,d(((m=r.metadata)==null?void 0:m.contacts_count)||r.user_count||0),1)])]}),_:2},1024),t(e(p),null,{default:s(()=>[t(e(S),{variant:"ghost"},{default:s(()=>[o(d(q(r.cache_duration)),1)]),_:2},1024)]),_:2},1024),t(e(p),null,{default:s(()=>[n("span",Fe,d(z(r.metadata)),1)]),_:2},1024),t(e(p),null,{default:s(()=>[t(e(S),{variant:"outline"},{default:s(()=>{var m,V;return[o(d(((m=r.roles)==null?void 0:m.length)||0)+" rol"+d((((V=r.roles)==null?void 0:V.length)||0)!==1?"es":""),1)]}),_:2},1024)]),_:2},1024),t(e(p),{class:"text-right"},{default:s(()=>[t(e(ue),null,{default:s(()=>[t(e(de),{asChild:""},{default:s(()=>[t(e(C),{variant:"ghost",size:"icon"},{default:s(()=>[t(e(_e),{class:"h-4 w-4"})]),_:1})]),_:1}),t(e(me),{align:"end"},{default:s(()=>[t(e(y),{href:`/admin/segments/${r.id}`},{default:s(()=>[t(e(g),null,{default:s(()=>[t(e(ce),{class:"mr-2 h-4 w-4"}),a[19]||(a[19]=o(" Ver Usuarios "))]),_:1})]),_:2},1032,["href"]),u.canEdit?(i(),f(e(g),{key:0,onClick:m=>K(r)},{default:s(()=>[t(e(ge),{class:"mr-2 h-4 w-4"}),a[20]||(a[20]=o(" Recalcular "))]),_:2},1032,["onClick"])):_("",!0),u.canEdit?(i(),f(e(g),{key:1,onClick:m=>O(r)},{default:s(()=>[t(e(ve),{class:"mr-2 h-4 w-4"}),a[21]||(a[21]=o(" Limpiar Cache "))]),_:2},1032,["onClick"])):_("",!0),u.canEdit?(i(),f(e(y),{key:2,href:`/admin/segments/${r.id}/edit`},{default:s(()=>[t(e(g),null,{default:s(()=>[t(e(xe),{class:"mr-2 h-4 w-4"}),a[22]||(a[22]=o(" Editar "))]),_:1})]),_:2},1032,["href"])):_("",!0),W(r)?(i(),f(e(g),{key:3,onClick:m=>H(r),class:"text-destructive"},{default:s(()=>[t(e(ye),{class:"mr-2 h-4 w-4"}),a[23]||(a[23]=o(" Eliminar "))]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),u.segments.data.length===0?(i(),f(e(w),{key:0},{default:s(()=>[t(e(p),{colspan:"8",class:"text-center py-8 text-muted-foreground"},{default:s(()=>a[24]||(a[24]=[o(" No se encontraron segmentos ")])),_:1})]),_:1})):_("",!0)]),_:1})]),_:1}),u.segments.last_page>1?(i(),$("div",Ue,[n("nav",Le,[(i(!0),$(D,null,B(u.segments.links,r=>(i(),f(e(y),{key:r.label,href:r.url,class:X(["px-3 py-2 text-sm rounded-md",r.active?"bg-primary text-primary-foreground":"hover:bg-muted",!r.url&&"opacity-50 cursor-not-allowed"]),innerHTML:r.label,disabled:!r.url},null,8,["href","class","innerHTML","disabled"]))),128))])])):_("",!0)]),_:1})]),_:1})])]),_:1}))}});export{Nt as default};
