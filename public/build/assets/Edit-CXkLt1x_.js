import{d as J,C as L,r as N,i as u,e as n,f as t,u as e,p as O,w as s,g as i,P as B,h as d,l as W,j as f,n as _,t as p,F as x,k as $,b as h,a as E}from"./app-BMyT8npG.js";import{_ as q}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BFIlw7hr.js";import{_ as C}from"./createLucideIcon-KBqbhxXl.js";import{_ as g,a as y,b,c as k}from"./CardTitle.vue_vue_type_script_setup_true_lang--o-W0VD2.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-gbXepL8P.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-B-ZayioL.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-CB_veUhw.js";import{_ as H,a as K,b as Q,c as X,d as P}from"./SelectValue.vue_vue_type_script_setup_true_lang-DvImVwo1.js";import{_ as Y}from"./Switch.vue_vue_type_script_setup_true_lang-Dxi5Skj1.js";import{_ as Z}from"./Checkbox.vue_vue_type_script_setup_true_lang-CXeJvqS0.js";import{_ as ee}from"./GeographicSelector.vue_vue_type_script_setup_true_lang-DTP_M3gs.js";import{_ as oe}from"./AvatarUpload.vue_vue_type_script_setup_true_lang-DPjg8_g-.js";import{t as V}from"./index-Bh0tNFO1.js";import{A as re}from"./arrow-left-DaooQBOA.js";import{S as te}from"./save-Bn7NZPcn.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BA6Cgh2E.js";import"./index-BtG7D9fB.js";import"./floating-ui.vue-QqVgEqqM.js";import"./x-C1dlUGaj.js";import"./index-DTvzeguX.js";import"./shield-D8bNww_e.js";import"./user-B0uyQIKj.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BzWm_IXp.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Os_yaXt-.js";import"./VisuallyHidden-Cd7_xZHo.js";import"./PopperContent-CeEbOoWX.js";import"./index-E8S-vfjq.js";import"./circle-alert-VjwGmEyY.js";import"./map-pin-9xqBHUrI.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-CjMmW5fl.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-nxzX4U3P.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-D2f7lX-5.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DQ4SyRm2.js";import"./users-C3Sf9FM4.js";import"./vote-B1OhdZRu.js";import"./file-text-BVkT7trW.js";import"./calendar-BhQnpxaC.js";import"./briefcase-_l6bVYfj.js";import"./megaphone-CSKz-P1T.js";import"./user-check-DAYhf5V0.js";import"./external-link-D8smFMAE.js";import"./panel-left-D-Xnf09n.js";import"./index-CBG0Dxc6.js";import"./check-Coe3h_QS.js";import"./index-BWb2ElnP.js";import"./nullish-CHIgUVhi.js";import"./VisuallyHiddenInput-Dv1Uxz5I.js";import"./loader-circle-CXxpg-3P.js";import"./upload-C6aDKbIK.js";const se={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ae={class:"flex items-center justify-between"},ie={class:"grid gap-4 md:grid-cols-2"},de={key:0,class:"text-sm text-red-600 mt-1"},le={key:0,class:"text-sm text-red-600 mt-1"},ne={key:0,class:"text-sm text-red-600 mt-1"},ue={key:0,class:"text-sm text-red-600 mt-1"},me={key:0,class:"text-sm text-red-600 mt-1"},pe={class:"grid gap-4 md:grid-cols-2"},fe={key:0,class:"text-sm text-red-600 mt-1"},ce={key:0,class:"text-sm text-red-600 mt-1"},_e={class:"space-y-4"},ve={key:0},xe={class:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-4"},ge={class:"flex-1"},ye={key:0,class:"text-sm text-muted-foreground"},be={key:1,class:"text-xs text-blue-600"},ke={key:0,class:"text-sm text-red-600 mt-1"},we={key:1},Ve={class:"p-3 bg-muted rounded-md"},Ue={key:0,class:"space-y-1"},$e={key:1,class:"text-sm font-medium"},Ce={key:0,class:"text-sm text-red-600 mt-1"},Se={class:"flex items-center space-x-2"},Ae={key:0,class:"text-sm text-red-600 mt-2"},De={class:"flex items-center justify-end space-x-2"},So=J({__name:"Edit",props:{user:{},cargos:{},roles:{},canAssignRoles:{type:Boolean}},setup(j){var A;const m=j,R=[{title:"Admin",href:"/admin/dashboard"},{title:"Usuarios",href:"/admin/usuarios"},{title:"Editar Usuario",href:"#"}],G=((A=m.user.roles)==null?void 0:A.map(l=>l.id))||[],r=L({name:m.user.name,email:m.user.email,password:"",password_confirmation:"",role_ids:G,cargo_id:m.user.cargo_id?m.user.cargo_id.toString():"none",documento_identidad:m.user.documento_identidad||"",telefono:m.user.telefono||"",direccion:m.user.direccion||"",territorio_id:m.user.territorio_id||null,departamento_id:m.user.departamento_id||null,municipio_id:m.user.municipio_id||null,localidad_id:m.user.localidad_id||null,activo:m.user.activo}),S=N({territorio_id:m.user.territorio_id||void 0,departamento_id:m.user.departamento_id||void 0,municipio_id:m.user.municipio_id||void 0,localidad_id:m.user.localidad_id||void 0}),z=l=>{S.value=l,r.territorio_id=l.territorio_id||null,r.departamento_id=l.departamento_id||null,r.municipio_id=l.municipio_id||null,r.localidad_id=l.localidad_id||null},F=()=>{r.put(route("admin.usuarios.update",m.user.id))},U=N(m.user.avatar_url),M=async l=>{const o=new FormData;o.append("avatar",l);try{const a=await E.post(route("admin.usuarios.avatar.upload",m.user.id),o,{headers:{"Content-Type":"multipart/form-data"}});a.data.success&&(U.value=a.data.avatar_url,V.success("Avatar actualizado correctamente"))}catch(a){console.error("Error uploading avatar:",a),V.error("No se pudo cargar el avatar")}},T=async()=>{try{const l=await E.delete(route("admin.usuarios.avatar.delete",m.user.id));l.data.success&&(U.value=l.data.avatar_url,V.success("Avatar eliminado correctamente"))}catch(l){console.error("Error deleting avatar:",l),V.error("No se pudo eliminar el avatar")}};return(l,o)=>(n(),u(x,null,[t(e(O),{title:"Editar Usuario"}),t(q,{breadcrumbs:R},{default:s(()=>[i("div",se,[i("div",ae,[o[10]||(o[10]=i("div",null,[i("h1",{class:"text-3xl font-bold tracking-tight"},"Editar Usuario"),i("p",{class:"text-muted-foreground"}," Modifica la información del usuario ")],-1)),t(e(B),{href:l.route("admin.usuarios.index")},{default:s(()=>[t(e(C),{variant:"outline"},{default:s(()=>[t(e(re),{class:"mr-2 h-4 w-4"}),o[9]||(o[9]=d(" Volver ",-1))]),_:1})]),_:1},8,["href"])]),i("form",{onSubmit:W(F,["prevent"]),class:"space-y-6"},[t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...o[11]||(o[11]=[d("Foto de Perfil",-1)])]),_:1}),t(e(w),null,{default:s(()=>[...o[12]||(o[12]=[d(" Avatar personalizado del usuario ",-1)])]),_:1})]),_:1}),t(e(k),null,{default:s(()=>[t(oe,{"model-value":U.value,"user-name":e(r).name,label:"Avatar del usuario",description:"Sube una foto de perfil para el usuario. JPG, PNG o WEBP. Máximo 5MB.",onUpload:M,onDelete:T},null,8,["model-value","user-name"])]),_:1})]),_:1}),t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...o[13]||(o[13]=[d("Información Básica",-1)])]),_:1}),t(e(w),null,{default:s(()=>[...o[14]||(o[14]=[d(" Datos principales del usuario ",-1)])]),_:1})]),_:1}),t(e(k),{class:"space-y-4"},{default:s(()=>[i("div",ie,[i("div",null,[t(e(c),{for:"name"},{default:s(()=>[...o[15]||(o[15]=[d("Nombre completo *",-1)])]),_:1}),t(e(v),{id:"name",modelValue:e(r).name,"onUpdate:modelValue":o[0]||(o[0]=a=>e(r).name=a),type:"text",placeholder:"Juan Pérez",class:_({"border-red-500":e(r).errors.name})},null,8,["modelValue","class"]),e(r).errors.name?(n(),u("p",de,p(e(r).errors.name),1)):f("",!0)]),i("div",null,[t(e(c),{for:"email"},{default:s(()=>[...o[16]||(o[16]=[d("Correo electrónico *",-1)])]),_:1}),t(e(v),{id:"email",modelValue:e(r).email,"onUpdate:modelValue":o[1]||(o[1]=a=>e(r).email=a),type:"email",placeholder:"juan@ejemplo.com",class:_({"border-red-500":e(r).errors.email})},null,8,["modelValue","class"]),e(r).errors.email?(n(),u("p",le,p(e(r).errors.email),1)):f("",!0)]),i("div",null,[t(e(c),{for:"documento_identidad"},{default:s(()=>[...o[17]||(o[17]=[d("Documento de identidad",-1)])]),_:1}),t(e(v),{id:"documento_identidad",modelValue:e(r).documento_identidad,"onUpdate:modelValue":o[2]||(o[2]=a=>e(r).documento_identidad=a),type:"text",placeholder:"12345678",class:_({"border-red-500":e(r).errors.documento_identidad})},null,8,["modelValue","class"]),e(r).errors.documento_identidad?(n(),u("p",ne,p(e(r).errors.documento_identidad),1)):f("",!0)]),i("div",null,[t(e(c),{for:"telefono"},{default:s(()=>[...o[18]||(o[18]=[d("Teléfono",-1)])]),_:1}),t(e(v),{id:"telefono",modelValue:e(r).telefono,"onUpdate:modelValue":o[3]||(o[3]=a=>e(r).telefono=a),type:"tel",placeholder:"3001234567",class:_({"border-red-500":e(r).errors.telefono})},null,8,["modelValue","class"]),e(r).errors.telefono?(n(),u("p",ue,p(e(r).errors.telefono),1)):f("",!0)])]),i("div",null,[t(e(c),{for:"direccion"},{default:s(()=>[...o[19]||(o[19]=[d("Dirección",-1)])]),_:1}),t(e(v),{id:"direccion",modelValue:e(r).direccion,"onUpdate:modelValue":o[4]||(o[4]=a=>e(r).direccion=a),type:"text",placeholder:"Calle 123 #45-67",class:_({"border-red-500":e(r).errors.direccion})},null,8,["modelValue","class"]),e(r).errors.direccion?(n(),u("p",me,p(e(r).errors.direccion),1)):f("",!0)])]),_:1})]),_:1}),t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...o[20]||(o[20]=[d("Seguridad",-1)])]),_:1}),t(e(w),null,{default:s(()=>[...o[21]||(o[21]=[d(" Configuración de acceso y contraseña ",-1)])]),_:1})]),_:1}),t(e(k),{class:"space-y-4"},{default:s(()=>[o[31]||(o[31]=i("div",{class:"p-4 bg-muted rounded-lg mb-4"},[i("p",{class:"text-sm text-muted-foreground"}," Deja los campos de contraseña vacíos si no deseas cambiarla. ")],-1)),i("div",pe,[i("div",null,[t(e(c),{for:"password"},{default:s(()=>[...o[22]||(o[22]=[d("Nueva contraseña",-1)])]),_:1}),t(e(v),{id:"password",modelValue:e(r).password,"onUpdate:modelValue":o[5]||(o[5]=a=>e(r).password=a),type:"password",placeholder:"••••••••",class:_({"border-red-500":e(r).errors.password})},null,8,["modelValue","class"]),e(r).errors.password?(n(),u("p",fe,p(e(r).errors.password),1)):f("",!0)]),i("div",null,[t(e(c),{for:"password_confirmation"},{default:s(()=>[...o[23]||(o[23]=[d("Confirmar nueva contraseña",-1)])]),_:1}),t(e(v),{id:"password_confirmation",modelValue:e(r).password_confirmation,"onUpdate:modelValue":o[6]||(o[6]=a=>e(r).password_confirmation=a),type:"password",placeholder:"••••••••",class:_({"border-red-500":e(r).errors.password_confirmation})},null,8,["modelValue","class"]),e(r).errors.password_confirmation?(n(),u("p",ce,p(e(r).errors.password_confirmation),1)):f("",!0)])]),i("div",_e,[l.canAssignRoles?(n(),u("div",ve,[t(e(c),null,{default:s(()=>[...o[24]||(o[24]=[d("Roles del usuario *",-1)])]),_:1}),o[25]||(o[25]=i("p",{class:"text-sm text-muted-foreground mb-3"}," Selecciona uno o más roles para este usuario ",-1)),i("div",xe,[(n(!0),u(x,null,$(l.roles,a=>(n(),u("div",{key:a.value,class:"flex items-start space-x-3 py-2"},[t(e(Z),{id:`role-${a.value}`,checked:e(r).role_ids.includes(a.value),"onUpdate:checked":I=>{if(I)e(r).role_ids.includes(a.value)||e(r).role_ids.push(a.value);else{const D=e(r).role_ids.indexOf(a.value);D>-1&&e(r).role_ids.splice(D,1)}}},null,8,["id","checked","onUpdate:checked"]),i("div",ge,[t(e(c),{for:`role-${a.value}`,class:"text-base font-medium cursor-pointer"},{default:s(()=>[d(p(a.label),1)]),_:2},1032,["for"]),a.description?(n(),u("p",ye,p(a.description),1)):f("",!0),a.is_system?(n(),u("span",be," (Rol del Sistema) ")):f("",!0)])]))),128))]),e(r).errors.role_ids?(n(),u("p",ke,p(e(r).errors.role_ids),1)):f("",!0)])):(n(),u("div",we,[t(e(c),null,{default:s(()=>[...o[26]||(o[26]=[d("Roles actuales",-1)])]),_:1}),i("div",Ve,[l.user.roles&&l.user.roles.length>0?(n(),u("div",Ue,[(n(!0),u(x,null,$(l.user.roles,a=>(n(),u("p",{key:a.id,class:"text-sm font-medium"}," • "+p(a.display_name||a.name),1))),128))])):(n(),u("p",$e," Sin roles asignados ")),o[27]||(o[27]=i("p",{class:"text-xs text-muted-foreground mt-2"}," No tienes permisos para cambiar los roles de este usuario ",-1))])])),i("div",null,[t(e(c),{for:"cargo_id"},{default:s(()=>[...o[28]||(o[28]=[d("Cargo",-1)])]),_:1}),t(e(H),{modelValue:e(r).cargo_id,"onUpdate:modelValue":o[7]||(o[7]=a=>e(r).cargo_id=a)},{default:s(()=>[t(e(K),{class:_({"border-red-500":e(r).errors.cargo_id})},{default:s(()=>[t(e(Q),{placeholder:"Selecciona un cargo"})]),_:1},8,["class"]),t(e(X),null,{default:s(()=>[t(e(P),{value:"none"},{default:s(()=>[...o[29]||(o[29]=[d("Sin cargo",-1)])]),_:1}),(n(!0),u(x,null,$(l.cargos,a=>(n(),h(e(P),{key:a.id,value:a.id.toString()},{default:s(()=>[d(p(a.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(r).errors.cargo_id?(n(),u("p",Ce,p(e(r).errors.cargo_id),1)):f("",!0)])]),i("div",Se,[t(e(Y),{id:"activo",checked:e(r).activo,"onUpdate:checked":o[8]||(o[8]=a=>e(r).activo=a)},null,8,["checked"]),t(e(c),{for:"activo"},{default:s(()=>[...o[30]||(o[30]=[d("Usuario activo",-1)])]),_:1})])]),_:1})]),_:1}),t(e(g),null,{default:s(()=>[t(e(y),null,{default:s(()=>[t(e(b),null,{default:s(()=>[...o[32]||(o[32]=[d("Ubicación Geográfica",-1)])]),_:1}),t(e(w),null,{default:s(()=>[...o[33]||(o[33]=[d(" Define la ubicación del usuario (opcional) ",-1)])]),_:1})]),_:1}),t(e(k),null,{default:s(()=>[t(ee,{"model-value":S.value,"onUpdate:modelValue":z,mode:"single","show-card":!1,title:"",description:""},null,8,["model-value"]),e(r).errors.territorio_id||e(r).errors.departamento_id||e(r).errors.municipio_id||e(r).errors.localidad_id?(n(),u("div",Ae,p(e(r).errors.territorio_id||e(r).errors.departamento_id||e(r).errors.municipio_id||e(r).errors.localidad_id),1)):f("",!0)]),_:1})]),_:1}),i("div",De,[t(e(B),{href:l.route("admin.usuarios.index")},{default:s(()=>[t(e(C),{variant:"outline",type:"button"},{default:s(()=>[...o[34]||(o[34]=[d(" Cancelar ",-1)])]),_:1})]),_:1},8,["href"]),t(e(C),{type:"submit",disabled:e(r).processing},{default:s(()=>[t(e(te),{class:"mr-2 h-4 w-4"}),o[35]||(o[35]=d(" Guardar Cambios ",-1))]),_:1},8,["disabled"])])],32)])]),_:1})],64))}});export{So as default};
