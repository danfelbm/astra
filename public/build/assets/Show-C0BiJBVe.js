import{d as te,M as oe,r as P,c as L,b as v,w as d,e as o,g as t,f as s,q as ae,h as r,t as n,n as b,i as c,j as u,m as l,F as j,k as D,s as N}from"./app-BN8Ry2Uz.js";import{_ as ie}from"./UserLayout.vue_vue_type_script_setup_true_lang-knwPKXlS.js";import{_ as q,a as G,b as I,c as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-DHiq7Fn8.js";import{_ as K}from"./CardDescription.vue_vue_type_script_setup_true_lang-4IFm8shT.js";import{_ as g}from"./createLucideIcon-DkYFWMj7.js";import{_ as k}from"./index-Ptla8SE3.js";import{_ as le}from"./Progress.vue_vue_type_script_setup_true_lang-B-7dTcWw.js";import{_ as O}from"./Textarea.vue_vue_type_script_setup_true_lang-DHjrk2pc.js";import{_ as ne,a as re}from"./index-k7zhBJqM.js";import{u as de}from"./useToast-uWlZtbhA.js";import{A as ce}from"./arrow-left-_I-YQgV0.js";import{C as $}from"./calendar-CUMe5TgZ.js";import{C as S}from"./clock-2h7tSteh.js";import{U as V}from"./user-DIAUTLlT.js";import{C as Q}from"./circle-alert-CW-wP0pq.js";import{C as U}from"./chevron-right-BiE_jqy-.js";import{C as B}from"./SelectValue.vue_vue_type_script_setup_true_lang-CJGv1M4B.js";import{C as E}from"./circle-check-big-B6JBnWxu.js";import{F as me}from"./file-text-dm4ZpMmY.js";import{f as W,e as X}from"./es-BDPlFIsO.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BrRSTFu1.js";import"./index-BDCrv6lm.js";import"./floating-ui.vue-D4rwglXX.js";import"./x-BFmIeg5D.js";import"./Input.vue_vue_type_script_setup_true_lang-DYDC1lYY.js";import"./index-ZlaPHUAE.js";import"./index-YthOG16x.js";import"./shield-C1_DXaFv.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CsMtHAMH.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BSTuZ3SV.js";import"./VisuallyHidden-C1zWs8BH.js";import"./Label.vue_vue_type_script_setup_true_lang-BCztf1NB.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DQgqwjvD.js";import"./index-ldW_JwnJ.js";import"./map-pin-CAp2k_Xq.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-C40c5JX9.js";import"./usePermissions-DD7FxqCl.js";import"./square-check-big-pc6tydLB.js";import"./users-CcMEhXu_.js";import"./folder-open-XAGZLVxS.js";import"./index-Dr9R6Oz5.js";import"./check-C7lL3vIK.js";const ue={class:"space-y-6"},pe={class:"flex items-center gap-4"},fe={class:"flex items-start justify-between"},he={class:"space-y-2"},_e={key:0},ve={class:"text-sm text-muted-foreground"},ge={class:"flex items-center justify-between mb-2"},xe={class:"text-sm font-medium"},ye={class:"text-sm text-muted-foreground mt-2"},ke={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},we={class:"space-y-1"},Ce={class:"text-sm text-muted-foreground flex items-center gap-1"},be={class:"text-sm font-medium"},$e={class:"space-y-1"},Ve={class:"text-sm text-muted-foreground flex items-center gap-1"},Ee={class:"text-sm font-medium"},ze={class:"space-y-1"},Me={class:"text-sm text-muted-foreground flex items-center gap-1"},Pe={class:"space-y-1"},je={class:"text-sm text-muted-foreground flex items-center gap-1"},De={class:"text-sm font-medium"},Ne={key:1,class:"mt-4"},Se={class:"space-y-6"},Ue={key:0},Be={class:"font-semibold mb-3 flex items-center gap-2"},Te={class:"space-y-2"},Fe={class:"flex items-start justify-between"},Ae={class:"flex-1 space-y-2"},He={class:"flex items-center gap-2"},Re={class:"font-medium"},Le={key:0,class:"ml-6 space-y-3"},qe={key:0,class:"text-sm text-muted-foreground"},Ge={class:"flex items-center gap-4 text-sm text-muted-foreground"},Ie={class:"flex items-center gap-1"},Je={key:0,class:"flex items-center gap-1"},Ke={key:1,class:"border-t pt-3 space-y-2"},Oe={class:"flex gap-2"},Qe={key:1},We={class:"font-semibold mb-3 flex items-center gap-2"},Xe={class:"space-y-2"},Ye={class:"flex items-start justify-between"},Ze={class:"flex-1 space-y-2"},es={class:"flex items-center gap-2"},ss={class:"font-medium"},ts={key:0,class:"ml-6 space-y-3"},os={key:0,class:"text-sm text-muted-foreground"},as={class:"flex items-center gap-4 text-sm text-muted-foreground"},is={class:"flex items-center gap-1"},ls={key:0,class:"flex items-center gap-1"},ns={key:1,class:"border-t pt-3 space-y-2"},rs={key:2},ds={class:"font-semibold mb-3 flex items-center gap-2"},cs={class:"space-y-2"},ms={class:"flex items-start justify-between"},us={class:"flex-1 space-y-2"},ps={class:"flex items-center gap-2"},fs={class:"font-medium line-through text-muted-foreground"},hs={key:0,class:"ml-6 space-y-2 text-sm text-muted-foreground"},_s={key:0},vs={class:"flex items-center gap-4"},gs={class:"flex items-center gap-1"},xs={key:0,class:"flex items-center gap-1"},ys={key:1,class:"italic"},ks={key:3,class:"text-center py-8"},ct=te({__name:"Show",props:{hito:{},canComplete:{type:Boolean},canUpdateProgress:{type:Boolean}},setup(m){const f=m;oe();const{success:T,error:F}=de(),_=P({}),x=P({}),y=P({}),z=i=>{_.value[i]=!_.value[i]},A=i=>{y.value[i.id]||(y.value[i.id]=!0,N.post(route("user.mis-hitos.completar",{hito:f.hito.id,entregable:i.id}),{notas:x.value[i.id]||""},{preserveScroll:!0,onSuccess:()=>{T("Entregable marcado como completado"),x.value[i.id]="",y.value[i.id]=!1},onError:()=>{F("Error al completar el entregable"),y.value[i.id]=!1}}))},Y=(i,a)=>{f.canUpdateProgress&&N.put(route("user.mis-hitos.actualizar-estado",{hito:f.hito.id,entregable:i.id}),{estado:a},{preserveScroll:!0,onSuccess:()=>{T("Estado actualizado correctamente")},onError:()=>{F("Error al actualizar el estado")}})},Z=()=>{N.visit(route("user.mis-hitos.index"))},w=i=>i?W(new Date(i),"dd MMM yyyy",{locale:X}):"No definida",ee=i=>i?W(new Date(i),"dd MMM yyyy 'a las' HH:mm",{locale:X}):"No definida",se=i=>({pendiente:"bg-gray-100 text-gray-800",en_progreso:"bg-blue-100 text-blue-800",completado:"bg-green-100 text-green-800",cancelado:"bg-red-100 text-red-800"})[i]||"bg-gray-100 text-gray-800",H=i=>({baja:"bg-gray-100 text-gray-600",media:"bg-yellow-100 text-yellow-800",alta:"bg-red-100 text-red-800"})[i]||"bg-gray-100 text-gray-600",M=i=>{if(!i)return null;const a=Math.ceil((new Date(i).getTime()-new Date().getTime())/(1e3*60*60*24));return a<0?`Vencido hace ${Math.abs(a)} días`:a===0?"Vence hoy":a===1?"Vence mañana":`${a} días restantes`},h=L(()=>f.hito.entregables?{pendientes:f.hito.entregables.filter(i=>i.estado==="pendiente"),en_progreso:f.hito.entregables.filter(i=>i.estado==="en_progreso"),completados:f.hito.entregables.filter(i=>i.estado==="completado")}:{pendientes:[],en_progreso:[],completados:[]}),C=L(()=>{if(!f.hito.entregables)return{total:0,completados:0,porcentaje:0};const i=f.hito.entregables.length,a=f.hito.entregables.filter(p=>p.estado==="completado").length,e=i>0?Math.round(a/i*100):0;return{total:i,completados:a,porcentaje:e}});return(i,a)=>(l(),v(ie,null,{default:d(()=>[o(s(ae),{title:`Hito: ${m.hito.nombre}`},null,8,["title"]),t("div",ue,[t("div",pe,[o(s(g),{onClick:Z,variant:"ghost",size:"sm",class:"gap-2"},{default:d(()=>[o(s(ce),{class:"h-4 w-4"}),a[0]||(a[0]=r(" Volver a Mis Hitos ",-1))]),_:1})]),o(s(q),null,{default:d(()=>[o(s(G),null,{default:d(()=>[t("div",fe,[t("div",he,[o(s(I),{class:"text-2xl"},{default:d(()=>[r(n(m.hito.nombre),1)]),_:1}),o(s(K),null,{default:d(()=>{var e;return[r(" Proyecto: "+n(((e=m.hito.proyecto)==null?void 0:e.nombre)||"Sin proyecto"),1)]}),_:1})]),o(s(k),{class:b([se(m.hito.estado),"ml-4"])},{default:d(()=>[r(n(m.hito.estado),1)]),_:1},8,["class"])])]),_:1}),o(s(J),{class:"space-y-6"},{default:d(()=>{var e,p,R;return[m.hito.descripcion?(l(),c("div",_e,[a[1]||(a[1]=t("h3",{class:"font-semibold mb-2"},"Descripción",-1)),t("p",ve,n(m.hito.descripcion),1)])):u("",!0),t("div",null,[t("div",ge,[a[2]||(a[2]=t("h3",{class:"font-semibold"},"Progreso General",-1)),t("span",xe,n(C.value.porcentaje)+"%",1)]),o(s(le),{value:C.value.porcentaje,class:"h-2"},null,8,["value"]),t("p",ye,n(C.value.completados)+" de "+n(C.value.total)+" entregables completados ",1)]),t("div",ke,[t("div",we,[t("p",Ce,[o(s($),{class:"h-4 w-4"}),a[3]||(a[3]=r(" Fecha de Inicio ",-1))]),t("p",be,n(w(m.hito.fecha_inicio)),1)]),t("div",$e,[t("p",Ve,[o(s($),{class:"h-4 w-4"}),a[4]||(a[4]=r(" Fecha de Fin ",-1))]),t("p",Ee,n(w(m.hito.fecha_fin)),1)]),t("div",ze,[t("p",Me,[o(s(S),{class:"h-4 w-4"}),a[5]||(a[5]=r(" Tiempo Restante ",-1))]),t("p",{class:b(["text-sm font-medium",{"text-red-600":m.hito.estado!=="completado"&&((e=M(m.hito.fecha_fin))==null?void 0:e.includes("Vencido"))}])},n(M(m.hito.fecha_fin)||"Sin fecha límite"),3)]),t("div",Pe,[t("p",je,[o(s(V),{class:"h-4 w-4"}),a[6]||(a[6]=r(" Responsable ",-1))]),t("p",De,n(((p=m.hito.responsable)==null?void 0:p.name)||"Sin responsable"),1)])]),(R=M(m.hito.fecha_fin))!=null&&R.includes("Vencido")&&m.hito.estado!=="completado"?(l(),c("div",Ne,[o(s(ne),{variant:"destructive"},{default:d(()=>[o(s(Q),{class:"h-4 w-4"}),o(s(re),null,{default:d(()=>[...a[7]||(a[7]=[r(" Este hito está vencido. Por favor, actualiza su estado o contacta a tu supervisor. ",-1)])]),_:1})]),_:1})])):u("",!0)]}),_:1})]),_:1}),o(s(q),null,{default:d(()=>[o(s(G),null,{default:d(()=>[o(s(I),null,{default:d(()=>[...a[8]||(a[8]=[r("Entregables",-1)])]),_:1}),o(s(K),null,{default:d(()=>[...a[9]||(a[9]=[r(" Lista de entregables asociados a este hito ",-1)])]),_:1})]),_:1}),o(s(J),null,{default:d(()=>[t("div",Se,[h.value.pendientes.length>0?(l(),c("div",Ue,[t("h3",Be,[o(s(Q),{class:"h-5 w-5 text-yellow-600"}),r(" Pendientes ("+n(h.value.pendientes.length)+") ",1)]),t("div",Te,[(l(!0),c(j,null,D(h.value.pendientes,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 hover:bg-gray-50 transition-colors"},[t("div",Fe,[t("div",Ae,[t("div",He,[o(s(g),{onClick:p=>z(e.id),variant:"ghost",size:"sm",class:"p-0 h-auto"},{default:d(()=>[_.value[e.id]?(l(),v(s(B),{key:1,class:"h-4 w-4"})):(l(),v(s(U),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),t("h4",Re,n(e.nombre),1),o(s(k),{class:b(H(e.prioridad)),variant:"outline"},{default:d(()=>[r(n(e.prioridad),1)]),_:2},1032,["class"])]),_.value[e.id]?(l(),c("div",Le,[e.descripcion?(l(),c("p",qe,n(e.descripcion),1)):u("",!0),t("div",Ge,[t("span",Ie,[o(s($),{class:"h-3 w-3"}),r(" Vence: "+n(w(e.fecha_fin)),1)]),e.responsable?(l(),c("span",Je,[o(s(V),{class:"h-3 w-3"}),r(" "+n(e.responsable.name),1)])):u("",!0)]),m.canComplete?(l(),c("div",Ke,[o(s(O),{modelValue:x.value[e.id],"onUpdate:modelValue":p=>x.value[e.id]=p,placeholder:"Notas al completar (opcional)...",class:"text-sm",rows:"2"},null,8,["modelValue","onUpdate:modelValue"]),t("div",Oe,[o(s(g),{onClick:p=>A(e),disabled:y.value[e.id],size:"sm",class:"gap-2"},{default:d(()=>[o(s(E),{class:"h-4 w-4"}),a[10]||(a[10]=r(" Marcar como Completado ",-1))]),_:1},8,["onClick","disabled"]),m.canUpdateProgress?(l(),v(s(g),{key:0,onClick:p=>Y(e,"en_progreso"),variant:"outline",size:"sm",class:"gap-2"},{default:d(()=>[o(s(S),{class:"h-4 w-4"}),a[11]||(a[11]=r(" En Progreso ",-1))]),_:1},8,["onClick"])):u("",!0)])])):u("",!0)])):u("",!0)])])]))),128))])])):u("",!0),h.value.en_progreso.length>0?(l(),c("div",Qe,[t("h3",We,[o(s(S),{class:"h-5 w-5 text-blue-600"}),r(" En Progreso ("+n(h.value.en_progreso.length)+") ",1)]),t("div",Xe,[(l(!0),c(j,null,D(h.value.en_progreso,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 hover:bg-gray-50 transition-colors"},[t("div",Ye,[t("div",Ze,[t("div",es,[o(s(g),{onClick:p=>z(e.id),variant:"ghost",size:"sm",class:"p-0 h-auto"},{default:d(()=>[_.value[e.id]?(l(),v(s(B),{key:1,class:"h-4 w-4"})):(l(),v(s(U),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),t("h4",ss,n(e.nombre),1),o(s(k),{class:b(H(e.prioridad)),variant:"outline"},{default:d(()=>[r(n(e.prioridad),1)]),_:2},1032,["class"]),o(s(k),{class:"bg-blue-100 text-blue-800"},{default:d(()=>[...a[12]||(a[12]=[r(" En Progreso ",-1)])]),_:1})]),_.value[e.id]?(l(),c("div",ts,[e.descripcion?(l(),c("p",os,n(e.descripcion),1)):u("",!0),t("div",as,[t("span",is,[o(s($),{class:"h-3 w-3"}),r(" Vence: "+n(w(e.fecha_fin)),1)]),e.responsable?(l(),c("span",ls,[o(s(V),{class:"h-3 w-3"}),r(" "+n(e.responsable.name),1)])):u("",!0)]),m.canComplete?(l(),c("div",ns,[o(s(O),{modelValue:x.value[e.id],"onUpdate:modelValue":p=>x.value[e.id]=p,placeholder:"Notas al completar (opcional)...",class:"text-sm",rows:"2"},null,8,["modelValue","onUpdate:modelValue"]),o(s(g),{onClick:p=>A(e),disabled:y.value[e.id],size:"sm",class:"gap-2"},{default:d(()=>[o(s(E),{class:"h-4 w-4"}),a[13]||(a[13]=r(" Marcar como Completado ",-1))]),_:1},8,["onClick","disabled"])])):u("",!0)])):u("",!0)])])]))),128))])])):u("",!0),h.value.completados.length>0?(l(),c("div",rs,[t("h3",ds,[o(s(E),{class:"h-5 w-5 text-green-600"}),r(" Completados ("+n(h.value.completados.length)+") ",1)]),t("div",cs,[(l(!0),c(j,null,D(h.value.completados,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 bg-green-50/50"},[t("div",ms,[t("div",us,[t("div",ps,[o(s(g),{onClick:p=>z(e.id),variant:"ghost",size:"sm",class:"p-0 h-auto"},{default:d(()=>[_.value[e.id]?(l(),v(s(B),{key:1,class:"h-4 w-4"})):(l(),v(s(U),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),t("h4",fs,n(e.nombre),1),o(s(k),{class:"bg-green-100 text-green-800"},{default:d(()=>[...a[14]||(a[14]=[r(" Completado ",-1)])]),_:1})]),_.value[e.id]?(l(),c("div",hs,[e.descripcion?(l(),c("p",_s,n(e.descripcion),1)):u("",!0),t("div",vs,[t("span",gs,[o(s(E),{class:"h-3 w-3"}),r(" Completado: "+n(ee(e.completado_at)),1)]),e.completado_por_usuario?(l(),c("span",xs,[o(s(V),{class:"h-3 w-3"}),r(" Por: "+n(e.completado_por_usuario.name),1)])):u("",!0)]),e.notas_completado?(l(),c("p",ys," Notas: "+n(e.notas_completado),1)):u("",!0)])):u("",!0)])])]))),128))])])):u("",!0),!m.hito.entregables||m.hito.entregables.length===0?(l(),c("div",ks,[o(s(me),{class:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),a[15]||(a[15]=t("p",{class:"text-muted-foreground"},"No hay entregables asignados a este hito",-1))])):u("",!0)])]),_:1})]),_:1})])]),_:1}))}});export{ct as default};
