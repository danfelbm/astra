import{d as Z,k as F,j as C,o as p,e as n,b as o,f as s,u as a,m as ee,t as m,g as f,l as te,a as g,i as R,F as se,r as ae,W as O}from"./app-CZw07Q93.js";import{_ as oe}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BufzIFuu.js";import{_ as z,a as E,b as N,c as B}from"./CardTitle.vue_vue_type_script_setup_true_lang-BFumUwpC.js";import{_ as Y}from"./CardDescription.vue_vue_type_script_setup_true_lang-DV49e1r_.js";import{_ as T}from"./createLucideIcon-C7u-R01f.js";import{_ as H}from"./index-5Kpx2wY0.js";import{_ as re}from"./Textarea.vue_vue_type_script_setup_true_lang-AZwakrj6.js";import{_ as S}from"./Label.vue_vue_type_script_setup_true_lang-BGrzXVeU.js";import{_ as V,a as L}from"./index-C1lK0tto.js";import{_ as ne}from"./Separator.vue_vue_type_script_setup_true_lang-DiyE8dut.js";import{t as U}from"./index-iaJQ5f3g.js";import{U as le}from"./user-BLiZb0Cx.js";import{M as ue}from"./mail-DNbu5yws.js";import{P as de}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BEVl8MTz.js";import{C as X}from"./circle-alert-uWMA2z83.js";import{F as P}from"./file-text-DpdPn_qr.js";import{D as ie}from"./download-BOs-U5a4.js";import{C as ce}from"./calendar-DaONdD9W.js";import{C as me}from"./check-BARXO5K0.js";import{X as fe}from"./x-yvp4rZIx.js";import{t as k,c as pe,n as G,g as W,a as _e,b as ge,m as K,d as $,f as he,e as J}from"./es-BRx6Co7f.js";import{C as ve}from"./circle-x-xWgvaarK.js";import{C as xe}from"./circle-check-big-EP3KWshb.js";import{C as De}from"./clock-B7XkIYej.js";import"./index-4FPB8ZAX.js";import"./floating-ui.vue-DIqzyMHs.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-cyvAynzO.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-wzOSHhwr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-B3e8d-nF.js";import"./chevrons-up-down-BWQ410jx.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-XREYgAdr.js";import"./users-OPdRzPF7.js";import"./shield-CGhRnhVe.js";import"./vote-CjxG5f0n.js";import"./briefcase-DBSLNQSS.js";import"./megaphone-Chp5CTO4.js";import"./user-check-Boz3yurH.js";import"./external-link-CHkPKqnn.js";import"./panel-left-Cu9mKYvu.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-9rRU-lJQ.js";import"./VisuallyHidden-C29Bi-F2.js";import"./Input.vue_vue_type_script_setup_true_lang-DCxWTU2m.js";import"./index-DbmmK8pQ.js";import"./PopperContent-iq8Pmmed.js";import"./nullish-CHIgUVhi.js";import"./index-BdHS3Z4B.js";import"./index-ukOzJdgH.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-C_0q6Kwy.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-4RjFW4ce.js";import"./map-pin-BagcXSc4.js";function j(d,u){const r=+k(d)-+k(u);return r<0?-1:r>0?1:r}function Re(d){return pe(d,Date.now())}function ye(d,u,r){const[c,l]=G(r==null?void 0:r.in,d,u),v=c.getFullYear()-l.getFullYear(),h=c.getMonth()-l.getMonth();return v*12+h}function be(d){return u=>{const c=(d?Math[d]:Math.trunc)(u);return c===0?0:c}}function qe(d,u){return+k(d)-+k(u)}function we(d,u){const r=k(d,u==null?void 0:u.in);return r.setHours(23,59,59,999),r}function Me(d,u){const r=k(d,u==null?void 0:u.in),c=r.getMonth();return r.setFullYear(r.getFullYear(),c+1,0),r.setHours(23,59,59,999),r}function Se(d,u){const r=k(d,u==null?void 0:u.in);return+we(r,u)==+Me(r,u)}function ke(d,u,r){const[c,l,v]=G(r==null?void 0:r.in,d,d,u),h=j(l,v),i=Math.abs(ye(l,v));if(i<1)return 0;l.getMonth()===1&&l.getDate()>27&&l.setDate(30),l.setMonth(l.getMonth()-h*i);let q=j(l,v)===-h;Se(c)&&i===1&&j(c,v)===1&&(q=!1);const w=h*(i-+q);return w===0?0:w}function Ce(d,u,r){const c=qe(d,u)/1e3;return be(r==null?void 0:r.roundingMethod)(c)}function ze(d,u,r){const c=_e(),l=(r==null?void 0:r.locale)??c.locale??ge,v=2520,h=j(d,u);if(isNaN(h))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:h}),[q,w]=G(r==null?void 0:r.in,...h>0?[u,d]:[d,u]),x=Ce(w,q),I=(W(w)-W(q))/1e3,_=Math.round((x-I)/60);let M;if(_<2)return r!=null&&r.includeSeconds?x<5?l.formatDistance("lessThanXSeconds",5,i):x<10?l.formatDistance("lessThanXSeconds",10,i):x<20?l.formatDistance("lessThanXSeconds",20,i):x<40?l.formatDistance("halfAMinute",0,i):x<60?l.formatDistance("lessThanXMinutes",1,i):l.formatDistance("xMinutes",1,i):_===0?l.formatDistance("lessThanXMinutes",1,i):l.formatDistance("xMinutes",_,i);if(_<45)return l.formatDistance("xMinutes",_,i);if(_<90)return l.formatDistance("aboutXHours",1,i);if(_<K){const D=Math.round(_/60);return l.formatDistance("aboutXHours",D,i)}else{if(_<v)return l.formatDistance("xDays",1,i);if(_<$){const D=Math.round(_/K);return l.formatDistance("xDays",D,i)}else if(_<$*2)return M=Math.round(_/$),l.formatDistance("aboutXMonths",M,i)}if(M=ke(w,q),M<12){const D=Math.round(_/$);return l.formatDistance("xMonths",D,i)}else{const D=M%12,A=Math.trunc(M/12);return D<3?l.formatDistance("aboutXYears",A,i):D<9?l.formatDistance("overXYears",A,i):l.formatDistance("almostXYears",A+1,i)}}function Ee(d,u){return ze(d,Re(d),u)}const Ne={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Be={class:"flex items-center justify-between"},Ae={class:"text-3xl font-bold tracking-tight"},Ue={class:"text-muted-foreground"},Fe={class:"grid gap-6 lg:grid-cols-3"},$e={class:"lg:col-span-2 space-y-6"},je={class:"grid grid-cols-2 gap-4"},Ie={class:"font-semibold"},Te={class:"font-semibold"},Xe={class:"font-semibold"},Ge={class:"font-semibold"},Oe={key:0,class:"space-y-4"},Ye={key:0,class:"flex items-start gap-3"},He={class:"flex-1 space-y-2"},Ve={class:"grid gap-2"},Le={class:"flex items-center gap-2"},Pe={class:"font-mono text-sm"},We={class:"flex items-center gap-2"},Ke={class:"font-mono text-sm font-semibold text-green-600"},Je={key:1,class:"flex items-start gap-3"},Qe={class:"flex-1 space-y-2"},Ze={class:"grid gap-2"},et={class:"flex items-center gap-2"},tt={class:"font-mono text-sm"},st={class:"flex items-center gap-2"},at={class:"font-mono text-sm font-semibold text-green-600"},ot={key:1},rt={key:0,class:"space-y-2"},nt={class:"flex items-center gap-3"},lt={class:"font-medium"},ut={class:"text-sm text-muted-foreground"},dt={class:"flex items-center gap-2"},it={key:1},ct={class:"space-y-6"},mt={class:"space-y-4"},ft={class:"flex items-start gap-3"},pt={class:"flex-1"},_t={class:"text-xs text-muted-foreground"},gt={key:0,class:"flex items-start gap-3"},ht={class:"flex-1"},vt={class:"text-xs text-muted-foreground"},xt={key:0,class:"text-xs text-muted-foreground"},Dt={key:1,class:"flex items-start gap-3"},Rt={class:"flex-1"},yt={class:"text-xs text-muted-foreground"},bt={key:0,class:"text-xs text-muted-foreground"},qt={class:"text-sm whitespace-pre-wrap"},wt={class:"space-y-2"},qs=Z({__name:"Show",props:{updateRequest:{}},setup(d){const u=window.route,r=d,c=F(!1),l=F(""),v=F(!1),h=F(!1),i=()=>{if(console.log("[DEBUG] Iniciando aprobación",{id:r.updateRequest.id,notes:l.value,status:r.updateRequest.status}),c.value)return;c.value=!0;const t=u("admin.update-requests.approve",{updateRequest:r.updateRequest.id});console.log("[DEBUG] URL de aprobación:",t),O.post(t,{notes:l.value||""},{preserveState:!1,preserveScroll:!0,onSuccess:e=>{console.log("[DEBUG] Aprobación exitosa",e),U.success("Solicitud aprobada correctamente"),v.value=!1},onError:e=>{console.error("[DEBUG] Error en aprobación:",e),U.error("Error al aprobar la solicitud")},onFinish:()=>{console.log("[DEBUG] Finalizó proceso de aprobación"),c.value=!1}})},q=()=>{if(console.log("[DEBUG] Iniciando rechazo",{id:r.updateRequest.id,notes:l.value,status:r.updateRequest.status}),!l.value.trim()){U.error("Debes proporcionar un motivo para rechazar");return}if(c.value)return;c.value=!0;const t=u("admin.update-requests.reject",{updateRequest:r.updateRequest.id});console.log("[DEBUG] URL de rechazo:",t),O.post(t,{notes:l.value},{preserveState:!1,preserveScroll:!0,onSuccess:e=>{console.log("[DEBUG] Rechazo exitoso",e),U.success("Solicitud rechazada"),h.value=!1},onError:e=>{console.error("[DEBUG] Error en rechazo:",e),U.error("Error al rechazar la solicitud")},onFinish:()=>{console.log("[DEBUG] Finalizó proceso de rechazo"),c.value=!1}})},w=t=>{const e=u("admin.update-requests.download",{updateRequest:r.updateRequest.id,path:t});window.open(e,"_blank")},x=t=>t?he(new Date(t),"dd MMM yyyy HH:mm",{locale:J}):"-",I=t=>Ee(new Date(t),{locale:J,addSuffix:!0}),_=t=>{if(t===0)return"0 Bytes";const e=1024,y=["Bytes","KB","MB"],b=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,b)*100)/100+" "+y[b]},M=t=>{switch(t){case"pending":return"warning";case"approved":return"success";case"rejected":return"destructive";default:return"secondary"}},D=t=>{switch(t){case"pending":return"Pendiente";case"approved":return"Aprobada";case"rejected":return"Rechazada";default:return t}},A=t=>{switch(t){case"pending":return De;case"approved":return xe;case"rejected":return ve;default:return X}};return(t,e)=>(p(),C(oe,null,{default:n(()=>[o(a(ee),{title:`Solicitud #${t.updateRequest.id}`},null,8,["title"]),s("div",Ne,[s("div",Be,[s("div",null,[s("h1",Ae,"Solicitud #"+m(t.updateRequest.id),1),s("p",Ue," Creada "+m(I(t.updateRequest.created_at)),1)]),o(a(H),{variant:M(t.updateRequest.status),class:"text-lg px-4 py-2"},{default:n(()=>[(p(),C(te(A(t.updateRequest.status)),{class:"mr-2 h-4 w-4"})),f(" "+m(D(t.updateRequest.status)),1)]),_:1},8,["variant"])]),s("div",Fe,[s("div",$e,[o(a(z),null,{default:n(()=>[o(a(E),null,{default:n(()=>[o(a(N),{class:"flex items-center gap-2"},{default:n(()=>[o(a(le),{class:"h-5 w-5"}),e[1]||(e[1]=f(" Información del Usuario ",-1))]),_:1})]),_:1}),o(a(B),{class:"space-y-4"},{default:n(()=>[s("div",je,[s("div",null,[o(a(S),{class:"text-muted-foreground"},{default:n(()=>[...e[2]||(e[2]=[f("Nombre",-1)])]),_:1}),s("p",Ie,m(t.updateRequest.user.name),1)]),s("div",null,[o(a(S),{class:"text-muted-foreground"},{default:n(()=>[...e[3]||(e[3]=[f("Documento",-1)])]),_:1}),s("p",Te,m(t.updateRequest.user.documento_identidad),1)]),s("div",null,[o(a(S),{class:"text-muted-foreground"},{default:n(()=>[...e[4]||(e[4]=[f("Email Actual",-1)])]),_:1}),s("p",Xe,m(t.updateRequest.current_email||"-"),1)]),s("div",null,[o(a(S),{class:"text-muted-foreground"},{default:n(()=>[...e[5]||(e[5]=[f("Teléfono Actual",-1)])]),_:1}),s("p",Ge,m(t.updateRequest.current_telefono||"-"),1)])])]),_:1})]),_:1}),o(a(z),null,{default:n(()=>[o(a(E),null,{default:n(()=>[o(a(N),null,{default:n(()=>[...e[6]||(e[6]=[f("Cambios Solicitados",-1)])]),_:1}),o(a(Y),null,{default:n(()=>[f(m(t.updateRequest.has_changes?"Cambios detectados en los siguientes campos":"No hay cambios de datos"),1)]),_:1})]),_:1}),o(a(B),null,{default:n(()=>[t.updateRequest.has_changes?(p(),g("div",Oe,[t.updateRequest.changes_summary.email?(p(),g("div",Ye,[o(a(ue),{class:"h-5 w-5 text-muted-foreground mt-0.5"}),s("div",He,[o(a(S),null,{default:n(()=>[...e[7]||(e[7]=[f("Email",-1)])]),_:1}),s("div",Ve,[s("div",Le,[e[8]||(e[8]=s("span",{class:"text-sm text-muted-foreground"},"Actual:",-1)),s("span",Pe,m(t.updateRequest.changes_summary.email.current||"No registrado"),1)]),s("div",We,[e[9]||(e[9]=s("span",{class:"text-sm text-muted-foreground"},"Nuevo:",-1)),s("span",Ke,m(t.updateRequest.changes_summary.email.new),1)])])])])):R("",!0),t.updateRequest.changes_summary.telefono?(p(),g("div",Je,[o(a(de),{class:"h-5 w-5 text-muted-foreground mt-0.5"}),s("div",Qe,[o(a(S),null,{default:n(()=>[...e[10]||(e[10]=[f("Teléfono",-1)])]),_:1}),s("div",Ze,[s("div",et,[e[11]||(e[11]=s("span",{class:"text-sm text-muted-foreground"},"Actual:",-1)),s("span",tt,m(t.updateRequest.changes_summary.telefono.current||"No registrado"),1)]),s("div",st,[e[12]||(e[12]=s("span",{class:"text-sm text-muted-foreground"},"Nuevo:",-1)),s("span",at,m(t.updateRequest.changes_summary.telefono.new),1)])])])])):R("",!0)])):(p(),g("div",ot,[o(a(V),null,{default:n(()=>[o(a(X),{class:"h-4 w-4"}),o(a(L),null,{default:n(()=>[...e[13]||(e[13]=[f(" Esta solicitud no incluye cambios en los datos de contacto, solo documentación de soporte. ",-1)])]),_:1})]),_:1})]))]),_:1})]),_:1}),o(a(z),null,{default:n(()=>[o(a(E),null,{default:n(()=>[o(a(N),{class:"flex items-center gap-2"},{default:n(()=>[o(a(P),{class:"h-5 w-5"}),e[14]||(e[14]=f(" Documentos de Soporte ",-1))]),_:1}),o(a(Y),null,{default:n(()=>{var y;return[f(m(((y=t.updateRequest.documentos_soporte)==null?void 0:y.length)||0)+" documento(s) adjunto(s) ",1)]}),_:1})]),_:1}),o(a(B),null,{default:n(()=>{var y;return[((y=t.updateRequest.documentos_soporte)==null?void 0:y.length)>0?(p(),g("div",rt,[(p(!0),g(se,null,ae(t.updateRequest.documentos_soporte,(b,Q)=>(p(),g("div",{key:Q,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors"},[s("div",nt,[o(a(P),{class:"h-5 w-5 text-muted-foreground"}),s("div",null,[s("p",lt,m(b.name),1),s("p",ut,m(_(b.size))+" • "+m(b.mime_type),1)])]),s("div",dt,[b.exists?R("",!0):(p(),C(a(H),{key:0,variant:"destructive",class:"text-xs"},{default:n(()=>[...e[15]||(e[15]=[f(" No disponible ",-1)])]),_:1})),b.exists?(p(),C(a(T),{key:1,onClick:Mt=>w(b.path),size:"sm",variant:"outline"},{default:n(()=>[o(a(ie),{class:"h-4 w-4 mr-1"}),e[16]||(e[16]=f(" Descargar ",-1))]),_:2},1032,["onClick"])):R("",!0)])]))),128))])):(p(),g("div",it,[...e[17]||(e[17]=[s("p",{class:"text-sm text-muted-foreground text-center py-4"}," No se adjuntaron documentos ",-1)])]))]}),_:1})]),_:1})]),s("div",ct,[o(a(z),null,{default:n(()=>[o(a(E),null,{default:n(()=>[o(a(N),{class:"flex items-center gap-2"},{default:n(()=>[o(a(ce),{class:"h-5 w-5"}),e[18]||(e[18]=f(" Historial ",-1))]),_:1})]),_:1}),o(a(B),null,{default:n(()=>[s("div",mt,[s("div",ft,[e[20]||(e[20]=s("div",{class:"h-2 w-2 rounded-full bg-blue-500 mt-2"},null,-1)),s("div",pt,[e[19]||(e[19]=s("p",{class:"text-sm font-semibold"},"Solicitud creada",-1)),s("p",_t,m(x(t.updateRequest.created_at)),1)])]),t.updateRequest.approved_at?(p(),g("div",gt,[e[22]||(e[22]=s("div",{class:"h-2 w-2 rounded-full bg-green-500 mt-2"},null,-1)),s("div",ht,[e[21]||(e[21]=s("p",{class:"text-sm font-semibold"},"Aprobada",-1)),s("p",vt,m(x(t.updateRequest.approved_at)),1),t.updateRequest.admin?(p(),g("p",xt," Por: "+m(t.updateRequest.admin.name),1)):R("",!0)])])):R("",!0),t.updateRequest.rejected_at?(p(),g("div",Dt,[e[24]||(e[24]=s("div",{class:"h-2 w-2 rounded-full bg-red-500 mt-2"},null,-1)),s("div",Rt,[e[23]||(e[23]=s("p",{class:"text-sm font-semibold"},"Rechazada",-1)),s("p",yt,m(x(t.updateRequest.rejected_at)),1),t.updateRequest.admin?(p(),g("p",bt," Por: "+m(t.updateRequest.admin.name),1)):R("",!0)])])):R("",!0)])]),_:1})]),_:1}),t.updateRequest.admin_notes?(p(),C(a(z),{key:0},{default:n(()=>[o(a(E),null,{default:n(()=>[o(a(N),null,{default:n(()=>[...e[25]||(e[25]=[f("Notas del Administrador",-1)])]),_:1})]),_:1}),o(a(B),null,{default:n(()=>[s("p",qt,m(t.updateRequest.admin_notes),1)]),_:1})]),_:1})):R("",!0),t.updateRequest.status==="pending"?(p(),C(a(z),{key:1},{default:n(()=>[o(a(E),null,{default:n(()=>[o(a(N),null,{default:n(()=>[...e[26]||(e[26]=[f("Acciones",-1)])]),_:1})]),_:1}),o(a(B),{class:"space-y-4"},{default:n(()=>[s("div",null,[o(a(S),{for:"notes"},{default:n(()=>[...e[27]||(e[27]=[f("Notas (opcional)",-1)])]),_:1}),o(a(re),{id:"notes",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=y=>l.value=y),placeholder:"Agregar notas sobre esta decisión...",rows:"3",class:"mt-1"},null,8,["modelValue"])]),o(a(ne)),s("div",wt,[o(a(T),{onClick:i,disabled:c.value,class:"w-full",variant:"default"},{default:n(()=>[o(a(me),{class:"mr-2 h-4 w-4"}),e[28]||(e[28]=f(" Aprobar Solicitud ",-1))]),_:1},8,["disabled"]),o(a(T),{onClick:q,disabled:c.value,class:"w-full",variant:"destructive"},{default:n(()=>[o(a(fe),{class:"mr-2 h-4 w-4"}),e[29]||(e[29]=f(" Rechazar Solicitud ",-1))]),_:1},8,["disabled"])]),o(a(V),null,{default:n(()=>[o(a(X),{class:"h-4 w-4"}),o(a(L),null,{default:n(()=>[f(m(t.updateRequest.has_changes?"Al aprobar, los datos del usuario serán actualizados automáticamente.":"Esta solicitud solo actualiza el estado de verificación del usuario."),1)]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0)])])])]),_:1}))}});export{qs as default};
