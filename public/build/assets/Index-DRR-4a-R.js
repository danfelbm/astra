import{_ as ze}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BTbNnzAT.js";import{d as se,r as T,c as ae,I as Ce,i as b,g as i,j as C,e as t,y as Ee,l as ge,f as e,n as A,b as D,h as n,t as x,w as l,F as B,k as F,m as o,o as Ve,a as be,p as je,u as _e,q as Ue,s as ie}from"./app-DPZe4w2x.js";import{_ as W,a as Z,b as le,c as Q}from"./CardTitle.vue_vue_type_script_setup_true_lang-BCQJcDUY.js";import{_ as S}from"./createLucideIcon-CtVqLifD.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-CF59fRLQ.js";import{_ as K}from"./Label.vue_vue_type_script_setup_true_lang-DnsxvmoM.js";import{_ as G}from"./index-CnATNmjU.js";import{_ as Le,a as Ae,b as te,c as Y,d as He,e as L}from"./TableHeader.vue_vue_type_script_setup_true_lang-D0N5J3gC.js";import{C as De,_ as de,a as ue,b as ce,c as me,d as fe}from"./SelectValue.vue_vue_type_script_setup_true_lang-D2pkHqRN.js";import{t as j}from"./index-DAnFQ1_u.js";import{_ as Me,a as Re,b as Pe,c as Be,d as Oe,e as ye}from"./index-BBwYn2e0.js";import{_ as Fe,a as Ge,b as Xe}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-a6C7LxuL.js";import{C as ne}from"./chevron-right-CSSx9PA8.js";import{C as Se}from"./check-dKo-4LQ6.js";import{C as Je}from"./chevrons-up-down-B8rbX1kT.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as Ke}from"./pen-DI55qDm2.js";import{T as xe}from"./trash-2-BI7w8b20.js";import{S as Qe}from"./search-BdrEv58n.js";import{L as We}from"./loader-circle-CBDeF20O.js";import{_ as Ye,a as Ze,b as qe,c as we}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-9OUOr1Ly.js";import{P as pe}from"./plus-BNNWYrMn.js";import{S as re}from"./save-B4oSQHkv.js";import{X as oe}from"./x-B6ClFkAe.js";import{L as et}from"./list-BzQYBNVT.js";import{T as tt}from"./tree-pine-KEkjbOfK.js";import{T as ve}from"./tag-BQRfWA6L.js";import{S as ke}from"./square-pen-Cl6Kw445.js";import"./useFlashMessages-CbS7B_R0.js";import"./index-sIA7RbrN.js";import"./floating-ui.vue-CXipIjmL.js";import"./index-DDtdA_vU.js";import"./shield-d8yX8eDd.js";import"./user-C8fgo3pY.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CSPDkw7c.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-B-F9Ii60.js";import"./VisuallyHidden-B5cr00De.js";import"./index-BvA6n_WJ.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BPQbNv0l.js";import"./circle-alert-Donphzw1.js";import"./map-pin-Bh30LdGY.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-tQUX8JNu.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-nRarJBSv.js";import"./users-BL-0yfO5.js";import"./target-iZzO43i_.js";import"./vote-BzLk9RIT.js";import"./folder-open-DZUJgTn8.js";import"./send-Bg2P21Nh.js";import"./file-text-Ds-M-qF1.js";import"./briefcase-DWx3FSo1.js";import"./calendar-PgbUr37k.js";import"./megaphone-Bgmj5GdG.js";import"./user-check-Bs9WwrXl.js";import"./clipboard-list-BDiDSQ-i.js";import"./mail-yOo8whqd.js";import"./message-square-B9YQnFIo.js";import"./external-link-CGjvDS0z.js";import"./panel-left-VqH85xvb.js";import"./index-vNO-YHMX.js";import"./useKbd-kRIii9yh.js";import"./utils-BipMVa2X.js";import"./VisuallyHiddenInput-BZZ5C64p.js";import"./RovingFocusItem-0kuoIgfJ.js";const lt={class:"flex items-center w-full"},at={key:1,class:"w-5"},st={class:"flex-1 min-w-0"},rt={class:"truncate"},ot={key:0,class:"text-xs text-muted-foreground ml-1"},nt={key:0,class:"text-xs text-muted-foreground ml-1"},it=se({__name:"EtiquetaTreeItem",props:{etiqueta:{},nivel:{default:0},selectedId:{},excludedId:{},showCategoria:{type:Boolean,default:!1}},emits:["select"],setup(s,{emit:R}){const y=s,z=R,q=T(y.nivel<2),E=ae(()=>y.excludedId?y.etiqueta.id===y.excludedId:!1),V=()=>{q.value=!q.value},N=I=>{E.value||z("select",I)};return(I,c)=>{const u=Ce("EtiquetaTreeItem",!0);return o(),b("div",null,[i("div",{class:A(["relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",{"opacity-50":E.value}]),onClick:c[0]||(c[0]=()=>!E.value&&N(s.etiqueta))},[i("div",lt,[i("span",{class:"flex-shrink-0",style:Ee({width:`${s.nivel*20}px`})},null,4),s.etiqueta.children&&s.etiqueta.children.length>0?(o(),b("button",{key:0,onClick:ge(V,["stop"]),class:"mr-1 p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ne),{class:A(["h-3 w-3 transition-transform",q.value?"rotate-90":""])},null,8,["class"])])):(o(),b("span",at)),t(e(Se),{class:A(["mr-2 h-4 w-4 flex-shrink-0",s.selectedId===s.etiqueta.id?"opacity-100":"opacity-0"])},null,8,["class"]),i("div",st,[i("span",rt,[n(x(s.etiqueta.nombre)+" ",1),s.showCategoria&&s.etiqueta.categoria?(o(),b("span",ot," ("+x(s.etiqueta.categoria.nombre)+") ",1)):C("",!0)]),s.etiqueta.children&&s.etiqueta.children.length>0?(o(),b("span",nt," ("+x(s.etiqueta.children.length)+") ",1)):C("",!0),s.etiqueta.usos_count>0?(o(),D(e(G),{key:1,variant:"secondary",class:"ml-2 text-xs"},{default:l(()=>[n(x(s.etiqueta.usos_count)+" usos ",1)]),_:1})):C("",!0)])])],2),q.value&&s.etiqueta.children?(o(!0),b(B,{key:0},F(s.etiqueta.children,h=>(o(),D(u,{key:h.id,etiqueta:h,nivel:s.nivel+1,"selected-id":s.selectedId,"excluded-id":s.excludedId,"show-categoria":s.showCategoria,onSelect:N},null,8,["etiqueta","nivel","selected-id","excluded-id","show-categoria"]))),128)):C("",!0)])}}}),dt={class:"etiqueta-hierarchy-selector"},ut={key:0,class:"truncate"},ct={key:0,class:"text-muted-foreground text-xs mr-1"},mt={key:1,class:"text-muted-foreground"},ft={key:0,class:"text-xs text-muted-foreground mt-1"},pt=se({__name:"EtiquetaHierarchySelector",props:{modelValue:{},label:{default:"Etiqueta Padre"},placeholder:{default:"Seleccionar etiqueta padre..."},allowNull:{type:Boolean,default:!0},excludedId:{},categorias:{},id:{default:"etiqueta-padre"}},emits:["update:modelValue"],setup(s,{emit:R}){const y=s,z=R,q=T(!1),E=T(""),V=T([]),N=T(!1),I=ae(()=>y.modelValue&&V.value.find(_=>_.id===y.modelValue)||null),c=ae(()=>y.categorias?E.value?y.categorias.filter(_=>h(_.id).some(r=>r.nombre.toLowerCase().includes(E.value.toLowerCase())||r.descripcion&&r.descripcion.toLowerCase().includes(E.value.toLowerCase()))):y.categorias:[]),u=_=>V.value.filter(r=>r.categoria_etiqueta_id===_&&!r.parent_id&&r.id!==y.excludedId),h=_=>V.value.filter(r=>r.categoria_etiqueta_id===_&&r.id!==y.excludedId),X=_=>{const r=[_.nombre];let d=_;for(;d.parent_id;){const v=V.value.find(f=>f.id===d.parent_id);if(!v)break;r.unshift(v.nombre),d=v}return r.join(" / ")},H=async()=>{N.value=!0;try{const _=await be.get("/admin/etiquetas/para-selector",{params:{excluir_id:y.excludedId}});_.data.success&&(V.value=_.data.etiquetas)}catch(_){console.error("Error cargando etiquetas:",_)}finally{N.value=!1}},U=_=>{z("update:modelValue",(_==null?void 0:_.id)||null),q.value=!1};return Ve(()=>{H()}),(_,r)=>(o(),b("div",dt,[t(e(K),{for:s.id},{default:l(()=>[n(x(s.label),1)]),_:1},8,["for"]),t(e(Fe),{open:q.value,"onUpdate:open":r[2]||(r[2]=d=>q.value=d)},{default:l(()=>[t(e(Ge),{asChild:""},{default:l(()=>[t(e(S),{id:s.id,variant:"outline",role:"combobox","aria-expanded":q.value,"aria-label":s.label,class:"w-full justify-between"},{default:l(()=>[I.value?(o(),b("span",ut,[I.value.parent?(o(),b("span",ct,x(I.value.parent.nombre)+" / ",1)):C("",!0),n(" "+x(I.value.nombre),1)])):(o(),b("span",mt,x(s.placeholder),1)),t(e(Je),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["id","aria-expanded","aria-label"])]),_:1}),t(e(Xe),{class:"w-[400px] p-0"},{default:l(()=>[t(e(Me),null,{default:l(()=>[t(e(Re),{placeholder:"Buscar etiqueta...",modelValue:E.value,"onUpdate:modelValue":r[0]||(r[0]=d=>E.value=d)},null,8,["modelValue"]),t(e(Pe),null,{default:l(()=>[t(e(Be),null,{default:l(()=>[...r[3]||(r[3]=[n("No se encontraron etiquetas.",-1)])]),_:1}),s.allowNull?(o(),D(e(ye),{key:0},{default:l(()=>[t(e(Oe),{value:"",onSelect:r[1]||(r[1]=d=>U(null))},{default:l(()=>[t(e(Se),{class:A(["mr-2 h-4 w-4",s.modelValue?"opacity-0":"opacity-100"])},null,8,["class"]),r[4]||(r[4]=i("span",{class:"text-muted-foreground"},"Sin etiqueta padre (raíz)",-1))]),_:1})]),_:1})):C("",!0),(o(!0),b(B,null,F(c.value,d=>(o(),D(e(ye),{key:d.id,heading:d.nombre},{default:l(()=>[(o(!0),b(B,null,F(u(d.id),v=>(o(),D(it,{key:v.id,etiqueta:v,nivel:0,"selected-id":s.modelValue,"excluded-id":s.excludedId,onSelect:U},null,8,["etiqueta","selected-id","excluded-id"]))),128))]),_:2},1032,["heading"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),I.value?(o(),b("p",ft," Ruta: "+x(X(I.value)),1)):C("",!0)]))}}),$e=he(pt,[["__scopeId","data-v-bcdf1be4"]]),vt={class:"tree-node"},gt={key:1,class:"w-5"},bt={class:"flex-1 font-medium"},xt={key:0,class:"text-xs text-muted-foreground ml-1"},ht={class:"flex gap-1"},_t={class:"flex gap-1"},yt={key:0},qt=se({__name:"EtiquetaTreeNode",props:{etiqueta:{},nivel:{default:0},expandidos:{},dragDropHelpers:{}},emits:["toggle","edit","delete","drop"],setup(s,{emit:R}){const y=s,z=R,q=T(!1),E=u=>{u.dataTransfer.effectAllowed="move",y.dragDropHelpers.handleDragStart(y.etiqueta)},V=u=>{u.preventDefault(),u.dataTransfer.dropEffect="move",q.value=!0,y.dragDropHelpers.handleDragOver(u,y.etiqueta)},N=()=>{q.value=!1},I=u=>{u.preventDefault(),u.stopPropagation(),q.value=!1;const h=y.dragDropHelpers.handleDrop(u,y.etiqueta);h&&h.valido&&z("drop",h)},c=()=>{q.value=!1,y.dragDropHelpers.handleDragEnd()};return(u,h)=>{var H;const X=Ce("EtiquetaTreeNode",!0);return o(),b("div",vt,[i("div",{class:A(["flex items-center gap-2 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700","transition-colors cursor-move",q.value?"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-300":""]),style:Ee({paddingLeft:s.nivel*24+"px"}),draggable:"true",onDragstart:E,onDragover:V,onDrop:I,onDragend:c,onDragleave:N},[s.etiqueta.children&&s.etiqueta.children.length>0?(o(),b("button",{key:0,onClick:h[0]||(h[0]=U=>u.$emit("toggle",s.etiqueta.id)),class:"p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ne),{class:A(["h-4 w-4 transition-transform",s.expandidos.has(s.etiqueta.id)?"rotate-90":""])},null,8,["class"])])):(o(),b("span",gt)),(H=s.etiqueta.categoria)!=null&&H.color?(o(),b("div",{key:2,class:A(["w-3 h-3 rounded-full",s.etiqueta.categoria.color])},null,2)):C("",!0),i("span",bt,[n(x(s.etiqueta.nombre)+" ",1),s.etiqueta.categoria?(o(),b("span",xt," ("+x(s.etiqueta.categoria.nombre)+") ",1)):C("",!0)]),i("div",ht,[s.etiqueta.usos_count>0?(o(),D(e(G),{key:0,variant:"secondary",class:"text-xs"},{default:l(()=>[n(x(s.etiqueta.usos_count)+" usos ",1)]),_:1})):C("",!0),s.etiqueta.children&&s.etiqueta.children.length>0?(o(),D(e(G),{key:1,variant:"outline",class:"text-xs"},{default:l(()=>[n(x(s.etiqueta.children.length),1)]),_:1})):C("",!0)]),i("div",_t,[t(e(S),{variant:"ghost",size:"icon",class:"h-7 w-7",onClick:h[1]||(h[1]=ge(U=>u.$emit("edit",s.etiqueta),["stop"]))},{default:l(()=>[t(e(Ke),{class:"h-3 w-3"})]),_:1}),t(e(S),{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-500 hover:text-red-600",onClick:h[2]||(h[2]=ge(U=>u.$emit("delete",s.etiqueta),["stop"]))},{default:l(()=>[t(e(xe),{class:"h-3 w-3"})]),_:1})])],38),s.expandidos.has(s.etiqueta.id)&&s.etiqueta.children?(o(),b("div",yt,[(o(!0),b(B,null,F(s.etiqueta.children,U=>(o(),D(X,{key:U.id,etiqueta:U,nivel:s.nivel+1,expandidos:s.expandidos,"drag-drop-helpers":s.dragDropHelpers,onToggle:h[3]||(h[3]=_=>u.$emit("toggle",_)),onEdit:h[4]||(h[4]=_=>u.$emit("edit",_)),onDelete:h[5]||(h[5]=_=>u.$emit("delete",_)),onDrop:h[6]||(h[6]=_=>u.$emit("drop",_))},null,8,["etiqueta","nivel","expandidos","drag-drop-helpers"]))),128))])):C("",!0)])}}}),wt=he(qt,[["__scopeId","data-v-b5f23538"]]);function kt(s=T([])){const R=r=>{const d=new Map,v=[];return r.forEach(f=>{d.set(f.id,{...f,children:[]})}),r.forEach(f=>{const w=d.get(f.id);if(w)if(f.parent_id){const k=d.get(f.parent_id);k&&(k.children||(k.children=[]),k.children.push(w))}else v.push(w)}),v},y=r=>{const d=[],v=f=>{d.push(f),f.children&&f.children.length>0&&f.children.forEach(w=>v(w))};return r.forEach(f=>v(f)),d},z=(r,d=s.value)=>{for(const v of d){if(v.id===r)return v;if(v.children&&v.children.length>0){const f=z(r,v.children);if(f)return f}}return null},q=r=>{const d=[],v=y(s.value);let f=v.find(w=>w.id===r);for(;f;)d.unshift(f),f=f.parent_id?v.find(w=>w.id===f.parent_id):null;return d},E=(r,d)=>q(r).some(f=>f.id===d),V=(r,d)=>r===d?!1:!E(d,r),N=(r=s.value)=>{let d=0;const v=f=>{d++,f.children&&f.children.forEach(w=>v(w))};return r.forEach(f=>v(f)),d},I=(r=s.value)=>{if(!r||r.length===0)return 0;const d=(v,f=0)=>!v.children||v.children.length===0?f:Math.max(...v.children.map(w=>d(w,f+1)));return Math.max(...r.map(v=>d(v,0)))},c=(r,d=s.value)=>{if(!r)return d;const v=r.toLowerCase(),f=w=>{const k=w.nombre.toLowerCase().includes(v)||w.descripcion&&w.descripcion.toLowerCase().includes(v);let $=[];return w.children&&($=w.children.map(M=>f(M)).filter(M=>M!==null)),k||$.length>0?{...w,children:$}:null};return d.map(w=>f(w)).filter(w=>w!==null)},u={draggedItem:T(null),dragOverItem:T(null),handleDragStart(r){this.draggedItem.value=r},handleDragOver(r,d){r.preventDefault(),this.dragOverItem.value=d},handleDrop(r,d){if(r.preventDefault(),!this.draggedItem.value)return;const v=this.draggedItem.value.id,f=(d==null?void 0:d.id)||null;return f&&!V(v,f)?(console.error("No se puede crear un ciclo en la jerarquía"),!1):{hijoId:v,padreId:f,valido:!0}},handleDragEnd(){this.draggedItem.value=null,this.dragOverItem.value=null}},h=T(new Set),X=r=>{h.value.has(r)?h.value.delete(r):h.value.add(r)},H=()=>{y(s.value).forEach(d=>{d.children&&d.children.length>0&&h.value.add(d.id)})},U=()=>{h.value.clear()},_=ae(()=>({totalNodos:N(),profundidadMaxima:I(),totalRaices:s.value.filter(r=>!r.parent_id).length,totalConHijos:y(s.value).filter(r=>r.children&&r.children.length>0).length}));return{etiquetas:s,expandidos:h,estadisticas:_,construirArbol:R,aplanarArbol:y,buscarEnArbol:z,obtenerCamino:q,filtrarArbol:c,esDescendienteDe:E,validarRelacionPadreHijo:V,contarNodos:N,obtenerProfundidadMaxima:I,toggleExpansion:X,expandirTodos:H,colapsarTodos:U,dragDropHelpers:u}}const $t={class:"etiqueta-tree-view"},Ct={class:"mb-4 flex gap-2 items-center"},Et={class:"ml-auto flex items-center gap-2"},Vt={class:"border rounded-lg p-4 bg-white dark:bg-gray-800"},Dt={key:0,class:"flex justify-center py-8"},St={key:1,class:"text-center py-8 text-muted-foreground"},It={key:2,class:"space-y-1"},Tt={key:0,class:"mt-4 grid grid-cols-4 gap-4"},Nt={class:"text-2xl font-bold"},zt={class:"text-2xl font-bold"},jt={class:"text-2xl font-bold"},Ut={class:"text-2xl font-bold"},Lt=se({__name:"EtiquetaTreeView",props:{etiquetas:{},categoriaId:{},showStats:{type:Boolean,default:!1}},emits:["edit","delete","moved"],setup(s,{emit:R}){const y=s,z=R,q=T(!1),E=T(""),V=T([]),{etiquetas:N,expandidos:I,estadisticas:c,construirArbol:u,filtrarArbol:h,toggleExpansion:X,expandirTodos:H,colapsarTodos:U,dragDropHelpers:_}=kt(V),r=async()=>{if(y.etiquetas){V.value=u(y.etiquetas);return}q.value=!0;try{const k=await be.get("/admin/etiquetas/arbol",{params:{categoria_id:y.categoriaId}});k.data.success&&(V.value=k.data.arbol)}catch(k){console.error("Error cargando árbol de etiquetas:",k),j.error("Error al cargar las etiquetas")}finally{q.value=!1}},d=ae(()=>E.value?h(E.value,N.value):N.value);let v;const f=()=>{clearTimeout(v),v=setTimeout(()=>{},300)},w=async k=>{var $,M;if(k.valido){q.value=!0;try{(await be.post(`/admin/etiquetas/${k.hijoId}/establecer-padre`,{parent_id:k.padreId})).data.success&&(j.success("Etiqueta movida exitosamente"),z("moved",{etiquetaId:k.hijoId,nuevoPadreId:k.padreId}),await r())}catch(J){j.error(((M=($=J.response)==null?void 0:$.data)==null?void 0:M.message)||"Error al mover la etiqueta")}finally{q.value=!1}}};return je(()=>y.etiquetas,k=>{k&&(V.value=u(k))}),Ve(()=>{r()}),(k,$)=>(o(),b("div",$t,[i("div",Ct,[t(e(O),{modelValue:E.value,"onUpdate:modelValue":$[0]||($[0]=M=>E.value=M),placeholder:"Buscar etiquetas...",class:"max-w-sm",onInput:f},{prefix:l(()=>[t(e(Qe),{class:"h-4 w-4 text-muted-foreground"})]),_:1},8,["modelValue"]),t(e(S),{variant:"outline",size:"sm",onClick:e(H)},{default:l(()=>[t(e(De),{class:"h-4 w-4 mr-1"}),$[3]||($[3]=n(" Expandir todo ",-1))]),_:1},8,["onClick"]),t(e(S),{variant:"outline",size:"sm",onClick:e(U)},{default:l(()=>[t(e(ne),{class:"h-4 w-4 mr-1"}),$[4]||($[4]=n(" Colapsar todo ",-1))]),_:1},8,["onClick"]),i("div",Et,[t(e(G),{variant:"secondary"},{default:l(()=>[n(x(e(c).totalNodos)+" etiquetas",1)]),_:1}),t(e(G),{variant:"outline"},{default:l(()=>[n(x(e(c).profundidadMaxima)+" niveles",1)]),_:1})])]),i("div",Vt,[q.value?(o(),b("div",Dt,[t(e(We),{class:"h-8 w-8 animate-spin text-muted-foreground"})])):d.value.length===0?(o(),b("div",St," No se encontraron etiquetas ")):(o(),b("div",It,[(o(!0),b(B,null,F(d.value,M=>(o(),D(wt,{key:M.id,etiqueta:M,nivel:0,expandidos:e(I),"drag-drop-helpers":e(_),onToggle:e(X),onEdit:$[1]||($[1]=J=>k.$emit("edit",J)),onDelete:$[2]||($[2]=J=>k.$emit("delete",J)),onDrop:w},null,8,["etiqueta","expandidos","drag-drop-helpers","onToggle"]))),128))]))]),s.showStats?(o(),b("div",Tt,[t(e(W),null,{default:l(()=>[t(e(Z),{class:"pb-2"},{default:l(()=>[t(e(le),{class:"text-sm font-medium"},{default:l(()=>[...$[5]||($[5]=[n("Total",-1)])]),_:1})]),_:1}),t(e(Q),null,{default:l(()=>[i("div",Nt,x(e(c).totalNodos),1)]),_:1})]),_:1}),t(e(W),null,{default:l(()=>[t(e(Z),{class:"pb-2"},{default:l(()=>[t(e(le),{class:"text-sm font-medium"},{default:l(()=>[...$[6]||($[6]=[n("Raíces",-1)])]),_:1})]),_:1}),t(e(Q),null,{default:l(()=>[i("div",zt,x(e(c).totalRaices),1)]),_:1})]),_:1}),t(e(W),null,{default:l(()=>[t(e(Z),{class:"pb-2"},{default:l(()=>[t(e(le),{class:"text-sm font-medium"},{default:l(()=>[...$[7]||($[7]=[n("Con hijos",-1)])]),_:1})]),_:1}),t(e(Q),null,{default:l(()=>[i("div",jt,x(e(c).totalConHijos),1)]),_:1})]),_:1}),t(e(W),null,{default:l(()=>[t(e(Z),{class:"pb-2"},{default:l(()=>[t(e(le),{class:"text-sm font-medium"},{default:l(()=>[...$[8]||($[8]=[n("Profundidad",-1)])]),_:1})]),_:1}),t(e(Q),null,{default:l(()=>[i("div",Ut,x(e(c).profundidadMaxima),1)]),_:1})]),_:1})])):C("",!0)]))}}),At=he(Lt,[["__scopeId","data-v-e813d647"]]),Ht={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Mt={class:"flex justify-between items-center"},Rt={class:"space-y-4"},Pt={key:0,class:"text-xs text-red-500 mt-1"},Bt={class:"flex items-center gap-2"},Ot={class:"flex items-center gap-2"},Ft={class:"flex gap-2 mt-4"},Gt={class:"flex items-center"},Xt={class:"flex items-center gap-2"},Jt={class:"flex items-center gap-2"},Kt={class:"flex justify-end gap-2"},Qt={class:"flex items-center gap-2"},Wt={class:"flex items-center gap-2"},Yt={class:"flex justify-end gap-2"},Zt={class:"p-4 space-y-4"},el={class:"flex items-center justify-between"},tl={class:"font-medium flex items-center gap-2"},ll={class:"space-y-4"},al={class:"flex gap-2 mt-4"},sl={key:1,class:"space-y-2"},rl={key:0,class:"flex-1"},ol={class:"space-y-4"},nl={class:"flex gap-2"},il={key:1,class:"flex-1 flex items-center justify-between"},dl={class:"flex items-center gap-2"},ul={class:"font-medium"},cl={key:0,class:"text-sm text-gray-500"},ml={key:1,class:"text-xs text-muted-foreground mt-1"},fl={class:"flex gap-2"},pl={key:2,class:"text-center py-8 text-gray-500"},ka=se({__name:"Index",props:{categorias:{},estadisticas:{},colores:{},iconos:{}},setup(s){const R=s,y=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:"Categorías de Etiquetas",href:"/admin/categorias-etiquetas"}],z=T(null),q=T(!1),E=T(new Set),V=T(null),N=T(null),I=T("table"),c=_e({nombre:"",color:"gray",icono:"Tag",descripcion:"",orden:0}),u=_e({nombre:"",descripcion:"",categoria_etiqueta_id:0,parent_id:null}),h=()=>{q.value=!0,z.value=null,c.reset()},X=g=>{z.value=g.id,q.value=!1,c.nombre=g.nombre,c.color=g.color,c.icono=g.icono||"Tag",c.descripcion=g.descripcion||"",c.orden=g.orden},H=()=>{z.value=null,q.value=!1,c.reset()},U=()=>{c.post("/admin/categorias-etiquetas",{preserveScroll:!0,onSuccess:()=>{j.success("Categoría creada exitosamente"),H()},onError:()=>{j.error("Error al crear la categoría")}})},_=g=>{c.put(`/admin/categorias-etiquetas/${g}`,{preserveScroll:!0,onSuccess:()=>{j.success("Categoría actualizada"),H()},onError:()=>{j.error("Error al actualizar")}})},r=g=>{confirm(`¿Eliminar la categoría "${g.nombre}"? Las etiquetas se reasignarán.`)&&ie.delete(`/admin/categorias-etiquetas/${g.id}`,{preserveScroll:!0,onSuccess:()=>{j.success("Categoría eliminada")}})},d=g=>{ie.patch(`/admin/categorias-etiquetas/${g.id}/toggle-active`,{},{preserveScroll:!0,onSuccess:()=>{j.success(g.activo?"Categoría desactivada":"Categoría activada")}})},v=g=>{const a=E.value;a.has(g)?a.delete(g):a.add(g)},f=g=>{V.value=g,N.value=null,u.reset(),u.categoria_etiqueta_id=g},w=g=>{N.value=g.id,V.value=null,u.nombre=g.nombre,u.descripcion=g.descripcion||"",u.categoria_etiqueta_id=g.categoria_etiqueta_id,u.parent_id=g.parent_id||null},k=()=>{V.value=null,N.value=null,u.reset()},$=()=>{u.post("/admin/etiquetas",{preserveScroll:!0,onSuccess:()=>{j.success("Etiqueta creada exitosamente"),k()},onError:()=>{j.error("Error al crear la etiqueta")}})},M=g=>{u.put(`/admin/etiquetas/${g}`,{preserveScroll:!0,onSuccess:()=>{j.success("Etiqueta actualizada exitosamente"),k()},onError:()=>{j.error("Error al actualizar la etiqueta")}})},J=g=>{confirm("¿Estás seguro de eliminar esta etiqueta?")&&ie.delete(`/admin/etiquetas/${g}`,{preserveScroll:!0,onSuccess:()=>{j.success("Etiqueta eliminada exitosamente")},onError:()=>{j.error("Error al eliminar la etiqueta")}})},ee=g=>({gray:"bg-gray-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",yellow:"bg-yellow-500",lime:"bg-lime-500",green:"bg-green-500",emerald:"bg-emerald-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",blue:"bg-blue-500",indigo:"bg-indigo-500",violet:"bg-violet-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"})[g]||"bg-gray-500",Ie=()=>{const g=[];return R.categorias.data.forEach(a=>{a.etiquetas&&a.etiquetas.forEach(m=>{g.push({...m,categoria:{id:a.id,nombre:a.nombre,color:a.color,icono:a.icono,descripcion:a.descripcion,orden:a.orden,activo:a.activo}})})}),g},Te=g=>{const a=R.categorias.data.find(m=>m.id===g.categoria_etiqueta_id);a&&(E.value.add(a.id),I.value="table",w(g))},Ne=g=>{J(g.id)};return(g,a)=>(o(),b(B,null,[t(e(Ue),{title:"Categorías de Etiquetas"}),t(ze,{breadcrumbs:y},{default:l(()=>[i("div",Ht,[i("div",Mt,[a[16]||(a[16]=i("div",null,[i("h1",{class:"text-2xl font-bold"},"Categorías de Etiquetas"),i("p",{class:"text-sm text-muted-foreground mt-1"}," Administra las categorías para organizar las etiquetas de proyectos ")],-1)),q.value?C("",!0):(o(),D(e(S),{key:0,onClick:h},{default:l(()=>[t(e(pe),{class:"mr-2 h-4 w-4"}),a[15]||(a[15]=n(" Nueva Categoría ",-1))]),_:1}))]),q.value?(o(),D(e(W),{key:0},{default:l(()=>[t(e(Z),null,{default:l(()=>[t(e(le),null,{default:l(()=>[...a[17]||(a[17]=[n("Nueva Categoría",-1)])]),_:1})]),_:1}),t(e(Q),null,{default:l(()=>[i("div",Rt,[i("div",null,[t(e(K),null,{default:l(()=>[...a[18]||(a[18]=[n("Nombre *",-1)])]),_:1}),t(e(O),{modelValue:e(c).nombre,"onUpdate:modelValue":a[0]||(a[0]=m=>e(c).nombre=m),placeholder:"Nombre de la categoría",class:A({"border-red-500":e(c).errors.nombre})},null,8,["modelValue","class"]),e(c).errors.nombre?(o(),b("p",Pt,x(e(c).errors.nombre),1)):C("",!0)]),i("div",null,[t(e(K),null,{default:l(()=>[...a[19]||(a[19]=[n("Color",-1)])]),_:1}),t(e(de),{modelValue:e(c).color,"onUpdate:modelValue":a[1]||(a[1]=m=>e(c).color=m)},{default:l(()=>[t(e(ue),null,{default:l(()=>[i("div",Bt,[i("div",{class:A([ee(e(c).color),"w-4 h-4 rounded"])},null,2),t(e(ce),{placeholder:e(c).color},null,8,["placeholder"])])]),_:1}),t(e(me),null,{default:l(()=>[(o(!0),b(B,null,F(s.colores,(m,p)=>(o(),D(e(fe),{key:p,value:p},{default:l(()=>[i("div",Ot,[i("div",{class:A([ee(p),"w-4 h-4 rounded"])},null,2),n(" "+x(m),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),i("div",null,[t(e(K),null,{default:l(()=>[...a[20]||(a[20]=[n("Icono",-1)])]),_:1}),t(e(de),{modelValue:e(c).icono,"onUpdate:modelValue":a[2]||(a[2]=m=>e(c).icono=m)},{default:l(()=>[t(e(ue),null,{default:l(()=>[t(e(ce),{placeholder:e(c).icono},null,8,["placeholder"])]),_:1}),t(e(me),null,{default:l(()=>[(o(!0),b(B,null,F(s.iconos,(m,p)=>(o(),D(e(fe),{key:p,value:p},{default:l(()=>[n(x(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),i("div",null,[t(e(K),null,{default:l(()=>[...a[21]||(a[21]=[n("Orden",-1)])]),_:1}),t(e(O),{modelValue:e(c).orden,"onUpdate:modelValue":a[3]||(a[3]=m=>e(c).orden=m),modelModifiers:{number:!0},type:"number",placeholder:"0"},null,8,["modelValue"])]),i("div",null,[t(e(K),null,{default:l(()=>[...a[22]||(a[22]=[n("Descripción",-1)])]),_:1}),t(e(O),{modelValue:e(c).descripcion,"onUpdate:modelValue":a[4]||(a[4]=m=>e(c).descripcion=m),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),i("div",Ft,[t(e(S),{onClick:U,disabled:e(c).processing},{default:l(()=>[t(e(re),{class:"mr-2 h-4 w-4"}),a[23]||(a[23]=n(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(S),{variant:"outline",onClick:H},{default:l(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),a[24]||(a[24]=n(" Cancelar ",-1))]),_:1})])]),_:1})]),_:1})):C("",!0),t(e(Ye),{modelValue:I.value,"onUpdate:modelValue":a[14]||(a[14]=m=>I.value=m)},{default:l(()=>[t(e(W),null,{default:l(()=>[t(e(Z),null,{default:l(()=>[i("div",Gt,[t(e(Ze),null,{default:l(()=>[t(e(qe),{value:"table"},{default:l(()=>[t(e(et),{class:"h-4 w-4 mr-2"}),a[25]||(a[25]=n(" Vista de Tabla ",-1))]),_:1}),t(e(qe),{value:"tree"},{default:l(()=>[t(e(tt),{class:"h-4 w-4 mr-2"}),a[26]||(a[26]=n(" Vista de Árbol ",-1))]),_:1})]),_:1})])]),_:1}),t(e(we),{value:"table",class:"mt-0"},{default:l(()=>[t(e(Q),{class:"p-0"},{default:l(()=>[t(e(Le),null,{default:l(()=>[t(e(Ae),null,{default:l(()=>[t(e(te),null,{default:l(()=>[t(e(Y),null,{default:l(()=>[...a[27]||(a[27]=[n("Nombre",-1)])]),_:1}),t(e(Y),null,{default:l(()=>[...a[28]||(a[28]=[n("Color",-1)])]),_:1}),t(e(Y),null,{default:l(()=>[...a[29]||(a[29]=[n("Etiquetas",-1)])]),_:1}),t(e(Y),null,{default:l(()=>[...a[30]||(a[30]=[n("Orden",-1)])]),_:1}),t(e(Y),null,{default:l(()=>[...a[31]||(a[31]=[n("Estado",-1)])]),_:1}),t(e(Y),{class:"text-right"},{default:l(()=>[...a[32]||(a[32]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(He),null,{default:l(()=>[(o(!0),b(B,null,F(s.categorias.data,m=>(o(),b(B,{key:m.id},[z.value===m.id?(o(),D(e(te),{key:0},{default:l(()=>[t(e(L),null,{default:l(()=>[t(e(O),{modelValue:e(c).nombre,"onUpdate:modelValue":a[5]||(a[5]=p=>e(c).nombre=p),class:"w-full"},null,8,["modelValue"])]),_:1}),t(e(L),null,{default:l(()=>[t(e(de),{modelValue:e(c).color,"onUpdate:modelValue":a[6]||(a[6]=p=>e(c).color=p)},{default:l(()=>[t(e(ue),{class:"w-32"},{default:l(()=>[i("div",Xt,[i("div",{class:A([ee(e(c).color),"w-4 h-4 rounded"])},null,2),t(e(ce))])]),_:1}),t(e(me),null,{default:l(()=>[(o(!0),b(B,null,F(s.colores,(p,P)=>(o(),D(e(fe),{key:P,value:P},{default:l(()=>[i("div",Jt,[i("div",{class:A([ee(P),"w-4 h-4 rounded"])},null,2),n(" "+x(p),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e(L),null,{default:l(()=>[n(x(m.etiquetas_count||0),1)]),_:2},1024),t(e(L),null,{default:l(()=>[t(e(O),{modelValue:e(c).orden,"onUpdate:modelValue":a[7]||(a[7]=p=>e(c).orden=p),modelModifiers:{number:!0},type:"number",class:"w-20"},null,8,["modelValue"])]),_:1}),t(e(L),null,{default:l(()=>[t(e(G),{variant:m.activo?"default":"secondary"},{default:l(()=>[n(x(m.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(L),{class:"text-right"},{default:l(()=>[i("div",Kt,[t(e(S),{size:"sm",onClick:p=>_(m.id),disabled:e(c).processing},{default:l(()=>[t(e(re),{class:"h-4 w-4 mr-2"}),a[33]||(a[33]=n(" Guardar ",-1))]),_:1},8,["onClick","disabled"]),t(e(S),{size:"sm",variant:"outline",onClick:H},{default:l(()=>[t(e(oe),{class:"h-4 w-4 mr-2"}),a[34]||(a[34]=n(" Cancelar ",-1))]),_:1})])]),_:2},1024)]),_:2},1024)):(o(),D(e(te),{key:1},{default:l(()=>[t(e(L),{class:"font-medium"},{default:l(()=>[i("div",Qt,[t(e(ve),{class:"h-4 w-4 text-muted-foreground"}),n(" "+x(m.nombre),1)])]),_:2},1024),t(e(L),null,{default:l(()=>[i("div",Wt,[i("div",{class:A([ee(m.color),"w-4 h-4 rounded"])},null,2),n(" "+x(m.color),1)])]),_:2},1024),t(e(L),null,{default:l(()=>[t(e(G),{variant:"outline"},{default:l(()=>[n(x(m.etiquetas_count||0)+" etiquetas ",1)]),_:2},1024)]),_:2},1024),t(e(L),null,{default:l(()=>[n(x(m.orden),1)]),_:2},1024),t(e(L),null,{default:l(()=>[t(e(G),{variant:m.activo?"default":"secondary",class:"cursor-pointer",onClick:p=>d(m)},{default:l(()=>[n(x(m.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant","onClick"])]),_:2},1024),t(e(L),{class:"text-right"},{default:l(()=>[i("div",Yt,[t(e(S),{size:"sm",variant:"outline",onClick:p=>v(m.id)},{default:l(()=>[E.value.has(m.id)?(o(),D(e(De),{key:1,class:"h-4 w-4 mr-2"})):(o(),D(e(ne),{key:0,class:"h-4 w-4 mr-2"})),a[35]||(a[35]=n(" Ver y añadir etiquetas ",-1))]),_:2},1032,["onClick"]),t(e(S),{size:"sm",variant:"ghost",onClick:p=>X(m)},{default:l(()=>[t(e(ke),{class:"h-4 w-4 mr-2"}),a[36]||(a[36]=n(" Editar ",-1))]),_:1},8,["onClick"]),t(e(S),{size:"sm",variant:"ghost",onClick:p=>r(m),class:"text-destructive hover:text-destructive"},{default:l(()=>[t(e(xe),{class:"h-4 w-4 mr-2"}),a[37]||(a[37]=n(" Eliminar ",-1))]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024)),E.value.has(m.id)?(o(),D(e(te),{key:2,class:"bg-gray-50 dark:bg-gray-900/50"},{default:l(()=>[t(e(L),{colspan:"6",class:"p-0"},{default:l(()=>[i("div",Zt,[i("div",el,[i("h4",tl,[t(e(ve),{class:"h-4 w-4"}),n(" Etiquetas de "+x(m.nombre),1)]),V.value!==m.id?(o(),D(e(S),{key:0,size:"sm",onClick:p=>f(m.id)},{default:l(()=>[t(e(pe),{class:"mr-2 h-4 w-4"}),a[38]||(a[38]=n(" Nueva Etiqueta ",-1))]),_:1},8,["onClick"])):C("",!0)]),V.value===m.id?(o(),D(e(W),{key:0,class:"border-dashed"},{default:l(()=>[t(e(Q),{class:"pt-4"},{default:l(()=>[i("div",ll,[i("div",null,[t(e(K),null,{default:l(()=>[...a[39]||(a[39]=[n("Nombre *",-1)])]),_:1}),t(e(O),{modelValue:e(u).nombre,"onUpdate:modelValue":a[8]||(a[8]=p=>e(u).nombre=p),placeholder:"Nombre de la etiqueta",class:A({"border-red-500":e(u).errors.nombre})},null,8,["modelValue","class"])]),i("div",null,[t(e(K),null,{default:l(()=>[...a[40]||(a[40]=[n("Descripción",-1)])]),_:1}),t(e(O),{modelValue:e(u).descripcion,"onUpdate:modelValue":a[9]||(a[9]=p=>e(u).descripcion=p),placeholder:"Descripción opcional"},null,8,["modelValue"])]),i("div",null,[t($e,{modelValue:e(u).parent_id,"onUpdate:modelValue":a[10]||(a[10]=p=>e(u).parent_id=p),categorias:[m],label:"Etiqueta Padre (Opcional)",placeholder:"Seleccionar etiqueta padre..."},null,8,["modelValue","categorias"])])]),i("div",al,[t(e(S),{onClick:$,disabled:e(u).processing},{default:l(()=>[t(e(re),{class:"mr-2 h-4 w-4"}),a[41]||(a[41]=n(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(S),{variant:"outline",onClick:k},{default:l(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),a[42]||(a[42]=n(" Cancelar ",-1))]),_:1})])]),_:2},1024)]),_:2},1024)):C("",!0),m.etiquetas&&m.etiquetas.length>0?(o(),b("div",sl,[(o(!0),b(B,null,F(m.etiquetas,p=>(o(),b("div",{key:p.id,class:"flex items-center justify-between p-3 border rounded-lg bg-white dark:bg-gray-800"},[N.value===p.id?(o(),b("div",rl,[i("div",ol,[t(e(O),{modelValue:e(u).nombre,"onUpdate:modelValue":a[11]||(a[11]=P=>e(u).nombre=P),placeholder:"Nombre"},null,8,["modelValue"]),t(e(O),{modelValue:e(u).descripcion,"onUpdate:modelValue":a[12]||(a[12]=P=>e(u).descripcion=P),placeholder:"Descripción"},null,8,["modelValue"]),t($e,{modelValue:e(u).parent_id,"onUpdate:modelValue":a[13]||(a[13]=P=>e(u).parent_id=P),categorias:[m],"excluded-id":p.id,label:"",placeholder:"Etiqueta padre..."},null,8,["modelValue","categorias","excluded-id"]),i("div",nl,[t(e(S),{size:"sm",onClick:P=>M(p.id),disabled:e(u).processing},{default:l(()=>[t(e(re),{class:"h-4 w-4 mr-2"}),a[43]||(a[43]=n(" Guardar ",-1))]),_:1},8,["onClick","disabled"]),t(e(S),{size:"sm",variant:"outline",onClick:k},{default:l(()=>[t(e(oe),{class:"h-4 w-4 mr-2"}),a[44]||(a[44]=n(" Cancelar ",-1))]),_:1})])])])):(o(),b("div",il,[i("div",null,[i("div",dl,[i("span",ul,x(p.nombre),1),p.parent?(o(),D(e(G),{key:0,variant:"outline",class:"text-xs"},{default:l(()=>[n(x(p.parent.nombre),1)]),_:2},1024)):C("",!0),p.tiene_hijos?(o(),D(e(G),{key:1,variant:"secondary",class:"text-xs"},{default:l(()=>[...a[45]||(a[45]=[n(" Tiene hijos ",-1)])]),_:1})):C("",!0)]),p.descripcion?(o(),b("p",cl,x(p.descripcion),1)):C("",!0),p.ruta_completa&&p.parent?(o(),b("p",ml," Ruta: "+x(p.ruta_completa),1)):C("",!0)]),i("div",fl,[t(e(S),{size:"sm",variant:"outline",onClick:P=>w(p)},{default:l(()=>[t(e(ke),{class:"h-4 w-4 mr-2"}),a[46]||(a[46]=n(" Editar ",-1))]),_:1},8,["onClick"]),t(e(S),{size:"sm",variant:"outline",onClick:P=>J(p.id)},{default:l(()=>[t(e(xe),{class:"h-4 w-4 mr-2"}),a[47]||(a[47]=n(" Eliminar ",-1))]),_:1},8,["onClick"])])]))]))),128))])):V.value!==m.id?(o(),b("div",pl,[t(e(ve),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),a[49]||(a[49]=i("p",null,"No hay etiquetas en esta categoría",-1)),t(e(S),{variant:"outline",size:"sm",class:"mt-2",onClick:p=>f(m.id)},{default:l(()=>[t(e(pe),{class:"mr-2 h-4 w-4"}),a[48]||(a[48]=n(" Crear primera etiqueta ",-1))]),_:1},8,["onClick"])])):C("",!0)])]),_:2},1024)]),_:2},1024)):C("",!0)],64))),128)),s.categorias.data.length===0?(o(),D(e(te),{key:0},{default:l(()=>[t(e(L),{colspan:"6",class:"text-center text-muted-foreground py-8"},{default:l(()=>[...a[50]||(a[50]=[n(" No hay categorías creadas. Crea una nueva para empezar. ",-1)])]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(we),{value:"tree",class:"mt-0"},{default:l(()=>[t(e(Q),null,{default:l(()=>[t(At,{etiquetas:Ie(),"show-stats":!0,onEdit:Te,onDelete:Ne},null,8,["etiquetas"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{ka as default};
