import{d as Xe,k as H,c as q,w as oe,s as Qe,a as m,o as u,j as B,i as V,e as c,b as r,u as e,g as x,f as l,t as b,F as Y,r as Q,bT as tt,n as J,C as at,v as rt,m as st,h as it,at as ot,J as dt,bK as nt,as as lt}from"./app-Te3PPdHD.js";import{_ as se}from"./AppLogo.vue_vue_type_script_setup_true_lang-W_DjSbgJ.js";import{_ as de,a as ne}from"./CardContent.vue_vue_type_script_setup_true_lang-D_rxG1xF.js";import{_ as le,a as ze}from"./CardTitle.vue_vue_type_script_setup_true_lang-CxvaWqnG.js";import{_ as ut}from"./Checkbox.vue_vue_type_script_setup_true_lang-RPD2EEbj.js";import{_ as fe}from"./Input.vue_vue_type_script_setup_true_lang-COevQvbw.js";import{_ as ae}from"./Label.vue_vue_type_script_setup_true_lang-CddxUDHY.js";import{_ as ct,a as ft,b as mt,c as pt,d as _t}from"./SelectValue.vue_vue_type_script_setup_true_lang-CVgg3Khu.js";import{_ as gt}from"./Textarea.vue_vue_type_script_setup_true_lang-8WXnnHZZ.js";import{u as vt,a as bt,_ as yt,b as ht,c as xt,d as kt}from"./useConditionalFields-N2K2LSXH.js";import{a as Re,C as Me,U as St,u as U,_ as wt,v as $t}from"./AppLayout.vue_vue_type_script_setup_true_lang-B1gxnIse.js";import{_ as We}from"./CardDescription.vue_vue_type_script_setup_true_lang-CDkPCfK3.js";import{_ as Ct,a as Ge}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-lf6nsmsO.js";import{a as me,_ as pe}from"./index-DP8V1WtC.js";import{_ as _e}from"./AlertTitle.vue_vue_type_script_setup_true_lang-6RY4iQQw.js";import{C as X}from"./circle-alert-DZFEg5N9.js";import{M as ie}from"./map-pin-B7-fBNM9.js";import{A as Et}from"./arrow-left-CbhKNwFx.js";import{C as ge}from"./clock-D4F_VZgn.js";import{C as Tt}from"./circle-check-big-G2FUIqlD.js";import{U as Vt}from"./user-C4YzRwVQ.js";import{S as Ye}from"./save-qqUtlbJp.js";import"./index-DvExiaWh.js";import"./index-ibpswyNf.js";import"./useForwardExpose-DjCGcjBS.js";import"./usePrimitiveElement-Wv9UFbsD.js";import"./createContext-DitPrlKu.js";import"./Collection-aNeXlj_z.js";import"./useNonce-Bdm318tJ.js";import"./chevron-up-Cpk44tdW.js";import"./handleAndDispatchCustomEvent-CYpUamdb.js";import"./nullish-CHIgUVhi.js";import"./useFormControl-Civ3FWWz.js";import"./VisuallyHidden-CHPAlaQV.js";import"./upload-BGMT2DSh.js";import"./eye-BbhyPPE8.js";import"./download-Bk5bmdny.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BySUQk1l.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-LEz0sjJW.js";import"./plus-azTncWTz.js";import"./grip-vertical-Ba4H0cKO.js";import"./trash-2-BpY3XbpU.js";import"./RovingFocusItem-fMFBWCCo.js";import"./VisuallyHiddenInput-BuryYdd7.js";const At={class:"space-y-4"},jt={key:1,class:"text-center py-8"},Ut={key:3,class:"space-y-6"},Ot={key:0},Ft={class:"text-sm font-medium text-muted-foreground mb-3"},qt={class:"space-y-3"},It={class:"flex items-start gap-3"},Nt={class:"flex-1"},Dt={class:"flex items-center justify-between"},Bt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Pt={class:"flex items-center gap-2 text-muted-foreground"},Lt={class:"flex items-center gap-2 text-muted-foreground"},zt={class:"flex items-center gap-2 text-muted-foreground"},Rt={key:0,class:"flex items-center gap-2 text-muted-foreground"},Mt={class:"mt-3 text-xs text-muted-foreground"},Wt={key:1},Gt={class:"text-sm font-medium text-muted-foreground mb-3"},Yt={class:"space-y-3"},Jt={class:"flex items-start gap-3"},Kt={class:"flex-1"},Ht={class:"flex items-center justify-between"},Xt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Qt={class:"flex items-center gap-2 text-muted-foreground"},Zt={class:"flex items-center gap-2 text-muted-foreground"},ea={class:"flex items-center gap-2 text-muted-foreground"},ta={class:"mt-3 text-xs text-muted-foreground"},aa={key:5,class:"mt-4 p-3 bg-muted/50 rounded-lg"},ra={class:"text-sm text-muted-foreground"},sa=Xe({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(s,{emit:i}){const $=s,A=i,w=H([]),E=H(!1),j=H(null),a=H($.modelValue),y=async()=>{E.value=!0,j.value=null;try{const h=await tt.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:$.filtrarPorUbicacion,incluir_futuras:!0}});w.value=h.data}catch(h){j.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",h)}finally{E.value=!1}},T=q(()=>{const h={abiertas:[],futuras:[]};return w.value.forEach(_=>{_.estado_temporal==="abierta"?h.abiertas.push(_):_.estado_temporal==="futura"&&h.futuras.push(_)}),h}),M=q(()=>w.value.find(h=>h.id===a.value));oe(a,h=>{A("update:modelValue",h)}),oe(()=>$.modelValue,h=>{a.value=h});const I=h=>new Date(h).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=h=>{switch(h){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},O=h=>{switch(h){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Qe(()=>{y()}),(h,_)=>(u(),m("div",At,[h.showPostulacionWarning&&a.value?(u(),B(e(pe),{key:0,class:"border-blue-200 bg-blue-50"},{default:c(()=>[r(e(X),{class:"h-4 w-4 text-blue-600"}),r(e(_e),{class:"text-blue-800"},{default:c(()=>_[1]||(_[1]=[x("Postulación Automática")])),_:1}),r(e(me),{class:"text-blue-700"},{default:c(()=>_[2]||(_[2]=[x(' Al enviar este formulario de candidatura, se creará automáticamente una postulación a la convocatoria seleccionada, la cual quedará en estado "Enviada" para revisión administrativa. ')])),_:1})]),_:1})):V("",!0),E.value?(u(),m("div",jt,_[3]||(_[3]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),l("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):j.value?(u(),B(e(pe),{key:2,variant:"destructive"},{default:c(()=>[r(e(X),{class:"h-4 w-4"}),r(e(_e),null,{default:c(()=>_[4]||(_[4]=[x("Error")])),_:1}),r(e(me),null,{default:c(()=>[x(b(j.value),1)]),_:1})]),_:1})):w.value.length>0?(u(),m("div",Ut,[r(e(Ct),{modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=p=>a.value=p),disabled:h.disabled},{default:c(()=>[T.value.abiertas.length>0?(u(),m("div",Ot,[l("h4",Ft," Convocatorias Abiertas ("+b(T.value.abiertas.length)+") ",1),l("div",qt,[(u(!0),m(Y,null,Q(T.value.abiertas,p=>(u(),B(e(de),{key:p.id,class:J(["cursor-pointer hover:shadow-md transition-shadow",{"ring-2 ring-primary":a.value===p.id}])},{default:c(()=>[r(e(le),{class:"pb-3"},{default:c(()=>[l("div",It,[r(e(Ge),{value:p.id.toString(),id:`conv-${p.id}`},null,8,["value","id"]),l("div",Nt,[l("div",Dt,[r(e(ae),{for:`conv-${p.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[x(b(p.nombre),1)]),_:2},1032,["for"]),r(e(Re),{class:J(P(p.estado_temporal))},{default:c(()=>[x(b(O(p.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(We),{class:"mt-1"},{default:c(()=>[x(b(p.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(ne),{class:"pt-0"},{default:c(()=>[l("div",Bt,[l("div",Pt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(p.cargo.nombre),1)]),l("div",Lt,[r(e(Me),{class:"h-4 w-4"}),l("span",null,b(p.periodo_electoral.nombre),1)]),l("div",zt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(p.ubicacion),1)]),p.numero_postulaciones!==void 0?(u(),m("div",Rt,[r(e(St),{class:"h-4 w-4"}),l("span",null,b(p.numero_postulaciones)+" postulaciones",1)])):V("",!0)]),l("div",Mt,[_[5]||(_[5]=l("span",{class:"font-medium"},"Cierre:",-1)),x(" "+b(I(p.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0),T.value.futuras.length>0?(u(),m("div",Wt,[l("h4",Gt," Próximas Convocatorias ("+b(T.value.futuras.length)+") ",1),l("div",Yt,[(u(!0),m(Y,null,Q(T.value.futuras,p=>(u(),B(e(de),{key:p.id,class:J(["cursor-pointer hover:shadow-md transition-shadow opacity-90",{"ring-2 ring-primary":a.value===p.id}])},{default:c(()=>[r(e(le),{class:"pb-3"},{default:c(()=>[l("div",Jt,[r(e(Ge),{value:p.id.toString(),id:`conv-${p.id}`},null,8,["value","id"]),l("div",Kt,[l("div",Ht,[r(e(ae),{for:`conv-${p.id}`,class:"text-base font-semibold cursor-pointer"},{default:c(()=>[x(b(p.nombre),1)]),_:2},1032,["for"]),r(e(Re),{class:J(P(p.estado_temporal))},{default:c(()=>[x(b(O(p.estado_temporal)),1)]),_:2},1032,["class"])]),r(e(We),{class:"mt-1"},{default:c(()=>[x(b(p.descripcion),1)]),_:2},1024)])])]),_:2},1024),r(e(ne),{class:"pt-0"},{default:c(()=>[l("div",Xt,[l("div",Qt,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(p.cargo.nombre),1)]),l("div",Zt,[r(e(Me),{class:"h-4 w-4"}),l("span",null,b(p.periodo_electoral.nombre),1)]),l("div",ea,[r(e(ie),{class:"h-4 w-4"}),l("span",null,b(p.ubicacion),1)])]),l("div",ta,[_[6]||(_[6]=l("span",{class:"font-medium"},"Apertura:",-1)),x(" "+b(I(p.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class"]))),128))])])):V("",!0)]),_:1},8,["modelValue","disabled"])])):(u(),B(e(pe),{key:4},{default:c(()=>[r(e(X),{class:"h-4 w-4"}),r(e(_e),null,{default:c(()=>_[7]||(_[7]=[x("Sin convocatorias disponibles")])),_:1}),r(e(me),null,{default:c(()=>_[8]||(_[8]=[x(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),M.value&&!h.disabled?(u(),m("div",aa,[_[9]||(_[9]=l("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),l("p",ra,b(M.value.nombre),1)])):V("",!0)]))}});var ia=typeof global=="object"&&global&&global.Object===Object&&global,oa=typeof self=="object"&&self&&self.Object===Object&&self,Ze=ia||oa||Function("return this")(),ue=Ze.Symbol,et=Object.prototype,da=et.hasOwnProperty,na=et.toString,te=ue?ue.toStringTag:void 0;function la(s){var i=da.call(s,te),$=s[te];try{s[te]=void 0;var A=!0}catch{}var w=na.call(s);return A&&(i?s[te]=$:delete s[te]),w}var ua=Object.prototype,ca=ua.toString;function fa(s){return ca.call(s)}var ma="[object Null]",pa="[object Undefined]",Je=ue?ue.toStringTag:void 0;function _a(s){return s==null?s===void 0?pa:ma:Je&&Je in Object(s)?la(s):fa(s)}function ga(s){return s!=null&&typeof s=="object"}var va="[object Symbol]";function ba(s){return typeof s=="symbol"||ga(s)&&_a(s)==va}var ya=/\s/;function ha(s){for(var i=s.length;i--&&ya.test(s.charAt(i)););return i}var xa=/^\s+/;function ka(s){return s&&s.slice(0,ha(s)+1).replace(xa,"")}function be(s){var i=typeof s;return s!=null&&(i=="object"||i=="function")}var Ke=NaN,Sa=/^[-+]0x[0-9a-f]+$/i,wa=/^0b[01]+$/i,$a=/^0o[0-7]+$/i,Ca=parseInt;function He(s){if(typeof s=="number")return s;if(ba(s))return Ke;if(be(s)){var i=typeof s.valueOf=="function"?s.valueOf():s;s=be(i)?i+"":i}if(typeof s!="string")return s===0?s:+s;s=ka(s);var $=wa.test(s);return $||$a.test(s)?Ca(s.slice(2),$?2:8):Sa.test(s)?Ke:+s}var ve=function(){return Ze.Date.now()},Ea="Expected a function",Ta=Math.max,Va=Math.min;function Aa(s,i,$){var A,w,E,j,a,y,T=0,M=!1,I=!1,P=!0;if(typeof s!="function")throw new TypeError(Ea);i=He(i)||0,be($)&&(M=!!$.leading,I="maxWait"in $,E=I?Ta(He($.maxWait)||0,i):E,P="trailing"in $?!!$.trailing:P);function O(S){var D=A,v=w;return A=w=void 0,T=S,j=s.apply(v,D),j}function h(S){return T=S,a=setTimeout(L,i),M?O(S):j}function _(S){var D=S-y,v=S-T,C=i-D;return I?Va(C,E-v):C}function p(S){var D=S-y,v=S-T;return y===void 0||D>=i||D<0||I&&v>=E}function L(){var S=ve();if(p(S))return G(S);a=setTimeout(L,_(S))}function G(S){return a=void 0,P&&A?O(S):(A=w=void 0,j)}function Z(){a!==void 0&&clearTimeout(a),T=0,A=y=w=a=void 0}function K(){return a===void 0?j:G(ve())}function N(){var S=ve(),D=p(S);if(A=arguments,w=this,y=S,D){if(a===void 0)return h(y);if(I)return clearTimeout(a),a=setTimeout(L,i),O(y)}return a===void 0&&(a=setTimeout(L,i)),j}return N.cancel=Z,N.flush=K,N}function ja(s,i){const{url:$,candidaturaId:A=null,debounceTime:w=3e3,showNotifications:E=!0,useLocalStorage:j=!0,localStorageKey:a="candidatura_draft"}=i,y=H({status:"idle",lastSaved:null,lastError:null,candidaturaId:A}),T=q(()=>y.value.status==="saving"),M=q(()=>y.value.lastSaved!==null),I=q(()=>y.value.status==="error"),P=()=>{if(j)try{const v={formulario_data:s.value,timestamp:new Date().toISOString(),candidaturaId:y.value.candidaturaId};localStorage.setItem(a,JSON.stringify(v))}catch(v){console.error("Error guardando en localStorage:",v)}},O=()=>{if(!j)return null;try{const v=localStorage.getItem(a);if(v){const C=JSON.parse(v),z=new Date(C.timestamp);if((Date.now()-z.getTime())/(1e3*60*60)<24)return C;localStorage.removeItem(a)}}catch(v){console.error("Error cargando desde localStorage:",v)}return null},h=()=>{j&&localStorage.removeItem(a)},_=async()=>{try{const v=await fetch(window.location.href,{method:"GET",credentials:"same-origin"});if(v.ok){const C=await v.text(),F=new DOMParser().parseFromString(C,"text/html").querySelector('meta[name="csrf-token"]');if(F){const ee=F.getAttribute("content"),W=document.querySelector('meta[name="csrf-token"]');if(W&&ee)return W.setAttribute("content",ee),ee}}}catch(v){console.error("Error renovando token CSRF:",v)}return null},p=async(v,C,z=0)=>{const R=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":C,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({formulario_data:s.value})});if(R.status===419&&z<1){const F=await _();if(F)return E&&U.info("Renovando sesión...",{description:"Se detectó una sesión expirada, renovando automáticamente",duration:2e3}),p(v,F,z+1)}return R},L=async()=>{var v;if(y.value.status!=="saving"&&!(!s.value||Object.keys(s.value).length===0)){y.value.status="saving",y.value.lastError=null;try{const C=y.value.candidaturaId?$.replace("autosave",`${y.value.candidaturaId}/autosave`):$,z=((v=document.querySelector('meta[name="csrf-token"]'))==null?void 0:v.getAttribute("content"))||"";if(!z)throw new Error("Token CSRF no encontrado");const R=await p(C,z);if(!R.ok)throw new Error(`Error ${R.status}: ${R.statusText}`);const F=await R.json();if(F.success)y.value.status="saved",y.value.lastSaved=new Date,!y.value.candidaturaId&&F.candidatura_id&&(y.value.candidaturaId=F.candidatura_id),P(),E&&U.success("Cambios guardados",{description:`Autoguardado a las ${F.timestamp||new Date().toLocaleTimeString()}`,duration:2e3});else throw new Error(F.message||"Error al guardar")}catch(C){y.value.status="error",y.value.lastError=C instanceof Error?C.message:"Error desconocido",P(),C instanceof Error&&C.message.includes("419")?E&&U.warning("Sesión expirada",{description:"Recarga la página para continuar. Los cambios se guardaron localmente.",duration:5e3}):E&&U.error("Error al guardar",{description:"Los cambios se guardaron localmente",duration:3e3}),console.error("Error en autoguardado:",C)}}},G=Aa(L,w),Z=()=>(G.cancel(),L()),K=()=>oe(s,()=>{y.value.status!=="error"&&G()},{deep:!0}),N=()=>{G.cancel()},S=()=>{N(),y.value={status:"idle",lastSaved:null,lastError:null,candidaturaId:A},h()},D=()=>{const v=O();return v&&v.formulario_data?(E&&U.info("Borrador recuperado",{description:"Se recuperaron los cambios no guardados",duration:3e3}),v):null};return{state:q(()=>y.value),isSaving:T,hasSaved:M,hasError:I,saveNow:Z,startWatching:K,stopAutoSave:N,reset:S,restoreDraft:D,clearLocalStorage:h}}const Ua={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Oa={class:"flex items-center justify-between"},Fa={class:"text-3xl font-bold"},qa={class:"text-muted-foreground"},Ia={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},Na={key:0,class:"flex items-center gap-1.5"},Da={key:1,class:"flex items-center gap-1.5"},Ba={key:2,class:"flex items-center gap-1.5 text-amber-600"},Pa={key:3,class:"flex items-center gap-1.5"},La={class:"text-blue-700 dark:text-blue-300"},za={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Ra={class:"flex items-start gap-3"},Ma={class:"text-sm text-blue-800"},Wa={key:0,class:"mt-1 text-blue-600"},Ga={key:1,class:"p-4 bg-amber-50 border border-amber-200 rounded-lg"},Ya={class:"flex items-start gap-3"},Ja={key:0,class:"text-red-500"},Ka={key:0,class:"text-sm text-muted-foreground"},Ha={key:6,class:"space-y-2"},Xa=["id","name","value","onUpdate:modelValue"],Qa={key:7,class:"space-y-2"},Za={key:8},er={key:9},tr={key:0,class:"text-red-500 text-sm mt-1"},ar={key:10},rr={key:11},sr={key:12},ir={key:13,class:"text-sm text-destructive"},or={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},dr={class:"text-red-800 text-sm"},nr={class:"flex justify-between pt-6"},lr={key:0,class:"fixed bottom-12 right-80 z-50"},ur=Xe({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean}},setup(s){var ye,he;const i=s,$=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:i.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:A}=vt(),w=H({}),E=q(()=>{var k;if(!i.is_editing||!((k=i.candidatura)!=null&&k.formulario_data))return!1;const n=Object.keys(i.candidatura.formulario_data),d=i.configuracion_campos.map(t=>t.id),o=n.some(t=>!d.includes(t)),g=i.configuracion_campos.some(t=>t.required&&!i.candidatura.formulario_data[t.id]);return o||g}),a=at((()=>{var d;const n={};return i.configuracion_campos.forEach(o=>{o.type==="checkbox"?n[o.id]=[]:o.type==="file"?n[o.id]=[]:o.type==="convocatoria"?n[o.id]=void 0:o.type==="disclaimer"?n[o.id]=null:o.type==="repeater"?n[o.id]=[]:o.type==="datepicker"?n[o.id]=null:n[o.id]=""}),(d=i.candidatura)!=null&&d.formulario_data&&(Object.assign(n,i.candidatura.formulario_data),i.configuracion_campos.forEach(o=>{o.type==="file"&&n[o.id]&&(Array.isArray(n[o.id])||(n[o.id]=[n[o.id]]))})),{formulario_data:n}})()),y=H(i.configuracion_campos),T=q(()=>a.formulario_data),{visibleFields:M,clearHiddenFieldValues:I}=bt(y,T);oe(M,()=>{I()});const{state:P,isSaving:O,hasSaved:h,hasError:_,saveNow:p,startWatching:L,stopAutoSave:G,restoreDraft:Z,clearLocalStorage:K}=ja(T,{url:"/candidaturas/autosave",candidaturaId:((ye=i.candidatura)==null?void 0:ye.id)||null,debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((he=i.candidatura)==null?void 0:he.id)||"new"}`});let N=null;Qe(()=>{const n=["borrador","rechazado"];if(!i.candidatura||n.includes(i.candidatura.estado)){if(!i.is_editing){const o=Z();o&&o.formulario_data&&(U.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{K(),a.reset(),U.success("Borrador descartado")}},duration:5e3}),Object.assign(a.formulario_data,o.formulario_data))}N=L()}}),rt(()=>{N&&N(),G()});const S=async()=>{if(O.value){U.warning("Ya se está guardando...");return}await p(),_.value||U.success("Borrador guardado manualmente")},D=q(()=>z.value.map(o=>{var t;if(!o.required)return{campo:o.id,valid:!0};const g=a.formulario_data[o.id];let k=!1;if(o.type==="checkbox")k=Array.isArray(g)&&g.length>0;else if(o.type==="file")(Array.isArray(g)&&g.length>0||w.value[o.id]&&w.value[o.id].length>0)&&(k=!0);else if(o.type==="convocatoria")k=g!=null&&g!=="";else if(o.type==="disclaimer")k=g&&g.accepted===!0;else if(o.type==="repeater"){const re=((t=o.repeaterConfig)==null?void 0:t.minItems)||0;k=Array.isArray(g)&&g.length>=re}else o.type==="datepicker"?k=g!=null&&g!=="":k=g&&g.toString().trim()!=="";return!k&&o.required,{campo:o.id,valid:k}}).every(o=>o.valid)),v=q(()=>i.is_editing?"Editar Candidatura":"Crear Candidatura"),C=q(()=>{var n,d;return a.processing?"Guardando...":i.is_editing?((n=i.candidatura)==null?void 0:n.estado)==="rechazado"?"Reenviar Candidatura":((d=i.candidatura)==null?void 0:d.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),z=q(()=>{var d;let n=[...M.value];return i.is_editing&&i.candidatura&&["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=n.filter(g=>g.type!=="convocatoria")),i.is_editing&&((d=i.candidatura)==null?void 0:d.estado)==="aprobado"&&(n=n.filter(o=>o.editable===!0)),n}),R=q(()=>{var o;if(!i.is_editing||!i.candidatura)return!1;let n=!1;if(["pendiente","aprobado"].includes(i.candidatura.estado)&&(n=i.configuracion_campos.some(g=>g.type==="convocatoria")),((o=i.candidatura)==null?void 0:o.estado)==="aprobado"){const g=i.configuracion_campos.some(k=>!k.editable&&k.type!=="convocatoria");return n||g}return n}),F=async(n,d)=>{if(w.value[n]=d,d&&d.length>0)try{U.info("Subiendo archivos...",{duration:2e3});const g=(await A(d,{module:"candidaturas",fieldId:n})).map(k=>k.path);Array.isArray(a.formulario_data[n]),a.formulario_data[n]=g,w.value[n]=[],U.success("Archivos subidos correctamente",{duration:2e3})}catch(o){console.error("Error al subir archivos:",o),U.error("Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else a.formulario_data[n]=[]},ee=async()=>{for(const[d,o]of Object.entries(w.value))if(o&&o.length>0)try{U.info("Subiendo archivos pendientes...",{duration:2e3});const g=await A(o,{module:"candidaturas",fieldId:d});a.formulario_data[d]=g.map(k=>k.path),w.value[d]=[]}catch(g){console.error("Error al subir archivos:",g),U.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const n={...a.formulario_data};i.configuracion_campos.forEach(d=>{const o=n[d.id];d.required||(o===""||o===void 0||Array.isArray(o)&&o.length===0&&d.type!=="checkbox"&&d.type!=="file")&&(n[d.id]=null)}),a.formulario_data=n,G(),i.is_editing?a.put(`/candidaturas/${i.candidatura.id}`,{onSuccess:()=>{K(),U.success("Candidatura actualizada exitosamente")},onError:d=>{console.error("Errores de validación:",d),(!i.candidatura||["borrador","rechazado"].includes(i.candidatura.estado))&&(N=L())}}):a.post("/candidaturas",{onSuccess:()=>{K(),U.success("Candidatura creada exitosamente")},onError:d=>{console.error("Errores de validación:",d),N=L()}})},W=n=>!!a.errors[`formulario_data.${n}`];return(n,d)=>(u(),m(Y,null,[r(e(st),{title:v.value},null,8,["title"]),r(wt,{breadcrumbs:$},{default:c(()=>{var o,g;return[l("div",Ua,[l("div",Oa,[l("div",null,[l("h1",Fa,b(v.value),1),l("p",qa,b(n.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),r(e(se),{variant:"outline",onClick:d[0]||(d[0]=k=>n.$inertia.visit("/candidaturas"))},{default:c(()=>[r(e(Et),{class:"mr-2 h-4 w-4"}),d[2]||(d[2]=x(" Volver "))]),_:1})]),!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)?(u(),m("div",Ia,[e(O)?(u(),m("div",Na,[r(e(ge),{class:"h-4 w-4 animate-spin"}),d[3]||(d[3]=l("span",null,"Guardando automáticamente...",-1))])):e(h)&&!e(_)?(u(),m("div",Da,[r(e(Tt),{class:"h-4 w-4 text-green-600"}),l("span",null,"Guardado automáticamente a las "+b((o=e(P).lastSaved)==null?void 0:o.toLocaleTimeString()),1)])):e(_)?(u(),m("div",Ba,[r(e(X),{class:"h-4 w-4"}),d[4]||(d[4]=l("span",null,"Guardado localmente (sin conexión)",-1))])):(u(),m("div",Pa,[r(e(ge),{class:"h-4 w-4"}),d[5]||(d[5]=l("span",null,"Autoguardado activado",-1))]))])):V("",!0),n.is_editing&&((g=n.candidatura)!=null&&g.comentarios_admin)?(u(),B(e(de),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:c(()=>[r(e(le),null,{default:c(()=>[r(e(ze),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:c(()=>[r(e(X),{class:"h-5 w-5"}),d[6]||(d[6]=x(" Comentarios de la comisión "))]),_:1})]),_:1}),r(e(ne),null,{default:c(()=>[l("p",La,b(n.candidatura.comentarios_admin),1)]),_:1})]),_:1})):V("",!0),r(e(de),null,{default:c(()=>[r(e(le),null,{default:c(()=>[r(e(ze),{class:"flex items-center gap-2"},{default:c(()=>[r(e(Vt),{class:"h-5 w-5"}),d[7]||(d[7]=x(" Información de Candidatura "))]),_:1})]),_:1}),r(e(ne),null,{default:c(()=>{var k;return[l("form",{onSubmit:it(ee,["prevent"]),class:"space-y-6"},[n.is_editing&&((k=n.candidatura)==null?void 0:k.estado)==="aprobado"?(u(),m("div",za,[l("div",Ra,[r(e(X),{class:"h-5 w-5 text-blue-600 mt-0.5"}),l("div",Ma,[d[8]||(d[8]=l("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),d[9]||(d[9]=l("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),R.value?(u(),m("p",Wa," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):V("",!0)])])])):V("",!0),E.value?(u(),m("div",Ga,[l("div",Ya,[r(e(X),{class:"h-5 w-5 text-amber-600 mt-0.5"}),d[10]||(d[10]=l("div",{class:"text-sm text-amber-800"},[l("p",{class:"font-medium"},"Formulario Actualizado"),l("p",{class:"mt-1"},"El formulario de candidatura ha sido actualizado con nuevos campos. Por favor, completa todos los campos requeridos antes de enviar tu candidatura.")],-1))])])):V("",!0),r(ot,{name:"fade-field",tag:"div",class:"space-y-6"},{default:c(()=>[(u(!0),m(Y,null,Q(z.value,t=>{var re,xe,ke,Se,we,$e,Ce,Ee,Te,Ve,Ae,je,Ue,Oe,Fe,qe,Ie,Ne,De,Be,Pe;return u(),m("div",{key:t.id,class:"space-y-2"},[r(e(ae),{for:t.id,class:"flex items-center gap-1"},{default:c(()=>[x(b(t.title)+" ",1),t.required?(u(),m("span",Ja,"*")):V("",!0)]),_:2},1032,["for"]),t.description?(u(),m("p",Ka,b(t.description),1)):V("",!0),t.type==="text"||t.type==="email"?(u(),B(e(fe),{key:1,id:t.id,type:t.type,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:J({"border-destructive":W(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(u(),B(e(gt),{key:2,id:t.id,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",rows:4,class:J({"border-destructive":W(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(u(),B(e(fe),{key:3,id:t.id,type:"number",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:J({"border-destructive":W(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(u(),B(e(fe),{key:4,id:t.id,type:"date",modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,class:J({"border-destructive":W(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(u(),B(e(ct),{key:5,modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f},{default:c(()=>[r(e(ft),{class:J({"border-destructive":W(t.id)})},{default:c(()=>[r(e(mt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),r(e(pt),null,{default:c(()=>[(u(!0),m(Y,null,Q(t.options,f=>(u(),B(e(_t),{key:f,value:f},{default:c(()=>[x(b(f),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(u(),m("div",Ha,[(u(!0),m(Y,null,Q(t.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[dt(l("input",{id:`${t.id}_${f}`,name:t.id,type:"radio",value:f,"onUpdate:modelValue":ce=>e(a).formulario_data[t.id]=ce,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Xa),[[nt,e(a).formulario_data[t.id]]]),r(e(ae),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[x(b(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(u(),m("div",Qa,[(u(!0),m(Y,null,Q(t.options,f=>(u(),m("div",{key:f,class:"flex items-center space-x-2"},[r(e(ut),{id:`${t.id}_${f}`,checked:e(a).formulario_data[t.id].includes(f),"onUpdate:checked":ce=>{if(ce)e(a).formulario_data[t.id].includes(f)||e(a).formulario_data[t.id].push(f);else{const Le=e(a).formulario_data[t.id].indexOf(f);Le>-1&&e(a).formulario_data[t.id].splice(Le,1)}}},null,8,["id","checked","onUpdate:checked"]),r(e(ae),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:c(()=>[x(b(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(u(),m("div",Za,[r(yt,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,onFilesSelected:f=>F(t.id,f),label:"",description:"",required:t.required,multiple:((re=t.fileConfig)==null?void 0:re.multiple)||!1,"max-files":((xe=t.fileConfig)==null?void 0:xe.maxFiles)||5,"max-file-size":((ke=t.fileConfig)==null?void 0:ke.maxFileSize)||10,accept:((Se=t.fileConfig)==null?void 0:Se.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(a).errors[`formulario_data.${t.id}`],disabled:e(a).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(u(),m("div",er,[r(sa,{modelValue:e(a).formulario_data[t.id],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,required:t.required,disabled:e(a).processing||n.is_editing&&((we=n.candidatura)==null?void 0:we.estado)!=="borrador","filtrar-por-ubicacion":(($e=t.convocatoriaConfig)==null?void 0:$e.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"]),W(t.id)?(u(),m("div",tr,b(e(a).errors[`formulario_data.${t.id}`]),1)):V("",!0)])):t.type==="datepicker"?(u(),m("div",ar,[r(ht,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-date":(Ce=t.datepickerConfig)==null?void 0:Ce.minDate,"max-date":(Ee=t.datepickerConfig)==null?void 0:Ee.maxDate,format:((Te=t.datepickerConfig)==null?void 0:Te.format)||"DD/MM/YYYY","allow-past-dates":((Ve=t.datepickerConfig)==null?void 0:Ve.allowPastDates)??!0,"allow-future-dates":((Ae=t.datepickerConfig)==null?void 0:Ae.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(u(),m("div",rr,[r(xt,{"model-value":e(a).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"disclaimer-text":((je=t.disclaimerConfig)==null?void 0:je.disclaimerText)||"","modal-title":((Ue=t.disclaimerConfig)==null?void 0:Ue.modalTitle)||"Términos y Condiciones","accept-button-text":((Oe=t.disclaimerConfig)==null?void 0:Oe.acceptButtonText)||"Acepto","decline-button-text":((Fe=t.disclaimerConfig)==null?void 0:Fe.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(u(),m("div",sr,[r(kt,{"model-value":e(a).formulario_data[t.id]||[],"onUpdate:modelValue":f=>e(a).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(a).processing,error:e(a).errors[`formulario_data.${t.id}`],"min-items":((qe=t.repeaterConfig)==null?void 0:qe.minItems)||0,"max-items":((Ie=t.repeaterConfig)==null?void 0:Ie.maxItems)||10,"item-name":((Ne=t.repeaterConfig)==null?void 0:Ne.itemName)||"Elemento","add-button-text":((De=t.repeaterConfig)==null?void 0:De.addButtonText)||"Agregar elemento","remove-button-text":((Be=t.repeaterConfig)==null?void 0:Be.removeButtonText)||"Eliminar",fields:((Pe=t.repeaterConfig)==null?void 0:Pe.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):V("",!0),W(t.id)?(u(),m("p",ir,b(e(a).errors[`formulario_data.${t.id}`]),1)):V("",!0)])}),128))]),_:1}),e(a).errors.general?(u(),m("div",or,[l("p",dr,b(e(a).errors.general),1)])):V("",!0),l("div",nr,[r(e(se),{variant:"outline",type:"button",onClick:d[1]||(d[1]=t=>n.$inertia.visit("/candidaturas"))},{default:c(()=>d[11]||(d[11]=[x(" Cancelar ")])),_:1}),r(e(se),{type:"submit",disabled:!D.value||e(a).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400"},{default:c(()=>[r(e(Ye),{class:"mr-2 h-4 w-4"}),x(" "+b(C.value),1)]),_:1},8,["disabled"])])],32)]}),_:1})]),_:1})]),r(lt,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:c(()=>[(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&!e(a).processing?(u(),m("div",lr,[r(e(se),{onClick:S,disabled:e(O),size:"lg",class:"shadow-lg hover:shadow-xl transition-shadow duration-200"},{default:c(()=>[e(O)?(u(),m(Y,{key:0},[r(e(ge),{class:"mr-2 h-5 w-5 animate-spin"}),d[12]||(d[12]=x(" Guardando... "))],64)):(u(),m(Y,{key:1},[r(e(Ye),{class:"mr-2 h-5 w-5"}),d[13]||(d[13]=x(" Guardar como borrador "))],64))]),_:1},8,["disabled"])])):V("",!0)]),_:1})]}),_:1})],64))}}),ts=$t(ur,[["__scopeId","data-v-9e52d48f"]]);export{ts as default};
