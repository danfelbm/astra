import{_ as ze}from"./AdminLayout.vue_vue_type_script_setup_true_lang-s8UCj-v6.js";import{d as ae,r as S,c as re,D as Ce,i as c,e as r,g as o,j as q,f as t,s as Ee,l as ge,u as e,n as T,b as h,h as n,t as v,w as a,F as U,k as M,o as Ve,a as _e,m as Ue,C as qe,p as je,W as ne}from"./app-MhRkZYda.js";import{_ as B,a as Y,b as Z,c as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-l03Rvke8.js";import{c as Le,_ as C}from"./createLucideIcon-CtoO_Kiv.js";import{_ as H}from"./Input.vue_vue_type_script_setup_true_lang-BIqg1Ebh.js";import{_ as X}from"./Label.vue_vue_type_script_setup_true_lang-dAqUlvBp.js";import{_ as R}from"./index-D9cSDYZw.js";import{_ as Pe,a as Ae,b as te,c as Q,d as He,e as I}from"./TableHeader.vue_vue_type_script_setup_true_lang-RJeosXWc.js";import{C as De,_ as de,a as ue,b as ce,c as me,d as pe}from"./SelectValue.vue_vue_type_script_setup_true_lang-Cw5PJOxU.js";import{t as D}from"./index-C4AhATEj.js";import{_ as Be,a as Me,b as Re,c as Oe,d as Fe,e as he}from"./index-DpGSr-Ww.js";import{_ as Ge,a as We,b as Xe}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Bt1CH-vI.js";import{C as ie}from"./chevron-right-CLygI0q1.js";import{C as Se}from"./check-DIKoOxln.js";import{C as Je}from"./chevrons-up-down-B_e-HSmn.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as be}from"./trash-2-BhEX4Sbt.js";import{u as Ke,T as Qe}from"./useEtiquetaHierarchy-cXKsOBMP.js";import{S as Ye}from"./search-CWj5t0jZ.js";import{L as Ze}from"./loader-circle-Dpwo_WT3.js";import{_ as et,a as tt,b as xe,c as ke}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CHhWzZpt.js";import{P as fe}from"./plus-qawNJpnW.js";import{S as se}from"./save-BCqaoal8.js";import{X as oe}from"./x-DDu6o8kn.js";import{L as at}from"./list-IH8fxzaF.js";import{a as ve}from"./target-B9U4ycgp.js";import{S as we}from"./square-pen-DZZBQ3vz.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-D128fxVw.js";import"./index-CKzDzxRj.js";import"./floating-ui.vue-Jtid5Cir.js";import"./index-CGlb_uG-.js";import"./shield-C7We-wCE.js";import"./user-ByVghZe9.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-ZgmtTIfd.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BtbY9BuF.js";import"./VisuallyHidden-ClD0DDsS.js";import"./index-D1N0p-74.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-ZdbDwAbT.js";import"./circle-alert-Crskc4s_.js";import"./map-pin-B5DXokRd.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-ZZIvmMj6.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BqmWBxIU.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DoAxHmi0.js";import"./users-jwOqaBj3.js";import"./vote-BbOfLgcg.js";import"./folder-open-CJtFOPOB.js";import"./send-B-3fqeSw.js";import"./file-text-CSf3KGSt.js";import"./briefcase-BhQcV9fE.js";import"./calendar-G1jntOAT.js";import"./megaphone-l3pQSHwh.js";import"./user-check-TX_Nop_V.js";import"./mail-D2iFew9f.js";import"./message-square-DqgXAPvJ.js";import"./external-link-D5LXOYvq.js";import"./panel-left-Bv2yObtj.js";import"./index-DhGDRjjN.js";import"./nullish-CHIgUVhi.js";import"./useKbd-kRIii9yh.js";import"./utils-D9jgK0ly.js";import"./VisuallyHiddenInput-Bw6ddUlF.js";import"./RovingFocusItem-CbR6igbu.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=Le("PenIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),st={class:"flex items-center w-full"},ot={key:1,class:"w-5"},rt={class:"flex-1 min-w-0"},it={class:"truncate"},nt={key:0,class:"text-xs text-muted-foreground ml-1"},dt={key:0,class:"text-xs text-muted-foreground ml-1"},ut=ae({__name:"EtiquetaTreeItem",props:{etiqueta:{},nivel:{default:0},selectedId:{},excludedId:{},showCategoria:{type:Boolean,default:!1}},emits:["select"],setup(O,{emit:A}){const _=O,N=A,b=S(_.nivel<2),w=re(()=>_.excludedId?_.etiqueta.id===_.excludedId:!1),$=()=>{b.value=!b.value},V=f=>{w.value||N("select",f)};return(f,u)=>{const s=Ce("EtiquetaTreeItem",!0);return r(),c("div",null,[o("div",{class:T(["relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",{"opacity-50":w.value}]),onClick:u[0]||(u[0]=()=>!w.value&&V(f.etiqueta))},[o("div",st,[o("span",{class:"flex-shrink-0",style:Ee({width:`${f.nivel*20}px`})},null,4),f.etiqueta.children&&f.etiqueta.children.length>0?(r(),c("button",{key:0,onClick:ge($,["stop"]),class:"mr-1 p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ie),{class:T(["h-3 w-3 transition-transform",b.value?"rotate-90":""])},null,8,["class"])])):(r(),c("span",ot)),t(e(Se),{class:T(["mr-2 h-4 w-4 flex-shrink-0",f.selectedId===f.etiqueta.id?"opacity-100":"opacity-0"])},null,8,["class"]),o("div",rt,[o("span",it,[n(v(f.etiqueta.nombre)+" ",1),f.showCategoria&&f.etiqueta.categoria?(r(),c("span",nt," ("+v(f.etiqueta.categoria.nombre)+") ",1)):q("",!0)]),f.etiqueta.children&&f.etiqueta.children.length>0?(r(),c("span",dt," ("+v(f.etiqueta.children.length)+") ",1)):q("",!0),f.etiqueta.usos_count>0?(r(),h(e(R),{key:1,variant:"secondary",class:"ml-2 text-xs"},{default:a(()=>[n(v(f.etiqueta.usos_count)+" usos ",1)]),_:1})):q("",!0)])])],2),b.value&&f.etiqueta.children?(r(!0),c(U,{key:0},M(f.etiqueta.children,y=>(r(),h(s,{key:y.id,etiqueta:y,nivel:f.nivel+1,"selected-id":f.selectedId,"excluded-id":f.excludedId,"show-categoria":f.showCategoria,onSelect:V},null,8,["etiqueta","nivel","selected-id","excluded-id","show-categoria"]))),128)):q("",!0)])}}}),ct={class:"etiqueta-hierarchy-selector"},mt={key:0,class:"truncate"},pt={key:0,class:"text-muted-foreground text-xs mr-1"},ft={key:1,class:"text-muted-foreground"},vt={key:0,class:"text-xs text-muted-foreground mt-1"},gt=ae({__name:"EtiquetaHierarchySelector",props:{modelValue:{},label:{default:"Etiqueta Padre"},placeholder:{default:"Seleccionar etiqueta padre..."},allowNull:{type:Boolean,default:!0},excludedId:{},categorias:{},id:{default:"etiqueta-padre"}},emits:["update:modelValue"],setup(O,{emit:A}){const _=O,N=A,b=S(!1),w=S(""),$=S([]),V=S(!1),f=re(()=>_.modelValue&&$.value.find(m=>m.id===_.modelValue)||null),u=re(()=>_.categorias?w.value?_.categorias.filter(m=>y(m.id).some(g=>g.nombre.toLowerCase().includes(w.value.toLowerCase())||g.descripcion&&g.descripcion.toLowerCase().includes(w.value.toLowerCase()))):_.categorias:[]),s=m=>$.value.filter(g=>g.categoria_etiqueta_id===m&&!g.parent_id&&g.id!==_.excludedId),y=m=>$.value.filter(g=>g.categoria_etiqueta_id===m&&g.id!==_.excludedId),J=m=>{const g=[m.nombre];let E=m;for(;E.parent_id;){const L=$.value.find(K=>K.id===E.parent_id);if(!L)break;g.unshift(L.nombre),E=L}return g.join(" / ")},j=async()=>{V.value=!0;try{const m=await _e.get("/admin/etiquetas/para-selector",{params:{excluir_id:_.excludedId}});m.data.success&&($.value=m.data.etiquetas)}catch(m){console.error("Error cargando etiquetas:",m)}finally{V.value=!1}},z=m=>{N("update:modelValue",(m==null?void 0:m.id)||null),b.value=!1};return Ve(()=>{j()}),(m,g)=>(r(),c("div",ct,[t(e(X),{for:m.id},{default:a(()=>[n(v(m.label),1)]),_:1},8,["for"]),t(e(Ge),{open:b.value,"onUpdate:open":g[2]||(g[2]=E=>b.value=E)},{default:a(()=>[t(e(We),{asChild:""},{default:a(()=>[t(e(C),{id:m.id,variant:"outline",role:"combobox","aria-expanded":b.value,"aria-label":m.label,class:"w-full justify-between"},{default:a(()=>[f.value?(r(),c("span",mt,[f.value.parent?(r(),c("span",pt,v(f.value.parent.nombre)+" / ",1)):q("",!0),n(" "+v(f.value.nombre),1)])):(r(),c("span",ft,v(m.placeholder),1)),t(e(Je),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["id","aria-expanded","aria-label"])]),_:1}),t(e(Xe),{class:"w-[400px] p-0"},{default:a(()=>[t(e(Be),null,{default:a(()=>[t(e(Me),{placeholder:"Buscar etiqueta...",modelValue:w.value,"onUpdate:modelValue":g[0]||(g[0]=E=>w.value=E)},null,8,["modelValue"]),t(e(Re),null,{default:a(()=>[t(e(Oe),null,{default:a(()=>[...g[3]||(g[3]=[n("No se encontraron etiquetas.",-1)])]),_:1}),m.allowNull?(r(),h(e(he),{key:0},{default:a(()=>[t(e(Fe),{value:"",onSelect:g[1]||(g[1]=E=>z(null))},{default:a(()=>[t(e(Se),{class:T(["mr-2 h-4 w-4",m.modelValue?"opacity-0":"opacity-100"])},null,8,["class"]),g[4]||(g[4]=o("span",{class:"text-muted-foreground"},"Sin etiqueta padre (raíz)",-1))]),_:1})]),_:1})):q("",!0),(r(!0),c(U,null,M(u.value,E=>(r(),h(e(he),{key:E.id,heading:E.nombre},{default:a(()=>[(r(!0),c(U,null,M(s(E.id),L=>(r(),h(ut,{key:L.id,etiqueta:L,nivel:0,"selected-id":m.modelValue,"excluded-id":m.excludedId,onSelect:z},null,8,["etiqueta","selected-id","excluded-id"]))),128))]),_:2},1032,["heading"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),f.value?(r(),c("p",vt," Ruta: "+v(J(f.value)),1)):q("",!0)]))}}),$e=ye(gt,[["__scopeId","data-v-bcdf1be4"]]),_t={class:"tree-node"},bt={key:1,class:"w-5"},yt={class:"flex-1 font-medium"},qt={key:0,class:"text-xs text-muted-foreground ml-1"},ht={class:"flex gap-1"},xt={class:"flex gap-1"},kt={key:0},wt=ae({__name:"EtiquetaTreeNode",props:{etiqueta:{},nivel:{default:0},expandidos:{},dragDropHelpers:{}},emits:["toggle","edit","delete","drop"],setup(O,{emit:A}){const _=O,N=A,b=S(!1),w=s=>{s.dataTransfer.effectAllowed="move",_.dragDropHelpers.handleDragStart(_.etiqueta)},$=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",b.value=!0,_.dragDropHelpers.handleDragOver(s,_.etiqueta)},V=()=>{b.value=!1},f=s=>{s.preventDefault(),s.stopPropagation(),b.value=!1;const y=_.dragDropHelpers.handleDrop(s,_.etiqueta);y&&y.valido&&N("drop",y)},u=()=>{b.value=!1,_.dragDropHelpers.handleDragEnd()};return(s,y)=>{var j;const J=Ce("EtiquetaTreeNode",!0);return r(),c("div",_t,[o("div",{class:T(["flex items-center gap-2 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700","transition-colors cursor-move",b.value?"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-300":""]),style:Ee({paddingLeft:s.nivel*24+"px"}),draggable:"true",onDragstart:w,onDragover:$,onDrop:f,onDragend:u,onDragleave:V},[s.etiqueta.children&&s.etiqueta.children.length>0?(r(),c("button",{key:0,onClick:y[0]||(y[0]=z=>s.$emit("toggle",s.etiqueta.id)),class:"p-0.5 hover:bg-accent rounded",type:"button"},[t(e(ie),{class:T(["h-4 w-4 transition-transform",s.expandidos.has(s.etiqueta.id)?"rotate-90":""])},null,8,["class"])])):(r(),c("span",bt)),(j=s.etiqueta.categoria)!=null&&j.color?(r(),c("div",{key:2,class:T(["w-3 h-3 rounded-full",s.etiqueta.categoria.color])},null,2)):q("",!0),o("span",yt,[n(v(s.etiqueta.nombre)+" ",1),s.etiqueta.categoria?(r(),c("span",qt," ("+v(s.etiqueta.categoria.nombre)+") ",1)):q("",!0)]),o("div",ht,[s.etiqueta.usos_count>0?(r(),h(e(R),{key:0,variant:"secondary",class:"text-xs"},{default:a(()=>[n(v(s.etiqueta.usos_count)+" usos ",1)]),_:1})):q("",!0),s.etiqueta.children&&s.etiqueta.children.length>0?(r(),h(e(R),{key:1,variant:"outline",class:"text-xs"},{default:a(()=>[n(v(s.etiqueta.children.length),1)]),_:1})):q("",!0)]),o("div",xt,[t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7",onClick:y[1]||(y[1]=ge(z=>s.$emit("edit",s.etiqueta),["stop"]))},{default:a(()=>[t(e(lt),{class:"h-3 w-3"})]),_:1}),t(e(C),{variant:"ghost",size:"icon",class:"h-7 w-7 text-red-500 hover:text-red-600",onClick:y[2]||(y[2]=ge(z=>s.$emit("delete",s.etiqueta),["stop"]))},{default:a(()=>[t(e(be),{class:"h-3 w-3"})]),_:1})])],38),s.expandidos.has(s.etiqueta.id)&&s.etiqueta.children?(r(),c("div",kt,[(r(!0),c(U,null,M(s.etiqueta.children,z=>(r(),h(J,{key:z.id,etiqueta:z,nivel:s.nivel+1,expandidos:s.expandidos,"drag-drop-helpers":s.dragDropHelpers,onToggle:y[3]||(y[3]=m=>s.$emit("toggle",m)),onEdit:y[4]||(y[4]=m=>s.$emit("edit",m)),onDelete:y[5]||(y[5]=m=>s.$emit("delete",m)),onDrop:y[6]||(y[6]=m=>s.$emit("drop",m))},null,8,["etiqueta","nivel","expandidos","drag-drop-helpers"]))),128))])):q("",!0)])}}}),$t=ye(wt,[["__scopeId","data-v-b5f23538"]]),Ct={class:"etiqueta-tree-view"},Et={class:"mb-4 flex gap-2 items-center"},Vt={class:"ml-auto flex items-center gap-2"},Dt={class:"border rounded-lg p-4 bg-white dark:bg-gray-800"},St={key:0,class:"flex justify-center py-8"},It={key:1,class:"text-center py-8 text-muted-foreground"},Tt={key:2,class:"space-y-1"},Nt={key:0,class:"mt-4 grid grid-cols-4 gap-4"},zt={class:"text-2xl font-bold"},Ut={class:"text-2xl font-bold"},jt={class:"text-2xl font-bold"},Lt={class:"text-2xl font-bold"},Pt=ae({__name:"EtiquetaTreeView",props:{etiquetas:{},categoriaId:{},showStats:{type:Boolean,default:!1}},emits:["edit","delete","moved"],setup(O,{emit:A}){const _=O,N=A,b=S(!1),w=S(""),$=S([]),{etiquetas:V,expandidos:f,estadisticas:u,construirArbol:s,filtrarArbol:y,toggleExpansion:J,expandirTodos:j,colapsarTodos:z,dragDropHelpers:m}=Ke($),g=async()=>{if(_.etiquetas){$.value=s(_.etiquetas);return}b.value=!0;try{const k=await _e.get("/admin/etiquetas/arbol",{params:{categoria_id:_.categoriaId}});k.data.success&&($.value=k.data.arbol)}catch(k){console.error("Error cargando árbol de etiquetas:",k),D.error("Error al cargar las etiquetas")}finally{b.value=!1}},E=re(()=>w.value?y(w.value,V.value):V.value);let L;const K=()=>{clearTimeout(L),L=setTimeout(()=>{},300)},le=async k=>{var x,F;if(k.valido){b.value=!0;try{(await _e.post(`/admin/etiquetas/${k.hijoId}/establecer-padre`,{parent_id:k.padreId})).data.success&&(D.success("Etiqueta movida exitosamente"),N("moved",{etiquetaId:k.hijoId,nuevoPadreId:k.padreId}),await g())}catch(G){D.error(((F=(x=G.response)==null?void 0:x.data)==null?void 0:F.message)||"Error al mover la etiqueta")}finally{b.value=!1}}};return Ue(()=>_.etiquetas,k=>{k&&($.value=s(k))}),Ve(()=>{g()}),(k,x)=>(r(),c("div",Ct,[o("div",Et,[t(e(H),{modelValue:w.value,"onUpdate:modelValue":x[0]||(x[0]=F=>w.value=F),placeholder:"Buscar etiquetas...",class:"max-w-sm",onInput:K},{prefix:a(()=>[t(e(Ye),{class:"h-4 w-4 text-muted-foreground"})]),_:1},8,["modelValue"]),t(e(C),{variant:"outline",size:"sm",onClick:e(j)},{default:a(()=>[t(e(De),{class:"h-4 w-4 mr-1"}),x[3]||(x[3]=n(" Expandir todo ",-1))]),_:1},8,["onClick"]),t(e(C),{variant:"outline",size:"sm",onClick:e(z)},{default:a(()=>[t(e(ie),{class:"h-4 w-4 mr-1"}),x[4]||(x[4]=n(" Colapsar todo ",-1))]),_:1},8,["onClick"]),o("div",Vt,[t(e(R),{variant:"secondary"},{default:a(()=>[n(v(e(u).totalNodos)+" etiquetas",1)]),_:1}),t(e(R),{variant:"outline"},{default:a(()=>[n(v(e(u).profundidadMaxima)+" niveles",1)]),_:1})])]),o("div",Dt,[b.value?(r(),c("div",St,[t(e(Ze),{class:"h-8 w-8 animate-spin text-muted-foreground"})])):E.value.length===0?(r(),c("div",It," No se encontraron etiquetas ")):(r(),c("div",Tt,[(r(!0),c(U,null,M(E.value,F=>(r(),h($t,{key:F.id,etiqueta:F,nivel:0,expandidos:e(f),"drag-drop-helpers":e(m),onToggle:e(J),onEdit:x[1]||(x[1]=G=>k.$emit("edit",G)),onDelete:x[2]||(x[2]=G=>k.$emit("delete",G)),onDrop:le},null,8,["etiqueta","expandidos","drag-drop-helpers","onToggle"]))),128))]))]),k.showStats?(r(),c("div",Nt,[t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[5]||(x[5]=[n("Total",-1)])]),_:1})]),_:1}),t(e(P),null,{default:a(()=>[o("div",zt,v(e(u).totalNodos),1)]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[6]||(x[6]=[n("Raíces",-1)])]),_:1})]),_:1}),t(e(P),null,{default:a(()=>[o("div",Ut,v(e(u).totalRaices),1)]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[7]||(x[7]=[n("Con hijos",-1)])]),_:1})]),_:1}),t(e(P),null,{default:a(()=>[o("div",jt,v(e(u).totalConHijos),1)]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(Y),{class:"pb-2"},{default:a(()=>[t(e(Z),{class:"text-sm font-medium"},{default:a(()=>[...x[8]||(x[8]=[n("Profundidad",-1)])]),_:1})]),_:1}),t(e(P),null,{default:a(()=>[o("div",Lt,v(e(u).profundidadMaxima),1)]),_:1})]),_:1})])):q("",!0)]))}}),At=ye(Pt,[["__scopeId","data-v-e813d647"]]),Ht={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Bt={class:"flex justify-between items-center"},Mt={key:0,class:"grid grid-cols-3 gap-4"},Rt={class:"text-2xl font-bold"},Ot={class:"text-2xl font-bold"},Ft={class:"text-2xl font-bold"},Gt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Wt={key:0,class:"text-xs text-red-500 mt-1"},Xt={class:"flex items-center gap-2"},Jt={class:"flex items-center gap-2"},Kt={class:"md:col-span-2"},Qt={class:"flex gap-2 mt-4"},Yt={class:"flex items-center justify-between"},Zt={class:"flex items-center gap-2"},ea={class:"flex items-center gap-2"},ta={class:"flex justify-end gap-2"},aa={class:"flex items-center gap-2"},la={class:"flex items-center gap-2"},sa={class:"flex items-center gap-2"},oa={class:"flex justify-end gap-2"},ra={class:"p-4 space-y-4"},ia={class:"flex items-center justify-between"},na={class:"font-medium flex items-center gap-2"},da={class:"grid grid-cols-1 gap-4"},ua={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ca={class:"flex gap-2 mt-4"},ma={key:1,class:"space-y-2"},pa={key:0,class:"flex-1"},fa={class:"grid grid-cols-2 gap-4 mb-2"},va={class:"flex gap-2 items-end"},ga={class:"flex-1"},_a={key:1,class:"flex-1 flex items-center justify-between"},ba={class:"flex items-center gap-2"},ya={class:"font-medium"},qa={key:0,class:"text-sm text-gray-500"},ha={key:1,class:"text-xs text-muted-foreground mt-1"},xa={class:"flex gap-2"},ka={key:2,class:"text-center py-8 text-gray-500"},Tl=ae({__name:"Index",props:{categorias:{},estadisticas:{},colores:{},iconos:{}},setup(O){const A=O,_=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:"Categorías de Etiquetas",href:"/admin/categorias-etiquetas"}],N=S(null),b=S(!1),w=S(new Set),$=S(null),V=S(null),f=S("table"),u=qe({nombre:"",color:"gray",icono:"Tag",descripcion:"",orden:0}),s=qe({nombre:"",descripcion:"",categoria_etiqueta_id:0,parent_id:null}),y=()=>{b.value=!0,N.value=null,u.reset()},J=d=>{N.value=d.id,b.value=!1,u.nombre=d.nombre,u.color=d.color,u.icono=d.icono||"Tag",u.descripcion=d.descripcion||"",u.orden=d.orden},j=()=>{N.value=null,b.value=!1,u.reset()},z=()=>{u.post("/admin/categorias-etiquetas",{preserveScroll:!0,onSuccess:()=>{D.success("Categoría creada exitosamente"),j()},onError:()=>{D.error("Error al crear la categoría")}})},m=d=>{u.put(`/admin/categorias-etiquetas/${d}`,{preserveScroll:!0,onSuccess:()=>{D.success("Categoría actualizada"),j()},onError:()=>{D.error("Error al actualizar")}})},g=d=>{confirm(`¿Eliminar la categoría "${d.nombre}"? Las etiquetas se reasignarán.`)&&ne.delete(`/admin/categorias-etiquetas/${d.id}`,{preserveScroll:!0,onSuccess:()=>{D.success("Categoría eliminada")}})},E=d=>{ne.patch(`/admin/categorias-etiquetas/${d.id}/toggle-active`,{},{preserveScroll:!0,onSuccess:()=>{D.success(d.activo?"Categoría desactivada":"Categoría activada")}})},L=d=>{const l=w.value;l.has(d)?l.delete(d):l.add(d)},K=d=>{$.value=d,V.value=null,s.reset(),s.categoria_etiqueta_id=d},le=d=>{V.value=d.id,$.value=null,s.nombre=d.nombre,s.descripcion=d.descripcion||"",s.categoria_etiqueta_id=d.categoria_etiqueta_id,s.parent_id=d.parent_id||null},k=()=>{$.value=null,V.value=null,s.reset()},x=()=>{s.post("/admin/etiquetas",{preserveScroll:!0,onSuccess:()=>{D.success("Etiqueta creada exitosamente"),k()},onError:()=>{D.error("Error al crear la etiqueta")}})},F=d=>{s.put(`/admin/etiquetas/${d}`,{preserveScroll:!0,onSuccess:()=>{D.success("Etiqueta actualizada exitosamente"),k()},onError:()=>{D.error("Error al actualizar la etiqueta")}})},G=d=>{confirm("¿Estás seguro de eliminar esta etiqueta?")&&ne.delete(`/admin/etiquetas/${d}`,{preserveScroll:!0,onSuccess:()=>{D.success("Etiqueta eliminada exitosamente")},onError:()=>{D.error("Error al eliminar la etiqueta")}})},ee=d=>({gray:"bg-gray-500",red:"bg-red-500",orange:"bg-orange-500",amber:"bg-amber-500",yellow:"bg-yellow-500",lime:"bg-lime-500",green:"bg-green-500",emerald:"bg-emerald-500",teal:"bg-teal-500",cyan:"bg-cyan-500",sky:"bg-sky-500",blue:"bg-blue-500",indigo:"bg-indigo-500",violet:"bg-violet-500",purple:"bg-purple-500",fuchsia:"bg-fuchsia-500",pink:"bg-pink-500",rose:"bg-rose-500"})[d]||"bg-gray-500",Ie=()=>{const d=[];return A.categorias.data.forEach(l=>{l.etiquetas&&l.etiquetas.forEach(i=>{d.push({...i,categoria:{id:l.id,nombre:l.nombre,color:l.color,icono:l.icono,descripcion:l.descripcion,orden:l.orden,activo:l.activo}})})}),d},Te=d=>{const l=A.categorias.data.find(i=>i.id===d.categoria_etiqueta_id);l&&(w.value.add(l.id),f.value="table",le(d))},Ne=d=>{G(d.id)};return(d,l)=>(r(),c(U,null,[t(e(je),{title:"Categorías de Etiquetas"}),t(ze,{breadcrumbs:_},{default:a(()=>[o("div",Ht,[o("div",Bt,[l[16]||(l[16]=o("div",null,[o("h1",{class:"text-2xl font-bold"},"Categorías de Etiquetas"),o("p",{class:"text-sm text-muted-foreground mt-1"}," Administra las categorías para organizar las etiquetas de proyectos ")],-1)),b.value?q("",!0):(r(),h(e(C),{key:0,onClick:y},{default:a(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),l[15]||(l[15]=n(" Nueva Categoría ",-1))]),_:1}))]),d.estadisticas?(r(),c("div",Mt,[t(e(B),null,{default:a(()=>[t(e(P),{class:"pt-6"},{default:a(()=>[o("div",Rt,v(d.estadisticas.total_categorias),1),l[17]||(l[17]=o("p",{class:"text-xs text-muted-foreground"},"Categorías totales",-1))]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(P),{class:"pt-6"},{default:a(()=>[o("div",Ot,v(d.estadisticas.categorias_activas),1),l[18]||(l[18]=o("p",{class:"text-xs text-muted-foreground"},"Categorías activas",-1))]),_:1})]),_:1}),t(e(B),null,{default:a(()=>[t(e(P),{class:"pt-6"},{default:a(()=>[o("div",Ft,v(d.estadisticas.total_etiquetas),1),l[19]||(l[19]=o("p",{class:"text-xs text-muted-foreground"},"Etiquetas totales",-1))]),_:1})]),_:1})])):q("",!0),b.value?(r(),h(e(B),{key:1},{default:a(()=>[t(e(Y),null,{default:a(()=>[t(e(Z),null,{default:a(()=>[...l[20]||(l[20]=[n("Nueva Categoría",-1)])]),_:1})]),_:1}),t(e(P),null,{default:a(()=>[o("div",Gt,[o("div",null,[t(e(X),null,{default:a(()=>[...l[21]||(l[21]=[n("Nombre *",-1)])]),_:1}),t(e(H),{modelValue:e(u).nombre,"onUpdate:modelValue":l[0]||(l[0]=i=>e(u).nombre=i),placeholder:"Nombre de la categoría",class:T({"border-red-500":e(u).errors.nombre})},null,8,["modelValue","class"]),e(u).errors.nombre?(r(),c("p",Wt,v(e(u).errors.nombre),1)):q("",!0)]),o("div",null,[t(e(X),null,{default:a(()=>[...l[22]||(l[22]=[n("Color",-1)])]),_:1}),t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[1]||(l[1]=i=>e(u).color=i)},{default:a(()=>[t(e(ue),null,{default:a(()=>[o("div",Xt,[o("div",{class:T([ee(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(ce),{placeholder:e(u).color},null,8,["placeholder"])])]),_:1}),t(e(me),null,{default:a(()=>[(r(!0),c(U,null,M(d.colores,i=>(r(),h(e(pe),{key:i,value:i},{default:a(()=>[o("div",Jt,[o("div",{class:T([ee(i),"w-4 h-4 rounded"])},null,2),n(" "+v(i),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",null,[t(e(X),null,{default:a(()=>[...l[23]||(l[23]=[n("Icono",-1)])]),_:1}),t(e(de),{modelValue:e(u).icono,"onUpdate:modelValue":l[2]||(l[2]=i=>e(u).icono=i)},{default:a(()=>[t(e(ue),null,{default:a(()=>[t(e(ce),{placeholder:e(u).icono},null,8,["placeholder"])]),_:1}),t(e(me),null,{default:a(()=>[(r(!0),c(U,null,M(d.iconos,i=>(r(),h(e(pe),{key:i,value:i},{default:a(()=>[n(v(i),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",null,[t(e(X),null,{default:a(()=>[...l[24]||(l[24]=[n("Orden",-1)])]),_:1}),t(e(H),{modelValue:e(u).orden,"onUpdate:modelValue":l[3]||(l[3]=i=>e(u).orden=i),modelModifiers:{number:!0},type:"number",placeholder:"0"},null,8,["modelValue"])]),o("div",Kt,[t(e(X),null,{default:a(()=>[...l[25]||(l[25]=[n("Descripción",-1)])]),_:1}),t(e(H),{modelValue:e(u).descripcion,"onUpdate:modelValue":l[4]||(l[4]=i=>e(u).descripcion=i),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),o("div",Qt,[t(e(C),{onClick:z,disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[26]||(l[26]=n(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:j},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[27]||(l[27]=n(" Cancelar ",-1))]),_:1})])]),_:1})]),_:1})):q("",!0),t(e(et),{modelValue:f.value,"onUpdate:modelValue":l[14]||(l[14]=i=>f.value=i)},{default:a(()=>[t(e(B),null,{default:a(()=>[t(e(Y),null,{default:a(()=>[o("div",Yt,[t(e(Z),null,{default:a(()=>[...l[28]||(l[28]=[n("Gestión de Etiquetas",-1)])]),_:1}),t(e(tt),null,{default:a(()=>[t(e(xe),{value:"table"},{default:a(()=>[t(e(at),{class:"h-4 w-4 mr-2"}),l[29]||(l[29]=n(" Vista de Tabla ",-1))]),_:1}),t(e(xe),{value:"tree"},{default:a(()=>[t(e(Qe),{class:"h-4 w-4 mr-2"}),l[30]||(l[30]=n(" Vista de Árbol ",-1))]),_:1})]),_:1})])]),_:1}),t(e(ke),{value:"table",class:"mt-0"},{default:a(()=>[t(e(P),{class:"p-0"},{default:a(()=>[t(e(Pe),null,{default:a(()=>[t(e(Ae),null,{default:a(()=>[t(e(te),null,{default:a(()=>[t(e(Q),null,{default:a(()=>[...l[31]||(l[31]=[n("Nombre",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[32]||(l[32]=[n("Color",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[33]||(l[33]=[n("Etiquetas",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[34]||(l[34]=[n("Orden",-1)])]),_:1}),t(e(Q),null,{default:a(()=>[...l[35]||(l[35]=[n("Estado",-1)])]),_:1}),t(e(Q),{class:"text-right"},{default:a(()=>[...l[36]||(l[36]=[n("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(e(He),null,{default:a(()=>[(r(!0),c(U,null,M(d.categorias.data,i=>(r(),c(U,{key:i.id},[N.value===i.id?(r(),h(e(te),{key:0},{default:a(()=>[t(e(I),null,{default:a(()=>[t(e(H),{modelValue:e(u).nombre,"onUpdate:modelValue":l[5]||(l[5]=p=>e(u).nombre=p),class:"w-full"},null,8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[t(e(de),{modelValue:e(u).color,"onUpdate:modelValue":l[6]||(l[6]=p=>e(u).color=p)},{default:a(()=>[t(e(ue),{class:"w-32"},{default:a(()=>[o("div",Zt,[o("div",{class:T([ee(e(u).color),"w-4 h-4 rounded"])},null,2),t(e(ce))])]),_:1}),t(e(me),null,{default:a(()=>[(r(!0),c(U,null,M(d.colores,p=>(r(),h(e(pe),{key:p,value:p},{default:a(()=>[o("div",ea,[o("div",{class:T([ee(p),"w-4 h-4 rounded"])},null,2),n(" "+v(p),1)])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[n(v(i.etiquetas_count||0),1)]),_:2},1024),t(e(I),null,{default:a(()=>[t(e(H),{modelValue:e(u).orden,"onUpdate:modelValue":l[7]||(l[7]=p=>e(u).orden=p),modelModifiers:{number:!0},type:"number",class:"w-20"},null,8,["modelValue"])]),_:1}),t(e(I),null,{default:a(()=>[t(e(R),{variant:i.activo?"default":"secondary"},{default:a(()=>[n(v(i.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(I),{class:"text-right"},{default:a(()=>[o("div",ta,[t(e(C),{size:"sm",onClick:p=>m(i.id),disabled:e(u).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:j},{default:a(()=>[t(e(oe),{class:"h-4 w-4"})]),_:1})])]),_:2},1024)]),_:2},1024)):(r(),h(e(te),{key:1},{default:a(()=>[t(e(I),{class:"font-medium"},{default:a(()=>[o("div",aa,[t(e(ve),{class:"h-4 w-4 text-muted-foreground"}),n(" "+v(i.nombre),1)])]),_:2},1024),t(e(I),null,{default:a(()=>[o("div",la,[o("div",{class:T([ee(i.color),"w-4 h-4 rounded"])},null,2),n(" "+v(i.color),1)])]),_:2},1024),t(e(I),null,{default:a(()=>[o("div",sa,[t(e(C),{variant:"ghost",size:"sm",onClick:p=>L(i.id),class:"p-1"},{default:a(()=>[w.value.has(i.id)?(r(),h(e(De),{key:1,class:"h-4 w-4"})):(r(),h(e(ie),{key:0,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),t(e(R),{variant:"outline"},{default:a(()=>[n(v(i.etiquetas_count||0)+" etiquetas ",1)]),_:2},1024)])]),_:2},1024),t(e(I),null,{default:a(()=>[n(v(i.orden),1)]),_:2},1024),t(e(I),null,{default:a(()=>[t(e(R),{variant:i.activo?"default":"secondary",class:"cursor-pointer",onClick:p=>E(i)},{default:a(()=>[n(v(i.activo?"Activa":"Inactiva"),1)]),_:2},1032,["variant","onClick"])]),_:2},1024),t(e(I),{class:"text-right"},{default:a(()=>[o("div",oa,[t(e(C),{size:"sm",variant:"ghost",onClick:p=>J(i)},{default:a(()=>[t(e(we),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(e(C),{size:"sm",variant:"ghost",onClick:p=>g(i),class:"text-destructive hover:text-destructive"},{default:a(()=>[t(e(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),w.value.has(i.id)?(r(),h(e(te),{key:2,class:"bg-gray-50 dark:bg-gray-900/50"},{default:a(()=>[t(e(I),{colspan:"6",class:"p-0"},{default:a(()=>[o("div",ra,[o("div",ia,[o("h4",na,[t(e(ve),{class:"h-4 w-4"}),n(" Etiquetas de "+v(i.nombre),1)]),$.value!==i.id?(r(),h(e(C),{key:0,size:"sm",onClick:p=>K(i.id)},{default:a(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),l[37]||(l[37]=n(" Nueva Etiqueta ",-1))]),_:2},1032,["onClick"])):q("",!0)]),$.value===i.id?(r(),h(e(B),{key:0,class:"border-dashed"},{default:a(()=>[t(e(P),{class:"pt-4"},{default:a(()=>[o("div",da,[o("div",ua,[o("div",null,[t(e(X),null,{default:a(()=>[...l[38]||(l[38]=[n("Nombre *",-1)])]),_:1}),t(e(H),{modelValue:e(s).nombre,"onUpdate:modelValue":l[8]||(l[8]=p=>e(s).nombre=p),placeholder:"Nombre de la etiqueta",class:T({"border-red-500":e(s).errors.nombre})},null,8,["modelValue","class"])]),o("div",null,[t(e(X),null,{default:a(()=>[...l[39]||(l[39]=[n("Descripción",-1)])]),_:1}),t(e(H),{modelValue:e(s).descripcion,"onUpdate:modelValue":l[9]||(l[9]=p=>e(s).descripcion=p),placeholder:"Descripción opcional"},null,8,["modelValue"])])]),o("div",null,[t($e,{modelValue:e(s).parent_id,"onUpdate:modelValue":l[10]||(l[10]=p=>e(s).parent_id=p),categorias:[i],label:"Etiqueta Padre (Opcional)",placeholder:"Seleccionar etiqueta padre..."},null,8,["modelValue","categorias"])])]),o("div",ca,[t(e(C),{onClick:x,disabled:e(s).processing},{default:a(()=>[t(e(se),{class:"mr-2 h-4 w-4"}),l[40]||(l[40]=n(" Guardar ",-1))]),_:1},8,["disabled"]),t(e(C),{variant:"outline",onClick:k},{default:a(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),l[41]||(l[41]=n(" Cancelar ",-1))]),_:1})])]),_:2},1024)]),_:2},1024)):q("",!0),i.etiquetas&&i.etiquetas.length>0?(r(),c("div",ma,[(r(!0),c(U,null,M(i.etiquetas,p=>(r(),c("div",{key:p.id,class:"flex items-center justify-between p-3 border rounded-lg bg-white dark:bg-gray-800"},[V.value===p.id?(r(),c("div",pa,[o("div",fa,[t(e(H),{modelValue:e(s).nombre,"onUpdate:modelValue":l[11]||(l[11]=W=>e(s).nombre=W),placeholder:"Nombre"},null,8,["modelValue"]),t(e(H),{modelValue:e(s).descripcion,"onUpdate:modelValue":l[12]||(l[12]=W=>e(s).descripcion=W),placeholder:"Descripción"},null,8,["modelValue"])]),o("div",va,[o("div",ga,[t($e,{modelValue:e(s).parent_id,"onUpdate:modelValue":l[13]||(l[13]=W=>e(s).parent_id=W),categorias:[i],"excluded-id":p.id,label:"",placeholder:"Etiqueta padre..."},null,8,["modelValue","categorias","excluded-id"])]),t(e(C),{size:"sm",onClick:W=>F(p.id),disabled:e(s).processing},{default:a(()=>[t(e(se),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"]),t(e(C),{size:"sm",variant:"outline",onClick:k},{default:a(()=>[t(e(oe),{class:"h-4 w-4"})]),_:1})])])):(r(),c("div",_a,[o("div",null,[o("div",ba,[o("span",ya,v(p.nombre),1),p.parent?(r(),h(e(R),{key:0,variant:"outline",class:"text-xs"},{default:a(()=>[n(v(p.parent.nombre),1)]),_:2},1024)):q("",!0),p.tiene_hijos?(r(),h(e(R),{key:1,variant:"secondary",class:"text-xs"},{default:a(()=>[...l[42]||(l[42]=[n(" Tiene hijos ",-1)])]),_:1})):q("",!0)]),p.descripcion?(r(),c("p",qa,v(p.descripcion),1)):q("",!0),p.ruta_completa&&p.parent?(r(),c("p",ha," Ruta: "+v(p.ruta_completa),1)):q("",!0)]),o("div",xa,[t(e(C),{size:"sm",variant:"outline",onClick:W=>le(p)},{default:a(()=>[t(e(we),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(e(C),{size:"sm",variant:"outline",onClick:W=>G(p.id)},{default:a(()=>[t(e(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])]))]))),128))])):$.value!==i.id?(r(),c("div",ka,[t(e(ve),{class:"h-8 w-8 mx-auto mb-2 opacity-50"}),l[44]||(l[44]=o("p",null,"No hay etiquetas en esta categoría",-1)),t(e(C),{variant:"outline",size:"sm",class:"mt-2",onClick:p=>K(i.id)},{default:a(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),l[43]||(l[43]=n(" Crear primera etiqueta ",-1))]),_:2},1032,["onClick"])])):q("",!0)])]),_:2},1024)]),_:2},1024)):q("",!0)],64))),128)),d.categorias.data.length===0?(r(),h(e(te),{key:0},{default:a(()=>[t(e(I),{colspan:"6",class:"text-center text-muted-foreground py-8"},{default:a(()=>[...l[45]||(l[45]=[n(" No hay categorías creadas. Crea una nueva para empezar. ",-1)])]),_:1})]),_:1})):q("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ke),{value:"tree",class:"mt-0"},{default:a(()=>[t(e(P),null,{default:a(()=>[t(At,{etiquetas:Ie(),"show-stats":!0,onEdit:Te,onDelete:Ne},null,8,["etiquetas"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{Tl as default};
