import{d as Y,M as Z,r as S,c as h,s as E,p as tt,b as c,w as l,g as u,e as o,i as w,j as b,h as a,m as d,t as i,f as t,v as C,F as j,k as P,n as z}from"./app-D6dAgRLX.js";import{_ as et}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Cz-glReJ.js";import{_ as L,a as ot,b as lt,c as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-BQw5IOx1.js";import{_ as V}from"./createLucideIcon-BzNGXSjo.js";import{_ as at}from"./Input.vue_vue_type_script_setup_true_lang-DuD0GFro.js";import{_ as F}from"./index-CBkpfaqL.js";import{_ as st,a as rt,b as B,c as _,d as it,e as v}from"./TableHeader.vue_vue_type_script_setup_true_lang-CKcB2qmD.js";import{_ as U,a as I,b as O,c as G,d as m}from"./SelectValue.vue_vue_type_script_setup_true_lang-DG76JhhK.js";import{_ as nt,a as dt,b as ut,c as mt,d as D,e as k}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DMUE4uG3.js";import{u as ft}from"./useToast-8J5hJy0-.js";import{l as pt}from"./lodash-B1vBINbT.js";import{D as vt}from"./download-BwG6wXQo.js";import{P as ct}from"./plus-C49AY6-O.js";import{S as _t}from"./search-kppQIBB4.js";import{E as gt}from"./ellipsis-oKeRNb-b.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Dd_UFvqO.js";import"./index-DSEWetXw.js";import"./floating-ui.vue--JDGMVtr.js";import"./x-C6pIeSd3.js";import"./index-DLb5O1_B.js";import"./shield-Drtxwyw8.js";import"./user-DIRuEBTX.js";import"./chevron-right-qO-T1il-.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CiRPcZgR.js";import"./VisuallyHidden--Lm4nRgr.js";import"./index-EoZ2-QmR.js";import"./Label.vue_vue_type_script_setup_true_lang-Q5gYLrMD.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Da_i8rKq.js";import"./index-BK5ns8E0.js";import"./circle-alert-DekukOQx.js";import"./map-pin-AtpxFinO.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DxLvKcUN.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BwXO6dz4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-JPZaXIVQ.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DHedSr0Q.js";import"./tag-Ca5XM0he.js";import"./users-DXwPRikm.js";import"./target-Cpfg8aLR.js";import"./vote-DR8CIEv4.js";import"./folder-open-BcVEhVOT.js";import"./send-Dk0CLE13.js";import"./file-text-CJg7dKrK.js";import"./briefcase-BLKGTSev.js";import"./calendar-DAjXp43T.js";import"./megaphone-uRvYPiq8.js";import"./user-check-QQaxpol_.js";import"./clipboard-list-BSng4O3r.js";import"./mail-_uM3slzI.js";import"./message-square-BWTw75_k.js";import"./external-link-Ci8ypRzt.js";import"./panel-left-BHu1UMWX.js";import"./check-aWduzm_f.js";import"./index-CFZ09QFA.js";const xt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},bt={class:"flex justify-between items-center"},yt={class:"text-3xl font-bold"},$t={key:0,class:"text-sm text-gray-600"},kt={class:"flex gap-2"},Ct={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Et={class:"relative"},wt={class:"flex items-center gap-2"},Vt={key:0,class:"flex items-center justify-between"},Ft={class:"text-sm text-gray-600"},St={class:"flex gap-2"},ze=Y({__name:"Index",props:{contratos:{},filters:{},proyecto:{},estadisticas:{}},setup(n){const g=n,R=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"}];Z();const y=ft(),x=S(g.filters.search||""),f=S(g.filters.estado||"all"),p=S(g.filters.tipo||"all"),q=h(()=>x.value||f.value&&f.value!=="all"||p.value&&p.value!=="all"||g.filters.vencidos||g.filters.proximos_vencer),H=r=>({borrador:"bg-gray-100 text-gray-800",activo:"bg-green-100 text-green-800",finalizado:"bg-blue-100 text-blue-800",cancelado:"bg-red-100 text-red-800"})[r]||"bg-gray-100 text-gray-800",J=r=>({servicio:"bg-purple-100 text-purple-800",obra:"bg-orange-100 text-orange-800",suministro:"bg-indigo-100 text-indigo-800",consultoria:"bg-pink-100 text-pink-800",otro:"bg-gray-100 text-gray-800"})[r]||"bg-gray-100 text-gray-800",T=r=>r?new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",N=pt.debounce(()=>{var r;E.get(route("admin.contratos.index"),{search:x.value||void 0,estado:f.value==="all"?void 0:f.value,tipo:p.value==="all"?void 0:p.value,proyecto_id:(r=g.proyecto)==null?void 0:r.id,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})},300);tt([x,f,p],()=>{N()});const K=()=>{x.value="",f.value="all",p.value="all",N()},Q=r=>{confirm(`¿Está seguro de eliminar el contrato "${r.nombre}"?`)&&E.delete(route("admin.contratos.destroy",r.id),{onSuccess:()=>{y.success("Contrato eliminado exitosamente")},onError:()=>{y.error("Error al eliminar el contrato")}})},A=(r,e)=>{E.post(route("admin.contratos.cambiar-estado",r.id),{estado:e},{onSuccess:()=>{y.success("Estado actualizado exitosamente")},onError:()=>{y.error("Error al cambiar el estado")}})},W=r=>{confirm(`¿Desea duplicar el contrato "${r.nombre}"?`)&&E.post(route("admin.contratos.duplicar",r.id),{},{onSuccess:()=>{y.success("Contrato duplicado exitosamente")},onError:()=>{y.error("Error al duplicar el contrato")}})},X=()=>{window.location.href=route("admin.contratos.export",{search:x.value||void 0,estado:f.value==="all"?void 0:f.value,tipo:p.value==="all"?void 0:p.value})};return(r,e)=>(d(),c(et,{breadcrumbs:R},{default:l(()=>[u("div",xt,[u("div",bt,[u("div",null,[u("h1",yt,[e[3]||(e[3]=a(" Contratos ",-1)),n.proyecto?(d(),w("span",$t," del proyecto: "+i(n.proyecto.nombre),1)):b("",!0)]),e[4]||(e[4]=u("p",{class:"text-gray-600 mt-1"},"Gestiona los contratos de los proyectos",-1))]),u("div",kt,[o(t(V),{variant:"outline",onClick:X},{default:l(()=>[o(t(vt),{class:"h-4 w-4 mr-2"}),e[5]||(e[5]=a(" Exportar ",-1))]),_:1}),o(t(C),{href:n.proyecto?r.route("admin.proyectos.contratos.create",n.proyecto.id):r.route("admin.contratos.create")},{default:l(()=>[o(t(V),null,{default:l(()=>[o(t(ct),{class:"h-4 w-4 mr-2"}),e[6]||(e[6]=a(" Nuevo Contrato ",-1))]),_:1})]),_:1},8,["href"])])]),o(t(L),null,{default:l(()=>[o(t(ot),null,{default:l(()=>[o(t(lt),{class:"text-lg"},{default:l(()=>[...e[7]||(e[7]=[a("Filtros",-1)])]),_:1})]),_:1}),o(t(M),null,{default:l(()=>[u("div",Ct,[u("div",null,[u("div",Et,[o(t(_t),{class:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),o(t(at),{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),placeholder:"Buscar contratos...",class:"pl-10"},null,8,["modelValue"])])]),o(t(U),{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s)},{default:l(()=>[o(t(I),null,{default:l(()=>[o(t(O),{placeholder:"Todos los estados"})]),_:1}),o(t(G),null,{default:l(()=>[o(t(m),{value:"all"},{default:l(()=>[...e[8]||(e[8]=[a("Todos los estados",-1)])]),_:1}),o(t(m),{value:"borrador"},{default:l(()=>[...e[9]||(e[9]=[a("Borrador",-1)])]),_:1}),o(t(m),{value:"activo"},{default:l(()=>[...e[10]||(e[10]=[a("Activo",-1)])]),_:1}),o(t(m),{value:"finalizado"},{default:l(()=>[...e[11]||(e[11]=[a("Finalizado",-1)])]),_:1}),o(t(m),{value:"cancelado"},{default:l(()=>[...e[12]||(e[12]=[a("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(t(U),{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s)},{default:l(()=>[o(t(I),null,{default:l(()=>[o(t(O),{placeholder:"Todos los tipos"})]),_:1}),o(t(G),null,{default:l(()=>[o(t(m),{value:"all"},{default:l(()=>[...e[13]||(e[13]=[a("Todos los tipos",-1)])]),_:1}),o(t(m),{value:"servicio"},{default:l(()=>[...e[14]||(e[14]=[a("Servicio",-1)])]),_:1}),o(t(m),{value:"obra"},{default:l(()=>[...e[15]||(e[15]=[a("Obra",-1)])]),_:1}),o(t(m),{value:"suministro"},{default:l(()=>[...e[16]||(e[16]=[a("Suministro",-1)])]),_:1}),o(t(m),{value:"consultoria"},{default:l(()=>[...e[17]||(e[17]=[a("Consultoría",-1)])]),_:1}),o(t(m),{value:"otro"},{default:l(()=>[...e[18]||(e[18]=[a("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),q.value?(d(),c(t(V),{key:0,variant:"outline",onClick:K},{default:l(()=>[...e[19]||(e[19]=[a(" Limpiar Filtros ",-1)])]),_:1})):b("",!0)])]),_:1})]),_:1}),o(t(L),null,{default:l(()=>[o(t(M),{class:"p-0"},{default:l(()=>[o(t(st),null,{default:l(()=>[o(t(rt),null,{default:l(()=>[o(t(B),null,{default:l(()=>[o(t(_),null,{default:l(()=>[...e[20]||(e[20]=[a("Nombre",-1)])]),_:1}),o(t(_),null,{default:l(()=>[...e[21]||(e[21]=[a("Proyecto",-1)])]),_:1}),o(t(_),null,{default:l(()=>[...e[22]||(e[22]=[a("Estado",-1)])]),_:1}),o(t(_),null,{default:l(()=>[...e[23]||(e[23]=[a("Tipo",-1)])]),_:1}),o(t(_),null,{default:l(()=>[...e[24]||(e[24]=[a("Fecha Inicio",-1)])]),_:1}),o(t(_),null,{default:l(()=>[...e[25]||(e[25]=[a("Fecha Fin",-1)])]),_:1}),o(t(_),null,{default:l(()=>[...e[26]||(e[26]=[a("Monto",-1)])]),_:1}),o(t(_),null,{default:l(()=>[...e[27]||(e[27]=[a("Responsable",-1)])]),_:1}),o(t(_),{class:"text-right"},{default:l(()=>[...e[28]||(e[28]=[a("Acciones",-1)])]),_:1})]),_:1})]),_:1}),o(t(it),null,{default:l(()=>[(d(!0),w(j,null,P(n.contratos.data,s=>(d(),c(t(B),{key:s.id},{default:l(()=>[o(t(v),{class:"font-medium"},{default:l(()=>[u("div",wt,[a(i(s.nombre)+" ",1),s.esta_vencido?(d(),c(t(F),{key:0,variant:"destructive",class:"text-xs"},{default:l(()=>[...e[29]||(e[29]=[a(" Vencido ",-1)])]),_:1})):s.esta_proximo_vencer?(d(),c(t(F),{key:1,variant:"outline",class:"text-xs text-yellow-600 border-yellow-600"},{default:l(()=>[a(i(s.dias_restantes)+" días ",1)]),_:2},1024)):b("",!0)])]),_:2},1024),o(t(v),null,{default:l(()=>[o(t(C),{href:r.route("admin.proyectos.show",s.proyecto.id),class:"text-blue-600 hover:underline"},{default:l(()=>[a(i(s.proyecto.nombre),1)]),_:2},1032,["href"])]),_:2},1024),o(t(v),null,{default:l(()=>[o(t(F),{class:z(H(s.estado))},{default:l(()=>[a(i(s.estado),1)]),_:2},1032,["class"])]),_:2},1024),o(t(v),null,{default:l(()=>[o(t(F),{class:z(J(s.tipo))},{default:l(()=>[a(i(s.tipo),1)]),_:2},1032,["class"])]),_:2},1024),o(t(v),null,{default:l(()=>[a(i(T(s.fecha_inicio)),1)]),_:2},1024),o(t(v),null,{default:l(()=>[a(i(T(s.fecha_fin)),1)]),_:2},1024),o(t(v),null,{default:l(()=>[a(i(s.monto_formateado||"-"),1)]),_:2},1024),o(t(v),null,{default:l(()=>{var $;return[a(i((($=s.responsable)==null?void 0:$.name)||"-"),1)]}),_:2},1024),o(t(v),{class:"text-right"},{default:l(()=>[o(t(nt),null,{default:l(()=>[o(t(dt),{asChild:""},{default:l(()=>[o(t(V),{variant:"ghost",size:"sm"},{default:l(()=>[o(t(gt),{class:"h-4 w-4"})]),_:1})]),_:1}),o(t(ut),{align:"end"},{default:l(()=>[o(t(mt),null,{default:l(()=>[...e[30]||(e[30]=[a("Acciones",-1)])]),_:1}),o(t(D)),o(t(C),{href:r.route("admin.contratos.show",s.id)},{default:l(()=>[o(t(k),null,{default:l(()=>[...e[31]||(e[31]=[a("Ver detalles",-1)])]),_:1})]),_:1},8,["href"]),o(t(C),{href:r.route("admin.contratos.edit",s.id)},{default:l(()=>[o(t(k),null,{default:l(()=>[...e[32]||(e[32]=[a("Editar",-1)])]),_:1})]),_:1},8,["href"]),o(t(D)),s.estado==="borrador"?(d(),c(t(k),{key:0,onClick:$=>A(s,"activo")},{default:l(()=>[...e[33]||(e[33]=[a(" Activar ",-1)])]),_:1},8,["onClick"])):b("",!0),s.estado==="activo"?(d(),c(t(k),{key:1,onClick:$=>A(s,"finalizado")},{default:l(()=>[...e[34]||(e[34]=[a(" Finalizar ",-1)])]),_:1},8,["onClick"])):b("",!0),o(t(k),{onClick:$=>W(s)},{default:l(()=>[...e[35]||(e[35]=[a(" Duplicar ",-1)])]),_:1},8,["onClick"]),o(t(D)),o(t(k),{class:"text-red-600",onClick:$=>Q(s)},{default:l(()=>[...e[36]||(e[36]=[a(" Eliminar ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),n.contratos.data.length===0?(d(),c(t(B),{key:0},{default:l(()=>[o(t(v),{colspan:"9",class:"text-center py-8 text-gray-500"},{default:l(()=>[...e[37]||(e[37]=[a(" No se encontraron contratos ",-1)])]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n.contratos.last_page>1?(d(),w("div",Vt,[u("p",Ft," Mostrando "+i(n.contratos.from)+" - "+i(n.contratos.to)+" de "+i(n.contratos.total)+" contratos ",1),u("div",St,[(d(!0),w(j,null,P(n.contratos.last_page,s=>(d(),c(t(C),{key:s,href:r.route("admin.contratos.index",{...g.filters,page:s}),class:z(["px-3 py-1 rounded text-sm",s===n.contratos.current_page?"bg-primary text-white":"bg-gray-100 hover:bg-gray-200"])},{default:l(()=>[a(i(s),1)]),_:2},1032,["href","class"]))),128))])])):b("",!0)])]),_:1}))}});export{ze as default};
