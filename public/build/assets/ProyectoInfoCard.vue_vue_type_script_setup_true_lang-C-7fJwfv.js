import{d as L,r as E,c as C,i as _,F as V,b as x,j as b,e as t,f as a,w as o,k as R,g as s,h as u,t as n,s as F,m,v as T,l as Y,n as A,x as Z}from"./app-CS8sR3Ia.js";import{c as P,_ as S,a as H,b as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-DwQGgR-i.js";import{_ as D}from"./index-Djk0n9d2.js";import{c as G,_ as z}from"./createLucideIcon-I1BaLUp8.js";import{_ as ee,a as ae,b as N,c as k,d as te,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-CHbvwPOi.js";import{_ as se,a as oe,b as le,c as re,d as ne}from"./AccordionContent.vue_vue_type_script_setup_true_lang-SxyFFdZI.js";import{e as ie,_ as de,a as ce,b as ue,c as me,d as fe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BoXFSDzP.js";import{_ as ge,a as ve,b as ye,c as pe,d as j}from"./SelectValue.vue_vue_type_script_setup_true_lang-Brl8Pxle.js";import{_ as xe}from"./Textarea.vue_vue_type_script_setup_true_lang-CHrksof-.js";import{_ as _e}from"./Label.vue_vue_type_script_setup_true_lang-XXG1Zo-0.js";import{t as B}from"./index-CLyZuKah.js";import{I as M}from"./image-Bj50BatA.js";import{F as be}from"./file-text-w6e7k9Cu.js";import{E as $e}from"./external-link-CFG2tP2s.js";import{E as he}from"./eye-BA_ANM1P.js";import{D as ke}from"./download-Daf3vbWe.js";import{_ as we}from"./Progress.vue_vue_type_script_setup_true_lang-BZ1bdrKa.js";import{C as Ee}from"./circle-check-big-kYXZ969j.js";import{C as Ce}from"./circle-play-BoMU5MDZ.js";import{T as De}from"./target-CUQqOCv8.js";import{C as Ie}from"./circle-alert-DqdhPVID.js";import{F as Fe}from"./flag-DOtyXtmk.js";import{C as q}from"./calendar-BA09vsNT.js";import{C as ze}from"./clock-DZR65FQf.js";import{U as Ae}from"./user-CwMJLfNw.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=G("BanIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=G("CirclePauseIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]),Ve={key:1,class:"mt-4"},je={class:"flex items-center justify-between w-full pr-4"},Be={class:"flex items-center gap-3"},Le={class:"text-left"},Ue={class:"font-semibold"},Re={class:"text-sm text-gray-500"},Te={class:"flex items-center gap-3"},Ne={class:"text-sm text-gray-600"},Me={class:"text-sm"},qe={class:"flex items-center justify-end gap-2"},He=["href"],Oe={class:"text-center"},Ge={class:"text-center"},Je={class:"space-y-4 py-4"},Oa=L({__name:"EvidenciasDisplay",props:{contratos:{default:()=>[]},proyectoId:{},modo:{},puedeGestionarEstado:{type:Boolean,default:!1},formatDate:{}},setup(l){const v=l,f=E({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),g=E(!1),$=E(null),y=E(null),h=E(""),p=E(!1),i=C(()=>{const r=[];return v.contratos&&v.contratos.forEach(e=>{e.obligaciones&&e.obligaciones.forEach(d=>{d.evidencias&&d.evidencias.forEach(c=>{r.push({...c,contrato_id:e.id,contrato_numero:e.numero_contrato,contrato_nombre:e.nombre,obligacion_titulo:d.titulo,_contrato:e})})})}),r}),J=C(()=>{let r=i.value;return f.value.contrato_id&&(r=r.filter(e=>e.contrato_id===f.value.contrato_id)),f.value.tipo&&(r=r.filter(e=>e.tipo_evidencia===f.value.tipo)),f.value.estado&&(r=r.filter(e=>e.estado===f.value.estado)),f.value.usuario_id&&(r=r.filter(e=>{var d;return((d=e.usuario)==null?void 0:d.id)===f.value.usuario_id})),(f.value.fecha_inicio||f.value.fecha_fin)&&(r=r.filter(e=>{const d=new Date(e.created_at);if(f.value.fecha_inicio){const c=new Date(f.value.fecha_inicio);if(d<c)return!1}if(f.value.fecha_fin){const c=new Date(f.value.fecha_fin);if(c.setHours(23,59,59,999),d>c)return!1}return!0})),r}),U=C(()=>{const r={};return J.value.forEach(e=>{r[e.contrato_id]||(r[e.contrato_id]={contrato:e._contrato,evidencias:[]}),r[e.contrato_id].evidencias.push(e)}),Object.values(r)}),K=r=>v.modo==="admin"?`/admin/contratos/${r}`:`/miembro/mis-contratos/${r}`,Q=(r,e)=>v.modo==="admin"?`/admin/contratos/${r}/evidencias/${e}`:`/miembro/mis-contratos/${r}/evidencias/${e}`,W=async()=>{if(!$.value||!y.value)return;p.value=!0;const r=`/api/proyectos/${v.proyectoId}/evidencias/${$.value.id}/${y.value}`;F.post(r,{observaciones:h.value||null},{preserveScroll:!0,onSuccess:()=>{B.success(y.value==="aprobar"?"Evidencia aprobada exitosamente":"Evidencia rechazada"),g.value=!1,$.value=null,y.value=null,h.value="",F.reload({only:["proyecto"]})},onError:e=>{B.error("Error al cambiar el estado de la evidencia"),console.error(e)},onFinish:()=>{p.value=!1}})},X=(r,e)=>{if(e===r.estado)return;const d=v.modo==="admin"?`/admin/proyectos/${v.proyectoId}/evidencias/${r.id}/cambiar-estado`:`/miembro/mis-proyectos/${v.proyectoId}/evidencias/${r.id}/cambiar-estado`;F.post(d,{estado:e,observaciones:null},{preserveScroll:!0,onSuccess:c=>{F.reload({only:["proyecto"]})},onError:c=>{B.error("Error al cambiar el estado"),console.error(c)}})};return(r,e)=>(m(),_(V,null,[i.value.length>0?(m(),x(se,{key:0,modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=d=>f.value=d),contratos:l.contratos||[],evidencias:i.value},null,8,["modelValue","contratos","evidencias"])):b("",!0),U.value.length>0?(m(),_("div",Ve,[t(a(oe),{type:"multiple",class:"space-y-4",collapsible:""},{default:o(()=>[(m(!0),_(V,null,R(U.value,d=>(m(),x(a(le),{key:d.contrato.id,value:`contrato-${d.contrato.id}`,class:"border rounded-lg bg-card"},{default:o(()=>[t(a(re),{class:"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800 rounded-t-lg"},{default:o(()=>[s("div",je,[s("div",Be,[t(a(be),{class:"h-5 w-5 text-gray-500"}),s("div",Le,[s("div",Ue,n(d.contrato.nombre),1),s("div",Re,n(d.contrato.numero_contrato||"Sin número"),1)])]),s("div",Te,[t(a(D),{variant:"secondary"},{default:o(()=>[u(n(d.evidencias.length)+" evidencia(s) ",1)]),_:2},1024),t(a(T),{href:K(d.contrato.id),onClick:e[1]||(e[1]=Y(()=>{},["stop"])),class:"text-blue-600 hover:text-blue-800 flex items-center gap-1"},{default:o(()=>[e[5]||(e[5]=u(" Ver contrato ",-1)),t(a($e),{class:"h-3 w-3"})]),_:1},8,["href"])])])]),_:2},1024),t(a(ne),{class:"px-4 pb-4"},{default:o(()=>[t(a(ee),null,{default:o(()=>[t(a(ae),null,{default:o(()=>[t(a(N),null,{default:o(()=>[t(a(k),null,{default:o(()=>[...e[6]||(e[6]=[u("Tipo",-1)])]),_:1}),t(a(k),null,{default:o(()=>[...e[7]||(e[7]=[u("Obligación",-1)])]),_:1}),t(a(k),null,{default:o(()=>[...e[8]||(e[8]=[u("Descripción",-1)])]),_:1}),l.modo==="admin"?(m(),x(a(k),{key:0},{default:o(()=>[...e[9]||(e[9]=[u("Usuario",-1)])]),_:1})):b("",!0),t(a(k),null,{default:o(()=>[...e[10]||(e[10]=[u("Estado",-1)])]),_:1}),t(a(k),null,{default:o(()=>[...e[11]||(e[11]=[u("Fecha",-1)])]),_:1}),t(a(k),{class:"text-right"},{default:o(()=>[...e[12]||(e[12]=[u("Acciones",-1)])]),_:1})]),_:1})]),_:1}),t(a(te),null,{default:o(()=>[(m(!0),_(V,null,R(d.evidencias,c=>(m(),x(a(N),{key:c.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},{default:o(()=>[t(a(w),null,{default:o(()=>[t(a(D),{variant:"outline"},{default:o(()=>[u(n(c.tipo_evidencia),1)]),_:2},1024)]),_:2},1024),t(a(w),null,{default:o(()=>[u(n(c.obligacion_titulo),1)]),_:2},1024),t(a(w),null,{default:o(()=>[s("span",Ne,n(c.descripcion||"-"),1)]),_:2},1024),l.modo==="admin"?(m(),x(a(w),{key:0},{default:o(()=>{var I;return[s("span",Me,n(((I=c.usuario)==null?void 0:I.name)||"-"),1)]}),_:2},1024)):b("",!0),t(a(w),null,{default:o(()=>[t(a(D),{class:A({"bg-yellow-100 text-yellow-800":c.estado==="pendiente","bg-green-100 text-green-800":c.estado==="aprobada","bg-red-100 text-red-800":c.estado==="rechazada"})},{default:o(()=>[u(n(c.estado),1)]),_:2},1032,["class"])]),_:2},1024),t(a(w),null,{default:o(()=>[u(n(l.formatDate(c.created_at)),1)]),_:2},1024),t(a(w),{class:"text-right"},{default:o(()=>[s("div",qe,[t(a(z),{variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:o(()=>[t(a(T),{href:Q(c.contrato_id,c.id)},{default:o(()=>[t(a(he),{class:"h-4 w-4"}),e[13]||(e[13]=s("span",{class:"ml-1"},"Ver",-1))]),_:1},8,["href"])]),_:2},1024),c.archivo_url?(m(),x(a(z),{key:0,variant:"ghost",size:"sm","as-child":"",class:"h-8 px-2"},{default:o(()=>[s("a",{href:c.archivo_url,target:"_blank"},[t(a(ke),{class:"h-4 w-4"}),e[14]||(e[14]=s("span",{class:"ml-1"},"Descargar",-1))],8,He)]),_:2},1024)):b("",!0),l.modo==="admin"||l.modo==="user"&&l.puedeGestionarEstado?(m(),x(a(ge),{key:1,"model-value":c.estado,"onUpdate:modelValue":I=>X(c,I)},{default:o(()=>[t(a(ve),{class:"h-8 w-32"},{default:o(()=>[t(a(ye))]),_:1}),t(a(pe),null,{default:o(()=>[t(a(j),{value:"pendiente"},{default:o(()=>[...e[15]||(e[15]=[s("span",{class:"text-yellow-600"},"Pendiente",-1)])]),_:1}),t(a(j),{value:"aprobada"},{default:o(()=>[...e[16]||(e[16]=[s("span",{class:"text-green-600"},"Aprobada",-1)])]),_:1}),t(a(j),{value:"rechazada"},{default:o(()=>[...e[17]||(e[17]=[s("span",{class:"text-red-600"},"Rechazada",-1)])]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])):b("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})])):i.value.length===0?(m(),x(a(S),{key:2,class:"mt-4"},{default:o(()=>[t(a(P),{class:"py-8"},{default:o(()=>[s("div",Oe,[t(a(M),{class:"mx-auto h-12 w-12 text-gray-400"}),e[18]||(e[18]=s("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias cargadas",-1)),e[19]||(e[19]=s("p",{class:"text-xs text-gray-500 mt-1"},"Las evidencias se cargan desde los contratos",-1))])]),_:1})]),_:1})):(m(),x(a(S),{key:3,class:"mt-4"},{default:o(()=>[t(a(P),{class:"py-8"},{default:o(()=>[s("div",Ge,[t(a(M),{class:"mx-auto h-12 w-12 text-gray-400"}),e[20]||(e[20]=s("p",{class:"mt-2 text-sm text-gray-600"},"No hay evidencias que coincidan con los filtros",-1)),e[21]||(e[21]=s("p",{class:"text-xs text-gray-500 mt-1"},"Intenta ajustar los criterios de búsqueda",-1))])]),_:1})]),_:1})),t(a(ie),{open:g.value,"onUpdate:open":e[4]||(e[4]=d=>g.value=d)},{default:o(()=>[t(a(de),null,{default:o(()=>[t(a(ce),null,{default:o(()=>[t(a(ue),null,{default:o(()=>[u(n(y.value==="aprobar"?"Aprobar Evidencia":"Rechazar Evidencia"),1)]),_:1}),t(a(me),null,{default:o(()=>[u(n(y.value==="aprobar"?"Estás a punto de aprobar esta evidencia. Puedes agregar observaciones opcionales.":"Estás a punto de rechazar esta evidencia. Es recomendable agregar el motivo del rechazo."),1)]),_:1})]),_:1}),s("div",Je,[s("div",null,[t(a(_e),{for:"observaciones"},{default:o(()=>[u(" Observaciones "+n(y.value==="rechazar"?"(recomendado)":"(opcional)"),1)]),_:1}),t(a(xe),{id:"observaciones",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=d=>h.value=d),placeholder:y.value==="rechazar"?"Explica el motivo del rechazo...":"Agrega comentarios adicionales...",rows:"4",class:"mt-2"},null,8,["modelValue","placeholder"])])]),t(a(fe),null,{default:o(()=>[t(a(z),{variant:"outline",onClick:e[3]||(e[3]=d=>g.value=!1),disabled:p.value},{default:o(()=>[...e[22]||(e[22]=[u(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(a(z),{variant:y.value==="aprobar"?"default":"destructive",onClick:W,disabled:p.value},{default:o(()=>[u(n(p.value?"Procesando...":y.value==="aprobar"?"Aprobar":"Rechazar"),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])],64))}}),Ke={class:"flex items-center justify-between"},Qe={class:"flex items-center gap-3"},We={class:"flex items-center gap-3"},Xe={class:"space-y-2"},Ye={class:"flex justify-between text-sm"},Ze={class:"font-medium"},ea={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2"},aa={class:"flex items-start gap-3"},ta={class:"font-medium"},sa={class:"text-xs text-gray-500"},oa={key:0,class:"flex items-start gap-3"},la={class:"font-medium"},ra={class:"text-xs text-gray-500"},na={key:0,class:"flex items-center gap-3 pt-2"},ia={class:"font-medium ml-2"},Ga=L({__name:"ProyectoEstadoCard",props:{estado:{},estadoLabel:{},prioridad:{},prioridadLabel:{},porcentajeCompletado:{},fechaInicio:{},fechaFin:{},duracionDias:{}},setup(l){const v=l,f=C(()=>({planificacion:De,en_progreso:Ce,pausado:Se,completado:Ee,cancelado:Pe})[v.estado]||Ie),g=C(()=>({planificacion:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",en_progreso:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",pausado:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",completado:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",cancelado:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"})[v.estado]||"bg-gray-100 text-gray-800"),$=C(()=>({baja:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",media:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",alta:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",critica:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"})[v.prioridad]||"bg-gray-100 text-gray-800"),y=p=>new Date(p).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),h=p=>{const i=Math.floor((new Date(p).getTime()-new Date().getTime())/864e5);return i===0?"Hoy":i===1?"Mañana":i===-1?"Ayer":i>0?`En ${i} días`:`Hace ${Math.abs(i)} días`};return(p,i)=>(m(),x(a(S),null,{default:o(()=>[t(a(H),null,{default:o(()=>[t(a(O),null,{default:o(()=>[...i[0]||(i[0]=[u("Estado del Proyecto",-1)])]),_:1})]),_:1}),t(a(P),{class:"space-y-4"},{default:o(()=>[s("div",Ke,[s("div",Qe,[(m(),x(Z(f.value),{class:"h-5 w-5 text-gray-500"})),i[1]||(i[1]=s("span",{class:"font-medium"},"Estado:",-1)),t(a(D),{class:A(g.value)},{default:o(()=>[u(n(l.estadoLabel),1)]),_:1},8,["class"])]),s("div",We,[t(a(Fe),{class:"h-5 w-5 text-gray-500"}),i[2]||(i[2]=s("span",{class:"font-medium"},"Prioridad:",-1)),t(a(D),{class:A($.value)},{default:o(()=>[u(n(l.prioridadLabel),1)]),_:1},8,["class"])])]),s("div",Xe,[s("div",Ye,[i[3]||(i[3]=s("span",{class:"text-gray-600 dark:text-gray-400"},"Progreso",-1)),s("span",Ze,n(l.porcentajeCompletado)+"%",1)]),t(a(we),{"model-value":l.porcentajeCompletado,class:"h-2"},null,8,["model-value"])]),s("div",ea,[s("div",aa,[t(a(q),{class:"h-5 w-5 text-gray-500 mt-0.5"}),s("div",null,[i[4]||(i[4]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de inicio",-1)),s("p",ta,n(y(l.fechaInicio)),1),s("p",sa,n(h(l.fechaInicio)),1)])]),l.fechaFin?(m(),_("div",oa,[t(a(q),{class:"h-5 w-5 text-gray-500 mt-0.5"}),s("div",null,[i[5]||(i[5]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fecha de fin",-1)),s("p",la,n(y(l.fechaFin)),1),s("p",ra,n(h(l.fechaFin)),1)])])):b("",!0)]),l.duracionDias?(m(),_("div",na,[t(a(ze),{class:"h-5 w-5 text-gray-500"}),s("div",null,[i[6]||(i[6]=s("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Duración total:",-1)),s("span",ia,n(l.duracionDias)+" días",1)])])):b("",!0)]),_:1})]),_:1}))}}),da={key:0},ca={class:"font-mono"},ua={key:1},ma={key:0,class:"flex items-center gap-3"},fa={class:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"},ga={class:"font-medium"},va={class:"text-sm text-gray-500"},ya={key:1,class:"text-gray-500"},pa={class:"font-medium"},xa={class:"text-xs text-gray-500"},_a={class:"text-sm"},Ja=L({__name:"ProyectoInfoCard",props:{proyectoId:{},activo:{type:Boolean},responsable:{},creador:{},createdAt:{},updatedAt:{},titulo:{default:"Información del Proyecto"},showId:{type:Boolean,default:!1},showActivo:{type:Boolean,default:!1}},setup(l){const v=f=>new Date(f).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return(f,g)=>(m(),x(a(S),null,{default:o(()=>[t(a(H),null,{default:o(()=>[t(a(O),null,{default:o(()=>[u(n(l.titulo),1)]),_:1})]),_:1}),t(a(P),{class:"space-y-4"},{default:o(()=>{var $;return[l.showId&&l.proyectoId?(m(),_("div",da,[g[0]||(g[0]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"ID del Proyecto",-1)),s("p",ca,"#"+n(l.proyectoId),1)])):b("",!0),l.showActivo&&l.activo!==void 0?(m(),_("div",ua,[g[1]||(g[1]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Estado",-1)),t(a(D),{class:A(l.activo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800")},{default:o(()=>[u(n(l.activo?"Activo":"Inactivo"),1)]),_:1},8,["class"])])):b("",!0),s("div",null,[g[2]||(g[2]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-2"},"Responsable",-1)),l.responsable?(m(),_("div",ma,[s("div",fa,[t(a(Ae),{class:"h-5 w-5 text-gray-500"})]),s("div",null,[s("p",ga,n(l.responsable.name),1),s("p",va,n(l.responsable.email),1)])])):(m(),_("p",ya,"Sin asignar"))]),s("div",null,[g[3]||(g[3]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"Creado por",-1)),s("p",pa,n((($=l.creador)==null?void 0:$.name)||"Sistema"),1),s("p",xa,n(v(l.createdAt)),1)]),s("div",null,[g[4]||(g[4]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"Última actualización",-1)),s("p",_a,n(v(l.updatedAt)),1)])]}),_:1})]),_:1}))}});export{Ja as _,Ga as a,Oa as b};
