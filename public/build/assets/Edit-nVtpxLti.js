import{d as ye,C as xe,r as F,c as D,b as C,e as d,w as a,g as n,f as t,j as c,u as o,P as Ce,h as s,t as v,l as Ve,i as m,F as P,k as z,W as I}from"./app-CGDcXcXm.js";import{_ as ke}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BHFgvyjx.js";import{_ as E,a as U,b as $,c as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-BudF5sLg.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-B32gJRul.js";import{_ as b}from"./createLucideIcon-DanALmEC.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-De2JuYAO.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-ucIShhqX.js";import{_ as Y}from"./Textarea.vue_vue_type_script_setup_true_lang-BZVMoSLu.js";import{_ as N,a as j,b as M,c as T,d as y}from"./SelectValue.vue_vue_type_script_setup_true_lang-BAaIhJ0J.js";import{_ as Z,a as ee}from"./index-3LFn1my6.js";import{_ as Ee,a as Ue,b as R,c as O}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CJdIR_d7.js";import{u as $e}from"./useToast-BGmBO9X2.js";import{_ as h}from"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-CTJ5H89S.js";import{_ as oe}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-DBLh5XKc.js";import{A as Se}from"./arrow-left-GVkRhu4l.js";import{T as Pe}from"./trash-2-0rqFVT6l.js";import{C as te}from"./circle-alert-CaBwTfyT.js";import{X as ae}from"./x-BDmXRx4n.js";import{U as ze}from"./user-plus-BmTfByXX.js";import{U as re}from"./users-CsdoQTZz.js";import{U as we}from"./upload-DLLq3B88.js";import{S as Ae}from"./save-DQB2bL4w.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-_Nm3H6S4.js";import"./index-BBAsWOFq.js";import"./floating-ui.vue-36zNgrSP.js";import"./index-CcR8_wTx.js";import"./shield-Bejn5muX.js";import"./user-CyfX3Swe.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BBLyUXDE.js";import"./chevron-right-Ch7F_p_y.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Blow8o_p.js";import"./VisuallyHidden-5PoN3-2b.js";import"./index-D4d4TGf0.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-o2J4dePs.js";import"./index-D3sE_pCs.js";import"./map-pin-Cz6bXU5Q.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-D0fkBAd-.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DEJpvv4m.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-Cfg27zyf.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-C7YVKPpr.js";import"./tag-ArrCqU1L.js";import"./target-C3-zh7jw.js";import"./vote-C94QGQq8.js";import"./folder-open-ByFFqHS3.js";import"./send-Csfph9VM.js";import"./file-text-ByNZVhOA.js";import"./briefcase-D9ShWyOM.js";import"./calendar-BTZmtWlZ.js";import"./megaphone-BNsuFAyp.js";import"./user-check-DeDdhxRC.js";import"./mail-DK6kjS89.js";import"./message-square-Fj2kQlTc.js";import"./external-link-DOg911z7.js";import"./panel-left-ybRipXPO.js";import"./index-BsPs8wxd.js";import"./check-WUsKeayf.js";import"./index-HHRqvbiQ.js";import"./nullish-CHIgUVhi.js";import"./RovingFocusItem-DZlSNDJ8.js";import"./utils-BbQHozWa.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CjeYPl2k.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Lj75CINA.js";import"./VisuallyHiddenInput-vPOddKQM.js";import"./circle-CK7nXf16.js";import"./search-DKUrL-QT.js";import"./loader-circle-DjSpOu1n.js";import"./chevron-left-D0vX9nlA.js";const Fe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},De={class:"flex items-center justify-between"},Ie={class:"flex items-center gap-4"},Ne={class:"text-gray-600 mt-1"},je={class:"flex gap-2"},Me={class:"flex gap-2"},Te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={key:0,class:"text-red-500 text-sm mt-1"},Oe={key:0,class:"text-red-500 text-sm mt-1"},qe={key:0,class:"text-red-500 text-sm mt-1"},Be={key:0,class:"space-y-4 pt-4 border-t"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ge={key:0,class:"text-red-500 text-sm mt-1"},Xe={key:0,class:"text-red-500 text-sm mt-1"},he={key:0,class:"text-red-500 text-sm mt-1"},We={key:0,class:"text-red-500 text-sm mt-1"},He={key:0},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={key:0,class:"text-red-500 text-sm mt-1"},Qe={key:0,class:"text-red-500 text-sm mt-1"},Ye={key:0,class:"space-y-4 pt-4 border-t"},Ze={class:"space-y-6"},eo={class:"space-y-4"},oo={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},to={class:"font-medium"},ao={class:"text-sm text-muted-foreground"},ro={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lo={class:"space-y-4"},so={key:0,class:"space-y-2"},io={class:"flex items-center justify-between"},no={class:"font-medium"},uo={class:"text-sm text-muted-foreground"},mo={class:"flex items-center gap-2 mt-1"},po={class:"text-xs bg-primary/10 text-primary px-2 py-1 rounded"},fo={key:0,class:"text-xs text-muted-foreground"},co={key:1,class:"text-center py-8 border-2 border-dashed rounded-lg"},vo={class:"flex items-center gap-4"},_o={key:0,class:"text-sm text-gray-600"},bo={key:0,class:"text-red-500 text-sm mt-1"},go={key:0,class:"text-red-500 text-sm mt-1"},yo={key:0,class:"space-y-4 pt-4 border-t"},xo={key:0,class:"flex justify-end gap-4"},jt=ye({__name:"Edit",props:{contrato:{},proyectos:{},camposPersonalizados:{},valoresCampos:{},usuarios:{default:()=>[]}},setup(le){var K,Q;const u=le,x=$e(),se=[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:u.contrato.nombre,href:`/admin/contratos/${u.contrato.id}`},{title:"Editar",href:`/admin/contratos/${u.contrato.id}/edit`}],ie=()=>!u.contrato.participantes||u.contrato.participantes.length===0?[]:u.contrato.participantes.map(i=>{var e,l,p;return{user_id:((e=i.pivot)==null?void 0:e.user_id)||i.user_id||i.id,rol:((l=i.pivot)==null?void 0:l.rol)||i.rol||"participante",notas:((p=i.pivot)==null?void 0:p.notas)||i.notas||""}}),r=xe({proyecto_id:u.contrato.proyecto_id.toString(),nombre:u.contrato.nombre,descripcion:u.contrato.descripcion||"",fecha_inicio:u.contrato.fecha_inicio,fecha_fin:u.contrato.fecha_fin||"",estado:u.contrato.estado,tipo:u.contrato.tipo,monto_total:((K=u.contrato.monto_total)==null?void 0:K.toString())||"",moneda:u.contrato.moneda,responsable_id:((Q=u.contrato.responsable_id)==null?void 0:Q.toString())||"none",contraparte_user_id:u.contrato.contraparte_user_id||null,contraparte_nombre:u.contrato.contraparte_nombre||"",contraparte_identificacion:u.contrato.contraparte_identificacion||"",contraparte_email:u.contrato.contraparte_email||"",contraparte_telefono:u.contrato.contraparte_telefono||"",participantes:ie(),archivo_pdf:null,observaciones:u.contrato.observaciones||"",campos_personalizados:u.valoresCampos||{},_method:"PUT"}),L=F(u.contrato.archivo_pdf?"Archivo actual: "+u.contrato.archivo_pdf.split("/").pop():""),W=F("informacion");F(!1);const G=F(!1),X=F(!1),{route:k}=window,ne=[{value:"USD",label:"USD - Dólar Estadounidense"},{value:"EUR",label:"EUR - Euro"},{value:"MXN",label:"MXN - Peso Mexicano"},{value:"COP",label:"COP - Peso Colombiano"},{value:"ARS",label:"ARS - Peso Argentino"},{value:"CLP",label:"CLP - Peso Chileno"},{value:"PEN",label:"PEN - Sol Peruano"}],q=D(()=>{var i;return r.contraparte_user_id?(i=u.usuarios)==null?void 0:i.find(e=>e.id===r.contraparte_user_id):null}),de=D(()=>[{name:"rol",label:"Rol",type:"select",options:[{value:"testigo",label:"Testigo"},{value:"revisor",label:"Revisor"},{value:"aprobador",label:"Aprobador"},{value:"observador",label:"Observador"}],value:"testigo",required:!0},{name:"notas",label:"Notas (opcional)",type:"text",value:"",required:!1}]),ue=D(()=>{const i=r.participantes.map(e=>e.user_id);return r.contraparte_user_id&&i.push(r.contraparte_user_id),i}),me=i=>{var e;if(i.userIds.length>0){r.contraparte_user_id=i.userIds[0];const l=(e=u.usuarios)==null?void 0:e.find(p=>p.id===i.userIds[0]);l&&(r.contraparte_nombre=l.name,r.contraparte_email=l.email||"")}},pe=i=>{i.userIds.forEach(e=>{r.participantes.some(p=>p.user_id===e)||r.participantes.push({user_id:e,rol:i.extraData.rol||"testigo",notas:i.extraData.notas||""})})},fe=i=>{const e=r.participantes.findIndex(l=>l.user_id===i);e>-1&&r.participantes.splice(e,1)},H=i=>{var e;return(e=u.usuarios)==null?void 0:e.find(l=>l.id===i)},A=D(()=>{const i={informacion:[],financiero:[],otros:[]};return u.camposPersonalizados.forEach(e=>{e.slug.includes("financ")||e.slug.includes("monto")||e.slug.includes("precio")?i.financiero.push(e):e.slug.includes("info")||e.slug.includes("descrip")?i.informacion.push(e):i.otros.push(e)}),i}),f=D(()=>u.contrato.estado!=="finalizado"&&u.contrato.estado!=="cancelado"),J=i=>{const e=i.target;e.files&&e.files[0]&&(r.archivo_pdf=e.files[0],L.value="Nuevo archivo: "+e.files[0].name)},ce=()=>{const i=[];return r.proyecto_id||i.push("Debe seleccionar un proyecto"),r.nombre.trim()||i.push("El nombre del contrato es obligatorio"),r.fecha_inicio||i.push("La fecha de inicio es obligatoria"),r.fecha_fin&&r.fecha_fin<r.fecha_inicio&&i.push("La fecha de fin debe ser posterior a la fecha de inicio"),u.camposPersonalizados.forEach(e=>{e.es_requerido&&!r.campos_personalizados[e.id]&&i.push(`El campo "${e.nombre}" es obligatorio`)}),i},ve=()=>{const i=ce();if(i.length>0){i.forEach(l=>x.error(l));return}const e=new FormData;Object.keys(r.data()).forEach(l=>{l==="campos_personalizados"?Object.keys(r.campos_personalizados).forEach(p=>{const g=r.campos_personalizados[p];g!=null&&g!==""&&e.append(`campos_personalizados[${p}]`,g)}):l==="participantes"?r.participantes.forEach((p,g)=>{e.append(`participantes[${g}][user_id]`,p.user_id.toString()),e.append(`participantes[${g}][rol]`,p.rol),p.notas&&e.append(`participantes[${g}][notas]`,p.notas)}):l==="archivo_pdf"&&r.archivo_pdf?e.append("archivo_pdf",r.archivo_pdf):l==="responsable_id"&&r[l]==="none"||l!=="_method"&&r[l]!==null&&r[l]!==""&&e.append(l,r[l])}),e.append("_method","PUT"),I.post(k("admin.contratos.update",u.contrato.id),e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{x.success("Contrato actualizado exitosamente")},onError:l=>{typeof l=="object"&&l!==null?Object.values(l).forEach(p=>{Array.isArray(p)?p.forEach(g=>x.error(String(g))):typeof p=="string"?x.error(p):x.error("Error al actualizar el contrato")}):x.error("Error al actualizar el contrato")}})},_e=()=>{confirm("¿Está seguro de eliminar este contrato? Esta acción no se puede deshacer.")&&I.delete(k("admin.contratos.destroy",u.contrato.id),{onSuccess:()=>{x.success("Contrato eliminado exitosamente")},onError:()=>{x.error("Error al eliminar el contrato")}})},be=()=>{confirm("¿Desea duplicar este contrato?")&&I.post(k("admin.contratos.duplicar",u.contrato.id),{},{onSuccess:()=>{x.success("Contrato duplicado exitosamente")},onError:()=>{x.error("Error al duplicar el contrato")}})},B=i=>{I.post(k("admin.contratos.cambiar-estado",u.contrato.id),{estado:i},{onSuccess:()=>{r.estado=i,x.success("Estado actualizado exitosamente")},onError:()=>{x.error("Error al cambiar el estado")}})},ge=()=>{confirm("¿Está seguro de cancelar? Los cambios no guardados se perderán.")&&I.get(k("admin.contratos.show",u.contrato.id))};return(i,e)=>(d(),C(ke,{breadcrumbs:se},{default:a(()=>[n("div",Fe,[n("div",De,[n("div",Ie,[t(o(Ce),{href:o(k)("admin.contratos.index")},{default:a(()=>[t(o(b),{variant:"ghost",size:"sm"},{default:a(()=>[t(o(Se),{class:"h-4 w-4 mr-2"}),e[26]||(e[26]=s(" Volver ",-1))]),_:1})]),_:1},8,["href"]),n("div",null,[e[27]||(e[27]=n("h1",{class:"text-3xl font-bold"},"Editar Contrato",-1)),n("p",Ne,"Modificar información del contrato #"+v(i.contrato.id),1)])]),n("div",je,[t(o(b),{variant:"outline",onClick:be},{default:a(()=>[...e[28]||(e[28]=[s(" Duplicar ",-1)])]),_:1}),t(o(b),{variant:"destructive",onClick:_e},{default:a(()=>[t(o(Pe),{class:"h-4 w-4 mr-2"}),e[29]||(e[29]=s(" Eliminar ",-1))]),_:1})])]),f.value?c("",!0):(d(),C(o(Z),{key:0,variant:"warning"},{default:a(()=>[t(o(te),{class:"h-4 w-4"}),t(o(ee),null,{default:a(()=>[s(" Este contrato está "+v(i.contrato.estado)+" y no puede ser editado. ",1),i.contrato.estado==="finalizado"?(d(),C(o(b),{key:0,variant:"link",size:"sm",onClick:e[0]||(e[0]=l=>B("activo")),class:"ml-2"},{default:a(()=>[...e[30]||(e[30]=[s(" Reactivar ",-1)])]),_:1})):c("",!0)]),_:1})]),_:1})),f.value?(d(),C(o(E),{key:1},{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),{class:"text-lg"},{default:a(()=>[...e[31]||(e[31]=[s("Cambio Rápido de Estado",-1)])]),_:1})]),_:1}),t(o(S),null,{default:a(()=>[n("div",Me,[o(r).estado==="borrador"?(d(),C(o(b),{key:0,variant:"outline",size:"sm",onClick:e[1]||(e[1]=l=>B("activo"))},{default:a(()=>[...e[32]||(e[32]=[s(" Activar Contrato ",-1)])]),_:1})):c("",!0),o(r).estado==="activo"?(d(),C(o(b),{key:1,variant:"outline",size:"sm",onClick:e[2]||(e[2]=l=>B("finalizado"))},{default:a(()=>[...e[33]||(e[33]=[s(" Finalizar Contrato ",-1)])]),_:1})):c("",!0),o(r).estado!=="cancelado"?(d(),C(o(b),{key:2,variant:"outline",size:"sm",class:"text-red-600",onClick:e[3]||(e[3]=l=>B("cancelado"))},{default:a(()=>[...e[34]||(e[34]=[s(" Cancelar Contrato ",-1)])]),_:1})):c("",!0)])]),_:1})]),_:1})):c("",!0),n("form",{onSubmit:Ve(ve,["prevent"]),class:"space-y-6"},[t(o(Ee),{modelValue:W.value,"onUpdate:modelValue":e[23]||(e[23]=l=>W.value=l)},{default:a(()=>[t(o(Ue),{class:"grid w-full grid-cols-5"},{default:a(()=>[t(o(R),{value:"informacion"},{default:a(()=>[...e[35]||(e[35]=[s("Información General",-1)])]),_:1}),t(o(R),{value:"fechas"},{default:a(()=>[...e[36]||(e[36]=[s("Fechas y Estado",-1)])]),_:1}),t(o(R),{value:"financiero"},{default:a(()=>[...e[37]||(e[37]=[s("Información Financiera",-1)])]),_:1}),t(o(R),{value:"contraparte"},{default:a(()=>[...e[38]||(e[38]=[s("Contraparte",-1)])]),_:1}),t(o(R),{value:"adicional"},{default:a(()=>[...e[39]||(e[39]=[s("Información Adicional",-1)])]),_:1})]),_:1}),t(o(O),{value:"informacion"},{default:a(()=>[t(o(E),null,{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),null,{default:a(()=>[...e[40]||(e[40]=[s("Información General",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[41]||(e[41]=[s("Datos principales del contrato",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:a(()=>[n("div",Te,[n("div",null,[t(o(_),{for:"proyecto_id"},{default:a(()=>[...e[42]||(e[42]=[s("Proyecto *",-1)])]),_:1}),t(o(N),{modelValue:o(r).proyecto_id,"onUpdate:modelValue":e[4]||(e[4]=l=>o(r).proyecto_id=l),disabled:!f.value},{default:a(()=>[t(o(j),null,{default:a(()=>[t(o(M),{placeholder:"Seleccione un proyecto"})]),_:1}),t(o(T),null,{default:a(()=>[(d(!0),m(P,null,z(i.proyectos,l=>(d(),C(o(y),{key:l.id,value:l.id.toString()},{default:a(()=>[s(v(l.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.proyecto_id?(d(),m("div",Re,v(o(r).errors.proyecto_id),1)):c("",!0)]),n("div",null,[t(o(_),{for:"nombre"},{default:a(()=>[...e[43]||(e[43]=[s("Nombre del Contrato *",-1)])]),_:1}),t(o(V),{id:"nombre",modelValue:o(r).nombre,"onUpdate:modelValue":e[5]||(e[5]=l=>o(r).nombre=l),placeholder:"Ej: Contrato de servicios de consultoría",disabled:!f.value},null,8,["modelValue","disabled"]),o(r).errors.nombre?(d(),m("div",Oe,v(o(r).errors.nombre),1)):c("",!0)])]),n("div",null,[t(o(_),{for:"descripcion"},{default:a(()=>[...e[44]||(e[44]=[s("Descripción",-1)])]),_:1}),t(o(Y),{id:"descripcion",modelValue:o(r).descripcion,"onUpdate:modelValue":e[6]||(e[6]=l=>o(r).descripcion=l),placeholder:"Descripción detallada del contrato...",rows:"4",disabled:!f.value},null,8,["modelValue","disabled"]),o(r).errors.descripcion?(d(),m("div",qe,v(o(r).errors.descripcion),1)):c("",!0)]),A.value.informacion.length>0?(d(),m("div",Be,[e[45]||(e[45]=n("h3",{class:"font-medium"},"Información Complementaria",-1)),(d(!0),m(P,null,z(A.value.informacion,l=>(d(),m("div",{key:l.id},[t(h,{campo:l,modelValue:o(r).campos_personalizados[l.id],"onUpdate:modelValue":p=>o(r).campos_personalizados[l.id]=p,disabled:!f.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):c("",!0)]),_:1})]),_:1})]),_:1}),t(o(O),{value:"fechas"},{default:a(()=>[t(o(E),null,{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),null,{default:a(()=>[...e[46]||(e[46]=[s("Fechas y Estado",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[47]||(e[47]=[s("Configure las fechas y el estado del contrato",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:a(()=>[n("div",Le,[n("div",null,[t(o(_),{for:"fecha_inicio"},{default:a(()=>[...e[48]||(e[48]=[s("Fecha de Inicio *",-1)])]),_:1}),t(o(V),{id:"fecha_inicio",type:"date",modelValue:o(r).fecha_inicio,"onUpdate:modelValue":e[7]||(e[7]=l=>o(r).fecha_inicio=l),disabled:!f.value},null,8,["modelValue","disabled"]),o(r).errors.fecha_inicio?(d(),m("div",Ge,v(o(r).errors.fecha_inicio),1)):c("",!0)]),n("div",null,[t(o(_),{for:"fecha_fin"},{default:a(()=>[...e[49]||(e[49]=[s("Fecha de Fin",-1)])]),_:1}),t(o(V),{id:"fecha_fin",type:"date",modelValue:o(r).fecha_fin,"onUpdate:modelValue":e[8]||(e[8]=l=>o(r).fecha_fin=l),disabled:!f.value},null,8,["modelValue","disabled"]),o(r).errors.fecha_fin?(d(),m("div",Xe,v(o(r).errors.fecha_fin),1)):c("",!0)]),n("div",null,[t(o(_),{for:"estado"},{default:a(()=>[...e[50]||(e[50]=[s("Estado",-1)])]),_:1}),t(o(N),{modelValue:o(r).estado,"onUpdate:modelValue":e[9]||(e[9]=l=>o(r).estado=l),disabled:!f.value},{default:a(()=>[t(o(j),null,{default:a(()=>[t(o(M))]),_:1}),t(o(T),null,{default:a(()=>[t(o(y),{value:"borrador"},{default:a(()=>[...e[51]||(e[51]=[s("Borrador",-1)])]),_:1}),t(o(y),{value:"activo"},{default:a(()=>[...e[52]||(e[52]=[s("Activo",-1)])]),_:1}),t(o(y),{value:"finalizado"},{default:a(()=>[...e[53]||(e[53]=[s("Finalizado",-1)])]),_:1}),t(o(y),{value:"cancelado"},{default:a(()=>[...e[54]||(e[54]=[s("Cancelado",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.estado?(d(),m("div",he,v(o(r).errors.estado),1)):c("",!0)]),n("div",null,[t(o(_),{for:"tipo"},{default:a(()=>[...e[55]||(e[55]=[s("Tipo de Contrato *",-1)])]),_:1}),t(o(N),{modelValue:o(r).tipo,"onUpdate:modelValue":e[10]||(e[10]=l=>o(r).tipo=l),disabled:!f.value},{default:a(()=>[t(o(j),null,{default:a(()=>[t(o(M))]),_:1}),t(o(T),null,{default:a(()=>[t(o(y),{value:"servicio"},{default:a(()=>[...e[56]||(e[56]=[s("Servicio",-1)])]),_:1}),t(o(y),{value:"obra"},{default:a(()=>[...e[57]||(e[57]=[s("Obra",-1)])]),_:1}),t(o(y),{value:"suministro"},{default:a(()=>[...e[58]||(e[58]=[s("Suministro",-1)])]),_:1}),t(o(y),{value:"consultoria"},{default:a(()=>[...e[59]||(e[59]=[s("Consultoría",-1)])]),_:1}),t(o(y),{value:"otro"},{default:a(()=>[...e[60]||(e[60]=[s("Otro",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.tipo?(d(),m("div",We,v(o(r).errors.tipo),1)):c("",!0)])]),i.usuarios?(d(),m("div",He,[t(o(_),{for:"responsable_id"},{default:a(()=>[...e[61]||(e[61]=[s("Responsable",-1)])]),_:1}),t(o(N),{modelValue:o(r).responsable_id,"onUpdate:modelValue":e[11]||(e[11]=l=>o(r).responsable_id=l),disabled:!f.value},{default:a(()=>[t(o(j),null,{default:a(()=>[t(o(M),{placeholder:"Seleccione un responsable"})]),_:1}),t(o(T),null,{default:a(()=>[t(o(y),{value:"none"},{default:a(()=>[...e[62]||(e[62]=[s("Sin responsable",-1)])]),_:1}),(d(!0),m(P,null,z(i.usuarios,l=>(d(),C(o(y),{key:l.id,value:l.id.toString()},{default:a(()=>[s(v(l.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])])):c("",!0)]),_:1})]),_:1})]),_:1}),t(o(O),{value:"financiero"},{default:a(()=>[t(o(E),null,{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),null,{default:a(()=>[...e[63]||(e[63]=[s("Información Financiera",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[64]||(e[64]=[s("Montos y detalles financieros del contrato",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:a(()=>[n("div",Je,[n("div",null,[t(o(_),{for:"monto_total"},{default:a(()=>[...e[65]||(e[65]=[s("Monto Total",-1)])]),_:1}),t(o(V),{id:"monto_total",type:"number",step:"0.01",modelValue:o(r).monto_total,"onUpdate:modelValue":e[12]||(e[12]=l=>o(r).monto_total=l),placeholder:"0.00",disabled:!f.value},null,8,["modelValue","disabled"]),o(r).errors.monto_total?(d(),m("div",Ke,v(o(r).errors.monto_total),1)):c("",!0)]),n("div",null,[t(o(_),{for:"moneda"},{default:a(()=>[...e[66]||(e[66]=[s("Moneda",-1)])]),_:1}),t(o(N),{modelValue:o(r).moneda,"onUpdate:modelValue":e[13]||(e[13]=l=>o(r).moneda=l),disabled:!f.value},{default:a(()=>[t(o(j),null,{default:a(()=>[t(o(M))]),_:1}),t(o(T),null,{default:a(()=>[(d(),m(P,null,z(ne,l=>t(o(y),{key:l.value,value:l.value},{default:a(()=>[s(v(l.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue","disabled"]),o(r).errors.moneda?(d(),m("div",Qe,v(o(r).errors.moneda),1)):c("",!0)])]),A.value.financiero.length>0?(d(),m("div",Ye,[e[67]||(e[67]=n("h3",{class:"font-medium"},"Campos Financieros Personalizados",-1)),(d(!0),m(P,null,z(A.value.financiero,l=>(d(),m("div",{key:l.id},[t(h,{campo:l,modelValue:o(r).campos_personalizados[l.id],"onUpdate:modelValue":p=>o(r).campos_personalizados[l.id]=p,disabled:!f.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):c("",!0)]),_:1})]),_:1})]),_:1}),t(o(O),{value:"contraparte"},{default:a(()=>[n("div",Ze,[t(o(E),null,{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),null,{default:a(()=>[...e[68]||(e[68]=[s("Contraparte - Usuario del Sistema",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[69]||(e[69]=[s(" Seleccione un usuario del sistema como contraparte del contrato ",-1)])]),_:1})]),_:1}),t(o(S),null,{default:a(()=>[n("div",eo,[n("div",null,[t(o(_),null,{default:a(()=>[...e[70]||(e[70]=[s("Usuario Contraparte",-1)])]),_:1}),e[71]||(e[71]=n("p",{class:"text-sm text-muted-foreground mb-2"}," Si la contraparte es un usuario registrado en el sistema, selecciónelo aquí ",-1))]),q.value?(d(),m("div",oo,[n("div",null,[n("p",to,v(q.value.name),1),n("p",ao,v(q.value.email),1)]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:e[14]||(e[14]=l=>{o(r).contraparte_user_id=null,o(r).contraparte_nombre="",o(r).contraparte_email=""}),disabled:!f.value},{default:a(()=>[t(o(ae),{class:"h-4 w-4"})]),_:1},8,["disabled"])])):c("",!0),t(o(b),{type:"button",variant:"outline",onClick:e[15]||(e[15]=l=>G.value=!0),class:"w-full",disabled:!f.value},{default:a(()=>[t(o(ze),{class:"h-4 w-4 mr-2"}),s(" "+v(q.value?"Cambiar Contraparte":"Seleccionar Contraparte"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),t(o(E),null,{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),null,{default:a(()=>[...e[72]||(e[72]=[s("Contraparte - Información Externa",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[73]||(e[73]=[s(" Complete estos campos si la contraparte no es un usuario del sistema ",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:a(()=>[o(r).contraparte_user_id?(d(),C(o(Z),{key:0,class:"mb-4"},{default:a(()=>[t(o(te),{class:"h-4 w-4"}),t(o(ee),null,{default:a(()=>[...e[74]||(e[74]=[s(" Los campos de contraparte externa están deshabilitados porque ya se seleccionó un usuario del sistema. ",-1)])]),_:1})]),_:1})):c("",!0),n("div",ro,[n("div",null,[t(o(_),{for:"contraparte_nombre"},{default:a(()=>[...e[75]||(e[75]=[s("Nombre de la Contraparte",-1)])]),_:1}),t(o(V),{id:"contraparte_nombre",modelValue:o(r).contraparte_nombre,"onUpdate:modelValue":e[16]||(e[16]=l=>o(r).contraparte_nombre=l),placeholder:"Nombre de la empresa o persona",disabled:!f.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(_),{for:"contraparte_identificacion"},{default:a(()=>[...e[76]||(e[76]=[s("Identificación/RUC",-1)])]),_:1}),t(o(V),{id:"contraparte_identificacion",modelValue:o(r).contraparte_identificacion,"onUpdate:modelValue":e[17]||(e[17]=l=>o(r).contraparte_identificacion=l),placeholder:"Número de identificación",disabled:!f.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(_),{for:"contraparte_email"},{default:a(()=>[...e[77]||(e[77]=[s("Email de Contacto",-1)])]),_:1}),t(o(V),{id:"contraparte_email",type:"email",modelValue:o(r).contraparte_email,"onUpdate:modelValue":e[18]||(e[18]=l=>o(r).contraparte_email=l),placeholder:"email@ejemplo.com",disabled:!f.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])]),n("div",null,[t(o(_),{for:"contraparte_telefono"},{default:a(()=>[...e[78]||(e[78]=[s("Teléfono de Contacto",-1)])]),_:1}),t(o(V),{id:"contraparte_telefono",modelValue:o(r).contraparte_telefono,"onUpdate:modelValue":e[19]||(e[19]=l=>o(r).contraparte_telefono=l),placeholder:"+1234567890",disabled:!f.value||!!o(r).contraparte_user_id},null,8,["modelValue","disabled"])])])]),_:1})]),_:1}),t(o(E),null,{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),null,{default:a(()=>[...e[79]||(e[79]=[s("Participantes del Contrato",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[80]||(e[80]=[s(" Agregue usuarios del sistema que participarán en este contrato con diferentes roles ",-1)])]),_:1})]),_:1}),t(o(S),null,{default:a(()=>[n("div",lo,[t(o(b),{type:"button",variant:"outline",onClick:e[20]||(e[20]=l=>X.value=!0),class:"w-full",disabled:!f.value},{default:a(()=>[t(o(re),{class:"h-4 w-4 mr-2"}),e[81]||(e[81]=s(" Agregar Participantes ",-1))]),_:1},8,["disabled"]),o(r).participantes.length>0?(d(),m("div",so,[e[82]||(e[82]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Participantes agregados:",-1)),(d(!0),m(P,null,z(o(r).participantes,l=>{var p,g;return d(),m("div",{key:l.user_id,class:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[n("div",io,[n("div",null,[n("p",no,v((p=H(l.user_id))==null?void 0:p.name),1),n("p",uo,v((g=H(l.user_id))==null?void 0:g.email),1),n("div",mo,[n("span",po,v(l.rol),1),l.notas?(d(),m("span",fo,v(l.notas),1)):c("",!0)])]),t(o(b),{type:"button",variant:"ghost",size:"sm",onClick:Co=>fe(l.user_id),disabled:!f.value},{default:a(()=>[t(o(ae),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])])])}),128))])):(d(),m("div",co,[t(o(re),{class:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),e[83]||(e[83]=n("p",{class:"text-sm text-muted-foreground"},"No hay participantes agregados",-1))]))])]),_:1})]),_:1})])]),_:1}),t(o(O),{value:"adicional"},{default:a(()=>[t(o(E),null,{default:a(()=>[t(o(U),null,{default:a(()=>[t(o($),null,{default:a(()=>[...e[84]||(e[84]=[s("Información Adicional",-1)])]),_:1}),t(o(w),null,{default:a(()=>[...e[85]||(e[85]=[s("Archivos y observaciones",-1)])]),_:1})]),_:1}),t(o(S),{class:"space-y-4"},{default:a(()=>[n("div",null,[t(o(_),{for:"archivo_pdf"},{default:a(()=>[...e[86]||(e[86]=[s("Archivo del Contrato (PDF)",-1)])]),_:1}),n("div",vo,[t(o(V),{id:"archivo_pdf",type:"file",accept:".pdf",onChange:J,class:"hidden",disabled:!f.value},null,8,["disabled"]),t(o(b),{type:"button",variant:"outline",onClick:e[21]||(e[21]=l=>i.$refs.fileInput.click()),disabled:!f.value},{default:a(()=>[t(o(we),{class:"h-4 w-4 mr-2"}),e[87]||(e[87]=s(" Cambiar PDF ",-1))]),_:1},8,["disabled"]),L.value?(d(),m("span",_o,v(L.value),1)):c("",!0)]),e[88]||(e[88]=n("p",{class:"text-xs text-gray-500 mt-1"},"Máximo 10MB",-1)),o(r).errors.archivo_pdf?(d(),m("div",bo,v(o(r).errors.archivo_pdf),1)):c("",!0)]),n("div",null,[t(o(_),{for:"observaciones"},{default:a(()=>[...e[89]||(e[89]=[s("Observaciones",-1)])]),_:1}),t(o(Y),{id:"observaciones",modelValue:o(r).observaciones,"onUpdate:modelValue":e[22]||(e[22]=l=>o(r).observaciones=l),placeholder:"Notas u observaciones adicionales...",rows:"4",disabled:!f.value},null,8,["modelValue","disabled"]),o(r).errors.observaciones?(d(),m("div",go,v(o(r).errors.observaciones),1)):c("",!0)]),A.value.otros.length>0?(d(),m("div",yo,[e[90]||(e[90]=n("h3",{class:"font-medium"},"Campos Personalizados",-1)),(d(!0),m(P,null,z(A.value.otros,l=>(d(),m("div",{key:l.id},[t(h,{campo:l,modelValue:o(r).campos_personalizados[l.id],"onUpdate:modelValue":p=>o(r).campos_personalizados[l.id]=p,disabled:!f.value},null,8,["campo","modelValue","onUpdate:modelValue","disabled"])]))),128))])):c("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),f.value?(d(),m("div",xo,[t(o(b),{type:"button",variant:"outline",onClick:ge,disabled:o(r).processing},{default:a(()=>[...e[91]||(e[91]=[s(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(o(b),{type:"submit",disabled:o(r).processing},{default:a(()=>[t(o(Ae),{class:"h-4 w-4 mr-2"}),s(" "+v(o(r).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])):c("",!0)],32)]),n("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:J,class:"hidden"},null,544),t(oe,{modelValue:G.value,"onUpdate:modelValue":e[24]||(e[24]=l=>G.value=l),title:"Seleccionar Contraparte",description:"Selecciona el usuario que será la contraparte del contrato","search-endpoint":o(k)("admin.proyectos.search-users"),"excluded-ids":o(r).contraparte_user_id?[o(r).contraparte_user_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Contraparte","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:me},null,8,["modelValue","search-endpoint","excluded-ids"]),t(oe,{modelValue:X.value,"onUpdate:modelValue":e[25]||(e[25]=l=>X.value=l),title:"Agregar Participantes",description:"Selecciona los usuarios que participarán en este contrato y define su rol","search-endpoint":o(k)("admin.proyectos.search-users"),"excluded-ids":ue.value,"extra-fields":de.value,"submit-button-text":"Agregar Participantes","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:pe},null,8,["modelValue","search-endpoint","excluded-ids","extra-fields"])]),_:1}))}});export{jt as default};
