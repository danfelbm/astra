import{d as P,i as f,e,w as a,f as t,h as d,F as R,k as X,g as m,m as n,b as v,j as b,v as J,t as k,c as I,r as U,s as $,n as q}from"./app-B9TOPmlt.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DBuYjDAl.js";import{_ as w}from"./createLucideIcon-DpBiCm_n.js";import{_ as D,c as A,a as tt,b as et}from"./CardTitle.vue_vue_type_script_setup_true_lang-8JbMmZ0-.js";import{O as at}from"./ObligacionTree-CU0HPhW9.js";import{_ as ot}from"./index-BX3b2fLA.js";import{a as st,b as G,c as V,d as it,_ as lt,e as B}from"./TableHeader.vue_vue_type_script_setup_true_lang-Lmk-Q7pk.js";import{_ as nt,a as rt,b as dt,e as F,d as ct}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-sawyMmTN.js";import{u as K}from"./usePermissions-Ob0tXupV.js";import{C as mt}from"./circle-alert-DS5qv-mP.js";import{E as ut}from"./ellipsis-vertical-PmBrMsnF.js";import{E as ft}from"./eye-Cd-dDIQG.js";import{P as pt}from"./pencil-UTB3Tezv.js";import{T as gt}from"./trash-2-CoPlWJbq.js";import{_ as bt}from"./Input.vue_vue_type_script_setup_true_lang-CvNMbvGN.js";import{_ as H}from"./Label.vue_vue_type_script_setup_true_lang-B_9lqbQW.js";import{_ as vt,a as _t,b as ht,c as xt,d as M}from"./SelectValue.vue_vue_type_script_setup_true_lang-D3EwhHq3.js";import{S as yt}from"./search-C3SA702q.js";import{F as $t}from"./filter-DsNHb0Ff.js";import{X as kt}from"./x-Cei9FK_W.js";import{_ as wt}from"./Pagination.vue_vue_type_script_setup_true_lang-Ca2uTWDE.js";import{t as T}from"./index-BTjg3Nao.js";import{l as Ct}from"./lodash-DDh6fpT-.js";import{D as Ot}from"./download-CyuA8ekH.js";import{P as Et}from"./plus-Bg_YIXDk.js";import{T as St}from"./tree-pine-BqAydKGK.js";import{L as Vt}from"./list-BovtmYMx.js";import"./useFlashMessages-w2rvDQtt.js";import"./index-DkWnUc8Q.js";import"./floating-ui.vue-BEixnLxp.js";import"./index-pQLg4C2_.js";import"./shield-Dn7CuH8Q.js";import"./user-Da-HkZ5M.js";import"./chevron-right-_4nRJ_uY.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-ByW9z0kj.js";import"./VisuallyHidden-Bi-0hazS.js";import"./index-FFvcsDEl.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Ca09oUOe.js";import"./map-pin-DmiZTikP.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-VJiJrCsO.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-lQ-C-vnU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B0ZmeXV3.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-ucYiIJj7.js";import"./tag-CF53NfGo.js";import"./users-B0NsgXmm.js";import"./target-Co51nDF2.js";import"./vote-C77vNdCE.js";import"./folder-open-CTk950sb.js";import"./send-CU6BPHgu.js";import"./file-text-Crx8E7OL.js";import"./briefcase-BE5QRmL6.js";import"./calendar-DorXl5Ec.js";import"./megaphone-B6hd4taf.js";import"./user-check-DbK6PlHx.js";import"./clipboard-list-B6e5Biye.js";import"./mail-BSXGefXW.js";import"./message-square-DPwDV_-Y.js";import"./external-link-BD2lnkio.js";import"./panel-left-DBOf36Cl.js";import"./check-CcWYkizm.js";import"./index-DHeDABhg.js";import"./Separator.vue_vue_type_script_setup_true_lang-Dqxo6364.js";import"./TooltipProvider.vue_vue_type_script_setup_true_lang-EV2EonbU.js";import"./circle-CLRHjMFm.js";import"./layers-B-Ub8V2K.js";import"./paperclip-Bss7YulS.js";import"./loader-circle-txzZleJg.js";const Bt={key:0},jt={class:"text-sm text-gray-600"},Ft={key:0,class:"text-sm"},Tt={key:1,class:"text-sm text-gray-400"},Dt={key:1,class:"text-center py-8 text-gray-500"},At=P({__name:"ObligacionTable",props:{obligaciones:{},canEdit:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1}},emits:["view","edit","delete"],setup(o,{emit:u}){const y=u,{hasPermission:g}=K();return(c,s)=>(n(),f("div",null,[o.obligaciones&&o.obligaciones.length>0?(n(),f("div",Bt,[e(t(lt),null,{default:a(()=>[e(t(st),null,{default:a(()=>[e(t(G),null,{default:a(()=>[e(t(V),null,{default:a(()=>[...s[0]||(s[0]=[d("Título",-1)])]),_:1}),e(t(V),null,{default:a(()=>[...s[1]||(s[1]=[d("Descripción",-1)])]),_:1}),e(t(V),null,{default:a(()=>[...s[2]||(s[2]=[d("Archivos",-1)])]),_:1}),e(t(V),{class:"text-right"},{default:a(()=>[...s[3]||(s[3]=[d("Acciones",-1)])]),_:1})]),_:1})]),_:1}),e(t(it),null,{default:a(()=>[(n(!0),f(R,null,X(o.obligaciones,r=>(n(),v(t(G),{key:r.id},{default:a(()=>[e(t(B),{class:"font-medium"},{default:a(()=>[m("div",null,[e(t(J),{href:`/admin/obligaciones/${r.id}`,class:"hover:text-blue-600 hover:underline"},{default:a(()=>[d(k(r.titulo),1)]),_:2},1032,["href"]),r.tiene_hijos?(n(),v(t(ot),{key:0,variant:"outline",class:"ml-2 text-xs"},{default:a(()=>[d(k(r.total_hijos)+" hijos ",1)]),_:2},1024)):b("",!0)])]),_:2},1024),e(t(B),null,{default:a(()=>[m("span",jt,k(r.descripcion?r.descripcion.length>100?r.descripcion.substring(0,100)+"...":r.descripcion:"Sin descripción"),1)]),_:2},1024),e(t(B),null,{default:a(()=>{var _;return[(_=r.archivos_adjuntos)!=null&&_.length?(n(),f("span",Ft,k(r.archivos_adjuntos.length)+" archivo(s) ",1)):(n(),f("span",Tt,"Sin archivos"))]}),_:2},1024),e(t(B),{class:"text-right"},{default:a(()=>[e(t(nt),null,{default:a(()=>[e(t(rt),{asChild:""},{default:a(()=>[e(t(w),{variant:"ghost",size:"icon",class:"h-8 w-8"},{default:a(()=>[e(t(ut),{class:"h-4 w-4"})]),_:1})]),_:1}),e(t(dt),{align:"end"},{default:a(()=>[e(t(F),{onClick:_=>y("view",r)},{default:a(()=>[e(t(ft),{class:"h-4 w-4 mr-2"}),s[4]||(s[4]=d(" Ver ",-1))]),_:1},8,["onClick"]),o.canEdit||t(g)("obligaciones.edit")?(n(),v(t(F),{key:0,onClick:_=>y("edit",r)},{default:a(()=>[e(t(pt),{class:"h-4 w-4 mr-2"}),s[5]||(s[5]=d(" Editar ",-1))]),_:1},8,["onClick"])):b("",!0),e(t(ct)),o.canDelete||t(g)("obligaciones.delete")?(n(),v(t(F),{key:1,class:"text-red-600",onClick:_=>y("delete",r)},{default:a(()=>[e(t(gt),{class:"h-4 w-4 mr-2"}),s[6]||(s[6]=d(" Eliminar ",-1))]),_:1},8,["onClick"])):b("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(n(),f("div",Dt,[e(t(mt),{class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),s[7]||(s[7]=m("p",null,"No se encontraron obligaciones",-1)),s[8]||(s[8]=m("p",{class:"text-sm mt-1"},"Crea una nueva obligación para comenzar",-1))]))]))}}),Pt={class:"flex flex-col sm:flex-row gap-4"},zt={class:"flex-1"},Nt={class:"relative"},Lt={key:0,class:"w-full sm:w-64"},It=P({__name:"ObligacionFilters",props:{modelValue:{},contratos:{default:()=>[]},loading:{type:Boolean,default:!1},showContratoFilter:{type:Boolean,default:!0}},emits:["update:modelValue","filter","clear"],setup(o,{emit:u}){const y=o,g=u,c=I({get:()=>y.modelValue,set:h=>g("update:modelValue",h)}),s=I(()=>c.value.search||y.showContratoFilter&&c.value.contrato_id),r=h=>{c.value={...c.value,search:h},g("filter")},_=h=>{const p=h==="all"?null:h;c.value={...c.value,contrato_id:p},g("filter")},j=()=>{c.value={search:"",contrato_id:null},g("clear")};return(h,p)=>(n(),v(t(D),null,{default:a(()=>[e(t(A),{class:"pt-6"},{default:a(()=>{var C;return[m("div",Pt,[m("div",zt,[e(t(H),{for:"search",class:"sr-only"},{default:a(()=>[...p[0]||(p[0]=[d("Buscar",-1)])]),_:1}),m("div",Nt,[e(t(yt),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e(t(bt),{id:"search","model-value":c.value.search,type:"text",placeholder:"Buscar por título o descripción...",class:"pl-10",disabled:o.loading,"onUpdate:modelValue":r},null,8,["model-value","disabled"])])]),o.showContratoFilter&&o.contratos.length>0?(n(),f("div",Lt,[e(t(H),{for:"contrato_id",class:"sr-only"},{default:a(()=>[...p[1]||(p[1]=[d("Contrato",-1)])]),_:1}),e(t(vt),{"model-value":((C=c.value.contrato_id)==null?void 0:C.toString())||"all",disabled:o.loading,"onUpdate:modelValue":_},{default:a(()=>[e(t(_t),{id:"contrato_id"},{default:a(()=>[e(t($t),{class:"h-4 w-4 mr-2 text-gray-400"}),e(t(ht),{placeholder:"Todos los contratos"})]),_:1}),e(t(xt),null,{default:a(()=>[e(t(M),{value:"all"},{default:a(()=>[...p[2]||(p[2]=[d("Todos los contratos",-1)])]),_:1}),(n(!0),f(R,null,X(o.contratos,O=>(n(),v(t(M),{key:O.id,value:O.id.toString()},{default:a(()=>[d(k(O.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])])):b("",!0),s.value?(n(),v(t(w),{key:1,variant:"ghost",size:"icon",disabled:o.loading,onClick:j,title:"Limpiar filtros"},{default:a(()=>[e(t(kt),{class:"h-4 w-4"})]),_:1},8,["disabled"])):b("",!0)])]}),_:1})]),_:1}))}}),Ut={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},qt={class:"flex items-center justify-between"},Gt={class:"text-3xl font-bold"},Ht={key:0,class:"text-sm text-gray-600"},Mt={class:"flex items-center gap-2"},Rt={class:"text-2xl font-bold"},Xt={class:"flex items-center justify-between"},Jt={class:"flex items-center gap-2"},Kt={key:0},Qt={key:1},Wt={key:0,class:"mt-4 flex justify-center"},ua=P({__name:"Index",props:{obligaciones:{},estadisticas:{},filters:{},contrato:{},contratos:{},estadisticasResponsables:{},canCreate:{type:Boolean},canEdit:{type:Boolean},canDelete:{type:Boolean},canComplete:{type:Boolean},canExport:{type:Boolean}},setup(o){var z,N,L;const u=o,y=u.contrato?[{title:"Admin",href:"/admin/dashboard"},{title:"Contratos",href:"/admin/contratos"},{title:u.contrato.nombre,href:`/admin/contratos/${u.contrato.id}`},{title:"Obligaciones",href:"#"}]:[{title:"Admin",href:"/admin/dashboard"},{title:"Obligaciones",href:"/admin/obligaciones"}],{hasPermission:g}=K(),c=U("tabla"),s=U({search:((z=u.filters)==null?void 0:z.search)||"",contrato_id:((N=u.filters)==null?void 0:N.contrato_id)||((L=u.contrato)==null?void 0:L.id)||null}),r=Ct.debounce(()=>{$.get(route("admin.obligaciones.index"),s.value,{preserveState:!0,preserveScroll:!0})},300),_=()=>{var l;s.value={search:"",contrato_id:((l=u.contrato)==null?void 0:l.id)||null},r()},j=()=>{var l;$.visit(route("admin.obligaciones.create",{contrato_id:(l=u.contrato)==null?void 0:l.id}))},h=l=>{$.visit(route("admin.obligaciones.show",l.id))},p=l=>{$.visit(route("admin.obligaciones.edit",l.id))},C=l=>{const i=l.tiene_hijos?`¿Estás seguro de eliminar "${l.titulo}" y todas sus obligaciones hijas?`:`¿Estás seguro de eliminar "${l.titulo}"?`;confirm(i)&&$.delete(route("admin.obligaciones.destroy",l.id),{preserveScroll:!0,onSuccess:()=>{T.success("Obligación eliminada exitosamente")}})},O=l=>{$.post(route("admin.obligaciones.completar",l.id),{},{preserveScroll:!0,onSuccess:()=>{T.success("Obligación marcada como cumplida")}})},Q=l=>{$.visit(route("admin.obligaciones.create",{contrato_id:l.contrato_id,parent_id:l.id}))},W=(l,i,S)=>{$.post(route("admin.obligaciones.mover",l.id),{nuevo_parent_id:i,nuevo_orden:S},{preserveScroll:!0,onSuccess:()=>{T.success("Obligación movida exitosamente")}})},Y=()=>{window.open(route("admin.obligaciones.exportar",s.value),"_blank")};return(l,i)=>(n(),v(Z,{breadcrumbs:t(y)},{default:a(()=>{var S;return[m("div",Ut,[m("div",qt,[m("div",null,[m("h1",Gt,[i[3]||(i[3]=d(" Obligaciones ",-1)),o.contrato?(n(),f("span",Ht," - "+k(o.contrato.nombre),1)):b("",!0)]),i[4]||(i[4]=m("p",{class:"text-gray-600 mt-1"},"Gestiona las obligaciones de los contratos",-1))]),m("div",Mt,[o.canExport||t(g)("obligaciones.export")?(n(),v(t(w),{key:0,variant:"outline",size:"sm",onClick:Y},{default:a(()=>[e(t(Ot),{class:"h-4 w-4 mr-2"}),i[5]||(i[5]=d(" Exportar ",-1))]),_:1})):b("",!0),o.canCreate||t(g)("obligaciones.create")?(n(),v(t(J),{key:1,href:l.route("admin.obligaciones.create",{contrato_id:(S=o.contrato)==null?void 0:S.id})},{default:a(()=>[e(t(w),null,{default:a(()=>[e(t(Et),{class:"h-4 w-4 mr-2"}),i[6]||(i[6]=d(" Nueva Obligación ",-1))]),_:1})]),_:1},8,["href"])):b("",!0)])]),e(It,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=x=>s.value=x),contratos:o.contratos||[],"show-contrato-filter":!o.contrato,onFilter:t(r),onClear:_},null,8,["modelValue","contratos","show-contrato-filter","onFilter"]),e(t(D),null,{default:a(()=>[e(t(A),{class:"pt-6"},{default:a(()=>{var x,E;return[m("div",Rt,k(((E=(x=o.obligaciones)==null?void 0:x.data)==null?void 0:E.length)||0),1),i[7]||(i[7]=m("p",{class:"text-sm text-gray-600"},"Total Obligaciones",-1))]}),_:1})]),_:1}),e(t(D),{class:"flex-1"},{default:a(()=>[e(t(tt),null,{default:a(()=>[m("div",Xt,[e(t(et),null,{default:a(()=>[...i[8]||(i[8]=[d("Lista de Obligaciones",-1)])]),_:1}),m("div",Jt,[e(t(w),{variant:"ghost",size:"sm",class:q({"bg-gray-100":c.value==="arbol"}),onClick:i[1]||(i[1]=x=>c.value="arbol")},{default:a(()=>[e(t(St),{class:"h-4 w-4 mr-1"}),i[9]||(i[9]=d(" Árbol ",-1))]),_:1},8,["class"]),e(t(w),{variant:"ghost",size:"sm",class:q({"bg-gray-100":c.value==="tabla"}),onClick:i[2]||(i[2]=x=>c.value="tabla")},{default:a(()=>[e(t(Vt),{class:"h-4 w-4 mr-1"}),i[10]||(i[10]=d(" Tabla ",-1))]),_:1},8,["class"])])])]),_:1}),e(t(A),null,{default:a(()=>{var x,E;return[c.value==="arbol"&&o.obligaciones.data&&o.obligaciones.data.length>0?(n(),f("div",Kt,[e(at,{obligaciones:o.obligaciones.data,contratoId:(x=o.contrato)==null?void 0:x.id,editable:!0,onCreate:j,onEdit:p,onDelete:C,onComplete:O,onAddChild:Q,onMove:W},null,8,["obligaciones","contratoId"])])):c.value==="tabla"?(n(),f("div",Qt,[e(At,{obligaciones:o.obligaciones.data||[],"can-edit":o.canEdit,"can-delete":o.canDelete,onView:h,onEdit:p,onDelete:C},null,8,["obligaciones","can-edit","can-delete"]),o.obligaciones.links&&((E=o.obligaciones.data)!=null&&E.length)?(n(),f("div",Wt,[e(wt,{links:o.obligaciones.links,meta:o.obligaciones.meta},null,8,["links","meta"])])):b("",!0)])):b("",!0)]}),_:1})]),_:1})])]}),_:1},8,["breadcrumbs"]))}});export{ua as default};
