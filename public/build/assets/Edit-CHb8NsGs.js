import{d as G,C as T,r as g,i as u,e as m,f as t,u as e,p as X,w as i,g as r,b as x,j as f,P as k,h as p,t as n,l as J,F as V,k as z}from"./app-Dt2sukkq.js";import{_ as K}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BAX2dDyG.js";import{_ as S,a as w,b as C,c as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-D3D16Ztn.js";import{_ as E}from"./CardDescription.vue_vue_type_script_setup_true_lang-CpG721w4.js";import{_ as v}from"./createLucideIcon-ADYiFz1p.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-B3JXaiF3.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-DCZhrf2e.js";import{_ as Q}from"./Textarea.vue_vue_type_script_setup_true_lang-CU9dUjfW.js";import{_ as U,a as D,b as H,c as M,d as $}from"./SelectValue.vue_vue_type_script_setup_true_lang-XTf0O-lR.js";import{_ as W}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-C9-k9UL2.js";import{_ as Y}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-BDUwohjA.js";import{t as j}from"./index-CTkeagVR.js";import{A as Z}from"./arrow-left-CcnTTf_x.js";import{X as O}from"./x-BpcUsJXn.js";import{U as ee}from"./user-plus-Cvkmfd0W.js";import{S as oe}from"./save-CPLxPeAL.js";import{f as I,e as R}from"./es-BDPlFIsO.js";import{p as B}from"./parseISO-DFjB8F03.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-Dk5ovgNn.js";import"./index-DYtBqwXi.js";import"./floating-ui.vue-DhUnkJfc.js";import"./index-C_zthh-d.js";import"./shield-Cyievtug.js";import"./user-Ca0ja34E.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Ch_KWbnG.js";import"./chevron-right-CkT1ue1I.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-V01rVzxA.js";import"./VisuallyHidden-H3fpmsLx.js";import"./index-YHYyGAco.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CwNj20AO.js";import"./circle-alert-Bny28mZr.js";import"./map-pin-D1rtVCPc.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-TmplCPgM.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BlnKZeFr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-CLsbi7q1.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BcP5joWp.js";import"./tag-euMStffd.js";import"./users-ARKz5o5z.js";import"./target-BlHWusLl.js";import"./vote-D-ho2Upj.js";import"./folder-open-BwpEZUDw.js";import"./send-D6GePUDU.js";import"./file-text-CrhgvIVS.js";import"./briefcase-CdnBkwVO.js";import"./calendar-CJYt0g6k.js";import"./megaphone-BWKT3hAA.js";import"./user-check-Cjdi1Rn1.js";import"./clipboard-list-DeVxPgd5.js";import"./mail-Cjqn3QRK.js";import"./message-square-CtTij58U.js";import"./external-link-GRGCmSzE.js";import"./panel-left-CvMlf3oX.js";import"./index-DZUQ23bj.js";import"./check-DzU-qwfx.js";import"./index-C5GM-A1h.js";import"./nullish-CHIgUVhi.js";import"./CampoPersonalizadoInput.vue_vue_type_script_setup_true_lang-BiPVkN8R.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-C9CiF85Y.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-BTeYrLXJ.js";import"./RovingFocusItem-BUHtT0jY.js";import"./utils-CveDOlSQ.js";import"./VisuallyHiddenInput-CTh2PJwg.js";import"./circle-C6O6G82s.js";import"./search-BkHaPo1l.js";import"./loader-circle-A6_XgNGB.js";import"./chevron-left-DryFAzkJ.js";const se={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},te={class:"flex items-center justify-between"},ie={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},re={class:"font-semibold"},ae={class:"font-semibold"},le={class:"font-semibold"},de={class:"font-semibold"},ne={class:"space-y-2"},pe={key:0,class:"text-sm text-red-500"},me={class:"space-y-2"},ue={key:0,class:"text-sm text-red-500"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce={class:"space-y-2"},_e={key:0,class:"text-sm text-red-500"},be={class:"space-y-2"},ve={key:0,class:"text-sm text-red-500"},ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={class:"space-y-2"},ge={key:0,class:"text-sm text-red-500"},xe={class:"space-y-2"},Ve={class:"space-y-2"},$e={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},ke={class:"font-medium"},ze={class:"text-sm text-muted-foreground"},Se={key:0,class:"text-sm text-red-500"},we={key:0,class:"space-y-2"},Ce={key:0,class:"text-sm text-red-500"},Pe={class:"space-y-2"},Ee={key:0,class:"text-sm text-red-500"},Ue={class:"flex justify-end gap-2 pt-4"},Xo=G({__name:"Edit",props:{hito:{},proyecto:{},responsables:{},hitosDisponibles:{},camposPersonalizados:{},valoresCamposPersonalizados:{},estados:{}},setup(F){const d=F,N=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:d.proyecto.nombre,href:`/admin/proyectos/${d.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${d.proyecto.id}/hitos`},{title:"Editar Hito",href:"#"}],s=T({nombre:d.hito.nombre||"",descripcion:d.hito.descripcion||"",fecha_inicio:d.hito.fecha_inicio||"",fecha_fin:d.hito.fecha_fin||"",estado:d.hito.estado||"pendiente",responsable_id:d.hito.responsable_id||null,parent_id:d.hito.parent_id||null,campos_personalizados:d.valoresCamposPersonalizados||{},orden:d.hito.orden||0}),h=g(!1),{route:q}=window,c=g(null),b=g(new Map);if(d.responsables.forEach(l=>b.value.set(l.id,l)),d.hito.responsable)c.value=d.hito.responsable,b.value.set(d.hito.responsable.id,d.hito.responsable);else if(s.responsable_id){const l=d.responsables.find(o=>o.id===s.responsable_id);l&&(c.value=l)}const A=l=>{if(l.userIds.length>0){const o=l.userIds[0];s.responsable_id=o,b.value.has(o)?c.value=b.value.get(o)||null:(c.value={id:o,name:`Usuario seleccionado (ID: ${o})`,email:"Se actualizará al guardar"},b.value.set(o,c.value))}},L=()=>{s.put(`/admin/proyectos/${d.proyecto.id}/hitos/${d.hito.id}`,{onSuccess:()=>{j.success("Hito actualizado exitosamente")},onError:()=>{j.error("Error al actualizar el hito")}})};return(l,o)=>(m(),u(V,null,[t(e(X),{title:`Editar Hito - ${l.hito.nombre}`},null,8,["title"]),t(K,{breadcrumbs:N},{default:i(()=>[r("div",se,[r("div",te,[o[12]||(o[12]=r("h1",{class:"text-2xl font-bold"},"Editar Hito",-1)),t(e(k),{href:`/admin/proyectos/${l.proyecto.id}/hitos`},{default:i(()=>[t(e(v),{variant:"outline",size:"sm"},{default:i(()=>[t(e(Z),{class:"h-4 w-4 mr-2"}),o[11]||(o[11]=p(" Volver ",-1))]),_:1})]),_:1},8,["href"])]),t(e(S),{class:"mb-4"},{default:i(()=>[t(e(w),null,{default:i(()=>[t(e(C),null,{default:i(()=>[p(n(l.hito.nombre),1)]),_:1}),t(e(E),null,{default:i(()=>[p(" Editando hito del proyecto: "+n(l.proyecto.nombre),1)]),_:1})]),_:1}),t(e(P),null,{default:i(()=>{var a;return[r("div",ie,[r("div",null,[o[13]||(o[13]=r("p",{class:"text-muted-foreground"},"Progreso",-1)),r("p",re,n(l.hito.porcentaje_completado||0)+"%",1)]),r("div",null,[o[14]||(o[14]=r("p",{class:"text-muted-foreground"},"Entregables",-1)),r("p",ae,n(((a=l.hito.entregables)==null?void 0:a.length)||0),1)]),r("div",null,[o[15]||(o[15]=r("p",{class:"text-muted-foreground"},"Creado",-1)),r("p",le,n(e(I)(e(B)(l.hito.created_at),"dd/MM/yyyy",{locale:e(R)})),1)]),r("div",null,[o[16]||(o[16]=r("p",{class:"text-muted-foreground"},"Última actualización",-1)),r("p",de,n(e(I)(e(B)(l.hito.updated_at),"dd/MM/yyyy",{locale:e(R)})),1)])])]}),_:1})]),_:1}),t(e(S),null,{default:i(()=>[t(e(w),null,{default:i(()=>[t(e(C),null,{default:i(()=>[...o[17]||(o[17]=[p("Información del Hito",-1)])]),_:1}),t(e(E),null,{default:i(()=>[...o[18]||(o[18]=[p(" Modifica los detalles del hito ",-1)])]),_:1})]),_:1}),t(e(P),null,{default:i(()=>[r("form",{onSubmit:J(L,["prevent"]),class:"space-y-6"},[r("div",ne,[t(e(_),{for:"nombre",required:""},{default:i(()=>[...o[19]||(o[19]=[p("Nombre del Hito",-1)])]),_:1}),t(e(y),{id:"nombre",modelValue:e(s).nombre,"onUpdate:modelValue":o[0]||(o[0]=a=>e(s).nombre=a),type:"text",placeholder:"Ej: Pre-producción",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.nombre?(m(),u("span",pe,n(e(s).errors.nombre),1)):f("",!0)]),r("div",me,[t(e(_),{for:"descripcion"},{default:i(()=>[...o[20]||(o[20]=[p("Descripción",-1)])]),_:1}),t(e(Q),{id:"descripcion",modelValue:e(s).descripcion,"onUpdate:modelValue":o[1]||(o[1]=a=>e(s).descripcion=a),placeholder:"Describe el objetivo y alcance del hito...",disabled:e(s).processing,rows:"3"},null,8,["modelValue","disabled"]),e(s).errors.descripcion?(m(),u("span",ue,n(e(s).errors.descripcion),1)):f("",!0)]),r("div",fe,[r("div",ce,[t(e(_),{for:"fecha_inicio"},{default:i(()=>[...o[21]||(o[21]=[p("Fecha de Inicio",-1)])]),_:1}),t(e(y),{id:"fecha_inicio",modelValue:e(s).fecha_inicio,"onUpdate:modelValue":o[2]||(o[2]=a=>e(s).fecha_inicio=a),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_inicio?(m(),u("span",_e,n(e(s).errors.fecha_inicio),1)):f("",!0)]),r("div",be,[t(e(_),{for:"fecha_fin"},{default:i(()=>[...o[22]||(o[22]=[p("Fecha de Fin",-1)])]),_:1}),t(e(y),{id:"fecha_fin",modelValue:e(s).fecha_fin,"onUpdate:modelValue":o[3]||(o[3]=a=>e(s).fecha_fin=a),type:"date",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.fecha_fin?(m(),u("span",ve,n(e(s).errors.fecha_fin),1)):f("",!0)])]),r("div",ye,[r("div",he,[t(e(_),{for:"estado"},{default:i(()=>[...o[23]||(o[23]=[p("Estado",-1)])]),_:1}),t(e(U),{modelValue:e(s).estado,"onUpdate:modelValue":o[4]||(o[4]=a=>e(s).estado=a)},{default:i(()=>[t(e(D),null,{default:i(()=>[t(e(H),{placeholder:"Seleccionar estado"})]),_:1}),t(e(M),null,{default:i(()=>[(m(!0),u(V,null,z(l.estados,a=>(m(),x(e($),{key:a.value,value:a.value},{default:i(()=>[p(n(a.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(s).errors.estado?(m(),u("span",ge,n(e(s).errors.estado),1)):f("",!0)]),r("div",xe,[t(e(_),{for:"responsable_id"},{default:i(()=>[...o[24]||(o[24]=[p("Responsable",-1)])]),_:1}),r("div",Ve,[c.value?(m(),u("div",$e,[r("div",null,[r("p",ke,n(c.value.name),1),r("p",ze,n(c.value.email),1)]),t(e(v),{type:"button",variant:"ghost",size:"sm",onClick:o[5]||(o[5]=a=>{e(s).responsable_id=null,c.value=null})},{default:i(()=>[t(e(O),{class:"h-4 w-4"})]),_:1})])):f("",!0),t(e(v),{type:"button",variant:"outline",onClick:o[6]||(o[6]=a=>h.value=!0),class:"w-full"},{default:i(()=>[t(e(ee),{class:"h-4 w-4 mr-2"}),p(" "+n(c.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(s).errors.responsable_id?(m(),u("span",Se,n(e(s).errors.responsable_id),1)):f("",!0)])]),l.hitosDisponibles&&l.hitosDisponibles.length>0?(m(),u("div",we,[t(e(_),{for:"parent_id"},{default:i(()=>[...o[25]||(o[25]=[p("Hito Padre (opcional)",-1)])]),_:1}),t(e(U),{modelValue:e(s).parent_id,"onUpdate:modelValue":o[7]||(o[7]=a=>e(s).parent_id=a)},{default:i(()=>[t(e(D),null,{default:i(()=>[t(e(H),{placeholder:"Sin padre (raíz)"})]),_:1}),t(e(M),null,{default:i(()=>[t(e($),{value:null},{default:i(()=>[...o[26]||(o[26]=[p("Sin padre (raíz)",-1)])]),_:1}),(m(!0),u(V,null,z(l.hitosDisponibles,a=>(m(),x(e($),{key:a.id,value:a.id,disabled:a.id===l.hito.id},{default:i(()=>[p(n("—".repeat(a.nivel))+" "+n(a.nombre),1)]),_:2},1032,["value","disabled"]))),128))]),_:1})]),_:1},8,["modelValue"]),o[27]||(o[27]=r("p",{class:"text-sm text-muted-foreground"},"Selecciona un hito padre para crear una jerarquía",-1)),e(s).errors.parent_id?(m(),u("span",Ce,n(e(s).errors.parent_id),1)):f("",!0)])):f("",!0),r("div",Pe,[t(e(_),{for:"orden"},{default:i(()=>[...o[28]||(o[28]=[p("Orden de visualización",-1)])]),_:1}),t(e(y),{id:"orden",modelValue:e(s).orden,"onUpdate:modelValue":o[8]||(o[8]=a=>e(s).orden=a),modelModifiers:{number:!0},type:"number",min:"0",disabled:e(s).processing},null,8,["modelValue","disabled"]),e(s).errors.orden?(m(),u("span",Ee,n(e(s).errors.orden),1)):f("",!0),o[29]||(o[29]=r("p",{class:"text-sm text-muted-foreground"}," Define el orden en que aparece este hito en la lista ",-1))]),r("div",Ue,[t(e(k),{href:`/admin/proyectos/${l.proyecto.id}/hitos`},{default:i(()=>[t(e(v),{type:"button",variant:"outline"},{default:i(()=>[...o[30]||(o[30]=[p("Cancelar",-1)])]),_:1})]),_:1},8,["href"]),t(e(v),{type:"submit",disabled:e(s).processing},{default:i(()=>[t(e(oe),{class:"h-4 w-4 mr-2"}),o[31]||(o[31]=p(" Guardar Cambios ",-1))]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),l.camposPersonalizados&&l.camposPersonalizados.length>0?(m(),x(W,{key:0,campos:l.camposPersonalizados,valores:e(s).campos_personalizados,errors:e(s).errors,onUpdate:o[9]||(o[9]=a=>e(s).campos_personalizados=a)},null,8,["campos","valores","errors"])):f("",!0)]),t(Y,{modelValue:h.value,"onUpdate:modelValue":o[10]||(o[10]=a=>h.value=a),title:"Seleccionar Responsable del Hito",description:"Selecciona el usuario que será responsable de este hito","search-endpoint":e(q)("admin.proyectos.search-users"),"excluded-ids":e(s).responsable_id?[e(s).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:A},null,8,["modelValue","search-endpoint","excluded-ids"])]),_:1})],64))}});export{Xo as default};
