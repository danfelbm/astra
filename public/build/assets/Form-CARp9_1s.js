import{d as me,k as B,c as C,w as le,p as Oe,a as m,o as d,j as $,i as h,f as a,e as u,b as s,u as e,g as v,t as _,F as E,r as D,q as Xe,n as w,P as Ze,C as Ie,O as et,m as tt,W as at,h as st,T as rt,M as it,bK as ot,af as lt,L as dt}from"./app-B77ccTjn.js";import{_ as Z}from"./createLucideIcon-DDkPG2Rx.js";import{_ as R,a as G,c as Y,b as de}from"./CardTitle.vue_vue_type_script_setup_true_lang-CTQSEJni.js";import{_ as nt}from"./Checkbox.vue_vue_type_script_setup_true_lang-CwgdAwdw.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-CS7-wUGb.js";import{_ as M}from"./Label.vue_vue_type_script_setup_true_lang-D2xSgxzA.js";import{_ as ut}from"./Progress.vue_vue_type_script_setup_true_lang-Dq3MBZBd.js";import{_ as ct,a as ft,b as mt,c as pt,d as _t}from"./SelectValue.vue_vue_type_script_setup_true_lang-CXBvmCjL.js";import{_ as gt}from"./Textarea.vue_vue_type_script_setup_true_lang-BEMBAQOP.js";import{u as bt,a as vt,_ as xt,b as yt,c as ht,d as kt}from"./useConditionalFields-DC1ngdtp.js";import{C as L,_ as ee}from"./index-BIYbvm3e.js";import{_ as ne}from"./CardDescription.vue_vue_type_script_setup_true_lang-B1b37HX6.js";import{_ as $t,a as je}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-BZd_PPo6.js";import{a as ue,_ as ce}from"./index-KX_L0P39.js";import{_ as fe}from"./AlertTitle.vue_vue_type_script_setup_true_lang-CzSIMhn0.js";import{M as I}from"./map-pin-HlX81OCc.js";import{C as O}from"./calendar-DbxCvWy3.js";import{U as Ct}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BS2hC7Dl.js";import{E as wt}from"./external-link-U_yfcfdl.js";import{B as Vt,j as St,_ as Et}from"./AppLayout.vue_vue_type_script_setup_true_lang-BvBOaTU9.js";import{u as At}from"./useAutoSave-CB6k-EHN.js";import{t as V}from"./index-B8g8ZX0h.js";import{A as Ut}from"./arrow-left-N4OjROs_.js";import{C as oe}from"./clock-B86cGhZ0.js";import{C as Me}from"./circle-check-big-BMkXNFGZ.js";import{U as Ft}from"./user-B9ORiujr.js";import{S as qt}from"./save-ClyCbAWX.js";import{_ as Bt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CUP-ao-g.js";import"./check-CNFJRLqV.js";import"./VisuallyHidden-Brv048Yl.js";import"./upload-ZLhZC6nN.js";import"./eye-kpkchdd9.js";import"./download-CriIfSh_.js";import"./plus-D4-iqU9D.js";import"./grip-vertical-85MgVdSl.js";import"./trash-2-OIr5D4rG.js";import"./RovingFocusItem-CzR2phkA.js";import"./utils-ZIsWQDMG.js";import"./VisuallyHiddenInput-Bg8hzY3I.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BYXXTpJk.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-l7ybE-_d.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BBcB5kWO.js";const Pt={class:"space-y-4"},Tt={key:0,class:"text-center py-8"},zt={key:2,class:"space-y-6"},Dt={key:0},Lt={class:"text-sm font-medium text-muted-foreground mb-3"},Nt={class:"space-y-3"},jt={class:"flex items-start gap-3"},Mt={class:"flex-1"},Ot={class:"flex items-center justify-between"},Rt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Gt={class:"flex items-center gap-2 text-muted-foreground"},Yt={class:"flex items-center gap-2 text-muted-foreground"},Wt={class:"flex items-center gap-2 text-muted-foreground"},Ht={key:0,class:"flex items-center gap-2 text-muted-foreground"},Kt={class:"mt-3 text-xs text-muted-foreground"},Jt={key:1},Qt={class:"text-sm font-medium text-muted-foreground mb-3"},Xt={class:"space-y-3"},Zt={class:"flex items-start gap-3"},It={class:"flex-1"},ea={class:"flex items-center justify-between"},ta={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},aa={class:"flex items-center gap-2 text-muted-foreground"},sa={class:"flex items-center gap-2 text-muted-foreground"},ra={class:"flex items-center gap-2 text-muted-foreground"},ia={class:"mt-3 text-xs text-muted-foreground"},oa={key:4,class:"mt-4 p-3 bg-muted/50 rounded-lg"},la={class:"text-sm text-muted-foreground"},da=me({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(N,{emit:n}){var z;const U=N,P=n,k=B([]),T=B(!1),o=B(null),p=B((z=U.modelValue)==null?void 0:z.toString()),W=async()=>{T.value=!0,o.value=null;try{const x=await Xe.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:U.filtrarPorUbicacion,incluir_futuras:!0}});k.value=x.data}catch(x){o.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",x)}finally{T.value=!1}},S=C(()=>{const x={abiertas:[],futuras:[]};return k.value.forEach(y=>{y.estado_temporal==="abierta"?x.abiertas.push(y):y.estado_temporal==="futura"&&x.futuras.push(y)}),x}),H=C(()=>k.value.find(x=>x.id===Number(p.value)));le(p,x=>{P("update:modelValue",x?Number(x):void 0)}),le(()=>U.modelValue,x=>{p.value=x==null?void 0:x.toString()});const K=x=>new Date(x).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=x=>{switch(x){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},J=x=>{switch(x){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Oe(()=>{W()}),(x,y)=>(d(),m("div",Pt,[T.value?(d(),m("div",Tt,y[1]||(y[1]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),a("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):o.value?(d(),$(e(ce),{key:1,variant:"destructive"},{default:u(()=>[s(e(L),{class:"h-4 w-4"}),s(e(fe),null,{default:u(()=>y[2]||(y[2]=[v("Error")])),_:1}),s(e(ue),null,{default:u(()=>[v(_(o.value),1)]),_:1})]),_:1})):k.value.length>0?(d(),m("div",zt,[s(e($t),{modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=g=>p.value=g),disabled:x.disabled},{default:u(()=>[S.value.abiertas.length>0?(d(),m("div",Dt,[a("h4",Lt," Convocatorias Abiertas ("+_(S.value.abiertas.length)+") ",1),a("div",Nt,[(d(!0),m(E,null,D(S.value.abiertas,g=>(d(),$(e(R),{key:g.id,class:w(["cursor-pointer hover:shadow-md transition-all duration-200",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":p.value===g.id.toString(),"hover:bg-muted/50":p.value!==g.id.toString()}]),onClick:te=>p.value=g.id.toString()},{default:u(()=>[s(e(G),{class:"pb-3"},{default:u(()=>[a("div",jt,[s(e(je),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),a("div",Mt,[a("div",Ot,[s(e(M),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:u(()=>[v(_(g.nombre),1)]),_:2},1032,["for"]),s(e(ee),{class:w(F(g.estado_temporal))},{default:u(()=>[v(_(J(g.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(ne),{class:"mt-1"},{default:u(()=>[v(_(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(Y),{class:"pt-0"},{default:u(()=>[a("div",Rt,[a("div",Gt,[s(e(I),{class:"h-4 w-4"}),a("span",null,_(g.cargo.nombre),1)]),a("div",Yt,[s(e(O),{class:"h-4 w-4"}),a("span",null,_(g.periodo_electoral.nombre),1)]),a("div",Wt,[s(e(I),{class:"h-4 w-4"}),a("span",null,_(g.ubicacion),1)]),g.numero_postulaciones!==void 0?(d(),m("div",Ht,[s(e(Ct),{class:"h-4 w-4"}),a("span",null,_(g.numero_postulaciones)+" postulaciones",1)])):h("",!0)]),a("div",Kt,[y[3]||(y[3]=a("span",{class:"font-medium"},"Cierre:",-1)),v(" "+_(K(g.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):h("",!0),S.value.futuras.length>0?(d(),m("div",Jt,[a("h4",Qt," Próximas Convocatorias ("+_(S.value.futuras.length)+") ",1),a("div",Xt,[(d(!0),m(E,null,D(S.value.futuras,g=>(d(),$(e(R),{key:g.id,class:w(["cursor-pointer hover:shadow-md transition-all duration-200 opacity-90",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":p.value===g.id.toString(),"hover:bg-muted/50":p.value!==g.id.toString()}]),onClick:te=>p.value=g.id.toString()},{default:u(()=>[s(e(G),{class:"pb-3"},{default:u(()=>[a("div",Zt,[s(e(je),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),a("div",It,[a("div",ea,[s(e(M),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:u(()=>[v(_(g.nombre),1)]),_:2},1032,["for"]),s(e(ee),{class:w(F(g.estado_temporal))},{default:u(()=>[v(_(J(g.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(ne),{class:"mt-1"},{default:u(()=>[v(_(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(Y),{class:"pt-0"},{default:u(()=>[a("div",ta,[a("div",aa,[s(e(I),{class:"h-4 w-4"}),a("span",null,_(g.cargo.nombre),1)]),a("div",sa,[s(e(O),{class:"h-4 w-4"}),a("span",null,_(g.periodo_electoral.nombre),1)]),a("div",ra,[s(e(I),{class:"h-4 w-4"}),a("span",null,_(g.ubicacion),1)])]),a("div",ia,[y[4]||(y[4]=a("span",{class:"font-medium"},"Apertura:",-1)),v(" "+_(K(g.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):h("",!0)]),_:1},8,["modelValue","disabled"])])):(d(),$(e(ce),{key:3},{default:u(()=>[s(e(L),{class:"h-4 w-4"}),s(e(fe),null,{default:u(()=>y[5]||(y[5]=[v("Sin convocatorias disponibles")])),_:1}),s(e(ue),null,{default:u(()=>y[6]||(y[6]=[v(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),H.value&&!x.disabled?(d(),m("div",oa,[y[7]||(y[7]=a("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),a("p",la,_(H.value.nombre),1)])):h("",!0)]))}}),na={class:"space-y-4"},ua={class:"mt-2"},ca={class:"flex items-start justify-between"},fa={class:"space-y-1"},ma={class:"flex gap-2"},pa={class:"flex items-start gap-2"},_a={class:"text-sm"},ga={class:"font-medium text-gray-900 ml-1"},ba={class:"flex items-start gap-2"},va={class:"text-sm"},xa={class:"font-medium text-gray-900 ml-1"},ya={class:"flex items-start gap-2"},ha={class:"text-sm"},ka={class:"font-medium text-gray-900 ml-1"},$a={key:0,class:"flex items-start gap-2"},Ca={class:"text-sm"},wa={class:"font-medium text-gray-900 ml-1"},Va=me({__name:"ConvocatoriaSeleccionada",props:{postulacion:{}},setup(N){const n=N,U=o=>{switch(o){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},P=o=>{switch(o){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}},k=o=>{switch(o){case"enviada":return"bg-yellow-100 text-yellow-800";case"en_revision":return"bg-blue-100 text-blue-800";case"aceptada":return"bg-green-100 text-green-800";case"rechazada":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},T=o=>{switch(o){case"enviada":return"Enviada";case"en_revision":return"En revisión";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";default:return o}};return(o,p)=>(d(),m("div",na,[s(e(ce),{class:"border-blue-200 bg-blue-50"},{default:u(()=>[s(e(L),{class:"h-4 w-4 text-blue-600"}),s(e(fe),{class:"text-blue-900"},{default:u(()=>p[0]||(p[0]=[v("Convocatoria ya seleccionada")])),_:1}),s(e(ue),{class:"text-blue-800"},{default:u(()=>[p[6]||(p[6]=a("p",null,"Ya has elegido una convocatoria para tu candidatura. La información de tu postulación se muestra a continuación.",-1)),a("p",ua,[p[2]||(p[2]=v(" Si deseas postularte a un cargo distinto, por favor ve al ")),s(e(Ze),{href:o.route("postulaciones.index"),class:"font-semibold underline hover:text-blue-900 inline-flex items-center gap-1"},{default:u(()=>[p[1]||(p[1]=v(" menú de Postulaciones ")),s(e(wt),{class:"h-3 w-3"})]),_:1},8,["href"]),p[3]||(p[3]=v(". Si necesitas ayuda, escríbenos a: ")),p[4]||(p[4]=a("b",null,"soporte@colombiahumana.co",-1)),p[5]||(p[5]=v(". "))])]),_:1})]),_:1}),s(e(R),{class:"border-2 bg-gray-50"},{default:u(()=>[s(e(G),null,{default:u(()=>[a("div",ca,[a("div",fa,[s(e(de),{class:"text-lg"},{default:u(()=>[v(_(n.postulacion.convocatoria.nombre),1)]),_:1}),s(e(ne),{class:"text-sm"},{default:u(()=>p[7]||(p[7]=[v(" Convocatoria seleccionada en tu candidatura ")])),_:1})]),a("div",ma,[s(e(ee),{class:w([U(n.postulacion.convocatoria.estado_temporal),"text-xs"])},{default:u(()=>[v(_(P(n.postulacion.convocatoria.estado_temporal)),1)]),_:1},8,["class"]),s(e(ee),{class:w([k(n.postulacion.estado),"text-xs"])},{default:u(()=>[v(" Postulación "+_(T(n.postulacion.estado)),1)]),_:1},8,["class"])])])]),_:1}),s(e(Y),{class:"space-y-3"},{default:u(()=>[a("div",pa,[s(e(Vt),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",_a,[p[8]||(p[8]=a("span",{class:"text-gray-600"},"Cargo:",-1)),a("span",ga,_(n.postulacion.convocatoria.cargo),1)])]),a("div",ba,[s(e(O),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",va,[p[9]||(p[9]=a("span",{class:"text-gray-600"},"Periodo:",-1)),a("span",xa,_(n.postulacion.convocatoria.periodo),1)])]),a("div",ya,[s(e(O),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",ha,[p[10]||(p[10]=a("span",{class:"text-gray-600"},"Fecha de cierre:",-1)),a("span",ka,_(n.postulacion.convocatoria.fecha_cierre),1)])]),n.postulacion.fecha_postulacion?(d(),m("div",$a,[s(e(O),{class:"h-4 w-4 text-gray-500 mt-0.5"}),a("div",Ca,[p[11]||(p[11]=a("span",{class:"text-gray-600"},"Fecha de tu postulación:",-1)),a("span",wa,_(n.postulacion.fecha_postulacion),1)])])):h("",!0),p[12]||(p[12]=a("div",{class:"border-t pt-3 mt-3"},[a("p",{class:"text-xs text-gray-500"}," Esta convocatoria fue seleccionada cuando creaste tu candidatura. No es posible cambiarla desde este formulario para mantener la integridad de tu postulación y su historial de seguimiento. ")],-1))]),_:1})]),_:1})]))}}),Sa={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 pb-24"},Ea={class:"flex items-center justify-between"},Aa={class:"text-3xl font-bold"},Ua={class:"text-muted-foreground"},Fa={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},qa={key:0,class:"flex items-center gap-1.5"},Ba={key:1,class:"flex items-center gap-1.5"},Pa={key:2,class:"flex items-center gap-1.5 text-amber-600"},Ta={key:3,class:"flex items-center gap-1.5"},za=["innerHTML"],Da={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},La={class:"flex items-start gap-3"},Na={class:"text-sm text-blue-800"},ja={key:0,class:"mt-1 text-blue-600"},Ma={key:0,class:"text-red-500"},Oa={key:0,class:"text-sm text-muted-foreground"},Ra={key:6,class:"space-y-2"},Ga=["id","name","value","onUpdate:modelValue"],Ya={key:7,class:"space-y-2"},Wa={key:8},Ha={key:9},Ka={key:2,class:"text-red-500 text-sm mt-1"},Ja={key:10},Qa={key:11},Xa={key:12},Za={key:13,class:"text-sm text-destructive"},Ia={key:1,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},es={class:"text-red-800 text-sm"},ts={key:0,class:"fixed bottom-0 left-0 right-0 z-50 px-2 sm:px-4 pb-2 sm:pb-4"},as={class:"mx-auto max-w-7xl"},ss={class:"backdrop-blur-lg bg-tertiary-60 dark:bg-gray-900/80 border border-gray-200/50 dark:border-gray-700/50 rounded-xl sm:rounded-2xl shadow-2xl p-3 sm:p-4"},rs={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},is={class:"hidden sm:flex items-center"},os={class:"flex-1 sm:max-w-xs lg:max-w-sm mx-0 sm:mx-4"},ls={class:"flex items-center gap-3"},ds={class:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap font-medium"},ns={class:"flex items-center gap-2 sm:gap-3"},us={class:"ml-2 whitespace-nowrap"},cs=me({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean},postulacion_existente:{}},setup(N){var ge,be;const n=N,U=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:n.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:P}=bt(),k=B({});C(()=>{var b;if(!n.is_editing||!((b=n.candidatura)!=null&&b.formulario_data))return!1;const r=Object.keys(n.candidatura.formulario_data),l=n.configuracion_campos.map(t=>t.id),i=r.some(t=>!l.includes(t)),c=n.configuracion_campos.some(t=>t.required&&!n.candidatura.formulario_data[t.id]);return i||c});const o=Ie((()=>{var l;const r={};return n.configuracion_campos.forEach(i=>{i.type==="checkbox"?r[i.id]=[]:i.type==="file"?r[i.id]=[]:i.type==="convocatoria"?r[i.id]=void 0:i.type==="disclaimer"?r[i.id]=null:i.type==="repeater"?r[i.id]=[]:i.type==="datepicker"?r[i.id]=null:r[i.id]=""}),(l=n.candidatura)!=null&&l.formulario_data&&(Object.assign(r,n.candidatura.formulario_data),n.configuracion_campos.forEach(i=>{i.type==="file"&&r[i.id]&&(Array.isArray(r[i.id])||(r[i.id]=[r[i.id]]))})),{formulario_data:r}})()),p=B(n.configuracion_campos),W=C(()=>o.formulario_data),{visibleFields:S,clearHiddenFieldValues:H}=vt(p,W);le(S,()=>{H()});const{state:K,isSaving:F,hasSaved:J,hasError:z,saveNow:x,startWatching:y,stopAutoSave:g,restoreDraft:te,clearLocalStorage:ae}=At(W,{url:"/candidaturas/autosave",resourceId:((ge=n.candidatura)==null?void 0:ge.id)||null,resourceIdField:"candidatura_id",debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((be=n.candidatura)==null?void 0:be.id)||"new"}`});let j=null;Oe(()=>{const r=["borrador","rechazado"];if(!n.candidatura||r.includes(n.candidatura.estado)){if(!n.is_editing){const i=te();i&&i.formulario_data&&(V.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{ae(),o.reset(),V.success("Borrador descartado")}},duration:5e3}),Object.assign(o.formulario_data,i.formulario_data))}j=y()}}),et(()=>{j&&j(),g()});const Re=async()=>{if(F.value){V.warning("Ya se está guardando...");return}await x(),z.value||V.success("Borrador guardado manualmente")},Ge=C(()=>Q.value.map(i=>{var t;if(!i.required)return{campo:i.id,valid:!0};const c=o.formulario_data[i.id];let b=!1;if(i.type==="checkbox")b=Array.isArray(c)&&c.length>0;else if(i.type==="file")(Array.isArray(c)&&c.length>0||k.value[i.id]&&k.value[i.id].length>0)&&(b=!0);else if(i.type==="convocatoria")b=c!=null&&c!=="";else if(i.type==="disclaimer")b=c&&c.accepted===!0;else if(i.type==="repeater"){const X=((t=i.repeaterConfig)==null?void 0:t.minItems)||0;b=Array.isArray(c)&&c.length>=X}else i.type==="datepicker"?b=c!=null&&c!=="":b=c&&c.toString().trim()!=="";return!b&&i.required,{campo:i.id,valid:b}}).every(i=>i.valid)),se=C(()=>{const r=Q.value.length;let l=0;return Q.value.forEach(i=>{const c=o.formulario_data[i.id];let b=!1;i.type==="checkbox"?b=Array.isArray(c)&&c.length>0:i.type==="file"?b=Array.isArray(c)&&c.length>0||k.value[i.id]&&k.value[i.id].length>0:i.type==="convocatoria"?b=c!=null&&c!=="":i.type==="disclaimer"?b=c&&c.accepted===!0:i.type==="repeater"?b=Array.isArray(c)&&c.length>0:i.type==="datepicker"?b=c!=null&&c!=="":b=c&&c.toString().trim()!=="",b&&l++}),{llenos:l,total:r,porcentaje:r>0?Math.round(l/r*100):0}}),pe=C(()=>n.is_editing?"Editar Candidatura":"Crear Candidatura"),Ye=C(()=>{var r,l;return o.processing?"Guardando...":n.is_editing?((r=n.candidatura)==null?void 0:r.estado)==="rechazado"?"Reenviar Candidatura":((l=n.candidatura)==null?void 0:l.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),We=C(()=>{var r,l;return!n.is_editing||n.postulacion_existente&&["borrador","rechazado"].includes(((r=n.candidatura)==null?void 0:r.estado)||"")?!1:!!["pendiente","aprobado"].includes(((l=n.candidatura)==null?void 0:l.estado)||"")}),Q=C(()=>{var l;let r=[...S.value];return We.value&&(r=r.filter(i=>i.type!=="convocatoria")),n.is_editing&&((l=n.candidatura)==null?void 0:l.estado)==="aprobado"&&(r=r.filter(i=>i.editable===!0)),r}),He=C(()=>{var i;if(!n.is_editing||!n.candidatura)return!1;let r=!1;if(["pendiente","aprobado"].includes(n.candidatura.estado)&&(r=n.configuracion_campos.some(c=>c.type==="convocatoria")),((i=n.candidatura)==null?void 0:i.estado)==="aprobado"){const c=n.configuracion_campos.some(b=>!b.editable&&b.type!=="convocatoria");return r||c}return r}),A=B({}),Ke=async(r,l)=>{if(k.value[r]=l,l&&l.length>0)try{const c=(await P(l,{module:"candidaturas",fieldId:r,onProgress:(b,t)=>{A.value[r]&&A.value[r].uploadProgress.set(b,t)}})).map(b=>b.path);Array.isArray(o.formulario_data[r]),o.formulario_data[r]=c,k.value[r]=[],setTimeout(()=>{A.value[r]&&A.value[r].uploadProgress.clear()},1500),V.success("✅ Archivos subidos correctamente",{duration:2e3})}catch(i){console.error("Error al subir archivos:",i),A.value[r]&&(l.forEach(c=>{A.value[r].uploadErrors.set(c.name,"Error al subir el archivo")}),A.value[r].uploadProgress.clear()),V.error("❌ Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else o.formulario_data[r]=[]},_e=async()=>{for(const[l,i]of Object.entries(k.value))if(i&&i.length>0)try{V.info("Subiendo archivos pendientes...",{duration:2e3});const c=await P(i,{module:"candidaturas",fieldId:l});o.formulario_data[l]=c.map(b=>b.path),k.value[l]=[]}catch(c){console.error("Error al subir archivos:",c),V.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const r={...o.formulario_data};n.configuracion_campos.forEach(l=>{const i=r[l.id];l.required||(i===""||i===void 0||Array.isArray(i)&&i.length===0&&l.type!=="checkbox"&&l.type!=="file")&&(r[l.id]=null)}),o.formulario_data=r,g(),n.is_editing?o.put(`/candidaturas/${n.candidatura.id}`,{onSuccess:()=>{ae(),V.success("Candidatura actualizada exitosamente")},onError:l=>{console.error("Errores de validación:",l),(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&(j=y())}}):o.post("/candidaturas",{onSuccess:()=>{ae(),V.success("Candidatura creada exitosamente")},onError:l=>{console.error("Errores de validación:",l),j=y()}})},q=r=>!!o.errors[`formulario_data.${r}`],Je=C(()=>!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)),Qe=()=>{const r=document.querySelector('[data-sidebar="trigger"]');r&&r.click()};return(r,l)=>(d(),m(E,null,[s(e(tt),{title:pe.value},null,8,["title"]),s(Et,{breadcrumbs:U},{default:u(()=>{var i,c;return[a("div",Sa,[a("div",Ea,[a("div",null,[a("h1",Aa,_(pe.value),1),a("p",Ua,_(r.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),s(e(Z),{variant:"outline",onClick:l[0]||(l[0]=b=>e(at).visit("/candidaturas"))},{default:u(()=>[s(e(Ut),{class:"mr-2 h-4 w-4"}),l[1]||(l[1]=v(" Volver "))]),_:1})]),!r.candidatura||["borrador","rechazado"].includes(r.candidatura.estado)?(d(),m("div",Fa,[e(F)?(d(),m("div",qa,[s(e(oe),{class:"h-4 w-4 animate-spin"}),l[2]||(l[2]=a("span",null,"Guardando automáticamente...",-1))])):e(J)&&!e(z)?(d(),m("div",Ba,[s(e(Me),{class:"h-4 w-4 text-green-600"}),a("span",null,"Guardado automáticamente a las "+_((i=e(K).lastSaved)==null?void 0:i.toLocaleTimeString()),1)])):e(z)?(d(),m("div",Pa,[s(e(L),{class:"h-4 w-4"}),l[3]||(l[3]=a("span",null,"Guardado localmente (sin conexión)",-1))])):(d(),m("div",Ta,[s(e(oe),{class:"h-4 w-4"}),l[4]||(l[4]=a("span",null,"Autoguardado activado",-1))]))])):h("",!0),r.is_editing&&((c=r.candidatura)!=null&&c.comentarios_admin)?(d(),$(e(R),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:u(()=>[s(e(G),null,{default:u(()=>[s(e(de),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:u(()=>[s(e(L),{class:"h-5 w-5"}),l[5]||(l[5]=v(" Comentarios de la comisión "))]),_:1})]),_:1}),s(e(Y),null,{default:u(()=>[a("div",{class:"text-blue-700 dark:text-blue-300 prose prose-sm max-w-none",innerHTML:r.candidatura.comentarios_admin},null,8,za)]),_:1})]),_:1})):h("",!0),s(e(R),null,{default:u(()=>[s(e(G),null,{default:u(()=>[s(e(de),{class:"flex items-center gap-2"},{default:u(()=>[s(e(Ft),{class:"h-5 w-5"}),l[6]||(l[6]=v(" Información de Candidatura "))]),_:1})]),_:1}),s(e(Y),null,{default:u(()=>{var b;return[a("form",{onSubmit:st(_e,["prevent"]),class:"space-y-6"},[r.is_editing&&((b=r.candidatura)==null?void 0:b.estado)==="aprobado"?(d(),m("div",Da,[a("div",La,[s(e(L),{class:"h-5 w-5 text-blue-600 mt-0.5"}),a("div",Na,[l[7]||(l[7]=a("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),l[8]||(l[8]=a("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),He.value?(d(),m("p",ja," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):h("",!0)])])])):h("",!0),s(rt,{name:"fade-field",tag:"div",class:"space-y-6"},{default:u(()=>[(d(!0),m(E,null,D(Q.value,t=>{var X,ve,xe,ye,he,ke,$e,Ce,we,Ve,Se,Ee,Ae,Ue,Fe,qe,Be,Pe,Te,ze,De,Le;return d(),m("div",{key:t.id,class:"space-y-2"},[s(e(M),{for:t.id,class:"flex items-center gap-1"},{default:u(()=>[v(_(t.title)+" ",1),t.required?(d(),m("span",Ma,"*")):h("",!0)]),_:2},1032,["for"]),t.description?(d(),m("p",Oa,_(t.description),1)):h("",!0),t.type==="text"||t.type==="email"?(d(),$(e(ie),{key:1,id:t.id,type:t.type,modelValue:e(o).formulario_data[t.id],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:w({"border-destructive":q(t.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="textarea"?(d(),$(e(gt),{key:2,id:t.id,modelValue:e(o).formulario_data[t.id],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,placeholder:t.placeholder||"",rows:4,class:w({"border-destructive":q(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="number"?(d(),$(e(ie),{key:3,id:t.id,type:"number",modelValue:e(o).formulario_data[t.id],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,placeholder:t.placeholder||"",class:w({"border-destructive":q(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):t.type==="date"?(d(),$(e(ie),{key:4,id:t.id,type:"date",modelValue:e(o).formulario_data[t.id],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,class:w({"border-destructive":q(t.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):t.type==="select"?(d(),$(e(ct),{key:5,modelValue:e(o).formulario_data[t.id],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f},{default:u(()=>[s(e(ft),{class:w({"border-destructive":q(t.id)})},{default:u(()=>[s(e(mt),{placeholder:t.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),s(e(pt),null,{default:u(()=>[(d(!0),m(E,null,D(t.options,f=>(d(),$(e(_t),{key:f,value:f},{default:u(()=>[v(_(f),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.type==="radio"?(d(),m("div",Ra,[(d(!0),m(E,null,D(t.options,f=>(d(),m("div",{key:f,class:"flex items-center space-x-2"},[it(a("input",{id:`${t.id}_${f}`,name:t.id,type:"radio",value:f,"onUpdate:modelValue":re=>e(o).formulario_data[t.id]=re,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Ga),[[ot,e(o).formulario_data[t.id]]]),s(e(M),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:u(()=>[v(_(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="checkbox"?(d(),m("div",Ya,[(d(!0),m(E,null,D(t.options,f=>(d(),m("div",{key:f,class:"flex items-center space-x-2"},[s(e(nt),{id:`${t.id}_${f}`,checked:e(o).formulario_data[t.id].includes(f),"onUpdate:checked":re=>{if(re)e(o).formulario_data[t.id].includes(f)||e(o).formulario_data[t.id].push(f);else{const Ne=e(o).formulario_data[t.id].indexOf(f);Ne>-1&&e(o).formulario_data[t.id].splice(Ne,1)}}},null,8,["id","checked","onUpdate:checked"]),s(e(M),{for:`${t.id}_${f}`,class:"text-sm font-normal"},{default:u(()=>[v(_(f),1)]),_:2},1032,["for"])]))),128))])):t.type==="file"?(d(),m("div",Wa,[s(xt,{ref_for:!0,ref:f=>A.value[t.id]=f,modelValue:e(o).formulario_data[t.id],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,onFilesSelected:f=>Ke(t.id,f),label:"",description:"",required:t.required,multiple:((X=t.fileConfig)==null?void 0:X.multiple)||!1,"max-files":((ve=t.fileConfig)==null?void 0:ve.maxFiles)||5,"max-file-size":((xe=t.fileConfig)==null?void 0:xe.maxFileSize)||10,accept:((ye=t.fileConfig)==null?void 0:ye.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(o).errors[`formulario_data.${t.id}`],disabled:e(o).processing,module:"candidaturas","field-id":t.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):t.type==="convocatoria"?(d(),m("div",Ha,[r.postulacion_existente&&["borrador","rechazado"].includes(((he=r.candidatura)==null?void 0:he.estado)||"")?(d(),$(Va,{key:0,postulacion:r.postulacion_existente},null,8,["postulacion"])):(d(),$(da,{key:1,modelValue:e(o).formulario_data[t.id],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,required:t.required,disabled:e(o).processing||r.is_editing&&((ke=r.candidatura)==null?void 0:ke.estado)!=="borrador","filtrar-por-ubicacion":(($e=t.convocatoriaConfig)==null?void 0:$e.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"])),q(t.id)&&!r.postulacion_existente?(d(),m("div",Ka,_(e(o).errors[`formulario_data.${t.id}`]),1)):h("",!0)])):t.type==="datepicker"?(d(),m("div",Ja,[s(yt,{"model-value":e(o).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(o).processing,error:e(o).errors[`formulario_data.${t.id}`],"min-date":(Ce=t.datepickerConfig)==null?void 0:Ce.minDate,"max-date":(we=t.datepickerConfig)==null?void 0:we.maxDate,format:((Ve=t.datepickerConfig)==null?void 0:Ve.format)||"DD/MM/YYYY","allow-past-dates":((Se=t.datepickerConfig)==null?void 0:Se.allowPastDates)??!0,"allow-future-dates":((Ee=t.datepickerConfig)==null?void 0:Ee.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):t.type==="disclaimer"?(d(),m("div",Qa,[s(ht,{"model-value":e(o).formulario_data[t.id]||null,"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(o).processing,error:e(o).errors[`formulario_data.${t.id}`],"disclaimer-text":((Ae=t.disclaimerConfig)==null?void 0:Ae.disclaimerText)||"","modal-title":((Ue=t.disclaimerConfig)==null?void 0:Ue.modalTitle)||"Términos y Condiciones","accept-button-text":((Fe=t.disclaimerConfig)==null?void 0:Fe.acceptButtonText)||"Acepto","decline-button-text":((qe=t.disclaimerConfig)==null?void 0:qe.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):t.type==="repeater"?(d(),m("div",Xa,[s(kt,{"model-value":e(o).formulario_data[t.id]||[],"onUpdate:modelValue":f=>e(o).formulario_data[t.id]=f,label:"",description:"",required:t.required,disabled:e(o).processing,error:e(o).errors[`formulario_data.${t.id}`],"min-items":((Be=t.repeaterConfig)==null?void 0:Be.minItems)||0,"max-items":((Pe=t.repeaterConfig)==null?void 0:Pe.maxItems)||10,"item-name":((Te=t.repeaterConfig)==null?void 0:Te.itemName)||"Elemento","add-button-text":((ze=t.repeaterConfig)==null?void 0:ze.addButtonText)||"Agregar elemento","remove-button-text":((De=t.repeaterConfig)==null?void 0:De.removeButtonText)||"Eliminar",fields:((Le=t.repeaterConfig)==null?void 0:Le.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):h("",!0),q(t.id)?(d(),m("p",Za,_(e(o).errors[`formulario_data.${t.id}`]),1)):h("",!0)])}),128))]),_:1}),e(o).errors.general?(d(),m("div",Ia,[a("p",es,_(e(o).errors.general),1)])):h("",!0),l[9]||(l[9]=a("div",{class:"h-4"},null,-1))],32)]}),_:1})]),_:1})]),(d(),$(lt,{to:"body"},[s(dt,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-4 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-4 opacity-0"},{default:u(()=>[(d(),m("div",ts,[a("div",as,[a("div",ss,[a("div",rs,[a("div",is,[s(e(Z),{variant:"outline",type:"button",onClick:Qe,class:"backdrop-blur-sm flex-shrink-0 text-xs sm:text-sm py-2 px-3"},{default:u(()=>[s(e(St),{class:"h-4 w-4"}),l[10]||(l[10]=a("span",{class:"ml-2"},"Ocultar sidebar",-1))]),_:1})]),a("div",os,[a("div",ls,[s(e(ut),{modelValue:se.value.porcentaje,class:"flex-1"},null,8,["modelValue"]),a("span",ds,_(se.value.llenos)+" / "+_(se.value.total),1)]),l[11]||(l[11]=a("p",{class:"text-xs text-muted-foreground mt-1 text-center hidden sm:block"}," Campos completados ",-1))]),a("div",ns,[Je.value?(d(),$(e(Z),{key:0,onClick:Re,disabled:e(F),variant:"outline",class:"backdrop-blur-sm flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:u(()=>[e(F)?(d(),m(E,{key:0},[s(e(oe),{class:"mr-2 h-4 w-4 animate-spin"}),l[12]||(l[12]=v(" Guardando... "))],64)):(d(),m(E,{key:1},[s(e(qt),{class:"mr-2 h-4 w-4"}),l[13]||(l[13]=v(" Guardar borrador "))],64))]),_:1},8,["disabled"])):h("",!0),s(e(Z),{onClick:_e,disabled:!Ge.value||e(o).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400 flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:u(()=>[s(e(Me),{class:"h-4 w-4"}),a("span",us,_(Ye.value),1)]),_:1},8,["disabled"])])])])])]))]),_:1})]))]}),_:1})],64))}}),tr=Bt(cs,[["__scopeId","data-v-2d2d29df"]]);export{tr as default};
