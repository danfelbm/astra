import{d as ee,r as S,u as se,c as G,i as c,b,j as f,e as o,w as l,f as e,h as n,t as u,g as m,F as $,k as w,l as ae,m as r}from"./app-22iUgOMO.js";import{a as A,b as L,c as X,_ as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-DfXdCOp6.js";import{_ as K}from"./CardDescription.vue_vue_type_script_setup_true_lang-cEQoqlpa.js";import{_ as x}from"./createLucideIcon-DYCv6hRJ.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-BOumzjFB.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-DAYcABOY.js";import{_ as oe}from"./Textarea.vue_vue_type_script_setup_true_lang-CwgF4FNQ.js";import{_ as z,a as U,b as C,c as P,d as g}from"./SelectValue.vue_vue_type_script_setup_true_lang-BUbIyXRi.js";import{_ as te}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-CVPtlI-G.js";import{E as le}from"./EtiquetaSelector--KsuINqc.js";import{_ as ie}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-DYhcNQMI.js";import{a as re}from"./target-nNhv35Ae.js";import{X as de}from"./x-D2_7tWf5.js";import{U as ne}from"./user-plus-DKxsgjge.js";import{S as ue}from"./save-jAg8eKB7.js";const me={class:"space-y-6"},ce={class:"space-y-2"},fe={key:0,class:"text-sm text-red-500"},pe={class:"space-y-2"},be={key:0,class:"text-sm text-red-500"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={class:"space-y-2"},ye={key:0,class:"text-sm text-red-500"},he={class:"space-y-2"},ge={key:0,class:"text-sm text-red-500"},xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve={class:"space-y-2"},ke={key:0,class:"text-sm text-red-500"},Se={class:"space-y-2"},$e={class:"space-y-2"},we={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},ze={class:"font-medium"},Ue={class:"text-sm text-muted-foreground"},Ce={key:0,class:"text-sm text-red-500"},Pe={key:0,class:"space-y-2"},qe={key:0,class:"text-sm text-red-500"},Ee={key:1,class:"space-y-2"},Be={key:0,class:"text-sm text-red-500"},De={class:"flex justify-end gap-2 pt-4"},We=ee({__name:"HitoForm",props:{mode:{},hito:{},proyectoId:{},proyectoNombre:{},responsables:{default:()=>[]},hitosDisponibles:{default:()=>[]},camposPersonalizados:{default:()=>[]},valoresCamposPersonalizados:{default:()=>({})},categorias:{default:()=>[]},estados:{},siguienteOrden:{default:1},searchUsersEndpoint:{},showCamposPersonalizados:{type:Boolean,default:!0},showEtiquetas:{type:Boolean,default:!0},showParentSelector:{type:Boolean,default:!0},externalProcessing:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(i,{emit:Q}){var E,B,D,I,N,R,F,H,j,M,T;const d=i,q=Q,k=S(!1),p=S(null),h=S(new Map);d.responsables.forEach(_=>h.value.set(_.id,_)),d.mode==="edit"&&((E=d.hito)!=null&&E.responsable)&&(p.value=d.hito.responsable,h.value.set(d.hito.responsable.id,d.hito.responsable));const a=se({nombre:((B=d.hito)==null?void 0:B.nombre)||"",descripcion:((D=d.hito)==null?void 0:D.descripcion)||"",fecha_inicio:((I=d.hito)==null?void 0:I.fecha_inicio)||"",fecha_fin:((N=d.hito)==null?void 0:N.fecha_fin)||"",estado:((R=d.hito)==null?void 0:R.estado)||"pendiente",responsable_id:((F=d.hito)==null?void 0:F.responsable_id)||null,parent_id:((H=d.hito)==null?void 0:H.parent_id)||null,campos_personalizados:d.valoresCamposPersonalizados||{},etiquetas:((M=(j=d.hito)==null?void 0:j.etiquetas)==null?void 0:M.map(_=>_.id))??[],orden:((T=d.hito)==null?void 0:T.orden)||d.siguienteOrden,crear_entregables_predefinidos:!1}),W=_=>{if(_.userIds.length>0){const s=_.userIds[0];a.responsable_id=s,h.value.has(s)?p.value=h.value.get(s)||null:(p.value={id:s,name:`Usuario seleccionado (ID: ${s})`,email:"Se actualizará al guardar"},h.value.set(s,p.value))}},Y=()=>{a.responsable_id=null,p.value=null},Z=()=>{q("submit",a)},y=G(()=>a.processing||d.externalProcessing),O=G(()=>y.value?d.mode==="create"?"Creando...":"Guardando...":d.mode==="create"?"Crear Hito":"Guardar Cambios");return(_,s)=>(r(),c("div",me,[i.showEtiquetas&&i.categorias&&i.categorias.length>0?(r(),b(e(J),{key:0},{default:l(()=>[o(e(A),null,{default:l(()=>[o(e(L),{class:"flex items-center gap-2"},{default:l(()=>[o(e(re),{class:"h-5 w-5"}),s[13]||(s[13]=n(" Categorías ",-1))]),_:1}),o(e(K),null,{default:l(()=>[...s[14]||(s[14]=[n(" Asigna etiquetas para categorizar y organizar este hito ",-1)])]),_:1})]),_:1}),o(e(X),null,{default:l(()=>[o(le,{modelValue:e(a).etiquetas,"onUpdate:modelValue":s[0]||(s[0]=t=>e(a).etiquetas=t),categorias:i.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas para el hito...",description:"Puedes asignar hasta 10 etiquetas"},null,8,["modelValue","categorias"])]),_:1})]),_:1})):f("",!0),o(e(J),null,{default:l(()=>[o(e(A),null,{default:l(()=>[o(e(L),null,{default:l(()=>[n(u(i.mode==="create"?"Información del Hito":"Editar Hito"),1)]),_:1}),i.proyectoNombre?(r(),b(e(K),{key:0},{default:l(()=>[n(u(i.mode==="create"?"Define los detalles del nuevo hito para el proyecto":`Editando hito del proyecto: ${i.proyectoNombre}`),1)]),_:1})):f("",!0)]),_:1}),o(e(X),null,{default:l(()=>[m("form",{onSubmit:ae(Z,["prevent"]),class:"space-y-6"},[m("div",ce,[o(e(v),{for:"nombre",required:""},{default:l(()=>[...s[15]||(s[15]=[n("Nombre del Hito",-1)])]),_:1}),o(e(V),{id:"nombre",modelValue:e(a).nombre,"onUpdate:modelValue":s[1]||(s[1]=t=>e(a).nombre=t),type:"text",placeholder:"Ej: Pre-producción",disabled:y.value},null,8,["modelValue","disabled"]),e(a).errors.nombre?(r(),c("span",fe,u(e(a).errors.nombre),1)):f("",!0)]),m("div",pe,[o(e(v),{for:"descripcion"},{default:l(()=>[...s[16]||(s[16]=[n("Descripción",-1)])]),_:1}),o(e(oe),{id:"descripcion",modelValue:e(a).descripcion,"onUpdate:modelValue":s[2]||(s[2]=t=>e(a).descripcion=t),placeholder:"Describe el objetivo y alcance del hito...",disabled:y.value,rows:"3"},null,8,["modelValue","disabled"]),e(a).errors.descripcion?(r(),c("span",be,u(e(a).errors.descripcion),1)):f("",!0)]),m("div",_e,[m("div",ve,[o(e(v),{for:"fecha_inicio"},{default:l(()=>[...s[17]||(s[17]=[n("Fecha de Inicio",-1)])]),_:1}),o(e(V),{id:"fecha_inicio",modelValue:e(a).fecha_inicio,"onUpdate:modelValue":s[3]||(s[3]=t=>e(a).fecha_inicio=t),type:"date",disabled:y.value},null,8,["modelValue","disabled"]),e(a).errors.fecha_inicio?(r(),c("span",ye,u(e(a).errors.fecha_inicio),1)):f("",!0)]),m("div",he,[o(e(v),{for:"fecha_fin"},{default:l(()=>[...s[18]||(s[18]=[n("Fecha de Fin",-1)])]),_:1}),o(e(V),{id:"fecha_fin",modelValue:e(a).fecha_fin,"onUpdate:modelValue":s[4]||(s[4]=t=>e(a).fecha_fin=t),type:"date",disabled:y.value},null,8,["modelValue","disabled"]),e(a).errors.fecha_fin?(r(),c("span",ge,u(e(a).errors.fecha_fin),1)):f("",!0)])]),m("div",xe,[m("div",Ve,[o(e(v),{for:"estado"},{default:l(()=>[n(u(i.mode==="create"?"Estado Inicial":"Estado"),1)]),_:1}),o(e(z),{modelValue:e(a).estado,"onUpdate:modelValue":s[5]||(s[5]=t=>e(a).estado=t)},{default:l(()=>[o(e(U),null,{default:l(()=>[o(e(C),{placeholder:"Seleccionar estado"})]),_:1}),o(e(P),null,{default:l(()=>[(r(!0),c($,null,w(i.estados,t=>(r(),b(e(g),{key:t.value,value:t.value},{default:l(()=>[n(u(t.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(a).errors.estado?(r(),c("span",ke,u(e(a).errors.estado),1)):f("",!0)]),m("div",Se,[o(e(v),{for:"responsable_id"},{default:l(()=>[...s[19]||(s[19]=[n("Responsable",-1)])]),_:1}),m("div",$e,[p.value?(r(),c("div",we,[m("div",null,[m("p",ze,u(p.value.name),1),m("p",Ue,u(p.value.email),1)]),o(e(x),{type:"button",variant:"ghost",size:"sm",onClick:Y},{default:l(()=>[o(e(de),{class:"h-4 w-4"})]),_:1})])):f("",!0),i.searchUsersEndpoint?(r(),b(e(x),{key:1,type:"button",variant:"outline",onClick:s[6]||(s[6]=t=>k.value=!0),class:"w-full"},{default:l(()=>[o(e(ne),{class:"h-4 w-4 mr-2"}),n(" "+u(p.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})):(r(),b(e(z),{key:2,modelValue:e(a).responsable_id,"onUpdate:modelValue":s[7]||(s[7]=t=>e(a).responsable_id=t)},{default:l(()=>[o(e(U),null,{default:l(()=>[o(e(C),{placeholder:"Seleccionar responsable"})]),_:1}),o(e(P),null,{default:l(()=>[o(e(g),{value:null},{default:l(()=>[...s[20]||(s[20]=[n("Sin responsable",-1)])]),_:1}),(r(!0),c($,null,w(i.responsables,t=>(r(),b(e(g),{key:t.id,value:t.id},{default:l(()=>[n(u(t.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]))]),e(a).errors.responsable_id?(r(),c("span",Ce,u(e(a).errors.responsable_id),1)):f("",!0)])]),i.showParentSelector&&i.hitosDisponibles&&i.hitosDisponibles.length>0?(r(),c("div",Pe,[o(e(v),{for:"parent_id"},{default:l(()=>[...s[21]||(s[21]=[n("Hito Padre (opcional)",-1)])]),_:1}),o(e(z),{modelValue:e(a).parent_id,"onUpdate:modelValue":s[8]||(s[8]=t=>e(a).parent_id=t)},{default:l(()=>[o(e(U),null,{default:l(()=>[o(e(C),{placeholder:"Sin padre (raíz)"})]),_:1}),o(e(P),null,{default:l(()=>[o(e(g),{value:null},{default:l(()=>[...s[22]||(s[22]=[n("Sin padre (raíz)",-1)])]),_:1}),(r(!0),c($,null,w(i.hitosDisponibles,t=>(r(),b(e(g),{key:t.id,value:t.id,disabled:i.hito&&t.id===i.hito.id},{default:l(()=>[n(u("—".repeat(t.nivel))+" "+u(t.nombre),1)]),_:2},1032,["value","disabled"]))),128))]),_:1})]),_:1},8,["modelValue"]),s[23]||(s[23]=m("p",{class:"text-sm text-muted-foreground"},"Selecciona un hito padre para crear una jerarquía",-1)),e(a).errors.parent_id?(r(),c("span",qe,u(e(a).errors.parent_id),1)):f("",!0)])):f("",!0),i.mode==="edit"?(r(),c("div",Ee,[o(e(v),{for:"orden"},{default:l(()=>[...s[24]||(s[24]=[n("Orden de visualización",-1)])]),_:1}),o(e(V),{id:"orden",modelValue:e(a).orden,"onUpdate:modelValue":s[9]||(s[9]=t=>e(a).orden=t),modelModifiers:{number:!0},type:"number",min:"0",disabled:y.value},null,8,["modelValue","disabled"]),e(a).errors.orden?(r(),c("span",Be,u(e(a).errors.orden),1)):f("",!0),s[25]||(s[25]=m("p",{class:"text-sm text-muted-foreground"}," Define el orden en que aparece este hito en la lista ",-1))])):f("",!0),m("div",De,[o(e(x),{type:"button",variant:"outline",onClick:s[10]||(s[10]=t=>q("cancel"))},{default:l(()=>[...s[26]||(s[26]=[n(" Cancelar ",-1)])]),_:1}),o(e(x),{type:"submit",disabled:y.value},{default:l(()=>[o(e(ue),{class:"h-4 w-4 mr-2"}),n(" "+u(O.value),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),i.showCamposPersonalizados&&i.camposPersonalizados&&i.camposPersonalizados.length>0?(r(),b(te,{key:1,campos:i.camposPersonalizados,valores:e(a).campos_personalizados,errors:e(a).errors,onUpdate:s[11]||(s[11]=t=>e(a).campos_personalizados=t)},null,8,["campos","valores","errors"])):f("",!0),i.searchUsersEndpoint?(r(),b(ie,{key:2,modelValue:k.value,"onUpdate:modelValue":s[12]||(s[12]=t=>k.value=t),title:"Seleccionar Responsable del Hito",description:"Selecciona el usuario que será responsable de este hito","search-endpoint":i.searchUsersEndpoint,"excluded-ids":e(a).responsable_id?[e(a).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:W},null,8,["modelValue","search-endpoint","excluded-ids"])):f("",!0)]))}});export{We as _};
