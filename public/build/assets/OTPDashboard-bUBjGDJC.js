import{_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CcmHndpR.js";import{d as L,r as h,c as g,o as H,O as X,b as f,e as r,w as l,f as a,g as s,u as e,p as G,t as i,h as n,n as K,i as b,j as R,a as q}from"./app-YX-Bh59c.js";import{_ as c,a as p,b as v,c as m}from"./CardTitle.vue_vue_type_script_setup_true_lang-CEXipE4i.js";import{_ as z}from"./index-CZ_tuZ2G.js";import{_ as T}from"./createLucideIcon-6ox98eKE.js";import{_ as N}from"./Progress.vue_vue_type_script_setup_true_lang-BhtQcHUA.js";import{_ as Y,a as Z}from"./index-FDFIrEGY.js";import{_ as tt}from"./AlertTitle.vue_vue_type_script_setup_true_lang-C-vqnDcE.js";import{R as B}from"./refresh-cw-DYc3sNpe.js";import{C as et}from"./circle-check-big-Du-N0KpN.js";import{C as F}from"./clock-CfWAYEpP.js";import{T as st}from"./triangle-alert-CzGxDXPZ.js";import{U as Q}from"./users-CywUQkRS.js";import{T as at}from"./trending-up-4mcJ8VXC.js";import{C as lt}from"./circle-x-CG5UINOr.js";import{M as P}from"./mail-DUxRgChd.js";import{M as A}from"./message-square-CKkMsgP4.js";import{T as ot}from"./timer-D7vvPl0J.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-DFervepj.js";import"./index-Cdcl3n2q.js";import"./floating-ui.vue-XE53EvAr.js";import"./x-BHjdi3Sq.js";import"./Input.vue_vue_type_script_setup_true_lang-DtRE74-R.js";import"./index-CFLnPJ45.js";import"./index-D8aNryzX.js";import"./shield-D2GVlvyT.js";import"./user-Ctft_uC-.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Di0cXjcY.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Cucg6Ulk.js";import"./VisuallyHidden-DDRJ2xSr.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-SBKDcQNL.js";import"./check-4Q7VrOCL.js";import"./nullish-CHIgUVhi.js";import"./Label.vue_vue_type_script_setup_true_lang-dMdLaxwj.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Dk8qWq0j.js";import"./index-BTUR61ux.js";import"./circle-alert-Dcf5wzqR.js";import"./map-pin-DT8oOEor.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DUe9aiHp.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-B6YI2WZd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-Brk2-V4l.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Bf0OBuaA.js";import"./vote-BEfr2Lma.js";import"./file-text-BUyGZgIO.js";import"./calendar-DczSVdki.js";import"./briefcase-nqrHLeSj.js";import"./megaphone-DZD63zes.js";import"./user-check-BmHIsIkd.js";import"./external-link-BF5dY6Ld.js";import"./panel-left-C-sZzVb5.js";import"./index-BKfwd4cF.js";const it={class:"space-y-6"},nt={class:"flex items-center justify-between"},rt={class:"flex items-center gap-4"},dt={class:"text-sm text-muted-foreground"},ut={key:0},mt={key:1},ft={key:2},ct={key:3},pt={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},vt={class:"text-2xl font-bold"},_t={class:"text-2xl font-bold"},xt={class:"text-2xl font-bold"},gt={class:"text-2xl font-bold text-destructive"},bt={class:"grid gap-6 md:grid-cols-2"},wt={class:"grid gap-4 grid-cols-3"},ht={class:"text-center"},yt={class:"text-2xl font-bold"},jt={class:"text-center"},Ct={class:"text-2xl font-bold"},Tt={class:"text-center"},kt={class:"text-2xl font-bold text-destructive"},$t={key:0,class:"space-y-2"},Pt={class:"flex justify-between text-sm"},At={class:"font-medium"},Mt={class:"grid gap-4 grid-cols-3"},St={class:"text-center"},Ot={class:"text-2xl font-bold"},Dt={class:"text-center"},Et={class:"text-2xl font-bold"},Rt={class:"text-center"},qt={class:"text-2xl font-bold text-destructive"},zt={key:0,class:"space-y-2"},Nt={class:"flex justify-between text-sm"},Bt={class:"font-medium"},Ft={class:"grid gap-4 md:grid-cols-3"},Qt={class:"flex items-center gap-4"},Ut={class:"text-2xl font-bold"},Vt={class:"flex items-center gap-4"},Wt={class:"text-2xl font-bold"},It={class:"flex items-center gap-4"},Jt={class:"flex"},Lt={class:"text-2xl font-bold"},Ht={class:"flex flex-wrap gap-4"},Le=L({__name:"OTPDashboard",props:{initialQueueMetrics:{default:()=>[]},initialOtpStats:{default:()=>({total_activos:0,total_expirados:0,total_usados:0,por_canal:{email:0,whatsapp:0,both:0}})}},setup(U){const M=U,x=h(M.initialQueueMetrics),w=h(M.initialOtpStats),y=h(!1),S=h(new Date),j=h(null),V=[{label:"Admin",href:route("admin.dashboard")},{label:"Dashboard OTP",href:route("admin.otp-dashboard")}],d=g(()=>x.value.find(o=>o.queue_name==="otp-emails")),u=g(()=>x.value.find(o=>o.queue_name==="otp-whatsapp")),C=g(()=>x.value.reduce((o,t)=>o+t.pending_jobs,0)),k=g(()=>x.value.reduce((o,t)=>o+t.processing_jobs,0)),$=g(()=>x.value.reduce((o,t)=>o+t.failed_jobs,0)),_=g(()=>$.value>10?{status:"error",label:"Crítico",color:"destructive"}:C.value>50?{status:"warning",label:"Sobrecargado",color:"warning"}:k.value>0?{status:"processing",label:"Procesando",color:"default"}:{status:"healthy",label:"Saludable",color:"success"}),O=async()=>{y.value=!0;try{const o=await q.get("/api/queue/status");o.data.success&&(x.value=o.data.data);const t=await q.get("/api/queue/otp/stats");t.data.success&&(w.value=t.data.data),S.value=new Date}catch(o){console.error("Error actualizando datos:",o)}finally{y.value=!1}},W=()=>{j.value=window.setInterval(O,1e4)},I=()=>{j.value&&(clearInterval(j.value),j.value=null)},D=o=>o<60?`${o}s`:o<3600?`${Math.round(o/60)}m`:`${Math.round(o/3600)}h`,E=o=>o.failed_jobs>5?"destructive":o.pending_jobs>25?"warning":"default";return H(()=>{W()}),X(()=>{I()}),(o,t)=>(r(),f(J,{breadcrumbs:V},{default:l(()=>[a(e(G),{title:"Dashboard OTP"}),s("div",it,[s("div",nt,[t[1]||(t[1]=s("div",null,[s("h1",{class:"text-3xl font-bold tracking-tight"},"Dashboard OTP"),s("p",{class:"text-muted-foreground"}," Monitoreo en tiempo real del sistema de colas OTP ")],-1)),s("div",rt,[s("div",dt," Última actualización: "+i(S.value.toLocaleTimeString()),1),a(e(T),{onClick:O,variant:"outline",size:"sm",disabled:y.value},{default:l(()=>[a(e(B),{class:K([{"animate-spin":y.value},"h-4 w-4 mr-2"])},null,8,["class"]),t[0]||(t[0]=n(" Actualizar ",-1))]),_:1},8,["disabled"])])]),a(e(Y),{variant:_.value.status==="error"?"destructive":"default"},{default:l(()=>[_.value.status==="healthy"?(r(),f(e(et),{key:0,class:"h-4 w-4"})):_.value.status==="processing"?(r(),f(e(F),{key:1,class:"h-4 w-4"})):(r(),f(e(st),{key:2,class:"h-4 w-4"})),a(e(tt),null,{default:l(()=>[n("Estado del Sistema: "+i(_.value.label),1)]),_:1}),a(e(Z),null,{default:l(()=>[_.value.status==="healthy"?(r(),b("span",ut," Todas las colas funcionan normalmente ")):_.value.status==="processing"?(r(),b("span",mt,i(k.value)+" trabajos en proceso, "+i(C.value)+" en cola ",1)):_.value.status==="warning"?(r(),b("span",ft," Cola sobrecargada: "+i(C.value)+" trabajos pendientes ",1)):(r(),b("span",ct," Sistema crítico: "+i($.value)+" trabajos fallidos requieren atención ",1))]),_:1})]),_:1},8,["variant"]),s("div",pt,[a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>[...t[2]||(t[2]=[n("OTPs Activos",-1)])]),_:1}),a(e(Q),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:l(()=>[s("div",vt,i(w.value.total_activos),1),t[3]||(t[3]=s("p",{class:"text-xs text-muted-foreground"}," Códigos válidos pendientes ",-1))]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>[...t[4]||(t[4]=[n("En Cola",-1)])]),_:1}),a(e(F),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:l(()=>[s("div",_t,i(C.value),1),t[5]||(t[5]=s("p",{class:"text-xs text-muted-foreground"}," Envíos pendientes ",-1))]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>[...t[6]||(t[6]=[n("Procesando",-1)])]),_:1}),a(e(at),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:l(()=>[s("div",xt,i(k.value),1),t[7]||(t[7]=s("p",{class:"text-xs text-muted-foreground"}," Envíos en curso ",-1))]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>[...t[8]||(t[8]=[n("Fallidos",-1)])]),_:1}),a(e(lt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(m),null,{default:l(()=>[s("div",gt,i($.value),1),t[9]||(t[9]=s("p",{class:"text-xs text-muted-foreground"}," Requieren atención ",-1))]),_:1})]),_:1})]),s("div",bt,[a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),{class:"flex items-center gap-2"},{default:l(()=>[a(e(P),{class:"h-5 w-5"}),t[10]||(t[10]=n(" Cola Email OTP ",-1)),a(e(z),{variant:d.value?E(d.value):"secondary"},{default:l(()=>[n(i(d.value?`${d.value.rate_limit}/seg`:"N/A"),1)]),_:1},8,["variant"])]),_:1})]),_:1}),d.value?(r(),f(e(m),{key:0,class:"space-y-4"},{default:l(()=>[s("div",wt,[s("div",ht,[s("div",yt,i(d.value.pending_jobs),1),t[11]||(t[11]=s("div",{class:"text-xs text-muted-foreground"},"En cola",-1))]),s("div",jt,[s("div",Ct,i(d.value.processing_jobs),1),t[12]||(t[12]=s("div",{class:"text-xs text-muted-foreground"},"Procesando",-1))]),s("div",Tt,[s("div",kt,i(d.value.failed_jobs),1),t[13]||(t[13]=s("div",{class:"text-xs text-muted-foreground"},"Fallidos",-1))])]),d.value.pending_jobs>0?(r(),b("div",$t,[s("div",Pt,[t[14]||(t[14]=s("span",null,"Tiempo estimado de espera",-1)),s("span",At,i(D(d.value.estimated_wait_seconds)),1)]),a(e(N),{value:Math.min(100,d.value.processing_jobs/(d.value.pending_jobs+d.value.processing_jobs)*100),class:"h-2"},null,8,["value"])])):R("",!0)]),_:1})):(r(),f(e(m),{key:1},{default:l(()=>[...t[15]||(t[15]=[s("p",{class:"text-muted-foreground text-center py-4"}," No hay datos disponibles para la cola de emails ",-1)])]),_:1}))]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),{class:"flex items-center gap-2"},{default:l(()=>[a(e(A),{class:"h-5 w-5"}),t[16]||(t[16]=n(" Cola WhatsApp OTP ",-1)),a(e(z),{variant:u.value?E(u.value):"secondary"},{default:l(()=>[n(i(u.value?`${u.value.rate_limit}/seg`:"N/A"),1)]),_:1},8,["variant"])]),_:1})]),_:1}),u.value?(r(),f(e(m),{key:0,class:"space-y-4"},{default:l(()=>[s("div",Mt,[s("div",St,[s("div",Ot,i(u.value.pending_jobs),1),t[17]||(t[17]=s("div",{class:"text-xs text-muted-foreground"},"En cola",-1))]),s("div",Dt,[s("div",Et,i(u.value.processing_jobs),1),t[18]||(t[18]=s("div",{class:"text-xs text-muted-foreground"},"Procesando",-1))]),s("div",Rt,[s("div",qt,i(u.value.failed_jobs),1),t[19]||(t[19]=s("div",{class:"text-xs text-muted-foreground"},"Fallidos",-1))])]),u.value.pending_jobs>0?(r(),b("div",zt,[s("div",Nt,[t[20]||(t[20]=s("span",null,"Tiempo estimado de espera",-1)),s("span",Bt,i(D(u.value.estimated_wait_seconds)),1)]),a(e(N),{value:Math.min(100,u.value.processing_jobs/(u.value.pending_jobs+u.value.processing_jobs)*100),class:"h-2"},null,8,["value"])])):R("",!0)]),_:1})):(r(),f(e(m),{key:1},{default:l(()=>[...t[21]||(t[21]=[s("p",{class:"text-muted-foreground text-center py-4"}," No hay datos disponibles para la cola de WhatsApp ",-1)])]),_:1}))]),_:1})]),a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),null,{default:l(()=>[...t[22]||(t[22]=[n("Distribución de OTPs por Canal",-1)])]),_:1})]),_:1}),a(e(m),null,{default:l(()=>[s("div",Ft,[s("div",Qt,[a(e(P),{class:"h-8 w-8 text-blue-500"}),s("div",null,[s("div",Ut,i(w.value.por_canal.email),1),t[23]||(t[23]=s("div",{class:"text-sm text-muted-foreground"},"Solo Email",-1))])]),s("div",Vt,[a(e(A),{class:"h-8 w-8 text-green-500"}),s("div",null,[s("div",Wt,i(w.value.por_canal.whatsapp),1),t[24]||(t[24]=s("div",{class:"text-sm text-muted-foreground"},"Solo WhatsApp",-1))])]),s("div",It,[s("div",Jt,[a(e(P),{class:"h-8 w-8 text-blue-500"}),a(e(A),{class:"h-8 w-8 text-green-500 -ml-2"})]),s("div",null,[s("div",Lt,i(w.value.por_canal.both),1),t[25]||(t[25]=s("div",{class:"text-sm text-muted-foreground"},"Ambos Canales",-1))])])])]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),null,{default:l(()=>[...t[26]||(t[26]=[n("Acciones Administrativas",-1)])]),_:1})]),_:1}),a(e(m),null,{default:l(()=>[s("div",Ht,[a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(ot),{class:"h-4 w-4 mr-2"}),t[27]||(t[27]=n(" Monitoreo en Tiempo Real ",-1))]),_:1}),a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(B),{class:"h-4 w-4 mr-2"}),t[28]||(t[28]=n(" Reiniciar Cola Fallida ",-1))]),_:1}),a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(Q),{class:"h-4 w-4 mr-2"}),t[29]||(t[29]=n(" Ver Logs Detallados ",-1))]),_:1})])]),_:1})]),_:1})])]),_:1}))}});export{Le as default};
