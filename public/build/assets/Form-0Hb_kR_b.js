import{d as ae,c as _,r as g,u as oe,p as te,o as ie,i as u,e as t,f as r,q as se,w as s,g as l,t as n,h as d,l as le,j as m,n as h,m as c,F as U,k as R,b as H}from"./app-_uW1dugG.js";import{_ as T}from"./createLucideIcon-Cgfvt99-.js";import{_ as ne,a as de,b as ce,c as ue}from"./CardTitle.vue_vue_type_script_setup_true_lang-BPO4jmee.js";import{_ as me}from"./Checkbox.vue_vue_type_script_setup_true_lang-DNBijmsa.js";import{_ as pe}from"./Input.vue_vue_type_script_setup_true_lang-DN97Gps1.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-zswzwbwY.js";import{_ as A,a as P,b as j,c as M,d as x}from"./SelectValue.vue_vue_type_script_setup_true_lang-Bh_XafA_.js";import{_ as fe,a as _e,b as O,c as J}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-C3DKBrvG.js";import{_ as ve}from"./Textarea.vue_vue_type_script_setup_true_lang-DWYMKOMu.js";import{_ as K}from"./DateTimePicker.vue_vue_type_script_setup_true_lang-CrgX2sdi.js";import{_ as ge,D as he}from"./DynamicFormBuilder-BxOZDl_6.js";import{_ as be}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BWNm87yv.js";import{A as xe}from"./arrow-left-BO4bnF-5.js";import{M as ye}from"./megaphone-B2FaGee7.js";import{S as Ce}from"./useFlashMessages-Dbtkta13.js";import{C as Q}from"./calendar-BSitMM8j.js";import{C as De}from"./clock-BnAEvQ8h.js";import{U as we}from"./users-CsAqsYeA.js";import"./index-DPc4-Tss.js";import"./floating-ui.vue-jllM84JI.js";import"./check-CYARxbiD.js";import"./index-BsOg3dwq.js";import"./VisuallyHidden-91YFdEdI.js";import"./RovingFocusItem-DKrjhxgv.js";import"./utils-B4crbB_d.js";import"./index-CtzE2ZsW.js";import"./plus-BBTOvcwp.js";import"./trash-2-C6cnWiBY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Dtv6jyqr.js";import"./VisuallyHiddenInput-CUNTAWZK.js";import"./circle-CMwudUPu.js";import"./grip-vertical-BtkEVqCW.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-gjk5Pd1p.js";import"./circle-alert-BmkZpFMv.js";import"./eye-DfAIwpp-.js";import"./x-DpMkz8bM.js";import"./git-branch-CdHuTYVL.js";import"./square-pen-CtDnr7II.js";import"./copy-CZ3OLVRX.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-h9YJSUP8.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-NfsqoLAM.js";import"./chevron-right-BjVfK8SN.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BCedbIeu.js";import"./chevrons-up-down-uZXkDWN2.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CtVi1mb6.js";import"./tag-ChJj5ULy.js";import"./target-CIl-5ynT.js";import"./shield-BM5G7lvr.js";import"./vote-CuY124ch.js";import"./folder-open-COoV-miV.js";import"./send-CkAwMtac.js";import"./file-text-f2gSpD92.js";import"./briefcase-T2valhVV.js";import"./user-check-DHsa_k4_.js";import"./clipboard-list-CZFMoFbv.js";import"./mail-B5J8anNk.js";import"./message-square-Da-j-dRg.js";import"./external-link-CQ6F3Axs.js";import"./panel-left-B8lxiciw.js";import"./index-CkTCL-Qw.js";import"./index-B6xDyQoH.js";import"./index-B6vPRSi6.js";import"./user-DewN_dzu.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DiEgIWBx.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-DtbxKS-K.js";import"./map-pin-DnYK02Zt.js";const Ve={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},$e={class:"flex items-center justify-between"},ke={class:"text-3xl font-bold"},Ee={class:"text-muted-foreground"},Ne={class:"grid gap-6 md:grid-cols-2"},Fe={class:"space-y-4"},Se={key:0,class:"text-sm text-destructive mt-1"},Ue={key:0,class:"text-sm text-destructive mt-1"},Te={key:0,class:"text-sm text-destructive mt-1"},Ae={class:"flex items-center space-x-2"},Pe={class:"space-y-4"},je={key:0,class:"text-sm text-destructive mt-1"},Me={key:1,class:"text-sm text-destructive mt-1"},qe={key:0,class:"text-sm text-destructive mt-1"},Be={key:1,class:"text-sm text-destructive mt-1"},Ie={key:2,class:"text-sm text-destructive mt-1"},Le={key:0,class:"text-sm text-destructive mt-1"},ze={key:0,class:"text-sm text-destructive mt-1"},Ge={key:0,class:"p-4 bg-blue-50 rounded-lg border border-blue-200"},Re={class:"mt-2 space-y-2"},He={class:"flex items-center gap-2 text-blue-700"},Oe={class:"font-medium"},Je={class:"font-medium"},Ke={key:0,class:"flex items-center gap-2 text-blue-600"},Qe={key:1,class:"flex items-center gap-2 text-blue-600"},We={key:2,class:"flex items-center gap-2 text-blue-600"},Xe={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg"},Ye={class:"text-red-800 text-sm"},Ze={class:"flex justify-between mt-8"},fa=ae({__name:"Form",props:{convocatoria:{}},setup(W){const y=W,v=_(()=>!!y.convocatoria),X=[{title:"Admin",href:"/admin/dashboard"},{title:"Convocatorias",href:"/admin/convocatorias"},{title:v.value?"Editar":"Crear",href:"#"}],q=g("general"),$=g([]),C=g([]),k=g(!1),E=g(!1),e=oe((()=>{if(!y.convocatoria)return{nombre:"",descripcion:"",fecha_apertura:null,fecha_cierre:null,cargo_id:null,periodo_electoral_id:null,territorio_id:null,departamento_id:null,municipio_id:null,localidad_id:null,formulario_postulacion:[],estado:"borrador",activo:!0};const o=y.convocatoria;return{nombre:o.nombre||"",descripcion:o.descripcion||"",fecha_apertura:o.fecha_apertura?new Date(o.fecha_apertura):null,fecha_cierre:o.fecha_cierre?new Date(o.fecha_cierre):null,cargo_id:o.cargo_id||null,periodo_electoral_id:o.periodo_electoral_id||null,territorio_id:o.territorio_id||null,departamento_id:o.departamento_id||null,municipio_id:o.municipio_id||null,localidad_id:o.localidad_id||null,formulario_postulacion:o.formulario_postulacion||[],estado:o.estado||"borrador",activo:o.activo}})()),N=g([...e.formulario_postulacion]),F=g({territorios_ids:e.territorio_id?[e.territorio_id]:[],departamentos_ids:e.departamento_id?[e.departamento_id]:[],municipios_ids:e.municipio_id?[e.municipio_id]:[],localidades_ids:e.localidad_id?[e.localidad_id]:[]});te(F,o=>{e.territorio_id=o.territorios_ids[0]||null,e.departamento_id=o.departamentos_ids[0]||null,e.municipio_id=o.municipios_ids[0]||null,e.localidad_id=o.localidades_ids[0]||null},{deep:!0}),ie(async()=>{await Promise.all([Y(),Z()])});const Y=async()=>{try{k.value=!0;const o=await fetch("/admin/cargos-for-convocatorias");$.value=await o.json()}catch(o){console.error("Error loading cargos:",o)}finally{k.value=!1}},Z=async()=>{try{E.value=!0;const o=await fetch("/admin/periodos-disponibles");C.value=await o.json()}catch(o){console.error("Error loading periodos:",o)}finally{E.value=!1}},ee=()=>{e.formulario_postulacion=[...N.value],v.value?e.put(`/admin/convocatorias/${y.convocatoria.id}`,{onError:o=>{console.error("Errores de validación:",o)}}):e.post("/admin/convocatorias",{onError:o=>{console.error("Errores de validación:",o)}})},D=_(()=>{if(!e.fecha_apertura)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura);return isNaN(o.getTime())?"Fecha de apertura inválida":""}),w=_(()=>{if(!e.fecha_cierre||!e.fecha_apertura)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),a=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre);return isNaN(o.getTime())||isNaN(a.getTime())?"Fechas inválidas":a<=o?"La fecha de cierre debe ser posterior a la fecha de apertura":""}),S=_(()=>{if(!e.fecha_apertura||!e.fecha_cierre||!e.periodo_electoral_id)return"";const o=C.value.find(V=>V.id===e.periodo_electoral_id);if(!o)return"";const a=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),i=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre),p=new Date(o.fecha_inicio),b=new Date(o.fecha_fin);return a<p||a>b||i<p||i>b?"Las fechas deben estar dentro del periodo electoral seleccionado":""}),B=_(()=>{if(!e.fecha_apertura||!e.fecha_cierre)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),a=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre);if(isNaN(o.getTime())||isNaN(a.getTime()))return"";const i=Math.ceil((a.getTime()-o.getTime())/(1e3*60*60*24));if(i<0)return"";if(i<1){const G=Math.ceil((a.getTime()-o.getTime())/36e5);return`${G} hora${G!==1?"s":""}`}if(i<30)return`${i} día${i!==1?"s":""}`;const p=Math.floor(i/30),b=i%30;let V=`${p} mes${p!==1?"es":""}`;return b>0&&(V+=` y ${b} día${b!==1?"s":""}`),V}),re=_(()=>e.nombre.trim().length>0&&e.fecha_apertura&&e.fecha_cierre&&e.cargo_id&&e.periodo_electoral_id&&!D.value&&!w.value&&!S.value),I=o=>{if(!o)return"";const a=o instanceof Date?o:new Date(o);return isNaN(a.getTime())?"":a.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},L=_(()=>e.cargo_id?$.value.find(o=>o.id===e.cargo_id):null),z=_(()=>e.periodo_electoral_id?C.value.find(o=>o.id===e.periodo_electoral_id):null);return(o,a)=>(c(),u(U,null,[t(r(se),{title:v.value?"Editar Convocatoria":"Nueva Convocatoria"},null,8,["title"]),t(be,{breadcrumbs:X},{default:s(()=>[l("div",Ve,[l("div",$e,[l("div",null,[l("h1",ke,n(v.value?"Editar Convocatoria":"Nueva Convocatoria"),1),l("p",Ee,n(v.value?"Modifica los datos de la convocatoria electoral":"Crea una nueva convocatoria con formulario de postulación personalizado"),1)]),t(r(T),{variant:"outline",onClick:a[0]||(a[0]=i=>o.$inertia.visit("/admin/convocatorias"))},{default:s(()=>[t(r(xe),{class:"mr-2 h-4 w-4"}),a[13]||(a[13]=d(" Volver ",-1))]),_:1})]),t(r(ne),null,{default:s(()=>[t(r(de),null,{default:s(()=>[t(r(ce),null,{default:s(()=>[d(n(v.value?"Datos de la Convocatoria":"Información de la Nueva Convocatoria"),1)]),_:1})]),_:1}),t(r(ue),null,{default:s(()=>[l("form",{onSubmit:le(ee,["prevent"])},[t(r(fe),{modelValue:q.value,"onUpdate:modelValue":a[11]||(a[11]=i=>q.value=i),class:"w-full"},{default:s(()=>[t(r(_e),{class:"grid w-full grid-cols-2"},{default:s(()=>[t(r(O),{value:"general",class:"flex items-center gap-2"},{default:s(()=>[t(r(ye),{class:"h-4 w-4"}),a[14]||(a[14]=d(" Información General ",-1))]),_:1}),t(r(O),{value:"formulario",class:"flex items-center gap-2"},{default:s(()=>[t(r(Ce),{class:"h-4 w-4"}),a[15]||(a[15]=d(" Formulario de Postulación ",-1))]),_:1})]),_:1}),t(r(J),{value:"general",class:"space-y-6"},{default:s(()=>[l("div",Ne,[l("div",Fe,[l("div",null,[t(r(f),{for:"nombre"},{default:s(()=>[...a[16]||(a[16]=[d("Nombre de la Convocatoria *",-1)])]),_:1}),t(r(pe),{id:"nombre",modelValue:r(e).nombre,"onUpdate:modelValue":a[1]||(a[1]=i=>r(e).nombre=i),placeholder:"Ej: Elección Alcalde 2024, Postulación Senado...",class:h({"border-destructive":r(e).errors.nombre})},null,8,["modelValue","class"]),r(e).errors.nombre?(c(),u("p",Se,n(r(e).errors.nombre),1)):m("",!0)]),l("div",null,[t(r(f),{for:"descripcion"},{default:s(()=>[...a[17]||(a[17]=[d("Descripción (opcional)",-1)])]),_:1}),t(r(ve),{id:"descripcion",modelValue:r(e).descripcion,"onUpdate:modelValue":a[2]||(a[2]=i=>r(e).descripcion=i),placeholder:"Descripción detallada de la convocatoria...",rows:"4",class:h({"border-destructive":r(e).errors.descripcion})},null,8,["modelValue","class"]),r(e).errors.descripcion?(c(),u("p",Ue,n(r(e).errors.descripcion),1)):m("",!0)]),l("div",null,[t(r(f),{for:"estado"},{default:s(()=>[...a[18]||(a[18]=[d("Estado *",-1)])]),_:1}),t(r(A),{modelValue:r(e).estado,"onUpdate:modelValue":a[3]||(a[3]=i=>r(e).estado=i)},{default:s(()=>[t(r(P),{class:h({"border-destructive":r(e).errors.estado})},{default:s(()=>[t(r(j),{placeholder:"Seleccionar estado"})]),_:1},8,["class"]),t(r(M),null,{default:s(()=>[t(r(x),{value:"borrador"},{default:s(()=>[...a[19]||(a[19]=[d("Borrador",-1)])]),_:1}),t(r(x),{value:"activa"},{default:s(()=>[...a[20]||(a[20]=[d("Activa",-1)])]),_:1}),t(r(x),{value:"cerrada"},{default:s(()=>[...a[21]||(a[21]=[d("Cerrada",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(e).errors.estado?(c(),u("p",Te,n(r(e).errors.estado),1)):m("",!0)]),l("div",Ae,[t(r(me),{id:"activo",checked:r(e).activo,"onUpdate:checked":a[4]||(a[4]=i=>r(e).activo=i)},null,8,["checked"]),t(r(f),{for:"activo"},{default:s(()=>[...a[22]||(a[22]=[d(" Convocatoria activa ",-1)])]),_:1})]),a[23]||(a[23]=l("p",{class:"text-xs text-muted-foreground"}," Solo las convocatorias activas pueden recibir postulaciones. ",-1))]),l("div",Pe,[l("div",null,[t(r(f),{for:"fecha_apertura"},{default:s(()=>[...a[24]||(a[24]=[d("Fecha y Hora de Apertura *",-1)])]),_:1}),t(r(K),{id:"fecha_apertura",modelValue:r(e).fecha_apertura,"onUpdate:modelValue":a[5]||(a[5]=i=>r(e).fecha_apertura=i),placeholder:"Seleccionar fecha y hora de apertura",class:h({"border-destructive":r(e).errors.fecha_apertura||D.value})},null,8,["modelValue","class"]),D.value?(c(),u("p",je,n(D.value),1)):m("",!0),r(e).errors.fecha_apertura?(c(),u("p",Me,n(r(e).errors.fecha_apertura),1)):m("",!0)]),l("div",null,[t(r(f),{for:"fecha_cierre"},{default:s(()=>[...a[25]||(a[25]=[d("Fecha y Hora de Cierre *",-1)])]),_:1}),t(r(K),{id:"fecha_cierre",modelValue:r(e).fecha_cierre,"onUpdate:modelValue":a[6]||(a[6]=i=>r(e).fecha_cierre=i),placeholder:"Seleccionar fecha y hora de cierre",class:h({"border-destructive":r(e).errors.fecha_cierre||w.value})},null,8,["modelValue","class"]),w.value?(c(),u("p",qe,n(w.value),1)):m("",!0),r(e).errors.fecha_cierre?(c(),u("p",Be,n(r(e).errors.fecha_cierre),1)):m("",!0),S.value?(c(),u("p",Ie,n(S.value),1)):m("",!0)]),l("div",null,[t(r(f),{for:"cargo_id"},{default:s(()=>[...a[26]||(a[26]=[d("Cargo *",-1)])]),_:1}),t(r(A),{modelValue:r(e).cargo_id,"onUpdate:modelValue":a[7]||(a[7]=i=>r(e).cargo_id=i)},{default:s(()=>[t(r(P),{class:h({"border-destructive":r(e).errors.cargo_id})},{default:s(()=>[t(r(j),{placeholder:k.value?"Cargando cargos...":"Seleccionar cargo"},null,8,["placeholder"])]),_:1},8,["class"]),t(r(M),null,{default:s(()=>[(c(!0),u(U,null,R($.value,i=>(c(),H(r(x),{key:i.id,value:i.id},{default:s(()=>[d(n(i.ruta_jerarquica),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),r(e).errors.cargo_id?(c(),u("p",Le,n(r(e).errors.cargo_id),1)):m("",!0)]),l("div",null,[t(r(f),{for:"periodo_electoral_id"},{default:s(()=>[...a[27]||(a[27]=[d("Periodo Electoral *",-1)])]),_:1}),t(r(A),{modelValue:r(e).periodo_electoral_id,"onUpdate:modelValue":a[8]||(a[8]=i=>r(e).periodo_electoral_id=i)},{default:s(()=>[t(r(P),{class:h({"border-destructive":r(e).errors.periodo_electoral_id})},{default:s(()=>[t(r(j),{placeholder:E.value?"Cargando periodos...":"Seleccionar periodo"},null,8,["placeholder"])]),_:1},8,["class"]),t(r(M),null,{default:s(()=>[(c(!0),u(U,null,R(C.value,i=>(c(),H(r(x),{key:i.id,value:i.id},{default:s(()=>[d(n(i.nombre)+" ("+n(i.estado_label)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),r(e).errors.periodo_electoral_id?(c(),u("p",ze,n(r(e).errors.periodo_electoral_id),1)):m("",!0)])])]),t(ge,{modelValue:F.value,"onUpdate:modelValue":a[9]||(a[9]=i=>F.value=i),title:"Restricciones Geográficas (Opcional)",description:"Define las regiones donde estará disponible esta convocatoria. Si no seleccionas nada, estará disponible nacionalmente."},null,8,["modelValue"]),r(e).fecha_apertura&&r(e).fecha_cierre?(c(),u("div",Ge,[t(r(f),{class:"text-blue-800 font-medium"},{default:s(()=>[...a[28]||(a[28]=[d("Vista previa de la convocatoria:",-1)])]),_:1}),l("div",Re,[l("div",He,[t(r(Q),{class:"h-4 w-4"}),l("span",Oe,n(I(r(e).fecha_apertura)),1),a[29]||(a[29]=l("span",{class:"text-blue-500"},"→",-1)),l("span",Je,n(I(r(e).fecha_cierre)),1)]),B.value?(c(),u("div",Ke,[t(r(De),{class:"h-4 w-4"}),l("span",null,"Duración: "+n(B.value),1)])):m("",!0),L.value?(c(),u("div",Qe,[t(r(we),{class:"h-4 w-4"}),l("span",null,"Cargo: "+n(L.value.ruta_jerarquica),1)])):m("",!0),z.value?(c(),u("div",We,[t(r(Q),{class:"h-4 w-4"}),l("span",null,"Periodo: "+n(z.value.nombre),1)])):m("",!0)])])):m("",!0)]),_:1}),t(r(J),{value:"formulario",class:"space-y-6"},{default:s(()=>{var i;return[t(he,{modelValue:N.value,"onUpdate:modelValue":a[10]||(a[10]=p=>N.value=p),title:"Formulario de Postulación",description:"Define los campos que deberán completar los postulantes. Estos campos se mostrarán además de la información básica requerida.",context:"convocatoria",cargos:((i=o.cargos)==null?void 0:i.filter(p=>p.es_cargo))||[],"periodos-electorales":o.periodosElectorales||[]},null,8,["modelValue","cargos","periodos-electorales"]),a[30]||(a[30]=l("div",{class:"p-4 bg-yellow-50 rounded-lg border border-yellow-200"},[l("p",{class:"text-yellow-800 text-sm"},[l("strong",null,"Nota:"),d(' En el futuro, aquí también podrás agregar un campo especial "Perfil de Candidatura" que permitirá a los usuarios vincular sus perfiles de candidatura aprobados a sus postulaciones. ')])],-1))]}),_:1})]),_:1},8,["modelValue"]),r(e).errors.delete?(c(),u("div",Xe,[l("p",Ye,n(r(e).errors.delete),1)])):m("",!0),l("div",Ze,[t(r(T),{variant:"outline",type:"button",onClick:a[12]||(a[12]=i=>o.$inertia.visit("/admin/convocatorias"))},{default:s(()=>[...a[31]||(a[31]=[d(" Cancelar ",-1)])]),_:1}),t(r(T),{type:"submit",disabled:r(e).processing||!re.value},{default:s(()=>[d(n(r(e).processing?"Guardando...":v.value?"Actualizar":"Crear")+" Convocatoria ",1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})])]),_:1})],64))}});export{fa as default};
