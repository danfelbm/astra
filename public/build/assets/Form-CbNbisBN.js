import{d as re,a as d,o as n,b as a,i as f,u as e,e as l,g as c,t as u,F as z,r as B,j as b,k,c as E,w as te,f as r,n as O,h as ve,C as _e,p as ge,m as xe,ad as he,l as be,W as N}from"./app-DSrLHn3Y.js";import{_ as fe}from"./index-K1H9GrpB.js";import{c as ye,_ as $}from"./createLucideIcon-T086w1BT.js";import{_ as q,c as T,a as R,b as G}from"./CardTitle.vue_vue_type_script_setup_true_lang-C14RY4pG.js";import{_ as $e}from"./Checkbox.vue_vue_type_script_setup_true_lang-DYXIL5VU.js";import{_ as S,a as ke}from"./Label.vue_vue_type_script_setup_true_lang-DSz5a2gN.js";import{_ as ae,a as se,b as oe,c as le,d as ie}from"./SelectValue.vue_vue_type_script_setup_true_lang-CBXjtrrj.js";import{_ as Ve,a as we,b as K,c as Y}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-qzJfrCoe.js";import{_ as Ce}from"./Textarea.vue_vue_type_script_setup_true_lang-BSEdqbW6.js";import{_ as ee}from"./DateTimePicker.vue_vue_type_script_setup_true_lang-CL6Xb6gn.js";import{P as Se,_ as Ue}from"./AppLayout.vue_vue_type_script_setup_true_lang-Jna3kYN3.js";import{L as Ee,a as ze,_ as Ie}from"./DynamicFormBuilder.vue_vue_type_script_setup_true_lang-CWey8txz.js";import{_ as Ae}from"./CsvImportWizard.vue_vue_type_script_setup_true_lang-CH6zmW57.js";import{_ as je,a as Be,b as De,c as Fe,d as Le,e as Pe}from"./index-CXxsJS42.js";import{_ as Ne,a as qe,b as Te}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CfZn-ifG.js";import{u as Me}from"./useDebounce-DYuGRx-K.js";import{C as He}from"./GeographicSelector.vue_vue_type_script_setup_true_lang-DkNUiBt4.js";import{L as ne}from"./loader-circle-BXiw8GnJ.js";import{U as de}from"./user-C06MBnG6.js";import{U as Re}from"./user-plus-BJLkBlDM.js";import{X as Ge}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B7o_0su9.js";import{M as Oe}from"./mail-D6vE7Gq2.js";import{C as We}from"./check-BU3Tww0w.js";import{U as ue}from"./upload-CTv2Axsq.js";import{P as Xe}from"./plus-CdQpF7ec.js";import{H as ce}from"./history-DN2Z_PAT.js";import{T as Ze}from"./trash-2-DfzZz4R8.js";import{C as Qe}from"./circle-x-C9WbKMwT.js";import{C as Je}from"./circle-check-big-aktHiC1b.js";import{C as me}from"./clock-DN7yXSS3.js";import"./index-CvSbtRnN.js";import"./VisuallyHidden-DXAR4dQ6.js";import"./RovingFocusItem-C4pY3IZg.js";import"./utils-BVbfwYth.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-MDe_Z2us.js";import"./index-Cu8Zv_Qr.js";import"./grip-vertical-CpSW5YPm.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-B8SNqHqQ.js";import"./eye-D3-HPp4u.js";import"./git-branch-gPwEupHw.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-BUm0REqX.js";import"./index-D3jRhRzP.js";import"./search-DEGpmwpy.js";import"./VisuallyHiddenInput-zS8Ig4JA.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ye("CreditCardIcon",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Ye={key:0,class:"text-red-500"},et={key:0,class:"text-sm text-destructive mt-1"},tt={key:1,class:"text-xs text-muted-foreground mt-1"},at=re({__name:"TimezoneSelector",props:{modelValue:{},disabled:{type:Boolean,default:!1},label:{default:"Zona Horaria"},placeholder:{default:"Seleccionar zona horaria"},description:{default:"Las fechas de apertura y cierre se aplicarán según esta zona horaria"},required:{type:Boolean,default:!1},error:{}},emits:["update:modelValue"],setup(M,{emit:p}){const v=p,L=x=>{v("update:modelValue",x)};return(x,V)=>(n(),d("div",null,[a(e(S),null,{default:l(()=>[c(u(x.label)+" ",1),x.required?(n(),d("span",Ye,"*")):f("",!0)]),_:1}),a(e(ae),{"model-value":x.modelValue,"onUpdate:modelValue":L,disabled:x.disabled},{default:l(()=>[a(e(se),null,{default:l(()=>[a(e(oe),{placeholder:x.placeholder},null,8,["placeholder"])]),_:1}),a(e(le),null,{default:l(()=>[(n(!0),d(z,null,B(e(Ee),s=>(n(),b(e(ie),{key:s.value,value:s.value},{default:l(()=>[c(u(s.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"]),x.error?(n(),d("p",et,u(x.error),1)):x.description?(n(),d("p",tt,u(x.description),1)):f("",!0)]))}}),st={class:"space-y-3"},ot={key:0,class:"flex flex-wrap gap-2"},lt={class:"text-xs"},it={class:"flex gap-2"},rt={key:0,class:"py-6 text-center text-sm"},nt={class:"py-6 text-center text-sm"},dt={key:2,class:"py-6 text-center text-sm text-muted-foreground"},ut={key:0,class:"px-2 py-1.5 text-xs text-muted-foreground"},ct={class:"flex items-start justify-between w-full"},mt={class:"flex-1 min-w-0"},ft={class:"flex items-center gap-2"},pt={class:"font-medium truncate"},vt={class:"flex items-center gap-2 mt-1"},_t={class:"text-xs text-muted-foreground truncate"},gt={class:"flex items-center gap-4 mt-1"},xt={key:0,class:"flex items-center gap-1"},ht={class:"text-xs text-muted-foreground"},bt={key:1,class:"flex items-center gap-1"},yt={class:"text-xs text-muted-foreground"},$t={key:1,class:"p-2"},kt={key:2,class:"p-2 text-center"},Vt=re({__name:"UserMultiSelectCombobox",props:{votacionId:{},placeholder:{default:"Buscar usuarios..."},disabled:{type:Boolean,default:!1}},emits:["add-users"],setup(M,{emit:p}){const v=M,L=p,x=k(!1),V=k(""),s=k(!1),h=k([]),I=k(!1),D=k(1),_=k([]),w=k(0),{debounce:A}=Me(),C=E(()=>_.value.length===0?v.placeholder:`${_.value.length} usuario${_.value.length!==1?"s":""} seleccionado${_.value.length!==1?"s":""}`),U=E(()=>_.value.length>0),j=async(g,m=1)=>{if(g.length<2){h.value=[],w.value=0,I.value=!1;return}s.value=!0;try{const t=await(await fetch(`/admin/votaciones/${v.votacionId}/search-users?query=${encodeURIComponent(g)}&page=${m}`)).json();m===1?h.value=t.users||[]:h.value=[...h.value,...t.users||[]],I.value=t.has_more||!1,w.value=t.total||0,D.value=t.page||1}catch(o){console.error("Error buscando usuarios:",o),h.value=[],I.value=!1,w.value=0}finally{s.value=!1}},H=A(g=>{D.value=1,j(g,1)},300);te(V,g=>{H(g)});const P=g=>_.value.some(m=>m.id===g.id),W=g=>{P(g)?_.value=_.value.filter(m=>m.id!==g.id):_.value.push(g)},F=g=>{_.value=_.value.filter(m=>m.id!==g.id)},X=()=>{!I.value||s.value||j(V.value,D.value+1)},Z=()=>{_.value.length!==0&&(L("add-users",[..._.value]),_.value=[],V.value="",h.value=[],x.value=!1)},Q=()=>{_.value=[]},J=g=>g?g.length>4?`***${g.slice(-4)}`:"****":"";return(g,m)=>(n(),d("div",st,[_.value.length>0?(n(),d("div",ot,[(n(!0),d(z,null,B(_.value,o=>(n(),b(e(fe),{key:o.id,variant:"secondary",class:"pl-2 pr-1 py-1"},{default:l(()=>[r("span",lt,u(o.name),1),a(e($),{variant:"ghost",size:"sm",class:"h-4 w-4 p-0 ml-2 hover:bg-transparent",onClick:t=>F(o)},{default:l(()=>[a(e(Ge),{class:"h-3 w-3"})]),_:2},1032,["onClick"])]),_:2},1024))),128)),_.value.length>0?(n(),b(e($),{key:0,variant:"ghost",size:"sm",class:"h-6 px-2 text-xs",onClick:Q},{default:l(()=>m[2]||(m[2]=[c(" Limpiar todo ")])),_:1})):f("",!0)])):f("",!0),r("div",it,[a(e(Ne),{open:x.value,"onUpdate:open":m[1]||(m[1]=o=>x.value=o)},{default:l(()=>[a(e(qe),{"as-child":""},{default:l(()=>[a(e($),{variant:"outline",role:"combobox","aria-expanded":x.value,disabled:g.disabled,class:"flex-1 justify-between"},{default:l(()=>[r("span",{class:O(U.value?"":"text-muted-foreground")},u(C.value),3),a(e(He),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:1},8,["aria-expanded","disabled"])]),_:1}),a(e(Te),{class:"w-[400px] p-0",align:"start"},{default:l(()=>[a(e(je),null,{default:l(()=>[a(e(Be),{modelValue:V.value,"onUpdate:modelValue":m[0]||(m[0]=o=>V.value=o),placeholder:"Buscar por nombre, email, cédula o teléfono...",class:"h-9"},null,8,["modelValue"]),a(e(De),null,{default:l(()=>[s.value&&h.value.length===0?(n(),d("div",rt,[a(e(ne),{class:"h-4 w-4 animate-spin mx-auto mb-2"}),m[3]||(m[3]=r("p",null,"Buscando usuarios...",-1))])):V.value.length>=2&&h.value.length===0&&!s.value?(n(),b(e(Fe),{key:1},{default:l(()=>[r("div",nt,[a(e(de),{class:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),m[4]||(m[4]=r("p",null,"No se encontraron usuarios",-1)),m[5]||(m[5]=r("p",{class:"text-xs text-muted-foreground mt-1"}," Intenta con otro término de búsqueda ",-1))])]),_:1})):V.value.length<2?(n(),d("div",dt,m[6]||(m[6]=[r("p",null,"Escribe al menos 2 caracteres para buscar",-1)]))):(n(),b(e(Le),{key:3},{default:l(()=>[w.value>0?(n(),d("div",ut,u(w.value)+" "+u(w.value===1?"resultado":"resultados"),1)):f("",!0),(n(!0),d(z,null,B(h.value,o=>(n(),b(e(Pe),{key:o.id,value:o.id.toString(),onSelect:t=>W(o),class:O(["cursor-pointer",P(o)?"bg-accent":""])},{default:l(()=>[r("div",ct,[r("div",mt,[r("div",ft,[a(e(de),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",pt,u(o.name),1)]),r("div",vt,[a(e(Oe),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",_t,u(o.email),1)]),r("div",gt,[o.documento_identidad?(n(),d("div",xt,[a(e(Ke),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",ht,u(J(o.documento_identidad)),1)])):f("",!0),o.telefono?(n(),d("div",bt,[a(e(Se),{class:"h-3 w-3 text-muted-foreground shrink-0"}),r("span",yt,u(o.telefono),1)])):f("",!0)])]),P(o)?(n(),b(e(We),{key:0,class:"h-4 w-4 text-primary shrink-0 ml-2"})):f("",!0)])]),_:2},1032,["value","onSelect","class"]))),128)),I.value&&!s.value?(n(),d("div",$t,[a(e($),{variant:"ghost",size:"sm",class:"w-full",onClick:ve(X,["stop"])},{default:l(()=>m[7]||(m[7]=[c(" Cargar más resultados ")])),_:1})])):f("",!0),s.value&&h.value.length>0?(n(),d("div",kt,[a(e(ne),{class:"h-4 w-4 animate-spin mx-auto"})])):f("",!0)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),a(e($),{onClick:Z,disabled:!U.value,variant:"default"},{default:l(()=>[a(e(Re),{class:"mr-2 h-4 w-4"}),c(" Agregar "+u(_.value.length||""),1)]),_:1},8,["disabled"])])]))}}),wt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ct={class:"flex items-center justify-between"},St={class:"text-3xl font-bold"},Ut={class:"text-muted-foreground"},Et={class:"relative min-h-[70vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 dark:border-sidebar-border"},zt={class:"grid gap-6 md:grid-cols-2"},It={class:"space-y-4"},At={key:0,class:"text-sm text-destructive mt-1"},jt={key:0,class:"text-sm text-destructive mt-1"},Bt={key:0,class:"text-sm text-destructive mt-1"},Dt={class:"space-y-4"},Ft={key:0,class:"text-sm text-destructive mt-1"},Lt={key:0,class:"text-sm text-destructive mt-1"},Pt={key:1,class:"text-sm text-destructive mt-1"},Nt={class:"flex items-center space-x-2"},qt={key:0,class:"space-y-2"},Tt={class:"flex justify-between"},Mt={class:"flex gap-2"},Ht={class:"flex justify-between"},Rt={class:"flex gap-2"},Gt={class:"space-y-4"},Ot={class:"flex items-center gap-2"},Wt={key:0,class:"text-center py-6 text-muted-foreground"},Xt={key:1,class:"space-y-3"},Zt=["onClick"],Qt={class:"flex items-center gap-3"},Jt={class:"font-medium text-sm"},Kt={class:"text-xs text-muted-foreground"},Yt={class:"flex items-center gap-2"},ea={key:0,class:"text-xs text-muted-foreground"},ta={key:0},aa={key:1,class:"text-xs text-muted-foreground"},sa={key:0,class:"text-center py-8 text-muted-foreground"},oa={key:1,class:"space-y-2"},la={class:"font-medium"},ia={class:"text-sm text-muted-foreground"},ra={class:"flex justify-between"},Ya=re({__name:"Form",props:{categorias:{},votacion:{},cargos:{},periodosElectorales:{},convocatorias:{}},setup(M){var m;const p=M,v=E(()=>!!p.votacion),L=E(()=>{var o;return v.value&&((o=p.votacion)==null?void 0:o.estado)==="borrador"}),x=[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"},{title:v.value?"Editar":"Crear",href:"#"}],V=()=>{if(!p.votacion)return{titulo:"",descripcion:"",categoria_id:"",fecha_inicio:null,fecha_fin:null,estado:"borrador",resultados_publicos:!1,fecha_publicacion_resultados:null,formulario_config:[],timezone:"America/Bogota",territorios_ids:[],departamentos_ids:[],municipios_ids:[],localidades_ids:[]};const o=p.votacion;return{titulo:o.titulo||"",descripcion:o.descripcion||"",categoria_id:o.categoria_id?String(o.categoria_id):"",fecha_inicio:o.fecha_inicio||null,fecha_fin:o.fecha_fin||null,estado:o.estado||"borrador",resultados_publicos:!!o.resultados_publicos,fecha_publicacion_resultados:o.fecha_publicacion_resultados||null,formulario_config:o.formulario_config||[],timezone:o.timezone||"America/Bogota",territorios_ids:o.territorios_ids||[],departamentos_ids:o.departamentos_ids||[],municipios_ids:o.municipios_ids||[],localidades_ids:o.localidades_ids||[]}},s=_e(V()),h=k("basicos"),I=[{value:"borrador",label:"Borrador"},{value:"activa",label:"Activa"},{value:"finalizada",label:"Finalizada"}],D=E({get:()=>({territorios_ids:s.territorios_ids||[],departamentos_ids:s.departamentos_ids||[],municipios_ids:s.municipios_ids||[],localidades_ids:s.localidades_ids||[]}),set:o=>{s.territorios_ids=o.territorios_ids,s.departamentos_ids=o.departamentos_ids,s.municipios_ids=o.municipios_ids,s.localidades_ids=o.localidades_ids}}),_=E(()=>!s.fecha_fin||!s.fecha_inicio?"":s.fecha_fin<=s.fecha_inicio?"La fecha de fin debe ser posterior a la fecha de inicio":""),w=()=>{if(!A.value){h.value="basicos",alert('Por favor completa todos los campos requeridos en la pestaña "Datos Básicos" antes de crear la votación.');return}if(s.formulario_config.length===0){alert("Por favor agrega al menos un campo al formulario antes de crear la votación.");return}v.value?s.put(`/admin/votaciones/${p.votacion.id}`,{onError:o=>{const t=Object.values(o)[0];t&&alert(`Error: ${Array.isArray(t)?t[0]:t}`)}}):s.post("/admin/votaciones",{onError:o=>{const t=Object.values(o)[0];t&&alert(`Error: ${Array.isArray(t)?t[0]:t}`)}})},A=E(()=>s.titulo&&s.categoria_id&&s.fecha_inicio&&s.fecha_fin&&s.timezone);E(()=>A.value&&s.formulario_config.length>0);const C=k(((m=p.votacion)==null?void 0:m.votantes)||[]),U=k(!1),j=k([]),H=async()=>{var o;if(!(!v.value||!((o=p.votacion)!=null&&o.id)))try{const t=await fetch(`/admin/votaciones/${p.votacion.id}/imports/recent`);if(t.ok){const i=await t.json();j.value=i}}catch(t){console.error("Error loading recent imports:",t)}},P=o=>{N.get(`/admin/imports/${o}`)},W=()=>{var o;(o=p.votacion)!=null&&o.id&&N.get(`/admin/votaciones/${p.votacion.id}/imports`)},F=o=>{switch(o){case"pending":return{icon:me,label:"Pendiente",class:"text-yellow-600"};case"processing":return{icon:me,label:"Procesando",class:"text-blue-600"};case"completed":return{icon:Je,label:"Completada",class:"text-green-600"};case"failed":return{icon:Qe,label:"Fallida",class:"text-red-600"}}},X=o=>new Date(o).toLocaleString("es-ES",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=o=>{var i;if(!o||o.length===0||!v.value||!((i=p.votacion)!=null&&i.id))return;const t=o.map(y=>y.id.toString());N.post(`/admin/votaciones/${p.votacion.id}/votantes`,{votante_ids:t},{preserveScroll:!0,onSuccess:()=>{o.forEach(y=>{C.value.some(pe=>pe.id===y.id)||C.value.push({id:y.id,name:y.name,email:y.email})})},onError:y=>{console.error("Error adding votantes:",y),alert("Error al agregar votantes")}})},Q=o=>{var t;!v.value||!((t=p.votacion)!=null&&t.id)||N.delete(`/admin/votaciones/${p.votacion.id}/votantes`,{data:{votante_id:o},preserveScroll:!0,onSuccess:()=>{C.value=C.value.filter(i=>i.id!==o)},onError:i=>{console.error("Error removing votante:",i),alert("Error al remover votante")}})},J=o=>{U.value=!1,H(),N.get(`/admin/imports/${o}`)},g=()=>{U.value=!1};return te(()=>p.votacion,o=>{if(o){const t=V();s.titulo=t.titulo,s.descripcion=t.descripcion,s.categoria_id=t.categoria_id,s.fecha_inicio=t.fecha_inicio,s.fecha_fin=t.fecha_fin,s.estado=t.estado,s.resultados_publicos=t.resultados_publicos,s.fecha_publicacion_resultados=t.fecha_publicacion_resultados,s.formulario_config=t.formulario_config,s.timezone=t.timezone,v.value&&H()}},{immediate:!0,deep:!0}),te(()=>s.resultados_publicos,o=>{console.log("resultados_publicos changed to:",o)},{immediate:!0}),ge(()=>{}),(o,t)=>(n(),d(z,null,[a(e(xe),{title:v.value?"Editar Votación":"Nueva Votación"},null,8,["title"]),a(Ue,{breadcrumbs:x},{default:l(()=>[r("div",wt,[r("div",Ct,[r("div",null,[r("h1",St,u(v.value?"Editar Votación":"Nueva Votación"),1),r("p",Ut,u(v.value?"Modifica los datos de la votación":"Crea una nueva votación paso a paso"),1)])]),r("div",Et,[a(e(q),{class:"border-0 shadow-none h-full"},{default:l(()=>[a(e(T),{class:"p-6"},{default:l(()=>[a(e(Ve),{modelValue:h.value,"onUpdate:modelValue":t[16]||(t[16]=i=>h.value=i),class:"w-full"},{default:l(()=>[a(e(we),{class:"grid w-full grid-cols-3"},{default:l(()=>[a(e(K),{value:"basicos"},{default:l(()=>t[17]||(t[17]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"1"),c(" Datos Básicos ")],-1)])),_:1}),a(e(K),{value:"formulario",disabled:!v.value&&!A.value},{default:l(()=>t[18]||(t[18]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"2"),c(" Formulario ")],-1)])),_:1},8,["disabled"]),a(e(K),{value:"votantes",disabled:!v.value},{default:l(()=>t[19]||(t[19]=[r("span",{class:"flex items-center gap-2"},[r("span",{class:"rounded-full bg-primary text-primary-foreground w-5 h-5 text-xs flex items-center justify-center"},"3"),c(" Votantes ")],-1)])),_:1},8,["disabled"])]),_:1}),a(e(Y),{value:"basicos",class:"space-y-6"},{default:l(()=>[r("div",zt,[r("div",It,[r("div",null,[a(e(S),{for:"titulo"},{default:l(()=>t[20]||(t[20]=[c("Título *")])),_:1}),a(e(ke),{id:"titulo",modelValue:e(s).titulo,"onUpdate:modelValue":t[0]||(t[0]=i=>e(s).titulo=i),placeholder:"Nombre de la votación",error:e(s).errors.titulo},null,8,["modelValue","error"]),e(s).errors.titulo?(n(),d("p",At,u(e(s).errors.titulo),1)):f("",!0)]),r("div",null,[a(e(S),{for:"descripcion"},{default:l(()=>t[21]||(t[21]=[c("Descripción")])),_:1}),a(e(Ce),{id:"descripcion",modelValue:e(s).descripcion,"onUpdate:modelValue":t[1]||(t[1]=i=>e(s).descripcion=i),placeholder:"Descripción detallada de la votación",rows:"4"},null,8,["modelValue"]),e(s).errors.descripcion?(n(),d("p",jt,u(e(s).errors.descripcion),1)):f("",!0)]),r("div",null,[a(e(S),{for:"categoria"},{default:l(()=>t[22]||(t[22]=[c("Categoría *")])),_:1}),a(e(ae),{modelValue:e(s).categoria_id,"onUpdate:modelValue":t[2]||(t[2]=i=>e(s).categoria_id=i)},{default:l(()=>[a(e(se),null,{default:l(()=>[a(e(oe),{placeholder:"Seleccionar categoría"})]),_:1}),a(e(le),null,{default:l(()=>[(n(!0),d(z,null,B(o.categorias,i=>(n(),b(e(ie),{key:i.id,value:i.id.toString()},{default:l(()=>[c(u(i.nombre),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(s).errors.categoria_id?(n(),d("p",Bt,u(e(s).errors.categoria_id),1)):f("",!0)]),a(ze,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=i=>D.value=i)},null,8,["modelValue"])]),r("div",Dt,[r("div",null,[a(e(S),{for:"fecha_inicio"},{default:l(()=>t[23]||(t[23]=[c("Fecha y Hora de Inicio *")])),_:1}),a(e(ee),{modelValue:e(s).fecha_inicio,"onUpdate:modelValue":t[4]||(t[4]=i=>e(s).fecha_inicio=i),placeholder:"Seleccionar fecha y hora de inicio"},null,8,["modelValue"]),e(s).errors.fecha_inicio?(n(),d("p",Ft,u(e(s).errors.fecha_inicio),1)):f("",!0)]),r("div",null,[a(e(S),{for:"fecha_fin"},{default:l(()=>t[24]||(t[24]=[c("Fecha y Hora de Fin *")])),_:1}),a(e(ee),{modelValue:e(s).fecha_fin,"onUpdate:modelValue":t[5]||(t[5]=i=>e(s).fecha_fin=i),placeholder:"Seleccionar fecha y hora de fin"},null,8,["modelValue"]),_.value?(n(),d("p",Lt,u(_.value),1)):f("",!0),e(s).errors.fecha_fin?(n(),d("p",Pt,u(e(s).errors.fecha_fin),1)):f("",!0)]),r("div",null,[a(e(S),{for:"estado"},{default:l(()=>t[25]||(t[25]=[c("Estado")])),_:1}),a(e(ae),{modelValue:e(s).estado,"onUpdate:modelValue":t[6]||(t[6]=i=>e(s).estado=i)},{default:l(()=>[a(e(se),null,{default:l(()=>[a(e(oe))]),_:1}),a(e(le),null,{default:l(()=>[(n(),d(z,null,B(I,i=>a(e(ie),{key:i.value,value:i.value},{default:l(()=>[c(u(i.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])]),a(at,{modelValue:e(s).timezone,"onUpdate:modelValue":t[7]||(t[7]=i=>e(s).timezone=i),required:"",error:e(s).errors.timezone},null,8,["modelValue","error"]),r("div",Nt,[a(e($e),{id:"resultados_publicos",checked:e(s).resultados_publicos,"onUpdate:checked":t[8]||(t[8]=i=>e(s).resultados_publicos=i)},null,8,["checked"]),a(e(S),{for:"resultados_publicos"},{default:l(()=>t[26]||(t[26]=[c(" Resultados públicos ")])),_:1})]),a(he,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:l(()=>[e(s).resultados_publicos?(n(),d("div",qt,[a(e(S),{for:"fecha_publicacion_resultados"},{default:l(()=>t[27]||(t[27]=[c(" Fecha de publicación de resultados (opcional) ")])),_:1}),a(e(ee),{id:"fecha_publicacion_resultados",modelValue:e(s).fecha_publicacion_resultados,"onUpdate:modelValue":t[9]||(t[9]=i=>e(s).fecha_publicacion_resultados=i),placeholder:"Dejar vacío para publicar al finalizar la votación"},null,8,["modelValue"]),t[28]||(t[28]=r("p",{class:"text-xs text-muted-foreground"}," Si se especifica una fecha, los resultados serán visibles desde esa fecha. Si se deja vacío, los resultados solo serán visibles después de que termine la votación. ",-1))])):f("",!0)]),_:1})])]),r("div",Tt,[t[30]||(t[30]=r("div",null,null,-1)),r("div",Mt,[v.value?(n(),b(e($),{key:0,onClick:w,disabled:e(s).processing||!A.value,variant:"default"},{default:l(()=>[c(u(e(s).processing?"Actualizando...":"Actualizar Votación"),1)]),_:1},8,["disabled"])):f("",!0),a(e($),{onClick:t[10]||(t[10]=i=>h.value="formulario"),disabled:!A.value,variant:"outline"},{default:l(()=>t[29]||(t[29]=[c(" Siguiente: Configurar Formulario ")])),_:1},8,["disabled"])])])]),_:1}),a(e(Y),{value:"formulario",class:"space-y-6"},{default:l(()=>{var i;return[a(Ie,{modelValue:e(s).formulario_config,"onUpdate:modelValue":t[11]||(t[11]=y=>e(s).formulario_config=y),title:"Constructor de Formulario",description:"Agrega los campos que aparecerán en la votación","show-perfil-candidatura-config":!0,"show-convocatoria-config":!0,cargos:((i=p.cargos)==null?void 0:i.filter(y=>y.es_cargo))||[],"periodos-electorales":p.periodosElectorales||[],convocatorias:p.convocatorias||[],context:"votacion"},null,8,["modelValue","cargos","periodos-electorales","convocatorias"]),r("div",Ht,[a(e($),{variant:"outline",onClick:t[12]||(t[12]=y=>h.value="basicos")},{default:l(()=>t[31]||(t[31]=[c(" Anterior ")])),_:1}),r("div",Rt,[L.value?(n(),b(e($),{key:0,variant:"outline",onClick:t[13]||(t[13]=y=>h.value="votantes"),disabled:e(s).formulario_config.length===0},{default:l(()=>t[32]||(t[32]=[c(" Siguiente: Gestionar Votantes ")])),_:1},8,["disabled"])):f("",!0),a(e($),{onClick:w,disabled:e(s).processing||e(s).formulario_config.length===0},{default:l(()=>[c(u(e(s).processing?"Guardando...":v.value?"Actualizar":"Crear")+" Votación ",1)]),_:1},8,["disabled"])])])]}),_:1}),a(e(Y),{value:"votantes",class:"space-y-6"},{default:l(()=>[t[44]||(t[44]=r("div",null,[r("h3",{class:"text-lg font-semibold"},"Gestión de Votantes"),r("p",{class:"text-sm text-muted-foreground"}," Asigna los usuarios que podrán participar en esta votación ")],-1)),U.value?f("",!0):(n(),b(e(q),{key:0},{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),{class:"flex items-center gap-2"},{default:l(()=>[a(e(ue),{class:"h-5 w-5"}),t[33]||(t[33]=c(" Importar Votantes "))]),_:1})]),_:1}),a(e(T),null,{default:l(()=>[r("div",Gt,[t[35]||(t[35]=r("p",{class:"text-sm text-muted-foreground"}," Importa votantes desde un archivo CSV con mapeo dinámico de campos. Los usuarios importados serán asignados automáticamente a esta votación. ",-1)),t[36]||(t[36]=r("p",{class:"text-sm text-blue-600"},[r("a",{href:"/ejemplo-usuarios.csv",download:"",class:"underline"}," 📥 Descargar plantilla CSV de ejemplo ")],-1)),a(e($),{variant:"outline",onClick:t[14]||(t[14]=i=>U.value=!0)},{default:l(()=>[a(e(ue),{class:"mr-2 h-4 w-4"}),t[34]||(t[34]=c(" Iniciar Importación "))]),_:1})])]),_:1})]),_:1})),U.value&&v.value&&o.votacion?(n(),b(Ae,{key:1,mode:"votacion","votacion-id":o.votacion.id,"votacion-titulo":o.votacion.titulo,"redirect-on-success":!1,onSuccess:J,onCancel:g},null,8,["votacion-id","votacion-titulo"])):f("",!0),v.value?(n(),b(e(q),{key:2},{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),{class:"flex items-center gap-2"},{default:l(()=>[a(e(Xe),{class:"h-5 w-5"}),t[37]||(t[37]=c(" Agregar Votantes "))]),_:1})]),_:1}),a(e(T),null,{default:l(()=>{var i;return[(i=p.votacion)!=null&&i.id?(n(),b(e(Vt),{key:0,"votacion-id":p.votacion.id,placeholder:"Buscar usuarios por nombre, email, cédula o teléfono...",onAddUsers:Z},null,8,["votacion-id"])):f("",!0)]}),_:1})]),_:1})):f("",!0),v.value?(n(),b(e(q),{key:3},{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),{class:"flex items-center justify-between"},{default:l(()=>[r("span",Ot,[a(e(ce),{class:"h-5 w-5"}),t[38]||(t[38]=c(" Historial de Importaciones "))]),j.value.length>0?(n(),b(e($),{key:0,variant:"outline",size:"sm",onClick:W},{default:l(()=>t[39]||(t[39]=[c(" Ver Todas ")])),_:1})):f("",!0)]),_:1})]),_:1}),a(e(T),null,{default:l(()=>[j.value.length===0?(n(),d("div",Wt,[a(e(ce),{class:"mx-auto h-8 w-8 mb-2"}),t[40]||(t[40]=r("p",null,"No hay importaciones registradas",-1)),t[41]||(t[41]=r("p",{class:"text-sm"},"Las importaciones aparecerán aquí una vez que subas archivos CSV",-1))])):(n(),d("div",Xt,[(n(!0),d(z,null,B(j.value,i=>(n(),d("div",{key:i.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:y=>P(i.id)},[r("div",Qt,[(n(),b(be(F(i.status).icon),{class:O(["h-4 w-4",F(i.status).class])},null,8,["class"])),r("div",null,[r("p",Jt,u(i.original_filename),1),r("p",Kt," Por "+u(i.created_by.name)+" • "+u(X(i.created_at)),1)])]),r("div",Yt,[a(e(fe),{variant:"outline",class:O(F(i.status).class)},{default:l(()=>[c(u(F(i.status).label),1)]),_:2},1032,["class"]),i.status==="completed"?(n(),d("div",ea,[c(u(i.successful_rows)+" exitosos ",1),i.failed_rows>0?(n(),d("span",ta,", "+u(i.failed_rows)+" errores",1)):f("",!0)])):i.status==="processing"?(n(),d("div",aa,u(i.progress_percentage)+"% ",1)):f("",!0)])],8,Zt))),128))]))]),_:1})]),_:1})):f("",!0),a(e(q),null,{default:l(()=>[a(e(R),null,{default:l(()=>[a(e(G),null,{default:l(()=>[c("Votantes Asignados ("+u(C.value.length)+")",1)]),_:1})]),_:1}),a(e(T),null,{default:l(()=>[C.value.length===0?(n(),d("div",sa,t[42]||(t[42]=[r("p",null,"No hay votantes asignados a esta votación",-1),r("p",{class:"text-sm"},"Importa un archivo CSV o agrega votantes manualmente",-1)]))):(n(),d("div",oa,[(n(!0),d(z,null,B(C.value,i=>(n(),d("div",{key:i.id,class:"flex items-center justify-between p-3 border rounded-lg"},[r("div",null,[r("p",la,u(i.name),1),r("p",ia,u(i.email),1)]),a(e($),{variant:"ghost",size:"sm",onClick:y=>Q(i.id)},{default:l(()=>[a(e(Ze),{class:"h-4 w-4 text-destructive"})]),_:2},1032,["onClick"])]))),128))]))]),_:1})]),_:1}),r("div",ra,[a(e($),{variant:"outline",onClick:t[15]||(t[15]=i=>h.value="formulario")},{default:l(()=>t[43]||(t[43]=[c(" Anterior ")])),_:1}),a(e($),{onClick:w,disabled:e(s).processing},{default:l(()=>[c(u(e(s).processing?"Guardando...":"Actualizar")+" Votación ",1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])])]),_:1})],64))}});export{Ya as default};
