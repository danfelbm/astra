import{d as Y,r as z,c as I,p as se,i as f,j as p,g as d,b as C,e as s,f as e,w as o,h as m,F as P,k as R,t as c,l as Z,n as L,m as n}from"./app-CJ1MU9dT.js";import{a as q,b as H,c as K,_ as G}from"./CardTitle.vue_vue_type_script_setup_true_lang-B8xlQso1.js";import{_ as S}from"./Label.vue_vue_type_script_setup_true_lang-CqPPdNPG.js";import{_ as le}from"./Input.vue_vue_type_script_setup_true_lang-DB_-hZqe.js";import{_ as ie}from"./Textarea.vue_vue_type_script_setup_true_lang-Cc2fwdkb.js";import{_ as N}from"./createLucideIcon-CYpPVXVf.js";import{_ as oe,a as re,b as ne,c as de,d as W}from"./SelectValue.vue_vue_type_script_setup_true_lang-C3ruv6H_.js";import{_ as O}from"./InputError.vue_vue_type_script_setup_true_lang-DThhS4zu.js";import{_ as X}from"./index-j7j0QxXc.js";import{_ as ue,a as ce}from"./index-iHtwNn1i.js";import{U as J}from"./upload-DkvE2a9i.js";import{C as me}from"./circle-alert-NG0hI2Ig.js";import{P as fe}from"./paperclip-DmYaBarK.js";import{X as Q}from"./x-Bj1R_lgz.js";import{L as ve}from"./loader-circle-D4k8AzdK.js";const ge={class:"space-y-4"},pe={key:0,class:"space-y-2"},xe={class:"space-y-2"},be={class:"flex items-center gap-3 flex-1 min-w-0"},he={class:"min-w-0 flex-1"},_e={class:"text-sm font-medium truncate"},ye={key:0,class:"text-xs text-muted-foreground"},$e=["multiple","accept","disabled"],ke={class:"text-sm font-medium mb-1"},Fe={class:"text-xs text-muted-foreground"},we={class:"text-xs text-muted-foreground mt-1"},Ce={key:0},Be={key:1,class:"space-y-2"},ze={class:"space-y-2"},Se={class:"flex items-center gap-3 flex-1 min-w-0"},Me={class:"min-w-0 flex-1"},Ve={class:"text-sm font-medium truncate"},Ae={class:"text-xs text-muted-foreground"},je={key:3,class:"text-xs text-muted-foreground"},De={key:0,class:"text-destructive"},Ee=Y({__name:"FileAttachmentManager",props:{existingFiles:{default:()=>[]},label:{},description:{},multiple:{type:Boolean,default:!0},maxFiles:{default:10},maxSizeMB:{default:5},accept:{default:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},disabled:{type:Boolean,default:!1},error:{}},emits:["files-added","file-removed"],setup(t,{expose:U,emit:_}){const v=t,u=_,M=z(),h=z(!1),g=z([]),B=z(""),$=I(()=>v.existingFiles||[]),k=I(()=>$.value.length+g.value.length),j=I(()=>k.value<v.maxFiles),D=()=>{var a;!v.disabled&&j.value&&((a=M.value)==null||a.click())},x=a=>{const l=a.target;l.files&&(y(Array.from(l.files)),l.value="")},i=a=>{var r;if(a.preventDefault(),h.value=!1,v.disabled)return;const l=Array.from(((r=a.dataTransfer)==null?void 0:r.files)||[]);y(l)},y=a=>{B.value="";const l=v.maxFiles-k.value;if(a.length>l){B.value=`Solo puedes agregar ${l} archivo(s) más. Límite: ${v.maxFiles}`;return}const r=[],b=[];a.forEach(w=>{var T;const ee=v.maxSizeMB*1024*1024;if(w.size>ee){b.push(`${w.name}: excede ${v.maxSizeMB}MB`);return}const te=`.${(T=w.name.split(".").pop())==null?void 0:T.toLowerCase()}`;if(!v.accept.split(",").map(ae=>ae.trim().toLowerCase()).includes(te)){b.push(`${w.name}: formato no permitido`);return}r.push(w)}),b.length>0&&(B.value=b.join(", ")),r.length>0&&(v.multiple?g.value.push(...r):g.value=[r[0]],u("files-added",g.value))},F=a=>{g.value.splice(a,1),u("files-added",g.value)},E=a=>{const l=$.value[a];l&&confirm("¿Estás seguro de eliminar este archivo?")&&u("file-removed",l.ruta)},V=a=>{if(!a)return"0 KB";const l=["B","KB","MB","GB"],r=Math.floor(Math.log(a)/Math.log(1024));return`${(a/Math.pow(1024,r)).toFixed(1)} ${l[r]}`},A=a=>{var l;return((l=a.split(".").pop())==null?void 0:l.toUpperCase())||"FILE"};return U({newFiles:g,clearNewFiles:()=>{g.value=[]}}),se(()=>v.error,a=>{a||(B.value="")}),(a,l)=>(n(),f("div",ge,[$.value.length>0?(n(),f("div",pe,[s(e(S),{class:"text-sm font-medium"},{default:o(()=>[...l[2]||(l[2]=[m("Archivos actuales",-1)])]),_:1}),d("div",xe,[(n(!0),f(P,null,R($.value,(r,b)=>(n(),f("div",{key:`existing-${b}`,class:"flex items-center justify-between p-3 bg-muted rounded-lg border border-border hover:bg-accent/50 transition-colors"},[d("div",be,[s(e(fe),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),d("div",he,[d("p",_e,c(r.nombre_original),1),r.tamaño?(n(),f("p",ye,c(V(r.tamaño)),1)):p("",!0)]),s(e(X),{variant:"outline",class:"flex-shrink-0"},{default:o(()=>[m(c(A(r.nombre_original)),1)]),_:2},1024)]),s(e(N),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10 flex-shrink-0",onClick:w=>E(b),disabled:t.disabled},{default:o(()=>[s(e(Q),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])]))),128))])])):p("",!0),d("div",null,[t.label?(n(),C(e(S),{key:0,class:"text-sm font-medium"},{default:o(()=>[m(c(t.label),1)]),_:1})):p("",!0),d("div",{onDrop:i,onDragover:l[0]||(l[0]=Z(r=>h.value=!0,["prevent"])),onDragleave:l[1]||(l[1]=r=>h.value=!1),onClick:D,class:"relative mt-2"},[d("input",{ref_key:"fileInput",ref:M,type:"file",multiple:t.multiple,accept:t.accept,disabled:t.disabled,class:"hidden",onChange:x},null,40,$e),d("div",{class:L(["border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-all",{"border-primary bg-primary/5 ring-2 ring-primary/20":h.value,"border-muted-foreground/25 hover:border-muted-foreground/50 hover:bg-muted/30":!h.value&&!t.disabled,"opacity-50 cursor-not-allowed":t.disabled,"border-destructive":t.error}])},[s(e(J),{class:L(["h-10 w-10 mx-auto mb-3 transition-colors",h.value?"text-primary":"text-muted-foreground"])},null,8,["class"]),d("p",ke,c(h.value?"Suelta los archivos aquí":"Haz clic o arrastra archivos aquí"),1),d("p",Fe,c(t.description||`Formatos: ${t.accept}`),1),d("p",we,[m(" Máximo "+c(t.maxSizeMB)+"MB por archivo ",1),t.multiple?(n(),f("span",Ce," • Hasta "+c(t.maxFiles)+" archivos total",1)):p("",!0)])],2)],32)]),g.value.length>0?(n(),f("div",Be,[s(e(S),{class:"text-sm font-medium"},{default:o(()=>[...l[3]||(l[3]=[m("Archivos a subir",-1)])]),_:1}),d("div",ze,[(n(!0),f(P,null,R(g.value,(r,b)=>(n(),f("div",{key:`new-${b}`,class:"flex items-center justify-between p-3 bg-accent rounded-lg border border-primary/20"},[d("div",Se,[s(e(J),{class:"h-4 w-4 text-primary flex-shrink-0"}),d("div",Me,[d("p",Ve,c(r.name),1),d("p",Ae,c(V(r.size)),1)]),s(e(X),{variant:"secondary",class:"flex-shrink-0"},{default:o(()=>[m(c(A(r.name)),1)]),_:2},1024)]),s(e(N),{type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 hover:bg-destructive/10 flex-shrink-0",onClick:w=>F(b),disabled:t.disabled},{default:o(()=>[s(e(Q),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])]))),128))])])):p("",!0),t.error?(n(),C(e(ue),{key:2,variant:"destructive"},{default:o(()=>[s(e(me),{class:"h-4 w-4"}),s(e(ce),null,{default:o(()=>[m(c(t.error),1)]),_:1})]),_:1})):p("",!0),!t.disabled&&($.value.length>0||g.value.length>0)?(n(),f("div",je,[m(c(k.value)+" de "+c(t.maxFiles)+" archivos ",1),k.value>=t.maxFiles?(n(),f("span",De," (límite alcanzado)")):p("",!0)])):p("",!0)]))}}),Ie={key:0},Le={class:"flex justify-end gap-2"},et=Y({__name:"ObligacionForm",props:{obligacion:{},contratoId:{},parentId:{},onSubmit:{},onCancel:{},loading:{type:Boolean,default:!1},errors:{default:()=>({})}},emits:["submit","cancel"],setup(t,{emit:U}){var k,j,D;const _=t,v=U,u=z({contrato_id:_.contratoId,parent_id:_.parentId||((k=_.obligacion)==null?void 0:k.parent_id)||null,titulo:((j=_.obligacion)==null?void 0:j.titulo)||"",descripcion:((D=_.obligacion)==null?void 0:D.descripcion)||"",archivos:[],archivos_eliminar:[]}),M=z([]),h=I(()=>{var i;return(((i=_.obligacion)==null?void 0:i.archivos_adjuntos)||[]).filter(y=>{var F;return!((F=u.value.archivos_eliminar)!=null&&F.includes(y.ruta))})}),g=()=>{const x={...u.value};v("submit",x)},B=x=>{u.value.archivos=x},$=x=>{u.value.archivos_eliminar=u.value.archivos_eliminar||[],u.value.archivos_eliminar.includes(x)||u.value.archivos_eliminar.push(x)};return(x,i)=>(n(),f("form",{onSubmit:Z(g,["prevent"]),class:"space-y-4"},[s(e(G),null,{default:o(()=>[s(e(q),null,{default:o(()=>[s(e(H),null,{default:o(()=>[...i[4]||(i[4]=[m("Información Básica",-1)])]),_:1})]),_:1}),s(e(K),{class:"space-y-4"},{default:o(()=>{var y,F,E,V,A;return[d("div",null,[s(e(S),{for:"titulo",required:""},{default:o(()=>[...i[5]||(i[5]=[m("Título",-1)])]),_:1}),s(e(le),{id:"titulo",modelValue:u.value.titulo,"onUpdate:modelValue":i[0]||(i[0]=a=>u.value.titulo=a),type:"text",placeholder:"Título de la obligación",class:L({"border-red-500":(y=t.errors)==null?void 0:y.titulo})},null,8,["modelValue","class"]),(F=t.errors)!=null&&F.titulo?(n(),C(O,{key:0,message:t.errors.titulo[0]},null,8,["message"])):p("",!0)]),d("div",null,[s(e(S),{for:"descripcion"},{default:o(()=>[...i[6]||(i[6]=[m("Descripción",-1)])]),_:1}),s(e(ie),{id:"descripcion",modelValue:u.value.descripcion,"onUpdate:modelValue":i[1]||(i[1]=a=>u.value.descripcion=a),placeholder:"Descripción detallada de la obligación",rows:3,class:L({"border-red-500":(E=t.errors)==null?void 0:E.descripcion})},null,8,["modelValue","class"]),(V=t.errors)!=null&&V.descripcion?(n(),C(O,{key:0,message:t.errors.descripcion[0]},null,8,["message"])):p("",!0)]),M.value.length>0?(n(),f("div",Ie,[s(e(S),{for:"parent_id"},{default:o(()=>[...i[7]||(i[7]=[m("Obligación Padre",-1)])]),_:1}),s(e(oe),{modelValue:u.value.parent_id,"onUpdate:modelValue":i[2]||(i[2]=a=>u.value.parent_id=a)},{default:o(()=>[s(e(re),{id:"parent_id"},{default:o(()=>[s(e(ne),{placeholder:"Seleccionar obligación padre (opcional)"})]),_:1}),s(e(de),null,{default:o(()=>[s(e(W),{value:null},{default:o(()=>[...i[8]||(i[8]=[m("Sin padre (raíz)",-1)])]),_:1}),(n(!0),f(P,null,R(M.value,a=>{var l;return n(),C(e(W),{key:a.id,value:a.id,disabled:a.id===((l=t.obligacion)==null?void 0:l.id)},{default:o(()=>[m(c("  ".repeat(a.nivel))+c(a.titulo),1)]),_:2},1032,["value","disabled"])}),128))]),_:1})]),_:1},8,["modelValue"]),(A=t.errors)!=null&&A.parent_id?(n(),C(O,{key:0,message:t.errors.parent_id[0]},null,8,["message"])):p("",!0)])):p("",!0)]}),_:1})]),_:1}),s(e(G),null,{default:o(()=>[s(e(q),null,{default:o(()=>[s(e(H),null,{default:o(()=>[...i[9]||(i[9]=[m("Archivos Adjuntos",-1)])]),_:1})]),_:1}),s(e(K),null,{default:o(()=>[s(Ee,{"existing-files":h.value,description:"Formatos: PDF, Word, Excel, Imágenes",multiple:!0,"max-files":20,"max-size-m-b":5,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",onFilesAdded:B,onFileRemoved:$},null,8,["existing-files"])]),_:1})]),_:1}),d("div",Le,[s(e(N),{type:"button",variant:"outline",onClick:i[3]||(i[3]=y=>x.$emit("cancel")),disabled:t.loading},{default:o(()=>[...i[10]||(i[10]=[m(" Cancelar ",-1)])]),_:1},8,["disabled"]),s(e(N),{type:"submit",disabled:t.loading||!u.value.titulo},{default:o(()=>[t.loading?(n(),C(e(ve),{key:0,class:"h-4 w-4 mr-2 animate-spin"})):p("",!0),m(" "+c(t.obligacion?"Actualizar":"Crear")+" Obligación ",1)]),_:1},8,["disabled"])])],32))}});export{et as _};
