import{d as ee,k as b,a as g,o as m,b as a,u as o,m as te,e as l,f as t,g as n,t as d,F as M,h as R,R as se,i as D,j as T,n as oe,r as G,q as ae}from"./app-CAXHaRzQ.js";import{_ as ie}from"./GuestLayout.vue_vue_type_script_setup_true_lang-DPEZXTiN.js";import{_ as le,a as ne,b as re,c as de}from"./CardTitle.vue_vue_type_script_setup_true_lang-Ft95mKZ2.js";import{_ as ue}from"./CardDescription.vue_vue_type_script_setup_true_lang-B-SYLEyF.js";import{_ as k}from"./createLucideIcon-DqZ8uYlK.js";import{_ as I}from"./Input.vue_vue_type_script_setup_true_lang-DBwpLbvr.js";import{_ as B}from"./Label.vue_vue_type_script_setup_true_lang-BspVZzut.js";import{_ as F,a as N}from"./index-Bfh6wep3.js";import{_ as me}from"./SPhoneInput.vue_vue_type_script_setup_true_lang-D7zjLgrr.js";import{_ as fe}from"./Progress.vue_vue_type_script_setup_true_lang-DfweeJaR.js";import{t as j}from"./index-C_rxOBkw.js";import{C as S}from"./circle-check-big-yZNwVPuV.js";import{U as ce}from"./upload-DDE1Dv2P.js";import{F as pe}from"./file-text-Ce4EZMSI.js";import{X as ve}from"./x-CvrO86nW.js";import{C as W}from"./circle-alert-Btx1czxG.js";import{L as ge}from"./loader-circle-h2n3mvFI.js";import"./index-BjKexxkT.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DzL_r38L.js";import"./index-CFeD25jK.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BGFlpI7t.js";import"./VisuallyHidden-CbWlDMyh.js";import"./PopperContent-Dnt9JElj.js";import"./floating-ui.vue-scMXyQQf.js";import"./index-DLnPMCj2.js";import"./search-kBnxofWo.js";import"./utils-C835ygEt.js";import"./VisuallyHiddenInput-mCGH0eBt.js";import"./chevrons-up-down-CJjADyp9.js";import"./nullish-CHIgUVhi.js";const xe={class:"max-w-2xl mx-auto"},be={key:0,class:"space-y-6"},ye={class:"bg-muted p-4 rounded-lg"},_e={class:"space-y-3"},he={class:"flex items-start gap-3"},we={class:"rounded-full bg-primary/10 p-1 mt-0.5"},ke={class:"flex items-start gap-3"},Ce={class:"rounded-full bg-primary/10 p-1 mt-0.5"},$e={class:"flex items-start gap-3"},je={class:"rounded-full bg-primary/10 p-1 mt-0.5"},ze={class:"flex flex-col sm:flex-row gap-3"},De={key:1,class:"space-y-6"},Te={class:"bg-muted p-4 rounded-lg"},Fe={class:"space-y-2"},Ne={class:"flex justify-between items-center"},Se={class:"font-medium"},Ve={class:"flex justify-between items-center"},Ae={class:"font-medium"},Me={class:"flex justify-between items-center"},Be={class:"font-medium"},Ee={class:"flex justify-between items-center"},Pe={class:"font-medium"},Ue={class:"flex flex-col sm:flex-row gap-3"},Oe={class:"bg-muted p-4 rounded-lg mb-6"},Le={class:"space-y-1 text-sm"},Ke={class:"space-y-3"},Re={key:0,class:"space-y-2"},Ge={class:"flex justify-between text-sm text-muted-foreground"},Ie={class:"flex items-center gap-2"},We={class:"text-sm text-muted-foreground"},Xe={key:1,class:"space-y-2"},qe={class:"flex items-center gap-2 flex-1 min-w-0"},Je={class:"min-w-0"},Qe={class:"text-sm truncate"},He={class:"text-xs text-muted-foreground"},Ye={class:"list-disc list-inside"},Ze={class:"flex gap-3"},P=5,et=10*1024*1024,Nt=ee({__name:"UpdateDataForm",props:{verification:{},user:{}},setup(X){const x=X,U=s=>s?s.split(" ").map(i=>{if(i.length<=2)return i;const r=i.substring(0,2),f="*".repeat(i.length-2);return r+f}).join(" "):"",O=s=>{if(!s)return"";const[e,i]=s.split("@");if(!i)return s;const[r,...f]=i.split("."),h=f.join(".");let c;if(e.length<=3)c=e;else{const p=e.substring(0,2),w=e.substring(e.length-1),Z="*".repeat(e.length-3);c=p+Z+w}const A=r[0]+"*".repeat(r.length-1);return`${c}@${A}.${h}`},L=s=>{if(!s)return"";if(s.length<=6)return s;const e=s.substring(0,5),i=s.substring(s.length-1),r="*".repeat(s.length-6);return e+r+i},y=b(!1),C=b(!x.verification.is_verified),V=b(!1),u=b({email:x.user.email||"",telefono:x.user.telefono||""}),v=b([]),_=b([]),z=b(0),$=b(!1),q=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg"],K=["pdf","doc","docx","png","jpg","jpeg"],J=s=>{var r;const e=s.target,i=Array.from(e.files||[]);if(_.value=[],v.value.length+i.length>P){_.value.push(`Máximo ${P} archivos permitidos`);return}for(const f of i){if(f.size>et){_.value.push(`${f.name} excede el tamaño máximo de 10MB`);continue}const h=(r=f.name.split(".").pop())==null?void 0:r.toLowerCase();if(!q.includes(f.type)&&(!h||!K.includes(h))){_.value.push(`${f.name} tiene un formato no permitido`);continue}v.value.push(f)}e.value=""},Q=s=>{v.value.splice(s,1),_.value=[]},H=s=>{if(s===0)return"0 Bytes";const e=1024,i=["Bytes","KB","MB"],r=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,r)*100)/100+" "+i[r]},Y=async()=>{var i,r,f,h;if(v.value.length===0){j.error("Por favor adjunta al menos un documento de soporte");return}const s=u.value.email&&u.value.email!==x.user.email,e=u.value.telefono&&u.value.telefono!==x.user.telefono;if(!s&&!e&&v.value.length===0){j.error("No se detectaron cambios para actualizar");return}if(u.value.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.value.email)){j.error("Por favor ingresa un email válido");return}y.value=!0,$.value=!0,z.value=0;try{const c=new FormData;c.append("verification_id",x.verification.id.toString()),u.value.email&&u.value.email!==x.user.email&&c.append("email",u.value.email),u.value.telefono&&u.value.telefono!==x.user.telefono&&c.append("telefono",u.value.telefono),v.value.forEach((p,w)=>{c.append(`documentos[${w}]`,p)}),(await ae.post("/confirmar-registro/actualizar-datos",c,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:p=>{const w=p.total?Math.round(p.loaded*100/p.total):0;z.value=w}})).data.success&&(j.success("Solicitud enviada correctamente",{description:"Te notificaremos cuando sea procesada"}),V.value=!0,C.value=!1)}catch(c){const A=((r=(i=c.response)==null?void 0:i.data)==null?void 0:r.message)||"Error al enviar la solicitud",p=(h=(f=c.response)==null?void 0:f.data)==null?void 0:h.errors;p&&Array.isArray(p)?p.forEach(w=>j.error(w)):j.error(A)}finally{y.value=!1,$.value=!1,z.value=0}},E=()=>{window.location.href="/confirmar-registro"};return(s,e)=>(m(),g(M,null,[a(o(te),{title:"Actualizar Datos"}),a(ie,{title:"Actualizar Datos de Contacto",description:s.verification.is_verified?"Tu identidad ha sido verificada. Puedes actualizar tus datos.":"Actualiza tus datos adjuntando documentación de soporte."},{default:l(()=>[t("div",xe,[a(o(le),{class:"shadow-lg"},{default:l(()=>[a(o(ne),null,{default:l(()=>[a(o(re),{class:"flex items-center gap-2"},{default:l(()=>[n(d(V.value?"✅ Solicitud Enviada":s.verification.is_verified&&!C.value?"✅ Identidad Verificada":"📝 Actualización de Datos"),1)]),_:1}),a(o(ue),null,{default:l(()=>[n(d(V.value?"Tu solicitud ha sido recibida exitosamente":s.verification.is_verified&&!C.value?"Tu identidad ha sido confirmada exitosamente":"Actualiza tu información de contacto para mantener tus datos al día"),1)]),_:1})]),_:1}),a(o(de),null,{default:l(()=>[V.value?(m(),g("div",be,[a(o(F),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:l(()=>[a(o(S),{class:"h-4 w-4 text-green-600 dark:text-green-400"}),a(o(N),{class:"text-green-800 dark:text-green-200"},{default:l(()=>[...e[5]||(e[5]=[t("strong",null,"¡Solicitud enviada exitosamente!",-1),t("br",null,null,-1),n(" Tu solicitud de actualización de datos ha sido enviada correctamente. ",-1)])]),_:1})]),_:1}),t("div",ye,[e[9]||(e[9]=t("h3",{class:"font-semibold mb-3 text-lg"},"¿Qué sigue ahora?",-1)),t("div",_e,[t("div",he,[t("div",we,[a(o(S),{class:"h-4 w-4 text-primary"})]),e[6]||(e[6]=t("div",null,[t("p",{class:"font-medium"},"Revisión administrativa"),t("p",{class:"text-sm text-muted-foreground"},"Tu solicitud será revisada por un administrador")],-1))]),t("div",ke,[t("div",Ce,[a(o(S),{class:"h-4 w-4 text-primary"})]),e[7]||(e[7]=t("div",null,[t("p",{class:"font-medium"},"Notificación por email y WhatsApp"),t("p",{class:"text-sm text-muted-foreground"},"Te informaremos cuando tu solicitud sea procesada")],-1))]),t("div",$e,[t("div",je,[a(o(S),{class:"h-4 w-4 text-primary"})]),e[8]||(e[8]=t("div",null,[t("p",{class:"font-medium"},"Actualización de datos"),t("p",{class:"text-sm text-muted-foreground"},"Si es aprobada, tus datos serán actualizados automáticamente")],-1))])])]),t("div",ze,[a(o(k),{onClick:E,type:"button",variant:"default",class:"flex-1"},{default:l(()=>[...e[10]||(e[10]=[n(" Volver al inicio ",-1)])]),_:1})])])):s.verification.is_verified&&!C.value?(m(),g("div",De,[a(o(F),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:l(()=>[a(o(S),{class:"h-4 w-4 text-green-600 dark:text-green-400"}),a(o(N),{class:"text-green-800 dark:text-green-200"},{default:l(()=>[...e[11]||(e[11]=[t("strong",null,"¡Verificación exitosa!",-1),t("br",null,null,-1),n(" Tu identidad ha sido confirmada correctamente. ",-1)])]),_:1})]),_:1}),t("div",Te,[e[16]||(e[16]=t("h3",{class:"font-semibold mb-3 text-lg"},"Datos Verificados",-1)),t("div",Fe,[t("p",Ne,[e[12]||(e[12]=t("span",{class:"text-muted-foreground"},"Nombre:",-1)),t("span",Se,d(U(s.user.name)),1)]),t("p",Ve,[e[13]||(e[13]=t("span",{class:"text-muted-foreground"},"Documento:",-1)),t("span",Ae,d(s.user.documento_identidad),1)]),t("p",Me,[e[14]||(e[14]=t("span",{class:"text-muted-foreground"},"Email:",-1)),t("span",Be,d(s.user.email?O(s.user.email):"No registrado"),1)]),t("p",Ee,[e[15]||(e[15]=t("span",{class:"text-muted-foreground"},"Teléfono:",-1)),t("span",Pe,d(s.user.telefono?L(s.user.telefono):"No registrado"),1)])])]),t("div",Ue,[a(o(k),{onClick:e[0]||(e[0]=i=>C.value=!0),type:"button",variant:"outline",class:"flex-1"},{default:l(()=>[...e[17]||(e[17]=[n(" ¿Deseas actualizar datos? ",-1)])]),_:1}),a(o(k),{onClick:E,type:"button",variant:"default",class:"flex-1"},{default:l(()=>[...e[18]||(e[18]=[n(" Finalizar ",-1)])]),_:1})])])):(m(),g(M,{key:2},[t("div",Oe,[e[23]||(e[23]=t("h3",{class:"font-semibold mb-2"},"Datos Actuales",-1)),t("div",Le,[t("p",null,[e[19]||(e[19]=t("strong",null,"Nombre:",-1)),n(" "+d(U(s.user.name)),1)]),t("p",null,[e[20]||(e[20]=t("strong",null,"Documento:",-1)),n(" "+d(s.user.documento_identidad),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"Email:",-1)),n(" "+d(s.user.email?O(s.user.email):"No registrado"),1)]),t("p",null,[e[22]||(e[22]=t("strong",null,"Teléfono:",-1)),n(" "+d(s.user.telefono?L(s.user.telefono):"No registrado"),1)])])]),t("form",{onSubmit:R(Y,["prevent"]),class:"space-y-6"},[t("div",null,[a(o(B),{for:"email"},{default:l(()=>[...e[24]||(e[24]=[n("Nuevo Email",-1)])]),_:1}),a(o(I),{id:"email",modelValue:u.value.email,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value.email=i),type:"email",placeholder:s.user.email||"ejemplo@correo.com",class:"mt-1"},null,8,["modelValue","placeholder"]),e[25]||(e[25]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Deja vacío si no deseas cambiar el email ",-1))]),t("div",null,[a(o(B),{for:"telefono"},{default:l(()=>[...e[26]||(e[26]=[n("Nuevo Teléfono",-1)])]),_:1}),a(o(me),{id:"telefono",modelValue:u.value.telefono,"onUpdate:modelValue":e[2]||(e[2]=i=>u.value.telefono=i),"default-country":"CO",placeholder:s.user.telefono||"300 123 4567",class:"mt-1",onKeydown:e[3]||(e[3]=se(R(()=>{},["prevent"]),["enter"]))},null,8,["modelValue","placeholder"]),e[27]||(e[27]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Deja vacío si no deseas cambiar el teléfono ",-1))]),t("div",null,[a(o(B),null,{default:l(()=>[...e[28]||(e[28]=[n("Documentos de Soporte ",-1),t("span",{class:"text-red-500"},"*",-1),n(" (Obligatorio)",-1)])]),_:1}),e[32]||(e[32]=t("p",{class:"text-sm text-muted-foreground mb-2"}," Debes adjuntar al menos un documento de identidad o comprobante para validar la actualización ",-1)),t("div",Ke,[$.value?(m(),g("div",Re,[t("div",Ge,[e[29]||(e[29]=t("span",null,"Subiendo archivos...",-1)),t("span",null,d(z.value)+"%",1)]),a(o(fe),{value:z.value,class:"w-full"},null,8,["value"])])):D("",!0),t("div",Ie,[a(o(I),{type:"file",onChange:J,accept:K.map(i=>`.${i}`).join(","),multiple:"",disabled:$.value,class:"hidden",id:"file-input"},null,8,["accept","disabled"]),a(o(B),{for:"file-input",class:oe(["inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background h-10 px-4 py-2",$.value?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-accent hover:text-accent-foreground"])},{default:l(()=>[a(o(ce),{class:"mr-2 h-4 w-4"}),n(" "+d($.value?"Subiendo...":"Seleccionar archivos"),1)]),_:1},8,["class"]),t("span",We,d(v.value.length)+"/"+d(P)+" archivos ",1)]),v.value.length>0?(m(),g("div",Xe,[(m(!0),g(M,null,G(v.value,(i,r)=>(m(),g("div",{key:r,class:"flex items-center justify-between p-2 bg-muted rounded-md"},[t("div",qe,[a(o(pe),{class:"h-4 w-4 text-muted-foreground flex-shrink-0"}),t("div",Je,[t("p",Qe,d(i.name),1),t("p",He,d(H(i.size)),1)])]),a(o(k),{onClick:f=>Q(r),type:"button",variant:"ghost",size:"sm",class:"h-8 w-8 p-0"},{default:l(()=>[a(o(ve),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]))),128))])):D("",!0),_.value.length>0?(m(),T(o(F),{key:2,variant:"destructive"},{default:l(()=>[a(o(W),{class:"h-4 w-4"}),a(o(N),null,{default:l(()=>[t("ul",Ye,[(m(!0),g(M,null,G(_.value,i=>(m(),g("li",{key:i},d(i),1))),128))])]),_:1})]),_:1})):D("",!0),v.value.length===0?(m(),T(o(F),{key:3,variant:"default",class:"border-orange-200 bg-orange-50 dark:bg-orange-900/20"},{default:l(()=>[a(o(W),{class:"h-4 w-4 text-orange-600"}),a(o(N),{class:"text-orange-800 dark:text-orange-200"},{default:l(()=>[...e[30]||(e[30]=[t("strong",null,"Importante:",-1),n(" Debes adjuntar al menos un documento para procesar tu solicitud. ",-1)])]),_:1})]),_:1})):D("",!0),e[31]||(e[31]=t("p",{class:"text-xs text-muted-foreground"}," Formatos permitidos: PDF, DOC, DOCX, PNG, JPG. Máximo 10MB por archivo. ",-1))])]),a(o(F),null,{default:l(()=>[a(o(N),{class:"text-foreground"},{default:l(()=>[...e[33]||(e[33]=[n(" Tu solicitud será revisada por un administrador. Recibirás una notificación por email y WhatsApp cuando sea procesada. ",-1)])]),_:1})]),_:1}),t("div",Ze,[a(o(k),{type:"submit",disabled:y.value,class:"flex-1"},{default:l(()=>[y.value?(m(),T(o(ge),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):D("",!0),n(" "+d(y.value?"Enviando...":"Enviar Solicitud"),1)]),_:1},8,["disabled"]),s.verification.is_verified?(m(),T(o(k),{key:0,onClick:e[4]||(e[4]=i=>C.value=!1),type:"button",variant:"outline",disabled:y.value},{default:l(()=>[...e[34]||(e[34]=[n(" Volver ",-1)])]),_:1},8,["disabled"])):(m(),T(o(k),{key:1,onClick:E,type:"button",variant:"outline",disabled:y.value},{default:l(()=>[...e[35]||(e[35]=[n(" Cancelar ",-1)])]),_:1},8,["disabled"]))])],32)],64))]),_:1})]),_:1})])]),_:1},8,["description"])],64))}});export{Nt as default};
