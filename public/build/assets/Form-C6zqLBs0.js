import{d as me,k as B,c as C,w as le,p as Me,a as m,o as d,j as $,i as h,f as t,e as u,b as s,u as e,g as v,t as p,F as E,r as N,q as Xe,n as w,P as Ze,C as Ie,x as ea,m as aa,W as ta,h as sa,ad as ra,y as ia,bJ as oa,a9 as la,ac as da}from"./app-DItX2zhq.js";import{_ as Z}from"./createLucideIcon-CviqBos0.js";import{_ as R,a as G,c as Y,b as de}from"./CardTitle.vue_vue_type_script_setup_true_lang-BBY3VA40.js";import{_ as na}from"./Checkbox.vue_vue_type_script_setup_true_lang-DkMabsri.js";import{_ as O,a as ie}from"./Label.vue_vue_type_script_setup_true_lang-BLFZUZ5f.js";import{_ as ua}from"./Progress.vue_vue_type_script_setup_true_lang-DC9O2kc2.js";import{_ as ca,a as fa,b as ma,c as pa,d as _a}from"./SelectValue.vue_vue_type_script_setup_true_lang-ChQ46kcI.js";import{_ as ga}from"./Textarea.vue_vue_type_script_setup_true_lang-C21PZyQ9.js";import{u as ba,a as va,_ as xa,b as ya,c as ha,d as ka}from"./useConditionalFields-Co8vDRjG.js";import{C as T,_ as ee}from"./index-km6xCIYg.js";import{_ as ne}from"./CardDescription.vue_vue_type_script_setup_true_lang-DAnUAWKH.js";import{_ as $a,a as Le}from"./RadioGroupItem.vue_vue_type_script_setup_true_lang-7TS-W6II.js";import{a as ue,_ as ce}from"./index-1yxIfjNv.js";import{_ as fe}from"./AlertTitle.vue_vue_type_script_setup_true_lang-DlAODsOu.js";import{M as I,B as Ca,q as wa,_ as Va}from"./AppLayout.vue_vue_type_script_setup_true_lang-vkCaAvM3.js";import{C as M,U as Sa}from"./DialogTitle.vue_vue_type_script_setup_true_lang-g_plKu7b.js";import{E as Ea}from"./external-link-BuuEWJis.js";import{u as Aa}from"./useAutoSave-DKNgH7rN.js";import{t as V}from"./index-BG_CICwf.js";import{A as Ua}from"./arrow-left-B1b-bKN8.js";import{C as oe}from"./clock-CbMi1JGM.js";import{C as Oe}from"./circle-check-big-ixpocSzC.js";import{U as Fa}from"./user-Dk0L19AV.js";import{S as qa}from"./save-DpT3dP4F.js";import{_ as Ba}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Br5DeLJK.js";import"./check-B0GmKO8q.js";import"./VisuallyHidden-DozJCIER.js";import"./upload-3HtBGLDI.js";import"./eye-D5JZb8la.js";import"./download-DRkeA8Z7.js";import"./plus-D8mD3NNZ.js";import"./grip-vertical-KjM-7apQ.js";import"./trash-2-CPEQAdjA.js";import"./RovingFocusItem-CpKZsTCm.js";import"./utils-ecv6M36q.js";import"./VisuallyHiddenInput-CRKMCel_.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-GChdzzfG.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DwDNM_x7.js";const Pa={class:"space-y-4"},za={key:0,class:"text-center py-8"},Da={key:2,class:"space-y-6"},Na={key:0},Ta={class:"text-sm font-medium text-muted-foreground mb-3"},ja={class:"space-y-3"},La={class:"flex items-start gap-3"},Oa={class:"flex-1"},Ma={class:"flex items-center justify-between"},Ra={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Ga={class:"flex items-center gap-2 text-muted-foreground"},Ya={class:"flex items-center gap-2 text-muted-foreground"},Wa={class:"flex items-center gap-2 text-muted-foreground"},Ha={key:0,class:"flex items-center gap-2 text-muted-foreground"},Ja={class:"mt-3 text-xs text-muted-foreground"},Ka={key:1},Qa={class:"text-sm font-medium text-muted-foreground mb-3"},Xa={class:"space-y-3"},Za={class:"flex items-start gap-3"},Ia={class:"flex-1"},et={class:"flex items-center justify-between"},at={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},tt={class:"flex items-center gap-2 text-muted-foreground"},st={class:"flex items-center gap-2 text-muted-foreground"},rt={class:"flex items-center gap-2 text-muted-foreground"},it={class:"mt-3 text-xs text-muted-foreground"},ot={key:4,class:"mt-4 p-3 bg-muted/50 rounded-lg"},lt={class:"text-sm text-muted-foreground"},dt=me({__name:"ConvocatoriaSelector",props:{modelValue:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filtrarPorUbicacion:{type:Boolean,default:!0},showPostulacionWarning:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(j,{emit:n}){var D;const U=j,P=n,k=B([]),z=B(!1),o=B(null),_=B((D=U.modelValue)==null?void 0:D.toString()),W=async()=>{z.value=!0,o.value=null;try{const x=await Xe.get("/api/convocatorias/disponibles",{params:{filtrar_ubicacion:U.filtrarPorUbicacion,incluir_futuras:!0}});k.value=x.data}catch(x){o.value="Error al cargar las convocatorias disponibles",console.error("Error cargando convocatorias:",x)}finally{z.value=!1}},S=C(()=>{const x={abiertas:[],futuras:[]};return k.value.forEach(y=>{y.estado_temporal==="abierta"?x.abiertas.push(y):y.estado_temporal==="futura"&&x.futuras.push(y)}),x}),H=C(()=>k.value.find(x=>x.id===Number(_.value)));le(_,x=>{P("update:modelValue",x?Number(x):void 0)}),le(()=>U.modelValue,x=>{_.value=x==null?void 0:x.toString()});const J=x=>new Date(x).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=x=>{switch(x){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},K=x=>{switch(x){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}};return Me(()=>{W()}),(x,y)=>(d(),m("div",Pa,[z.value?(d(),m("div",za,y[1]||(y[1]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},null,-1),t("p",{class:"mt-2 text-sm text-muted-foreground"},"Cargando convocatorias disponibles...",-1)]))):o.value?(d(),$(e(ce),{key:1,variant:"destructive"},{default:u(()=>[s(e(T),{class:"h-4 w-4"}),s(e(fe),null,{default:u(()=>y[2]||(y[2]=[v("Error")])),_:1}),s(e(ue),null,{default:u(()=>[v(p(o.value),1)]),_:1})]),_:1})):k.value.length>0?(d(),m("div",Da,[s(e($a),{modelValue:_.value,"onUpdate:modelValue":y[0]||(y[0]=g=>_.value=g),disabled:x.disabled},{default:u(()=>[S.value.abiertas.length>0?(d(),m("div",Na,[t("h4",Ta," Convocatorias Abiertas ("+p(S.value.abiertas.length)+") ",1),t("div",ja,[(d(!0),m(E,null,N(S.value.abiertas,g=>(d(),$(e(R),{key:g.id,class:w(["cursor-pointer hover:shadow-md transition-all duration-200",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":_.value===g.id.toString(),"hover:bg-muted/50":_.value!==g.id.toString()}]),onClick:ae=>_.value=g.id.toString()},{default:u(()=>[s(e(G),{class:"pb-3"},{default:u(()=>[t("div",La,[s(e(Le),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),t("div",Oa,[t("div",Ma,[s(e(O),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:u(()=>[v(p(g.nombre),1)]),_:2},1032,["for"]),s(e(ee),{class:w(F(g.estado_temporal))},{default:u(()=>[v(p(K(g.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(ne),{class:"mt-1"},{default:u(()=>[v(p(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(Y),{class:"pt-0"},{default:u(()=>[t("div",Ra,[t("div",Ga,[s(e(I),{class:"h-4 w-4"}),t("span",null,p(g.cargo.nombre),1)]),t("div",Ya,[s(e(M),{class:"h-4 w-4"}),t("span",null,p(g.periodo_electoral.nombre),1)]),t("div",Wa,[s(e(I),{class:"h-4 w-4"}),t("span",null,p(g.ubicacion),1)]),g.numero_postulaciones!==void 0?(d(),m("div",Ha,[s(e(Sa),{class:"h-4 w-4"}),t("span",null,p(g.numero_postulaciones)+" postulaciones",1)])):h("",!0)]),t("div",Ja,[y[3]||(y[3]=t("span",{class:"font-medium"},"Cierre:",-1)),v(" "+p(J(g.fecha_cierre)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):h("",!0),S.value.futuras.length>0?(d(),m("div",Ka,[t("h4",Qa," Próximas Convocatorias ("+p(S.value.futuras.length)+") ",1),t("div",Xa,[(d(!0),m(E,null,N(S.value.futuras,g=>(d(),$(e(R),{key:g.id,class:w(["cursor-pointer hover:shadow-md transition-all duration-200 opacity-90",{"ring-2 ring-primary bg-primary/5 dark:bg-primary/10":_.value===g.id.toString(),"hover:bg-muted/50":_.value!==g.id.toString()}]),onClick:ae=>_.value=g.id.toString()},{default:u(()=>[s(e(G),{class:"pb-3"},{default:u(()=>[t("div",Za,[s(e(Le),{value:g.id.toString(),id:`conv-${g.id}`},null,8,["value","id"]),t("div",Ia,[t("div",et,[s(e(O),{for:`conv-${g.id}`,class:"text-base font-semibold cursor-pointer"},{default:u(()=>[v(p(g.nombre),1)]),_:2},1032,["for"]),s(e(ee),{class:w(F(g.estado_temporal))},{default:u(()=>[v(p(K(g.estado_temporal)),1)]),_:2},1032,["class"])]),s(e(ne),{class:"mt-1"},{default:u(()=>[v(p(g.descripcion),1)]),_:2},1024)])])]),_:2},1024),s(e(Y),{class:"pt-0"},{default:u(()=>[t("div",at,[t("div",tt,[s(e(I),{class:"h-4 w-4"}),t("span",null,p(g.cargo.nombre),1)]),t("div",st,[s(e(M),{class:"h-4 w-4"}),t("span",null,p(g.periodo_electoral.nombre),1)]),t("div",rt,[s(e(I),{class:"h-4 w-4"}),t("span",null,p(g.ubicacion),1)])]),t("div",it,[y[4]||(y[4]=t("span",{class:"font-medium"},"Apertura:",-1)),v(" "+p(J(g.fecha_apertura)),1)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):h("",!0)]),_:1},8,["modelValue","disabled"])])):(d(),$(e(ce),{key:3},{default:u(()=>[s(e(T),{class:"h-4 w-4"}),s(e(fe),null,{default:u(()=>y[5]||(y[5]=[v("Sin convocatorias disponibles")])),_:1}),s(e(ue),null,{default:u(()=>y[6]||(y[6]=[v(" No hay convocatorias disponibles en este momento para tu ubicación. Por favor, intenta más tarde o contacta al administrador. ")])),_:1})]),_:1})),H.value&&!x.disabled?(d(),m("div",ot,[y[7]||(y[7]=t("p",{class:"text-sm font-medium"},"Convocatoria seleccionada:",-1)),t("p",lt,p(H.value.nombre),1)])):h("",!0)]))}}),nt={class:"space-y-4"},ut={class:"mt-2"},ct={class:"flex items-start justify-between"},ft={class:"space-y-1"},mt={class:"flex gap-2"},pt={class:"flex items-start gap-2"},_t={class:"text-sm"},gt={class:"font-medium text-gray-900 ml-1"},bt={class:"flex items-start gap-2"},vt={class:"text-sm"},xt={class:"font-medium text-gray-900 ml-1"},yt={class:"flex items-start gap-2"},ht={class:"text-sm"},kt={class:"font-medium text-gray-900 ml-1"},$t={key:0,class:"flex items-start gap-2"},Ct={class:"text-sm"},wt={class:"font-medium text-gray-900 ml-1"},Vt=me({__name:"ConvocatoriaSeleccionada",props:{postulacion:{}},setup(j){const n=j,U=o=>{switch(o){case"abierta":return"bg-green-100 text-green-800";case"futura":return"bg-blue-100 text-blue-800";case"cerrada":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},P=o=>{switch(o){case"abierta":return"Abierta";case"futura":return"Próxima";case"cerrada":return"Cerrada";default:return"Borrador"}},k=o=>{switch(o){case"enviada":return"bg-yellow-100 text-yellow-800";case"en_revision":return"bg-blue-100 text-blue-800";case"aceptada":return"bg-green-100 text-green-800";case"rechazada":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},z=o=>{switch(o){case"enviada":return"Enviada";case"en_revision":return"En revisión";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";default:return o}};return(o,_)=>(d(),m("div",nt,[s(e(ce),{class:"border-blue-200 bg-blue-50"},{default:u(()=>[s(e(T),{class:"h-4 w-4 text-blue-600"}),s(e(fe),{class:"text-blue-900"},{default:u(()=>_[0]||(_[0]=[v("Convocatoria ya seleccionada")])),_:1}),s(e(ue),{class:"text-blue-800"},{default:u(()=>[_[6]||(_[6]=t("p",null,"Ya has elegido una convocatoria para tu candidatura. La información de tu postulación se muestra a continuación.",-1)),t("p",ut,[_[2]||(_[2]=v(" Si deseas postularte a un cargo distinto, por favor ve al ")),s(e(Ze),{href:o.route("postulaciones.index"),class:"font-semibold underline hover:text-blue-900 inline-flex items-center gap-1"},{default:u(()=>[_[1]||(_[1]=v(" menú de Postulaciones ")),s(e(Ea),{class:"h-3 w-3"})]),_:1},8,["href"]),_[3]||(_[3]=v(". Si necesitas ayuda, escríbenos a: ")),_[4]||(_[4]=t("b",null,"soporte@colombiahumana.co",-1)),_[5]||(_[5]=v(". "))])]),_:1})]),_:1}),s(e(R),{class:"border-2 bg-gray-50"},{default:u(()=>[s(e(G),null,{default:u(()=>[t("div",ct,[t("div",ft,[s(e(de),{class:"text-lg"},{default:u(()=>[v(p(n.postulacion.convocatoria.nombre),1)]),_:1}),s(e(ne),{class:"text-sm"},{default:u(()=>_[7]||(_[7]=[v(" Convocatoria seleccionada en tu candidatura ")])),_:1})]),t("div",mt,[s(e(ee),{class:w([U(n.postulacion.convocatoria.estado_temporal),"text-xs"])},{default:u(()=>[v(p(P(n.postulacion.convocatoria.estado_temporal)),1)]),_:1},8,["class"]),s(e(ee),{class:w([k(n.postulacion.estado),"text-xs"])},{default:u(()=>[v(" Postulación "+p(z(n.postulacion.estado)),1)]),_:1},8,["class"])])])]),_:1}),s(e(Y),{class:"space-y-3"},{default:u(()=>[t("div",pt,[s(e(Ca),{class:"h-4 w-4 text-gray-500 mt-0.5"}),t("div",_t,[_[8]||(_[8]=t("span",{class:"text-gray-600"},"Cargo:",-1)),t("span",gt,p(n.postulacion.convocatoria.cargo),1)])]),t("div",bt,[s(e(M),{class:"h-4 w-4 text-gray-500 mt-0.5"}),t("div",vt,[_[9]||(_[9]=t("span",{class:"text-gray-600"},"Periodo:",-1)),t("span",xt,p(n.postulacion.convocatoria.periodo),1)])]),t("div",yt,[s(e(M),{class:"h-4 w-4 text-gray-500 mt-0.5"}),t("div",ht,[_[10]||(_[10]=t("span",{class:"text-gray-600"},"Fecha de cierre:",-1)),t("span",kt,p(n.postulacion.convocatoria.fecha_cierre),1)])]),n.postulacion.fecha_postulacion?(d(),m("div",$t,[s(e(M),{class:"h-4 w-4 text-gray-500 mt-0.5"}),t("div",Ct,[_[11]||(_[11]=t("span",{class:"text-gray-600"},"Fecha de tu postulación:",-1)),t("span",wt,p(n.postulacion.fecha_postulacion),1)])])):h("",!0),_[12]||(_[12]=t("div",{class:"border-t pt-3 mt-3"},[t("p",{class:"text-xs text-gray-500"}," Esta convocatoria fue seleccionada cuando creaste tu candidatura. No es posible cambiarla desde este formulario para mantener la integridad de tu postulación y su historial de seguimiento. ")],-1))]),_:1})]),_:1})]))}}),St={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 pb-24"},Et={class:"flex items-center justify-between"},At={class:"text-3xl font-bold"},Ut={class:"text-muted-foreground"},Ft={key:0,class:"flex items-center justify-end gap-2 text-sm text-muted-foreground"},qt={key:0,class:"flex items-center gap-1.5"},Bt={key:1,class:"flex items-center gap-1.5"},Pt={key:2,class:"flex items-center gap-1.5 text-amber-600"},zt={key:3,class:"flex items-center gap-1.5"},Dt={class:"text-blue-700 dark:text-blue-300"},Nt={key:0,class:"p-4 bg-blue-50 border border-blue-200 rounded-lg"},Tt={class:"flex items-start gap-3"},jt={class:"text-sm text-blue-800"},Lt={key:0,class:"mt-1 text-blue-600"},Ot={key:0,class:"text-red-500"},Mt={key:0,class:"text-sm text-muted-foreground"},Rt={key:6,class:"space-y-2"},Gt=["id","name","value","onUpdate:modelValue"],Yt={key:7,class:"space-y-2"},Wt={key:8},Ht={key:9},Jt={key:2,class:"text-red-500 text-sm mt-1"},Kt={key:10},Qt={key:11},Xt={key:12},Zt={key:13,class:"text-sm text-destructive"},It={key:1,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},es={class:"text-red-800 text-sm"},as={key:0,class:"fixed bottom-0 left-0 right-0 z-50 px-2 sm:px-4 pb-2 sm:pb-4"},ts={class:"mx-auto max-w-7xl"},ss={class:"backdrop-blur-lg bg-tertiary-60 dark:bg-gray-900/80 border border-gray-200/50 dark:border-gray-700/50 rounded-xl sm:rounded-2xl shadow-2xl p-3 sm:p-4"},rs={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4"},is={class:"hidden sm:flex items-center"},os={class:"flex-1 sm:max-w-xs lg:max-w-sm mx-0 sm:mx-4"},ls={class:"flex items-center gap-3"},ds={class:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap font-medium"},ns={class:"flex items-center gap-2 sm:gap-3"},us={class:"ml-2 whitespace-nowrap"},cs=me({__name:"Form",props:{candidatura:{},configuracion_campos:{},is_editing:{type:Boolean},postulacion_existente:{}},setup(j){var ge,be;const n=j,U=[{title:"Dashboard",href:"/dashboard"},{title:"Mi Candidatura",href:"/candidaturas"},{title:n.is_editing?"Editar":"Crear",href:"#"}],{uploadFiles:P}=ba(),k=B({});C(()=>{var b;if(!n.is_editing||!((b=n.candidatura)!=null&&b.formulario_data))return!1;const r=Object.keys(n.candidatura.formulario_data),l=n.configuracion_campos.map(a=>a.id),i=r.some(a=>!l.includes(a)),c=n.configuracion_campos.some(a=>a.required&&!n.candidatura.formulario_data[a.id]);return i||c});const o=Ie((()=>{var l;const r={};return n.configuracion_campos.forEach(i=>{i.type==="checkbox"?r[i.id]=[]:i.type==="file"?r[i.id]=[]:i.type==="convocatoria"?r[i.id]=void 0:i.type==="disclaimer"?r[i.id]=null:i.type==="repeater"?r[i.id]=[]:i.type==="datepicker"?r[i.id]=null:r[i.id]=""}),(l=n.candidatura)!=null&&l.formulario_data&&(Object.assign(r,n.candidatura.formulario_data),n.configuracion_campos.forEach(i=>{i.type==="file"&&r[i.id]&&(Array.isArray(r[i.id])||(r[i.id]=[r[i.id]]))})),{formulario_data:r}})()),_=B(n.configuracion_campos),W=C(()=>o.formulario_data),{visibleFields:S,clearHiddenFieldValues:H}=va(_,W);le(S,()=>{H()});const{state:J,isSaving:F,hasSaved:K,hasError:D,saveNow:x,startWatching:y,stopAutoSave:g,restoreDraft:ae,clearLocalStorage:te}=Aa(W,{url:"/candidaturas/autosave",resourceId:((ge=n.candidatura)==null?void 0:ge.id)||null,resourceIdField:"candidatura_id",debounceTime:3e3,showNotifications:!0,useLocalStorage:!0,localStorageKey:`candidatura_draft_${((be=n.candidatura)==null?void 0:be.id)||"new"}`});let L=null;Me(()=>{const r=["borrador","rechazado"];if(!n.candidatura||r.includes(n.candidatura.estado)){if(!n.is_editing){const i=ae();i&&i.formulario_data&&(V.info("Borrador recuperado",{description:"Se encontró un borrador guardado localmente. Se ha restaurado automáticamente.",action:{label:"Descartar",onClick:()=>{te(),o.reset(),V.success("Borrador descartado")}},duration:5e3}),Object.assign(o.formulario_data,i.formulario_data))}L=y()}}),ea(()=>{L&&L(),g()});const Re=async()=>{if(F.value){V.warning("Ya se está guardando...");return}await x(),D.value||V.success("Borrador guardado manualmente")},Ge=C(()=>Q.value.map(i=>{var a;if(!i.required)return{campo:i.id,valid:!0};const c=o.formulario_data[i.id];let b=!1;if(i.type==="checkbox")b=Array.isArray(c)&&c.length>0;else if(i.type==="file")(Array.isArray(c)&&c.length>0||k.value[i.id]&&k.value[i.id].length>0)&&(b=!0);else if(i.type==="convocatoria")b=c!=null&&c!=="";else if(i.type==="disclaimer")b=c&&c.accepted===!0;else if(i.type==="repeater"){const X=((a=i.repeaterConfig)==null?void 0:a.minItems)||0;b=Array.isArray(c)&&c.length>=X}else i.type==="datepicker"?b=c!=null&&c!=="":b=c&&c.toString().trim()!=="";return!b&&i.required,{campo:i.id,valid:b}}).every(i=>i.valid)),se=C(()=>{const r=Q.value.length;let l=0;return Q.value.forEach(i=>{const c=o.formulario_data[i.id];let b=!1;i.type==="checkbox"?b=Array.isArray(c)&&c.length>0:i.type==="file"?b=Array.isArray(c)&&c.length>0||k.value[i.id]&&k.value[i.id].length>0:i.type==="convocatoria"?b=c!=null&&c!=="":i.type==="disclaimer"?b=c&&c.accepted===!0:i.type==="repeater"?b=Array.isArray(c)&&c.length>0:i.type==="datepicker"?b=c!=null&&c!=="":b=c&&c.toString().trim()!=="",b&&l++}),{llenos:l,total:r,porcentaje:r>0?Math.round(l/r*100):0}}),pe=C(()=>n.is_editing?"Editar Candidatura":"Crear Candidatura"),Ye=C(()=>{var r,l;return o.processing?"Guardando...":n.is_editing?((r=n.candidatura)==null?void 0:r.estado)==="rechazado"?"Reenviar Candidatura":((l=n.candidatura)==null?void 0:l.estado)==="aprobado"?"Solicitar Revisión":"Enviar Candidatura":"Crear Candidatura"}),We=C(()=>{var r,l;return!n.is_editing||n.postulacion_existente&&["borrador","rechazado"].includes(((r=n.candidatura)==null?void 0:r.estado)||"")?!1:!!["pendiente","aprobado"].includes(((l=n.candidatura)==null?void 0:l.estado)||"")}),Q=C(()=>{var l;let r=[...S.value];return We.value&&(r=r.filter(i=>i.type!=="convocatoria")),n.is_editing&&((l=n.candidatura)==null?void 0:l.estado)==="aprobado"&&(r=r.filter(i=>i.editable===!0)),r}),He=C(()=>{var i;if(!n.is_editing||!n.candidatura)return!1;let r=!1;if(["pendiente","aprobado"].includes(n.candidatura.estado)&&(r=n.configuracion_campos.some(c=>c.type==="convocatoria")),((i=n.candidatura)==null?void 0:i.estado)==="aprobado"){const c=n.configuracion_campos.some(b=>!b.editable&&b.type!=="convocatoria");return r||c}return r}),A=B({}),Je=async(r,l)=>{if(k.value[r]=l,l&&l.length>0)try{const c=(await P(l,{module:"candidaturas",fieldId:r,onProgress:(b,a)=>{A.value[r]&&A.value[r].uploadProgress.set(b,a)}})).map(b=>b.path);Array.isArray(o.formulario_data[r]),o.formulario_data[r]=c,k.value[r]=[],setTimeout(()=>{A.value[r]&&A.value[r].uploadProgress.clear()},1500),V.success("✅ Archivos subidos correctamente",{duration:2e3})}catch(i){console.error("Error al subir archivos:",i),A.value[r]&&(l.forEach(c=>{A.value[r].uploadErrors.set(c.name,"Error al subir el archivo")}),A.value[r].uploadProgress.clear()),V.error("❌ Error al subir archivos",{description:"Por favor, intente nuevamente",duration:3e3})}else o.formulario_data[r]=[]},_e=async()=>{for(const[l,i]of Object.entries(k.value))if(i&&i.length>0)try{V.info("Subiendo archivos pendientes...",{duration:2e3});const c=await P(i,{module:"candidaturas",fieldId:l});o.formulario_data[l]=c.map(b=>b.path),k.value[l]=[]}catch(c){console.error("Error al subir archivos:",c),V.error("Error al subir archivos pendientes",{description:"No se pudo completar el envío",duration:3e3});return}const r={...o.formulario_data};n.configuracion_campos.forEach(l=>{const i=r[l.id];l.required||(i===""||i===void 0||Array.isArray(i)&&i.length===0&&l.type!=="checkbox"&&l.type!=="file")&&(r[l.id]=null)}),o.formulario_data=r,g(),n.is_editing?o.put(`/candidaturas/${n.candidatura.id}`,{onSuccess:()=>{te(),V.success("Candidatura actualizada exitosamente")},onError:l=>{console.error("Errores de validación:",l),(!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado))&&(L=y())}}):o.post("/candidaturas",{onSuccess:()=>{te(),V.success("Candidatura creada exitosamente")},onError:l=>{console.error("Errores de validación:",l),L=y()}})},q=r=>!!o.errors[`formulario_data.${r}`],Ke=C(()=>!n.candidatura||["borrador","rechazado"].includes(n.candidatura.estado)),Qe=()=>{const r=document.querySelector('[data-sidebar="trigger"]');r&&r.click()};return(r,l)=>(d(),m(E,null,[s(e(aa),{title:pe.value},null,8,["title"]),s(Va,{breadcrumbs:U},{default:u(()=>{var i,c;return[t("div",St,[t("div",Et,[t("div",null,[t("h1",At,p(pe.value),1),t("p",Ut,p(r.is_editing?"Actualiza la información de tu candidatura":"Completa tu perfil de candidatura para participar en convocatorias"),1)]),s(e(Z),{variant:"outline",onClick:l[0]||(l[0]=b=>e(ta).visit("/candidaturas"))},{default:u(()=>[s(e(Ua),{class:"mr-2 h-4 w-4"}),l[1]||(l[1]=v(" Volver "))]),_:1})]),!r.candidatura||["borrador","rechazado"].includes(r.candidatura.estado)?(d(),m("div",Ft,[e(F)?(d(),m("div",qt,[s(e(oe),{class:"h-4 w-4 animate-spin"}),l[2]||(l[2]=t("span",null,"Guardando automáticamente...",-1))])):e(K)&&!e(D)?(d(),m("div",Bt,[s(e(Oe),{class:"h-4 w-4 text-green-600"}),t("span",null,"Guardado automáticamente a las "+p((i=e(J).lastSaved)==null?void 0:i.toLocaleTimeString()),1)])):e(D)?(d(),m("div",Pt,[s(e(T),{class:"h-4 w-4"}),l[3]||(l[3]=t("span",null,"Guardado localmente (sin conexión)",-1))])):(d(),m("div",zt,[s(e(oe),{class:"h-4 w-4"}),l[4]||(l[4]=t("span",null,"Autoguardado activado",-1))]))])):h("",!0),r.is_editing&&((c=r.candidatura)!=null&&c.comentarios_admin)?(d(),$(e(R),{key:1,class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950/20"},{default:u(()=>[s(e(G),null,{default:u(()=>[s(e(de),{class:"text-blue-800 dark:text-blue-200 flex items-center gap-2"},{default:u(()=>[s(e(T),{class:"h-5 w-5"}),l[5]||(l[5]=v(" Comentarios de la comisión "))]),_:1})]),_:1}),s(e(Y),null,{default:u(()=>[t("p",Dt,p(r.candidatura.comentarios_admin),1)]),_:1})]),_:1})):h("",!0),s(e(R),null,{default:u(()=>[s(e(G),null,{default:u(()=>[s(e(de),{class:"flex items-center gap-2"},{default:u(()=>[s(e(Fa),{class:"h-5 w-5"}),l[6]||(l[6]=v(" Información de Candidatura "))]),_:1})]),_:1}),s(e(Y),null,{default:u(()=>{var b;return[t("form",{onSubmit:sa(_e,["prevent"]),class:"space-y-6"},[r.is_editing&&((b=r.candidatura)==null?void 0:b.estado)==="aprobado"?(d(),m("div",Nt,[t("div",Tt,[s(e(T),{class:"h-5 w-5 text-blue-600 mt-0.5"}),t("div",jt,[l[7]||(l[7]=t("p",{class:"font-medium"},"Candidatura Aprobada - Edición Limitada",-1)),l[8]||(l[8]=t("p",{class:"mt-1"},"Solo puedes editar los campos marcados como editables. Al hacer cambios, tu candidatura volverá a revisión administrativa.",-1)),He.value?(d(),m("p",Lt," Algunos campos están ocultos porque no son editables en candidaturas aprobadas o no pueden modificarse después del envío. ")):h("",!0)])])])):h("",!0),s(ra,{name:"fade-field",tag:"div",class:"space-y-6"},{default:u(()=>[(d(!0),m(E,null,N(Q.value,a=>{var X,ve,xe,ye,he,ke,$e,Ce,we,Ve,Se,Ee,Ae,Ue,Fe,qe,Be,Pe,ze,De,Ne,Te;return d(),m("div",{key:a.id,class:"space-y-2"},[s(e(O),{for:a.id,class:"flex items-center gap-1"},{default:u(()=>[v(p(a.title)+" ",1),a.required?(d(),m("span",Ot,"*")):h("",!0)]),_:2},1032,["for"]),a.description?(d(),m("p",Mt,p(a.description),1)):h("",!0),a.type==="text"||a.type==="email"?(d(),$(e(ie),{key:1,id:a.id,type:a.type,modelValue:e(o).formulario_data[a.id],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,placeholder:a.placeholder||"",class:w({"border-destructive":q(a.id)})},null,8,["id","type","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="textarea"?(d(),$(e(ga),{key:2,id:a.id,modelValue:e(o).formulario_data[a.id],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,placeholder:a.placeholder||"",rows:4,class:w({"border-destructive":q(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="number"?(d(),$(e(ie),{key:3,id:a.id,type:"number",modelValue:e(o).formulario_data[a.id],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,placeholder:a.placeholder||"",class:w({"border-destructive":q(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","placeholder","class"])):a.type==="date"?(d(),$(e(ie),{key:4,id:a.id,type:"date",modelValue:e(o).formulario_data[a.id],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,class:w({"border-destructive":q(a.id)})},null,8,["id","modelValue","onUpdate:modelValue","class"])):a.type==="select"?(d(),$(e(ca),{key:5,modelValue:e(o).formulario_data[a.id],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f},{default:u(()=>[s(e(fa),{class:w({"border-destructive":q(a.id)})},{default:u(()=>[s(e(ma),{placeholder:a.placeholder||"Seleccionar..."},null,8,["placeholder"])]),_:2},1032,["class"]),s(e(pa),null,{default:u(()=>[(d(!0),m(E,null,N(a.options,f=>(d(),$(e(_a),{key:f,value:f},{default:u(()=>[v(p(f),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):a.type==="radio"?(d(),m("div",Rt,[(d(!0),m(E,null,N(a.options,f=>(d(),m("div",{key:f,class:"flex items-center space-x-2"},[ia(t("input",{id:`${a.id}_${f}`,name:a.id,type:"radio",value:f,"onUpdate:modelValue":re=>e(o).formulario_data[a.id]=re,class:"h-4 w-4 text-primary focus:ring-primary border-gray-300"},null,8,Gt),[[oa,e(o).formulario_data[a.id]]]),s(e(O),{for:`${a.id}_${f}`,class:"text-sm font-normal"},{default:u(()=>[v(p(f),1)]),_:2},1032,["for"])]))),128))])):a.type==="checkbox"?(d(),m("div",Yt,[(d(!0),m(E,null,N(a.options,f=>(d(),m("div",{key:f,class:"flex items-center space-x-2"},[s(e(na),{id:`${a.id}_${f}`,checked:e(o).formulario_data[a.id].includes(f),"onUpdate:checked":re=>{if(re)e(o).formulario_data[a.id].includes(f)||e(o).formulario_data[a.id].push(f);else{const je=e(o).formulario_data[a.id].indexOf(f);je>-1&&e(o).formulario_data[a.id].splice(je,1)}}},null,8,["id","checked","onUpdate:checked"]),s(e(O),{for:`${a.id}_${f}`,class:"text-sm font-normal"},{default:u(()=>[v(p(f),1)]),_:2},1032,["for"])]))),128))])):a.type==="file"?(d(),m("div",Wt,[s(xa,{ref_for:!0,ref:f=>A.value[a.id]=f,modelValue:e(o).formulario_data[a.id],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,onFilesSelected:f=>Je(a.id,f),label:"",description:"",required:a.required,multiple:((X=a.fileConfig)==null?void 0:X.multiple)||!1,"max-files":((ve=a.fileConfig)==null?void 0:ve.maxFiles)||5,"max-file-size":((xe=a.fileConfig)==null?void 0:xe.maxFileSize)||10,accept:((ye=a.fileConfig)==null?void 0:ye.accept)||".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif",error:e(o).errors[`formulario_data.${a.id}`],disabled:e(o).processing,module:"candidaturas","field-id":a.id,"auto-upload":!1},null,8,["modelValue","onUpdate:modelValue","onFilesSelected","required","multiple","max-files","max-file-size","accept","error","disabled","field-id"])])):a.type==="convocatoria"?(d(),m("div",Ht,[r.postulacion_existente&&["borrador","rechazado"].includes(((he=r.candidatura)==null?void 0:he.estado)||"")?(d(),$(Vt,{key:0,postulacion:r.postulacion_existente},null,8,["postulacion"])):(d(),$(dt,{key:1,modelValue:e(o).formulario_data[a.id],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,required:a.required,disabled:e(o).processing||r.is_editing&&((ke=r.candidatura)==null?void 0:ke.estado)!=="borrador","filtrar-por-ubicacion":(($e=a.convocatoriaConfig)==null?void 0:$e.filtrarPorUbicacion)??!0,"show-postulacion-warning":!0},null,8,["modelValue","onUpdate:modelValue","required","disabled","filtrar-por-ubicacion"])),q(a.id)&&!r.postulacion_existente?(d(),m("div",Jt,p(e(o).errors[`formulario_data.${a.id}`]),1)):h("",!0)])):a.type==="datepicker"?(d(),m("div",Kt,[s(ya,{"model-value":e(o).formulario_data[a.id]||null,"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(o).processing,error:e(o).errors[`formulario_data.${a.id}`],"min-date":(Ce=a.datepickerConfig)==null?void 0:Ce.minDate,"max-date":(we=a.datepickerConfig)==null?void 0:we.maxDate,format:((Ve=a.datepickerConfig)==null?void 0:Ve.format)||"DD/MM/YYYY","allow-past-dates":((Se=a.datepickerConfig)==null?void 0:Se.allowPastDates)??!0,"allow-future-dates":((Ee=a.datepickerConfig)==null?void 0:Ee.allowFutureDates)??!0},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-date","max-date","format","allow-past-dates","allow-future-dates"])])):a.type==="disclaimer"?(d(),m("div",Qt,[s(ha,{"model-value":e(o).formulario_data[a.id]||null,"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(o).processing,error:e(o).errors[`formulario_data.${a.id}`],"disclaimer-text":((Ae=a.disclaimerConfig)==null?void 0:Ae.disclaimerText)||"","modal-title":((Ue=a.disclaimerConfig)==null?void 0:Ue.modalTitle)||"Términos y Condiciones","accept-button-text":((Fe=a.disclaimerConfig)==null?void 0:Fe.acceptButtonText)||"Acepto","decline-button-text":((qe=a.disclaimerConfig)==null?void 0:qe.declineButtonText)||"No acepto"},null,8,["model-value","onUpdate:modelValue","required","disabled","error","disclaimer-text","modal-title","accept-button-text","decline-button-text"])])):a.type==="repeater"?(d(),m("div",Xt,[s(ka,{"model-value":e(o).formulario_data[a.id]||[],"onUpdate:modelValue":f=>e(o).formulario_data[a.id]=f,label:"",description:"",required:a.required,disabled:e(o).processing,error:e(o).errors[`formulario_data.${a.id}`],"min-items":((Be=a.repeaterConfig)==null?void 0:Be.minItems)||0,"max-items":((Pe=a.repeaterConfig)==null?void 0:Pe.maxItems)||10,"item-name":((ze=a.repeaterConfig)==null?void 0:ze.itemName)||"Elemento","add-button-text":((De=a.repeaterConfig)==null?void 0:De.addButtonText)||"Agregar elemento","remove-button-text":((Ne=a.repeaterConfig)==null?void 0:Ne.removeButtonText)||"Eliminar",fields:((Te=a.repeaterConfig)==null?void 0:Te.fields)||[]},null,8,["model-value","onUpdate:modelValue","required","disabled","error","min-items","max-items","item-name","add-button-text","remove-button-text","fields"])])):h("",!0),q(a.id)?(d(),m("p",Zt,p(e(o).errors[`formulario_data.${a.id}`]),1)):h("",!0)])}),128))]),_:1}),e(o).errors.general?(d(),m("div",It,[t("p",es,p(e(o).errors.general),1)])):h("",!0),l[9]||(l[9]=t("div",{class:"h-4"},null,-1))],32)]}),_:1})]),_:1})]),(d(),$(la,{to:"body"},[s(da,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"translate-y-4 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-4 opacity-0"},{default:u(()=>[(d(),m("div",as,[t("div",ts,[t("div",ss,[t("div",rs,[t("div",is,[s(e(Z),{variant:"outline",type:"button",onClick:Qe,class:"backdrop-blur-sm flex-shrink-0 text-xs sm:text-sm py-2 px-3"},{default:u(()=>[s(e(wa),{class:"h-4 w-4"}),l[10]||(l[10]=t("span",{class:"ml-2"},"Ocultar sidebar",-1))]),_:1})]),t("div",os,[t("div",ls,[s(e(ua),{modelValue:se.value.porcentaje,class:"flex-1"},null,8,["modelValue"]),t("span",ds,p(se.value.llenos)+" / "+p(se.value.total),1)]),l[11]||(l[11]=t("p",{class:"text-xs text-muted-foreground mt-1 text-center hidden sm:block"}," Campos completados ",-1))]),t("div",ns,[Ke.value?(d(),$(e(Z),{key:0,onClick:Re,disabled:e(F),variant:"outline",class:"backdrop-blur-sm flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:u(()=>[e(F)?(d(),m(E,{key:0},[s(e(oe),{class:"mr-2 h-4 w-4 animate-spin"}),l[12]||(l[12]=v(" Guardando... "))],64)):(d(),m(E,{key:1},[s(e(qa),{class:"mr-2 h-4 w-4"}),l[13]||(l[13]=v(" Guardar borrador "))],64))]),_:1},8,["disabled"])):h("",!0),s(e(Z),{onClick:_e,disabled:!Ge.value||e(o).processing,class:"bg-green-600 hover:bg-green-700 text-white border-green-600 hover:border-green-700 disabled:bg-gray-400 disabled:border-gray-400 flex-1 sm:flex-none text-xs sm:text-sm py-2 px-3"},{default:u(()=>[s(e(Oe),{class:"h-4 w-4"}),t("span",us,p(Ye.value),1)]),_:1},8,["disabled"])])])])])]))]),_:1})]))]}),_:1})],64))}}),Xs=Ba(cs,[["__scopeId","data-v-68c6fdc5"]]);export{Xs as default};
