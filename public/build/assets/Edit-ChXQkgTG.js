import{d as Z,u as K,c as P,b as $,w as a,e as i,g as o,f as e,q as ee,j as S,m,h as r,v as N,l as se,i as c,F as x,k,t as p,s as ie}from"./app-CIcuE56E.js";import{_ as ae}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bb0ye_G3.js";import{_ as y}from"./createLucideIcon-CdUYcD1o.js";import{_ as U,a as j,b as w,c as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-CgX-NJiS.js";import{_ as E}from"./CardDescription.vue_vue_type_script_setup_true_lang-udy3EAmF.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-CShnW6nj.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-DGMiBXqo.js";import{_ as te}from"./Textarea.vue_vue_type_script_setup_true_lang-C_t06qt3.js";import{_ as V}from"./Checkbox.vue_vue_type_script_setup_true_lang-IGtSXI8P.js";import{_ as T}from"./index-DIn4rQoT.js";import{_ as le,a as oe,b as O,c as A}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-C1q_3Xuy.js";import{_ as re}from"./ScrollArea.vue_vue_type_script_setup_true_lang-CFknFn9m.js";import{_ as ne,a as de}from"./index-BPxTTh7P.js";import{_ as me}from"./Switch.vue_vue_type_script_setup_true_lang-BSgEaF3Z.js";import{_ as ue,a as ce,b as pe,c as fe,d as _e}from"./SelectValue.vue_vue_type_script_setup_true_lang-QHc75ruE.js";import{_ as b}from"./InputError.vue_vue_type_script_setup_true_lang-CjI6DKvS.js";import{A as ve}from"./arrow-left-CAuPKZLX.js";import{C as ge}from"./circle-alert-BiONDbyf.js";import{S as be}from"./shield-Dg0q3WaS.js";import{L as xe}from"./lock-D-Sk-zfX.js";import{T as ke}from"./target-CRr5y7c4.js";import{H as ye}from"./house-Y887tQEu.js";import{S as he}from"./save-D19uNPNZ.js";import"./useFlashMessages-DpsFm_CL.js";import"./index-B250FkFy.js";import"./floating-ui.vue-C48tOG4J.js";import"./x-CNguRlJ0.js";import"./index-Di5fzw_s.js";import"./user-B9sngBaC.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Df-DDrQV.js";import"./chevron-right-BWaDAISw.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BovPigfo.js";import"./VisuallyHidden-CcTCNgEU.js";import"./index-BgKm2T5e.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CvyX2iUF.js";import"./index-DnC0IMNf.js";import"./map-pin-DqREaWj1.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-DjXyH0DH.js";import"./chevrons-up-down-Djh8iZFY.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BdwzZaIx.js";import"./users-Dv4PfADe.js";import"./vote-DYetLuDy.js";import"./folder-open-Dk8PHrIL.js";import"./send-bqREL6SY.js";import"./file-text-CXFkIWfL.js";import"./briefcase-fuXoLsil.js";import"./calendar-Cdg04Wl4.js";import"./megaphone-Dt877yPb.js";import"./user-check-BKKK32tP.js";import"./clipboard-list-DU9F4t3E.js";import"./mail-D33S6t7r.js";import"./message-square-Dba9Lr_A.js";import"./external-link-Dm5egPSa.js";import"./panel-left-C_XXmozK.js";import"./check-B-Ov-yXN.js";import"./index-DQp1kWgI.js";import"./RovingFocusItem-C546Q2e5.js";import"./utils-DOVV_t7k.js";import"./VisuallyHiddenInput-BpHYR3dd.js";const Pe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},$e={class:"flex items-center justify-between"},Se={class:"flex gap-2"},Ve={class:"space-y-2"},De={class:"space-y-2"},Ue={class:"space-y-2"},je={class:"space-y-2"},we={class:"flex items-center justify-between"},Ce={class:"space-y-0.5"},Ee={class:"space-y-2"},Oe={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},Ae={class:"flex gap-2 mt-4"},Le={class:"space-y-8"},Re={key:0},Fe={class:"space-y-6 pl-4"},Ge={class:"flex items-center space-x-2 pb-2 border-b"},Ne={class:"grid grid-cols-2 gap-3 pl-6"},ze={key:1},Te={class:"space-y-6 pl-4"},Be={class:"flex items-center space-x-2 pb-2 border-b"},qe={class:"grid grid-cols-2 gap-3 pl-6"},Me={key:0,class:"space-y-3"},He={class:"flex-1"},Ie={class:"text-xs text-muted-foreground mt-1"},Je={key:1,class:"text-center py-8 text-muted-foreground"},Qe={class:"flex justify-end gap-4"},ei=Z({__name:"Edit",props:{role:{},segments:{},availablePermissions:{},selectedSegments:{}},setup(_){const d=_,B=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Editar Rol",href:"#"}],t=K({name:d.role.name,display_name:d.role.display_name,description:d.role.description||"",is_administrative:!!d.role.is_administrative,redirect_after_login:d.role.redirect_after_login||"default",permissions:d.role.permissions||[],segment_ids:d.selectedSegments||[]}),L=[{value:"default",label:"Por defecto (según tipo de rol)"},{value:"admin.dashboard",label:"Dashboard Administrativo",group:"admin"},{value:"admin.candidaturas.dashboard",label:"Dashboard Candidaturas",group:"admin"},{value:"user.dashboard",label:"Dashboard Usuario",group:"user"},{value:"votaciones.index",label:"Votaciones",group:"user"},{value:"asambleas.index",label:"Asambleas",group:"user"},{value:"formularios.index",label:"Formularios",group:"user"},{value:"postulaciones.index",label:"Postulaciones",group:"user"},{value:"admin.otp-dashboard",label:"Dashboard OTP",group:"admin"},{value:"admin.configuracion.index",label:"Configuración",group:"admin"},{value:"admin.users.index",label:"Usuarios",group:"admin"},{value:"admin.roles.index",label:"Roles y Permisos",group:"admin"},{value:"admin.candidaturas.index",label:"Candidaturas (Lista)",group:"admin"}],q=P(()=>t.is_administrative?L:L.filter(n=>n.group!=="admin"||n.value==="default")),h=P(()=>["super_admin","admin","manager","user","end_customer"].includes(d.role.name));P(()=>({...d.availablePermissions.administrative,...d.availablePermissions.frontend}));const D=n=>{const s=d.availablePermissions.administrative[n]||d.availablePermissions.frontend[n];return s?Object.keys(s.permissions).every(u=>t.permissions.includes(u)):!1},R=n=>{const s=d.availablePermissions.administrative[n]||d.availablePermissions.frontend[n];if(!s)return!1;const l=Object.keys(s.permissions),u=l.filter(f=>t.permissions.includes(f)).length;return u>0&&u<l.length},F=n=>{const s=t.permissions.indexOf(n);s>-1?t.permissions.splice(s,1):t.permissions.push(n)},G=n=>{const s=d.availablePermissions.administrative[n]||d.availablePermissions.frontend[n];if(!s)return;const l=Object.keys(s.permissions);D(n)?t.permissions=t.permissions.filter(f=>!l.includes(f)):l.forEach(f=>{t.permissions.includes(f)||t.permissions.push(f)})},M=n=>{const s=t.segment_ids.indexOf(n);s>-1?t.segment_ids.splice(s,1):t.segment_ids.push(n)},H=()=>{t.put(`/admin/roles/${d.role.id}`,{preserveScroll:!0,onSuccess:()=>{}})},I=()=>{confirm(`¿Estás seguro de eliminar el rol "${d.role.display_name}"? Esta acción no se puede deshacer.`)&&ie.delete(`/admin/roles/${d.role.id}`)},J=()=>{const n=[];Object.values(d.availablePermissions.administrative).forEach(s=>{Object.keys(s.permissions).forEach(l=>{n.push(l)})}),Object.values(d.availablePermissions.frontend).forEach(s=>{Object.keys(s.permissions).forEach(l=>{n.push(l)})}),t.permissions=n},Q=()=>{t.permissions=[]},W=P(()=>t.permissions.length),X=P(()=>!h.value);return(n,s)=>(m(),$(ae,{breadcrumbs:B},{default:a(()=>[i(e(ee),{title:"Editar Rol"}),o("div",Pe,[o("div",$e,[s[7]||(s[7]=o("div",null,[o("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Rol"),o("p",{class:"text-muted-foreground"}," Modifica los permisos y configuración del rol ")],-1)),o("div",Se,[X.value?(m(),$(e(y),{key:0,onClick:I,variant:"destructive",type:"button"},{default:a(()=>[...s[5]||(s[5]=[r(" Eliminar Rol ",-1)])]),_:1})):S("",!0),i(e(N),{href:n.route("admin.roles.index")},{default:a(()=>[i(e(y),{variant:"outline"},{default:a(()=>[i(e(ve),{class:"mr-2 h-4 w-4"}),s[6]||(s[6]=r(" Volver ",-1))]),_:1})]),_:1},8,["href"])])]),h.value?(m(),$(e(ne),{key:0},{default:a(()=>[i(e(ge),{class:"h-4 w-4"}),i(e(de),null,{default:a(()=>[...s[8]||(s[8]=[r(" Este es un rol del sistema. Algunas configuraciones pueden estar restringidas. ",-1)])]),_:1})]),_:1})):S("",!0),o("form",{onSubmit:se(H,["prevent"]),class:"space-y-6"},[i(e(le),{defaultValue:"general",class:"space-y-4"},{default:a(()=>[i(e(oe),{class:"grid w-full grid-cols-3"},{default:a(()=>[i(e(O),{value:"general"},{default:a(()=>[i(e(be),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=r(" General ",-1))]),_:1}),i(e(O),{value:"permissions"},{default:a(()=>[i(e(xe),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=r(" Permisos ",-1))]),_:1}),i(e(O),{value:"segments"},{default:a(()=>[i(e(ke),{class:"mr-2 h-4 w-4"}),s[11]||(s[11]=r(" Segmentos ",-1))]),_:1})]),_:1}),i(e(A),{value:"general"},{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>[i(e(w),null,{default:a(()=>[...s[12]||(s[12]=[r("Información General",-1)])]),_:1}),i(e(E),null,{default:a(()=>[...s[13]||(s[13]=[r(" Define el nombre y descripción del rol ",-1)])]),_:1})]),_:1}),i(e(C),{class:"space-y-4"},{default:a(()=>[o("div",Ve,[i(e(v),{htmlFor:"name"},{default:a(()=>[...s[14]||(s[14]=[r("Nombre del Rol (interno)",-1)])]),_:1}),i(e(z),{id:"name",modelValue:e(t).name,"onUpdate:modelValue":s[0]||(s[0]=l=>e(t).name=l),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos",disabled:h.value},null,8,["modelValue","disabled"]),s[15]||(s[15]=o("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),i(b,{message:e(t).errors.name},null,8,["message"])]),o("div",De,[i(e(v),{htmlFor:"display_name"},{default:a(()=>[...s[16]||(s[16]=[r("Nombre a Mostrar",-1)])]),_:1}),i(e(z),{id:"display_name",modelValue:e(t).display_name,"onUpdate:modelValue":s[1]||(s[1]=l=>e(t).display_name=l),placeholder:"Administrador Regional"},null,8,["modelValue"]),i(b,{message:e(t).errors.display_name},null,8,["message"])]),o("div",Ue,[i(e(v),{htmlFor:"description"},{default:a(()=>[...s[17]||(s[17]=[r("Descripción",-1)])]),_:1}),i(e(te),{id:"description",modelValue:e(t).description,"onUpdate:modelValue":s[2]||(s[2]=l=>e(t).description=l),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),i(b,{message:e(t).errors.description},null,8,["message"])]),o("div",je,[o("div",we,[o("div",Ce,[i(e(v),{htmlFor:"is_administrative"},{default:a(()=>[...s[18]||(s[18]=[r("Rol Administrativo",-1)])]),_:1}),s[19]||(s[19]=o("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),i(e(me),{id:"is_administrative",modelValue:e(t).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=l=>e(t).is_administrative=l),disabled:h.value},null,8,["modelValue","disabled"])]),i(b,{message:e(t).errors.is_administrative},null,8,["message"])]),o("div",Ee,[i(e(v),{htmlFor:"redirect_after_login"},{default:a(()=>[i(e(ye),{class:"inline-block h-4 w-4 mr-1"}),s[20]||(s[20]=r(" Página de Inicio Después del Login ",-1))]),_:1}),i(e(ue),{modelValue:e(t).redirect_after_login,"onUpdate:modelValue":s[4]||(s[4]=l=>e(t).redirect_after_login=l),disabled:h.value},{default:a(()=>[i(e(ce),{id:"redirect_after_login"},{default:a(()=>[i(e(pe),{placeholder:"Seleccione la página de destino"})]),_:1}),i(e(fe),null,{default:a(()=>[(m(!0),c(x,null,k(q.value,l=>(m(),$(e(_e),{key:l.value,value:l.value},{default:a(()=>[r(p(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),s[21]||(s[21]=o("p",{class:"text-xs text-muted-foreground"}," Define a qué página se redirigirá al usuario después de autenticarse. Si no se especifica, usará el comportamiento por defecto. ",-1)),i(b,{message:e(t).errors.redirect_after_login},null,8,["message"])]),o("div",Oe,[o("p",null,"ID del Rol: "+p(_.role.id),1),o("p",null,"Creado: "+p(new Date(_.role.created_at).toLocaleDateString()),1),o("p",null,"Última actualización: "+p(new Date(_.role.updated_at).toLocaleDateString()),1)])]),_:1})]),_:1})]),_:1}),i(e(A),{value:"permissions"},{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>[i(e(w),null,{default:a(()=>[...s[22]||(s[22]=[r("Matriz de Permisos",-1)])]),_:1}),i(e(E),null,{default:a(()=>[...s[23]||(s[23]=[r(" Selecciona los permisos que tendrá este rol. Los permisos están organizados en dos secciones: administrativos (acceso al panel admin) y frontend (funciones de usuario). ",-1)])]),_:1}),o("div",Ae,[i(e(y),{type:"button",size:"sm",variant:"outline",onClick:J},{default:a(()=>[...s[24]||(s[24]=[r(" Seleccionar Todos ",-1)])]),_:1}),i(e(y),{type:"button",size:"sm",variant:"outline",onClick:Q},{default:a(()=>[...s[25]||(s[25]=[r(" Limpiar Todos ",-1)])]),_:1}),i(e(T),{variant:"secondary",class:"ml-auto"},{default:a(()=>[r(p(W.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),i(e(C),null,{default:a(()=>[i(e(re),{class:"h-[500px] pr-4"},{default:a(()=>[o("div",Le,[Object.keys(_.availablePermissions.administrative).length>0?(m(),c("div",Re,[s[26]||(s[26]=o("h3",{class:"text-lg font-semibold mb-4 text-orange-600 dark:text-orange-400"}," Permisos Administrativos ",-1)),o("div",Fe,[(m(!0),c(x,null,k(_.availablePermissions.administrative,(l,u)=>(m(),c("div",{key:`admin-${u}`,class:"space-y-3"},[o("div",Ge,[i(e(V),{checked:D(u),indeterminate:R(u),"onUpdate:checked":f=>G(u)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(v),{class:"text-sm font-semibold"},{default:a(()=>[r(p(l.label),1)]),_:2},1024)]),o("div",Ne,[(m(!0),c(x,null,k(l.permissions,(f,g)=>(m(),c("div",{key:g,class:"flex items-center space-x-2"},[i(e(V),{checked:e(t).permissions.includes(g),"onUpdate:checked":Y=>F(g)},null,8,["checked","onUpdate:checked"]),i(e(v),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[r(p(f),1)]),_:2},1024)]))),128))])]))),128))])])):S("",!0),s[28]||(s[28]=o("div",{class:"border-t-2 border-dashed"},null,-1)),Object.keys(_.availablePermissions.frontend).length>0?(m(),c("div",ze,[s[27]||(s[27]=o("h3",{class:"text-lg font-semibold mb-4 text-blue-600 dark:text-blue-400"}," Permisos de Usuario (Frontend) ",-1)),o("div",Te,[(m(!0),c(x,null,k(_.availablePermissions.frontend,(l,u)=>(m(),c("div",{key:`frontend-${u}`,class:"space-y-3"},[o("div",Be,[i(e(V),{checked:D(u),indeterminate:R(u),"onUpdate:checked":f=>G(u)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(v),{class:"text-sm font-semibold"},{default:a(()=>[r(p(l.label),1)]),_:2},1024)]),o("div",qe,[(m(!0),c(x,null,k(l.permissions,(f,g)=>(m(),c("div",{key:g,class:"flex items-center space-x-2"},[i(e(V),{checked:e(t).permissions.includes(g),"onUpdate:checked":Y=>F(g)},null,8,["checked","onUpdate:checked"]),i(e(v),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[r(p(f),1)]),_:2},1024)]))),128))])]))),128))])])):S("",!0)])]),_:1}),i(b,{message:e(t).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),i(e(A),{value:"segments"},{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>[i(e(w),null,{default:a(()=>[...s[29]||(s[29]=[r("Segmentos de Datos",-1)])]),_:1}),i(e(E),null,{default:a(()=>[...s[30]||(s[30]=[r(" Asocia segmentos para limitar el alcance de datos visibles ",-1)])]),_:1})]),_:1}),i(e(C),null,{default:a(()=>[_.segments.length>0?(m(),c("div",Me,[(m(!0),c(x,null,k(_.segments,l=>(m(),c("div",{key:l.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[i(e(V),{checked:e(t).segment_ids.includes(l.id),"onUpdate:checked":u=>M(l.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),o("div",He,[i(e(v),{class:"text-sm font-medium cursor-pointer"},{default:a(()=>[r(p(l.name),1)]),_:2},1024),o("p",Ie,p(l.description||"Sin descripción"),1),l.user_count?(m(),$(e(T),{key:0,variant:"outline",class:"mt-2"},{default:a(()=>[r(p(l.user_count)+" usuarios ",1)]),_:2},1024)):S("",!0)])]))),128))])):(m(),c("div",Je," No hay segmentos disponibles ")),i(b,{message:e(t).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),o("div",Qe,[i(e(N),{href:n.route("admin.roles.index")},{default:a(()=>[i(e(y),{type:"button",variant:"outline"},{default:a(()=>[...s[31]||(s[31]=[r(" Cancelar ",-1)])]),_:1})]),_:1},8,["href"]),i(e(y),{type:"submit",disabled:e(t).processing},{default:a(()=>[i(e(he),{class:"mr-2 h-4 w-4"}),r(" "+p(e(t).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{ei as default};
