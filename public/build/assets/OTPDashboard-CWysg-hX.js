import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-CkV93eRM.js";import{d as L,k as h,c as g,p as H,O as X,j as m,o as d,e as l,b as a,f as s,u as e,m as G,t as i,g as n,n as K,a as b,i as R,q}from"./app-Dz3ixXIz.js";import{_ as c,a as p,b as v,c as f}from"./CardTitle.vue_vue_type_script_setup_true_lang-B_XBvMGg.js";import{_ as z}from"./index-CNv5LlCp.js";import{_ as T}from"./createLucideIcon-DJvARB-q.js";import{_ as N}from"./Progress.vue_vue_type_script_setup_true_lang-Bu3z79SM.js";import{_ as Y,a as Z}from"./index-B6rIxYvv.js";import{_ as tt}from"./AlertTitle.vue_vue_type_script_setup_true_lang-D0VkRikj.js";import{R as B}from"./refresh-cw-Y5iKODYS.js";import{C as et}from"./circle-check-big-DT-zXZB3.js";import{C as F}from"./clock-CZRTNru0.js";import{T as st}from"./triangle-alert-CO4FHOE8.js";import{U as Q}from"./DialogTitle.vue_vue_type_script_setup_true_lang-2yHR_n_V.js";import{T as at}from"./trending-up-CXtLCmvp.js";import{C as lt}from"./circle-x-MxKCd0fO.js";import{M as P}from"./mail-mWrG82TD.js";import{M as A}from"./message-square-BmMKbazr.js";import{T as ot}from"./timer-CXiLkuy_.js";import"./Input.vue_vue_type_script_setup_true_lang-5wns8fOn.js";import"./index-BOiXewDQ.js";import"./check-BdfcYRKF.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-o18L5IZN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CL6UcR-y.js";import"./Label.vue_vue_type_script_setup_true_lang-COc88-V1.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-B7RX3EcW.js";import"./VisuallyHidden-DzPDbuKW.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BvYTiVJy.js";import"./index-BcFl43Gn.js";import"./calendar-BY0KMpjj.js";import"./map-pin-N6S9PH39.js";const it={class:"space-y-6"},nt={class:"flex items-center justify-between"},dt={class:"flex items-center gap-4"},rt={class:"text-sm text-muted-foreground"},ut={key:0},ft={key:1},mt={key:2},ct={key:3},pt={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},vt={class:"text-2xl font-bold"},_t={class:"text-2xl font-bold"},xt={class:"text-2xl font-bold"},gt={class:"text-2xl font-bold text-destructive"},bt={class:"grid gap-6 md:grid-cols-2"},wt={class:"grid gap-4 grid-cols-3"},ht={class:"text-center"},yt={class:"text-2xl font-bold"},jt={class:"text-center"},Ct={class:"text-2xl font-bold"},Tt={class:"text-center"},kt={class:"text-2xl font-bold text-destructive"},$t={key:0,class:"space-y-2"},Pt={class:"flex justify-between text-sm"},At={class:"font-medium"},Mt={class:"grid gap-4 grid-cols-3"},St={class:"text-center"},Ot={class:"text-2xl font-bold"},Dt={class:"text-center"},Et={class:"text-2xl font-bold"},Rt={class:"text-center"},qt={class:"text-2xl font-bold text-destructive"},zt={key:0,class:"space-y-2"},Nt={class:"flex justify-between text-sm"},Bt={class:"font-medium"},Ft={class:"grid gap-4 md:grid-cols-3"},Qt={class:"flex items-center gap-4"},Ut={class:"text-2xl font-bold"},Vt={class:"flex items-center gap-4"},Wt={class:"text-2xl font-bold"},It={class:"flex items-center gap-4"},Jt={class:"flex"},Lt={class:"text-2xl font-bold"},Ht={class:"flex flex-wrap gap-4"},ke=L({__name:"OTPDashboard",props:{initialQueueMetrics:{default:()=>[]},initialOtpStats:{default:()=>({total_activos:0,total_expirados:0,total_usados:0,por_canal:{email:0,whatsapp:0,both:0}})}},setup(U){const M=U,x=h(M.initialQueueMetrics),w=h(M.initialOtpStats),y=h(!1),S=h(new Date),j=h(null),V=[{label:"Admin",href:route("admin.dashboard")},{label:"Dashboard OTP",href:route("admin.otp-dashboard")}],r=g(()=>x.value.find(o=>o.queue_name==="otp-emails")),u=g(()=>x.value.find(o=>o.queue_name==="otp-whatsapp")),C=g(()=>x.value.reduce((o,t)=>o+t.pending_jobs,0)),k=g(()=>x.value.reduce((o,t)=>o+t.processing_jobs,0)),$=g(()=>x.value.reduce((o,t)=>o+t.failed_jobs,0)),_=g(()=>$.value>10?{status:"error",label:"Crítico",color:"destructive"}:C.value>50?{status:"warning",label:"Sobrecargado",color:"warning"}:k.value>0?{status:"processing",label:"Procesando",color:"default"}:{status:"healthy",label:"Saludable",color:"success"}),O=async()=>{y.value=!0;try{const o=await q.get("/api/queue/status");o.data.success&&(x.value=o.data.data);const t=await q.get("/api/queue/otp/stats");t.data.success&&(w.value=t.data.data),S.value=new Date}catch(o){console.error("Error actualizando datos:",o)}finally{y.value=!1}},W=()=>{j.value=window.setInterval(O,1e4)},I=()=>{j.value&&(clearInterval(j.value),j.value=null)},D=o=>o<60?`${o}s`:o<3600?`${Math.round(o/60)}m`:`${Math.round(o/3600)}h`,E=o=>o.failed_jobs>5?"destructive":o.pending_jobs>25?"warning":"default";return H(()=>{W()}),X(()=>{I()}),(o,t)=>(d(),m(J,{breadcrumbs:V},{default:l(()=>[a(e(G),{title:"Dashboard OTP"}),s("div",it,[s("div",nt,[t[1]||(t[1]=s("div",null,[s("h1",{class:"text-3xl font-bold tracking-tight"},"Dashboard OTP"),s("p",{class:"text-muted-foreground"}," Monitoreo en tiempo real del sistema de colas OTP ")],-1)),s("div",dt,[s("div",rt," Última actualización: "+i(S.value.toLocaleTimeString()),1),a(e(T),{onClick:O,variant:"outline",size:"sm",disabled:y.value},{default:l(()=>[a(e(B),{class:K([{"animate-spin":y.value},"h-4 w-4 mr-2"])},null,8,["class"]),t[0]||(t[0]=n(" Actualizar "))]),_:1},8,["disabled"])])]),a(e(Y),{variant:_.value.status==="error"?"destructive":"default"},{default:l(()=>[_.value.status==="healthy"?(d(),m(e(et),{key:0,class:"h-4 w-4"})):_.value.status==="processing"?(d(),m(e(F),{key:1,class:"h-4 w-4"})):(d(),m(e(st),{key:2,class:"h-4 w-4"})),a(e(tt),null,{default:l(()=>[n("Estado del Sistema: "+i(_.value.label),1)]),_:1}),a(e(Z),null,{default:l(()=>[_.value.status==="healthy"?(d(),b("span",ut," Todas las colas funcionan normalmente ")):_.value.status==="processing"?(d(),b("span",ft,i(k.value)+" trabajos en proceso, "+i(C.value)+" en cola ",1)):_.value.status==="warning"?(d(),b("span",mt," Cola sobrecargada: "+i(C.value)+" trabajos pendientes ",1)):(d(),b("span",ct," Sistema crítico: "+i($.value)+" trabajos fallidos requieren atención ",1))]),_:1})]),_:1},8,["variant"]),s("div",pt,[a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>t[2]||(t[2]=[n("OTPs Activos")])),_:1}),a(e(Q),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(f),null,{default:l(()=>[s("div",vt,i(w.value.total_activos),1),t[3]||(t[3]=s("p",{class:"text-xs text-muted-foreground"}," Códigos válidos pendientes ",-1))]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>t[4]||(t[4]=[n("En Cola")])),_:1}),a(e(F),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(f),null,{default:l(()=>[s("div",_t,i(C.value),1),t[5]||(t[5]=s("p",{class:"text-xs text-muted-foreground"}," Envíos pendientes ",-1))]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>t[6]||(t[6]=[n("Procesando")])),_:1}),a(e(at),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(f),null,{default:l(()=>[s("div",xt,i(k.value),1),t[7]||(t[7]=s("p",{class:"text-xs text-muted-foreground"}," Envíos en curso ",-1))]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(e(v),{class:"text-sm font-medium"},{default:l(()=>t[8]||(t[8]=[n("Fallidos")])),_:1}),a(e(lt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),a(e(f),null,{default:l(()=>[s("div",gt,i($.value),1),t[9]||(t[9]=s("p",{class:"text-xs text-muted-foreground"}," Requieren atención ",-1))]),_:1})]),_:1})]),s("div",bt,[a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),{class:"flex items-center gap-2"},{default:l(()=>[a(e(P),{class:"h-5 w-5"}),t[10]||(t[10]=n(" Cola Email OTP ")),a(e(z),{variant:r.value?E(r.value):"secondary"},{default:l(()=>[n(i(r.value?`${r.value.rate_limit}/seg`:"N/A"),1)]),_:1},8,["variant"])]),_:1})]),_:1}),r.value?(d(),m(e(f),{key:0,class:"space-y-4"},{default:l(()=>[s("div",wt,[s("div",ht,[s("div",yt,i(r.value.pending_jobs),1),t[11]||(t[11]=s("div",{class:"text-xs text-muted-foreground"},"En cola",-1))]),s("div",jt,[s("div",Ct,i(r.value.processing_jobs),1),t[12]||(t[12]=s("div",{class:"text-xs text-muted-foreground"},"Procesando",-1))]),s("div",Tt,[s("div",kt,i(r.value.failed_jobs),1),t[13]||(t[13]=s("div",{class:"text-xs text-muted-foreground"},"Fallidos",-1))])]),r.value.pending_jobs>0?(d(),b("div",$t,[s("div",Pt,[t[14]||(t[14]=s("span",null,"Tiempo estimado de espera",-1)),s("span",At,i(D(r.value.estimated_wait_seconds)),1)]),a(e(N),{value:Math.min(100,r.value.processing_jobs/(r.value.pending_jobs+r.value.processing_jobs)*100),class:"h-2"},null,8,["value"])])):R("",!0)]),_:1})):(d(),m(e(f),{key:1},{default:l(()=>t[15]||(t[15]=[s("p",{class:"text-muted-foreground text-center py-4"}," No hay datos disponibles para la cola de emails ",-1)])),_:1}))]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),{class:"flex items-center gap-2"},{default:l(()=>[a(e(A),{class:"h-5 w-5"}),t[16]||(t[16]=n(" Cola WhatsApp OTP ")),a(e(z),{variant:u.value?E(u.value):"secondary"},{default:l(()=>[n(i(u.value?`${u.value.rate_limit}/seg`:"N/A"),1)]),_:1},8,["variant"])]),_:1})]),_:1}),u.value?(d(),m(e(f),{key:0,class:"space-y-4"},{default:l(()=>[s("div",Mt,[s("div",St,[s("div",Ot,i(u.value.pending_jobs),1),t[17]||(t[17]=s("div",{class:"text-xs text-muted-foreground"},"En cola",-1))]),s("div",Dt,[s("div",Et,i(u.value.processing_jobs),1),t[18]||(t[18]=s("div",{class:"text-xs text-muted-foreground"},"Procesando",-1))]),s("div",Rt,[s("div",qt,i(u.value.failed_jobs),1),t[19]||(t[19]=s("div",{class:"text-xs text-muted-foreground"},"Fallidos",-1))])]),u.value.pending_jobs>0?(d(),b("div",zt,[s("div",Nt,[t[20]||(t[20]=s("span",null,"Tiempo estimado de espera",-1)),s("span",Bt,i(D(u.value.estimated_wait_seconds)),1)]),a(e(N),{value:Math.min(100,u.value.processing_jobs/(u.value.pending_jobs+u.value.processing_jobs)*100),class:"h-2"},null,8,["value"])])):R("",!0)]),_:1})):(d(),m(e(f),{key:1},{default:l(()=>t[21]||(t[21]=[s("p",{class:"text-muted-foreground text-center py-4"}," No hay datos disponibles para la cola de WhatsApp ",-1)])),_:1}))]),_:1})]),a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),null,{default:l(()=>t[22]||(t[22]=[n("Distribución de OTPs por Canal")])),_:1})]),_:1}),a(e(f),null,{default:l(()=>[s("div",Ft,[s("div",Qt,[a(e(P),{class:"h-8 w-8 text-blue-500"}),s("div",null,[s("div",Ut,i(w.value.por_canal.email),1),t[23]||(t[23]=s("div",{class:"text-sm text-muted-foreground"},"Solo Email",-1))])]),s("div",Vt,[a(e(A),{class:"h-8 w-8 text-green-500"}),s("div",null,[s("div",Wt,i(w.value.por_canal.whatsapp),1),t[24]||(t[24]=s("div",{class:"text-sm text-muted-foreground"},"Solo WhatsApp",-1))])]),s("div",It,[s("div",Jt,[a(e(P),{class:"h-8 w-8 text-blue-500"}),a(e(A),{class:"h-8 w-8 text-green-500 -ml-2"})]),s("div",null,[s("div",Lt,i(w.value.por_canal.both),1),t[25]||(t[25]=s("div",{class:"text-sm text-muted-foreground"},"Ambos Canales",-1))])])])]),_:1})]),_:1}),a(e(c),null,{default:l(()=>[a(e(p),null,{default:l(()=>[a(e(v),null,{default:l(()=>t[26]||(t[26]=[n("Acciones Administrativas")])),_:1})]),_:1}),a(e(f),null,{default:l(()=>[s("div",Ht,[a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(ot),{class:"h-4 w-4 mr-2"}),t[27]||(t[27]=n(" Monitoreo en Tiempo Real "))]),_:1}),a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(B),{class:"h-4 w-4 mr-2"}),t[28]||(t[28]=n(" Reiniciar Cola Fallida "))]),_:1}),a(e(T),{variant:"outline",size:"sm"},{default:l(()=>[a(e(Q),{class:"h-4 w-4 mr-2"}),t[29]||(t[29]=n(" Ver Logs Detallados "))]),_:1})])]),_:1})]),_:1})])]),_:1}))}});export{ke as default};
