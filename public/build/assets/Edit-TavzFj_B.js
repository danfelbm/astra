import{d as ee,C as se,c as v,w as le,j as h,o as u,e as a,b as l,f as n,u as e,m as ae,i as E,g as r,P as O,h as ie,t as m,a as p,F as k,r as $,W as te}from"./app-CjIl7ovB.js";import{d as oe,T as re,_ as ne}from"./AppLayout.vue_vue_type_script_setup_true_lang-CQa3PwS8.js";import{_ as b}from"./createLucideIcon-CMvLHI-j.js";import{_ as S,a as w,b as P,c as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-DzLxXElS.js";import{_ as D}from"./CardDescription.vue_vue_type_script_setup_true_lang-EXz9Xw7w.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-D48NKSJ0.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-Bv5louyk.js";import{_ as de}from"./Textarea.vue_vue_type_script_setup_true_lang-_VoCAoxk.js";import{_ as U}from"./Checkbox.vue_vue_type_script_setup_true_lang-BUmCiok1.js";import{C as ue,_ as M}from"./index-IRTj8ojd.js";import{_ as me,a as ce,b as C,c as j}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DTiyVXgy.js";import{_ as pe}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DNCGIQPA.js";import{_ as fe,a as _e}from"./index-Cygfa34B.js";import{_ as ge}from"./Switch.vue_vue_type_script_setup_true_lang-B_kcpBY-.js";import{_ as ve,a as be,b as xe,c as ye,d as he}from"./SelectValue.vue_vue_type_script_setup_true_lang-CAJirSKK.js";import{_ as g}from"./InputError.vue_vue_type_script_setup_true_lang-D7C3ovir.js";import{A as ke}from"./arrow-left-DrXv8NFA.js";import{L as $e}from"./lock-Dp0K-Ehn.js";import{U as Se}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D4yFj9nQ.js";import{H as we}from"./house-BPGzDBKq.js";import{S as Pe}from"./save-CL5LuifT.js";import"./index-D-i6itgQ.js";import"./check-cz2ctdGI.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D5qI7D3w.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-BErrScDZ.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CatT2v7C.js";import"./index-o2NH0iOs.js";import"./calendar-DfNQFbhF.js";import"./map-pin-RV53CmLm.js";import"./VisuallyHidden-B3DFMw8J.js";import"./RovingFocusItem-CC--dEQn.js";import"./utils-F3p8soUq.js";import"./VisuallyHiddenInput-rN9VS-Ui.js";const Ve={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},De={class:"flex items-center justify-between"},Ue={class:"flex gap-2"},Ce={class:"space-y-2"},je={class:"space-y-2"},Ae={class:"space-y-2"},Ee={class:"space-y-2"},Re={class:"flex items-center justify-between"},Le={class:"space-y-0.5"},Oe={class:"text-xs text-muted-foreground"},Fe={class:"space-y-2"},Me={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},Ge={class:"flex gap-2 mt-4"},Ne={class:"space-y-6"},Te={class:"flex items-center space-x-2 pb-2 border-b"},ze={class:"grid grid-cols-2 gap-3 pl-6"},Be={class:"grid grid-cols-2 gap-4"},qe={key:0,class:"space-y-3"},He={class:"flex-1"},Ie={class:"text-xs text-muted-foreground mt-1"},We={key:1,class:"text-center py-8 text-muted-foreground"},Je={class:"flex justify-end gap-4"},Cs=ee({__name:"Edit",props:{role:{},segments:{},availablePermissions:{},modules:{},selectedSegments:{}},setup(G){const d=G,N=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Editar Rol",href:"#"}],i=se({name:d.role.name,display_name:d.role.display_name,description:d.role.description||"",is_administrative:!!d.role.is_administrative,redirect_after_login:d.role.redirect_after_login||"",permissions:d.role.permissions||[],allowed_modules:d.role.allowed_modules||[],segment_ids:d.selectedSegments||[]}),R=[{value:"",label:"Por defecto (según tipo de rol)"},{value:"admin.dashboard",label:"Dashboard Administrativo",group:"admin"},{value:"admin.candidaturas.dashboard",label:"Dashboard Candidaturas",group:"admin"},{value:"dashboard",label:"Dashboard Usuario",group:"user"},{value:"votaciones.index",label:"Votaciones",group:"user"},{value:"asambleas.index",label:"Asambleas",group:"user"},{value:"formularios.index",label:"Formularios",group:"user"},{value:"postulaciones.index",label:"Postulaciones",group:"user"},{value:"admin.otp-dashboard",label:"Dashboard OTP",group:"admin"},{value:"admin.configuracion.index",label:"Configuración",group:"admin"},{value:"admin.users.index",label:"Usuarios",group:"admin"},{value:"admin.roles.index",label:"Roles y Permisos",group:"admin"},{value:"admin.candidaturas.index",label:"Candidaturas (Lista)",group:"admin"}],T=v(()=>i.is_administrative?R:R.filter(o=>o.group!=="admin"||o.value==="")),x=v(()=>["super_admin","admin","manager","user","end_customer"].includes(d.role.name)),y=v(()=>i.is_administrative?d.availablePermissions.administrative:d.availablePermissions.frontend),z=v(()=>i.is_administrative?d.modules.administrative:d.modules.frontend),L=o=>{const s=y.value[o];return s?Object.keys(s.permissions).every(c=>i.permissions.includes(c)):!1},B=o=>{const s=y.value[o];if(!s)return!1;const t=Object.keys(s.permissions),c=t.filter(f=>i.permissions.includes(f)).length;return c>0&&c<t.length},q=o=>{const s=i.permissions.indexOf(o);s>-1?i.permissions.splice(s,1):i.permissions.push(o)},H=o=>{const s=y.value[o];if(!s)return;const t=Object.keys(s.permissions);L(o)?i.permissions=i.permissions.filter(f=>!t.includes(f)):t.forEach(f=>{i.permissions.includes(f)||i.permissions.push(f)})},I=o=>{const s=i.allowed_modules.indexOf(o);s>-1?i.allowed_modules.splice(s,1):i.allowed_modules.push(o)},W=o=>{const s=i.segment_ids.indexOf(o);s>-1?i.segment_ids.splice(s,1):i.segment_ids.push(o)},J=()=>{i.put(`/admin/roles/${d.role.id}`,{preserveScroll:!0,onSuccess:()=>{}})},Q=()=>{confirm(`¿Estás seguro de eliminar el rol "${d.role.display_name}"? Esta acción no se puede deshacer.`)&&te.delete(`/admin/roles/${d.role.id}`)},X=()=>{const o=[];Object.values(y.value).forEach(s=>{Object.keys(s.permissions).forEach(t=>{o.push(t)})}),i.permissions=o},Y=()=>{i.permissions=[]};le(()=>i.is_administrative,(o,s)=>{s!==void 0&&o!==s&&(i.permissions=[],i.allowed_modules=[])});const Z=v(()=>i.permissions.length),K=v(()=>!x.value);return(o,s)=>(u(),h(ne,{breadcrumbs:N},{default:a(()=>[l(e(ae),{title:"Editar Rol"}),n("div",Ve,[n("div",De,[s[7]||(s[7]=n("div",null,[n("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Rol"),n("p",{class:"text-muted-foreground"}," Modifica los permisos y configuración del rol ")],-1)),n("div",Ue,[K.value?(u(),h(e(b),{key:0,onClick:Q,variant:"destructive",type:"button"},{default:a(()=>s[5]||(s[5]=[r(" Eliminar Rol ")])),_:1})):E("",!0),l(e(O),{href:o.route("admin.roles.index")},{default:a(()=>[l(e(b),{variant:"outline"},{default:a(()=>[l(e(ke),{class:"mr-2 h-4 w-4"}),s[6]||(s[6]=r(" Volver "))]),_:1})]),_:1},8,["href"])])]),x.value?(u(),h(e(fe),{key:0},{default:a(()=>[l(e(ue),{class:"h-4 w-4"}),l(e(_e),null,{default:a(()=>s[8]||(s[8]=[r(" Este es un rol del sistema. Algunas configuraciones pueden estar restringidas. ")])),_:1})]),_:1})):E("",!0),n("form",{onSubmit:ie(J,["prevent"]),class:"space-y-6"},[l(e(me),{defaultValue:"general",class:"space-y-4"},{default:a(()=>[l(e(ce),{class:"grid w-full grid-cols-4"},{default:a(()=>[l(e(C),{value:"general"},{default:a(()=>[l(e(oe),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=r(" General "))]),_:1}),l(e(C),{value:"permissions"},{default:a(()=>[l(e($e),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=r(" Permisos "))]),_:1}),l(e(C),{value:"modules"},{default:a(()=>[l(e(Se),{class:"mr-2 h-4 w-4"}),s[11]||(s[11]=r(" Módulos "))]),_:1}),l(e(C),{value:"segments"},{default:a(()=>[l(e(re),{class:"mr-2 h-4 w-4"}),s[12]||(s[12]=r(" Segmentos "))]),_:1})]),_:1}),l(e(j),{value:"general"},{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(w),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[13]||(s[13]=[r("Información General")])),_:1}),l(e(D),null,{default:a(()=>s[14]||(s[14]=[r(" Define el nombre y descripción del rol ")])),_:1})]),_:1}),l(e(V),{class:"space-y-4"},{default:a(()=>[n("div",Ce,[l(e(_),{htmlFor:"name"},{default:a(()=>s[15]||(s[15]=[r("Nombre del Rol (interno)")])),_:1}),l(e(F),{id:"name",modelValue:e(i).name,"onUpdate:modelValue":s[0]||(s[0]=t=>e(i).name=t),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos",disabled:x.value},null,8,["modelValue","disabled"]),s[16]||(s[16]=n("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),l(g,{message:e(i).errors.name},null,8,["message"])]),n("div",je,[l(e(_),{htmlFor:"display_name"},{default:a(()=>s[17]||(s[17]=[r("Nombre a Mostrar")])),_:1}),l(e(F),{id:"display_name",modelValue:e(i).display_name,"onUpdate:modelValue":s[1]||(s[1]=t=>e(i).display_name=t),placeholder:"Administrador Regional"},null,8,["modelValue"]),l(g,{message:e(i).errors.display_name},null,8,["message"])]),n("div",Ae,[l(e(_),{htmlFor:"description"},{default:a(()=>s[18]||(s[18]=[r("Descripción")])),_:1}),l(e(de),{id:"description",modelValue:e(i).description,"onUpdate:modelValue":s[2]||(s[2]=t=>e(i).description=t),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),l(g,{message:e(i).errors.description},null,8,["message"])]),n("div",Ee,[n("div",Re,[n("div",Le,[l(e(_),{htmlFor:"is_administrative"},{default:a(()=>s[19]||(s[19]=[r("Rol Administrativo")])),_:1}),s[20]||(s[20]=n("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),l(e(ge),{id:"is_administrative",modelValue:e(i).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=t=>e(i).is_administrative=t),disabled:x.value},null,8,["modelValue","disabled"])]),l(g,{message:e(i).errors.is_administrative},null,8,["message"]),n("div",Oe," Debug: is_administrative = "+m(e(i).is_administrative)+" ("+m(typeof e(i).is_administrative)+") ",1)]),n("div",Fe,[l(e(_),{htmlFor:"redirect_after_login"},{default:a(()=>[l(e(we),{class:"inline-block h-4 w-4 mr-1"}),s[21]||(s[21]=r(" Página de Inicio Después del Login "))]),_:1}),l(e(ve),{modelValue:e(i).redirect_after_login,"onUpdate:modelValue":s[4]||(s[4]=t=>e(i).redirect_after_login=t),disabled:x.value},{default:a(()=>[l(e(be),{id:"redirect_after_login"},{default:a(()=>[l(e(xe),{placeholder:"Seleccione la página de destino"})]),_:1}),l(e(ye),null,{default:a(()=>[(u(!0),p(k,null,$(T.value,t=>(u(),h(e(he),{key:t.value,value:t.value},{default:a(()=>[r(m(t.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),s[22]||(s[22]=n("p",{class:"text-xs text-muted-foreground"}," Define a qué página se redirigirá al usuario después de autenticarse. Si no se especifica, usará el comportamiento por defecto. ",-1)),l(g,{message:e(i).errors.redirect_after_login},null,8,["message"])]),n("div",Me,[n("p",null,"ID del Rol: "+m(o.role.id),1),n("p",null,"Creado: "+m(new Date(o.role.created_at).toLocaleDateString()),1),n("p",null,"Última actualización: "+m(new Date(o.role.updated_at).toLocaleDateString()),1)])]),_:1})]),_:1})]),_:1}),l(e(j),{value:"permissions"},{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(w),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[23]||(s[23]=[r("Matriz de Permisos")])),_:1}),l(e(D),null,{default:a(()=>[r(m(e(i).is_administrative?"Selecciona los permisos administrativos para este rol":"Selecciona los permisos de usuario para este rol"),1)]),_:1}),n("div",Ge,[l(e(b),{type:"button",size:"sm",variant:"outline",onClick:X},{default:a(()=>s[24]||(s[24]=[r(" Seleccionar Todos ")])),_:1}),l(e(b),{type:"button",size:"sm",variant:"outline",onClick:Y},{default:a(()=>s[25]||(s[25]=[r(" Limpiar Todos ")])),_:1}),l(e(M),{variant:"secondary",class:"ml-auto"},{default:a(()=>[r(m(Z.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),l(e(V),null,{default:a(()=>[l(e(pe),{class:"h-[500px] pr-4"},{default:a(()=>[n("div",Ne,[(u(!0),p(k,null,$(y.value,(t,c)=>(u(),p("div",{key:c,class:"space-y-3"},[n("div",Te,[l(e(U),{checked:L(c),indeterminate:B(c),"onUpdate:checked":f=>H(c)},null,8,["checked","indeterminate","onUpdate:checked"]),l(e(_),{class:"text-sm font-semibold"},{default:a(()=>[r(m(t.label),1)]),_:2},1024)]),n("div",ze,[(u(!0),p(k,null,$(t.permissions,(f,A)=>(u(),p("div",{key:A,class:"flex items-center space-x-2"},[l(e(U),{checked:e(i).permissions.includes(A),"onUpdate:checked":Qe=>q(A)},null,8,["checked","onUpdate:checked"]),l(e(_),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[r(m(f),1)]),_:2},1024)]))),128))])]))),128))])]),_:1}),l(g,{message:e(i).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(j),{value:"modules"},{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(w),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[26]||(s[26]=[r("Módulos Permitidos")])),_:1}),l(e(D),null,{default:a(()=>[r(m(e(i).is_administrative?"Selecciona los módulos administrativos a los que tendrá acceso este rol":"Selecciona los módulos del portal público a los que tendrá acceso este rol"),1)]),_:1})]),_:1}),l(e(V),null,{default:a(()=>[n("div",Be,[(u(!0),p(k,null,$(z.value,(t,c)=>(u(),p("div",{key:c,class:"flex items-center space-x-2"},[l(e(U),{checked:e(i).allowed_modules.includes(c),"onUpdate:checked":f=>I(c)},null,8,["checked","onUpdate:checked"]),l(e(_),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[r(m(t),1)]),_:2},1024)]))),128))]),l(g,{message:e(i).errors.allowed_modules},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(j),{value:"segments"},{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(w),null,{default:a(()=>[l(e(P),null,{default:a(()=>s[27]||(s[27]=[r("Segmentos de Datos")])),_:1}),l(e(D),null,{default:a(()=>s[28]||(s[28]=[r(" Asocia segmentos para limitar el alcance de datos visibles ")])),_:1})]),_:1}),l(e(V),null,{default:a(()=>[o.segments.length>0?(u(),p("div",qe,[(u(!0),p(k,null,$(o.segments,t=>(u(),p("div",{key:t.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[l(e(U),{checked:e(i).segment_ids.includes(t.id),"onUpdate:checked":c=>W(t.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),n("div",He,[l(e(_),{class:"text-sm font-medium cursor-pointer"},{default:a(()=>[r(m(t.name),1)]),_:2},1024),n("p",Ie,m(t.description||"Sin descripción"),1),t.user_count?(u(),h(e(M),{key:0,variant:"outline",class:"mt-2"},{default:a(()=>[r(m(t.user_count)+" usuarios ",1)]),_:2},1024)):E("",!0)])]))),128))])):(u(),p("div",We," No hay segmentos disponibles ")),l(g,{message:e(i).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),n("div",Je,[l(e(O),{href:o.route("admin.roles.index")},{default:a(()=>[l(e(b),{type:"button",variant:"outline"},{default:a(()=>s[29]||(s[29]=[r(" Cancelar ")])),_:1})]),_:1},8,["href"]),l(e(b),{type:"submit",disabled:e(i).processing},{default:a(()=>[l(e(Pe),{class:"mr-2 h-4 w-4"}),r(" "+m(e(i).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{Cs as default};
