import{d as ie,r as C,p as he,c as I,i as m,F as S,e as t,f as e,w as a,g as n,h as c,k as G,m as l,t as f,u as xe,l as ke,b as V,j as y,n as z,U as Ve}from"./app-DPZe4w2x.js";import{_ as E,a as N,b as R,c as q}from"./CardTitle.vue_vue_type_script_setup_true_lang-BCQJcDUY.js";import{_ as U}from"./createLucideIcon-CtVqLifD.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-CF59fRLQ.js";import{_ as $e}from"./Textarea.vue_vue_type_script_setup_true_lang-DraoBz1e.js";import{_ as h}from"./Label.vue_vue_type_script_setup_true_lang-DnsxvmoM.js";import{a as we,_ as Se}from"./index-DNm1rTuU.js";import{_ as te,a as oe,b as ae,c as re,d as le}from"./SelectValue.vue_vue_type_script_setup_true_lang-D2pkHqRN.js";import{_ as Ce}from"./CamposPersonalizadosForm.vue_vue_type_script_setup_true_lang-BFMg6RUE.js";import{E as Ue}from"./EtiquetaSelector-BBaVJgvF.js";import{_ as Pe}from"./CardDescription.vue_vue_type_script_setup_true_lang-CEbdsECu.js";import{_ as de}from"./index-CnATNmjU.js";import{_ as ue}from"./AddUsersModal.vue_vue_type_script_setup_true_lang-DIbee9uY.js";import{U as B}from"./user-C8fgo3pY.js";import{U as ce}from"./user-plus-nw-oFPG2.js";import{X as T}from"./x-B6ClFkAe.js";import{_ as ze,a as Ee,b as qe}from"./TooltipTrigger.vue_vue_type_script_setup_true_lang-tQUX8JNu.js";import{_ as Ae}from"./TooltipProvider.vue_vue_type_script_setup_true_lang-DmZVjov4.js";import{t as ne}from"./index-DAnFQ1_u.js";import{T as Fe}from"./tag-BQRfWA6L.js";import{F as Ie}from"./file-text-Ds-M-qF1.js";import{I as Ge}from"./info-BqQ0EEvl.js";import{C as Ne}from"./circle-alert-Donphzw1.js";import{S as Re}from"./save-B4oSQHkv.js";const je={class:"flex items-center justify-between"},Be={key:0,class:"space-y-2"},Te={class:"flex items-center gap-3"},De={class:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center"},Me={class:"font-medium"},Le={class:"text-sm text-gray-500 dark:text-gray-400"},Oe={class:"flex items-center gap-2"},Ye={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},He=ie({__name:"GestoresManager",props:{modelValue:{default:()=>[]},gestores:{default:()=>[]}},emits:["update:modelValue"],setup(_,{emit:j}){const d=_,P=j,$=C(!1),w=C(new Map);he(()=>d.gestores,v=>{v&&v.length>0&&v.forEach(i=>{w.value.set(i.id,i)})},{immediate:!0,deep:!0});const x=I(()=>{var i;const v=[];for(const p of d.modelValue){let b=(i=d.gestores)==null?void 0:i.find(g=>g.id===p);b||(b=w.value.get(p)),b&&v.push(b)}return v}),o=({userIds:v,users:i})=>{i&&i.length>0&&i.forEach(g=>{w.value.set(g.id,g)});const p=v.filter(g=>g&&g>0),b=[...new Set([...d.modelValue.filter(g=>g&&g>0),...p])];P("update:modelValue",b),$.value=!1},A=v=>{const i=d.modelValue.filter(p=>p!==v);P("update:modelValue",i)};return(v,i)=>(l(),m(S,null,[t(e(E),null,{default:a(()=>[t(e(N),null,{default:a(()=>[n("div",je,[n("div",null,[t(e(R),{class:"flex items-center gap-2"},{default:a(()=>[t(e(B),{class:"h-5 w-5"}),i[2]||(i[2]=c(" Gestores del Proyecto ",-1))]),_:1}),t(e(Pe),null,{default:a(()=>[...i[3]||(i[3]=[c(" Los gestores pueden editar el proyecto desde el panel de usuario ",-1)])]),_:1})]),t(e(U),{type:"button",variant:"outline",size:"sm",onClick:i[0]||(i[0]=p=>$.value=!0)},{default:a(()=>[t(e(ce),{class:"h-4 w-4 mr-2"}),i[4]||(i[4]=c(" Añadir Gestor ",-1))]),_:1})])]),_:1}),t(e(q),null,{default:a(()=>[x.value.length>0?(l(),m("div",Be,[(l(!0),m(S,null,G(x.value,p=>(l(),m("div",{key:p.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[n("div",Te,[n("div",De,[t(e(B),{class:"h-5 w-5 text-primary"})]),n("div",null,[n("p",Me,f(p.name),1),n("p",Le,f(p.email),1)])]),n("div",Oe,[t(e(de),{variant:"secondary"},{default:a(()=>[...i[5]||(i[5]=[c("Gestor",-1)])]),_:1}),t(e(U),{type:"button",variant:"ghost",size:"sm",onClick:b=>A(p.id)},{default:a(()=>[t(e(T),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]))),128))])):(l(),m("div",Ye,[t(e(B),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),i[6]||(i[6]=n("p",null,"No hay gestores asignados",-1)),i[7]||(i[7]=n("p",{class:"text-sm mt-1"},'Haz clic en "Añadir Gestor" para asignar gestores al proyecto',-1))]))]),_:1})]),_:1}),t(ue,{modelValue:$.value,"onUpdate:modelValue":i[1]||(i[1]=p=>$.value=p),title:"Seleccionar Gestores",description:"Selecciona los usuarios que podrán gestionar y editar este proyecto","search-endpoint":v.route("admin.proyectos.search-users"),"excluded-ids":_.modelValue,"submit-button-text":"Añadir Gestores",onSubmit:o},null,8,["modelValue","search-endpoint","excluded-ids"])],64))}}),Xe={key:0,class:"mt-1 text-sm text-red-600"},Je={key:0,class:"mt-1 text-sm text-red-600"},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qe={key:0,class:"mt-1 text-sm text-red-600"},We={key:0,class:"mt-1 text-sm text-red-600"},Ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},es={key:0,class:"mt-1 text-sm text-red-600"},ss={key:0,class:"mt-1 text-sm text-red-600"},ts={key:0},os={class:"space-y-2"},as={key:0,class:"p-3 bg-muted rounded-lg flex items-center justify-between"},rs={class:"font-medium"},ls={class:"text-sm text-muted-foreground"},ns={key:0,class:"mt-1 text-sm text-red-600"},is={key:1},ds={key:0,class:"mt-1 text-sm text-red-600"},us={class:"flex flex-wrap gap-2"},cs={key:0,class:"mt-1 text-sm text-red-600"},ms={class:"p-3 bg-muted rounded-lg"},ps={class:"flex items-center gap-2 mb-1"},fs={class:"text-sm text-primary break-all"},js=ie({__name:"ProyectoFormFields",props:{proyecto:{},camposPersonalizados:{},valoresCampos:{default:()=>({})},categorias:{},gestores:{},tokensNomenclatura:{default:()=>[]},submitUrl:{},cancelUrl:{},mode:{default:"edit"},showResponsable:{type:Boolean,default:!1},showGestores:{type:Boolean,default:!1},showInfoAlert:{type:Boolean,default:!0},searchUsersEndpoint:{},estados:{default:()=>({})},prioridades:{default:()=>({})}},emits:["cancel","success"],setup(_,{emit:j}){var D,M,L,O,Y,H,X,J,K,Q,W,Z;const d=_,P=j,$=u=>u?u.split(" ")[0]:"",w={};d.valoresCampos&&d.camposPersonalizados.forEach(u=>{w[u.id]=d.valoresCampos[u.id]||d.valoresCampos[u.slug]||""});const x=d.mode==="create",o=xe({nombre:((D=d.proyecto)==null?void 0:D.nombre)||"",descripcion:((M=d.proyecto)==null?void 0:M.descripcion)||"",fecha_inicio:$((L=d.proyecto)==null?void 0:L.fecha_inicio),fecha_fin:$((O=d.proyecto)==null?void 0:O.fecha_fin),estado:((Y=d.proyecto)==null?void 0:Y.estado)||"planificacion",prioridad:((H=d.proyecto)==null?void 0:H.prioridad)||"media",responsable_id:((X=d.proyecto)==null?void 0:X.responsable_id)||null,etiquetas:((K=(J=d.proyecto)==null?void 0:J.etiquetas)==null?void 0:K.map(u=>u.id))||[],gestores:((Q=d.gestores)==null?void 0:Q.map(u=>u.id))||[],campos_personalizados:w,nomenclatura_archivos:((W=d.proyecto)==null?void 0:W.nomenclatura_archivos)||""}),A=C(null),v=u=>{const s=A.value;if(!s){o.nomenclatura_archivos+=u;return}const r=s.selectionStart??o.nomenclatura_archivos.length,k=s.selectionEnd??o.nomenclatura_archivos.length,ee=o.nomenclatura_archivos;o.nomenclatura_archivos=ee.slice(0,r)+u+ee.slice(k),Ve(()=>{if(s){const se=r+u.length;s.setSelectionRange(se,se),s.focus()}})},i=I(()=>{let s=(o.nomenclatura_archivos||"{original}").replace("{proyecto}","mi-proyecto").replace("{proyecto_id}","42").replace("{hito}","fase-1").replace("{hito_id}","15").replace("{entregable}","documento-final").replace("{entregable_id}","78").replace("{original}","mi-archivo");const r=new Date;return s=s.replace("{fecha}",r.toISOString().split("T")[0]).replace(/\{fecha:Ymd\}/g,r.toISOString().split("T")[0].replace(/-/g,"")).replace(/\{fecha:d-m-Y\}/g,`${String(r.getDate()).padStart(2,"0")}-${String(r.getMonth()+1).padStart(2,"0")}-${r.getFullYear()}`),s+"_a1b2c3.pdf"}),p=C(!1),b=C(!1),g=C(((Z=d.proyecto)==null?void 0:Z.responsable)||null),me={planificacion:"Planificación",en_progreso:"En Progreso",pausado:"Pausado",completado:"Completado",cancelado:"Cancelado"},pe={baja:"Baja",media:"Media",alta:"Alta",critica:"Crítica"},fe=I(()=>Object.keys(d.estados).length>0?d.estados:me),_e=I(()=>Object.keys(d.prioridades).length>0?d.prioridades:pe),ge=()=>{p.value=!0;const u={preserveScroll:!0,onSuccess:()=>{ne.success(x?"Proyecto creado exitosamente":"Proyecto actualizado exitosamente"),P("success")},onError:s=>{ne.error(x?"Error al crear el proyecto":"Error al actualizar el proyecto"),console.error(s)},onFinish:()=>{p.value=!1}};x?o.post(d.submitUrl,u):o.put(d.submitUrl,u)},ye=()=>{P("cancel")},ve=u=>{o.campos_personalizados=u},be=u=>{u.userIds.length>0&&(o.responsable_id=u.userIds[0],u.users&&u.users.length>0&&(g.value=u.users[0]))};return(u,s)=>(l(),m("form",{onSubmit:ke(ge,["prevent"]),class:"space-y-6"},[t(e(E),null,{default:a(()=>[t(e(N),null,{default:a(()=>[t(e(R),null,{default:a(()=>[...s[12]||(s[12]=[c("Información Básica",-1)])]),_:1})]),_:1}),t(e(q),{class:"space-y-4"},{default:a(()=>[n("div",null,[t(e(h),{for:"nombre"},{default:a(()=>[...s[13]||(s[13]=[c("Nombre del Proyecto *",-1)])]),_:1}),t(e(F),{id:"nombre",modelValue:e(o).nombre,"onUpdate:modelValue":s[0]||(s[0]=r=>e(o).nombre=r),type:"text",placeholder:"Ingrese el nombre del proyecto",class:z({"border-red-500":e(o).errors.nombre}),required:""},null,8,["modelValue","class"]),e(o).errors.nombre?(l(),m("p",Xe,f(e(o).errors.nombre),1)):y("",!0)]),n("div",null,[t(e(h),{for:"descripcion"},{default:a(()=>[...s[14]||(s[14]=[c("Descripción",-1)])]),_:1}),t(e($e),{id:"descripcion",modelValue:e(o).descripcion,"onUpdate:modelValue":s[1]||(s[1]=r=>e(o).descripcion=r),placeholder:"Ingrese una descripción del proyecto",rows:"4",class:z({"border-red-500":e(o).errors.descripcion})},null,8,["modelValue","class"]),e(o).errors.descripcion?(l(),m("p",Je,f(e(o).errors.descripcion),1)):y("",!0)]),n("div",Ke,[n("div",null,[t(e(h),{for:"fecha_inicio"},{default:a(()=>[...s[15]||(s[15]=[c("Fecha de Inicio *",-1)])]),_:1}),t(e(F),{id:"fecha_inicio",modelValue:e(o).fecha_inicio,"onUpdate:modelValue":s[2]||(s[2]=r=>e(o).fecha_inicio=r),type:"date",class:z({"border-red-500":e(o).errors.fecha_inicio}),required:""},null,8,["modelValue","class"]),e(o).errors.fecha_inicio?(l(),m("p",Qe,f(e(o).errors.fecha_inicio),1)):y("",!0)]),n("div",null,[t(e(h),{for:"fecha_fin"},{default:a(()=>[...s[16]||(s[16]=[c("Fecha de Fin",-1)])]),_:1}),t(e(F),{id:"fecha_fin",modelValue:e(o).fecha_fin,"onUpdate:modelValue":s[3]||(s[3]=r=>e(o).fecha_fin=r),type:"date",min:e(o).fecha_inicio,class:z({"border-red-500":e(o).errors.fecha_fin})},null,8,["modelValue","min","class"]),e(o).errors.fecha_fin?(l(),m("p",We,f(e(o).errors.fecha_fin),1)):y("",!0)])])]),_:1})]),_:1}),t(e(E),null,{default:a(()=>[t(e(N),null,{default:a(()=>[t(e(R),null,{default:a(()=>[...s[17]||(s[17]=[c("Configuración del Proyecto",-1)])]),_:1})]),_:1}),t(e(q),{class:"space-y-4"},{default:a(()=>[n("div",Ze,[n("div",null,[t(e(h),{for:"estado"},{default:a(()=>[...s[18]||(s[18]=[c("Estado *",-1)])]),_:1}),t(e(te),{modelValue:e(o).estado,"onUpdate:modelValue":s[4]||(s[4]=r=>e(o).estado=r)},{default:a(()=>[t(e(oe),null,{default:a(()=>[t(e(ae),{placeholder:"Seleccione el estado"})]),_:1}),t(e(re),null,{default:a(()=>[(l(!0),m(S,null,G(fe.value,(r,k)=>(l(),V(e(le),{key:k,value:k},{default:a(()=>[c(f(r),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(o).errors.estado?(l(),m("p",es,f(e(o).errors.estado),1)):y("",!0)]),n("div",null,[t(e(h),{for:"prioridad"},{default:a(()=>[...s[19]||(s[19]=[c("Prioridad *",-1)])]),_:1}),t(e(te),{modelValue:e(o).prioridad,"onUpdate:modelValue":s[5]||(s[5]=r=>e(o).prioridad=r)},{default:a(()=>[t(e(oe),null,{default:a(()=>[t(e(ae),{placeholder:"Seleccione la prioridad"})]),_:1}),t(e(re),null,{default:a(()=>[(l(!0),m(S,null,G(_e.value,(r,k)=>(l(),V(e(le),{key:k,value:k},{default:a(()=>[c(f(r),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),e(o).errors.prioridad?(l(),m("p",ss,f(e(o).errors.prioridad),1)):y("",!0)])]),_.showResponsable?(l(),m("div",ts,[t(e(h),{for:"responsable_id"},{default:a(()=>[...s[20]||(s[20]=[c("Responsable",-1)])]),_:1}),n("div",os,[g.value?(l(),m("div",as,[n("div",null,[n("p",rs,f(g.value.name),1),n("p",ls,f(g.value.email),1)]),t(e(U),{type:"button",variant:"ghost",size:"sm",onClick:s[6]||(s[6]=r=>{e(o).responsable_id=null,g.value=null})},{default:a(()=>[t(e(T),{class:"h-4 w-4"})]),_:1})])):y("",!0),t(e(U),{type:"button",variant:"outline",onClick:s[7]||(s[7]=r=>b.value=!0),class:"w-full"},{default:a(()=>[t(e(ce),{class:"h-4 w-4 mr-2"}),c(" "+f(g.value?"Cambiar Responsable":"Seleccionar Responsable"),1)]),_:1})]),e(o).errors.responsable_id?(l(),m("p",ns,f(e(o).errors.responsable_id),1)):y("",!0)])):y("",!0),_.categorias&&_.categorias.length>0?(l(),m("div",is,[t(e(h),{class:"flex items-center gap-2 mb-2"},{default:a(()=>[t(e(Fe),{class:"h-4 w-4"}),s[21]||(s[21]=c(" Etiquetas ",-1))]),_:1}),t(Ue,{modelValue:e(o).etiquetas,"onUpdate:modelValue":s[8]||(s[8]=r=>e(o).etiquetas=r),categorias:_.categorias,"max-etiquetas":10,placeholder:"Seleccionar etiquetas para el proyecto...",description:"Puedes asignar hasta 10 etiquetas para categorizar este proyecto"},null,8,["modelValue","categorias"]),e(o).errors.etiquetas?(l(),m("p",ds,f(e(o).errors.etiquetas),1)):y("",!0)])):y("",!0)]),_:1})]),_:1}),_.showGestores?(l(),V(He,{key:0,modelValue:e(o).gestores,"onUpdate:modelValue":s[9]||(s[9]=r=>e(o).gestores=r),gestores:_.gestores},null,8,["modelValue","gestores"])):y("",!0),_.tokensNomenclatura&&_.tokensNomenclatura.length>0?(l(),V(e(E),{key:1},{default:a(()=>[t(e(N),null,{default:a(()=>[t(e(R),{class:"flex items-center gap-2"},{default:a(()=>[t(e(Ie),{class:"h-5 w-5"}),s[22]||(s[22]=c(" Nomenclatura de Archivos ",-1))]),_:1})]),_:1}),t(e(q),{class:"space-y-4"},{default:a(()=>[s[26]||(s[26]=n("p",{class:"text-sm text-muted-foreground"}," Define cómo se nombrarán los archivos de evidencias subidos a este proyecto. Haz clic en los tokens para insertarlos en el patrón. ",-1)),n("div",us,[t(e(Ae),null,{default:a(()=>[(l(!0),m(S,null,G(_.tokensNomenclatura,r=>(l(),V(e(ze),{key:r.token},{default:a(()=>[t(e(Ee),{"as-child":""},{default:a(()=>[t(e(de),{variant:"outline",class:"cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors",onClick:k=>v(r.token)},{default:a(()=>[c(f(r.token),1)]),_:2},1032,["onClick"])]),_:2},1024),t(e(qe),null,{default:a(()=>[n("p",null,f(r.descripcion),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),n("div",null,[t(e(h),{for:"nomenclatura_archivos"},{default:a(()=>[...s[23]||(s[23]=[c("Patrón de nomenclatura",-1)])]),_:1}),t(e(F),{id:"nomenclatura_archivos",ref_key:"nomenclaturaInput",ref:A,modelValue:e(o).nomenclatura_archivos,"onUpdate:modelValue":s[10]||(s[10]=r=>e(o).nomenclatura_archivos=r),type:"text",placeholder:"{proyecto_id}-{hito_id}-{entregable_id}_{fecha:Ymd}_{original}",class:z({"border-red-500":e(o).errors.nomenclatura_archivos})},null,8,["modelValue","class"]),e(o).errors.nomenclatura_archivos?(l(),m("p",cs,f(e(o).errors.nomenclatura_archivos),1)):y("",!0)]),n("div",ms,[n("div",ps,[t(e(Ge),{class:"h-4 w-4 text-muted-foreground"}),s[24]||(s[24]=n("span",{class:"text-sm font-medium"},"Vista previa:",-1))]),n("code",fs,f(i.value),1),s[25]||(s[25]=n("p",{class:"text-xs text-muted-foreground mt-2"}," El identificador único (_a1b2c3) y la extensión (.pdf) se agregan automáticamente. ",-1))])]),_:1})]),_:1})):y("",!0),_.camposPersonalizados.length>0?(l(),V(Ce,{key:2,campos:_.camposPersonalizados,valores:w,errors:e(o).errors,onUpdate:ve},null,8,["campos","errors"])):y("",!0),!_.showResponsable&&!x&&_.showInfoAlert?(l(),V(e(Se),{key:3},{default:a(()=>[t(e(Ne),{class:"h-4 w-4"}),t(e(we),null,{default:a(()=>[...s[27]||(s[27]=[c(" Los cambios se guardarán inmediatamente. Si necesitas cambiar el responsable del proyecto, contacta con un administrador. ",-1)])]),_:1})]),_:1})):y("",!0),t(e(E),null,{default:a(()=>[t(e(q),{class:"flex justify-end gap-4 pt-6"},{default:a(()=>[t(e(U),{type:"button",variant:"outline",onClick:ye,disabled:p.value},{default:a(()=>[t(e(T),{class:"mr-2 h-4 w-4"}),s[28]||(s[28]=c(" Cancelar ",-1))]),_:1},8,["disabled"]),t(e(U),{type:"submit",disabled:p.value||e(o).processing},{default:a(()=>[t(e(Re),{class:"mr-2 h-4 w-4"}),x?(l(),m(S,{key:0},[c(f(p.value?"Guardando...":"Guardar Proyecto"),1)],64)):(l(),m(S,{key:1},[c(f(p.value?"Actualizando...":"Actualizar Proyecto"),1)],64))]),_:1},8,["disabled"])]),_:1})]),_:1}),_.showResponsable&&_.searchUsersEndpoint?(l(),V(ue,{key:4,modelValue:b.value,"onUpdate:modelValue":s[11]||(s[11]=r=>b.value=r),title:"Seleccionar Responsable",description:"Selecciona el usuario que será responsable de este proyecto","search-endpoint":_.searchUsersEndpoint,"excluded-ids":e(o).responsable_id?[e(o).responsable_id]:[],"max-selection":1,"submit-button-text":"Seleccionar Responsable","search-placeholder":"Buscar por nombre, email, documento o teléfono...",onSubmit:be},null,8,["modelValue","search-endpoint","excluded-ids"])):y("",!0)],32))}});export{js as _};
