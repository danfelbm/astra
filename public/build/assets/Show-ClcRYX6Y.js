import{d as ae,C as te,r as g,c as y,m as N,o as re,z as se,i as b,e as u,f as t,g as s,u as e,p as ie,A as le,b as c,j as f,w as i,h as d,t as p,F as j,k as ne,ai as ue,W as de}from"./app-CNcf-zdV.js";import{_ as z}from"./createLucideIcon-DgLLtpTc.js";import{c as F,_ as B,a as M,b as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-DhL5ChM3.js";import{_ as q}from"./CardDescription.vue_vue_type_script_setup_true_lang-C68I3fFy.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-CXr4ucc6.js";import{_ as k}from"./Label.vue_vue_type_script_setup_true_lang-BFduy937.js";import{_ as I,a as R}from"./index-BXNWrcHO.js";import{_ as me}from"./index-s_YMJFqv.js";import{_ as ce}from"./Progress.vue_vue_type_script_setup_true_lang-CIVpzJ8O.js";import{D as fe}from"./DynamicFormRenderer-BqV_uhYY.js";import{u as pe}from"./useAutoSave-Ba6naaoY.js";import{t as v}from"./index-UZehIf0x.js";import{C as W}from"./circle-check-BQI9FbJM.js";import{C as G}from"./circle-alert-BWYDLxj9.js";import{L as O}from"./loader-circle-DT0CjkEL.js";import{C as ve}from"./clock-Bv_E-7na.js";import{S as _e}from"./save-Bvcpe2E0.js";import{S as ge}from"./send-Cs3Svvwv.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BfcJxwg-.js";import"./VisuallyHidden-BMJ7uEAj.js";import"./nullish-CHIgUVhi.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BDqsklM1.js";import"./index-C53AKuaZ.js";import"./floating-ui.vue-g3wBdaGy.js";import"./check-N9bkD0I5.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Bt0xndJV.js";import"./Textarea.vue_vue_type_script_setup_true_lang-BLahoW9V.js";import"./plus-B0xw1qKM.js";import"./file-text-VjUXoo3d.js";import"./user-DzTPpMzP.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-Cu2pXtyO.js";import"./RovingFocusItem-KgjJr8lb.js";import"./utils-D1nKU7ku.js";import"./VisuallyHiddenInput-DQv9Xmp3.js";import"./circle-DT2yxC1F.js";import"./users-BCniY5Uo.js";import"./index-DoUjDw3v.js";import"./useConditionalFields-eBFzcq01.js";import"./upload-BXITFokJ.js";import"./file-CVZe8Z59.js";import"./eye-DkPQI3fu.js";import"./download-lfq_ZiSa.js";import"./x-arLKReWz.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CS3Y7RjP.js";import"./calendar-DAAYlVnm.js";import"./grip-vertical-DNH1M1QZ.js";import"./trash-2-BaR4XxZx.js";import"./debounce-BMmXVQ06.js";const he={class:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"},xe={class:"bg-white border-b"},we={class:"container mx-auto px-4 py-6"},ye={class:"max-w-4xl mx-auto"},Ve={class:"text-3xl font-bold text-gray-900"},ke={key:1,class:"text-gray-600 mt-2"},Se={class:"container mx-auto px-4 py-8"},Ce={class:"max-w-4xl mx-auto"},$e={class:"flex items-center justify-between mb-2"},Fe={class:"text-sm text-muted-foreground"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"flex items-center gap-2 text-green-600"},De={class:"list-disc list-inside mt-2"},Te={class:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t shadow-lg z-50"},Le={class:"container mx-auto px-4"},Ae={class:"max-w-4xl mx-auto py-4"},Ue={class:"flex items-center justify-between"},Ne={class:"flex items-center gap-4"},je={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},ze={key:1,class:"flex items-center gap-2 text-sm text-green-600"},Me={class:"hidden md:flex items-center gap-2 text-sm text-muted-foreground"},Pe={class:"flex items-center gap-2"},qe=ae({__name:"Show",props:{formulario:{},respuestaBorrador:{},esVisitante:{type:Boolean},candidatosElegibles:{}},setup(K){var A,U;const r=K,l=te({respuestas:((A=r.respuestaBorrador)==null?void 0:A.respuestas)||{},nombre_visitante:"",email_visitante:"",telefono_visitante:"",documento_visitante:"",captcha:""}),x=g((()=>{var o;const a={};return(o=r.respuestaBorrador)!=null&&o.respuestas&&Object.assign(a,r.respuestaBorrador.respuestas),r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.forEach(n=>{if(!(n.id in a))switch(n.type){case"checkbox":a[n.id]=!1;break;case"number":a[n.id]=0;break;case"select":case"radio":a[n.id]="";break;default:a[n.id]=""}}),a})());g(0),y(()=>1);const S=y(()=>r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.length>0),m=g(!1),H=g(!0),C=g(null),_=y(()=>{const a=r.formulario.configuracion_campos.length,o=Object.keys(l.respuestas).filter(n=>{const h=l.respuestas[n];return h!==null&&h!==""&&h!==void 0}).length;return a>0?Math.round(o/a*100):0}),{state:E,isSaving:w,hasSaved:D,saveNow:J,startWatching:$,stopWatching:T,clearLocalStorage:Q}=pe(x||g({}),{url:route("api.formularios.autosave"),resourceId:((U=r.respuestaBorrador)==null?void 0:U.id)||null,resourceIdField:"respuesta_id",debounceTime:3e3,showNotifications:!1,useLocalStorage:!0,localStorageKey:`formulario_${r.formulario.slug}_draft`,additionalData:{formulario_id:r.formulario.id}});N(x,a=>{a&&(l.respuestas=a)},{deep:!0}),N(()=>E.value.status,a=>{a==="saved"&&(C.value=E.value.lastSaved)}),re(()=>{r.esVisitante||$(),window.addEventListener("beforeunload",L)}),se(()=>{r.esVisitante||T(),window.removeEventListener("beforeunload",L)});const L=a=>{(w.value||_.value>0&&_.value<100)&&(a.preventDefault(),a.returnValue="¿Estás seguro de que quieres salir? Los cambios no guardados se perderán.")},X=()=>{const a=r.formulario.configuracion_campos||[];for(const o of a)if(o.required&&!l.respuestas[o.id])return v.error(`El campo "${o.title}" es requerido`),!1;if(r.esVisitante){if(!l.nombre_visitante||!l.email_visitante)return v.error("Por favor completa tu nombre y email"),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email_visitante))return v.error("Por favor ingresa un email válido"),!1}return!0},Y=async()=>{if(X()){m.value=!0,r.esVisitante||T();try{const a={...l.data(),formulario_id:r.formulario.id};await de.post(route("formularios.store",r.formulario.slug),a,{preserveScroll:!0,onSuccess:()=>{Q(),v.success("Formulario enviado exitosamente")},onError:o=>{v.error("Error al enviar el formulario"),console.error(o),m.value=!1,r.esVisitante||$()}})}catch{v.error("Error inesperado al enviar el formulario"),m.value=!1,r.esVisitante||$()}}},Z=()=>{r.esVisitante||(J(),v.success("Borrador guardado"))},ee=y(()=>{if(!C.value)return"";const o=Math.floor((new Date().getTime()-C.value.getTime())/1e3);return o<60?"hace unos segundos":o<3600?`hace ${Math.floor(o/60)} minutos`:o<86400?`hace ${Math.floor(o/3600)} horas`:"hace más de un día"}),oe=a=>{x.value=a||{}};return(a,o)=>(u(),b(j,null,[t(e(ie),{title:a.formulario.titulo},null,8,["title"]),s("div",he,[s("div",xe,[s("div",we,[s("div",ye,[a.formulario.categoria?(u(),c(e(me),{key:0,class:"mb-2"},{default:i(()=>[d(p(a.formulario.categoria.nombre),1)]),_:1})):f("",!0),s("h1",Ve,p(a.formulario.titulo),1),a.formulario.descripcion?(u(),b("p",ke,p(a.formulario.descripcion),1)):f("",!0)])])]),s("div",Se,[s("div",Ce,[t(e(B),{class:"mb-6"},{default:i(()=>[t(e(F),{class:"py-4"},{default:i(()=>[s("div",$e,[o[4]||(o[4]=s("span",{class:"text-sm font-medium"},"Progreso del formulario",-1)),s("span",Fe,p(_.value)+"% completado",1)]),t(e(ce),{value:_.value,class:"h-2"},null,8,["value"])]),_:1})]),_:1}),a.esVisitante?(u(),c(e(B),{key:0,class:"mb-6"},{default:i(()=>[t(e(M),null,{default:i(()=>[t(e(P),null,{default:i(()=>[...o[5]||(o[5]=[d("Información de contacto",-1)])]),_:1}),t(e(q),null,{default:i(()=>[...o[6]||(o[6]=[d(" Por favor proporciona tus datos para poder contactarte ",-1)])]),_:1})]),_:1}),t(e(F),{class:"space-y-4"},{default:i(()=>[s("div",Be,[s("div",null,[t(e(k),{htmlFor:"nombre"},{default:i(()=>[...o[7]||(o[7]=[d("Nombre completo *",-1)])]),_:1}),t(e(V),{id:"nombre",modelValue:e(l).nombre_visitante,"onUpdate:modelValue":o[0]||(o[0]=n=>e(l).nombre_visitante=n),placeholder:"Tu nombre completo",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(k),{htmlFor:"email"},{default:i(()=>[...o[8]||(o[8]=[d("Correo electrónico *",-1)])]),_:1}),t(e(V),{id:"email",type:"email",modelValue:e(l).email_visitante,"onUpdate:modelValue":o[1]||(o[1]=n=>e(l).email_visitante=n),placeholder:"tu@email.com",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(k),{htmlFor:"telefono"},{default:i(()=>[...o[9]||(o[9]=[d("Teléfono",-1)])]),_:1}),t(e(V),{id:"telefono",modelValue:e(l).telefono_visitante,"onUpdate:modelValue":o[2]||(o[2]=n=>e(l).telefono_visitante=n),placeholder:"Tu número de teléfono",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(k),{htmlFor:"documento"},{default:i(()=>[...o[10]||(o[10]=[d("Documento de identidad",-1)])]),_:1}),t(e(V),{id:"documento",modelValue:e(l).documento_visitante,"onUpdate:modelValue":o[3]||(o[3]=n=>e(l).documento_visitante=n),placeholder:"Tu número de documento",disabled:m.value},null,8,["modelValue","disabled"])])])]),_:1})]),_:1})):f("",!0),t(e(B),{class:"mb-20"},{default:i(()=>[t(e(M),null,{default:i(()=>[t(e(P),null,{default:i(()=>[...o[11]||(o[11]=[d("Completa el formulario",-1)])]),_:1}),!a.esVisitante&&e(D)?(u(),c(e(q),{key:0},{default:i(()=>[s("div",Ee,[t(e(W),{class:"h-4 w-4"}),d(" Autoguardado "+p(ee.value),1)])]),_:1})):f("",!0)]),_:1}),t(e(F),null,{default:i(()=>[S.value?f("",!0):(u(),c(e(I),{key:0,variant:"destructive",class:"mb-4"},{default:i(()=>[t(e(G),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>[...o[12]||(o[12]=[d(" Este formulario no tiene campos configurados. Por favor, contacta al administrador. ",-1)])]),_:1})]),_:1})),S.value?(u(),c(fe,{key:1,fields:a.formulario.configuracion_campos||[],"model-value":x.value||{},disabled:m.value,"candidatos-elegibles":r.candidatosElegibles||{},context:"formulario","onUpdate:modelValue":oe},null,8,["fields","model-value","disabled","candidatos-elegibles"])):f("",!0)]),_:1})]),_:1}),e(l).errors&&Object.keys(e(l).errors).length>0?(u(),c(e(I),{key:1,class:"mb-6",variant:"destructive"},{default:i(()=>[t(e(G),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>[s("ul",De,[(u(!0),b(j,null,ne(e(l).errors,(n,h)=>(u(),b("li",{key:h},p(n),1))),128))])]),_:1})]),_:1})):f("",!0)])]),le(s("div",Te,[s("div",Le,[s("div",Ae,[s("div",Ue,[s("div",Ne,[e(w)?(u(),b("div",je,[t(e(O),{class:"h-4 w-4 animate-spin"}),o[13]||(o[13]=d(" Guardando... ",-1))])):e(D)&&!a.esVisitante?(u(),b("div",ze,[t(e(W),{class:"h-4 w-4"}),o[14]||(o[14]=d(" Guardado ",-1))])):f("",!0),s("div",Me,[t(e(ve),{class:"h-4 w-4"}),d(" "+p(_.value)+"% completado ",1)])]),s("div",Pe,[a.esVisitante?f("",!0):(u(),c(e(z),{key:0,variant:"outline",size:"sm",onClick:Z,disabled:e(w)||m.value},{default:i(()=>[t(e(_e),{class:"mr-2 h-4 w-4"}),o[15]||(o[15]=d(" Guardar borrador ",-1))]),_:1},8,["disabled"])),t(e(z),{size:"sm",onClick:Y,disabled:m.value||e(w)||_.value===0||!S.value},{default:i(()=>[m.value?(u(),c(e(O),{key:1,class:"mr-2 h-4 w-4 animate-spin"})):(u(),c(e(ge),{key:0,class:"mr-2 h-4 w-4"})),d(" "+p(m.value?"Enviando...":"Enviar formulario"),1)]),_:1},8,["disabled"])])])])])],512),[[ue,H.value]])])],64))}}),Mo=be(qe,[["__scopeId","data-v-77040375"]]);export{Mo as default};
