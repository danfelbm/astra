import{d as se,c as g,r as S,p as oe,s as ie,i as b,e as a,f as t,q as ne,w as l,g as o,t as d,b as y,j as h,v as j,h as u,m as c,n as U,F as N,k as H,y as re}from"./app-DEzZOURC.js";import{_ as de}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BvLJVOM7.js";import{_ as $,a as w,c as k,b as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-BV0jufEp.js";import{_ as E}from"./CardDescription.vue_vue_type_script_setup_true_lang-DJSVYZ9o.js";import{_ as q}from"./createLucideIcon-DohhYgk8.js";import{_ as F}from"./index-CGvVJqrJ.js";import{_ as ue}from"./Progress.vue_vue_type_script_setup_true_lang-CwugpKb6.js";import{_ as B,a as L,b as R}from"./index-DeH-pv-7.js";import{_ as ce,a as me,b as z,c as D}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Dtn1MrxO.js";import{_ as fe,a as ve}from"./index-BF-x3BBe.js";import{_ as pe}from"./AccordionContent.vue_vue_type_script_setup_true_lang-0_ZoZIJi.js";import{_ as ge}from"./EvidenciasTable.vue_vue_type_script_setup_true_lang-CZ4Z9DLU.js";import{_ as be,a as _e}from"./ActivityLog.vue_vue_type_script_setup_true_lang-COFWPmv1.js";import{_ as he}from"./CamposPersonalizadosDisplay.vue_vue_type_script_setup_true_lang-GxxLxuMo.js";import{n as ye,d as xe,f as O,e as Y}from"./es-BDPlFIsO.js";import{A as $e}from"./arrow-left-B1LiPixJ.js";import{S as we}from"./square-pen-GzBA7ALY.js";import{F as ke}from"./flag-C_1jItes.js";import{C as Ce}from"./clock-ruu7WjdB.js";import{F as Ve}from"./file-text-C9zEytbd.js";import{U as Ee}from"./users-B1k3ML8c.js";import{I as Me}from"./image-CaIoaABb.js";import{A as Pe}from"./activity-CZZbR-bm.js";import{C as G}from"./calendar-BXfqlLj_.js";import{C as Ae}from"./circle-alert-X6MccTox.js";import{T as Fe}from"./tag-07w5gLv3.js";import{p as J}from"./parseISO-DFjB8F03.js";import"./useFlashMessages-G6vUKqhK.js";import"./index-3U8T0bXN.js";import"./floating-ui.vue-CNVnrzQ6.js";import"./x-BdW0pKp0.js";import"./Input.vue_vue_type_script_setup_true_lang-COtV7FBT.js";import"./index-CGjeYSaZ.js";import"./shield-v_c_SioD.js";import"./user-DMcVgmMs.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-C-bQk9Jr.js";import"./chevron-right-JEmf8ro0.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BMUbVDNN.js";import"./VisuallyHidden-C06NJWsc.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-9Y_chwli.js";import"./check-qeInYPZJ.js";import"./Label.vue_vue_type_script_setup_true_lang-D8RSzcrz.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-CLIcw_SL.js";import"./index-Bg_w5wnj.js";import"./map-pin-D2m82ToI.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-JnGW82kg.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BesUUdub.js";import"./chevrons-up-down-UYQpQvfE.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-j-QaoWjJ.js";import"./target-Cuz-3zut.js";import"./vote-BlmfRYVo.js";import"./folder-open-Z__awBRA.js";import"./send-FWm4ppT0.js";import"./briefcase-DKJLxWbX.js";import"./megaphone-DWuh18C-.js";import"./user-check-BqaVpK58.js";import"./clipboard-list-CNsoOyAw.js";import"./mail-66hbcDzv.js";import"./message-square-DR9MXgv_.js";import"./external-link-DCWmPvs0.js";import"./panel-left-DRNx9GZv.js";import"./index-Bzqze5Wq.js";import"./RovingFocusItem-YQXf-yKT.js";import"./utils-B_qebaiu.js";import"./useArrowNavigation-B5rxJs06.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-a-IEHQpo.js";import"./eye-CZxFilWb.js";import"./download-_bMh8Bw-.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BdtqPVCR.js";import"./filter-DtwJOhjo.js";function ze(s,r,_){const[x,M]=ye(_==null?void 0:_.in,s,r),P=K(x,M),C=Math.abs(xe(x,M));x.setDate(x.getDate()-P*C);const m=+(K(x,M)===-P),v=P*(C-m);return v===0?0:v}function K(s,r){const _=s.getFullYear()-r.getFullYear()||s.getMonth()-r.getMonth()||s.getDate()-r.getDate()||s.getHours()-r.getHours()||s.getMinutes()-r.getMinutes()||s.getSeconds()-r.getSeconds()||s.getMilliseconds()-r.getMilliseconds();return _<0?-1:_>0?1:_}const De={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ie={class:"flex items-center justify-between"},Se={class:"text-3xl font-bold"},Ne={class:"text-muted-foreground mt-2"},Te={class:"flex gap-2"},je={class:"grid gap-4 md:grid-cols-4"},Ue={class:"flex items-center gap-2"},He={class:"font-medium capitalize"},qe={class:"space-y-2"},Be={class:"flex justify-between"},Le={class:"text-2xl font-bold"},Re={key:0,class:"flex items-center gap-2"},Oe={class:"font-medium"},Ye={key:1,class:"text-muted-foreground"},Ge={key:0},Je={class:"text-sm"},Ke={class:"grid gap-4 md:grid-cols-2"},Qe={class:"flex items-center gap-2"},We={class:"flex items-center gap-2"},Xe={key:1},Ze={class:"border-t pt-4"},et={class:"space-y-3 text-sm"},tt={class:"block"},at={class:"block"},lt={class:"block"},st={class:"flex items-center gap-2"},ot={class:"flex flex-wrap gap-2"},it={key:0,class:"flex items-center gap-3"},nt={class:"font-medium"},rt={class:"text-sm text-muted-foreground"},dt={key:1,class:"text-muted-foreground"},ut={key:0,class:"space-y-3"},ct={class:"flex items-center gap-3"},mt={class:"font-medium"},ft={class:"text-sm text-muted-foreground"},vt={key:1,class:"text-muted-foreground"},Fa=se({__name:"Show",props:{proyecto:{},hito:{},entregable:{},usuariosAsignados:{},actividades:{},usuariosActividades:{},camposPersonalizados:{},valoresCamposPersonalizados:{},canEdit:{type:Boolean},canDelete:{type:Boolean}},setup(s){const r=s,_=g(()=>r.usuariosAsignados||[]),x=g(()=>r.actividades||[]),M=["detalles","equipo","evidencias","actividad"],C=S((()=>{const e=new URLSearchParams(window.location.search).get("tab");return e&&M.includes(e)?e:"detalles"})());oe(C,i=>{const e=`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables/${r.entregable.id}?tab=${i}`;ie.get(e,{},{preserveState:!0,preserveScroll:!0,replace:!0,only:[]})});const m=S({contrato_id:null,fecha_inicio:null,fecha_fin:null,tipo:null,estado:null,usuario_id:null}),v=S({usuario_id:null,tipo_entidad:null,tipo_accion:null,fecha_inicio:null,fecha_fin:null}),Q=[{title:"Admin",href:"/admin/dashboard"},{title:"Proyectos",href:"/admin/proyectos"},{title:r.proyecto.nombre,href:`/admin/proyectos/${r.proyecto.id}`},{title:"Hitos",href:`/admin/proyectos/${r.proyecto.id}/hitos`},{title:r.hito.nombre,href:`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}`},{title:"Entregables",href:`/admin/proyectos/${r.proyecto.id}/hitos/${r.hito.id}/entregables`},{title:r.entregable.nombre}],W=g(()=>({pendiente:"secondary",en_progreso:"default",completado:"outline",cancelado:"destructive"})[r.entregable.estado]||"default"),X=g(()=>({pendiente:"Pendiente",en_progreso:"En Progreso",completado:"Completado",cancelado:"Cancelado"})[r.entregable.estado]||r.entregable.estado),Z=g(()=>({baja:"text-blue-500",media:"text-yellow-500",alta:"text-red-500"})[r.entregable.prioridad]||""),p=g(()=>r.entregable.fecha_fin?ze(new Date(r.entregable.fecha_fin),new Date):null);g(()=>{if(r.entregable.estado==="completado")return"Completado";if(r.entregable.estado==="cancelado")return"Cancelado";if(p.value!==null){if(p.value<0)return"Vencido";if(p.value===0)return"Vence hoy";if(p.value<=3)return"Por vencer"}return"En curso"});const I=i=>i?O(J(i),"d 'de' MMMM 'de' yyyy",{locale:Y}):"No definida",T=i=>O(J(i),"d MMM yyyy 'a las' HH:mm",{locale:Y}),V=g(()=>r.entregable.evidencias||[]),ee=g(()=>{const i=new Map;return V.value.forEach(e=>{var n;if((n=e.obligacion)!=null&&n.contrato){const f=e.obligacion.contrato;i.has(f.id)||i.set(f.id,{id:f.id,nombre:f.nombre})}}),Array.from(i.values())}),te=g(()=>{let i=V.value;return m.value.contrato_id&&(i=i.filter(e=>{var n;return((n=e.obligacion)==null?void 0:n.contrato_id)===m.value.contrato_id})),m.value.tipo&&(i=i.filter(e=>e.tipo_evidencia===m.value.tipo)),m.value.estado&&(i=i.filter(e=>e.estado===m.value.estado)),m.value.usuario_id&&(i=i.filter(e=>{var n;return((n=e.usuario)==null?void 0:n.id)===m.value.usuario_id})),(m.value.fecha_inicio||m.value.fecha_fin)&&(i=i.filter(e=>{const n=new Date(e.created_at);if(m.value.fecha_inicio){const f=new Date(m.value.fecha_inicio);if(n<f)return!1}if(m.value.fecha_fin){const f=new Date(m.value.fecha_fin);if(f.setHours(23,59,59,999),n>f)return!1}return!0})),i}),ae=g(()=>{const i={};return te.value.forEach(e=>{var n;if((n=e.obligacion)!=null&&n.contrato){const f=e.obligacion.contrato.id;i[f]||(i[f]={contrato:e.obligacion.contrato,evidencias:[]}),i[f].evidencias.push({...e,obligacion_titulo:e.obligacion.titulo})}}),Object.values(i)}),le=g(()=>{let i=r.actividades||[];return v.value.usuario_id&&(i=i.filter(e=>{var n;return((n=e.causer)==null?void 0:n.id)===v.value.usuario_id})),v.value.tipo_accion&&(i=i.filter(e=>e.event===v.value.tipo_accion)),(v.value.fecha_inicio||v.value.fecha_fin)&&(i=i.filter(e=>{const n=new Date(e.created_at);if(v.value.fecha_inicio){const f=new Date(v.value.fecha_inicio);if(n<f)return!1}if(v.value.fecha_fin){const f=new Date(v.value.fecha_fin);if(f.setHours(23,59,59,999),n>f)return!1}return!0})),i});return(i,e)=>(c(),b(N,null,[a(t(ne),{title:`Entregable - ${s.entregable.nombre}`},null,8,["title"]),a(de,{breadcrumbs:Q},{default:l(()=>[o("div",De,[o("div",Ie,[o("div",null,[o("h1",Se,d(s.entregable.nombre),1),o("p",Ne,' Entregable del hito "'+d(s.hito.nombre)+'" ',1)]),o("div",Te,[a(t(j),{href:`/admin/proyectos/${s.proyecto.id}/hitos/${s.hito.id}/entregables`},{default:l(()=>[a(t(q),{variant:"outline",size:"sm"},{default:l(()=>[a(t($e),{class:"h-4 w-4 mr-2"}),e[3]||(e[3]=u(" Volver ",-1))]),_:1})]),_:1},8,["href"]),s.canEdit?(c(),y(t(j),{key:0,href:`/admin/proyectos/${s.proyecto.id}/hitos/${s.hito.id}/entregables/${s.entregable.id}/edit`},{default:l(()=>[a(t(q),{variant:"outline",size:"sm"},{default:l(()=>[a(t(we),{class:"h-4 w-4 mr-2"}),e[4]||(e[4]=u(" Editar ",-1))]),_:1})]),_:1},8,["href"])):h("",!0)])]),o("div",je,[a(t($),null,{default:l(()=>[a(t(w),{class:"pb-2"},{default:l(()=>[a(t(E),null,{default:l(()=>[...e[5]||(e[5]=[u("Estado",-1)])]),_:1})]),_:1}),a(t(k),null,{default:l(()=>[a(t(F),{variant:W.value,class:"text-sm"},{default:l(()=>[u(d(X.value),1)]),_:1},8,["variant"])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[a(t(w),{class:"pb-2"},{default:l(()=>[a(t(E),null,{default:l(()=>[...e[6]||(e[6]=[u("Prioridad",-1)])]),_:1})]),_:1}),a(t(k),null,{default:l(()=>[o("div",Ue,[a(t(ke),{class:U(["h-4 w-4",Z.value])},null,8,["class"]),o("span",He,d(s.entregable.prioridad),1)])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[a(t(w),{class:"pb-2"},{default:l(()=>[a(t(E),null,{default:l(()=>[...e[7]||(e[7]=[u("Progreso",-1)])]),_:1})]),_:1}),a(t(k),null,{default:l(()=>[o("div",qe,[o("div",Be,[o("span",Le,d(s.entregable.porcentaje_completado)+"%",1)]),a(t(ue),{"model-value":s.entregable.porcentaje_completado},null,8,["model-value"])])]),_:1})]),_:1}),a(t($),null,{default:l(()=>[a(t(w),{class:"pb-2"},{default:l(()=>[a(t(E),null,{default:l(()=>[...e[8]||(e[8]=[u("Tiempo Restante",-1)])]),_:1})]),_:1}),a(t(k),null,{default:l(()=>[p.value!==null?(c(),b("div",Re,[a(t(Ce),{class:U(["h-4 w-4",{"text-red-500":p.value<0,"text-yellow-500":p.value>=0&&p.value<=3,"text-green-500":p.value>3}])},null,8,["class"]),o("span",Oe,d(p.value<0?`Vencido hace ${Math.abs(p.value)} días`:p.value===0?"Vence hoy":`${p.value} días`),1)])):(c(),b("span",Ye,"Sin fecha límite"))]),_:1})]),_:1})]),a(t(ce),{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=n=>C.value=n),class:"flex-1"},{default:l(()=>[a(t(me),null,{default:l(()=>[a(t(z),{value:"detalles"},{default:l(()=>[a(t(Ve),{class:"h-4 w-4 mr-2"}),e[9]||(e[9]=u(" Detalles ",-1))]),_:1}),a(t(z),{value:"equipo"},{default:l(()=>[a(t(Ee),{class:"h-4 w-4 mr-2"}),e[10]||(e[10]=u(" Equipo ",-1))]),_:1}),a(t(z),{value:"evidencias"},{default:l(()=>[a(t(Me),{class:"h-4 w-4 mr-2"}),e[11]||(e[11]=u(" Evidencias ",-1)),V.value.length>0?(c(),y(t(F),{key:0,class:"ml-2 h-5 px-1.5",variant:"secondary"},{default:l(()=>[u(d(V.value.length),1)]),_:1})):h("",!0)]),_:1}),a(t(z),{value:"actividad"},{default:l(()=>[a(t(Pe),{class:"h-4 w-4 mr-2"}),e[12]||(e[12]=u(" Actividad ",-1))]),_:1})]),_:1}),a(t(D),{value:"detalles",class:"space-y-4"},{default:l(()=>[a(t($),null,{default:l(()=>[a(t(w),null,{default:l(()=>[a(t(A),null,{default:l(()=>[...e[13]||(e[13]=[u("Información General",-1)])]),_:1})]),_:1}),a(t(k),{class:"space-y-4"},{default:l(()=>[s.entregable.descripcion?(c(),b("div",Ge,[e[14]||(e[14]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Descripción",-1)),o("p",Je,d(s.entregable.descripcion),1)])):h("",!0),o("div",Ke,[o("div",null,[e[15]||(e[15]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Fecha de Inicio",-1)),o("div",Qe,[a(t(G),{class:"h-4 w-4"}),o("span",null,d(I(s.entregable.fecha_inicio)),1)])]),o("div",null,[e[16]||(e[16]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Fecha de Fin",-1)),o("div",We,[a(t(G),{class:"h-4 w-4"}),o("span",null,d(I(s.entregable.fecha_fin)),1)])])]),s.entregable.notas?(c(),b("div",Xe,[e[17]||(e[17]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Notas",-1)),a(t(fe),null,{default:l(()=>[a(t(Ae),{class:"h-4 w-4"}),a(t(ve),null,{default:l(()=>[u(d(s.entregable.notas),1)]),_:1})]),_:1})])):h("",!0),o("div",Ze,[e[21]||(e[21]=o("h4",{class:"text-sm font-medium text-muted-foreground mb-4"},"Metadatos",-1)),o("div",et,[o("div",null,[e[18]||(e[18]=o("span",{class:"text-muted-foreground text-xs font-medium block mb-1"},"Creado",-1)),o("span",tt,d(T(s.entregable.created_at)),1)]),o("div",null,[e[19]||(e[19]=o("span",{class:"text-muted-foreground text-xs font-medium block mb-1"},"Última actualización",-1)),o("span",at,d(T(s.entregable.updated_at)),1)]),o("div",null,[e[20]||(e[20]=o("span",{class:"text-muted-foreground text-xs font-medium block mb-1"},"Orden de visualización",-1)),o("span",lt,d(s.entregable.orden),1)])])])]),_:1})]),_:1}),s.camposPersonalizados&&s.camposPersonalizados.length>0?(c(),y(he,{key:0,campos:s.camposPersonalizados,"valores-campos":s.valoresCamposPersonalizados,descripcion:"Información adicional específica del entregable",columns:2},null,8,["campos","valores-campos"])):h("",!0),s.entregable.etiquetas&&s.entregable.etiquetas.length>0?(c(),y(t($),{key:1},{default:l(()=>[a(t(w),null,{default:l(()=>[o("div",st,[a(t(Fe),{class:"h-5 w-5"}),a(t(A),null,{default:l(()=>[...e[22]||(e[22]=[u("Etiquetas",-1)])]),_:1})]),a(t(E),null,{default:l(()=>[...e[23]||(e[23]=[u(" Etiquetas asignadas a este entregable para su organización y categorización ",-1)])]),_:1})]),_:1}),a(t(k),null,{default:l(()=>[o("div",ot,[(c(!0),b(N,null,H(s.entregable.etiquetas,n=>(c(),y(t(F),{key:n.id,variant:"outline",class:"px-3 py-1.5",style:re({borderColor:n.color||"#94a3b8",color:n.color||"#64748b",backgroundColor:`${n.color}15`||"#f1f5f9"})},{default:l(()=>[u(d(n.nombre),1)]),_:2},1032,["style"]))),128))])]),_:1})]),_:1})):h("",!0)]),_:1}),a(t(D),{value:"equipo",class:"space-y-4"},{default:l(()=>[a(t($),null,{default:l(()=>[a(t(w),null,{default:l(()=>[a(t(A),null,{default:l(()=>[...e[24]||(e[24]=[u("Responsable Principal",-1)])]),_:1})]),_:1}),a(t(k),null,{default:l(()=>[s.entregable.responsable?(c(),b("div",it,[a(t(B),{class:"h-10 w-10"},{default:l(()=>[s.entregable.responsable.avatar?(c(),y(t(L),{key:0,src:s.entregable.responsable.avatar},null,8,["src"])):h("",!0),a(t(R),null,{default:l(()=>[u(d(s.entregable.responsable.name.substring(0,2).toUpperCase()),1)]),_:1})]),_:1}),o("div",null,[o("p",nt,d(s.entregable.responsable.name),1),o("p",rt,d(s.entregable.responsable.email),1)])])):(c(),b("p",dt,"No hay responsable asignado"))]),_:1})]),_:1}),a(t($),null,{default:l(()=>[a(t(w),null,{default:l(()=>[a(t(A),null,{default:l(()=>[...e[25]||(e[25]=[u("Colaboradores",-1)])]),_:1}),a(t(E),null,{default:l(()=>[u(d(_.value.length)+" usuarios asignados ",1)]),_:1})]),_:1}),a(t(k),null,{default:l(()=>[_.value.length>0?(c(),b("div",ut,[(c(!0),b(N,null,H(_.value,n=>(c(),b("div",{key:n.user_id,class:"flex items-center justify-between p-3 bg-muted rounded-lg"},[o("div",ct,[a(t(B),{class:"h-8 w-8"},{default:l(()=>[n.user.avatar?(c(),y(t(L),{key:0,src:n.user.avatar},null,8,["src"])):h("",!0),a(t(R),null,{default:l(()=>[u(d(n.user.name.substring(0,2).toUpperCase()),1)]),_:2},1024)]),_:2},1024),o("div",null,[o("p",mt,d(n.user.name),1),o("p",ft,d(n.user.email),1)])]),a(t(F),{variant:"outline"},{default:l(()=>[u(d(n.rol),1)]),_:2},1024)]))),128))])):(c(),b("p",vt,"No hay colaboradores asignados"))]),_:1})]),_:1})]),_:1}),a(t(D),{value:"evidencias",class:"space-y-4 mt-6"},{default:l(()=>[V.value.length>0?(c(),y(pe,{key:0,modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=n=>m.value=n),contratos:ee.value,evidencias:V.value},null,8,["modelValue","contratos","evidencias"])):h("",!0),a(ge,{mode:"grouped","evidencias-agrupadas":ae.value,"format-date":I},null,8,["evidencias-agrupadas"])]),_:1}),a(t(D),{value:"actividad",class:"space-y-4"},{default:l(()=>[x.value&&x.value.length>0?(c(),y(be,{key:0,modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n),usuarios:s.usuariosActividades,"context-level":"entregable"},null,8,["modelValue","usuarios"])):h("",!0),a(_e,{activities:le.value,title:"Historial de Actividad",description:"Registro de cambios y eventos del entregable","empty-message":"No hay actividad registrada"},null,8,["activities"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})],64))}});export{Fa as default};
