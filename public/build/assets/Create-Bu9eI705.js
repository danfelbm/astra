import{d as Q,C as W,c as h,r as X,m as Y,b as k,e as d,w as a,f as i,g as n,u as e,p as Z,P as R,h as l,l as K,i as p,F as b,k as x,t as f,j as ee}from"./app-MhRkZYda.js";import{_ as se}from"./AdminLayout.vue_vue_type_script_setup_true_lang-s8UCj-v6.js";import{_ as v}from"./createLucideIcon-CtoO_Kiv.js";import{_ as $,a as P,b as S,c as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-l03Rvke8.js";import{_ as C}from"./CardDescription.vue_vue_type_script_setup_true_lang-TWLMKxTH.js";import{_ as F}from"./Input.vue_vue_type_script_setup_true_lang-BIqg1Ebh.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-dAqUlvBp.js";import{_ as ie}from"./Textarea.vue_vue_type_script_setup_true_lang-BYdeO-01.js";import{_ as w}from"./Checkbox.vue_vue_type_script_setup_true_lang-CfSurkQy.js";import{_ as L}from"./index-D9cSDYZw.js";import{_ as ae,a as te,b as j,c as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CHhWzZpt.js";import{_ as oe}from"./ScrollArea.vue_vue_type_script_setup_true_lang-UiJvjaO6.js";import{_ as re}from"./Switch.vue_vue_type_script_setup_true_lang-KHOChy3H.js";import{_ as le,a as ne,b as de,c as me,d as ue}from"./SelectValue.vue_vue_type_script_setup_true_lang-Cw5PJOxU.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-DUKEBG_E.js";import{A as pe}from"./arrow-left-CREz2KBm.js";import{S as fe}from"./shield-C7We-wCE.js";import{L as ce}from"./lock-DGE10P5D.js";import{T as _e}from"./target-B9U4ycgp.js";import{H as ge}from"./house-CD7W1tlr.js";import{S as ve}from"./save-BCqaoal8.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-D128fxVw.js";import"./index-CKzDzxRj.js";import"./floating-ui.vue-Jtid5Cir.js";import"./x-DDu6o8kn.js";import"./index-CGlb_uG-.js";import"./user-ByVghZe9.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-ZgmtTIfd.js";import"./chevron-right-CLygI0q1.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BtbY9BuF.js";import"./VisuallyHidden-ClD0DDsS.js";import"./index-D1N0p-74.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-ZdbDwAbT.js";import"./index-C4AhATEj.js";import"./circle-alert-Crskc4s_.js";import"./map-pin-B5DXokRd.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-ZZIvmMj6.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-BqmWBxIU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-B_e-HSmn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DoAxHmi0.js";import"./users-jwOqaBj3.js";import"./vote-BbOfLgcg.js";import"./folder-open-CJtFOPOB.js";import"./send-B-3fqeSw.js";import"./file-text-CSf3KGSt.js";import"./briefcase-BhQcV9fE.js";import"./calendar-G1jntOAT.js";import"./megaphone-l3pQSHwh.js";import"./user-check-TX_Nop_V.js";import"./mail-D2iFew9f.js";import"./message-square-DqgXAPvJ.js";import"./external-link-D5LXOYvq.js";import"./panel-left-Bv2yObtj.js";import"./check-DIKoOxln.js";import"./index-DhGDRjjN.js";import"./RovingFocusItem-CbR6igbu.js";import"./utils-D9jgK0ly.js";import"./VisuallyHiddenInput-Bw6ddUlF.js";import"./nullish-CHIgUVhi.js";const be={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xe={class:"flex items-center justify-between"},ye={class:"space-y-2"},he={class:"space-y-2"},ke={class:"space-y-2"},$e={class:"space-y-2"},Pe={class:"flex items-center justify-between"},Se={class:"space-y-0.5"},Ve={class:"space-y-2"},Ce={class:"flex gap-2 mt-4"},we={class:"space-y-6"},je={class:"flex items-center space-x-2 pb-2 border-b"},Ue={class:"grid grid-cols-2 gap-3 pl-6"},De={key:0,class:"space-y-3"},Ae={class:"flex-1"},Oe={class:"text-xs text-muted-foreground mt-1"},Re={key:1,class:"text-center py-8 text-muted-foreground"},Fe={class:"flex justify-end gap-4"},Ms=Q({__name:"Create",props:{segments:{},availablePermissions:{}},setup(N){const D=N,T=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Crear Rol",href:"#"}],t=W({name:"",display_name:"",description:"",is_administrative:!0,redirect_after_login:"default",permissions:[],segment_ids:[]}),A=[{value:"default",label:"Por defecto (según tipo de rol)"},{value:"admin.dashboard",label:"Dashboard Administrativo",group:"admin"},{value:"admin.candidaturas.dashboard",label:"Dashboard Candidaturas",group:"admin"},{value:"dashboard",label:"Dashboard Usuario",group:"user"},{value:"votaciones.index",label:"Votaciones",group:"user"},{value:"asambleas.index",label:"Asambleas",group:"user"},{value:"formularios.index",label:"Formularios",group:"user"},{value:"postulaciones.index",label:"Postulaciones",group:"user"},{value:"admin.otp-dashboard",label:"Dashboard OTP",group:"admin"},{value:"admin.configuracion.index",label:"Configuración",group:"admin"},{value:"admin.users.index",label:"Usuarios",group:"admin"},{value:"admin.roles.index",label:"Roles y Permisos",group:"admin"},{value:"admin.candidaturas.index",label:"Candidaturas (Lista)",group:"admin"}],G=h(()=>t.is_administrative?A:A.filter(r=>r.group!=="admin"||r.value==="default"));X({});const g=h(()=>t.is_administrative?D.availablePermissions.administrative:D.availablePermissions.frontend),O=r=>{const s=g.value[r];return s?Object.keys(s.permissions).every(m=>t.permissions.includes(m)):!1},z=r=>{const s=g.value[r];if(!s)return!1;const o=Object.keys(s.permissions),m=o.filter(u=>t.permissions.includes(u)).length;return m>0&&m<o.length},B=r=>{const s=t.permissions.indexOf(r);s>-1?t.permissions.splice(s,1):t.permissions.push(r)},E=r=>{const s=g.value[r];if(!s)return;const o=Object.keys(s.permissions);O(r)?t.permissions=t.permissions.filter(u=>!o.includes(u)):o.forEach(u=>{t.permissions.includes(u)||t.permissions.push(u)})},M=r=>{const s=t.segment_ids.indexOf(r);s>-1?t.segment_ids.splice(s,1):t.segment_ids.push(r)},H=()=>{t.post("/admin/roles",{preserveScroll:!0,onSuccess:()=>{}})},q=()=>{const r=[];Object.values(g.value).forEach(s=>{Object.keys(s.permissions).forEach(o=>{r.push(o)})}),t.permissions=r},I=()=>{t.permissions=[]};Y(()=>t.is_administrative,(r,s)=>{s!==void 0&&r!==s&&(t.permissions=[])});const J=h(()=>t.permissions.length);return(r,s)=>(d(),k(se,{breadcrumbs:T},{default:a(()=>[i(e(Z),{title:"Crear Rol"}),n("div",be,[n("div",xe,[s[6]||(s[6]=n("div",null,[n("h2",{class:"text-2xl font-bold tracking-tight"},"Crear Nuevo Rol"),n("p",{class:"text-muted-foreground"}," Define un nuevo rol con permisos específicos ")],-1)),i(e(R),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(v),{variant:"outline"},{default:a(()=>[i(e(pe),{class:"mr-2 h-4 w-4"}),s[5]||(s[5]=l(" Volver ",-1))]),_:1})]),_:1},8,["href"])]),n("form",{onSubmit:K(H,["prevent"]),class:"space-y-6"},[i(e(ae),{defaultValue:"general",class:"space-y-4"},{default:a(()=>[i(e(te),{class:"grid w-full grid-cols-3"},{default:a(()=>[i(e(j),{value:"general"},{default:a(()=>[i(e(fe),{class:"mr-2 h-4 w-4"}),s[7]||(s[7]=l(" General ",-1))]),_:1}),i(e(j),{value:"permissions"},{default:a(()=>[i(e(ce),{class:"mr-2 h-4 w-4"}),s[8]||(s[8]=l(" Permisos ",-1))]),_:1}),i(e(j),{value:"segments"},{default:a(()=>[i(e(_e),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=l(" Segmentos ",-1))]),_:1})]),_:1}),i(e(U),{value:"general"},{default:a(()=>[i(e($),null,{default:a(()=>[i(e(P),null,{default:a(()=>[i(e(S),null,{default:a(()=>[...s[10]||(s[10]=[l("Información General",-1)])]),_:1}),i(e(C),null,{default:a(()=>[...s[11]||(s[11]=[l(" Define el nombre y descripción del rol ",-1)])]),_:1})]),_:1}),i(e(V),{class:"space-y-4"},{default:a(()=>[n("div",ye,[i(e(c),{htmlFor:"name"},{default:a(()=>[...s[12]||(s[12]=[l("Nombre del Rol (interno)",-1)])]),_:1}),i(e(F),{id:"name",modelValue:e(t).name,"onUpdate:modelValue":s[0]||(s[0]=o=>e(t).name=o),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos"},null,8,["modelValue"]),s[13]||(s[13]=n("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),i(_,{message:e(t).errors.name},null,8,["message"])]),n("div",he,[i(e(c),{htmlFor:"display_name"},{default:a(()=>[...s[14]||(s[14]=[l("Nombre a Mostrar",-1)])]),_:1}),i(e(F),{id:"display_name",modelValue:e(t).display_name,"onUpdate:modelValue":s[1]||(s[1]=o=>e(t).display_name=o),placeholder:"Administrador Regional"},null,8,["modelValue"]),i(_,{message:e(t).errors.display_name},null,8,["message"])]),n("div",ke,[i(e(c),{htmlFor:"description"},{default:a(()=>[...s[15]||(s[15]=[l("Descripción",-1)])]),_:1}),i(e(ie),{id:"description",modelValue:e(t).description,"onUpdate:modelValue":s[2]||(s[2]=o=>e(t).description=o),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),i(_,{message:e(t).errors.description},null,8,["message"])]),n("div",$e,[n("div",Pe,[n("div",Se,[i(e(c),{htmlFor:"is_administrative"},{default:a(()=>[...s[16]||(s[16]=[l("Rol Administrativo",-1)])]),_:1}),s[17]||(s[17]=n("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),i(e(re),{id:"is_administrative",modelValue:e(t).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=o=>e(t).is_administrative=o)},null,8,["modelValue"])]),i(_,{message:e(t).errors.is_administrative},null,8,["message"])]),n("div",Ve,[i(e(c),{htmlFor:"redirect_after_login"},{default:a(()=>[i(e(ge),{class:"inline-block h-4 w-4 mr-1"}),s[18]||(s[18]=l(" Página de Inicio Después del Login ",-1))]),_:1}),i(e(le),{modelValue:e(t).redirect_after_login,"onUpdate:modelValue":s[4]||(s[4]=o=>e(t).redirect_after_login=o)},{default:a(()=>[i(e(ne),{id:"redirect_after_login"},{default:a(()=>[i(e(de),{placeholder:"Seleccione la página de destino"})]),_:1}),i(e(me),null,{default:a(()=>[(d(!0),p(b,null,x(G.value,o=>(d(),k(e(ue),{key:o.value,value:o.value},{default:a(()=>[l(f(o.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),s[19]||(s[19]=n("p",{class:"text-xs text-muted-foreground"}," Define a qué página se redirigirá al usuario después de autenticarse. Si no se especifica, usará el comportamiento por defecto. ",-1)),i(_,{message:e(t).errors.redirect_after_login},null,8,["message"])])]),_:1})]),_:1})]),_:1}),i(e(U),{value:"permissions"},{default:a(()=>[i(e($),null,{default:a(()=>[i(e(P),null,{default:a(()=>[i(e(S),null,{default:a(()=>[...s[20]||(s[20]=[l("Matriz de Permisos",-1)])]),_:1}),i(e(C),null,{default:a(()=>[l(f(e(t).is_administrative?"Selecciona los permisos administrativos para este rol":"Selecciona los permisos de usuario para este rol"),1)]),_:1}),n("div",Ce,[i(e(v),{type:"button",size:"sm",variant:"outline",onClick:q},{default:a(()=>[...s[21]||(s[21]=[l(" Seleccionar Todos ",-1)])]),_:1}),i(e(v),{type:"button",size:"sm",variant:"outline",onClick:I},{default:a(()=>[...s[22]||(s[22]=[l(" Limpiar Todos ",-1)])]),_:1}),i(e(L),{variant:"secondary",class:"ml-auto"},{default:a(()=>[l(f(J.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),i(e(V),null,{default:a(()=>[i(e(oe),{class:"h-[500px] pr-4"},{default:a(()=>[n("div",we,[(d(!0),p(b,null,x(g.value,(o,m)=>(d(),p("div",{key:m,class:"space-y-3"},[n("div",je,[i(e(w),{checked:O(m),indeterminate:z(m),"onUpdate:checked":u=>E(m)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(c),{class:"text-sm font-semibold"},{default:a(()=>[l(f(o.label),1)]),_:2},1024)]),n("div",Ue,[(d(!0),p(b,null,x(o.permissions,(u,y)=>(d(),p("div",{key:y,class:"flex items-center space-x-2"},[i(e(w),{checked:e(t).permissions.includes(y),"onUpdate:checked":Le=>B(y)},null,8,["checked","onUpdate:checked"]),i(e(c),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[l(f(u),1)]),_:2},1024)]))),128))])]))),128))])]),_:1}),i(_,{message:e(t).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),i(e(U),{value:"segments"},{default:a(()=>[i(e($),null,{default:a(()=>[i(e(P),null,{default:a(()=>[i(e(S),null,{default:a(()=>[...s[23]||(s[23]=[l("Segmentos de Datos",-1)])]),_:1}),i(e(C),null,{default:a(()=>[...s[24]||(s[24]=[l(" Asocia segmentos para limitar el alcance de datos visibles ",-1)])]),_:1})]),_:1}),i(e(V),null,{default:a(()=>[r.segments.length>0?(d(),p("div",De,[(d(!0),p(b,null,x(r.segments,o=>(d(),p("div",{key:o.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[i(e(w),{checked:e(t).segment_ids.includes(o.id),"onUpdate:checked":m=>M(o.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),n("div",Ae,[i(e(c),{class:"text-sm font-medium cursor-pointer"},{default:a(()=>[l(f(o.name),1)]),_:2},1024),n("p",Oe,f(o.description||"Sin descripción"),1),o.user_count?(d(),k(e(L),{key:0,variant:"outline",class:"mt-2"},{default:a(()=>[l(f(o.user_count)+" usuarios ",1)]),_:2},1024)):ee("",!0)])]))),128))])):(d(),p("div",Re," No hay segmentos disponibles ")),i(_,{message:e(t).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),n("div",Fe,[i(e(R),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(v),{type:"button",variant:"outline"},{default:a(()=>[...s[25]||(s[25]=[l(" Cancelar ",-1)])]),_:1})]),_:1},8,["href"]),i(e(v),{type:"submit",disabled:e(t).processing},{default:a(()=>[i(e(ve),{class:"mr-2 h-4 w-4"}),l(" "+f(e(t).processing?"Creando...":"Crear Rol"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{Ms as default};
