import{d as Z,C as K,c as h,b as P,e as m,w as a,f as i,g as o,u as e,p as ee,j as $,h as n,P as G,l as se,i as p,F as b,k as x,t as c,W as ie}from"./app-B1G_J44z.js";import{T as ae,_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-C5GOebrC.js";import{_ as k}from"./createLucideIcon-BA6_5T5D.js";import{_ as D,a as U,b as j,c as w}from"./CardTitle.vue_vue_type_script_setup_true_lang-BrPStMNy.js";import{_ as C}from"./CardDescription.vue_vue_type_script_setup_true_lang-CG97qo9A.js";import{_ as N}from"./Input.vue_vue_type_script_setup_true_lang-DO9Up2O_.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-CZcR4vXO.js";import{_ as le}from"./Textarea.vue_vue_type_script_setup_true_lang-CBfJ0VNu.js";import{_ as S}from"./Checkbox.vue_vue_type_script_setup_true_lang-CSRjqAzd.js";import{_ as z}from"./index-DrlmzGiQ.js";import{_ as oe,a as re,b as E,c as O}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DzBjm8XY.js";import{_ as ne}from"./ScrollArea.vue_vue_type_script_setup_true_lang-DW4yJE7c.js";import{_ as de,a as me}from"./index-DEWnBREL.js";import{_ as ue}from"./Switch.vue_vue_type_script_setup_true_lang-DeYqJfna.js";import{_ as pe,a as ce,b as fe,c as _e,d as ve}from"./SelectValue.vue_vue_type_script_setup_true_lang-DqiXJPuJ.js";import{_ as g}from"./InputError.vue_vue_type_script_setup_true_lang-CKbyhwkD.js";import{A as ge}from"./arrow-left-D1FHWnjT.js";import{C as be}from"./circle-alert-DyErMS_l.js";import{S as xe}from"./shield-7VWun8q5.js";import{L as ke}from"./lock-CVtv4XaQ.js";import{H as ye}from"./house-DEVhtdTg.js";import{S as he}from"./save-BLVecpVV.js";import"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-aHU7SBf4.js";import"./index-CUcRCP4y.js";import"./floating-ui.vue-BbXUDa7D.js";import"./x-Cx8rnUeq.js";import"./index-DL5c8l9n.js";import"./user-BYX_8Zw8.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-Cc6C8xpl.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-eI3Iaf36.js";import"./VisuallyHidden-C3qe5bvd.js";import"./index-CgnAgSJb.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-l9iCpPNA.js";import"./index-ciy4Hs4T.js";import"./map-pin-DjHsa5mY.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-fWbNIzJ7.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-7E-GLJHG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevrons-up-down-BiafVk5w.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CDcl1O4h.js";import"./users-BTPJgUzs.js";import"./vote-CmKJ4nIe.js";import"./send-NR9QQ2EJ.js";import"./file-text-BbAceoeB.js";import"./briefcase-DPZVG-y3.js";import"./calendar-DZb4HxWX.js";import"./megaphone-BcQW-GN7.js";import"./user-check-BYXz7gR7.js";import"./mail-B8HbfnRt.js";import"./message-square-B5Qpx1Pb.js";import"./external-link-MvmDoI3Q.js";import"./panel-left-B9Wt-3Gr.js";import"./check-BgFr83Zy.js";import"./index-Ew3xmdhr.js";import"./RovingFocusItem-tHLrbJgb.js";import"./utils-CXGKhRXT.js";import"./VisuallyHiddenInput-CtRchtgj.js";import"./nullish-CHIgUVhi.js";const Pe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},$e={class:"flex items-center justify-between"},Se={class:"flex gap-2"},Ve={class:"space-y-2"},De={class:"space-y-2"},Ue={class:"space-y-2"},je={class:"space-y-2"},we={class:"flex items-center justify-between"},Ce={class:"space-y-0.5"},Ee={class:"space-y-2"},Oe={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},Ae={class:"flex gap-2 mt-4"},Le={class:"space-y-8"},Re={key:0},Fe={class:"space-y-6 pl-4"},Ge={class:"flex items-center space-x-2 pb-2 border-b"},Ne={class:"grid grid-cols-2 gap-3 pl-6"},ze={key:1},Te={class:"space-y-6 pl-4"},Be={class:"flex items-center space-x-2 pb-2 border-b"},Me={class:"grid grid-cols-2 gap-3 pl-6"},qe={key:0,class:"space-y-3"},He={class:"flex-1"},Ie={class:"text-xs text-muted-foreground mt-1"},We={key:1,class:"text-center py-8 text-muted-foreground"},Je={class:"flex justify-end gap-4"},Ks=Z({__name:"Edit",props:{role:{},segments:{},availablePermissions:{},selectedSegments:{}},setup(T){const d=T,B=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Editar Rol",href:"#"}],t=K({name:d.role.name,display_name:d.role.display_name,description:d.role.description||"",is_administrative:!!d.role.is_administrative,redirect_after_login:d.role.redirect_after_login||"default",permissions:d.role.permissions||[],segment_ids:d.selectedSegments||[]}),A=[{value:"default",label:"Por defecto (según tipo de rol)"},{value:"admin.dashboard",label:"Dashboard Administrativo",group:"admin"},{value:"admin.candidaturas.dashboard",label:"Dashboard Candidaturas",group:"admin"},{value:"dashboard",label:"Dashboard Usuario",group:"user"},{value:"votaciones.index",label:"Votaciones",group:"user"},{value:"asambleas.index",label:"Asambleas",group:"user"},{value:"formularios.index",label:"Formularios",group:"user"},{value:"postulaciones.index",label:"Postulaciones",group:"user"},{value:"admin.otp-dashboard",label:"Dashboard OTP",group:"admin"},{value:"admin.configuracion.index",label:"Configuración",group:"admin"},{value:"admin.users.index",label:"Usuarios",group:"admin"},{value:"admin.roles.index",label:"Roles y Permisos",group:"admin"},{value:"admin.candidaturas.index",label:"Candidaturas (Lista)",group:"admin"}],M=h(()=>t.is_administrative?A:A.filter(r=>r.group!=="admin"||r.value==="default")),y=h(()=>["super_admin","admin","manager","user","end_customer"].includes(d.role.name));h(()=>({...d.availablePermissions.administrative,...d.availablePermissions.frontend}));const V=r=>{const s=d.availablePermissions.administrative[r]||d.availablePermissions.frontend[r];return s?Object.keys(s.permissions).every(u=>t.permissions.includes(u)):!1},L=r=>{const s=d.availablePermissions.administrative[r]||d.availablePermissions.frontend[r];if(!s)return!1;const l=Object.keys(s.permissions),u=l.filter(f=>t.permissions.includes(f)).length;return u>0&&u<l.length},R=r=>{const s=t.permissions.indexOf(r);s>-1?t.permissions.splice(s,1):t.permissions.push(r)},F=r=>{const s=d.availablePermissions.administrative[r]||d.availablePermissions.frontend[r];if(!s)return;const l=Object.keys(s.permissions);V(r)?t.permissions=t.permissions.filter(f=>!l.includes(f)):l.forEach(f=>{t.permissions.includes(f)||t.permissions.push(f)})},q=r=>{const s=t.segment_ids.indexOf(r);s>-1?t.segment_ids.splice(s,1):t.segment_ids.push(r)},H=()=>{t.put(`/admin/roles/${d.role.id}`,{preserveScroll:!0,onSuccess:()=>{}})},I=()=>{confirm(`¿Estás seguro de eliminar el rol "${d.role.display_name}"? Esta acción no se puede deshacer.`)&&ie.delete(`/admin/roles/${d.role.id}`)},W=()=>{const r=[];Object.values(d.availablePermissions.administrative).forEach(s=>{Object.keys(s.permissions).forEach(l=>{r.push(l)})}),Object.values(d.availablePermissions.frontend).forEach(s=>{Object.keys(s.permissions).forEach(l=>{r.push(l)})}),t.permissions=r},J=()=>{t.permissions=[]},Q=h(()=>t.permissions.length),X=h(()=>!y.value);return(r,s)=>(m(),P(te,{breadcrumbs:B},{default:a(()=>[i(e(ee),{title:"Editar Rol"}),o("div",Pe,[o("div",$e,[s[7]||(s[7]=o("div",null,[o("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Rol"),o("p",{class:"text-muted-foreground"}," Modifica los permisos y configuración del rol ")],-1)),o("div",Se,[X.value?(m(),P(e(k),{key:0,onClick:I,variant:"destructive",type:"button"},{default:a(()=>[...s[5]||(s[5]=[n(" Eliminar Rol ",-1)])]),_:1})):$("",!0),i(e(G),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(k),{variant:"outline"},{default:a(()=>[i(e(ge),{class:"mr-2 h-4 w-4"}),s[6]||(s[6]=n(" Volver ",-1))]),_:1})]),_:1},8,["href"])])]),y.value?(m(),P(e(de),{key:0},{default:a(()=>[i(e(be),{class:"h-4 w-4"}),i(e(me),null,{default:a(()=>[...s[8]||(s[8]=[n(" Este es un rol del sistema. Algunas configuraciones pueden estar restringidas. ",-1)])]),_:1})]),_:1})):$("",!0),o("form",{onSubmit:se(H,["prevent"]),class:"space-y-6"},[i(e(oe),{defaultValue:"general",class:"space-y-4"},{default:a(()=>[i(e(re),{class:"grid w-full grid-cols-3"},{default:a(()=>[i(e(E),{value:"general"},{default:a(()=>[i(e(xe),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=n(" General ",-1))]),_:1}),i(e(E),{value:"permissions"},{default:a(()=>[i(e(ke),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=n(" Permisos ",-1))]),_:1}),i(e(E),{value:"segments"},{default:a(()=>[i(e(ae),{class:"mr-2 h-4 w-4"}),s[11]||(s[11]=n(" Segmentos ",-1))]),_:1})]),_:1}),i(e(O),{value:"general"},{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>[...s[12]||(s[12]=[n("Información General",-1)])]),_:1}),i(e(C),null,{default:a(()=>[...s[13]||(s[13]=[n(" Define el nombre y descripción del rol ",-1)])]),_:1})]),_:1}),i(e(w),{class:"space-y-4"},{default:a(()=>[o("div",Ve,[i(e(_),{htmlFor:"name"},{default:a(()=>[...s[14]||(s[14]=[n("Nombre del Rol (interno)",-1)])]),_:1}),i(e(N),{id:"name",modelValue:e(t).name,"onUpdate:modelValue":s[0]||(s[0]=l=>e(t).name=l),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos",disabled:y.value},null,8,["modelValue","disabled"]),s[15]||(s[15]=o("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),i(g,{message:e(t).errors.name},null,8,["message"])]),o("div",De,[i(e(_),{htmlFor:"display_name"},{default:a(()=>[...s[16]||(s[16]=[n("Nombre a Mostrar",-1)])]),_:1}),i(e(N),{id:"display_name",modelValue:e(t).display_name,"onUpdate:modelValue":s[1]||(s[1]=l=>e(t).display_name=l),placeholder:"Administrador Regional"},null,8,["modelValue"]),i(g,{message:e(t).errors.display_name},null,8,["message"])]),o("div",Ue,[i(e(_),{htmlFor:"description"},{default:a(()=>[...s[17]||(s[17]=[n("Descripción",-1)])]),_:1}),i(e(le),{id:"description",modelValue:e(t).description,"onUpdate:modelValue":s[2]||(s[2]=l=>e(t).description=l),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),i(g,{message:e(t).errors.description},null,8,["message"])]),o("div",je,[o("div",we,[o("div",Ce,[i(e(_),{htmlFor:"is_administrative"},{default:a(()=>[...s[18]||(s[18]=[n("Rol Administrativo",-1)])]),_:1}),s[19]||(s[19]=o("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),i(e(ue),{id:"is_administrative",modelValue:e(t).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=l=>e(t).is_administrative=l),disabled:y.value},null,8,["modelValue","disabled"])]),i(g,{message:e(t).errors.is_administrative},null,8,["message"])]),o("div",Ee,[i(e(_),{htmlFor:"redirect_after_login"},{default:a(()=>[i(e(ye),{class:"inline-block h-4 w-4 mr-1"}),s[20]||(s[20]=n(" Página de Inicio Después del Login ",-1))]),_:1}),i(e(pe),{modelValue:e(t).redirect_after_login,"onUpdate:modelValue":s[4]||(s[4]=l=>e(t).redirect_after_login=l),disabled:y.value},{default:a(()=>[i(e(ce),{id:"redirect_after_login"},{default:a(()=>[i(e(fe),{placeholder:"Seleccione la página de destino"})]),_:1}),i(e(_e),null,{default:a(()=>[(m(!0),p(b,null,x(M.value,l=>(m(),P(e(ve),{key:l.value,value:l.value},{default:a(()=>[n(c(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),s[21]||(s[21]=o("p",{class:"text-xs text-muted-foreground"}," Define a qué página se redirigirá al usuario después de autenticarse. Si no se especifica, usará el comportamiento por defecto. ",-1)),i(g,{message:e(t).errors.redirect_after_login},null,8,["message"])]),o("div",Oe,[o("p",null,"ID del Rol: "+c(r.role.id),1),o("p",null,"Creado: "+c(new Date(r.role.created_at).toLocaleDateString()),1),o("p",null,"Última actualización: "+c(new Date(r.role.updated_at).toLocaleDateString()),1)])]),_:1})]),_:1})]),_:1}),i(e(O),{value:"permissions"},{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>[...s[22]||(s[22]=[n("Matriz de Permisos",-1)])]),_:1}),i(e(C),null,{default:a(()=>[...s[23]||(s[23]=[n(" Selecciona los permisos que tendrá este rol. Los permisos están organizados en dos secciones: administrativos (acceso al panel admin) y frontend (funciones de usuario). ",-1)])]),_:1}),o("div",Ae,[i(e(k),{type:"button",size:"sm",variant:"outline",onClick:W},{default:a(()=>[...s[24]||(s[24]=[n(" Seleccionar Todos ",-1)])]),_:1}),i(e(k),{type:"button",size:"sm",variant:"outline",onClick:J},{default:a(()=>[...s[25]||(s[25]=[n(" Limpiar Todos ",-1)])]),_:1}),i(e(z),{variant:"secondary",class:"ml-auto"},{default:a(()=>[n(c(Q.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),i(e(w),null,{default:a(()=>[i(e(ne),{class:"h-[500px] pr-4"},{default:a(()=>[o("div",Le,[Object.keys(r.availablePermissions.administrative).length>0?(m(),p("div",Re,[s[26]||(s[26]=o("h3",{class:"text-lg font-semibold mb-4 text-orange-600 dark:text-orange-400"}," Permisos Administrativos ",-1)),o("div",Fe,[(m(!0),p(b,null,x(r.availablePermissions.administrative,(l,u)=>(m(),p("div",{key:`admin-${u}`,class:"space-y-3"},[o("div",Ge,[i(e(S),{checked:V(u),indeterminate:L(u),"onUpdate:checked":f=>F(u)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(_),{class:"text-sm font-semibold"},{default:a(()=>[n(c(l.label),1)]),_:2},1024)]),o("div",Ne,[(m(!0),p(b,null,x(l.permissions,(f,v)=>(m(),p("div",{key:v,class:"flex items-center space-x-2"},[i(e(S),{checked:e(t).permissions.includes(v),"onUpdate:checked":Y=>R(v)},null,8,["checked","onUpdate:checked"]),i(e(_),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[n(c(f),1)]),_:2},1024)]))),128))])]))),128))])])):$("",!0),s[28]||(s[28]=o("div",{class:"border-t-2 border-dashed"},null,-1)),Object.keys(r.availablePermissions.frontend).length>0?(m(),p("div",ze,[s[27]||(s[27]=o("h3",{class:"text-lg font-semibold mb-4 text-blue-600 dark:text-blue-400"}," Permisos de Usuario (Frontend) ",-1)),o("div",Te,[(m(!0),p(b,null,x(r.availablePermissions.frontend,(l,u)=>(m(),p("div",{key:`frontend-${u}`,class:"space-y-3"},[o("div",Be,[i(e(S),{checked:V(u),indeterminate:L(u),"onUpdate:checked":f=>F(u)},null,8,["checked","indeterminate","onUpdate:checked"]),i(e(_),{class:"text-sm font-semibold"},{default:a(()=>[n(c(l.label),1)]),_:2},1024)]),o("div",Me,[(m(!0),p(b,null,x(l.permissions,(f,v)=>(m(),p("div",{key:v,class:"flex items-center space-x-2"},[i(e(S),{checked:e(t).permissions.includes(v),"onUpdate:checked":Y=>R(v)},null,8,["checked","onUpdate:checked"]),i(e(_),{class:"text-sm font-normal cursor-pointer"},{default:a(()=>[n(c(f),1)]),_:2},1024)]))),128))])]))),128))])])):$("",!0)])]),_:1}),i(g,{message:e(t).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),i(e(O),{value:"segments"},{default:a(()=>[i(e(D),null,{default:a(()=>[i(e(U),null,{default:a(()=>[i(e(j),null,{default:a(()=>[...s[29]||(s[29]=[n("Segmentos de Datos",-1)])]),_:1}),i(e(C),null,{default:a(()=>[...s[30]||(s[30]=[n(" Asocia segmentos para limitar el alcance de datos visibles ",-1)])]),_:1})]),_:1}),i(e(w),null,{default:a(()=>[r.segments.length>0?(m(),p("div",qe,[(m(!0),p(b,null,x(r.segments,l=>(m(),p("div",{key:l.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[i(e(S),{checked:e(t).segment_ids.includes(l.id),"onUpdate:checked":u=>q(l.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),o("div",He,[i(e(_),{class:"text-sm font-medium cursor-pointer"},{default:a(()=>[n(c(l.name),1)]),_:2},1024),o("p",Ie,c(l.description||"Sin descripción"),1),l.user_count?(m(),P(e(z),{key:0,variant:"outline",class:"mt-2"},{default:a(()=>[n(c(l.user_count)+" usuarios ",1)]),_:2},1024)):$("",!0)])]))),128))])):(m(),p("div",We," No hay segmentos disponibles ")),i(g,{message:e(t).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),o("div",Je,[i(e(G),{href:r.route("admin.roles.index")},{default:a(()=>[i(e(k),{type:"button",variant:"outline"},{default:a(()=>[...s[31]||(s[31]=[n(" Cancelar ",-1)])]),_:1})]),_:1},8,["href"]),i(e(k),{type:"submit",disabled:e(t).processing},{default:a(()=>[i(e(he),{class:"mr-2 h-4 w-4"}),n(" "+c(e(t).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{Ks as default};
