import{T as W,_ as J}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BV_pB_Qs.js";import{d as X,k as G,j as $,o as d,e as a,b as e,f as o,u as t,m as K,t as i,g as n,n as Q,P as k,a as u,i as j,F as D,r as E,W as R}from"./app-BS9XlOI1.js";import{_ as x}from"./createLucideIcon-CoiVMf3Y.js";import{_ as p,a as _,b as g,c}from"./CardTitle.vue_vue_type_script_setup_true_lang-D3Omm2ZH.js";import{_ as T}from"./CardDescription.vue_vue_type_script_setup_true_lang-DqqFwRdU.js";import{_ as b}from"./index-DWRN2ibd.js";import{_ as Y,a as Z,b as N,c as h,d as tt,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-E0bh2NGS.js";import{S as et,_ as st,a as at,b as lt}from"./UpdateLocationModal.vue_vue_type_script_setup_true_lang-BvdzkcsD.js";import{_ as ot,a as nt,b as S,c as C}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BFKmEdcQ.js";import{_ as it}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BdIlRb5b.js";import{R as rt}from"./refresh-cw-E4K4N7oM.js";import{T as dt}from"./trash-Bsbn0pnN.js";import{S as ut}from"./square-pen-C9vlux7T.js";import{A as mt}from"./arrow-left-oiqmvFNQ.js";import{U as ft}from"./users-CI0OCXEP.js";import{C as pt}from"./calendar-4aRQquEl.js";import{H as _t}from"./hash-B3untNTd.js";import{M as gt}from"./mail-CnC4nfAw.js";import{U as ct}from"./user-YOiQ0oKj.js";import"./index-DlfIkzvf.js";import"./floating-ui.vue-2NNx9uEx.js";import"./CollapsibleContent.vue_vue_type_script_setup_true_lang-DNQiaaUT.js";import"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-DizL-HUe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-YhrPR235.js";import"./chevrons-up-down-Dpb8fdG1.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-CvcZAjqG.js";import"./shield-pr9anytA.js";import"./vote-CR5FzUsn.js";import"./file-text-DCiL5M9z.js";import"./briefcase-CD1sU9n3.js";import"./megaphone--WONTJZ-.js";import"./user-check-D3e1jKyX.js";import"./external-link-B4SHAZBs.js";import"./panel-left-BPQbiP09.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-JZr5JedR.js";import"./VisuallyHidden-CXrzuRgz.js";import"./Input.vue_vue_type_script_setup_true_lang-B0Lm-MVR.js";import"./index-BIGMq5Xk.js";import"./check-BZtgD0Hw.js";import"./index-C_vxUID_.js";import"./index-Btkc9Vu7.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DRMSiv_B.js";import"./Label.vue_vue_type_script_setup_true_lang-COEXgYjN.js";import"./GeographicSelector.vue_vue_type_script_setup_true_lang-Cj8uOxdD.js";import"./circle-alert-CiNzyy5h.js";import"./map-pin-B_lTWc96.js";import"./RovingFocusItem-Cx1a0rKy.js";import"./utils-Dbbsb9Xl.js";const vt={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xt={class:"flex items-center justify-between"},yt={class:"flex items-center gap-4"},bt={class:"p-3 bg-primary/10 rounded-lg"},ht={class:"text-2xl font-bold tracking-tight"},wt={class:"flex items-center gap-2 mt-1"},$t={class:"flex gap-2"},kt={class:"grid gap-6 md:grid-cols-4"},St={class:"text-2xl font-bold"},Ct={class:"text-2xl font-bold"},jt={class:"text-sm font-bold"},Dt={class:"text-2xl font-bold"},Et={class:"flex items-center gap-3"},Tt={class:"font-medium"},Ut={class:"flex items-center gap-1"},At={class:"text-sm"},Rt={key:1,class:"text-center py-8 text-muted-foreground"},Nt={key:2,class:"mt-4 text-sm text-muted-foreground text-center"},Vt={key:0},Ft={class:"space-y-4"},Lt={class:"flex items-center justify-between"},Mt={class:"font-semibold"},Pt={class:"text-sm text-muted-foreground"},zt={key:1,class:"text-center py-8 text-muted-foreground"},Bt={key:0,class:"space-y-3"},qt={class:"font-semibold"},It={class:"text-sm text-muted-foreground"},Ot={key:1,class:"text-center py-8 text-muted-foreground"},Ht={class:"grid grid-cols-2 gap-4"},Wt={class:"text-sm font-mono"},Jt={class:"text-sm font-mono"},Xt={class:"text-sm"},Gt={class:"text-sm"},Kt={class:"text-sm"},Qt={key:0},Yt={class:"text-sm"},Xe=X({__name:"Show",props:{segment:{},users:{},metadata:{},isPaginated:{type:Boolean}},setup(V){const v=V,F=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:v.segment.name,href:"#"}],y=G(!1),L=l=>l.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2),M=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),U=l=>new Date(l).toLocaleString("es-ES"),P=l=>l<60?`${l} segundos`:l<3600?`${Math.floor(l/60)} minutos`:`${Math.floor(l/3600)} horas`,z=l=>l.split("\\").pop()||l,B=l=>l!=null&&l.last_calculated_at?new Date(l.last_calculated_at).toLocaleString():"Nunca",q=async()=>{var l;y.value=!0;try{(await(await fetch(`/admin/segments/${v.segment.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""}})).json()).success&&R.reload()}catch(s){console.error("Error evaluating segment:",s)}finally{y.value=!1}},I=()=>{R.post(`/admin/segments/${v.segment.id}/clear-cache`)},A=()=>v.isPaginated?v.users:{data:v.users},O=l=>Array.isArray(l)?l.join(", "):typeof l=="object"&&l!==null?JSON.stringify(l):String(l),H=l=>{if(!l||typeof l!="object")return[];const s=[];for(const[r,m]of Object.entries(l))m!=null&&s.push({field:r,value:m});return s};return(l,s)=>(d(),$(J,{breadcrumbs:F},{default:a(()=>[e(t(K),{title:`Segmento: ${l.segment.name}`},null,8,["title"]),o("div",vt,[o("div",xt,[o("div",yt,[o("div",bt,[e(t(W),{class:"h-8 w-8 text-primary"})]),o("div",null,[o("h2",ht,i(l.segment.name),1),o("div",wt,[e(t(b),{variant:l.segment.is_dynamic?"default":"secondary"},{default:a(()=>[n(i(l.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"]),e(t(b),{variant:"outline"},{default:a(()=>[n(i(z(l.segment.model_type)),1)]),_:1})])])]),o("div",$t,[e(t(x),{onClick:q,variant:"secondary",disabled:y.value},{default:a(()=>[e(t(rt),{class:Q(["mr-2 h-4 w-4",{"animate-spin":y.value}])},null,8,["class"]),n(" "+i(y.value?"Evaluando...":"Recalcular"),1)]),_:1},8,["disabled"]),e(t(x),{onClick:I,variant:"ghost"},{default:a(()=>[e(t(dt),{class:"mr-2 h-4 w-4"}),s[0]||(s[0]=n(" Limpiar Cache "))]),_:1}),e(t(k),{href:`/admin/segments/${l.segment.id}/edit`},{default:a(()=>[e(t(x),null,{default:a(()=>[e(t(ut),{class:"mr-2 h-4 w-4"}),s[1]||(s[1]=n(" Editar "))]),_:1})]),_:1},8,["href"]),e(t(k),{href:l.route("admin.segments.index")},{default:a(()=>[e(t(x),{variant:"outline"},{default:a(()=>[e(t(mt),{class:"mr-2 h-4 w-4"}),s[2]||(s[2]=n(" Volver "))]),_:1})]),_:1},8,["href"])])]),o("div",kt,[e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>s[3]||(s[3]=[n("Usuarios Totales")])),_:1}),e(t(ft),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>{var r;return[o("div",St,i(((r=l.metadata)==null?void 0:r.contacts_count)||0),1),s[4]||(s[4]=o("p",{class:"text-xs text-muted-foreground"},"usuarios en este segmento",-1))]}),_:1})]),_:1}),e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>s[5]||(s[5]=[n("Cache")])),_:1}),e(t(et),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>[o("div",Ct,i(P(l.segment.cache_duration)),1),s[6]||(s[6]=o("p",{class:"text-xs text-muted-foreground"},"duración del cache",-1))]),_:1})]),_:1}),e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>s[7]||(s[7]=[n("Última Evaluación")])),_:1}),e(t(pt),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>[o("div",jt,i(B(l.metadata)),1),s[8]||(s[8]=o("p",{class:"text-xs text-muted-foreground"},"última actualización",-1))]),_:1})]),_:1}),e(t(p),null,{default:a(()=>[e(t(_),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[e(t(g),{class:"text-sm font-medium"},{default:a(()=>s[9]||(s[9]=[n("Roles")])),_:1}),e(t(_t),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(t(c),null,{default:a(()=>{var r;return[o("div",Dt,i(((r=l.segment.roles)==null?void 0:r.length)||0),1),s[10]||(s[10]=o("p",{class:"text-xs text-muted-foreground"},"roles asociados",-1))]}),_:1})]),_:1})]),e(t(ot),{defaultValue:"users",class:"space-y-4"},{default:a(()=>[e(t(nt),null,{default:a(()=>[e(t(S),{value:"users"},{default:a(()=>s[11]||(s[11]=[n("Usuarios")])),_:1}),e(t(S),{value:"filters"},{default:a(()=>s[12]||(s[12]=[n("Filtros")])),_:1}),e(t(S),{value:"roles"},{default:a(()=>s[13]||(s[13]=[n("Roles")])),_:1}),e(t(S),{value:"details"},{default:a(()=>s[14]||(s[14]=[n("Detalles")])),_:1})]),_:1}),e(t(C),{value:"users"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>s[15]||(s[15]=[n("Usuarios en este Segmento")])),_:1}),e(t(T),null,{default:a(()=>s[16]||(s[16]=[n(" Lista de usuarios que cumplen con los criterios del segmento ")])),_:1})]),_:1}),e(t(c),null,{default:a(()=>{var r,m;return[(r=A().data)!=null&&r.length?(d(),$(t(Y),{key:0},{default:a(()=>[e(t(Z),null,{default:a(()=>[e(t(N),null,{default:a(()=>[e(t(h),null,{default:a(()=>s[17]||(s[17]=[n("Usuario")])),_:1}),e(t(h),null,{default:a(()=>s[18]||(s[18]=[n("Email")])),_:1}),e(t(h),null,{default:a(()=>s[19]||(s[19]=[n("Estado")])),_:1}),e(t(h),null,{default:a(()=>s[20]||(s[20]=[n("Registro")])),_:1}),e(t(h),{class:"text-right"},{default:a(()=>s[21]||(s[21]=[n("Acciones")])),_:1})]),_:1})]),_:1}),e(t(tt),null,{default:a(()=>[(d(!0),u(D,null,E(A().data,f=>(d(),$(t(N),{key:f.id},{default:a(()=>[e(t(w),null,{default:a(()=>[o("div",Et,[e(t(st),{class:"h-8 w-8"},{default:a(()=>[f.avatar?(d(),$(t(at),{key:0,src:f.avatar,alt:f.name},null,8,["src","alt"])):j("",!0),e(t(lt),null,{default:a(()=>[n(i(L(f.name)),1)]),_:2},1024)]),_:2},1024),o("span",Tt,i(f.name),1)])]),_:2},1024),e(t(w),null,{default:a(()=>[o("div",Ut,[e(t(gt),{class:"h-4 w-4 text-muted-foreground"}),o("span",At,i(f.email),1)])]),_:2},1024),e(t(w),null,{default:a(()=>[e(t(b),{variant:f.activo?"default":"secondary"},{default:a(()=>[n(i(f.activo?"Activo":"Inactivo"),1)]),_:2},1032,["variant"])]),_:2},1024),e(t(w),null,{default:a(()=>[n(i(M(f.created_at)),1)]),_:2},1024),e(t(w),{class:"text-right"},{default:a(()=>[e(t(k),{href:`/admin/users/${f.id}`},{default:a(()=>[e(t(x),{size:"sm",variant:"ghost"},{default:a(()=>[e(t(ct),{class:"mr-2 h-4 w-4"}),s[22]||(s[22]=n(" Ver Usuario "))]),_:1})]),_:2},1032,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(d(),u("div",Rt," No hay usuarios en este segmento ")),l.isPaginated?(d(),u("div",Nt," Mostrando "+i((m=l.users.data)==null?void 0:m.length)+" de "+i(l.users.total)+" usuarios ",1)):j("",!0)]}),_:1})]),_:1})]),_:1}),e(t(C),{value:"filters"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>s[23]||(s[23]=[n("Criterios de Filtrado")])),_:1}),e(t(T),null,{default:a(()=>s[24]||(s[24]=[n(" Filtros aplicados para determinar los usuarios de este segmento ")])),_:1})]),_:1}),e(t(c),null,{default:a(()=>[l.segment.filters&&Object.keys(l.segment.filters).length>0?(d(),u("div",Vt,[e(t(it),{class:"h-[400px]"},{default:a(()=>[o("div",Ft,[(d(!0),u(D,null,E(H(l.segment.filters),r=>(d(),u("div",{key:r.field,class:"p-4 border rounded-lg"},[o("div",Lt,[o("div",null,[o("p",Mt,i(r.field),1),o("p",Pt,i(O(r.value)),1)]),e(t(b),{variant:"outline"},{default:a(()=>[n(i(typeof r.value=="object"?"Complejo":"Simple"),1)]),_:2},1024)])]))),128))])]),_:1})])):(d(),u("div",zt," No hay filtros definidos para este segmento "))]),_:1})]),_:1})]),_:1}),e(t(C),{value:"roles"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>s[25]||(s[25]=[n("Roles Asociados")])),_:1}),e(t(T),null,{default:a(()=>s[26]||(s[26]=[n(" Roles que utilizan este segmento para delimitar el alcance de datos ")])),_:1})]),_:1}),e(t(c),null,{default:a(()=>{var r;return[(r=l.segment.roles)!=null&&r.length?(d(),u("div",Bt,[(d(!0),u(D,null,E(l.segment.roles,m=>(d(),u("div",{key:m.id,class:"flex items-center justify-between p-4 border rounded-lg"},[o("div",null,[o("h4",qt,i(m.display_name),1),o("p",It,i(m.name),1)]),e(t(k),{href:`/admin/roles/${m.id}`},{default:a(()=>[e(t(x),{size:"sm",variant:"ghost"},{default:a(()=>s[27]||(s[27]=[n(" Ver Rol ")])),_:1})]),_:2},1032,["href"])]))),128))])):(d(),u("div",Ot," No hay roles asociados a este segmento "))]}),_:1})]),_:1})]),_:1}),e(t(C),{value:"details"},{default:a(()=>[e(t(p),null,{default:a(()=>[e(t(_),null,{default:a(()=>[e(t(g),null,{default:a(()=>s[28]||(s[28]=[n("Información del Segmento")])),_:1})]),_:1}),e(t(c),{class:"space-y-4"},{default:a(()=>{var r;return[o("div",Ht,[o("div",null,[s[29]||(s[29]=o("p",{class:"text-sm font-medium text-muted-foreground"},"ID del Segmento",-1)),o("p",Wt,i(l.segment.id),1)]),o("div",null,[s[30]||(s[30]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Modelo",-1)),o("p",Jt,i(l.segment.model_type),1)]),o("div",null,[s[31]||(s[31]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Creado por",-1)),o("p",Xt,i(((r=l.segment.created_by)==null?void 0:r.name)||"Sistema"),1)]),o("div",null,[s[32]||(s[32]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo",-1)),e(t(b),{variant:l.segment.is_dynamic?"default":"secondary"},{default:a(()=>[n(i(l.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"])]),o("div",null,[s[33]||(s[33]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Creado",-1)),o("p",Gt,i(U(l.segment.created_at)),1)]),o("div",null,[s[34]||(s[34]=o("p",{class:"text-sm font-medium text-muted-foreground"},"Última Actualización",-1)),o("p",Kt,i(U(l.segment.updated_at)),1)])]),l.segment.description?(d(),u("div",Qt,[s[35]||(s[35]=o("p",{class:"text-sm font-medium text-muted-foreground mb-2"},"Descripción",-1)),o("p",Yt,i(l.segment.description),1)])):j("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}))}});export{Xe as default};
